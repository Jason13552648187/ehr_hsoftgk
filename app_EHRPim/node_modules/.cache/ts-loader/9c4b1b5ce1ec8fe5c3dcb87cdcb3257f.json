{"remainingRequest":"F:\\crod项目\\人事管理系统2\\iBizEHR\\app_EHRPim\\node_modules\\thread-loader\\dist\\cjs.js!F:\\crod项目\\人事管理系统2\\iBizEHR\\app_EHRPim\\node_modules\\babel-loader\\lib\\index.js!F:\\crod项目\\人事管理系统2\\iBizEHR\\app_EHRPim\\node_modules\\ts-loader\\index.js??ref--14-3!F:\\crod项目\\人事管理系统2\\iBizEHR\\app_EHRPim\\node_modules\\cache-loader\\dist\\cjs.js??ref--0-0!F:\\crod项目\\人事管理系统2\\iBizEHR\\app_EHRPim\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!F:\\crod项目\\人事管理系统2\\iBizEHR\\app_EHRPim\\src\\widgets\\pim-archives-center\\main-grid\\main-grid-base.vue?vue&type=script&lang=tsx&","dependencies":[{"path":"F:\\crod项目\\人事管理系统2\\iBizEHR\\app_EHRPim\\src\\widgets\\pim-archives-center\\main-grid\\main-grid-base.vue","mtime":1630509411254},{"path":"F:\\crod项目\\人事管理系统2\\iBizEHR\\app_EHRPim\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1630511852775},{"path":"F:\\crod项目\\人事管理系统2\\iBizEHR\\app_EHRPim\\node_modules\\thread-loader\\dist\\cjs.js","mtime":1630511853252},{"path":"F:\\crod项目\\人事管理系统2\\iBizEHR\\app_EHRPim\\node_modules\\babel-loader\\lib\\index.js","mtime":1630511852747},{"path":"F:\\crod项目\\人事管理系统2\\iBizEHR\\app_EHRPim\\node_modules\\ts-loader\\index.js","mtime":1630511985412},{"path":"F:\\crod项目\\人事管理系统2\\iBizEHR\\app_EHRPim\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1630511852775},{"path":"F:\\crod项目\\人事管理系统2\\iBizEHR\\app_EHRPim\\node_modules\\vue-loader\\lib\\index.js","mtime":1630512070338}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:aW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuc3ltYm9sIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuc3ltYm9sLmRlc2NyaXB0aW9uIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuc3ltYm9sLml0ZXJhdG9yIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkuZmlsdGVyIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkuZmluZCI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLmFycmF5LmZpbmQtaW5kZXgiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5hcnJheS5mb3ItZWFjaCI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLmFycmF5LmpvaW4iOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5hcnJheS5tYXAiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5hcnJheS5zb21lIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkuc3BsaWNlIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuZnVuY3Rpb24ubmFtZSI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLm9iamVjdC5kZWZpbmUtcHJvcGVydGllcyI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLm9iamVjdC5kZWZpbmUtcHJvcGVydHkiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5vYmplY3QuZ2V0LW93bi1wcm9wZXJ0eS1kZXNjcmlwdG9yIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMub2JqZWN0LmdldC1vd24tcHJvcGVydHktZGVzY3JpcHRvcnMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5vYmplY3QuaXMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5vYmplY3Qua2V5cyI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLm9iamVjdC50by1zdHJpbmciOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5wYXJzZS1pbnQiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5yZWdleHAuZXhlYyI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLnN0cmluZy5pdGVyYXRvciI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLnN0cmluZy5yZXBsYWNlIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuc3RyaW5nLnNlYXJjaCI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLnN0cmluZy5zcGxpdCI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL3dlYi5kb20tY29sbGVjdGlvbnMuZm9yLWVhY2giOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy93ZWIuZG9tLWNvbGxlY3Rpb25zLml0ZXJhdG9yIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvd2ViLnRpbWVycyI7CmltcG9ydCBfdG9Db25zdW1hYmxlQXJyYXkgZnJvbSAiRjpcXGNyb2RcdTk4NzlcdTc2RUVcXFx1NEVCQVx1NEU4Qlx1N0JBMVx1NzQwNlx1N0NGQlx1N0VERjJcXGlCaXpFSFJcXGFwcF9FSFJQaW1cXG5vZGVfbW9kdWxlc1xcQGJhYmVsXFxydW50aW1lL2hlbHBlcnMvZXNtL3RvQ29uc3VtYWJsZUFycmF5IjsKaW1wb3J0IF9kZWZpbmVQcm9wZXJ0eSBmcm9tICJGOlxcY3JvZFx1OTg3OVx1NzZFRVxcXHU0RUJBXHU0RThCXHU3QkExXHU3NDA2XHU3Q0ZCXHU3RURGMlxcaUJpekVIUlxcYXBwX0VIUlBpbVxcbm9kZV9tb2R1bGVzXFxAYmFiZWxcXHJ1bnRpbWUvaGVscGVycy9lc20vZGVmaW5lUHJvcGVydHkiOwppbXBvcnQgInJlZ2VuZXJhdG9yLXJ1bnRpbWUvcnVudGltZSI7CmltcG9ydCBfYXN5bmNUb0dlbmVyYXRvciBmcm9tICJGOlxcY3JvZFx1OTg3OVx1NzZFRVxcXHU0RUJBXHU0RThCXHU3QkExXHU3NDA2XHU3Q0ZCXHU3RURGMlxcaUJpekVIUlxcYXBwX0VIUlBpbVxcbm9kZV9tb2R1bGVzXFxAYmFiZWxcXHJ1bnRpbWUvaGVscGVycy9lc20vYXN5bmNUb0dlbmVyYXRvciI7CmltcG9ydCBfY2xhc3NDYWxsQ2hlY2sgZnJvbSAiRjpcXGNyb2RcdTk4NzlcdTc2RUVcXFx1NEVCQVx1NEU4Qlx1N0JBMVx1NzQwNlx1N0NGQlx1N0VERjJcXGlCaXpFSFJcXGFwcF9FSFJQaW1cXG5vZGVfbW9kdWxlc1xcQGJhYmVsXFxydW50aW1lL2hlbHBlcnMvZXNtL2NsYXNzQ2FsbENoZWNrIjsKaW1wb3J0IF9jcmVhdGVDbGFzcyBmcm9tICJGOlxcY3JvZFx1OTg3OVx1NzZFRVxcXHU0RUJBXHU0RThCXHU3QkExXHU3NDA2XHU3Q0ZCXHU3RURGMlxcaUJpekVIUlxcYXBwX0VIUlBpbVxcbm9kZV9tb2R1bGVzXFxAYmFiZWxcXHJ1bnRpbWUvaGVscGVycy9lc20vY3JlYXRlQ2xhc3MiOwppbXBvcnQgX3Bvc3NpYmxlQ29uc3RydWN0b3JSZXR1cm4gZnJvbSAiRjpcXGNyb2RcdTk4NzlcdTc2RUVcXFx1NEVCQVx1NEU4Qlx1N0JBMVx1NzQwNlx1N0NGQlx1N0VERjJcXGlCaXpFSFJcXGFwcF9FSFJQaW1cXG5vZGVfbW9kdWxlc1xcQGJhYmVsXFxydW50aW1lL2hlbHBlcnMvZXNtL3Bvc3NpYmxlQ29uc3RydWN0b3JSZXR1cm4iOwppbXBvcnQgX2dldFByb3RvdHlwZU9mIGZyb20gIkY6XFxjcm9kXHU5ODc5XHU3NkVFXFxcdTRFQkFcdTRFOEJcdTdCQTFcdTc0MDZcdTdDRkJcdTdFREYyXFxpQml6RUhSXFxhcHBfRUhSUGltXFxub2RlX21vZHVsZXNcXEBiYWJlbFxccnVudGltZS9oZWxwZXJzL2VzbS9nZXRQcm90b3R5cGVPZiI7CmltcG9ydCBfaW5oZXJpdHMgZnJvbSAiRjpcXGNyb2RcdTk4NzlcdTc2RUVcXFx1NEVCQVx1NEU4Qlx1N0JBMVx1NzQwNlx1N0NGQlx1N0VERjJcXGlCaXpFSFJcXGFwcF9FSFJQaW1cXG5vZGVfbW9kdWxlc1xcQGJhYmVsXFxydW50aW1lL2hlbHBlcnMvZXNtL2luaGVyaXRzIjsKCmZ1bmN0aW9uIG93bktleXMob2JqZWN0LCBlbnVtZXJhYmxlT25seSkgeyB2YXIga2V5cyA9IE9iamVjdC5rZXlzKG9iamVjdCk7IGlmIChPYmplY3QuZ2V0T3duUHJvcGVydHlTeW1ib2xzKSB7IHZhciBzeW1ib2xzID0gT2JqZWN0LmdldE93blByb3BlcnR5U3ltYm9scyhvYmplY3QpOyBpZiAoZW51bWVyYWJsZU9ubHkpIHN5bWJvbHMgPSBzeW1ib2xzLmZpbHRlcihmdW5jdGlvbiAoc3ltKSB7IHJldHVybiBPYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yKG9iamVjdCwgc3ltKS5lbnVtZXJhYmxlOyB9KTsga2V5cy5wdXNoLmFwcGx5KGtleXMsIHN5bWJvbHMpOyB9IHJldHVybiBrZXlzOyB9CgpmdW5jdGlvbiBfb2JqZWN0U3ByZWFkKHRhcmdldCkgeyBmb3IgKHZhciBpID0gMTsgaSA8IGFyZ3VtZW50cy5sZW5ndGg7IGkrKykgeyB2YXIgc291cmNlID0gYXJndW1lbnRzW2ldICE9IG51bGwgPyBhcmd1bWVudHNbaV0gOiB7fTsgaWYgKGkgJSAyKSB7IG93bktleXMoT2JqZWN0KHNvdXJjZSksIHRydWUpLmZvckVhY2goZnVuY3Rpb24gKGtleSkgeyBfZGVmaW5lUHJvcGVydHkodGFyZ2V0LCBrZXksIHNvdXJjZVtrZXldKTsgfSk7IH0gZWxzZSBpZiAoT2JqZWN0LmdldE93blByb3BlcnR5RGVzY3JpcHRvcnMpIHsgT2JqZWN0LmRlZmluZVByb3BlcnRpZXModGFyZ2V0LCBPYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9ycyhzb3VyY2UpKTsgfSBlbHNlIHsgb3duS2V5cyhPYmplY3Qoc291cmNlKSkuZm9yRWFjaChmdW5jdGlvbiAoa2V5KSB7IE9iamVjdC5kZWZpbmVQcm9wZXJ0eSh0YXJnZXQsIGtleSwgT2JqZWN0LmdldE93blByb3BlcnR5RGVzY3JpcHRvcihzb3VyY2UsIGtleSkpOyB9KTsgfSB9IHJldHVybiB0YXJnZXQ7IH0KCmltcG9ydCAqIGFzIHRzbGliXzEgZnJvbSAidHNsaWIiOwppbXBvcnQgeyBWdWUsIENvbXBvbmVudCwgUHJvcCwgV2F0Y2ggfSBmcm9tICd2dWUtcHJvcGVydHktZGVjb3JhdG9yJzsKaW1wb3J0IFBpbUFyY2hpdmVzQ2VudGVyU2VydmljZSBmcm9tICdAL3NlcnZpY2UvcGltLWFyY2hpdmVzLWNlbnRlci9waW0tYXJjaGl2ZXMtY2VudGVyLXNlcnZpY2UnOwppbXBvcnQgTWFpblNlcnZpY2UgZnJvbSAnLi9tYWluLWdyaWQtc2VydmljZSc7CmltcG9ydCBDb2RlTGlzdFNlcnZpY2UgZnJvbSAiQHNlcnZpY2UvYXBwL2NvZGVsaXN0LXNlcnZpY2UiOwppbXBvcnQgeyBGb3JtSXRlbU1vZGVsIH0gZnJvbSAnQC9tb2RlbC9mb3JtLWRldGFpbCc7Cgp2YXIgTWFpbkJhc2UgPQovKiNfX1BVUkVfXyovCmZ1bmN0aW9uIChfVnVlKSB7CiAgX2luaGVyaXRzKE1haW5CYXNlLCBfVnVlKTsKCiAgZnVuY3Rpb24gTWFpbkJhc2UoKSB7CiAgICB2YXIgX3RoaXMyOwoKICAgIF9jbGFzc0NhbGxDaGVjayh0aGlzLCBNYWluQmFzZSk7CgogICAgX3RoaXMyID0gX3Bvc3NpYmxlQ29uc3RydWN0b3JSZXR1cm4odGhpcywgX2dldFByb3RvdHlwZU9mKE1haW5CYXNlKS5hcHBseSh0aGlzLCBhcmd1bWVudHMpKTsKICAgIC8qKg0KICAgICAqIOiuoeaVsOWZqOacjeWKoeWvueixoembhuWQiA0KICAgICAqDQogICAgICogQHR5cGUge0FycmF5PCo+fQ0KICAgICAqIEBtZW1iZXJvZiBNYWluQmFzZQ0KICAgICAqLwoKICAgIF90aGlzMi5jb3VudGVyU2VydmljZUFycmF5ID0gW107CiAgICAvKioNCiAgICAgKiDlu7rmnoTpg6jku7bmnI3liqHlr7nosaENCiAgICAgKg0KICAgICAqIEB0eXBlIHtNYWluU2VydmljZX0NCiAgICAgKiBAbWVtYmVyb2YgTWFpbkJhc2UNCiAgICAgKi8KCiAgICBfdGhpczIuc2VydmljZSA9IG5ldyBNYWluU2VydmljZSh7CiAgICAgICRzdG9yZTogX3RoaXMyLiRzdG9yZQogICAgfSk7CiAgICAvKioNCiAgICAgKiDlrp7kvZPmnI3liqHlr7nosaENCiAgICAgKg0KICAgICAqIEB0eXBlIHtQaW1BcmNoaXZlc0NlbnRlclNlcnZpY2V9DQogICAgICogQG1lbWJlcm9mIE1haW5CYXNlDQogICAgICovCgogICAgX3RoaXMyLmFwcEVudGl0eVNlcnZpY2UgPSBuZXcgUGltQXJjaGl2ZXNDZW50ZXJTZXJ2aWNlKHsKICAgICAgJHN0b3JlOiBfdGhpczIuJHN0b3JlCiAgICB9KTsKICAgIC8qKg0KICAgICAqIOS7o+eggeihqOacjeWKoeWvueixoQ0KICAgICAqDQogICAgICogQHR5cGUge0NvZGVMaXN0U2VydmljZX0NCiAgICAgKiBAbWVtYmVyb2YgTWFpbkJhc2UNCiAgICAgKi8KCiAgICBfdGhpczIuY29kZUxpc3RTZXJ2aWNlID0gbmV3IENvZGVMaXN0U2VydmljZSh7CiAgICAgICRzdG9yZTogX3RoaXMyLiRzdG9yZQogICAgfSk7CiAgICAvKioNCiAgICAgKiDlvZPliY3pobUNCiAgICAgKg0KICAgICAqIEB0eXBlIHtudW1iZXJ9DQogICAgICogQG1lbWJlcm9mIE1haW5CYXNlDQogICAgICovCgogICAgX3RoaXMyLmN1clBhZ2UgPSAxOwogICAgLyoqDQogICAgICog5pWw5o2uDQogICAgICoNCiAgICAgKiBAdHlwZSB7YW55W119DQogICAgICogQG1lbWJlcm9mIE1haW5CYXNlDQogICAgICovCgogICAgX3RoaXMyLml0ZW1zID0gW107CiAgICAvKioNCiAgICAgKiDmmK/lkKbmlK/mjIHliIbpobUNCiAgICAgKg0KICAgICAqIEB0eXBlIHtib29sZWFufQ0KICAgICAqIEBtZW1iZXJvZiBNYWluQmFzZQ0KICAgICAqLwoKICAgIF90aGlzMi5pc0VuYWJsZVBhZ2luZ0JhciA9IHRydWU7CiAgICAvKioNCiAgICAgKiDmmK/lkKbnpoHnlKjmjpLluo8NCiAgICAgKg0KICAgICAqIEB0eXBlIHtib29sZWFufQ0KICAgICAqIEBtZW1iZXJvZiBNYWluQmFzZQ0KICAgICAqLwoKICAgIF90aGlzMi5pc05vU29ydCA9IGZhbHNlOwogICAgLyoqDQogICAgICog5o6S5bqP5pa55ZCRDQogICAgICoNCiAgICAgKiBAdHlwZSB7c3RyaW5nfQ0KICAgICAqIEBtZW1iZXJvZiBNYWluQmFzZQ0KICAgICAqLwoKICAgIF90aGlzMi5taW5vclNvcnREaXIgPSAnJzsKICAgIC8qKg0KICAgICAqIOaOkuW6j+Wtl+autQ0KICAgICAqDQogICAgICogQHR5cGUge3N0cmluZ30NCiAgICAgKiBAbWVtYmVyb2YgTWFpbkJhc2UNCiAgICAgKi8KCiAgICBfdGhpczIubWlub3JTb3J0UFNERUYgPSAnJzsKICAgIC8qKg0KICAgICAqIOWIhumhteadoeaVsA0KICAgICAqDQogICAgICogQHR5cGUge251bWJlcn0NCiAgICAgKiBAbWVtYmVyb2YgTWFpbkJhc2UNCiAgICAgKi8KCiAgICBfdGhpczIubGltaXQgPSAyMDsKICAgIC8qKg0KICAgICAqIOaYr+WQpuaYvuekuuagh+mimA0KICAgICAqDQogICAgICogQHR5cGUge2Jvb2xlYW59DQogICAgICogQG1lbWJlcm9mIE1haW5CYXNlDQogICAgICovCgogICAgX3RoaXMyLmlzSGlkZUhlYWRlciA9IGZhbHNlOwogICAgLyoqDQogICAgICog5a6e6ZmF5piv5ZCm5byA5ZCv6KGM57yW6L6RDQogICAgICoNCiAgICAgKiBAdHlwZSB7Ym9vbGVhbn0NCiAgICAgKiBAbWVtYmVyb2YgTWFpbkJhc2UNCiAgICAgKi8KCiAgICBfdGhpczIuYWN0dWFsSXNPcGVuRWRpdCA9IF90aGlzMi5pc09wZW5FZGl0OwogICAgLyoqDQogICAgICog5oC75p2h5pWwDQogICAgICoNCiAgICAgKiBAdHlwZSB7bnVtYmVyfQ0KICAgICAqIEBtZW1iZXJvZiBNYWluQmFzZQ0KICAgICAqLwoKICAgIF90aGlzMi50b3RhbHJvdyA9IDA7CiAgICAvKioNCiAgICAgKiDpgInkuK3ooYzmlbDmja4NCiAgICAgKg0KICAgICAqIEB0eXBlIHthbnlbXX0NCiAgICAgKiBAbWVtYmVyb2YgTWFpbg0KICAgICAqLwoKICAgIF90aGlzMi5zZWxlY3Rpb25zID0gW107CiAgICAvKioNCiAgICAgKiDmi6bmiKrooYzpgInkuK0NCiAgICAgKg0KICAgICAqIEB0eXBlIHtib29sZWFufQ0KICAgICAqIEBtZW1iZXJvZiBNYWluDQogICAgICovCgogICAgX3RoaXMyLnN0b3BSb3dDbGljayA9IGZhbHNlOwogICAgLyoqDQogICAgICog6KGo5qC85piv5ZCm5pi+56S6DQogICAgICoNCiAgICAgKiBAdHlwZSB7Ym9vbGVhbn0NCiAgICAgKiBAbWVtYmVyb2YgTWFpbkJhc2UNCiAgICAgKi8KCiAgICBfdGhpczIuaXNEaXNwbGF5ID0gdHJ1ZTsKICAgIC8qKg0KICAgICog6YCJ6aG55qGG5YiX5a69DQogICAgKg0KICAgICogQHR5cGUge251bWJlcn0NCiAgICAqIEBtZW1iZXJvZiBBcHBJbmRleA0KICAgICovCgogICAgX3RoaXMyLmNoZWNrYm94Q29sV2lkdGggPSAzNDsKICAgIC8qKg0KICAgICAqIOaYr+WQpuWFgeiuuOaLluWKqOWIl+WuvQ0KICAgICAqDQogICAgICogQHR5cGUge2Jvb2xlYW59DQogICAgICogQG1lbWJlcm9mIEFwcEVtYmVkUGlja2VyDQogICAgICovCgogICAgX3RoaXMyLmlzRHJhZ2VuZENvbCA9IGZhbHNlOwogICAgLyoqDQogICAgICog5omA5pyJ5YiX5oiQ5ZGYDQogICAgICoNCiAgICAgKiBAdHlwZSB7YW55W119DQogICAgICogQG1lbWJlcm9mIE1haW5CYXNlDQogICAgICovCgogICAgX3RoaXMyLmFsbENvbHVtbnMgPSBbewogICAgICBuYW1lOiAnc2VyaWFsbm8nLAogICAgICBsYWJlbDogJ+aOkuW6j+WPtycsCiAgICAgIGxhbmd0YWc6ICdlbnRpdGllcy5waW1hcmNoaXZlc2NlbnRlci5tYWluX2dyaWQuY29sdW1ucy5zZXJpYWxubycsCiAgICAgIHNob3c6IHRydWUsCiAgICAgIHV0aWw6ICdQWCcKICAgIH0sIHsKICAgICAgbmFtZTogJ2FyY2hpdmVzY2VudGVybmFtZScsCiAgICAgIGxhYmVsOiAn5qGj5qGI5a6k5ZCN56ewJywKICAgICAgbGFuZ3RhZzogJ2VudGl0aWVzLnBpbWFyY2hpdmVzY2VudGVyLm1haW5fZ3JpZC5jb2x1bW5zLmFyY2hpdmVzY2VudGVybmFtZScsCiAgICAgIHNob3c6IHRydWUsCiAgICAgIHV0aWw6ICdQWCcKICAgIH0sIHsKICAgICAgbmFtZTogJ2NhYmluZXRubycsCiAgICAgIGxhYmVsOiAn5p+c5Y+3JywKICAgICAgbGFuZ3RhZzogJ2VudGl0aWVzLnBpbWFyY2hpdmVzY2VudGVyLm1haW5fZ3JpZC5jb2x1bW5zLmNhYmluZXRubycsCiAgICAgIHNob3c6IHRydWUsCiAgICAgIHV0aWw6ICdQWCcKICAgIH0sIHsKICAgICAgbmFtZTogJ2xheWVybm8nLAogICAgICBsYWJlbDogJ+WxguWPtycsCiAgICAgIGxhbmd0YWc6ICdlbnRpdGllcy5waW1hcmNoaXZlc2NlbnRlci5tYWluX2dyaWQuY29sdW1ucy5sYXllcm5vJywKICAgICAgc2hvdzogdHJ1ZSwKICAgICAgdXRpbDogJ1BYJwogICAgfSwgewogICAgICBuYW1lOiAnYm51bWJlcicsCiAgICAgIGxhYmVsOiAn57yW5Y+3JywKICAgICAgbGFuZ3RhZzogJ2VudGl0aWVzLnBpbWFyY2hpdmVzY2VudGVyLm1haW5fZ3JpZC5jb2x1bW5zLmJudW1iZXInLAogICAgICBzaG93OiB0cnVlLAogICAgICB1dGlsOiAnUFgnCiAgICB9XTsKICAgIC8qKg0KICAgICAqIOihqOagvOaooeWei+mbhuWQiA0KICAgICAqDQogICAgICogQHR5cGUgeyp9DQogICAgICogQG1lbWJlcm9mIE1haW5CYXNlDQogICAgICovCgogICAgX3RoaXMyLmdyaWRJdGVtc01vZGVsID0gW107CiAgICAvKioNCiAgICAgKiDlsZ7mgKflgLzop4TliJkNCiAgICAgKg0KICAgICAqIEB0eXBlIHsqfQ0KICAgICAqIEBtZW1iZXJvZiBNYWluQmFzZQ0KICAgICAqLwoKICAgIF90aGlzMi5ydWxlcyA9IHsKICAgICAgbGF5ZXJubzogW3sKICAgICAgICByZXF1aXJlZDogZmFsc2UsCiAgICAgICAgdmFsaWRhdG9yOiBmdW5jdGlvbiB2YWxpZGF0b3IocnVsZSwgdmFsdWUsIGNhbGxiYWNrKSB7CiAgICAgICAgICByZXR1cm4gcnVsZS5yZXF1aXJlZCAmJiAodmFsdWUgPT09IG51bGwgfHwgdmFsdWUgPT09IHVuZGVmaW5lZCB8fCB2YWx1ZSA9PT0gIiIpID8gZmFsc2UgOiB0cnVlOwogICAgICAgIH0sCiAgICAgICAgbWVzc2FnZTogJ+WxguWPtyDlgLzkuI3og73kuLrnqbonLAogICAgICAgIHRyaWdnZXI6ICdjaGFuZ2UnCiAgICAgIH0sIHsKICAgICAgICByZXF1aXJlZDogZmFsc2UsCiAgICAgICAgdmFsaWRhdG9yOiBmdW5jdGlvbiB2YWxpZGF0b3IocnVsZSwgdmFsdWUsIGNhbGxiYWNrKSB7CiAgICAgICAgICByZXR1cm4gcnVsZS5yZXF1aXJlZCAmJiAodmFsdWUgPT09IG51bGwgfHwgdmFsdWUgPT09IHVuZGVmaW5lZCB8fCB2YWx1ZSA9PT0gIiIpID8gZmFsc2UgOiB0cnVlOwogICAgICAgIH0sCiAgICAgICAgbWVzc2FnZTogJ+WxguWPtyDlgLzkuI3og73kuLrnqbonLAogICAgICAgIHRyaWdnZXI6ICdibHVyJwogICAgICB9XSwKICAgICAgYm51bWJlcjogW3sKICAgICAgICByZXF1aXJlZDogZmFsc2UsCiAgICAgICAgdmFsaWRhdG9yOiBmdW5jdGlvbiB2YWxpZGF0b3IocnVsZSwgdmFsdWUsIGNhbGxiYWNrKSB7CiAgICAgICAgICByZXR1cm4gcnVsZS5yZXF1aXJlZCAmJiAodmFsdWUgPT09IG51bGwgfHwgdmFsdWUgPT09IHVuZGVmaW5lZCB8fCB2YWx1ZSA9PT0gIiIpID8gZmFsc2UgOiB0cnVlOwogICAgICAgIH0sCiAgICAgICAgbWVzc2FnZTogJ+e8luWPtyDlgLzkuI3og73kuLrnqbonLAogICAgICAgIHRyaWdnZXI6ICdjaGFuZ2UnCiAgICAgIH0sIHsKICAgICAgICByZXF1aXJlZDogZmFsc2UsCiAgICAgICAgdmFsaWRhdG9yOiBmdW5jdGlvbiB2YWxpZGF0b3IocnVsZSwgdmFsdWUsIGNhbGxiYWNrKSB7CiAgICAgICAgICByZXR1cm4gcnVsZS5yZXF1aXJlZCAmJiAodmFsdWUgPT09IG51bGwgfHwgdmFsdWUgPT09IHVuZGVmaW5lZCB8fCB2YWx1ZSA9PT0gIiIpID8gZmFsc2UgOiB0cnVlOwogICAgICAgIH0sCiAgICAgICAgbWVzc2FnZTogJ+e8luWPtyDlgLzkuI3og73kuLrnqbonLAogICAgICAgIHRyaWdnZXI6ICdibHVyJwogICAgICB9XSwKICAgICAgYXJjaGl2ZXNjZW50ZXJuYW1lOiBbewogICAgICAgIHJlcXVpcmVkOiBmYWxzZSwKICAgICAgICB2YWxpZGF0b3I6IGZ1bmN0aW9uIHZhbGlkYXRvcihydWxlLCB2YWx1ZSwgY2FsbGJhY2spIHsKICAgICAgICAgIHJldHVybiBydWxlLnJlcXVpcmVkICYmICh2YWx1ZSA9PT0gbnVsbCB8fCB2YWx1ZSA9PT0gdW5kZWZpbmVkIHx8IHZhbHVlID09PSAiIikgPyBmYWxzZSA6IHRydWU7CiAgICAgICAgfSwKICAgICAgICBtZXNzYWdlOiAn5qGj5qGI5a6k5ZCN56ewIOWAvOS4jeiDveS4uuepuicsCiAgICAgICAgdHJpZ2dlcjogJ2NoYW5nZScKICAgICAgfSwgewogICAgICAgIHJlcXVpcmVkOiBmYWxzZSwKICAgICAgICB2YWxpZGF0b3I6IGZ1bmN0aW9uIHZhbGlkYXRvcihydWxlLCB2YWx1ZSwgY2FsbGJhY2spIHsKICAgICAgICAgIHJldHVybiBydWxlLnJlcXVpcmVkICYmICh2YWx1ZSA9PT0gbnVsbCB8fCB2YWx1ZSA9PT0gdW5kZWZpbmVkIHx8IHZhbHVlID09PSAiIikgPyBmYWxzZSA6IHRydWU7CiAgICAgICAgfSwKICAgICAgICBtZXNzYWdlOiAn5qGj5qGI5a6k5ZCN56ewIOWAvOS4jeiDveS4uuepuicsCiAgICAgICAgdHJpZ2dlcjogJ2JsdXInCiAgICAgIH1dLAogICAgICBzcmZrZXk6IFt7CiAgICAgICAgcmVxdWlyZWQ6IGZhbHNlLAogICAgICAgIHZhbGlkYXRvcjogZnVuY3Rpb24gdmFsaWRhdG9yKHJ1bGUsIHZhbHVlLCBjYWxsYmFjaykgewogICAgICAgICAgcmV0dXJuIHJ1bGUucmVxdWlyZWQgJiYgKHZhbHVlID09PSBudWxsIHx8IHZhbHVlID09PSB1bmRlZmluZWQgfHwgdmFsdWUgPT09ICIiKSA/IGZhbHNlIDogdHJ1ZTsKICAgICAgICB9LAogICAgICAgIG1lc3NhZ2U6ICfmoaPmoYjlrqTnrqHnkIbmoIfor4Yg5YC85LiN6IO95Li656m6JywKICAgICAgICB0cmlnZ2VyOiAnY2hhbmdlJwogICAgICB9LCB7CiAgICAgICAgcmVxdWlyZWQ6IGZhbHNlLAogICAgICAgIHZhbGlkYXRvcjogZnVuY3Rpb24gdmFsaWRhdG9yKHJ1bGUsIHZhbHVlLCBjYWxsYmFjaykgewogICAgICAgICAgcmV0dXJuIHJ1bGUucmVxdWlyZWQgJiYgKHZhbHVlID09PSBudWxsIHx8IHZhbHVlID09PSB1bmRlZmluZWQgfHwgdmFsdWUgPT09ICIiKSA/IGZhbHNlIDogdHJ1ZTsKICAgICAgICB9LAogICAgICAgIG1lc3NhZ2U6ICfmoaPmoYjlrqTnrqHnkIbmoIfor4Yg5YC85LiN6IO95Li656m6JywKICAgICAgICB0cmlnZ2VyOiAnYmx1cicKICAgICAgfV0sCiAgICAgIGNhYmluZXRubzogW3sKICAgICAgICByZXF1aXJlZDogZmFsc2UsCiAgICAgICAgdmFsaWRhdG9yOiBmdW5jdGlvbiB2YWxpZGF0b3IocnVsZSwgdmFsdWUsIGNhbGxiYWNrKSB7CiAgICAgICAgICByZXR1cm4gcnVsZS5yZXF1aXJlZCAmJiAodmFsdWUgPT09IG51bGwgfHwgdmFsdWUgPT09IHVuZGVmaW5lZCB8fCB2YWx1ZSA9PT0gIiIpID8gZmFsc2UgOiB0cnVlOwogICAgICAgIH0sCiAgICAgICAgbWVzc2FnZTogJ+afnOWPtyDlgLzkuI3og73kuLrnqbonLAogICAgICAgIHRyaWdnZXI6ICdjaGFuZ2UnCiAgICAgIH0sIHsKICAgICAgICByZXF1aXJlZDogZmFsc2UsCiAgICAgICAgdmFsaWRhdG9yOiBmdW5jdGlvbiB2YWxpZGF0b3IocnVsZSwgdmFsdWUsIGNhbGxiYWNrKSB7CiAgICAgICAgICByZXR1cm4gcnVsZS5yZXF1aXJlZCAmJiAodmFsdWUgPT09IG51bGwgfHwgdmFsdWUgPT09IHVuZGVmaW5lZCB8fCB2YWx1ZSA9PT0gIiIpID8gZmFsc2UgOiB0cnVlOwogICAgICAgIH0sCiAgICAgICAgbWVzc2FnZTogJ+afnOWPtyDlgLzkuI3og73kuLrnqbonLAogICAgICAgIHRyaWdnZXI6ICdibHVyJwogICAgICB9XSwKICAgICAgc2VyaWFsbm86IFt7CiAgICAgICAgcmVxdWlyZWQ6IGZhbHNlLAogICAgICAgIHZhbGlkYXRvcjogZnVuY3Rpb24gdmFsaWRhdG9yKHJ1bGUsIHZhbHVlLCBjYWxsYmFjaykgewogICAgICAgICAgcmV0dXJuIHJ1bGUucmVxdWlyZWQgJiYgKHZhbHVlID09PSBudWxsIHx8IHZhbHVlID09PSB1bmRlZmluZWQgfHwgdmFsdWUgPT09ICIiKSA/IGZhbHNlIDogdHJ1ZTsKICAgICAgICB9LAogICAgICAgIG1lc3NhZ2U6ICfmjpLluo/lj7cg5YC85LiN6IO95Li656m6JywKICAgICAgICB0cmlnZ2VyOiAnY2hhbmdlJwogICAgICB9LCB7CiAgICAgICAgcmVxdWlyZWQ6IGZhbHNlLAogICAgICAgIHZhbGlkYXRvcjogZnVuY3Rpb24gdmFsaWRhdG9yKHJ1bGUsIHZhbHVlLCBjYWxsYmFjaykgewogICAgICAgICAgcmV0dXJuIHJ1bGUucmVxdWlyZWQgJiYgKHZhbHVlID09PSBudWxsIHx8IHZhbHVlID09PSB1bmRlZmluZWQgfHwgdmFsdWUgPT09ICIiKSA/IGZhbHNlIDogdHJ1ZTsKICAgICAgICB9LAogICAgICAgIG1lc3NhZ2U6ICfmjpLluo/lj7cg5YC85LiN6IO95Li656m6JywKICAgICAgICB0cmlnZ2VyOiAnYmx1cicKICAgICAgfV0KICAgIH07CiAgICByZXR1cm4gX3RoaXMyOwogIH0KICAvKioNCiAgICog6I635Y+W6YOo5Lu257G75Z6LDQogICAqDQogICAqIEByZXR1cm5zIHtzdHJpbmd9DQogICAqIEBtZW1iZXJvZiBNYWluQmFzZQ0KICAgKi8KCgogIF9jcmVhdGVDbGFzcyhNYWluQmFzZSwgW3sKICAgIGtleTogImdldENvbnRyb2xUeXBlIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBnZXRDb250cm9sVHlwZSgpIHsKICAgICAgcmV0dXJuICdHUklEJzsKICAgIH0KICAgIC8qKg0KICAgICAqIOWFs+mXreinhuWbvg0KICAgICAqDQogICAgICogQHBhcmFtIHthbnl9IGFyZ3MNCiAgICAgKiBAbWVtYmVyb2YgTWFpbkJhc2UNCiAgICAgKi8KCiAgfSwgewogICAga2V5OiAiY2xvc2VWaWV3IiwKICAgIHZhbHVlOiBmdW5jdGlvbiBjbG9zZVZpZXcoYXJncykgewogICAgICB2YXIgX3RoaXMgPSB0aGlzOwoKICAgICAgX3RoaXMuJGVtaXQoJ2Nsb3NldmlldycsIFthcmdzXSk7CiAgICB9CiAgICAvKioNCiAgICAgKiAg6K6h5pWw5Zmo5Yi35pawDQogICAgICoNCiAgICAgKiBAbWVtYmVyb2YgTWFpbkJhc2UNCiAgICAgKi8KCiAgfSwgewogICAga2V5OiAiY291bnRlclJlZnJlc2giLAogICAgdmFsdWU6IGZ1bmN0aW9uIGNvdW50ZXJSZWZyZXNoKCkgewogICAgICB2YXIgX3RoaXMgPSB0aGlzOwoKICAgICAgaWYgKF90aGlzLmNvdW50ZXJTZXJ2aWNlQXJyYXkgJiYgX3RoaXMuY291bnRlclNlcnZpY2VBcnJheS5sZW5ndGggPiAwKSB7CiAgICAgICAgX3RoaXMuY291bnRlclNlcnZpY2VBcnJheS5mb3JFYWNoKGZ1bmN0aW9uIChpdGVtKSB7CiAgICAgICAgICBpZiAoaXRlbS5yZWZyZXNoRGF0YSAmJiBpdGVtLnJlZnJlc2hEYXRhIGluc3RhbmNlb2YgRnVuY3Rpb24pIHsKICAgICAgICAgICAgaXRlbS5yZWZyZXNoRGF0YSgpOwogICAgICAgICAgfQogICAgICAgIH0pOwogICAgICB9CiAgICB9CiAgICAvKioNCiAgICAgKiDojrflj5blpJrpobnmlbDmja4NCiAgICAgKg0KICAgICAqIEByZXR1cm5zIHthbnlbXX0NCiAgICAgKiBAbWVtYmVyb2YgTWFpbkJhc2UNCiAgICAgKi8KCiAgfSwgewogICAga2V5OiAiZ2V0RGF0YXMiLAogICAgdmFsdWU6IGZ1bmN0aW9uIGdldERhdGFzKCkgewogICAgICByZXR1cm4gdGhpcy5zZWxlY3Rpb25zOwogICAgfQogICAgLyoqDQogICAgICog6I635Y+W5Y2V6aG55qCRDQogICAgICoNCiAgICAgKiBAcmV0dXJucyB7Kn0NCiAgICAgKiBAbWVtYmVyb2YgTWFpbkJhc2UNCiAgICAgKi8KCiAgfSwgewogICAga2V5OiAiZ2V0RGF0YSIsCiAgICB2YWx1ZTogZnVuY3Rpb24gZ2V0RGF0YSgpIHsKICAgICAgcmV0dXJuIHRoaXMuc2VsZWN0aW9uc1swXTsKICAgIH0KICAgIC8qKg0KICAgICAqIOmAieS4reWAvOWPmOWMlg0KICAgICAqDQogICAgICogQHBhcmFtIHsqfSBuZXdWYWwNCiAgICAgKiBAcGFyYW0geyp9IG9sZFZhbA0KICAgICAqIEBtZW1iZXJvZiBNYWluQmFzZQ0KICAgICAqLwoKICB9LCB7CiAgICBrZXk6ICJvblZhbHVlQ2hhbmdlIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBvblZhbHVlQ2hhbmdlKG5ld1ZhbCwgb2xkVmFsKSB7CiAgICAgIHZhciBfdGhpczMgPSB0aGlzOwoKICAgICAgdGhpcy5zZWxlY3Rpb25zID0gW107CgogICAgICBpZiAodGhpcy5zZWxlY3RlZERhdGEpIHsKICAgICAgICB2YXIgcmVmcyA9IHRoaXMuJHJlZnM7CgogICAgICAgIGlmIChyZWZzLm11bHRpcGxlVGFibGUpIHsKICAgICAgICAgIHJlZnMubXVsdGlwbGVUYWJsZS5jbGVhclNlbGVjdGlvbigpOwogICAgICAgICAgSlNPTi5wYXJzZSh0aGlzLnNlbGVjdGVkRGF0YSkuZm9yRWFjaChmdW5jdGlvbiAoc2VsZWN0aW9uKSB7CiAgICAgICAgICAgIHZhciBzZWxlY3RlZEl0ZW0gPSBfdGhpczMuaXRlbXMuZmluZChmdW5jdGlvbiAoaXRlbSkgewogICAgICAgICAgICAgIHJldHVybiBPYmplY3QuaXMoaXRlbS5zcmZrZXksIHNlbGVjdGlvbi5zcmZrZXkpOwogICAgICAgICAgICB9KTsKCiAgICAgICAgICAgIGlmIChzZWxlY3RlZEl0ZW0pIHsKICAgICAgICAgICAgICBfdGhpczMucm93Q2xpY2soc2VsZWN0ZWRJdGVtKTsKICAgICAgICAgICAgfQogICAgICAgICAgfSk7CiAgICAgICAgfQogICAgICB9CiAgICB9CiAgICAvKioNCiAgICAgKiDpg6jku7bliLfmlrANCiAgICAgKg0KICAgICAqIEBwYXJhbSB7YW55W119IGFyZ3MNCiAgICAgKiBAbWVtYmVyb2YgTWFpbkJhc2UNCiAgICAgKi8KCiAgfSwgewogICAga2V5OiAicmVmcmVzaCIsCiAgICB2YWx1ZTogZnVuY3Rpb24gcmVmcmVzaChhcmdzKSB7CiAgICAgIHRoaXMubG9hZCgpOwogICAgfQogICAgLyoqDQogICAgICog6I635Y+W6KGo5qC86KGM5qih5Z6LDQogICAgICoNCiAgICAgKiBAdHlwZSB7Kn0NCiAgICAgKiBAbWVtYmVyb2YgTWFpbkJhc2UNCiAgICAgKi8KCiAgfSwgewogICAga2V5OiAiZ2V0R3JpZFJvd01vZGVsIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBnZXRHcmlkUm93TW9kZWwoKSB7CiAgICAgIHJldHVybiB7CiAgICAgICAgbGF5ZXJubzogbmV3IEZvcm1JdGVtTW9kZWwoKSwKICAgICAgICBibnVtYmVyOiBuZXcgRm9ybUl0ZW1Nb2RlbCgpLAogICAgICAgIGFyY2hpdmVzY2VudGVybmFtZTogbmV3IEZvcm1JdGVtTW9kZWwoKSwKICAgICAgICBzcmZrZXk6IG5ldyBGb3JtSXRlbU1vZGVsKCksCiAgICAgICAgY2FiaW5ldG5vOiBuZXcgRm9ybUl0ZW1Nb2RlbCgpLAogICAgICAgIHNlcmlhbG5vOiBuZXcgRm9ybUl0ZW1Nb2RlbCgpCiAgICAgIH07CiAgICB9CiAgICAvKioNCiAgICAgKiDooajmoLzooYznvJbovpHpobnmoKHpqowNCiAgICAgKg0KICAgICAqIEBwYXJhbSB7c3RyaW5nfSBwcm9wZXJ0eSDlsZ7mgKflkI0NCiAgICAgKiBAcGFyYW0geyp9IGRhdGEg6KGM5pWw5o2uDQogICAgICogQHBhcmFtIHtudW1iZXJ9IHJvd0luZGV4IOihjOe0ouW8lQ0KICAgICAqIEByZXR1cm5zIFByb21pc2U8YW55Pg0KICAgICAqDQogICAgICogQG1lbWJlcm9mIE1haW5CYXNlDQogICAgICovCgogIH0sIHsKICAgIGtleTogInZhbGlkYXRlIiwKICAgIHZhbHVlOiBmdW5jdGlvbiB2YWxpZGF0ZShwcm9wZXJ0eSwgZGF0YSwgcm93SW5kZXgpIHsKICAgICAgdmFyIF90aGlzNCA9IHRoaXM7CgogICAgICByZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24gKHJlc29sdmUsIHJlamVjdCkgewogICAgICAgIF90aGlzNC4kdXRpbC52YWxpZGF0ZUl0ZW0ocHJvcGVydHksIGRhdGEsIF90aGlzNC5ydWxlcykudGhlbihmdW5jdGlvbiAoKSB7CiAgICAgICAgICBfdGhpczQuZ3JpZEl0ZW1zTW9kZWxbcm93SW5kZXhdW3Byb3BlcnR5XS5zZXRFcnJvcihudWxsKTsKCiAgICAgICAgICByZXNvbHZlKHRydWUpOwogICAgICAgIH0pWyJjYXRjaCJdKGZ1bmN0aW9uIChfcmVmKSB7CiAgICAgICAgICB2YXIgZXJyb3JzID0gX3JlZi5lcnJvcnMsCiAgICAgICAgICAgICAgZmllbGRzID0gX3JlZi5maWVsZHM7CgogICAgICAgICAgX3RoaXM0LmdyaWRJdGVtc01vZGVsW3Jvd0luZGV4XVtwcm9wZXJ0eV0uc2V0RXJyb3IoZXJyb3JzWzBdLm1lc3NhZ2UpOwoKICAgICAgICAgIHJlc29sdmUoZmFsc2UpOwogICAgICAgIH0pOwogICAgICB9KTsKICAgIH0KICAgIC8qKg0KICAgICAqIOagoemqjOaJgOacieS/ruaUuei/h+eahOe8lui+kemhuQ0KICAgICAqDQogICAgICogQHJldHVybnMgUHJvbWlzZTxhbnk+DQogICAgICogQG1lbWJlcm9mIE1haW5CYXNlDQogICAgICovCgogIH0sIHsKICAgIGtleTogInZhbGlkYXRlQWxsIiwKICAgIHZhbHVlOiBmdW5jdGlvbiAoKSB7CiAgICAgIHZhciBfdmFsaWRhdGVBbGwgPSBfYXN5bmNUb0dlbmVyYXRvcigKICAgICAgLyojX19QVVJFX18qLwogICAgICByZWdlbmVyYXRvclJ1bnRpbWUubWFyayhmdW5jdGlvbiBfY2FsbGVlKCkgewogICAgICAgIHZhciB2YWxpZGF0ZVN0YXRlLCBpbmRleCwgX2l0ZXJhdG9yTm9ybWFsQ29tcGxldGlvbiwgX2RpZEl0ZXJhdG9yRXJyb3IsIF9pdGVyYXRvckVycm9yLCBfaXRlcmF0b3IsIF9zdGVwLCBpdGVtLCBfaSwgX09iamVjdCRrZXlzLCBwcm9wZXJ0eTsKCiAgICAgICAgcmV0dXJuIHJlZ2VuZXJhdG9yUnVudGltZS53cmFwKGZ1bmN0aW9uIF9jYWxsZWUkKF9jb250ZXh0KSB7CiAgICAgICAgICB3aGlsZSAoMSkgewogICAgICAgICAgICBzd2l0Y2ggKF9jb250ZXh0LnByZXYgPSBfY29udGV4dC5uZXh0KSB7CiAgICAgICAgICAgICAgY2FzZSAwOgogICAgICAgICAgICAgICAgdmFsaWRhdGVTdGF0ZSA9IHRydWU7CiAgICAgICAgICAgICAgICBpbmRleCA9IC0xOwogICAgICAgICAgICAgICAgX2l0ZXJhdG9yTm9ybWFsQ29tcGxldGlvbiA9IHRydWU7CiAgICAgICAgICAgICAgICBfZGlkSXRlcmF0b3JFcnJvciA9IGZhbHNlOwogICAgICAgICAgICAgICAgX2l0ZXJhdG9yRXJyb3IgPSB1bmRlZmluZWQ7CiAgICAgICAgICAgICAgICBfY29udGV4dC5wcmV2ID0gNTsKICAgICAgICAgICAgICAgIF9pdGVyYXRvciA9IHRoaXMuaXRlbXNbU3ltYm9sLml0ZXJhdG9yXSgpOwoKICAgICAgICAgICAgICBjYXNlIDc6CiAgICAgICAgICAgICAgICBpZiAoX2l0ZXJhdG9yTm9ybWFsQ29tcGxldGlvbiA9IChfc3RlcCA9IF9pdGVyYXRvci5uZXh0KCkpLmRvbmUpIHsKICAgICAgICAgICAgICAgICAgX2NvbnRleHQubmV4dCA9IDI0OwogICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBpdGVtID0gX3N0ZXAudmFsdWU7CiAgICAgICAgICAgICAgICBpbmRleCsrOwoKICAgICAgICAgICAgICAgIGlmICghKGl0ZW0ucm93RGF0YVN0YXRlID09PSAiY3JlYXRlIiB8fCBpdGVtLnJvd0RhdGFTdGF0ZSA9PT0gInVwZGF0ZSIpKSB7CiAgICAgICAgICAgICAgICAgIF9jb250ZXh0Lm5leHQgPSAyMTsKICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgX2kgPSAwLCBfT2JqZWN0JGtleXMgPSBPYmplY3Qua2V5cyh0aGlzLnJ1bGVzKTsKCiAgICAgICAgICAgICAgY2FzZSAxMjoKICAgICAgICAgICAgICAgIGlmICghKF9pIDwgX09iamVjdCRrZXlzLmxlbmd0aCkpIHsKICAgICAgICAgICAgICAgICAgX2NvbnRleHQubmV4dCA9IDIxOwogICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBwcm9wZXJ0eSA9IF9PYmplY3Qka2V5c1tfaV07CiAgICAgICAgICAgICAgICBfY29udGV4dC5uZXh0ID0gMTY7CiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy52YWxpZGF0ZShwcm9wZXJ0eSwgaXRlbSwgaW5kZXgpOwoKICAgICAgICAgICAgICBjYXNlIDE2OgogICAgICAgICAgICAgICAgaWYgKF9jb250ZXh0LnNlbnQpIHsKICAgICAgICAgICAgICAgICAgX2NvbnRleHQubmV4dCA9IDE4OwogICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICB2YWxpZGF0ZVN0YXRlID0gZmFsc2U7CgogICAgICAgICAgICAgIGNhc2UgMTg6CiAgICAgICAgICAgICAgICBfaSsrOwogICAgICAgICAgICAgICAgX2NvbnRleHQubmV4dCA9IDEyOwogICAgICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgICAgIGNhc2UgMjE6CiAgICAgICAgICAgICAgICBfaXRlcmF0b3JOb3JtYWxDb21wbGV0aW9uID0gdHJ1ZTsKICAgICAgICAgICAgICAgIF9jb250ZXh0Lm5leHQgPSA3OwogICAgICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgICAgIGNhc2UgMjQ6CiAgICAgICAgICAgICAgICBfY29udGV4dC5uZXh0ID0gMzA7CiAgICAgICAgICAgICAgICBicmVhazsKCiAgICAgICAgICAgICAgY2FzZSAyNjoKICAgICAgICAgICAgICAgIF9jb250ZXh0LnByZXYgPSAyNjsKICAgICAgICAgICAgICAgIF9jb250ZXh0LnQwID0gX2NvbnRleHRbImNhdGNoIl0oNSk7CiAgICAgICAgICAgICAgICBfZGlkSXRlcmF0b3JFcnJvciA9IHRydWU7CiAgICAgICAgICAgICAgICBfaXRlcmF0b3JFcnJvciA9IF9jb250ZXh0LnQwOwoKICAgICAgICAgICAgICBjYXNlIDMwOgogICAgICAgICAgICAgICAgX2NvbnRleHQucHJldiA9IDMwOwogICAgICAgICAgICAgICAgX2NvbnRleHQucHJldiA9IDMxOwoKICAgICAgICAgICAgICAgIGlmICghX2l0ZXJhdG9yTm9ybWFsQ29tcGxldGlvbiAmJiBfaXRlcmF0b3JbInJldHVybiJdICE9IG51bGwpIHsKICAgICAgICAgICAgICAgICAgX2l0ZXJhdG9yWyJyZXR1cm4iXSgpOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICBjYXNlIDMzOgogICAgICAgICAgICAgICAgX2NvbnRleHQucHJldiA9IDMzOwoKICAgICAgICAgICAgICAgIGlmICghX2RpZEl0ZXJhdG9yRXJyb3IpIHsKICAgICAgICAgICAgICAgICAgX2NvbnRleHQubmV4dCA9IDM2OwogICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICB0aHJvdyBfaXRlcmF0b3JFcnJvcjsKCiAgICAgICAgICAgICAgY2FzZSAzNjoKICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dC5maW5pc2goMzMpOwoKICAgICAgICAgICAgICBjYXNlIDM3OgogICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0LmZpbmlzaCgzMCk7CgogICAgICAgICAgICAgIGNhc2UgMzg6CiAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQuYWJydXB0KCJyZXR1cm4iLCB2YWxpZGF0ZVN0YXRlKTsKCiAgICAgICAgICAgICAgY2FzZSAzOToKICAgICAgICAgICAgICBjYXNlICJlbmQiOgogICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0LnN0b3AoKTsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0sIF9jYWxsZWUsIHRoaXMsIFtbNSwgMjYsIDMwLCAzOF0sIFszMSwsIDMzLCAzN11dKTsKICAgICAgfSkpOwoKICAgICAgZnVuY3Rpb24gdmFsaWRhdGVBbGwoKSB7CiAgICAgICAgcmV0dXJuIF92YWxpZGF0ZUFsbC5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwogICAgICB9CgogICAgICByZXR1cm4gdmFsaWRhdGVBbGw7CiAgICB9KCkKICAgIC8qKg0KICAgICAqIOihqOagvOaVsOaNruWKoOi9vQ0KICAgICAqDQogICAgICogQHBhcmFtIHsqfSBbYXJnPXt9XQ0KICAgICAqIEBtZW1iZXJvZiBNYWluQmFzZQ0KICAgICAqLwoKICB9LCB7CiAgICBrZXk6ICJsb2FkIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBsb2FkKCkgewogICAgICB2YXIgX3RoaXM1ID0gdGhpczsKCiAgICAgIHZhciBvcHQgPSBhcmd1bWVudHMubGVuZ3RoID4gMCAmJiBhcmd1bWVudHNbMF0gIT09IHVuZGVmaW5lZCA/IGFyZ3VtZW50c1swXSA6IHt9OwogICAgICB2YXIgcGFnZVJlc2V0ID0gYXJndW1lbnRzLmxlbmd0aCA+IDEgJiYgYXJndW1lbnRzWzFdICE9PSB1bmRlZmluZWQgPyBhcmd1bWVudHNbMV0gOiBmYWxzZTsKCiAgICAgIGlmICghdGhpcy5mZXRjaEFjdGlvbikgewogICAgICAgIHRoaXMuJE5vdGljZS5lcnJvcih7CiAgICAgICAgICB0aXRsZTogJ+mUmeivrycsCiAgICAgICAgICBkZXNjOiAnQVJDSElWRVNDRU5URVJHcmlkVmlld+inhuWbvuihqOagvGZldGNoQWN0aW9u5Y+C5pWw5pyq6YWN572uJwogICAgICAgIH0pOwogICAgICAgIHJldHVybjsKICAgICAgfQoKICAgICAgaWYgKHBhZ2VSZXNldCkgewogICAgICAgIHRoaXMuY3VyUGFnZSA9IDE7CiAgICAgIH0KCiAgICAgIHZhciBhcmcgPSBfb2JqZWN0U3ByZWFkKHt9LCBvcHQpOwoKICAgICAgdmFyIHBhZ2UgPSB7fTsKCiAgICAgIGlmICh0aGlzLmlzRW5hYmxlUGFnaW5nQmFyKSB7CiAgICAgICAgT2JqZWN0LmFzc2lnbihwYWdlLCB7CiAgICAgICAgICBwYWdlOiB0aGlzLmN1clBhZ2UgLSAxLAogICAgICAgICAgc2l6ZTogdGhpcy5saW1pdAogICAgICAgIH0pOwogICAgICB9IC8vIOiuvue9ruaOkuW6jwoKCiAgICAgIGlmICghdGhpcy5pc05vU29ydCAmJiAhT2JqZWN0LmlzKHRoaXMubWlub3JTb3J0RGlyLCAnJykgJiYgIU9iamVjdC5pcyh0aGlzLm1pbm9yU29ydFBTREVGLCAnJykpIHsKICAgICAgICB2YXIgc29ydCA9IHRoaXMubWlub3JTb3J0UFNERUYgKyAiLCIgKyB0aGlzLm1pbm9yU29ydERpcjsKICAgICAgICBPYmplY3QuYXNzaWduKHBhZ2UsIHsKICAgICAgICAgIHNvcnQ6IHNvcnQKICAgICAgICB9KTsKICAgICAgfQoKICAgICAgT2JqZWN0LmFzc2lnbihhcmcsIHBhZ2UpOwogICAgICB2YXIgcGFyZW50ZGF0YSA9IHt9OwogICAgICB0aGlzLiRlbWl0KCdiZWZvcmVsb2FkJywgcGFyZW50ZGF0YSk7CiAgICAgIE9iamVjdC5hc3NpZ24oYXJnLCBwYXJlbnRkYXRhKTsKICAgICAgdmFyIHRlbXBWaWV3UGFyYW1zID0gcGFyZW50ZGF0YS52aWV3cGFyYW1zID8gcGFyZW50ZGF0YS52aWV3cGFyYW1zIDoge307CiAgICAgIE9iamVjdC5hc3NpZ24odGVtcFZpZXdQYXJhbXMsIEpTT04ucGFyc2UoSlNPTi5zdHJpbmdpZnkodGhpcy52aWV3cGFyYW1zKSkpOwogICAgICBPYmplY3QuYXNzaWduKGFyZywgewogICAgICAgIHZpZXdwYXJhbXM6IHRlbXBWaWV3UGFyYW1zCiAgICAgIH0pOwogICAgICB2YXIgcG9zdCA9IHRoaXMuc2VydmljZS5zZWFyY2godGhpcy5mZXRjaEFjdGlvbiwgSlNPTi5wYXJzZShKU09OLnN0cmluZ2lmeSh0aGlzLmNvbnRleHQpKSwgYXJnLCB0aGlzLnNob3dCdXN5SW5kaWNhdG9yKTsKICAgICAgcG9zdC50aGVuKGZ1bmN0aW9uIChyZXNwb25zZSkgewogICAgICAgIGlmICghcmVzcG9uc2Uuc3RhdHVzIHx8IHJlc3BvbnNlLnN0YXR1cyAhPT0gMjAwKSB7CiAgICAgICAgICBpZiAocmVzcG9uc2UuZXJyb3JNZXNzYWdlKSB7CiAgICAgICAgICAgIF90aGlzNS4kTm90aWNlLmVycm9yKHsKICAgICAgICAgICAgICB0aXRsZTogJ+mUmeivrycsCiAgICAgICAgICAgICAgZGVzYzogcmVzcG9uc2UuZXJyb3JNZXNzYWdlCiAgICAgICAgICAgIH0pOwogICAgICAgICAgfQoKICAgICAgICAgIHJldHVybjsKICAgICAgICB9CgogICAgICAgIHZhciBkYXRhID0gcmVzcG9uc2UuZGF0YTsKICAgICAgICBfdGhpczUudG90YWxyb3cgPSByZXNwb25zZS50b3RhbDsKICAgICAgICBfdGhpczUuaXRlbXMgPSBKU09OLnBhcnNlKEpTT04uc3RyaW5naWZ5KGRhdGEpKTsgLy8g5riF56m6c2VsZWN0aW9ucyxncmlkSXRlbXNNb2RlbAoKICAgICAgICBfdGhpczUuc2VsZWN0aW9ucyA9IFtdOwogICAgICAgIF90aGlzNS5ncmlkSXRlbXNNb2RlbCA9IFtdOwoKICAgICAgICBfdGhpczUuaXRlbXMuZm9yRWFjaChmdW5jdGlvbiAoKSB7CiAgICAgICAgICBfdGhpczUuZ3JpZEl0ZW1zTW9kZWwucHVzaChfdGhpczUuZ2V0R3JpZFJvd01vZGVsKCkpOwogICAgICAgIH0pOwoKICAgICAgICBfdGhpczUuJGVtaXQoJ2xvYWQnLCBfdGhpczUuaXRlbXMpOyAvLyDorr7nva7pu5jorqTpgInkuK0KCgogICAgICAgIHZhciBfdGhpcyA9IF90aGlzNTsKICAgICAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHsKICAgICAgICAgIGlmIChfdGhpcy5pc1NlbGVjdEZpcnN0RGVmYXVsdCkgewogICAgICAgICAgICBfdGhpcy5yb3dDbGljayhfdGhpcy5pdGVtc1swXSk7CiAgICAgICAgICB9CgogICAgICAgICAgaWYgKF90aGlzLnNlbGVjdGVkRGF0YSkgewogICAgICAgICAgICB2YXIgcmVmcyA9IF90aGlzLiRyZWZzOwoKICAgICAgICAgICAgaWYgKHJlZnMubXVsdGlwbGVUYWJsZSkgewogICAgICAgICAgICAgIHJlZnMubXVsdGlwbGVUYWJsZS5jbGVhclNlbGVjdGlvbigpOwogICAgICAgICAgICAgIEpTT04ucGFyc2UoX3RoaXMuc2VsZWN0ZWREYXRhKS5mb3JFYWNoKGZ1bmN0aW9uIChzZWxlY3Rpb24pIHsKICAgICAgICAgICAgICAgIHZhciBzZWxlY3RlZEl0ZW0gPSBfdGhpcy5pdGVtcy5maW5kKGZ1bmN0aW9uIChpdGVtKSB7CiAgICAgICAgICAgICAgICAgIHJldHVybiBPYmplY3QuaXMoaXRlbS5zcmZrZXksIHNlbGVjdGlvbi5zcmZrZXkpOwogICAgICAgICAgICAgICAgfSk7CgogICAgICAgICAgICAgICAgaWYgKHNlbGVjdGVkSXRlbSkgewogICAgICAgICAgICAgICAgICBfdGhpcy5yb3dDbGljayhzZWxlY3RlZEl0ZW0pOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSwgMzAwKTsKICAgICAgfSlbImNhdGNoIl0oZnVuY3Rpb24gKHJlc3BvbnNlKSB7CiAgICAgICAgaWYgKHJlc3BvbnNlICYmIHJlc3BvbnNlLnN0YXR1cyA9PT0gNDAxKSB7CiAgICAgICAgICByZXR1cm47CiAgICAgICAgfQoKICAgICAgICBfdGhpczUuJE5vdGljZS5lcnJvcih7CiAgICAgICAgICB0aXRsZTogJ+mUmeivrycsCiAgICAgICAgICBkZXNjOiByZXNwb25zZS5lcnJvck1lc3NhZ2UKICAgICAgICB9KTsKICAgICAgfSk7CiAgICB9CiAgICAvKioNCiAgICAgKiDliKDpmaQNCiAgICAgKg0KICAgICAqIEBwYXJhbSB7YW55W119IGRhdGFzDQogICAgICogQHJldHVybnMge1Byb21pc2U8YW55Pn0NCiAgICAgKiBAbWVtYmVyb2YgTWFpbkJhc2UNCiAgICAgKi8KCiAgfSwgewogICAga2V5OiAicmVtb3ZlIiwKICAgIHZhbHVlOiBmdW5jdGlvbiAoKSB7CiAgICAgIHZhciBfcmVtb3ZlID0gX2FzeW5jVG9HZW5lcmF0b3IoCiAgICAgIC8qI19fUFVSRV9fKi8KICAgICAgcmVnZW5lcmF0b3JSdW50aW1lLm1hcmsoZnVuY3Rpb24gX2NhbGxlZTIoZGF0YXMpIHsKICAgICAgICB2YXIgX3RoaXM2ID0gdGhpczsKCiAgICAgICAgdmFyIF9kYXRhcywgZGF0YUluZm8sIHJlbW92ZURhdGE7CgogICAgICAgIHJldHVybiByZWdlbmVyYXRvclJ1bnRpbWUud3JhcChmdW5jdGlvbiBfY2FsbGVlMiQoX2NvbnRleHQyKSB7CiAgICAgICAgICB3aGlsZSAoMSkgewogICAgICAgICAgICBzd2l0Y2ggKF9jb250ZXh0Mi5wcmV2ID0gX2NvbnRleHQyLm5leHQpIHsKICAgICAgICAgICAgICBjYXNlIDA6CiAgICAgICAgICAgICAgICBpZiAodGhpcy5yZW1vdmVBY3Rpb24pIHsKICAgICAgICAgICAgICAgICAgX2NvbnRleHQyLm5leHQgPSAzOwogICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICB0aGlzLiROb3RpY2UuZXJyb3IoewogICAgICAgICAgICAgICAgICB0aXRsZTogJ+mUmeivrycsCiAgICAgICAgICAgICAgICAgIGRlc2M6ICdBUkNISVZFU0NFTlRFUkdyaWRWaWV36KeG5Zu+6KGo5qC8cmVtb3ZlQWN0aW9u5Y+C5pWw5pyq6YWN572uJwogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQyLmFicnVwdCgicmV0dXJuIik7CgogICAgICAgICAgICAgIGNhc2UgMzoKICAgICAgICAgICAgICAgIF9kYXRhcyA9IFtdOwogICAgICAgICAgICAgICAgZGF0YXMuZm9yRWFjaChmdW5jdGlvbiAocmVjb3JkLCBpbmRleCkgewogICAgICAgICAgICAgICAgICBpZiAoT2JqZWN0LmlzKHJlY29yZC5zcmZ1ZiwgIjAiKSkgewogICAgICAgICAgICAgICAgICAgIF90aGlzNi5pdGVtcy5zb21lKGZ1bmN0aW9uICh2YWwsIG51bSkgewogICAgICAgICAgICAgICAgICAgICAgaWYgKEpTT04uc3RyaW5naWZ5KHZhbCkgPT0gSlNPTi5zdHJpbmdpZnkocmVjb3JkKSkgewogICAgICAgICAgICAgICAgICAgICAgICBfdGhpczYuaXRlbXMuc3BsaWNlKG51bSwgMSk7CgogICAgICAgICAgICAgICAgICAgICAgICBfdGhpczYuZ3JpZEl0ZW1zTW9kZWwuc3BsaWNlKG51bSwgMSk7CgogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICBfZGF0YXMucHVzaChkYXRhc1tpbmRleF0pOwogICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9KTsKCiAgICAgICAgICAgICAgICBpZiAoIShfZGF0YXMubGVuZ3RoID09PSAwKSkgewogICAgICAgICAgICAgICAgICBfY29udGV4dDIubmV4dCA9IDc7CiAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDIuYWJydXB0KCJyZXR1cm4iKTsKCiAgICAgICAgICAgICAgY2FzZSA3OgogICAgICAgICAgICAgICAgZGF0YUluZm8gPSAnJzsKCiAgICAgICAgICAgICAgICBfZGF0YXMuZm9yRWFjaChmdW5jdGlvbiAocmVjb3JkLCBpbmRleCkgewogICAgICAgICAgICAgICAgICB2YXIgc3JmbWFqb3J0ZXh0ID0gcmVjb3JkLnBvc2l0aW9uOwoKICAgICAgICAgICAgICAgICAgaWYgKGluZGV4IDwgNSkgewogICAgICAgICAgICAgICAgICAgIGlmICghT2JqZWN0LmlzKGRhdGFJbmZvLCAnJykpIHsKICAgICAgICAgICAgICAgICAgICAgIGRhdGFJbmZvICs9ICfjgIEnOwogICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgZGF0YUluZm8gKz0gc3JmbWFqb3J0ZXh0OwogICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSk7CgogICAgICAgICAgICAgICAgaWYgKF9kYXRhcy5sZW5ndGggPCA1KSB7CiAgICAgICAgICAgICAgICAgIGRhdGFJbmZvID0gZGF0YUluZm8gKyAnIOWFsScgKyBfZGF0YXMubGVuZ3RoICsgJ+adoeaVsOaNric7CiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICBkYXRhSW5mbyA9IGRhdGFJbmZvICsgJy4uLicgKyAnIOWFsScgKyBfZGF0YXMubGVuZ3RoICsgJ+adoeaVsOaNric7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgcmVtb3ZlRGF0YSA9IGZ1bmN0aW9uIHJlbW92ZURhdGEoKSB7CiAgICAgICAgICAgICAgICAgIHZhciBrZXlzID0gW107CgogICAgICAgICAgICAgICAgICBfZGF0YXMuZm9yRWFjaChmdW5jdGlvbiAoZGF0YSkgewogICAgICAgICAgICAgICAgICAgIGtleXMucHVzaChkYXRhLnNyZmtleSk7CiAgICAgICAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgICAgICAgdmFyIF9yZW1vdmVBY3Rpb24gPSBrZXlzLmxlbmd0aCA+IDEgPyAncmVtb3ZlQmF0Y2gnIDogX3RoaXM2LnJlbW92ZUFjdGlvbjsKCiAgICAgICAgICAgICAgICAgIHZhciBfa2V5cyA9IGtleXMubGVuZ3RoID4gMSA/IGtleXMgOiBrZXlzWzBdOwoKICAgICAgICAgICAgICAgICAgdmFyIGNvbnRleHQgPSBKU09OLnBhcnNlKEpTT04uc3RyaW5naWZ5KF90aGlzNi5jb250ZXh0KSk7CgogICAgICAgICAgICAgICAgICB2YXIgcG9zdCA9IF90aGlzNi5zZXJ2aWNlWyJkZWxldGUiXShfcmVtb3ZlQWN0aW9uLCBPYmplY3QuYXNzaWduKGNvbnRleHQsIHsKICAgICAgICAgICAgICAgICAgICBwaW1hcmNoaXZlc2NlbnRlcjogX2tleXMKICAgICAgICAgICAgICAgICAgfSksIE9iamVjdC5hc3NpZ24oewogICAgICAgICAgICAgICAgICAgIHBpbWFyY2hpdmVzY2VudGVyOiBfa2V5cwogICAgICAgICAgICAgICAgICB9LCB7CiAgICAgICAgICAgICAgICAgICAgdmlld3BhcmFtczogX3RoaXM2LnZpZXdwYXJhbXMKICAgICAgICAgICAgICAgICAgfSksIF90aGlzNi5zaG93QnVzeUluZGljYXRvcik7CgogICAgICAgICAgICAgICAgICByZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24gKHJlc29sdmUsIHJlamVjdCkgewogICAgICAgICAgICAgICAgICAgIHBvc3QudGhlbihmdW5jdGlvbiAocmVzcG9uc2UpIHsKICAgICAgICAgICAgICAgICAgICAgIGlmICghcmVzcG9uc2UgfHwgcmVzcG9uc2Uuc3RhdHVzICE9PSAyMDApIHsKICAgICAgICAgICAgICAgICAgICAgICAgX3RoaXM2LiROb3RpY2UuZXJyb3IoewogICAgICAgICAgICAgICAgICAgICAgICAgIHRpdGxlOiAnJywKICAgICAgICAgICAgICAgICAgICAgICAgICBkZXNjOiAn5Yig6Zmk5pWw5o2u5aSx6LSlLCcgKyByZXNwb25zZS5pbmZvCiAgICAgICAgICAgICAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgX3RoaXM2LiROb3RpY2Uuc3VjY2Vzcyh7CiAgICAgICAgICAgICAgICAgICAgICAgICAgdGl0bGU6ICcnLAogICAgICAgICAgICAgICAgICAgICAgICAgIGRlc2M6ICfliKDpmaTmiJDlip8hJwogICAgICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICAgIH0gLy/liKDpmaRpdGVtc+S4reW3suWIoOmZpOeahOmhuQoKCiAgICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhfdGhpczYuaXRlbXMpOwoKICAgICAgICAgICAgICAgICAgICAgIF9kYXRhcy5mb3JFYWNoKGZ1bmN0aW9uIChkYXRhKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIF90aGlzNi5pdGVtcy5zb21lKGZ1bmN0aW9uIChpdGVtLCBpbmRleCkgewogICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChPYmplY3QuaXMoaXRlbS5zcmZrZXksIGRhdGEuc3Jma2V5KSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgX3RoaXM2Lml0ZW1zLnNwbGljZShpbmRleCwgMSk7CgogICAgICAgICAgICAgICAgICAgICAgICAgICAgX3RoaXM2LmdyaWRJdGVtc01vZGVsLnNwbGljZShpbmRleCwgMSk7CgogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgICAgICAgICAgIF90aGlzNi50b3RhbHJvdyAtPSBfZGF0YXMubGVuZ3RoOwoKICAgICAgICAgICAgICAgICAgICAgIF90aGlzNi4kZW1pdCgncmVtb3ZlJywgbnVsbCk7CgogICAgICAgICAgICAgICAgICAgICAgX3RoaXM2LnNlbGVjdGlvbnMgPSBbXTsKICAgICAgICAgICAgICAgICAgICAgIHJlc29sdmUocmVzcG9uc2UpOwogICAgICAgICAgICAgICAgICAgIH0pWyJjYXRjaCJdKGZ1bmN0aW9uIChyZXNwb25zZSkgewogICAgICAgICAgICAgICAgICAgICAgaWYgKHJlc3BvbnNlICYmIHJlc3BvbnNlLnN0YXR1cyA9PT0gNDAxKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgICBpZiAoIXJlc3BvbnNlIHx8ICFyZXNwb25zZS5zdGF0dXMgfHwgIXJlc3BvbnNlLmRhdGEpIHsKICAgICAgICAgICAgICAgICAgICAgICAgX3RoaXM2LiROb3RpY2UuZXJyb3IoewogICAgICAgICAgICAgICAgICAgICAgICAgIHRpdGxlOiAn6ZSZ6K+vJywKICAgICAgICAgICAgICAgICAgICAgICAgICBkZXNjOiAn57O757uf5byC5bi4JwogICAgICAgICAgICAgICAgICAgICAgICB9KTsKCiAgICAgICAgICAgICAgICAgICAgICAgIHJlamVjdChyZXNwb25zZSk7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgICByZWplY3QocmVzcG9uc2UpOwogICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIH07CgogICAgICAgICAgICAgICAgZGF0YUluZm8gPSBkYXRhSW5mby5yZXBsYWNlKC9bbnVsbF0vZywgJycpLnJlcGxhY2UoL1t1bmRlZmluZWRdL2csICcnKTsKICAgICAgICAgICAgICAgIHRoaXMuJE1vZGFsLmNvbmZpcm0oewogICAgICAgICAgICAgICAgICB0aXRsZTogJ+itpuWRiicsCiAgICAgICAgICAgICAgICAgIGNvbnRlbnQ6ICfnoa7orqTopoHliKDpmaQgJyArIGRhdGFJbmZvICsgJ++8jOWIoOmZpOaTjeS9nOWwhuS4jeWPr+aBouWkje+8nycsCiAgICAgICAgICAgICAgICAgIG9uT2s6IGZ1bmN0aW9uIG9uT2soKSB7CiAgICAgICAgICAgICAgICAgICAgcmVtb3ZlRGF0YSgpOwogICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICBvbkNhbmNlbDogZnVuY3Rpb24gb25DYW5jZWwoKSB7fQogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQyLmFicnVwdCgicmV0dXJuIiwgcmVtb3ZlRGF0YSk7CgogICAgICAgICAgICAgIGNhc2UgMTQ6CiAgICAgICAgICAgICAgY2FzZSAiZW5kIjoKICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDIuc3RvcCgpOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSwgX2NhbGxlZTIsIHRoaXMpOwogICAgICB9KSk7CgogICAgICBmdW5jdGlvbiByZW1vdmUoX3gpIHsKICAgICAgICByZXR1cm4gX3JlbW92ZS5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwogICAgICB9CgogICAgICByZXR1cm4gcmVtb3ZlOwogICAgfSgpCiAgICAvKioNCiAgICAgKiDmibnph4/mt7vliqANCiAgICAgKg0KICAgICAqIEBwYXJhbSB7Kn0gW2FyZz17fV0NCiAgICAgKiBAbWVtYmVyb2YgTWFpbkJhc2UNCiAgICAgKi8KCiAgfSwgewogICAga2V5OiAiYWRkQmF0Y2giLAogICAgdmFsdWU6IGZ1bmN0aW9uIGFkZEJhdGNoKCkgewogICAgICB2YXIgYXJnID0gYXJndW1lbnRzLmxlbmd0aCA+IDAgJiYgYXJndW1lbnRzWzBdICE9PSB1bmRlZmluZWQgPyBhcmd1bWVudHNbMF0gOiB7fTsKCiAgICAgIGlmICghdGhpcy5mZXRjaEFjdGlvbikgewogICAgICAgIHRoaXMuJE5vdGljZS5lcnJvcih7CiAgICAgICAgICB0aXRsZTogJ+mUmeivrycsCiAgICAgICAgICBkZXNjOiAnQVJDSElWRVNDRU5URVJHcmlkVmlld+inhuWbvuihqOagvGZldGNoQWN0aW9u5Y+C5pWw5pyq6YWN572uJwogICAgICAgIH0pOwogICAgICAgIHJldHVybjsKICAgICAgfQoKICAgICAgaWYgKCFhcmcpIHsKICAgICAgICBhcmcgPSB7fTsKICAgICAgfQoKICAgICAgY29uc29sZS5lcnJvcigi5om56YeP5re75Yqg5pyq5a6e546wIik7CiAgICB9CiAgICAvKioNCiAgICAgKiDmlbDmja7lr7zlhaUNCiAgICAgKg0KICAgICAqIEBwYXJhbSB7Kn0gZGF0YQ0KICAgICAqIEBtZW1iZXJvZiBNYWluQmFzZQ0KICAgICAqLwoKICB9LCB7CiAgICBrZXk6ICJpbXBvcnRFeGNlbCIsCiAgICB2YWx1ZTogZnVuY3Rpb24gaW1wb3J0RXhjZWwoKSB7CiAgICAgIHZhciBfdGhpczcgPSB0aGlzOwoKICAgICAgdmFyIGRhdGEgPSBhcmd1bWVudHMubGVuZ3RoID4gMCAmJiBhcmd1bWVudHNbMF0gIT09IHVuZGVmaW5lZCA/IGFyZ3VtZW50c1swXSA6IHt9OwogICAgICAvL+WvvOWFpWV4Y2VsCiAgICAgIHZhciBpbXBvcnREYXRhTW9kZWwgPSB7fTsKCiAgICAgIGlmIChPYmplY3Qua2V5cyhpbXBvcnREYXRhTW9kZWwpLmxlbmd0aCA9PSAwKSB7CiAgICAgICAgdGhpcy4kTm90aWNlLndhcm5pbmcoewogICAgICAgICAgJ3RpdGxlJzogdGhpcy4kdCgiYXBwLnV0aWx2aWV3Lndhcm5pbmciKSwKICAgICAgICAgICdkZXNjJzogdGhpcy4kdCgiYXBwLnV0aWx2aWV3LmluZm8iKQogICAgICAgIH0pOwogICAgICAgIHJldHVybjsKICAgICAgfQoKICAgICAgdmFyIHZpZXcgPSB7CiAgICAgICAgdmlld25hbWU6ICdhcHAtZGF0YS11cGxvYWQnLAogICAgICAgIHRpdGxlOiB0aGlzLiR0KCJhcHAudXRpbHZpZXcuaW1wb3J0dmlldyIpLAogICAgICAgIHdpZHRoOiA5MDAsCiAgICAgICAgaGVpZ2h0OiA3MDAKICAgICAgfTsKICAgICAgdmFyIGNvbnRhaW5lciA9IHRoaXMuJGFwcG1vZGFsLm9wZW5Nb2RhbCh2aWV3LCBKU09OLnBhcnNlKEpTT04uc3RyaW5naWZ5KHRoaXMuY29udGV4dCkpLCBpbXBvcnREYXRhTW9kZWwpOwogICAgICBjb250YWluZXIuc3Vic2NyaWJlKGZ1bmN0aW9uIChyZXN1bHQpIHsKICAgICAgICBpZiAoT2JqZWN0LmlzKHJlc3VsdC5yZXQsICdPSycpKSB7CiAgICAgICAgICBfdGhpczcucmVmcmVzaChyZXN1bHQuZGF0YXMpOwogICAgICAgIH0KICAgICAgfSk7CiAgICB9CiAgICAvKioNCiAgICAgKiDmlbDmja7lr7zlh7oNCiAgICAgKg0KICAgICAqIEBwYXJhbSB7Kn0gZGF0YQ0KICAgICAqIEBtZW1iZXJvZiBNYWluQmFzZQ0KICAgICAqLwoKICB9LCB7CiAgICBrZXk6ICJleHBvcnRFeGNlbCIsCiAgICB2YWx1ZTogZnVuY3Rpb24gZXhwb3J0RXhjZWwoKSB7CiAgICAgIHZhciBfdGhpczggPSB0aGlzOwoKICAgICAgdmFyIGRhdGEgPSBhcmd1bWVudHMubGVuZ3RoID4gMCAmJiBhcmd1bWVudHNbMF0gIT09IHVuZGVmaW5lZCA/IGFyZ3VtZW50c1swXSA6IHt9OwoKICAgICAgLy8g5a+85Ye6RXhjZWwKICAgICAgdmFyIGRvRXhwb3J0ID0KICAgICAgLyojX19QVVJFX18qLwogICAgICBmdW5jdGlvbiAoKSB7CiAgICAgICAgdmFyIF9yZWYyID0gX2FzeW5jVG9HZW5lcmF0b3IoCiAgICAgICAgLyojX19QVVJFX18qLwogICAgICAgIHJlZ2VuZXJhdG9yUnVudGltZS5tYXJrKGZ1bmN0aW9uIF9jYWxsZWUzKF9kYXRhKSB7CiAgICAgICAgICB2YXIgdEhlYWRlciwgZmlsdGVyVmFsLCBkYXRhOwogICAgICAgICAgcmV0dXJuIHJlZ2VuZXJhdG9yUnVudGltZS53cmFwKGZ1bmN0aW9uIF9jYWxsZWUzJChfY29udGV4dDMpIHsKICAgICAgICAgICAgd2hpbGUgKDEpIHsKICAgICAgICAgICAgICBzd2l0Y2ggKF9jb250ZXh0My5wcmV2ID0gX2NvbnRleHQzLm5leHQpIHsKICAgICAgICAgICAgICAgIGNhc2UgMDoKICAgICAgICAgICAgICAgICAgdEhlYWRlciA9IFtdOwogICAgICAgICAgICAgICAgICBmaWx0ZXJWYWwgPSBbXTsKCiAgICAgICAgICAgICAgICAgIF90aGlzOC5hbGxDb2x1bW5zLmZvckVhY2goZnVuY3Rpb24gKGl0ZW0pIHsKICAgICAgICAgICAgICAgICAgICBpdGVtLnNob3cgJiYgaXRlbS5sYWJlbCA/IHRIZWFkZXIucHVzaChfdGhpczguJHQoaXRlbS5sYW5ndGFnKSkgOiAiIjsKICAgICAgICAgICAgICAgICAgICBpdGVtLnNob3cgJiYgaXRlbS5uYW1lID8gZmlsdGVyVmFsLnB1c2goaXRlbS5uYW1lKSA6ICIiOwogICAgICAgICAgICAgICAgICB9KTsKCiAgICAgICAgICAgICAgICAgIF9jb250ZXh0My5uZXh0ID0gNTsKICAgICAgICAgICAgICAgICAgcmV0dXJuIF90aGlzOC5mb3JtYXRFeGNlbERhdGEoZmlsdGVyVmFsLCBfZGF0YSk7CgogICAgICAgICAgICAgICAgY2FzZSA1OgogICAgICAgICAgICAgICAgICBkYXRhID0gX2NvbnRleHQzLnNlbnQ7CgogICAgICAgICAgICAgICAgICBfdGhpczguJGV4cG9ydC5leHBvcnRFeGNlbCgpLnRoZW4oZnVuY3Rpb24gKGV4Y2VsKSB7CiAgICAgICAgICAgICAgICAgICAgZXhjZWwuZXhwb3J0X2pzb25fdG9fZXhjZWwoewogICAgICAgICAgICAgICAgICAgICAgaGVhZGVyOiB0SGVhZGVyLAogICAgICAgICAgICAgICAgICAgICAgZGF0YTogZGF0YSwKICAgICAgICAgICAgICAgICAgICAgIGZpbGVuYW1lOiAi5qGj5qGI5a6k566h55CG6KGoIiwKICAgICAgICAgICAgICAgICAgICAgIGF1dG9XaWR0aDogdHJ1ZSwKICAgICAgICAgICAgICAgICAgICAgIGJvb2tUeXBlOiAieGxzeCIgLy/pnZ7lv4XloasKCiAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgICAgIGNhc2UgNzoKICAgICAgICAgICAgICAgIGNhc2UgImVuZCI6CiAgICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDMuc3RvcCgpOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgfSwgX2NhbGxlZTMpOwogICAgICAgIH0pKTsKCiAgICAgICAgcmV0dXJuIGZ1bmN0aW9uIGRvRXhwb3J0KF94MikgewogICAgICAgICAgcmV0dXJuIF9yZWYyLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7CiAgICAgICAgfTsKICAgICAgfSgpOwoKICAgICAgdmFyIHBhZ2UgPSB7fTsgLy8g6K6+572ucGFnZe+8jHNpemUKCiAgICAgIGlmIChPYmplY3QuaXMoZGF0YS50eXBlLCAnbWF4Um93Q291bnQnKSkgewogICAgICAgIE9iamVjdC5hc3NpZ24ocGFnZSwgewogICAgICAgICAgcGFnZTogMCwKICAgICAgICAgIHNpemU6IGRhdGEubWF4Um93Q291bnQKICAgICAgICB9KTsKICAgICAgfSBlbHNlIGlmIChPYmplY3QuaXMoZGF0YS50eXBlLCAnYWN0aXZhdGVkUGFnZScpKSB7CiAgICAgICAgdHJ5IHsKICAgICAgICAgIGRvRXhwb3J0KEpTT04ucGFyc2UoSlNPTi5zdHJpbmdpZnkodGhpcy5pdGVtcykpKTsKICAgICAgICB9IGNhdGNoIChlcnJvcikgewogICAgICAgICAgY29uc29sZS5lcnJvcihlcnJvcik7CiAgICAgICAgfQoKICAgICAgICByZXR1cm47CiAgICAgIH0gLy8g6K6+572u5o6S5bqPCgoKICAgICAgaWYgKCF0aGlzLmlzTm9Tb3J0ICYmICFPYmplY3QuaXModGhpcy5taW5vclNvcnREaXIsICcnKSAmJiAhT2JqZWN0LmlzKHRoaXMubWlub3JTb3J0UFNERUYsICcnKSkgewogICAgICAgIHZhciBzb3J0ID0gdGhpcy5taW5vclNvcnRQU0RFRiArICIsIiArIHRoaXMubWlub3JTb3J0RGlyOwogICAgICAgIE9iamVjdC5hc3NpZ24ocGFnZSwgewogICAgICAgICAgc29ydDogc29ydAogICAgICAgIH0pOwogICAgICB9CgogICAgICB2YXIgYXJnID0ge307CiAgICAgIE9iamVjdC5hc3NpZ24oYXJnLCBwYWdlKTsgLy8g6I635Y+WcXVlcnks5pCc57Si6KGo5Y2V77yMdmlld3BhcmFtc+etieeItuaVsOaNrgoKICAgICAgdmFyIHBhcmVudGRhdGEgPSB7fTsKICAgICAgdGhpcy4kZW1pdCgnYmVmb3JlbG9hZCcsIHBhcmVudGRhdGEpOwogICAgICBPYmplY3QuYXNzaWduKGFyZywgcGFyZW50ZGF0YSk7CiAgICAgIHZhciBwb3N0ID0gdGhpcy5zZXJ2aWNlLnNlYXJjaCh0aGlzLmZldGNoQWN0aW9uLCBKU09OLnBhcnNlKEpTT04uc3RyaW5naWZ5KHRoaXMuY29udGV4dCkpLCBhcmcsIHRoaXMuc2hvd0J1c3lJbmRpY2F0b3IpOwogICAgICBwb3N0LnRoZW4oZnVuY3Rpb24gKHJlc3BvbnNlKSB7CiAgICAgICAgaWYgKCFyZXNwb25zZSB8fCByZXNwb25zZS5zdGF0dXMgIT09IDIwMCkgewogICAgICAgICAgX3RoaXM4LiROb3RpY2UuZXJyb3IoewogICAgICAgICAgICB0aXRsZTogJycsCiAgICAgICAgICAgIGRlc2M6ICfmlbDmja7lr7zlh7rlpLHotKUsJyArIHJlc3BvbnNlLmluZm8KICAgICAgICAgIH0pOwoKICAgICAgICAgIHJldHVybjsKICAgICAgICB9CgogICAgICAgIHRyeSB7CiAgICAgICAgICBkb0V4cG9ydChKU09OLnBhcnNlKEpTT04uc3RyaW5naWZ5KHJlc3BvbnNlLmRhdGEpKSk7CiAgICAgICAgfSBjYXRjaCAoZXJyb3IpIHsKICAgICAgICAgIGNvbnNvbGUuZXJyb3IoZXJyb3IpOwogICAgICAgIH0KICAgICAgfSlbImNhdGNoIl0oZnVuY3Rpb24gKHJlc3BvbnNlKSB7CiAgICAgICAgaWYgKHJlc3BvbnNlICYmIHJlc3BvbnNlLnN0YXR1cyA9PT0gNDAxKSB7CiAgICAgICAgICByZXR1cm47CiAgICAgICAgfQoKICAgICAgICBfdGhpczguJE5vdGljZS5lcnJvcih7CiAgICAgICAgICB0aXRsZTogJycsCiAgICAgICAgICBkZXNjOiAn5pWw5o2u5a+85Ye65aSx6LSlJwogICAgICAgIH0pOwogICAgICB9KTsKICAgIH0KICAgIC8qKg0KICAgICAqIOWvvOWHuuaVsOaNruagvOW8j+WMlg0KICAgICAqDQogICAgICogQHBhcmFtIHsqfSBmaWx0ZXJWYWwNCiAgICAgKiBAcGFyYW0geyp9IGpzb25EYXRhDQogICAgICogQHJldHVybnMge1tdfQ0KICAgICAqIEBtZW1iZXJvZiBNYWluQmFzZQ0KICAgICAqLwoKICB9LCB7CiAgICBrZXk6ICJmb3JtYXRFeGNlbERhdGEiLAogICAgdmFsdWU6IGZ1bmN0aW9uICgpIHsKICAgICAgdmFyIF9mb3JtYXRFeGNlbERhdGEgPSBfYXN5bmNUb0dlbmVyYXRvcigKICAgICAgLyojX19QVVJFX18qLwogICAgICByZWdlbmVyYXRvclJ1bnRpbWUubWFyayhmdW5jdGlvbiBfY2FsbGVlNChmaWx0ZXJWYWwsIGpzb25EYXRhKSB7CiAgICAgICAgdmFyIGNvZGVsaXN0Q29sdW1ucywgX3RoaXMsIF9sb29wLCBfaTIsIF9jb2RlbGlzdENvbHVtbnM7CgogICAgICAgIHJldHVybiByZWdlbmVyYXRvclJ1bnRpbWUud3JhcChmdW5jdGlvbiBfY2FsbGVlNCQoX2NvbnRleHQ1KSB7CiAgICAgICAgICB3aGlsZSAoMSkgewogICAgICAgICAgICBzd2l0Y2ggKF9jb250ZXh0NS5wcmV2ID0gX2NvbnRleHQ1Lm5leHQpIHsKICAgICAgICAgICAgICBjYXNlIDA6CiAgICAgICAgICAgICAgICBjb2RlbGlzdENvbHVtbnMgPSBbewogICAgICAgICAgICAgICAgICBuYW1lOiAnbGF5ZXJubycsCiAgICAgICAgICAgICAgICAgIHNyZmtleTogJ0VockNvZGVMaXN0MDAyMCcsCiAgICAgICAgICAgICAgICAgIGNvZGVsaXN0VHlwZTogJ1NUQVRJQycsCiAgICAgICAgICAgICAgICAgIHJlbmRlck1vZGU6ICdvdGhlcicsCiAgICAgICAgICAgICAgICAgIHRleHRTZXBhcmF0b3I6ICfjgIEnLAogICAgICAgICAgICAgICAgICB2YWx1ZVNlcGFyYXRvcjogJywnCiAgICAgICAgICAgICAgICB9XTsKICAgICAgICAgICAgICAgIF90aGlzID0gdGhpczsKICAgICAgICAgICAgICAgIF9sb29wID0KICAgICAgICAgICAgICAgIC8qI19fUFVSRV9fKi8KICAgICAgICAgICAgICAgIHJlZ2VuZXJhdG9yUnVudGltZS5tYXJrKGZ1bmN0aW9uIF9sb29wKCkgewogICAgICAgICAgICAgICAgICB2YXIgY29kZWxpc3QsIGl0ZW1zLCBfaXRlbXM7CgogICAgICAgICAgICAgICAgICByZXR1cm4gcmVnZW5lcmF0b3JSdW50aW1lLndyYXAoZnVuY3Rpb24gX2xvb3AkKF9jb250ZXh0NCkgewogICAgICAgICAgICAgICAgICAgIHdoaWxlICgxKSB7CiAgICAgICAgICAgICAgICAgICAgICBzd2l0Y2ggKF9jb250ZXh0NC5wcmV2ID0gX2NvbnRleHQ0Lm5leHQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAwOgogICAgICAgICAgICAgICAgICAgICAgICAgIGNvZGVsaXN0ID0gX2NvZGVsaXN0Q29sdW1uc1tfaTJdOwoKICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoIU9iamVjdC5pcyhjb2RlbGlzdC5jb2RlbGlzdFR5cGUsICJEWU5BTUlDIikpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIF9jb250ZXh0NC5uZXh0ID0gODsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgICAgICAgX2NvbnRleHQ0Lm5leHQgPSA0OwogICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBfdGhpcy5jb2RlTGlzdFNlcnZpY2UuZ2V0SXRlbXMoY29kZWxpc3Quc3Jma2V5KTsKCiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgNDoKICAgICAgICAgICAgICAgICAgICAgICAgICBpdGVtcyA9IF9jb250ZXh0NC5zZW50OwogICAgICAgICAgICAgICAgICAgICAgICAgIGpzb25EYXRhLmZvckVhY2goZnVuY3Rpb24gKHJvdykgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgcm93W2NvZGVsaXN0Lm5hbWVdID0gX3RoaXMuZ2V0Q29kZWxpc3RWYWx1ZShpdGVtcywgcm93W2NvZGVsaXN0Lm5hbWVdLCBjb2RlbGlzdCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7IC8vIOmdmeaAgeWkhOeQhgoKICAgICAgICAgICAgICAgICAgICAgICAgICBfY29udGV4dDQubmV4dCA9IDEzOwogICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSA4OgogICAgICAgICAgICAgICAgICAgICAgICAgIGlmICghT2JqZWN0LmlzKGNvZGVsaXN0LmNvZGVsaXN0VHlwZSwgIlNUQVRJQyIpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBfY29udGV4dDQubmV4dCA9IDEzOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICAgICAgICBfY29udGV4dDQubmV4dCA9IDExOwogICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBfdGhpcy4kc3RvcmUuZ2V0dGVycy5nZXRDb2RlTGlzdEl0ZW1zKGNvZGVsaXN0LnNyZmtleSk7CgogICAgICAgICAgICAgICAgICAgICAgICBjYXNlIDExOgogICAgICAgICAgICAgICAgICAgICAgICAgIF9pdGVtcyA9IF9jb250ZXh0NC5zZW50OwogICAgICAgICAgICAgICAgICAgICAgICAgIGpzb25EYXRhLmZvckVhY2goZnVuY3Rpb24gKHJvdykgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgcm93W2NvZGVsaXN0Lm5hbWVdID0gX3RoaXMuZ2V0Q29kZWxpc3RWYWx1ZShfaXRlbXMsIHJvd1tjb2RlbGlzdC5uYW1lXSwgY29kZWxpc3QpOwogICAgICAgICAgICAgICAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAxMzoKICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAiZW5kIjoKICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQ0LnN0b3AoKTsKICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgIH0sIF9sb29wKTsKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgX2kyID0gMCwgX2NvZGVsaXN0Q29sdW1ucyA9IGNvZGVsaXN0Q29sdW1uczsKCiAgICAgICAgICAgICAgY2FzZSA0OgogICAgICAgICAgICAgICAgaWYgKCEoX2kyIDwgX2NvZGVsaXN0Q29sdW1ucy5sZW5ndGgpKSB7CiAgICAgICAgICAgICAgICAgIF9jb250ZXh0NS5uZXh0ID0gOTsKICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0NS5kZWxlZ2F0ZVlpZWxkKF9sb29wKCksICJ0MCIsIDYpOwoKICAgICAgICAgICAgICBjYXNlIDY6CiAgICAgICAgICAgICAgICBfaTIrKzsKICAgICAgICAgICAgICAgIF9jb250ZXh0NS5uZXh0ID0gNDsKICAgICAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgICAgICBjYXNlIDk6CiAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQ1LmFicnVwdCgicmV0dXJuIiwganNvbkRhdGEubWFwKGZ1bmN0aW9uICh2KSB7CiAgICAgICAgICAgICAgICAgIHJldHVybiBmaWx0ZXJWYWwubWFwKGZ1bmN0aW9uIChqKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHZbal07CiAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgfSkpOwoKICAgICAgICAgICAgICBjYXNlIDEwOgogICAgICAgICAgICAgIGNhc2UgImVuZCI6CiAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQ1LnN0b3AoKTsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0sIF9jYWxsZWU0LCB0aGlzKTsKICAgICAgfSkpOwoKICAgICAgZnVuY3Rpb24gZm9ybWF0RXhjZWxEYXRhKF94MywgX3g0KSB7CiAgICAgICAgcmV0dXJuIF9mb3JtYXRFeGNlbERhdGEuYXBwbHkodGhpcywgYXJndW1lbnRzKTsKICAgICAgfQoKICAgICAgcmV0dXJuIGZvcm1hdEV4Y2VsRGF0YTsKICAgIH0oKQogICAgLyoqDQogICAgICog6Kej5p6Q5Luj56CB6KGo5ZKMdmxhdWXvvIzorr7nva5pdGVtcw0KICAgICAqDQogICAgICogQHB1YmxpYw0KICAgICAqIEBwYXJhbSB7YW55W119IGl0ZW1zIOS7o+eggeihqOaVsOaNrg0KICAgICAqIEBwYXJhbSB7Kn0gdmFsdWUNCiAgICAgKiBAcmV0dXJucyB7Kn0NCiAgICAgKiBAbWVtYmVyb2YgTWFpbkJhc2UNCiAgICAgKi8KCiAgfSwgewogICAga2V5OiAiZ2V0Q29kZWxpc3RWYWx1ZSIsCiAgICB2YWx1ZTogZnVuY3Rpb24gZ2V0Q29kZWxpc3RWYWx1ZShpdGVtcywgdmFsdWUsIGNvZGVsaXN0KSB7CiAgICAgIHZhciBfdGhpczkgPSB0aGlzOwoKICAgICAgaWYgKCF2YWx1ZSkgewogICAgICAgIHJldHVybiB0aGlzLiR0KCdjb2RlbGlzdC4nICsgY29kZWxpc3Quc3Jma2V5ICsgJy5lbXB0eScpOwogICAgICB9CgogICAgICBpZiAoaXRlbXMpIHsKICAgICAgICB2YXIgcmVzdWx0ID0gW107CgogICAgICAgIGlmIChPYmplY3QuaXMoY29kZWxpc3QucmVuZGVyTW9kZSwgIm51bWJlciIpKSB7CiAgICAgICAgICBpdGVtcy5tYXAoZnVuY3Rpb24gKF9pdGVtLCBpbmRleCkgewogICAgICAgICAgICB2YXIgblZhbHVlID0gcGFyc2VJbnQodmFsdWUsIDEwKTsKICAgICAgICAgICAgdmFyIGNvZGV2YWx1ZSA9IF9pdGVtLnZhbHVlOwoKICAgICAgICAgICAgaWYgKChwYXJzZUludChjb2RldmFsdWUsIDEwKSAmIG5WYWx1ZSkgPiAwKSB7CiAgICAgICAgICAgICAgcmVzdWx0LnB1c2goX2l0ZW0pOwogICAgICAgICAgICB9CiAgICAgICAgICB9KTsKICAgICAgICB9IGVsc2UgaWYgKE9iamVjdC5pcyhjb2RlbGlzdC5yZW5kZXJNb2RlLCAic3RyaW5nIikpIHsKICAgICAgICAgIHZhciBhcnJheVZhbHVlID0gdmFsdWUuc3BsaXQoY29kZWxpc3QudmFsdWVTZXBhcmF0b3IpOwogICAgICAgICAgYXJyYXlWYWx1ZS5tYXAoZnVuY3Rpb24gKHZhbHVlLCBpbmRleCkgewogICAgICAgICAgICByZXN1bHQucHVzaChbXSk7CiAgICAgICAgICAgIHZhciB2YWx1ZXMgPSBPYmplY3QuaXMoX3RoaXM5LiR1dGlsLnR5cGVPZih2YWx1ZSksICdudW1iZXInKSA/IFt2YWx1ZV0gOiBfdG9Db25zdW1hYmxlQXJyYXkodmFsdWUuc3BsaXQoY29kZWxpc3QudmFsdWVTZXBhcmF0b3IpKTsKICAgICAgICAgICAgdmFsdWVzLm1hcChmdW5jdGlvbiAodmFsLCBudW0pIHsKICAgICAgICAgICAgICB2YXIgaXRlbSA9IF90aGlzOS5nZXRJdGVtKGl0ZW1zLCB2YWwsIGNvZGVsaXN0KTsKCiAgICAgICAgICAgICAgaWYgKGl0ZW0pIHsKICAgICAgICAgICAgICAgIHJlc3VsdFtpbmRleF0ucHVzaChpdGVtKTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0pOwogICAgICAgICAgfSk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIHZhciB2YWx1ZXMgPSBPYmplY3QuaXModGhpcy4kdXRpbC50eXBlT2YodmFsdWUpLCAnbnVtYmVyJykgPyBbdmFsdWVdIDogX3RvQ29uc3VtYWJsZUFycmF5KHZhbHVlLnNwbGl0KGNvZGVsaXN0LnZhbHVlU2VwYXJhdG9yKSk7CiAgICAgICAgICB2YWx1ZXMubWFwKGZ1bmN0aW9uICh2YWx1ZSwgaW5kZXgpIHsKICAgICAgICAgICAgdmFyIGl0ZW0gPSBfdGhpczkuZ2V0SXRlbShpdGVtcywgdmFsdWUsIGNvZGVsaXN0KTsKCiAgICAgICAgICAgIGlmIChpdGVtKSB7CiAgICAgICAgICAgICAgcmVzdWx0LnB1c2goaXRlbSk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0pOwogICAgICAgIH0gLy8g6K6+572uaXRlbXMKCgogICAgICAgIGlmIChyZXN1bHQubGVuZ3RoICE9IDApIHsKICAgICAgICAgIHJldHVybiByZXN1bHQuam9pbihjb2RlbGlzdC52YWx1ZVNlcGFyYXRvcik7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIHJldHVybiB2YWx1ZTsKICAgICAgICB9CiAgICAgIH0KICAgIH0KICAgIC8qKg0KICAgICAqIOiOt+WPluS7o+eggemhuQ0KICAgICAqDQogICAgICogQHB1YmxpYw0KICAgICAqIEBwYXJhbSB7YW55W119IGl0ZW1zDQogICAgICogQHBhcmFtIHsqfSB2YWx1ZQ0KICAgICAqIEByZXR1cm5zIHsqfQ0KICAgICAqIEBtZW1iZXJvZiBNYWluQmFzZQ0KICAgICAqLwoKICB9LCB7CiAgICBrZXk6ICJnZXRJdGVtIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBnZXRJdGVtKGl0ZW1zLCB2YWx1ZSwgY29kZWxpc3QpIHsKICAgICAgdmFyIGFyciA9IGl0ZW1zLmZpbHRlcihmdW5jdGlvbiAoaXRlbSkgewogICAgICAgIHJldHVybiBpdGVtLnZhbHVlID09IHZhbHVlOwogICAgICB9KTsKCiAgICAgIGlmIChhcnIubGVuZ3RoICE9PSAxKSB7CiAgICAgICAgcmV0dXJuIHVuZGVmaW5lZDsKICAgICAgfQoKICAgICAgaWYgKE9iamVjdC5pcyhjb2RlbGlzdC5jb2RlbGlzdFR5cGUsICdTVEFUSUMnKSkgewogICAgICAgIHJldHVybiB0aGlzLiR0KCdjb2RlbGlzdC4nICsgY29kZWxpc3Quc3Jma2V5ICsgJy4nICsgYXJyWzBdLnZhbHVlKTsKICAgICAgfSBlbHNlIHsKICAgICAgICByZXR1cm4gYXJyWzBdLnRleHQ7CiAgICAgIH0KICAgIH0KICAgIC8qKg0KICAgICAqIOeUn+WRveWRqOacnw0KICAgICAqDQogICAgICogQG1lbWJlcm9mIE1haW5CYXNlDQogICAgICovCgogIH0sIHsKICAgIGtleTogImNyZWF0ZWQiLAogICAgdmFsdWU6IGZ1bmN0aW9uIGNyZWF0ZWQoKSB7CiAgICAgIHRoaXMuYWZ0ZXJDcmVhdGVkKCk7CiAgICB9CiAgICAvKioNCiAgICAgKiDmiafooYxjcmVhdGVk5ZCO55qE6YC76L6RDQogICAgICoNCiAgICAgKiAgQG1lbWJlcm9mIE1haW5CYXNlDQogICAgICovCgogIH0sIHsKICAgIGtleTogImFmdGVyQ3JlYXRlZCIsCiAgICB2YWx1ZTogZnVuY3Rpb24gYWZ0ZXJDcmVhdGVkKCkgewogICAgICB2YXIgX3RoaXMxMCA9IHRoaXM7CgogICAgICB0aGlzLnNldENvbFN0YXRlKCk7CgogICAgICBpZiAodGhpcy52aWV3U3RhdGUpIHsKICAgICAgICB0aGlzLnZpZXdTdGF0ZUV2ZW50ID0gdGhpcy52aWV3U3RhdGUuc3Vic2NyaWJlKGZ1bmN0aW9uIChfcmVmMykgewogICAgICAgICAgdmFyIHRhZyA9IF9yZWYzLnRhZywKICAgICAgICAgICAgICBhY3Rpb24gPSBfcmVmMy5hY3Rpb24sCiAgICAgICAgICAgICAgZGF0YSA9IF9yZWYzLmRhdGE7CgogICAgICAgICAgaWYgKCFPYmplY3QuaXModGFnLCBfdGhpczEwLm5hbWUpKSB7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgIH0KCiAgICAgICAgICBpZiAoT2JqZWN0LmlzKCdsb2FkJywgYWN0aW9uKSkgewogICAgICAgICAgICBfdGhpczEwLmxvYWQoZGF0YSk7CiAgICAgICAgICB9CgogICAgICAgICAgaWYgKE9iamVjdC5pcygncmVtb3ZlJywgYWN0aW9uKSkgewogICAgICAgICAgICBfdGhpczEwLnJlbW92ZShkYXRhKTsKICAgICAgICAgIH0KCiAgICAgICAgICBpZiAoT2JqZWN0LmlzKCdzYXZlJywgYWN0aW9uKSkgewogICAgICAgICAgICBfdGhpczEwLnNhdmUoZGF0YSk7CiAgICAgICAgICB9CiAgICAgICAgfSk7CiAgICAgIH0KICAgIH0KICAgIC8qKg0KICAgICAqIHZ1ZSDnlJ/lkb3lkajmnJ8NCiAgICAgKg0KICAgICAqIEBtZW1iZXJvZiBNYWluQmFzZQ0KICAgICAqLwoKICB9LCB7CiAgICBrZXk6ICJkZXN0cm95ZWQiLAogICAgdmFsdWU6IGZ1bmN0aW9uIGRlc3Ryb3llZCgpIHsKICAgICAgdGhpcy5hZnRlckRlc3Ryb3koKTsKICAgIH0KICAgIC8qKg0KICAgICAqIOaJp+ihjGRlc3Ryb3llZOWQjueahOmAu+i+kQ0KICAgICAqDQogICAgICogQG1lbWJlcm9mIE1haW5CYXNlDQogICAgICovCgogIH0sIHsKICAgIGtleTogImFmdGVyRGVzdHJveSIsCiAgICB2YWx1ZTogZnVuY3Rpb24gYWZ0ZXJEZXN0cm95KCkgewogICAgICBpZiAodGhpcy52aWV3U3RhdGVFdmVudCkgewogICAgICAgIHRoaXMudmlld1N0YXRlRXZlbnQudW5zdWJzY3JpYmUoKTsKICAgICAgfQogICAgfQogICAgLyoqDQogICAgICog6I635Y+W6YCJ5Lit6KGM6IOh5pWw5o2uDQogICAgICoNCiAgICAgKiBAcmV0dXJucyB7YW55W119DQogICAgICogQG1lbWJlcm9mIE1haW5CYXNlDQogICAgICovCgogIH0sIHsKICAgIGtleTogImdldFNlbGVjdGlvbiIsCiAgICB2YWx1ZTogZnVuY3Rpb24gZ2V0U2VsZWN0aW9uKCkgewogICAgICByZXR1cm4gdGhpcy5zZWxlY3Rpb25zOwogICAgfQogICAgLyoqDQogICAgICog6KGM5Y+M5Ye75LqL5Lu2DQogICAgICoNCiAgICAgKiBAcGFyYW0geyp9ICRldmVudA0KICAgICAqIEByZXR1cm5zIHt2b2lkfQ0KICAgICAqIEBtZW1iZXJvZiBNYWluQmFzZQ0KICAgICAqLwoKICB9LCB7CiAgICBrZXk6ICJyb3dEQkxDbGljayIsCiAgICB2YWx1ZTogZnVuY3Rpb24gcm93REJMQ2xpY2soJGV2ZW50KSB7CiAgICAgIGlmICghJGV2ZW50IHx8IHRoaXMuYWN0dWFsSXNPcGVuRWRpdCB8fCBPYmplY3QuaXModGhpcy5ncmlkUm93QWN0aXZlTW9kZSwgMCkpIHsKICAgICAgICByZXR1cm47CiAgICAgIH0KCiAgICAgIHRoaXMuc2VsZWN0aW9ucyA9IFtdOwogICAgICB0aGlzLnNlbGVjdGlvbnMucHVzaChKU09OLnBhcnNlKEpTT04uc3RyaW5naWZ5KCRldmVudCkpKTsKICAgICAgdmFyIHJlZnMgPSB0aGlzLiRyZWZzOwoKICAgICAgaWYgKHJlZnMubXVsdGlwbGVUYWJsZSkgewogICAgICAgIHJlZnMubXVsdGlwbGVUYWJsZS5jbGVhclNlbGVjdGlvbigpOwogICAgICAgIHJlZnMubXVsdGlwbGVUYWJsZS50b2dnbGVSb3dTZWxlY3Rpb24oJGV2ZW50KTsKICAgICAgfQoKICAgICAgdGhpcy4kZW1pdCgncm93ZGJsY2xpY2snLCB0aGlzLnNlbGVjdGlvbnMpOwogICAgICB0aGlzLiRlbWl0KCdzZWxlY3Rpb25jaGFuZ2UnLCB0aGlzLnNlbGVjdGlvbnMpOwogICAgfQogICAgLyoqDQogICAgICog5aSN6YCJ5qGG5pWw5o2u6YCJ5LitDQogICAgICoNCiAgICAgKiBAcGFyYW0geyp9ICRldmVudA0KICAgICAqIEByZXR1cm5zIHt2b2lkfQ0KICAgICAqIEBtZW1iZXJvZiBNYWluQmFzZQ0KICAgICAqLwoKICB9LCB7CiAgICBrZXk6ICJzZWxlY3QiLAogICAgdmFsdWU6IGZ1bmN0aW9uIHNlbGVjdCgkZXZlbnQpIHsKICAgICAgaWYgKCEkZXZlbnQpIHsKICAgICAgICByZXR1cm47CiAgICAgIH0KCiAgICAgIHRoaXMuc2VsZWN0aW9ucyA9IFtdOwogICAgICB0aGlzLnNlbGVjdGlvbnMgPSBfdG9Db25zdW1hYmxlQXJyYXkoSlNPTi5wYXJzZShKU09OLnN0cmluZ2lmeSgkZXZlbnQpKSk7CiAgICAgIHRoaXMuJGVtaXQoJ3NlbGVjdGlvbmNoYW5nZScsIHRoaXMuc2VsZWN0aW9ucyk7CiAgICB9CiAgICAvKioNCiAgICAgKiDlpI3pgInmoYbmlbDmja7lhajpg6jpgInkuK0NCiAgICAgKg0KICAgICAqIEBwYXJhbSB7Kn0gJGV2ZW50DQogICAgICogQG1lbWJlcm9mIE1haW5CYXNlDQogICAgICovCgogIH0sIHsKICAgIGtleTogInNlbGVjdEFsbCIsCiAgICB2YWx1ZTogZnVuY3Rpb24gc2VsZWN0QWxsKCRldmVudCkgewogICAgICBpZiAoISRldmVudCkgewogICAgICAgIHJldHVybjsKICAgICAgfQoKICAgICAgdGhpcy5zZWxlY3Rpb25zID0gW107CiAgICAgIHRoaXMuc2VsZWN0aW9ucyA9IF90b0NvbnN1bWFibGVBcnJheShKU09OLnBhcnNlKEpTT04uc3RyaW5naWZ5KCRldmVudCkpKTsKICAgICAgdGhpcy4kZW1pdCgnc2VsZWN0aW9uY2hhbmdlJywgdGhpcy5zZWxlY3Rpb25zKTsKICAgIH0KICAgIC8qKg0KICAgICAqIOihjOWNleWHu+mAieS4rQ0KICAgICAqDQogICAgICogQHBhcmFtIHsqfSAkZXZlbnQNCiAgICAgKiBAcmV0dXJucyB7dm9pZH0NCiAgICAgKiBAbWVtYmVyb2YgTWFpbkJhc2UNCiAgICAgKi8KCiAgfSwgewogICAga2V5OiAicm93Q2xpY2siLAogICAgdmFsdWU6IGZ1bmN0aW9uIHJvd0NsaWNrKCRldmVudCkgewogICAgICB2YXIgaWZBbHdheXMgPSBhcmd1bWVudHMubGVuZ3RoID4gMSAmJiBhcmd1bWVudHNbMV0gIT09IHVuZGVmaW5lZCA/IGFyZ3VtZW50c1sxXSA6IGZhbHNlOwoKICAgICAgaWYgKCFpZkFsd2F5cyAmJiAoISRldmVudCB8fCB0aGlzLmFjdHVhbElzT3BlbkVkaXQpKSB7CiAgICAgICAgcmV0dXJuOwogICAgICB9CgogICAgICBpZiAodGhpcy5zdG9wUm93Q2xpY2spIHsKICAgICAgICB0aGlzLnN0b3BSb3dDbGljayA9IGZhbHNlOwogICAgICAgIHJldHVybjsKICAgICAgfQoKICAgICAgaWYgKHRoaXMuaXNTaW5nbGVTZWxlY3QpIHsKICAgICAgICB0aGlzLnNlbGVjdGlvbnMgPSBbXTsKICAgICAgfSAvLyDlt7LpgInkuK3liJnliKDpmaTvvIzmsqHpgInkuK3liJnmt7vliqAKCgogICAgICB2YXIgc2VsZWN0SW5kZXggPSB0aGlzLnNlbGVjdGlvbnMuZmluZEluZGV4KGZ1bmN0aW9uIChpdGVtKSB7CiAgICAgICAgcmV0dXJuIE9iamVjdC5pcyhpdGVtLmFyY2hpdmVzY2VudGVyLCAkZXZlbnQuYXJjaGl2ZXNjZW50ZXIpOwogICAgICB9KTsKCiAgICAgIGlmIChPYmplY3QuaXMoc2VsZWN0SW5kZXgsIC0xKSkgewogICAgICAgIHRoaXMuc2VsZWN0aW9ucy5wdXNoKEpTT04ucGFyc2UoSlNPTi5zdHJpbmdpZnkoJGV2ZW50KSkpOwogICAgICB9IGVsc2UgewogICAgICAgIHRoaXMuc2VsZWN0aW9ucy5zcGxpY2Uoc2VsZWN0SW5kZXgsIDEpOwogICAgICB9CgogICAgICB2YXIgcmVmcyA9IHRoaXMuJHJlZnM7CgogICAgICBpZiAocmVmcy5tdWx0aXBsZVRhYmxlKSB7CiAgICAgICAgaWYgKHRoaXMuaXNTaW5nbGVTZWxlY3QpIHsKICAgICAgICAgIHJlZnMubXVsdGlwbGVUYWJsZS5jbGVhclNlbGVjdGlvbigpOwogICAgICAgICAgcmVmcy5tdWx0aXBsZVRhYmxlLnNldEN1cnJlbnRSb3coJGV2ZW50KTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgcmVmcy5tdWx0aXBsZVRhYmxlLnRvZ2dsZVJvd1NlbGVjdGlvbigkZXZlbnQpOwogICAgICAgIH0KICAgICAgfQoKICAgICAgdGhpcy4kZW1pdCgnc2VsZWN0aW9uY2hhbmdlJywgdGhpcy5zZWxlY3Rpb25zKTsKICAgIH0KICAgIC8qKg0KICAgICAqIOmhtemdouWPmOWMlg0KICAgICAqDQogICAgICogQHBhcmFtIHsqfSAkZXZlbnQNCiAgICAgKiBAcmV0dXJucyB7dm9pZH0NCiAgICAgKiBAbWVtYmVyb2YgTWFpbkJhc2UNCiAgICAgKi8KCiAgfSwgewogICAga2V5OiAicGFnZU9uQ2hhbmdlIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBwYWdlT25DaGFuZ2UoJGV2ZW50KSB7CiAgICAgIGlmICghJGV2ZW50KSB7CiAgICAgICAgcmV0dXJuOwogICAgICB9CgogICAgICBpZiAoJGV2ZW50ID09PSB0aGlzLmN1clBhZ2UpIHsKICAgICAgICByZXR1cm47CiAgICAgIH0KCiAgICAgIHRoaXMuY3VyUGFnZSA9ICRldmVudDsKICAgICAgdGhpcy5sb2FkKHt9KTsKICAgIH0KICAgIC8qKg0KICAgICAqIOWIhumhteadoeaVsOWPmOWMlg0KICAgICAqDQogICAgICogQHBhcmFtIHsqfSAkZXZlbnQNCiAgICAgKiBAcmV0dXJucyB7dm9pZH0NCiAgICAgKiBAbWVtYmVyb2YgTWFpbkJhc2UNCiAgICAgKi8KCiAgfSwgewogICAga2V5OiAib25QYWdlU2l6ZUNoYW5nZSIsCiAgICB2YWx1ZTogZnVuY3Rpb24gb25QYWdlU2l6ZUNoYW5nZSgkZXZlbnQpIHsKICAgICAgaWYgKCEkZXZlbnQpIHsKICAgICAgICByZXR1cm47CiAgICAgIH0KCiAgICAgIGlmICgkZXZlbnQgPT09IHRoaXMubGltaXQpIHsKICAgICAgICByZXR1cm47CiAgICAgIH0KCiAgICAgIHRoaXMubGltaXQgPSAkZXZlbnQ7CgogICAgICBpZiAodGhpcy5jdXJQYWdlID09PSAxKSB7CiAgICAgICAgdGhpcy5sb2FkKHt9KTsKICAgICAgfQogICAgfQogICAgLyoqDQogICAgICog5YiG6aG15Yi35pawDQogICAgICoNCiAgICAgKiBAbWVtYmVyb2YgTWFpbkJhc2UNCiAgICAgKi8KCiAgfSwgewogICAga2V5OiAicGFnZVJlZnJlc2giLAogICAgdmFsdWU6IGZ1bmN0aW9uIHBhZ2VSZWZyZXNoKCkgewogICAgICB0aGlzLmxvYWQoe30pOwogICAgfQogICAgLyoqDQogICAgICog5o6S5bqP5Y+Y5YyWDQogICAgICoNCiAgICAgKiBAcGFyYW0ge3sgY29sdW1uOiBhbnksIHByb3A6IGFueSwgb3JkZXI6IGFueSB9fSB7IGNvbHVtbiwgcHJvcCwgb3JkZXIgfQ0KICAgICAqIEBtZW1iZXJvZiBNYWluQmFzZQ0KICAgICAqLwoKICB9LCB7CiAgICBrZXk6ICJvblNvcnRDaGFuZ2UiLAogICAgdmFsdWU6IGZ1bmN0aW9uIG9uU29ydENoYW5nZShfcmVmNCkgewogICAgICB2YXIgY29sdW1uID0gX3JlZjQuY29sdW1uLAogICAgICAgICAgcHJvcCA9IF9yZWY0LnByb3AsCiAgICAgICAgICBvcmRlciA9IF9yZWY0Lm9yZGVyOwogICAgICB2YXIgZGlyID0gT2JqZWN0LmlzKG9yZGVyLCAnYXNjZW5kaW5nJykgPyAnYXNjJyA6IE9iamVjdC5pcyhvcmRlciwgJ2Rlc2NlbmRpbmcnKSA/ICdkZXNjJyA6ICcnOwoKICAgICAgaWYgKE9iamVjdC5pcyhkaXIsIHRoaXMubWlub3JTb3J0RGlyKSAmJiBPYmplY3QuaXModGhpcy5taW5vclNvcnRQU0RFRiwgcHJvcCkpIHsKICAgICAgICByZXR1cm47CiAgICAgIH0KCiAgICAgIHRoaXMubWlub3JTb3J0RGlyID0gZGlyOwogICAgICB0aGlzLm1pbm9yU29ydFBTREVGID0gcHJvcCA/IHByb3AgOiAnJzsKICAgICAgdGhpcy5sb2FkKHt9KTsKICAgIH0KICAgIC8qKg0KICAgICAqIOihqOagvOihjOmAieS4reagt+W8jw0KICAgICAqDQogICAgICogQHBhcmFtIHt7IHJvdzogYW55LCByb3dJbmRleDogYW55IH19IHsgcm93LCByb3dJbmRleCB9DQogICAgICogQHJldHVybnMge3N0cmluZ30NCiAgICAgKiBAbWVtYmVyb2YgTWFpbkJhc2UNCiAgICAgKi8KCiAgfSwgewogICAga2V5OiAib25Sb3dDbGFzc05hbWUiLAogICAgdmFsdWU6IGZ1bmN0aW9uIG9uUm93Q2xhc3NOYW1lKF9yZWY1KSB7CiAgICAgIHZhciByb3cgPSBfcmVmNS5yb3csCiAgICAgICAgICByb3dJbmRleCA9IF9yZWY1LnJvd0luZGV4OwogICAgICB2YXIgaW5kZXggPSB0aGlzLnNlbGVjdGlvbnMuZmluZEluZGV4KGZ1bmN0aW9uIChzZWxlY3QpIHsKICAgICAgICByZXR1cm4gT2JqZWN0LmlzKHNlbGVjdC5zcmZrZXksIHJvdy5zcmZrZXkpOwogICAgICB9KTsKICAgICAgcmV0dXJuIGluZGV4ICE9PSAtMSA/ICdncmlkLXJvdy1zZWxlY3QnIDogJyc7CiAgICB9CiAgICAvKioNCiAgICAgKiDnlYzpnaLooYzkuLoNCiAgICAgKg0KICAgICAqIEBwYXJhbSB7Kn0gcm93DQogICAgICogQHBhcmFtIHsqfSB0YWcNCiAgICAgKiBAcGFyYW0geyp9ICRldmVudA0KICAgICAqIEBtZW1iZXJvZiBNYWluQmFzZQ0KICAgICAqLwoKICB9LCB7CiAgICBrZXk6ICJ1aUFjdGlvbiIsCiAgICB2YWx1ZTogZnVuY3Rpb24gdWlBY3Rpb24ocm93LCB0YWcsICRldmVudCkgewogICAgICAvLyB0aGlzLnJvd0NsaWNrKHJvdywgdHJ1ZSk7CiAgICAgICRldmVudC5zdG9wUHJvcGFnYXRpb24oKTsKICAgIH0KICAgIC8qKg0KICAgICAqIOiuvue9ruWIl+eKtuaAgQ0KICAgICAqDQogICAgICogQG1lbWJlcm9mIE1haW5CYXNlDQogICAgICovCgogIH0sIHsKICAgIGtleTogInNldENvbFN0YXRlIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBzZXRDb2xTdGF0ZSgpIHsKICAgICAgdmFyIF90aGlzMTEgPSB0aGlzOwoKICAgICAgdmFyIF9kYXRhID0gbG9jYWxTdG9yYWdlLmdldEl0ZW0oJ2FyY2hpdmVzY2VudGVyX21haW5fZ3JpZCcpOwoKICAgICAgaWYgKF9kYXRhKSB7CiAgICAgICAgdmFyIGNvbHVtbnMgPSBKU09OLnBhcnNlKF9kYXRhKTsKICAgICAgICBjb2x1bW5zLmZvckVhY2goZnVuY3Rpb24gKGNvbCkgewogICAgICAgICAgdmFyIGNvbHVtbiA9IF90aGlzMTEuYWxsQ29sdW1ucy5maW5kKGZ1bmN0aW9uIChpdGVtKSB7CiAgICAgICAgICAgIHJldHVybiBPYmplY3QuaXMoY29sLm5hbWUsIGl0ZW0ubmFtZSk7CiAgICAgICAgICB9KTsKCiAgICAgICAgICBpZiAoY29sdW1uKSB7CiAgICAgICAgICAgIE9iamVjdC5hc3NpZ24oY29sdW1uLCBjb2wpOwogICAgICAgICAgfQogICAgICAgIH0pOwogICAgICB9CiAgICB9CiAgICAvKioNCiAgICAgKiDliJflj5jljJYNCiAgICAgKg0KICAgICAqIEBtZW1iZXJvZiBNYWluQmFzZQ0KICAgICAqLwoKICB9LCB7CiAgICBrZXk6ICJvbkNvbENoYW5nZSIsCiAgICB2YWx1ZTogZnVuY3Rpb24gb25Db2xDaGFuZ2UoKSB7CiAgICAgIGxvY2FsU3RvcmFnZS5zZXRJdGVtKCdhcmNoaXZlc2NlbnRlcl9tYWluX2dyaWQnLCBKU09OLnN0cmluZ2lmeSh0aGlzLmFsbENvbHVtbnMpKTsKICAgIH0KICAgIC8qKg0KICAgICAqIOiOt+WPluWIl+eKtuaAgQ0KICAgICAqDQogICAgICogQHBhcmFtIHtzdHJpbmd9IG5hbWUNCiAgICAgKiBAcmV0dXJucyB7Ym9vbGVhbn0NCiAgICAgKiBAbWVtYmVyb2YgTWFpbkJhc2UNCiAgICAgKi8KCiAgfSwgewogICAga2V5OiAiZ2V0Q29sdW1uU3RhdGUiLAogICAgdmFsdWU6IGZ1bmN0aW9uIGdldENvbHVtblN0YXRlKG5hbWUpIHsKICAgICAgdmFyIGNvbHVtbiA9IHRoaXMuYWxsQ29sdW1ucy5maW5kKGZ1bmN0aW9uIChjb2wpIHsKICAgICAgICByZXR1cm4gT2JqZWN0LmlzKG5hbWUsIGNvbC5uYW1lKTsKICAgICAgfSk7CiAgICAgIHJldHVybiBjb2x1bW4uc2hvdyA/IHRydWUgOiBmYWxzZTsKICAgIH0KICAgIC8qKg0KICAgICAqIOihqOagvOWIl+aYr+WQpuiHqumAguW6lOW4g+WxgA0KICAgICAqDQogICAgICogQHJlYWRvbmx5DQogICAgICogQHR5cGUge2Jvb2xlYW59DQogICAgICogQG1lbWJlcm9mIE1haW5CYXNlDQogICAgICovCgogIH0sIHsKICAgIGtleTogInNhdmUiLAoKICAgIC8qKg0KICAgICAqIOS/neWtmA0KICAgICAqDQogICAgICogQHBhcmFtIHsqfSAkZXZlbnQNCiAgICAgKiBAcmV0dXJucyB7UHJvbWlzZTxhbnk+fQ0KICAgICAqIEBtZW1iZXJvZiBNYWluQmFzZQ0KICAgICAqLwogICAgdmFsdWU6IGZ1bmN0aW9uICgpIHsKICAgICAgdmFyIF9zYXZlID0gX2FzeW5jVG9HZW5lcmF0b3IoCiAgICAgIC8qI19fUFVSRV9fKi8KICAgICAgcmVnZW5lcmF0b3JSdW50aW1lLm1hcmsoZnVuY3Rpb24gX2NhbGxlZTUoYXJncywgcGFyYW1zLCAkZXZlbnQsIHhEYXRhKSB7CiAgICAgICAgdmFyIF90aGlzMTIgPSB0aGlzOwoKICAgICAgICB2YXIgX3RoaXMsIHN1Y2Nlc3NJdGVtcywgZXJyb3JJdGVtcywgZXJyb3JNZXNzYWdlLCBfaXRlcmF0b3JOb3JtYWxDb21wbGV0aW9uMiwgX2RpZEl0ZXJhdG9yRXJyb3IyLCBfaXRlcmF0b3JFcnJvcjIsIF9pdGVyYXRvcjIsIF9zdGVwMiwgaXRlbSwgcmVzcG9uc2UsIF9yZXNwb25zZTsKCiAgICAgICAgcmV0dXJuIHJlZ2VuZXJhdG9yUnVudGltZS53cmFwKGZ1bmN0aW9uIF9jYWxsZWU1JChfY29udGV4dDYpIHsKICAgICAgICAgIHdoaWxlICgxKSB7CiAgICAgICAgICAgIHN3aXRjaCAoX2NvbnRleHQ2LnByZXYgPSBfY29udGV4dDYubmV4dCkgewogICAgICAgICAgICAgIGNhc2UgMDoKICAgICAgICAgICAgICAgIF90aGlzID0gdGhpczsKICAgICAgICAgICAgICAgIF9jb250ZXh0Ni5uZXh0ID0gMzsKICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLnZhbGlkYXRlQWxsKCk7CgogICAgICAgICAgICAgIGNhc2UgMzoKICAgICAgICAgICAgICAgIGlmIChfY29udGV4dDYuc2VudCkgewogICAgICAgICAgICAgICAgICBfY29udGV4dDYubmV4dCA9IDY7CiAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIHRoaXMuJE5vdGljZS5lcnJvcih7CiAgICAgICAgICAgICAgICAgIHRpdGxlOiAn6ZSZ6K+vJywKICAgICAgICAgICAgICAgICAgZGVzYzogJ+WAvOinhOWImeagoemqjOW8guW4uCcKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0Ni5hYnJ1cHQoInJldHVybiIsIFtdKTsKCiAgICAgICAgICAgICAgY2FzZSA2OgogICAgICAgICAgICAgICAgc3VjY2Vzc0l0ZW1zID0gW107CiAgICAgICAgICAgICAgICBlcnJvckl0ZW1zID0gW107CiAgICAgICAgICAgICAgICBlcnJvck1lc3NhZ2UgPSBbXTsKICAgICAgICAgICAgICAgIF9pdGVyYXRvck5vcm1hbENvbXBsZXRpb24yID0gdHJ1ZTsKICAgICAgICAgICAgICAgIF9kaWRJdGVyYXRvckVycm9yMiA9IGZhbHNlOwogICAgICAgICAgICAgICAgX2l0ZXJhdG9yRXJyb3IyID0gdW5kZWZpbmVkOwogICAgICAgICAgICAgICAgX2NvbnRleHQ2LnByZXYgPSAxMjsKICAgICAgICAgICAgICAgIF9pdGVyYXRvcjIgPSBfdGhpcy5pdGVtc1tTeW1ib2wuaXRlcmF0b3JdKCk7CgogICAgICAgICAgICAgIGNhc2UgMTQ6CiAgICAgICAgICAgICAgICBpZiAoX2l0ZXJhdG9yTm9ybWFsQ29tcGxldGlvbjIgPSAoX3N0ZXAyID0gX2l0ZXJhdG9yMi5uZXh0KCkpLmRvbmUpIHsKICAgICAgICAgICAgICAgICAgX2NvbnRleHQ2Lm5leHQgPSA0OTsKICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgaXRlbSA9IF9zdGVwMi52YWx1ZTsKICAgICAgICAgICAgICAgIF9jb250ZXh0Ni5wcmV2ID0gMTY7CgogICAgICAgICAgICAgICAgaWYgKCFPYmplY3QuaXMoaXRlbS5yb3dEYXRhU3RhdGUsICdjcmVhdGUnKSkgewogICAgICAgICAgICAgICAgICBfY29udGV4dDYubmV4dCA9IDI5OwogICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBpZiAodGhpcy5jcmVhdGVBY3Rpb24pIHsKICAgICAgICAgICAgICAgICAgX2NvbnRleHQ2Lm5leHQgPSAyMjsKICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgdGhpcy4kTm90aWNlLmVycm9yKHsKICAgICAgICAgICAgICAgICAgdGl0bGU6ICfplJnor68nLAogICAgICAgICAgICAgICAgICBkZXNjOiAnQVJDSElWRVNDRU5URVJHcmlkVmlld+inhuWbvuihqOagvGNyZWF0ZUFjdGlvbuWPguaVsOacqumFjee9ricKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgX2NvbnRleHQ2Lm5leHQgPSAyNzsKICAgICAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgICAgICBjYXNlIDIyOgogICAgICAgICAgICAgICAgT2JqZWN0LmFzc2lnbihpdGVtLCB7CiAgICAgICAgICAgICAgICAgIHZpZXdwYXJhbXM6IHRoaXMudmlld3BhcmFtcwogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICBfY29udGV4dDYubmV4dCA9IDI1OwogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuc2VydmljZS5hZGQodGhpcy5jcmVhdGVBY3Rpb24sIEpTT04ucGFyc2UoSlNPTi5zdHJpbmdpZnkodGhpcy5jb250ZXh0KSksIGl0ZW0sIHRoaXMuc2hvd0J1c3lJbmRpY2F0b3IpOwoKICAgICAgICAgICAgICBjYXNlIDI1OgogICAgICAgICAgICAgICAgcmVzcG9uc2UgPSBfY29udGV4dDYuc2VudDsKICAgICAgICAgICAgICAgIHN1Y2Nlc3NJdGVtcy5wdXNoKEpTT04ucGFyc2UoSlNPTi5zdHJpbmdpZnkocmVzcG9uc2UuZGF0YSkpKTsKCiAgICAgICAgICAgICAgY2FzZSAyNzoKICAgICAgICAgICAgICAgIF9jb250ZXh0Ni5uZXh0ID0gNDA7CiAgICAgICAgICAgICAgICBicmVhazsKCiAgICAgICAgICAgICAgY2FzZSAyOToKICAgICAgICAgICAgICAgIGlmICghT2JqZWN0LmlzKGl0ZW0ucm93RGF0YVN0YXRlLCAndXBkYXRlJykpIHsKICAgICAgICAgICAgICAgICAgX2NvbnRleHQ2Lm5leHQgPSA0MDsKICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgaWYgKHRoaXMudXBkYXRlQWN0aW9uKSB7CiAgICAgICAgICAgICAgICAgIF9jb250ZXh0Ni5uZXh0ID0gMzQ7CiAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIHRoaXMuJE5vdGljZS5lcnJvcih7CiAgICAgICAgICAgICAgICAgIHRpdGxlOiAn6ZSZ6K+vJywKICAgICAgICAgICAgICAgICAgZGVzYzogJ0FSQ0hJVkVTQ0VOVEVSR3JpZFZpZXfop4blm77ooajmoLx1cGRhdGVBY3Rpb27lj4LmlbDmnKrphY3nva4nCiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIF9jb250ZXh0Ni5uZXh0ID0gNDA7CiAgICAgICAgICAgICAgICBicmVhazsKCiAgICAgICAgICAgICAgY2FzZSAzNDoKICAgICAgICAgICAgICAgIE9iamVjdC5hc3NpZ24oaXRlbSwgewogICAgICAgICAgICAgICAgICB2aWV3cGFyYW1zOiB0aGlzLnZpZXdwYXJhbXMKICAgICAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgICAgIGlmIChpdGVtLnBpbWFyY2hpdmVzY2VudGVyKSB7CiAgICAgICAgICAgICAgICAgIE9iamVjdC5hc3NpZ24odGhpcy5jb250ZXh0LCB7CiAgICAgICAgICAgICAgICAgICAgcGltYXJjaGl2ZXNjZW50ZXI6IGl0ZW0ucGltYXJjaGl2ZXNjZW50ZXIKICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgX2NvbnRleHQ2Lm5leHQgPSAzODsKICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLnNlcnZpY2UuYWRkKHRoaXMudXBkYXRlQWN0aW9uLCBKU09OLnBhcnNlKEpTT04uc3RyaW5naWZ5KHRoaXMuY29udGV4dCkpLCBpdGVtLCB0aGlzLnNob3dCdXN5SW5kaWNhdG9yKTsKCiAgICAgICAgICAgICAgY2FzZSAzODoKICAgICAgICAgICAgICAgIF9yZXNwb25zZSA9IF9jb250ZXh0Ni5zZW50OwogICAgICAgICAgICAgICAgc3VjY2Vzc0l0ZW1zLnB1c2goSlNPTi5wYXJzZShKU09OLnN0cmluZ2lmeShfcmVzcG9uc2UuZGF0YSkpKTsKCiAgICAgICAgICAgICAgY2FzZSA0MDoKICAgICAgICAgICAgICAgIF9jb250ZXh0Ni5uZXh0ID0gNDY7CiAgICAgICAgICAgICAgICBicmVhazsKCiAgICAgICAgICAgICAgY2FzZSA0MjoKICAgICAgICAgICAgICAgIF9jb250ZXh0Ni5wcmV2ID0gNDI7CiAgICAgICAgICAgICAgICBfY29udGV4dDYudDAgPSBfY29udGV4dDZbImNhdGNoIl0oMTYpOwogICAgICAgICAgICAgICAgZXJyb3JJdGVtcy5wdXNoKEpTT04ucGFyc2UoSlNPTi5zdHJpbmdpZnkoaXRlbSkpKTsKICAgICAgICAgICAgICAgIGVycm9yTWVzc2FnZS5wdXNoKF9jb250ZXh0Ni50MCk7CgogICAgICAgICAgICAgIGNhc2UgNDY6CiAgICAgICAgICAgICAgICBfaXRlcmF0b3JOb3JtYWxDb21wbGV0aW9uMiA9IHRydWU7CiAgICAgICAgICAgICAgICBfY29udGV4dDYubmV4dCA9IDE0OwogICAgICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgICAgIGNhc2UgNDk6CiAgICAgICAgICAgICAgICBfY29udGV4dDYubmV4dCA9IDU1OwogICAgICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgICAgIGNhc2UgNTE6CiAgICAgICAgICAgICAgICBfY29udGV4dDYucHJldiA9IDUxOwogICAgICAgICAgICAgICAgX2NvbnRleHQ2LnQxID0gX2NvbnRleHQ2WyJjYXRjaCJdKDEyKTsKICAgICAgICAgICAgICAgIF9kaWRJdGVyYXRvckVycm9yMiA9IHRydWU7CiAgICAgICAgICAgICAgICBfaXRlcmF0b3JFcnJvcjIgPSBfY29udGV4dDYudDE7CgogICAgICAgICAgICAgIGNhc2UgNTU6CiAgICAgICAgICAgICAgICBfY29udGV4dDYucHJldiA9IDU1OwogICAgICAgICAgICAgICAgX2NvbnRleHQ2LnByZXYgPSA1NjsKCiAgICAgICAgICAgICAgICBpZiAoIV9pdGVyYXRvck5vcm1hbENvbXBsZXRpb24yICYmIF9pdGVyYXRvcjJbInJldHVybiJdICE9IG51bGwpIHsKICAgICAgICAgICAgICAgICAgX2l0ZXJhdG9yMlsicmV0dXJuIl0oKTsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgY2FzZSA1ODoKICAgICAgICAgICAgICAgIF9jb250ZXh0Ni5wcmV2ID0gNTg7CgogICAgICAgICAgICAgICAgaWYgKCFfZGlkSXRlcmF0b3JFcnJvcjIpIHsKICAgICAgICAgICAgICAgICAgX2NvbnRleHQ2Lm5leHQgPSA2MTsKICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgdGhyb3cgX2l0ZXJhdG9yRXJyb3IyOwoKICAgICAgICAgICAgICBjYXNlIDYxOgogICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0Ni5maW5pc2goNTgpOwoKICAgICAgICAgICAgICBjYXNlIDYyOgogICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0Ni5maW5pc2goNTUpOwoKICAgICAgICAgICAgICBjYXNlIDYzOgogICAgICAgICAgICAgICAgdGhpcy4kZW1pdCgnc2F2ZScsIHN1Y2Nlc3NJdGVtcyk7CiAgICAgICAgICAgICAgICB0aGlzLnJlZnJlc2goW10pOwoKICAgICAgICAgICAgICAgIGlmIChlcnJvckl0ZW1zLmxlbmd0aCA9PT0gMCkgewogICAgICAgICAgICAgICAgICB0aGlzLiROb3RpY2Uuc3VjY2Vzcyh7CiAgICAgICAgICAgICAgICAgICAgdGl0bGU6ICcnLAogICAgICAgICAgICAgICAgICAgIGRlc2M6ICfkv53lrZjmiJDlip8hJwogICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgIGVycm9ySXRlbXMuZm9yRWFjaChmdW5jdGlvbiAoaXRlbSwgaW5kZXgpIHsKICAgICAgICAgICAgICAgICAgICBfdGhpczEyLiROb3RpY2UuZXJyb3IoewogICAgICAgICAgICAgICAgICAgICAgdGl0bGU6ICfkv53lrZjlpLHotKUnLAogICAgICAgICAgICAgICAgICAgICAgZGVzYzogaXRlbS5tYWpvcmVudGl0eW5hbWUgKyAn5L+d5a2Y5aSx6LSl77yBJwogICAgICAgICAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmVycm9yKGVycm9yTWVzc2FnZVtpbmRleF0pOwogICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQ2LmFicnVwdCgicmV0dXJuIiwgc3VjY2Vzc0l0ZW1zKTsKCiAgICAgICAgICAgICAgY2FzZSA2NzoKICAgICAgICAgICAgICBjYXNlICJlbmQiOgogICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0Ni5zdG9wKCk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9LCBfY2FsbGVlNSwgdGhpcywgW1sxMiwgNTEsIDU1LCA2M10sIFsxNiwgNDJdLCBbNTYsLCA1OCwgNjJdXSk7CiAgICAgIH0pKTsKCiAgICAgIGZ1bmN0aW9uIHNhdmUoX3g1LCBfeDYsIF94NywgX3g4KSB7CiAgICAgICAgcmV0dXJuIF9zYXZlLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7CiAgICAgIH0KCiAgICAgIHJldHVybiBzYXZlOwogICAgfSgpCiAgICAvKioNCiAgICAgKiDmlrDlu7rooYwNCiAgICAgKg0KICAgICAqIEBwYXJhbSB7Kn0gJGV2ZW50DQogICAgICogQHJldHVybnMge3ZvaWR9DQogICAgICogQG1lbWJlcm9mIE1haW5CYXNlDQogICAgICovCgogIH0sIHsKICAgIGtleTogIm5ld1JvdyIsCiAgICB2YWx1ZTogZnVuY3Rpb24gbmV3Um93KGFyZ3MsIHBhcmFtcywgJGV2ZW50LCB4RGF0YSkgewogICAgICB2YXIgX3RoaXMxMyA9IHRoaXM7CgogICAgICBpZiAoIXRoaXMubG9hZGRyYWZ0QWN0aW9uKSB7CiAgICAgICAgdGhpcy4kTm90aWNlLmVycm9yKHsKICAgICAgICAgIHRpdGxlOiAn6ZSZ6K+vJywKICAgICAgICAgIGRlc2M6ICdBUkNISVZFU0NFTlRFUkdyaWRWaWV36KeG5Zu+6KGo5qC8bG9hZGRyYWZ0QWN0aW9u5Y+C5pWw5pyq6YWN572uJwogICAgICAgIH0pOwogICAgICAgIHJldHVybjsKICAgICAgfQoKICAgICAgdmFyIF90aGlzID0gdGhpczsKCiAgICAgIE9iamVjdC5hc3NpZ24oYXJnc1swXSwgewogICAgICAgIHZpZXdwYXJhbXM6IHRoaXMudmlld3BhcmFtcwogICAgICB9KTsKICAgICAgdmFyIHBvc3QgPSB0aGlzLnNlcnZpY2UubG9hZERyYWZ0KHRoaXMubG9hZGRyYWZ0QWN0aW9uLCBKU09OLnBhcnNlKEpTT04uc3RyaW5naWZ5KHRoaXMuY29udGV4dCkpLCBhcmdzWzBdLCB0aGlzLnNob3dCdXN5SW5kaWNhdG9yKTsKICAgICAgcG9zdC50aGVuKGZ1bmN0aW9uIChyZXNwb25zZSkgewogICAgICAgIGlmICghcmVzcG9uc2Uuc3RhdHVzIHx8IHJlc3BvbnNlLnN0YXR1cyAhPT0gMjAwKSB7CiAgICAgICAgICBpZiAocmVzcG9uc2UuZXJyb3JNZXNzYWdlKSB7CiAgICAgICAgICAgIF90aGlzMTMuJE5vdGljZS5lcnJvcih7CiAgICAgICAgICAgICAgdGl0bGU6ICfplJnor68nLAogICAgICAgICAgICAgIGRlc2M6IHJlc3BvbnNlLmVycm9yTWVzc2FnZQogICAgICAgICAgICB9KTsKICAgICAgICAgIH0KCiAgICAgICAgICByZXR1cm47CiAgICAgICAgfQoKICAgICAgICB2YXIgZGF0YSA9IHJlc3BvbnNlLmRhdGE7CgogICAgICAgIF90aGlzMTMuY3JlYXRlRGVmYXVsdChkYXRhKTsKCiAgICAgICAgZGF0YS5yb3dEYXRhU3RhdGUgPSAiY3JlYXRlIjsKCiAgICAgICAgX3RoaXMuaXRlbXMucHVzaChkYXRhKTsKCiAgICAgICAgX3RoaXMuZ3JpZEl0ZW1zTW9kZWwucHVzaChfdGhpcy5nZXRHcmlkUm93TW9kZWwoKSk7CiAgICAgIH0pWyJjYXRjaCJdKGZ1bmN0aW9uIChyZXNwb25zZSkgewogICAgICAgIGlmIChyZXNwb25zZSAmJiByZXNwb25zZS5zdGF0dXMgPT09IDQwMSkgewogICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KCiAgICAgICAgaWYgKCFyZXNwb25zZSB8fCAhcmVzcG9uc2Uuc3RhdHVzIHx8ICFyZXNwb25zZS5kYXRhKSB7CiAgICAgICAgICBfdGhpczEzLiROb3RpY2UuZXJyb3IoewogICAgICAgICAgICB0aXRsZTogJ+mUmeivrycsCiAgICAgICAgICAgIGRlc2M6ICfns7vnu5/lvILluLgnCiAgICAgICAgICB9KTsKCiAgICAgICAgICByZXR1cm47CiAgICAgICAgfQogICAgICB9KTsKICAgIH0KICAgIC8qKg0KICAgICAqIOihqOagvOe8lui+kemhueWAvOWPmOabtA0KICAgICAqDQogICAgICogQHBhcmFtIHJvdyDooYzmlbDmja4NCiAgICAgKiBAcGFyYW0ge3sgbmFtZTogc3RyaW5nLCB2YWx1ZTogYW55IH19ICRldmVudA0KICAgICAqIEByZXR1cm5zIHt2b2lkfQ0KICAgICAqIEBtZW1iZXJvZiBNYWluQmFzZQ0KICAgICAqLwoKICB9LCB7CiAgICBrZXk6ICJvbkdyaWRJdGVtVmFsdWVDaGFuZ2UiLAogICAgdmFsdWU6IGZ1bmN0aW9uIG9uR3JpZEl0ZW1WYWx1ZUNoYW5nZShyb3csICRldmVudCwgcm93SW5kZXgpIHsKICAgICAgaWYgKCEkZXZlbnQpIHsKICAgICAgICByZXR1cm47CiAgICAgIH0KCiAgICAgIGlmICghJGV2ZW50Lm5hbWUgfHwgT2JqZWN0LmlzKCRldmVudC5uYW1lLCAnJykgfHwgIXJvdy5oYXNPd25Qcm9wZXJ0eSgkZXZlbnQubmFtZSkpIHsKICAgICAgICByZXR1cm47CiAgICAgIH0KCiAgICAgIHJvd1skZXZlbnQubmFtZV0gPSAkZXZlbnQudmFsdWU7CiAgICAgIHRoaXMuZ3JpZEVkaXRJdGVtQ2hhbmdlKHJvdywgJGV2ZW50Lm5hbWUsICRldmVudC52YWx1ZSwgcm93SW5kZXgpOwogICAgfQogICAgLyoqDQogICAgICog6KGo5qC857yW6L6R6aG55YC85Y+Y5YyWDQogICAgICoNCiAgICAgKiBAcHVibGljDQogICAgICogQHBhcmFtIHJvdyDooYzmlbDmja4NCiAgICAgKiBAcGFyYW0gcHJvcGVydHkg5YiX57yW6L6R6aG55ZCNDQogICAgICogQHBhcmFtIHJvdyDliJfnvJbovpHpobnlgLwNCiAgICAgKiBAcmV0dXJucyB7dm9pZH0NCiAgICAgKiBAbWVtYmVyb2YgTWFpbkJhc2UNCiAgICAgKi8KCiAgfSwgewogICAga2V5OiAiZ3JpZEVkaXRJdGVtQ2hhbmdlIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBncmlkRWRpdEl0ZW1DaGFuZ2Uocm93LCBwcm9wZXJ0eSwgdmFsdWUsIHJvd0luZGV4KSB7CiAgICAgIHJvdy5yb3dEYXRhU3RhdGUgPSByb3cucm93RGF0YVN0YXRlID8gcm93LnJvd0RhdGFTdGF0ZSA6ICJ1cGRhdGUiOwogICAgICB0aGlzLnZhbGlkYXRlKHByb3BlcnR5LCByb3csIHJvd0luZGV4KTsKICAgIH0KICAgIC8qKg0KICAgICAqIOihqOagvOe8lui+kemhueabtOaWsA0KICAgICAqDQogICAgICogQHBhcmFtIHtzdHJpbmd9IG1vZGUg55WM6Z2i6KGM5Li65ZCN56ewDQogICAgICogQHBhcmFtIHsqfSBbZGF0YT17fV0g6K+35rGC5pWw5o2uDQogICAgICogQHBhcmFtIHtzdHJpbmdbXX0gdXBkYXRlRGV0YWlscyDmm7TmlrDpobkNCiAgICAgKiBAcGFyYW0ge2Jvb2xlYW59IFtzaG93bG9hZGluZ10g5piv5ZCm5pi+56S65Yqg6L2954q25oCBDQogICAgICogQHJldHVybnMge3ZvaWR9DQogICAgICogQG1lbWJlcm9mIE1haW5CYXNlDQogICAgICovCgogIH0sIHsKICAgIGtleTogInVwZGF0ZUdyaWRFZGl0SXRlbSIsCiAgICB2YWx1ZTogZnVuY3Rpb24gdXBkYXRlR3JpZEVkaXRJdGVtKG1vZGUpIHsKICAgICAgdmFyIF90aGlzMTQgPSB0aGlzOwoKICAgICAgdmFyIGRhdGEgPSBhcmd1bWVudHMubGVuZ3RoID4gMSAmJiBhcmd1bWVudHNbMV0gIT09IHVuZGVmaW5lZCA/IGFyZ3VtZW50c1sxXSA6IHt9OwogICAgICB2YXIgdXBkYXRlRGV0YWlscyA9IGFyZ3VtZW50cy5sZW5ndGggPiAyID8gYXJndW1lbnRzWzJdIDogdW5kZWZpbmVkOwogICAgICB2YXIgc2hvd2xvYWRpbmcgPSBhcmd1bWVudHMubGVuZ3RoID4gMyA/IGFyZ3VtZW50c1szXSA6IHVuZGVmaW5lZDsKCiAgICAgIGlmICghbW9kZSB8fCBtb2RlICYmIE9iamVjdC5pcyhtb2RlLCAnJykpIHsKICAgICAgICByZXR1cm47CiAgICAgIH0KCiAgICAgIHZhciBhcmcgPSBKU09OLnBhcnNlKEpTT04uc3RyaW5naWZ5KGRhdGEpKTsKICAgICAgT2JqZWN0LmFzc2lnbihhcmcsIHsKICAgICAgICB2aWV3cGFyYW1zOiB0aGlzLnZpZXdwYXJhbXMKICAgICAgfSk7CiAgICAgIHZhciBwb3N0ID0gdGhpcy5zZXJ2aWNlLmZyb250TG9naWMobW9kZSwgSlNPTi5wYXJzZShKU09OLnN0cmluZ2lmeSh0aGlzLmNvbnRleHQpKSwgYXJnLCBzaG93bG9hZGluZyk7CiAgICAgIHBvc3QudGhlbihmdW5jdGlvbiAocmVzcG9uc2UpIHsKICAgICAgICBpZiAoIXJlc3BvbnNlIHx8IHJlc3BvbnNlLnN0YXR1cyAhPT0gMjAwKSB7CiAgICAgICAgICBfdGhpczE0LiROb3RpY2UuZXJyb3IoewogICAgICAgICAgICB0aXRsZTogJ+mUmeivrycsCiAgICAgICAgICAgIGRlc2M6ICfooajljZXpobnmm7TmlrDlpLHotKUnCiAgICAgICAgICB9KTsKCiAgICAgICAgICByZXR1cm47CiAgICAgICAgfQoKICAgICAgICB2YXIgX2RhdGEgPSByZXNwb25zZS5kYXRhOwoKICAgICAgICBpZiAoIV9kYXRhKSB7CiAgICAgICAgICByZXR1cm47CiAgICAgICAgfQoKICAgICAgICB1cGRhdGVEZXRhaWxzLmZvckVhY2goZnVuY3Rpb24gKG5hbWUpIHsKICAgICAgICAgIGlmICghX2RhdGEuaGFzT3duUHJvcGVydHkobmFtZSkpIHsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgfQoKICAgICAgICAgIGRhdGFbbmFtZV0gPSBfZGF0YVtuYW1lXTsKICAgICAgICB9KTsKICAgICAgfSlbImNhdGNoIl0oZnVuY3Rpb24gKHJlc3BvbnNlKSB7CiAgICAgICAgaWYgKHJlc3BvbnNlICYmIHJlc3BvbnNlLnN0YXR1cyA9PT0gNDAxKSB7CiAgICAgICAgICByZXR1cm47CiAgICAgICAgfQoKICAgICAgICBpZiAoIXJlc3BvbnNlIHx8ICFyZXNwb25zZS5zdGF0dXMgfHwgIXJlc3BvbnNlLmRhdGEpIHsKICAgICAgICAgIF90aGlzMTQuJE5vdGljZS5lcnJvcih7CiAgICAgICAgICAgIHRpdGxlOiAn6ZSZ6K+vJywKICAgICAgICAgICAgZGVzYzogJ+ezu+e7n+W8guW4uCcKICAgICAgICAgIH0pOwoKICAgICAgICAgIHJldHVybjsKICAgICAgICB9CiAgICAgIH0pOwogICAgfQogICAgLyoqDQogICAgICog6I635Y+W5a+55bqU6KGMY2xhc3MNCiAgICAgKg0KICAgICAqIEBwYXJhbSB7Kn0gJGFyZ3Mgcm93IOihjOaVsOaNru+8jHJvd0luZGV4IOihjOe0ouW8lQ0KICAgICAqIEByZXR1cm5zIHt2b2lkfQ0KICAgICAqIEBtZW1iZXJvZiBNYWluQmFzZQ0KICAgICAqLwoKICB9LCB7CiAgICBrZXk6ICJnZXRSb3dDbGFzc05hbWUiLAogICAgdmFsdWU6IGZ1bmN0aW9uIGdldFJvd0NsYXNzTmFtZShhcmdzKSB7CiAgICAgIHZhciBpc1NlbGVjdGVkID0gdGhpcy5zZWxlY3Rpb25zLnNvbWUoZnVuY3Rpb24gKGl0ZW0pIHsKICAgICAgICByZXR1cm4gT2JqZWN0LmlzKGl0ZW0ucGltYXJjaGl2ZXNjZW50ZXIsIGFyZ3Mucm93LnBpbWFyY2hpdmVzY2VudGVyKTsKICAgICAgfSk7CiAgICAgIHJldHVybiBpc1NlbGVjdGVkID8gImdyaWQtc2VsZWN0ZWQtcm93IiA6ICIiOwogICAgfQogICAgLyoqDQogICAgICog6I635Y+W5a+55bqU5YiXY2xhc3MNCiAgICAgKg0KICAgICAqIEBwYXJhbSB7Kn0gJGFyZ3Mgcm93IOihjOaVsOaNru+8jGNvbHVtbiDliJfmlbDmja7vvIxyb3dJbmRleCDooYzntKLlvJXvvIzliJfntKLlvJUNCiAgICAgKiBAcmV0dXJucyB7dm9pZH0NCiAgICAgKiBAbWVtYmVyb2YgTWFpbkJhc2UNCiAgICAgKi8KCiAgfSwgewogICAga2V5OiAiZ2V0Q2VsbENsYXNzTmFtZSIsCiAgICB2YWx1ZTogZnVuY3Rpb24gZ2V0Q2VsbENsYXNzTmFtZShhcmdzKSB7CiAgICAgIHZhciBoYXNSb3dFZGl0ID0gewogICAgICAgICdzZXJpYWxubyc6IHRydWUsCiAgICAgICAgJ2FyY2hpdmVzY2VudGVybmFtZSc6IHRydWUsCiAgICAgICAgJ2NhYmluZXRubyc6IHRydWUsCiAgICAgICAgJ2xheWVybm8nOiB0cnVlLAogICAgICAgICdibnVtYmVyJzogdHJ1ZQogICAgICB9OwogICAgICByZXR1cm4gaGFzUm93RWRpdFthcmdzLmNvbHVtbi5wcm9wZXJ0eV0gJiYgdGhpcy5hY3R1YWxJc09wZW5FZGl0ID8gImVkaXQtY2VsbCIgOiAiaW5mby1jZWxsIjsKICAgIH0KICAgIC8qKg0KICAgICAqIOaWsOW7uum7mOiupOWAvA0KICAgICAqIEBwYXJhbSB7Kn0gIHJvdyDooYzmlbDmja4NCiAgICAgKiBAbWVtYmVyb2YgTWFpbkJhc2UNCiAgICAgKi8KCiAgfSwgewogICAga2V5OiAiY3JlYXRlRGVmYXVsdCIsCiAgICB2YWx1ZTogZnVuY3Rpb24gY3JlYXRlRGVmYXVsdChyb3cpIHt9CiAgfSwgewogICAga2V5OiAiYWRhcHRpdmVTdGF0ZSIsCiAgICBnZXQ6IGZ1bmN0aW9uIGdldCgpIHsKICAgICAgcmV0dXJuICF0aGlzLmFsbENvbHVtbnMuZmluZChmdW5jdGlvbiAoY29sdW1uKSB7CiAgICAgICAgcmV0dXJuIGNvbHVtbi5zaG93ICYmIE9iamVjdC5pcyhjb2x1bW4udXRpbCwgJ1NUQVInKTsKICAgICAgfSk7CiAgICB9CiAgfV0pOwoKICByZXR1cm4gTWFpbkJhc2U7Cn0oVnVlKTsKCnRzbGliXzEuX19kZWNvcmF0ZShbUHJvcCgpXSwgTWFpbkJhc2UucHJvdG90eXBlLCAibmFtZSIsIHZvaWQgMCk7Cgp0c2xpYl8xLl9fZGVjb3JhdGUoW1Byb3AoKV0sIE1haW5CYXNlLnByb3RvdHlwZSwgInZpZXdTdGF0ZSIsIHZvaWQgMCk7Cgp0c2xpYl8xLl9fZGVjb3JhdGUoW1Byb3AoKV0sIE1haW5CYXNlLnByb3RvdHlwZSwgImNvbnRleHQiLCB2b2lkIDApOwoKdHNsaWJfMS5fX2RlY29yYXRlKFtQcm9wKCldLCBNYWluQmFzZS5wcm90b3R5cGUsICJ2aWV3cGFyYW1zIiwgdm9pZCAwKTsKCnRzbGliXzEuX19kZWNvcmF0ZShbUHJvcCgpXSwgTWFpbkJhc2UucHJvdG90eXBlLCAibmV3ZGF0YSIsIHZvaWQgMCk7Cgp0c2xpYl8xLl9fZGVjb3JhdGUoW1Byb3AoKV0sIE1haW5CYXNlLnByb3RvdHlwZSwgIm9wZW5kYXRhIiwgdm9pZCAwKTsKCnRzbGliXzEuX19kZWNvcmF0ZShbUHJvcCh7CiAgImRlZmF1bHQiOiB0cnVlCn0pXSwgTWFpbkJhc2UucHJvdG90eXBlLCAic2hvd0J1c3lJbmRpY2F0b3IiLCB2b2lkIDApOwoKdHNsaWJfMS5fX2RlY29yYXRlKFtQcm9wKCldLCBNYWluQmFzZS5wcm90b3R5cGUsICJ1cGRhdGVBY3Rpb24iLCB2b2lkIDApOwoKdHNsaWJfMS5fX2RlY29yYXRlKFtQcm9wKCldLCBNYWluQmFzZS5wcm90b3R5cGUsICJmZXRjaEFjdGlvbiIsIHZvaWQgMCk7Cgp0c2xpYl8xLl9fZGVjb3JhdGUoW1Byb3AoKV0sIE1haW5CYXNlLnByb3RvdHlwZSwgInJlbW92ZUFjdGlvbiIsIHZvaWQgMCk7Cgp0c2xpYl8xLl9fZGVjb3JhdGUoW1Byb3AoKV0sIE1haW5CYXNlLnByb3RvdHlwZSwgImxvYWRBY3Rpb24iLCB2b2lkIDApOwoKdHNsaWJfMS5fX2RlY29yYXRlKFtQcm9wKCldLCBNYWluQmFzZS5wcm90b3R5cGUsICJsb2FkZHJhZnRBY3Rpb24iLCB2b2lkIDApOwoKdHNsaWJfMS5fX2RlY29yYXRlKFtQcm9wKCldLCBNYWluQmFzZS5wcm90b3R5cGUsICJjcmVhdGVBY3Rpb24iLCB2b2lkIDApOwoKdHNsaWJfMS5fX2RlY29yYXRlKFtQcm9wKHsKICAiZGVmYXVsdCI6IGZhbHNlCn0pXSwgTWFpbkJhc2UucHJvdG90eXBlLCAiaXNTZWxlY3RGaXJzdERlZmF1bHQiLCB2b2lkIDApOwoKdHNsaWJfMS5fX2RlY29yYXRlKFtQcm9wKCldLCBNYWluQmFzZS5wcm90b3R5cGUsICJpc1NpbmdsZVNlbGVjdCIsIHZvaWQgMCk7Cgp0c2xpYl8xLl9fZGVjb3JhdGUoW1Byb3AoKV0sIE1haW5CYXNlLnByb3RvdHlwZSwgInNlbGVjdGVkRGF0YSIsIHZvaWQgMCk7Cgp0c2xpYl8xLl9fZGVjb3JhdGUoW1dhdGNoKCdzZWxlY3RlZERhdGEnKV0sIE1haW5CYXNlLnByb3RvdHlwZSwgIm9uVmFsdWVDaGFuZ2UiLCBudWxsKTsKCnRzbGliXzEuX19kZWNvcmF0ZShbUHJvcCh7CiAgImRlZmF1bHQiOiAyCn0pXSwgTWFpbkJhc2UucHJvdG90eXBlLCAiZ3JpZFJvd0FjdGl2ZU1vZGUiLCB2b2lkIDApOwoKdHNsaWJfMS5fX2RlY29yYXRlKFtQcm9wKHsKICAiZGVmYXVsdCI6IGZhbHNlCn0pXSwgTWFpbkJhc2UucHJvdG90eXBlLCAiaXNPcGVuRWRpdCIsIHZvaWQgMCk7CgpNYWluQmFzZSA9IHRzbGliXzEuX19kZWNvcmF0ZShbQ29tcG9uZW50KHsKICBjb21wb25lbnRzOiB7fQp9KV0sIE1haW5CYXNlKTsKZXhwb3J0IGRlZmF1bHQgTWFpbkJhc2U7"},null]}
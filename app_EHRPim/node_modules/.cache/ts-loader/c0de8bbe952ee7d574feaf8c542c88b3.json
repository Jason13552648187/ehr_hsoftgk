{"remainingRequest":"F:\\crod项目\\人事管理系统2\\iBizEHR\\app_EHRPim\\node_modules\\thread-loader\\dist\\cjs.js!F:\\crod项目\\人事管理系统2\\iBizEHR\\app_EHRPim\\node_modules\\babel-loader\\lib\\index.js!F:\\crod项目\\人事管理系统2\\iBizEHR\\app_EHRPim\\node_modules\\ts-loader\\index.js??ref--14-3!F:\\crod项目\\人事管理系统2\\iBizEHR\\app_EHRPim\\node_modules\\cache-loader\\dist\\cjs.js??ref--0-0!F:\\crod项目\\人事管理系统2\\iBizEHR\\app_EHRPim\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!F:\\crod项目\\人事管理系统2\\iBizEHR\\app_EHRPim\\src\\widgets\\pim-person\\org-person-org-type-chart\\org-person-org-type-chart-base.vue?vue&type=script&lang=tsx&","dependencies":[{"path":"F:\\crod项目\\人事管理系统2\\iBizEHR\\app_EHRPim\\src\\widgets\\pim-person\\org-person-org-type-chart\\org-person-org-type-chart-base.vue","mtime":1630509411905},{"path":"F:\\crod项目\\人事管理系统2\\iBizEHR\\app_EHRPim\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1630511852775},{"path":"F:\\crod项目\\人事管理系统2\\iBizEHR\\app_EHRPim\\node_modules\\thread-loader\\dist\\cjs.js","mtime":1630511853252},{"path":"F:\\crod项目\\人事管理系统2\\iBizEHR\\app_EHRPim\\node_modules\\babel-loader\\lib\\index.js","mtime":1630511852747},{"path":"F:\\crod项目\\人事管理系统2\\iBizEHR\\app_EHRPim\\node_modules\\ts-loader\\index.js","mtime":1630511985412},{"path":"F:\\crod项目\\人事管理系统2\\iBizEHR\\app_EHRPim\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1630511852775},{"path":"F:\\crod项目\\人事管理系统2\\iBizEHR\\app_EHRPim\\node_modules\\vue-loader\\lib\\index.js","mtime":1630512070338}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:aW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuc3ltYm9sIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkuZmlsdGVyIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkuZmluZCI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLmFycmF5LmZpbmQtaW5kZXgiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5hcnJheS5mb3ItZWFjaCI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLmFycmF5LmlzLWFycmF5IjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkubWFwIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkuc29ydCI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLmFycmF5LnNwbGljZSI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLmRhdGUudG8tc3RyaW5nIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuZnVuY3Rpb24ubmFtZSI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLm1hcCI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLm51bWJlci5jb25zdHJ1Y3RvciI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLm9iamVjdC5kZWZpbmUtcHJvcGVydGllcyI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLm9iamVjdC5kZWZpbmUtcHJvcGVydHkiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5vYmplY3QuZ2V0LW93bi1wcm9wZXJ0eS1kZXNjcmlwdG9yIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMub2JqZWN0LmdldC1vd24tcHJvcGVydHktZGVzY3JpcHRvcnMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5vYmplY3QuaXMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5vYmplY3Qua2V5cyI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLm9iamVjdC50by1zdHJpbmciOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5vYmplY3QudmFsdWVzIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMucmVnZXhwLmV4ZWMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5yZWdleHAudG8tc3RyaW5nIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuc3RyaW5nLml0ZXJhdG9yIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuc3RyaW5nLnNlYXJjaCI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLnN0cmluZy5zcGxpdCI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL3dlYi5kb20tY29sbGVjdGlvbnMuZm9yLWVhY2giOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy93ZWIuZG9tLWNvbGxlY3Rpb25zLml0ZXJhdG9yIjsKaW1wb3J0IF90b0NvbnN1bWFibGVBcnJheSBmcm9tICJGOlxcY3JvZFx1OTg3OVx1NzZFRVxcXHU0RUJBXHU0RThCXHU3QkExXHU3NDA2XHU3Q0ZCXHU3RURGMlxcaUJpekVIUlxcYXBwX0VIUlBpbVxcbm9kZV9tb2R1bGVzXFxAYmFiZWxcXHJ1bnRpbWUvaGVscGVycy9lc20vdG9Db25zdW1hYmxlQXJyYXkiOwppbXBvcnQgInJlZ2VuZXJhdG9yLXJ1bnRpbWUvcnVudGltZSI7CmltcG9ydCBfYXN5bmNUb0dlbmVyYXRvciBmcm9tICJGOlxcY3JvZFx1OTg3OVx1NzZFRVxcXHU0RUJBXHU0RThCXHU3QkExXHU3NDA2XHU3Q0ZCXHU3RURGMlxcaUJpekVIUlxcYXBwX0VIUlBpbVxcbm9kZV9tb2R1bGVzXFxAYmFiZWxcXHJ1bnRpbWUvaGVscGVycy9lc20vYXN5bmNUb0dlbmVyYXRvciI7CmltcG9ydCBfZGVmaW5lUHJvcGVydHkgZnJvbSAiRjpcXGNyb2RcdTk4NzlcdTc2RUVcXFx1NEVCQVx1NEU4Qlx1N0JBMVx1NzQwNlx1N0NGQlx1N0VERjJcXGlCaXpFSFJcXGFwcF9FSFJQaW1cXG5vZGVfbW9kdWxlc1xcQGJhYmVsXFxydW50aW1lL2hlbHBlcnMvZXNtL2RlZmluZVByb3BlcnR5IjsKaW1wb3J0IF9jbGFzc0NhbGxDaGVjayBmcm9tICJGOlxcY3JvZFx1OTg3OVx1NzZFRVxcXHU0RUJBXHU0RThCXHU3QkExXHU3NDA2XHU3Q0ZCXHU3RURGMlxcaUJpekVIUlxcYXBwX0VIUlBpbVxcbm9kZV9tb2R1bGVzXFxAYmFiZWxcXHJ1bnRpbWUvaGVscGVycy9lc20vY2xhc3NDYWxsQ2hlY2siOwppbXBvcnQgX2NyZWF0ZUNsYXNzIGZyb20gIkY6XFxjcm9kXHU5ODc5XHU3NkVFXFxcdTRFQkFcdTRFOEJcdTdCQTFcdTc0MDZcdTdDRkJcdTdFREYyXFxpQml6RUhSXFxhcHBfRUhSUGltXFxub2RlX21vZHVsZXNcXEBiYWJlbFxccnVudGltZS9oZWxwZXJzL2VzbS9jcmVhdGVDbGFzcyI7CmltcG9ydCBfcG9zc2libGVDb25zdHJ1Y3RvclJldHVybiBmcm9tICJGOlxcY3JvZFx1OTg3OVx1NzZFRVxcXHU0RUJBXHU0RThCXHU3QkExXHU3NDA2XHU3Q0ZCXHU3RURGMlxcaUJpekVIUlxcYXBwX0VIUlBpbVxcbm9kZV9tb2R1bGVzXFxAYmFiZWxcXHJ1bnRpbWUvaGVscGVycy9lc20vcG9zc2libGVDb25zdHJ1Y3RvclJldHVybiI7CmltcG9ydCBfZ2V0UHJvdG90eXBlT2YgZnJvbSAiRjpcXGNyb2RcdTk4NzlcdTc2RUVcXFx1NEVCQVx1NEU4Qlx1N0JBMVx1NzQwNlx1N0NGQlx1N0VERjJcXGlCaXpFSFJcXGFwcF9FSFJQaW1cXG5vZGVfbW9kdWxlc1xcQGJhYmVsXFxydW50aW1lL2hlbHBlcnMvZXNtL2dldFByb3RvdHlwZU9mIjsKaW1wb3J0IF9pbmhlcml0cyBmcm9tICJGOlxcY3JvZFx1OTg3OVx1NzZFRVxcXHU0RUJBXHU0RThCXHU3QkExXHU3NDA2XHU3Q0ZCXHU3RURGMlxcaUJpekVIUlxcYXBwX0VIUlBpbVxcbm9kZV9tb2R1bGVzXFxAYmFiZWxcXHJ1bnRpbWUvaGVscGVycy9lc20vaW5oZXJpdHMiOwoKZnVuY3Rpb24gb3duS2V5cyhvYmplY3QsIGVudW1lcmFibGVPbmx5KSB7IHZhciBrZXlzID0gT2JqZWN0LmtleXMob2JqZWN0KTsgaWYgKE9iamVjdC5nZXRPd25Qcm9wZXJ0eVN5bWJvbHMpIHsgdmFyIHN5bWJvbHMgPSBPYmplY3QuZ2V0T3duUHJvcGVydHlTeW1ib2xzKG9iamVjdCk7IGlmIChlbnVtZXJhYmxlT25seSkgc3ltYm9scyA9IHN5bWJvbHMuZmlsdGVyKGZ1bmN0aW9uIChzeW0pIHsgcmV0dXJuIE9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3Iob2JqZWN0LCBzeW0pLmVudW1lcmFibGU7IH0pOyBrZXlzLnB1c2guYXBwbHkoa2V5cywgc3ltYm9scyk7IH0gcmV0dXJuIGtleXM7IH0KCmZ1bmN0aW9uIF9vYmplY3RTcHJlYWQodGFyZ2V0KSB7IGZvciAodmFyIGkgPSAxOyBpIDwgYXJndW1lbnRzLmxlbmd0aDsgaSsrKSB7IHZhciBzb3VyY2UgPSBhcmd1bWVudHNbaV0gIT0gbnVsbCA/IGFyZ3VtZW50c1tpXSA6IHt9OyBpZiAoaSAlIDIpIHsgb3duS2V5cyhPYmplY3Qoc291cmNlKSwgdHJ1ZSkuZm9yRWFjaChmdW5jdGlvbiAoa2V5KSB7IF9kZWZpbmVQcm9wZXJ0eSh0YXJnZXQsIGtleSwgc291cmNlW2tleV0pOyB9KTsgfSBlbHNlIGlmIChPYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9ycykgeyBPYmplY3QuZGVmaW5lUHJvcGVydGllcyh0YXJnZXQsIE9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3JzKHNvdXJjZSkpOyB9IGVsc2UgeyBvd25LZXlzKE9iamVjdChzb3VyY2UpKS5mb3JFYWNoKGZ1bmN0aW9uIChrZXkpIHsgT2JqZWN0LmRlZmluZVByb3BlcnR5KHRhcmdldCwga2V5LCBPYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yKHNvdXJjZSwga2V5KSk7IH0pOyB9IH0gcmV0dXJuIHRhcmdldDsgfQoKaW1wb3J0ICogYXMgdHNsaWJfMSBmcm9tICJ0c2xpYiI7CmltcG9ydCB7IFZ1ZSwgQ29tcG9uZW50LCBQcm9wIH0gZnJvbSAndnVlLXByb3BlcnR5LWRlY29yYXRvcic7CmltcG9ydCB7IFV0aWwgfSBmcm9tICdAL3V0aWxzJzsKaW1wb3J0IFBpbVBlcnNvblNlcnZpY2UgZnJvbSAnQC9zZXJ2aWNlL3BpbS1wZXJzb24vcGltLXBlcnNvbi1zZXJ2aWNlJzsKaW1wb3J0IE9yZ1BlcnNvbk9yZ1R5cGVTZXJ2aWNlIGZyb20gJy4vb3JnLXBlcnNvbi1vcmctdHlwZS1jaGFydC1zZXJ2aWNlJzsKaW1wb3J0IGVjaGFydHMgZnJvbSAnZWNoYXJ0cyc7CmltcG9ydCBtb21lbnQgZnJvbSAibW9tZW50IjsKaW1wb3J0IENvZGVMaXN0U2VydmljZSBmcm9tICJAc2VydmljZS9hcHAvY29kZWxpc3Qtc2VydmljZSI7CmltcG9ydCB7IENoYXJ0UGllU2VyaWVzIH0gZnJvbSAnQC9tb2RlbC9jaGFydC1kZXRhaWwnOwoKdmFyIE9yZ1BlcnNvbk9yZ1R5cGVCYXNlID0KLyojX19QVVJFX18qLwpmdW5jdGlvbiAoX1Z1ZSkgewogIF9pbmhlcml0cyhPcmdQZXJzb25PcmdUeXBlQmFzZSwgX1Z1ZSk7CgogIGZ1bmN0aW9uIE9yZ1BlcnNvbk9yZ1R5cGVCYXNlKCkgewogICAgdmFyIF90aGlzMjsKCiAgICBfY2xhc3NDYWxsQ2hlY2sodGhpcywgT3JnUGVyc29uT3JnVHlwZUJhc2UpOwoKICAgIF90aGlzMiA9IF9wb3NzaWJsZUNvbnN0cnVjdG9yUmV0dXJuKHRoaXMsIF9nZXRQcm90b3R5cGVPZihPcmdQZXJzb25PcmdUeXBlQmFzZSkuYXBwbHkodGhpcywgYXJndW1lbnRzKSk7CiAgICAvKioNCiAgICAgKiDlu7rmnoTpg6jku7bmnI3liqHlr7nosaENCiAgICAgKg0KICAgICAqIEB0eXBlIHtPcmdQZXJzb25PcmdUeXBlU2VydmljZX0NCiAgICAgKiBAbWVtYmVyb2YgT3JnUGVyc29uT3JnVHlwZUJhc2UNCiAgICAgKi8KCiAgICBfdGhpczIuc2VydmljZSA9IG5ldyBPcmdQZXJzb25PcmdUeXBlU2VydmljZSh7CiAgICAgICRzdG9yZTogX3RoaXMyLiRzdG9yZQogICAgfSk7CiAgICAvKioNCiAgICAgKiDlrp7kvZPmnI3liqHlr7nosaENCiAgICAgKg0KICAgICAqIEB0eXBlIHtQaW1QZXJzb25TZXJ2aWNlfQ0KICAgICAqIEBtZW1iZXJvZiBPcmdQZXJzb25PcmdUeXBlQmFzZQ0KICAgICAqLwoKICAgIF90aGlzMi5hcHBFbnRpdHlTZXJ2aWNlID0gbmV3IFBpbVBlcnNvblNlcnZpY2UoewogICAgICAkc3RvcmU6IF90aGlzMi4kc3RvcmUKICAgIH0pOwogICAgLyoqDQogICAgICog5piv5ZCm5peg5pWw5o2uDQogICAgICoNCiAgICAgKiBAcHVibGljDQogICAgICogQHR5cGUge2Jvb2xlYW59DQogICAgICogQG1lbWJlcm9mIFBvcnRsZXRfT3JnUGVyc29uT3JnVHlwZVBpZV9jaGFydEJhc2UNCiAgICAgKi8KCiAgICBfdGhpczIuaXNOb0RhdGEgPSBmYWxzZTsKICAgIC8qKg0KICAgICAqIOWbvuihqGRpdue7keWumueahGlkDQogICAgICoNCiAgICAgKiBAdHlwZSB7fQ0KICAgICAqIEBtZW1iZXJvZiBQb3J0bGV0X09yZ1BlcnNvbk9yZ1R5cGVQaWVfY2hhcnRCYXNlDQogICAgICovCgogICAgX3RoaXMyLmNoYXJ0SWQgPSBfdGhpczIuJHV0aWwuY3JlYXRlVVVJRCgpOwogICAgLyoqDQogICAgICog5Luj56CB6KGo5pyN5Yqh5a+56LGhDQogICAgICoNCiAgICAgKiBAdHlwZSB7Q29kZUxpc3RTZXJ2aWNlfQ0KICAgICAqIEBtZW1iZXJvZiBQb3J0bGV0X09yZ1BlcnNvbk9yZ1R5cGVQaWVfY2hhcnRCYXNlDQogICAgICovCgogICAgX3RoaXMyLmNvZGVMaXN0U2VydmljZSA9IG5ldyBDb2RlTGlzdFNlcnZpY2UoewogICAgICAkc3RvcmU6IF90aGlzMi4kc3RvcmUKICAgIH0pOwogICAgLyoqDQogICAgICog5bqP5YiX5qih5Z6LDQogICAgICoNCiAgICAgKiBAdHlwZSB7fQ0KICAgICAqIEBtZW1iZXJvZiBQb3J0bGV0X09yZ1BlcnNvbk9yZ1R5cGVQaWVfY2hhcnRCYXNlDQogICAgICovCgogICAgX3RoaXMyLnNlcmllc01vZGVsID0gewogICAgICBvcmdwZXJzb25vcmd0eXBlcGllOiBuZXcgQ2hhcnRQaWVTZXJpZXMoewogICAgICAgIG5hbWU6ICdvcmdwZXJzb25vcmd0eXBlcGllJywKICAgICAgICBjYXRlZ29yRmllbGQ6ICdvcm10eXBlJywKICAgICAgICBjYXRlZ29yQ29kZUxpc3Q6IHsKICAgICAgICAgIHR5cGU6ICdTVEFUSUMnLAogICAgICAgICAgdGFnOiAnRWhyQ29kZUxpc3QwMDgzJywKICAgICAgICAgIGVtcHR5Y29kZTogJ2VtcHR5JywKICAgICAgICAgIGVtcHR5dGV4dDogJ+acquWumuS5iScKICAgICAgICB9LAogICAgICAgIHZhbHVlRmllbGQ6ICdjb3VudG51bScsCiAgICAgICAgc2VyaWVzVmFsdWVzOiBbXSwKICAgICAgICBzZXJpZXNJbmRleDogMCwKICAgICAgICBkYXRhOiBbXSwKICAgICAgICBzZXJpZXNNYXA6IHt9LAogICAgICAgIGRhdGFTZXRGaWVsZHM6IFt7CiAgICAgICAgICBuYW1lOiAib3JtdHlwZSIsCiAgICAgICAgICBjb2RlbGlzdDogewogICAgICAgICAgICB0eXBlOiAiU1RBVElDIiwKICAgICAgICAgICAgdGFnOiAiRWhyQ29kZUxpc3QwMDgzIiwKICAgICAgICAgICAgZW1wdHljb2RlOiAnZW1wdHknLAogICAgICAgICAgICBlbXB0eXRleHQ6ICfmnKrlrprkuYknCiAgICAgICAgICB9LAogICAgICAgICAgaXNHcm91cEZpZWxkOiB0cnVlLAogICAgICAgICAgZ3JvdXBNb2RlOiAiQ09ERUxJU1QiCiAgICAgICAgfSwgewogICAgICAgICAgbmFtZTogImNvdW50bnVtIiwKICAgICAgICAgIGNvZGVsaXN0OiBudWxsLAogICAgICAgICAgaXNHcm91cEZpZWxkOiBmYWxzZSwKICAgICAgICAgIGdyb3VwTW9kZTogIiIKICAgICAgICB9XSwKICAgICAgICBlY3hPYmplY3Q6IHsKICAgICAgICAgIGxhYmVsOiB7CiAgICAgICAgICAgIHNob3c6IHRydWUsCiAgICAgICAgICAgIHBvc2l0aW9uOiAnb3V0c2lkZScKICAgICAgICAgIH0sCiAgICAgICAgICBsYWJlbExpbmU6IHsKICAgICAgICAgICAgc2hvdzogdHJ1ZSwKICAgICAgICAgICAgbGVuZ3RoOiAxMCwKICAgICAgICAgICAgbGluZVN0eWxlOiB7CiAgICAgICAgICAgICAgd2lkdGg6IDEsCiAgICAgICAgICAgICAgdHlwZTogJ3NvbGlkJwogICAgICAgICAgICB9CiAgICAgICAgICB9LAogICAgICAgICAgaXRlbVN0eWxlOiB7CiAgICAgICAgICAgIGJvcmRlckNvbG9yOiAnI2ZmZicsCiAgICAgICAgICAgIGJvcmRlcldpZHRoOiAxCiAgICAgICAgICB9LAogICAgICAgICAgZW1waGFzaXM6IHsKICAgICAgICAgICAgbGFiZWw6IHsKICAgICAgICAgICAgICBmb250U2l6ZTogMjAKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0sCiAgICAgICAgZWNPYmplY3Q6IHsKICAgICAgICAgIGxhYmVsOiB7CiAgICAgICAgICAgIGZvcm1hdHRlcjogIntifToge0Bjb3VudG51bX3kuroiCiAgICAgICAgICB9LAogICAgICAgICAgcmFkaXVzOiBbJzUwJScsICc3MCUnXSwKICAgICAgICAgIGxlZ2VuZDogewogICAgICAgICAgICBmb3JtYXR0ZXI6ICJ7YX06IHtAY291bnRudW195Lq6IgogICAgICAgICAgfQogICAgICAgIH0sCiAgICAgICAgc2VyaWVzVGVtcDogewogICAgICAgICAgdHlwZTogJ3BpZScKICAgICAgICB9LAogICAgICAgIGJhc2VPcHRpb246IHt9LAogICAgICAgIHNlcmllc0xheW91dEJ5OiAiY29sdW1uIgogICAgICB9KQogICAgfTsKICAgIC8qKg0KICAgICAqIOWbvuihqOiHquWumuS5ieWPguaVsOmbhuWQiA0KICAgICAqDQogICAgICogQG1lbWJlcm9mIFBvcnRsZXRfT3JnUGVyc29uT3JnVHlwZVBpZV9jaGFydEJhc2UNCiAgICAgKi8KCiAgICBfdGhpczIuY2hhcnRVc2VyUGFyYW1zID0gewogICAgICBsZWdlbmQ6IHsKICAgICAgICBzaG93OiB0cnVlLAogICAgICAgIGxlZnQ6ICJsZWZ0IiwKICAgICAgICB0b3A6ICI3NSUiLAogICAgICAgIG9yaWVudDogJ3ZlcnRpY2FsJwogICAgICB9LAogICAgICBjb2xvcjogWyIjZjY5ZjU0IiwgIiMwMGZmYTkiLCAiI2FhMDBmZiIsICIjODg0YmZmIiwgJyM0MkIzRkYnLCAnIzg1QjNGRicsICcjQTFGRkZGJ10KICAgIH07CiAgICAvKioNCiAgICAgKiDlm77ooajln7rnoYDliqjmgIHmqKHlnosNCiAgICAgKg0KICAgICAqIEBtZW1iZXJvZiBQb3J0bGV0X09yZ1BlcnNvbk9yZ1R5cGVQaWVfY2hhcnRCYXNlDQogICAgICovCgogICAgX3RoaXMyLmNoYXJ0QmFzZU9QdGlvbiA9IHt9OwogICAgLyoqDQogICAgICog5Yid5aeL5YyW5Zu+6KGo5omA6ZyA5Y+C5pWwDQogICAgICoNCiAgICAgKiBAdHlwZSB7fQ0KICAgICAqIEBtZW1iZXJvZiBQb3J0bGV0X09yZ1BlcnNvbk9yZ1R5cGVQaWVfY2hhcnRCYXNlDQogICAgICovCgogICAgX3RoaXMyLmNoYXJ0T3B0aW9uID0gewogICAgICB0aXRsZTogewogICAgICAgIHNob3c6IHRydWUsCiAgICAgICAgdGV4dDogJ+acuuWFs+S4jumhueebruS6uuWRmCcsCiAgICAgICAgc3VidGV4dDogJycKICAgICAgfSwKICAgICAgbGVnZW5kOiB7CiAgICAgICAgc2hvdzogZmFsc2UKICAgICAgfSwKICAgICAgdG9vbHRpcDogewogICAgICAgIHNob3c6IHRydWUKICAgICAgfSwKICAgICAgZGF0YXNldDogW10sCiAgICAgIHNlcmllczogW3sKICAgICAgICBpZDogJ29yZ3BlcnNvbm9yZ3R5cGVwaWUnLAogICAgICAgIG5hbWU6ICfmnLrlhbPkuI7pobnnm67kurrlkZgnLAogICAgICAgIHR5cGU6ICdwaWUnLAogICAgICAgIGRhdGFzZXRJbmRleDogMCwKICAgICAgICBzZXJpZXNMYXlvdXRCeTogImNvbHVtbiIsCiAgICAgICAgZW5jb2RlOiB7CiAgICAgICAgICBpdGVtTmFtZTogIm9ybXR5cGUiLAogICAgICAgICAgdmFsdWU6ICJjb3VudG51bSIKICAgICAgICB9CiAgICAgIH1dCiAgICB9OwogICAgcmV0dXJuIF90aGlzMjsKICB9CiAgLyoqDQogICAqIOiOt+WPlumDqOS7tuexu+Weiw0KICAgKg0KICAgKiBAcmV0dXJucyB7c3RyaW5nfQ0KICAgKiBAbWVtYmVyb2YgT3JnUGVyc29uT3JnVHlwZUJhc2UNCiAgICovCgoKICBfY3JlYXRlQ2xhc3MoT3JnUGVyc29uT3JnVHlwZUJhc2UsIFt7CiAgICBrZXk6ICJnZXRDb250cm9sVHlwZSIsCiAgICB2YWx1ZTogZnVuY3Rpb24gZ2V0Q29udHJvbFR5cGUoKSB7CiAgICAgIHJldHVybiAnQ0hBUlQnOwogICAgfQogICAgLyoqDQogICAgICog5YWz6Zet6KeG5Zu+DQogICAgICoNCiAgICAgKiBAcGFyYW0ge2FueX0gYXJncw0KICAgICAqIEBtZW1iZXJvZiBPcmdQZXJzb25PcmdUeXBlQmFzZQ0KICAgICAqLwoKICB9LCB7CiAgICBrZXk6ICJjbG9zZVZpZXciLAogICAgdmFsdWU6IGZ1bmN0aW9uIGNsb3NlVmlldyhhcmdzKSB7CiAgICAgIHZhciBfdGhpcyA9IHRoaXM7CgogICAgICBfdGhpcy4kZW1pdCgnY2xvc2V2aWV3JywgW2FyZ3NdKTsKICAgIH0KICAgIC8qKg0KICAgICAqICDorqHmlbDlmajliLfmlrANCiAgICAgKg0KICAgICAqIEBtZW1iZXJvZiBPcmdQZXJzb25PcmdUeXBlQmFzZQ0KICAgICAqLwoKICB9LCB7CiAgICBrZXk6ICJjb3VudGVyUmVmcmVzaCIsCiAgICB2YWx1ZTogZnVuY3Rpb24gY291bnRlclJlZnJlc2goKSB7CiAgICAgIHZhciBfdGhpcyA9IHRoaXM7CgogICAgICBpZiAoX3RoaXMuY291bnRlclNlcnZpY2VBcnJheSAmJiBfdGhpcy5jb3VudGVyU2VydmljZUFycmF5Lmxlbmd0aCA+IDApIHsKICAgICAgICBfdGhpcy5jb3VudGVyU2VydmljZUFycmF5LmZvckVhY2goZnVuY3Rpb24gKGl0ZW0pIHsKICAgICAgICAgIGlmIChpdGVtLnJlZnJlc2hEYXRhICYmIGl0ZW0ucmVmcmVzaERhdGEgaW5zdGFuY2VvZiBGdW5jdGlvbikgewogICAgICAgICAgICBpdGVtLnJlZnJlc2hEYXRhKCk7CiAgICAgICAgICB9CiAgICAgICAgfSk7CiAgICAgIH0KICAgIH0KICAgIC8qKg0KICAgICAqIOiOt+WPluWkmumhueaVsOaNrg0KICAgICAqDQogICAgICogQHJldHVybnMge2FueVtdfQ0KICAgICAqIEBtZW1iZXJvZiBPcmdQZXJzb25PcmdUeXBlQmFzZQ0KICAgICAqLwoKICB9LCB7CiAgICBrZXk6ICJnZXREYXRhcyIsCiAgICB2YWx1ZTogZnVuY3Rpb24gZ2V0RGF0YXMoKSB7CiAgICAgIHJldHVybiBbXTsKICAgIH0KICAgIC8qKg0KICAgICAqIOiOt+WPluWNlemhueagkQ0KICAgICAqDQogICAgICogQHJldHVybnMgeyp9DQogICAgICogQG1lbWJlcm9mIE9yZ1BlcnNvbk9yZ1R5cGVCYXNlDQogICAgICovCgogIH0sIHsKICAgIGtleTogImdldERhdGEiLAogICAgdmFsdWU6IGZ1bmN0aW9uIGdldERhdGEoKSB7CiAgICAgIHJldHVybiBudWxsOwogICAgfQogICAgLyoqDQogICAgKiBWdWXlo7DmmI7lkajmnJ8o57uE5Lu25Yid5aeL5YyW5a6M5q+VKQ0KICAgICoNCiAgICAqIEBtZW1iZXJvZiBPcmdQZXJzb25PcmdUeXBlQmFzZQ0KICAgICovCgogIH0sIHsKICAgIGtleTogImNyZWF0ZWQiLAogICAgdmFsdWU6IGZ1bmN0aW9uIGNyZWF0ZWQoKSB7CiAgICAgIHRoaXMuYWZ0ZXJDcmVhdGVkKCk7CiAgICB9CiAgICAvKioNCiAgICAqIOaJp+ihjGNyZWF0ZWTlkI7nmoTpgLvovpENCiAgICAqDQogICAgKiBAbWVtYmVyb2YgT3JnUGVyc29uT3JnVHlwZUJhc2UNCiAgICAqLwoKICB9LCB7CiAgICBrZXk6ICJhZnRlckNyZWF0ZWQiLAogICAgdmFsdWU6IGZ1bmN0aW9uIGFmdGVyQ3JlYXRlZCgpIHsKICAgICAgdmFyIF90aGlzMyA9IHRoaXM7CgogICAgICBpZiAodGhpcy52aWV3U3RhdGUpIHsKICAgICAgICB0aGlzLnZpZXdTdGF0ZUV2ZW50ID0gdGhpcy52aWV3U3RhdGUuc3Vic2NyaWJlKGZ1bmN0aW9uIChfcmVmKSB7CiAgICAgICAgICB2YXIgdGFnID0gX3JlZi50YWcsCiAgICAgICAgICAgICAgYWN0aW9uID0gX3JlZi5hY3Rpb24sCiAgICAgICAgICAgICAgZGF0YSA9IF9yZWYuZGF0YTsKCiAgICAgICAgICBpZiAoIU9iamVjdC5pcyh0YWcsIF90aGlzMy5uYW1lKSkgewogICAgICAgICAgICByZXR1cm47CiAgICAgICAgICB9CgogICAgICAgICAgaWYgKE9iamVjdC5pcygnbG9hZCcsIGFjdGlvbikpIHsKICAgICAgICAgICAgX3RoaXMzLmxvYWQoZGF0YSk7CiAgICAgICAgICB9CiAgICAgICAgfSk7CiAgICAgIH0KICAgIH0KICAgIC8qKg0KICAgICAqIHZ1ZSDnlJ/lkb3lkajmnJ8NCiAgICAgKg0KICAgICAqIEBtZW1iZXJvZiBPcmdQZXJzb25PcmdUeXBlQmFzZQ0KICAgICAqLwoKICB9LCB7CiAgICBrZXk6ICJkZXN0cm95ZWQiLAogICAgdmFsdWU6IGZ1bmN0aW9uIGRlc3Ryb3llZCgpIHsKICAgICAgdGhpcy5hZnRlckRlc3Ryb3koKTsKICAgIH0KICAgIC8qKg0KICAgICAqIOaJp+ihjGRlc3Ryb3llZOWQjueahOmAu+i+kQ0KICAgICAqDQogICAgICogQG1lbWJlcm9mIE9yZ1BlcnNvbk9yZ1R5cGVCYXNlDQogICAgICovCgogIH0sIHsKICAgIGtleTogImFmdGVyRGVzdHJveSIsCiAgICB2YWx1ZTogZnVuY3Rpb24gYWZ0ZXJEZXN0cm95KCkgewogICAgICBpZiAodGhpcy52aWV3U3RhdGVFdmVudCkgewogICAgICAgIHRoaXMudmlld1N0YXRlRXZlbnQudW5zdWJzY3JpYmUoKTsKICAgICAgfQogICAgfQogICAgLyoqDQogICAgICog5Yi35pawDQogICAgICoNCiAgICAgKiBAcGFyYW0geyp9IFtvcHQ9e31dDQogICAgICogQG1lbWJlcm9mIFBvcnRsZXRfT3JnUGVyc29uT3JnVHlwZVBpZV9jaGFydEJhc2UNCiAgICAgKi8KCiAgfSwgewogICAga2V5OiAicmVmcmVzaCIsCiAgICB2YWx1ZTogZnVuY3Rpb24gcmVmcmVzaCgpIHsKICAgICAgdmFyIG9wdCA9IGFyZ3VtZW50cy5sZW5ndGggPiAwICYmIGFyZ3VtZW50c1swXSAhPT0gdW5kZWZpbmVkID8gYXJndW1lbnRzWzBdIDoge307CiAgICAgIHRoaXMubG9hZChvcHQpOwogICAgfQogICAgLyoqDQogICAgICog6I635Y+W5Zu+6KGo5pWw5o2uDQogICAgICoNCiAgICAgKiBAcmV0dXJucyB7Kn0NCiAgICAgKiBAbWVtYmVyb2YgUG9ydGxldF9PcmdQZXJzb25PcmdUeXBlUGllX2NoYXJ0QmFzZQ0KICAgICAqLwoKICB9LCB7CiAgICBrZXk6ICJsb2FkIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBsb2FkKG9wdCkgewogICAgICB2YXIgX3RoaXM0ID0gdGhpczsKCiAgICAgIHZhciBfdGhpcyA9IHRoaXM7CgogICAgICB2YXIgYXJnID0gX29iamVjdFNwcmVhZCh7fSwgb3B0KTsKCiAgICAgIHZhciBwYXJlbnRkYXRhID0ge307CiAgICAgIHRoaXMuJGVtaXQoJ2JlZm9yZWxvYWQnLCBwYXJlbnRkYXRhKTsKICAgICAgT2JqZWN0LmFzc2lnbihhcmcsIHBhcmVudGRhdGEpOwogICAgICBPYmplY3QuYXNzaWduKGFyZywgewogICAgICAgIHZpZXdwYXJhbXM6IHRoaXMudmlld3BhcmFtcywKICAgICAgICBwYWdlOiAwLAogICAgICAgIHNpemU6IDEwMDAKICAgICAgfSk7CiAgICAgIHRoaXMuc2VydmljZS5zZWFyY2godGhpcy5mZXRjaEFjdGlvbiwgSlNPTi5wYXJzZShKU09OLnN0cmluZ2lmeSh0aGlzLmNvbnRleHQpKSwgYXJnLCB0aGlzLnNob3dCdXN5SW5kaWNhdG9yKS50aGVuKGZ1bmN0aW9uIChyZXMpIHsKICAgICAgICBpZiAocmVzKSB7CiAgICAgICAgICBfdGhpczQudHJhbnNmb3JtVG9CYXNpY0NoYXJ0U2V0RGF0YShyZXMuZGF0YSwgZnVuY3Rpb24gKGNvZGVsaXN0KSB7CiAgICAgICAgICAgIF90aGlzLmRyYXdDaGFydHMoY29kZWxpc3QpOwogICAgICAgICAgfSk7CiAgICAgICAgfQogICAgICB9KVsiY2F0Y2giXShmdW5jdGlvbiAoZXJyb3IpIHsKICAgICAgICBjb25zb2xlLmVycm9yKGVycm9yKTsKICAgICAgfSk7CiAgICB9CiAgICAvKioNCiAgICAgKiDnu5jliLblm77ooagNCiAgICAgKg0KICAgICAqIEByZXR1cm5zIHsqfQ0KICAgICAqIEBtZW1iZXJvZiBQb3J0bGV0X09yZ1BlcnNvbk9yZ1R5cGVQaWVfY2hhcnRCYXNlDQogICAgICovCgogIH0sIHsKICAgIGtleTogImRyYXdDaGFydHMiLAogICAgdmFsdWU6IGZ1bmN0aW9uIGRyYXdDaGFydHMoY29kZWxpc3QpIHsKICAgICAgaWYgKCF0aGlzLm15Q2hhcnQpIHsKICAgICAgICB2YXIgZWxlbWVudCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKHRoaXMuY2hhcnRJZCk7CiAgICAgICAgdGhpcy5teUNoYXJ0ID0gZWNoYXJ0cy5pbml0KGVsZW1lbnQpOwogICAgICB9CgogICAgICB2YXIgX2NoYXJ0T3B0aW9uID0gdGhpcy5oYW5kbGVDaGFydE9QdGlvbihjb2RlbGlzdCk7CgogICAgICBjb25zb2xlLmxvZyhfY2hhcnRPcHRpb24pOwogICAgICB0aGlzLm15Q2hhcnQuc2V0T3B0aW9uKF9jaGFydE9wdGlvbik7CiAgICAgIHRoaXMubXlDaGFydC5yZXNpemUoKTsKICAgIH0KICAgIC8qKg0KICAgICAqIOWkhOeQhuWbvuihqOWPguaVsA0KICAgICAqDQogICAgICogQG1lbWJlcm9mIFBvcnRsZXRfT3JnUGVyc29uT3JnVHlwZVBpZV9jaGFydEJhc2UNCiAgICAgKi8KCiAgfSwgewogICAga2V5OiAiaGFuZGxlQ2hhcnRPUHRpb24iLAogICAgdmFsdWU6IGZ1bmN0aW9uIGhhbmRsZUNoYXJ0T1B0aW9uKGFsbGNvZGVsaXN0KSB7CiAgICAgIHZhciBfdGhpczUgPSB0aGlzOwoKICAgICAgdmFyIF9jaGFydE9wdGlvbiA9IEpTT04ucGFyc2UoSlNPTi5zdHJpbmdpZnkodGhpcy5jaGFydE9wdGlvbikpOwoKICAgICAgaWYgKE9iamVjdC5rZXlzKHRoaXMuc2VyaWVzTW9kZWwpLmxlbmd0aCA+IDApIHsKICAgICAgICAoZnVuY3Rpb24gKCkgewogICAgICAgICAgdmFyIHRlbXBEYXRhU291cmNlTWFwID0gbmV3IE1hcCgpOwoKICAgICAgICAgIHZhciBfbG9vcCA9IGZ1bmN0aW9uIF9sb29wKGkpIHsKICAgICAgICAgICAgT2JqZWN0LnZhbHVlcyhfdGhpczUuc2VyaWVzTW9kZWwpLmZvckVhY2goZnVuY3Rpb24gKHNlcmllc3ZhbHVlKSB7CiAgICAgICAgICAgICAgaWYgKHNlcmllc3ZhbHVlLnNlcmllc0luZGV4ID09PSBpKSB7CiAgICAgICAgICAgICAgICB0ZW1wRGF0YVNvdXJjZU1hcC5zZXQoc2VyaWVzdmFsdWUubmFtZSwgc2VyaWVzdmFsdWUuZGF0YSk7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9KTsKICAgICAgICAgIH07CgogICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBPYmplY3Qua2V5cyhfdGhpczUuc2VyaWVzTW9kZWwpLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgIF9sb29wKGkpOwogICAgICAgICAgfQoKICAgICAgICAgIGlmICh0ZW1wRGF0YVNvdXJjZU1hcC5zaXplID4gMCkgewogICAgICAgICAgICB0ZW1wRGF0YVNvdXJjZU1hcC5mb3JFYWNoKGZ1bmN0aW9uIChpdGVtKSB7CiAgICAgICAgICAgICAgX2NoYXJ0T3B0aW9uLmRhdGFzZXQucHVzaCh7CiAgICAgICAgICAgICAgICAnc291cmNlJzogaXRlbQogICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9KTsKICAgICAgICAgIH0KCiAgICAgICAgICBPYmplY3Qua2V5cyhfdGhpczUuc2VyaWVzTW9kZWwpLmZvckVhY2goZnVuY3Rpb24gKHNlcmllc05hbWUpIHsKICAgICAgICAgICAgaWYgKF9jaGFydE9wdGlvbiAmJiBfY2hhcnRPcHRpb24uc2VyaWVzLmxlbmd0aCA+IDApIHsKICAgICAgICAgICAgICBfY2hhcnRPcHRpb24uc2VyaWVzLmZvckVhY2goZnVuY3Rpb24gKGl0ZW0pIHsKICAgICAgICAgICAgICAgIGlmIChfdGhpczUuc2VyaWVzTW9kZWxbc2VyaWVzTmFtZV0uZWN4T2JqZWN0ICYmIE9iamVjdC5pcyhzZXJpZXNOYW1lLCBpdGVtLmlkKSkgewogICAgICAgICAgICAgICAgICBpdGVtID0gVXRpbC5kZWVwT2JqZWN0TWVyZ2UoaXRlbSwgX3RoaXM1LnNlcmllc01vZGVsW3Nlcmllc05hbWVdLmVjeE9iamVjdCk7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgaWYgKF90aGlzNS5zZXJpZXNNb2RlbFtzZXJpZXNOYW1lXS5iYXNlT3B0aW9uICYmIE9iamVjdC5rZXlzKF90aGlzNS5zZXJpZXNNb2RlbFtzZXJpZXNOYW1lXS5iYXNlT3B0aW9uKS5sZW5ndGggPiAwICYmIE9iamVjdC5pcyhzZXJpZXNOYW1lLCBpdGVtLmlkKSkgewogICAgICAgICAgICAgICAgICBpdGVtID0gVXRpbC5kZWVwT2JqZWN0TWVyZ2UoaXRlbSwgX3RoaXM1LnNlcmllc01vZGVsW3Nlcmllc05hbWVdLmJhc2VPcHRpb24pOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIGlmIChfdGhpczUuc2VyaWVzTW9kZWxbc2VyaWVzTmFtZV0uZWNPYmplY3QgJiYgT2JqZWN0LmlzKHNlcmllc05hbWUsIGl0ZW0uaWQpKSB7CiAgICAgICAgICAgICAgICAgIGl0ZW0gPSBVdGlsLmRlZXBPYmplY3RNZXJnZShpdGVtLCBfdGhpczUuc2VyaWVzTW9kZWxbc2VyaWVzTmFtZV0uZWNPYmplY3QpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9IC8v6K6+572u5aSa5bqP5YiXCgoKICAgICAgICAgICAgdmFyIHRlbXBTZXJpZXMgPSBfdGhpczUuc2VyaWVzTW9kZWxbc2VyaWVzTmFtZV07IC8vIOmdnumbt+i+vuWbvgoKICAgICAgICAgICAgaWYgKHRlbXBTZXJpZXMgJiYgdGVtcFNlcmllcy5zZXJpZXNJZEZpZWxkICYmIHRlbXBTZXJpZXMuc2VyaWVzVmFsdWVzLmxlbmd0aCA+IDAgJiYgIU9iamVjdC5pcyh0ZW1wU2VyaWVzLnR5cGUsICdyYWRhcicpKSB7CiAgICAgICAgICAgICAgdmFyIHJldHVybkluZGV4ID0gX2NoYXJ0T3B0aW9uLnNlcmllcy5maW5kSW5kZXgoZnVuY3Rpb24gKGl0ZW0pIHsKICAgICAgICAgICAgICAgIHJldHVybiBPYmplY3QuaXMoaXRlbS5pZCwgc2VyaWVzTmFtZSk7CiAgICAgICAgICAgICAgfSk7CgogICAgICAgICAgICAgIF9jaGFydE9wdGlvbi5zZXJpZXMuc3BsaWNlKHJldHVybkluZGV4LCAxKTsKCiAgICAgICAgICAgICAgdmFyIHRlbXBTZXJpZXNBcnJheSA9IFtdOwogICAgICAgICAgICAgIHRlbXBTZXJpZXMuc2VyaWVzVmFsdWVzLmZvckVhY2goZnVuY3Rpb24gKHNlcmllc3ZhbHVlSXRlbSkgewogICAgICAgICAgICAgICAgdmFyIHRlbXBTZXJpZXNUZW1wID0gSlNPTi5wYXJzZShKU09OLnN0cmluZ2lmeSh0ZW1wU2VyaWVzLnNlcmllc1RlbXApKTsKICAgICAgICAgICAgICAgIE9iamVjdC5hc3NpZ24odGVtcFNlcmllc1RlbXAsIHsKICAgICAgICAgICAgICAgICAgbmFtZTogdGVtcFNlcmllcy5zZXJpZXNNYXBbc2VyaWVzdmFsdWVJdGVtXSwKICAgICAgICAgICAgICAgICAgZGF0YXNldEluZGV4OiB0ZW1wU2VyaWVzLnNlcmllc0luZGV4LAogICAgICAgICAgICAgICAgICBlbmNvZGU6IHsKICAgICAgICAgICAgICAgICAgICB4OiB0ZW1wU2VyaWVzLmNhdGVnb3JGaWVsZCwKICAgICAgICAgICAgICAgICAgICB5OiAiIi5jb25jYXQoc2VyaWVzdmFsdWVJdGVtKQogICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9KTsKCiAgICAgICAgICAgICAgICBfY2hhcnRPcHRpb24uc2VyaWVzLnB1c2godGVtcFNlcmllc1RlbXApOwogICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9CiAgICAgICAgICB9KTsKICAgICAgICB9KSgpOwogICAgICB9CgogICAgICBpZiAoT2JqZWN0LmtleXModGhpcy5jaGFydEJhc2VPUHRpb24pLmxlbmd0aCA+IDApIHsKICAgICAgICBPYmplY3QuYXNzaWduKF9jaGFydE9wdGlvbiwgdGhpcy5jaGFydEJhc2VPUHRpb24pOwogICAgICB9CgogICAgICBpZiAoT2JqZWN0LmtleXModGhpcy5jaGFydFVzZXJQYXJhbXMpLmxlbmd0aCA+IDApIHsKICAgICAgICBPYmplY3QuYXNzaWduKF9jaGFydE9wdGlvbiwgdGhpcy5jaGFydFVzZXJQYXJhbXMpOwogICAgICB9CgogICAgICByZXR1cm4gX2NoYXJ0T3B0aW9uOwogICAgfQogICAgLyoqDQogICAgICog5a6e5L2T5pWw5o2u6ZuG6L2s5YyW5Li65Zu+6KGo5pWw5o2u6ZuGDQogICAgICoNCiAgICAgKiAxLuiOt+WPluWbvuihqOaJgOacieS7o+eggeihqOWAvA0KICAgICAqIDIu5p+l6K+i6ZuG5ZCI5pig5bCE5Zu+6KGo5pWw5o2u6ZuGDQogICAgICogMy7ooaXlhajlm77ooajmlbDmja7pm4YNCiAgICAgKiA0LuWbvuihqOaVsOaNrumbhuWIhue7hOaxguWSjA0KICAgICAqIDUu5o6S5bqP5Zu+6KGo5pWw5o2u6ZuGDQogICAgICoNCiAgICAgKiBAcGFyYW0geyp9IGRhdGEg5a6e5L2T5pWw5o2u6ZuGDQogICAgICogQHBhcmFtIHtGdW5jdGlvbn0gY2FsbGJhY2sg5Zue6LCDDQogICAgICogQG1lbWJlcm9mIFBvcnRsZXRfT3JnUGVyc29uT3JnVHlwZVBpZV9jaGFydEJhc2UNCiAgICAgKi8KCiAgfSwgewogICAga2V5OiAidHJhbnNmb3JtVG9CYXNpY0NoYXJ0U2V0RGF0YSIsCiAgICB2YWx1ZTogZnVuY3Rpb24gKCkgewogICAgICB2YXIgX3RyYW5zZm9ybVRvQmFzaWNDaGFydFNldERhdGEgPSBfYXN5bmNUb0dlbmVyYXRvcigKICAgICAgLyojX19QVVJFX18qLwogICAgICByZWdlbmVyYXRvclJ1bnRpbWUubWFyayhmdW5jdGlvbiBfY2FsbGVlKGRhdGEsIGNhbGxiYWNrKSB7CiAgICAgICAgdmFyIF90aGlzNiA9IHRoaXM7CgogICAgICAgIHZhciBhbGxDb2RlTGlzdDsKICAgICAgICByZXR1cm4gcmVnZW5lcmF0b3JSdW50aW1lLndyYXAoZnVuY3Rpb24gX2NhbGxlZSQoX2NvbnRleHQpIHsKICAgICAgICAgIHdoaWxlICgxKSB7CiAgICAgICAgICAgIHN3aXRjaCAoX2NvbnRleHQucHJldiA9IF9jb250ZXh0Lm5leHQpIHsKICAgICAgICAgICAgICBjYXNlIDA6CiAgICAgICAgICAgICAgICBpZiAoISghZGF0YSB8fCAhQXJyYXkuaXNBcnJheShkYXRhKSB8fCBkYXRhLmxlbmd0aCA9PT0gMCkpIHsKICAgICAgICAgICAgICAgICAgX2NvbnRleHQubmV4dCA9IDM7CiAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIHRoaXMuaXNOb0RhdGEgPSB0cnVlOwogICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0LmFicnVwdCgicmV0dXJuIik7CgogICAgICAgICAgICAgIGNhc2UgMzoKICAgICAgICAgICAgICAgIHRoaXMuaXNOb0RhdGEgPSBmYWxzZTsgLy/ojrflj5bku6PnoIHooajlgLwKCiAgICAgICAgICAgICAgICBfY29udGV4dC5uZXh0ID0gNjsKICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLmdldENoYXJ0QWxsQ29kZUxpc3QoKTsKCiAgICAgICAgICAgICAgY2FzZSA2OgogICAgICAgICAgICAgICAgYWxsQ29kZUxpc3QgPSBfY29udGV4dC5zZW50OwoKICAgICAgICAgICAgICAgIGlmIChPYmplY3QudmFsdWVzKHRoaXMuc2VyaWVzTW9kZWwpLmxlbmd0aCA+IDApIHsKICAgICAgICAgICAgICAgICAgT2JqZWN0LnZhbHVlcyh0aGlzLnNlcmllc01vZGVsKS5mb3JFYWNoKGZ1bmN0aW9uIChzaW5nbGVTZXJpZXMsIGluZGV4KSB7CiAgICAgICAgICAgICAgICAgICAgLy8g5YC85bGe5oCn5Li6c3JmY291bnTorr7nva57c3JmY291bnQ6MX3liLBkYXRhCiAgICAgICAgICAgICAgICAgICAgdmFyIHZhbHVlRmllbGQgPSBzaW5nbGVTZXJpZXMuZGF0YVNldEZpZWxkcy5maW5kKGZ1bmN0aW9uIChkYXRhc2V0RmllbGQpIHsKICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBkYXRhc2V0RmllbGQubmFtZSA9PT0gc2luZ2xlU2VyaWVzLnZhbHVlRmllbGQ7CiAgICAgICAgICAgICAgICAgICAgfSk7CgogICAgICAgICAgICAgICAgICAgIGlmICh2YWx1ZUZpZWxkICYmIHZhbHVlRmllbGQubmFtZSAmJiBPYmplY3QuaXModmFsdWVGaWVsZC5uYW1lLCAic3JmY291bnQiKSkgewogICAgICAgICAgICAgICAgICAgICAgZGF0YS5mb3JFYWNoKGZ1bmN0aW9uIChzaW5nbGVEYXRhKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIE9iamVjdC5hc3NpZ24oc2luZ2xlRGF0YSwgewogICAgICAgICAgICAgICAgICAgICAgICAgIHNyZmNvdW50OiAxCiAgICAgICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgfSAvLyDliIbnu4TlsZ7mgKcKCgogICAgICAgICAgICAgICAgICAgIHZhciBncm91cEZpZWxkID0gc2luZ2xlU2VyaWVzLmRhdGFTZXRGaWVsZHMuZmluZChmdW5jdGlvbiAoZGF0YXNldEZpZWxkKSB7CiAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gZGF0YXNldEZpZWxkLm5hbWUgPT09IHNpbmdsZVNlcmllcy5jYXRlZ29yRmllbGQ7CiAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgdmFyIHRlbXBDaGFydFNldERhdGEgPSBbXTsKICAgICAgICAgICAgICAgICAgICB2YXIgdGVtcFNlcmllc1ZhbHVlcyA9IG5ldyBNYXAoKTsKICAgICAgICAgICAgICAgICAgICBkYXRhLmZvckVhY2goZnVuY3Rpb24gKGl0ZW0pIHsKICAgICAgICAgICAgICAgICAgICAgIHZhciB0ZW1wQ2hhcnRTZXREYXRhSXRlbSA9IHt9OyAvLyDluo/liJflsZ7mgKfkuI3lrZjlnKgKCiAgICAgICAgICAgICAgICAgICAgICBpZiAoIXNpbmdsZVNlcmllcy5zZXJpZXNJZEZpZWxkKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIE9iamVjdC5hc3NpZ24odGVtcENoYXJ0U2V0RGF0YUl0ZW0sIHsKICAgICAgICAgICAgICAgICAgICAgICAgICBuYW1lOiBzaW5nbGVTZXJpZXMubmFtZQogICAgICAgICAgICAgICAgICAgICAgICB9KTsKCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChzaW5nbGVTZXJpZXMuZGF0YVNldEZpZWxkcyAmJiBzaW5nbGVTZXJpZXMuZGF0YVNldEZpZWxkcy5sZW5ndGggPiAwKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgc2luZ2xlU2VyaWVzLmRhdGFTZXRGaWVsZHMuZm9yRWFjaChmdW5jdGlvbiAoc2luZ2xlRGF0YVNldEZpZWxkKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBfdGhpczYuaGFuZGxlU2luZ2xlRGF0YVNldEZpZWxkKGl0ZW0sIHNpbmdsZURhdGFTZXRGaWVsZCwgYWxsQ29kZUxpc3QsIHRlbXBDaGFydFNldERhdGFJdGVtLCBncm91cEZpZWxkKTsKICAgICAgICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgLy8g5bqP5YiX5bGe5oCn5a2Y5Zyo5pe2CiAgICAgICAgICAgICAgICAgICAgICAgIC8vIOW6j+WIl+S7o+eggeihqOWtmOWcqOaXtiznv7vor5F0ZW1wU2VyaWVzVmFsdWVz55qE6ZSu5YC85a+5CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChzaW5nbGVTZXJpZXMuc2VyaWVzQ29kZUxpc3QpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgc2VyaWVzQ29kZUxpc3QgPSBhbGxDb2RlTGlzdC5nZXQoc2luZ2xlU2VyaWVzLnNlcmllc0NvZGVMaXN0LnRhZyk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHRlbXBTZXJpZXNWYWx1ZUl0ZW0gPSB0ZW1wU2VyaWVzVmFsdWVzLmdldChzZXJpZXNDb2RlTGlzdC5nZXQoaXRlbVtzaW5nbGVTZXJpZXMuc2VyaWVzSWRGaWVsZF0pKTsKCiAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCF0ZW1wU2VyaWVzVmFsdWVJdGVtKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0ZW1wU2VyaWVzVmFsdWVzLnNldChzZXJpZXNDb2RlTGlzdC5nZXQoaXRlbVtzaW5nbGVTZXJpZXMuc2VyaWVzSWRGaWVsZF0pLCBzZXJpZXNDb2RlTGlzdC5nZXQoaXRlbVtzaW5nbGVTZXJpZXMuc2VyaWVzSWRGaWVsZF0pKTsKICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIF90ZW1wU2VyaWVzVmFsdWVJdGVtID0gdGVtcFNlcmllc1ZhbHVlcy5nZXQoaXRlbVtzaW5nbGVTZXJpZXMuc2VyaWVzSWRGaWVsZF0pOwoKICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoIV90ZW1wU2VyaWVzVmFsdWVJdGVtKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0ZW1wU2VyaWVzVmFsdWVzLnNldChpdGVtW3NpbmdsZVNlcmllcy5zZXJpZXNJZEZpZWxkXSwgaXRlbVtzaW5nbGVTZXJpZXMuc2VyaWVzTmFtZUZpZWxkXSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgICAgICBPYmplY3QuYXNzaWduKHRlbXBDaGFydFNldERhdGFJdGVtLCB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgbmFtZTogaXRlbVtzaW5nbGVTZXJpZXMuc2VyaWVzSWRGaWVsZF0KICAgICAgICAgICAgICAgICAgICAgICAgfSk7CgogICAgICAgICAgICAgICAgICAgICAgICBpZiAoc2luZ2xlU2VyaWVzLmRhdGFTZXRGaWVsZHMgJiYgc2luZ2xlU2VyaWVzLmRhdGFTZXRGaWVsZHMubGVuZ3RoID4gMCkgewogICAgICAgICAgICAgICAgICAgICAgICAgIHNpbmdsZVNlcmllcy5kYXRhU2V0RmllbGRzLmZvckVhY2goZnVuY3Rpb24gKHNpbmdsZURhdGFTZXRGaWVsZCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgX3RoaXM2LmhhbmRsZVNpbmdsZURhdGFTZXRGaWVsZChpdGVtLCBzaW5nbGVEYXRhU2V0RmllbGQsIGFsbENvZGVMaXN0LCB0ZW1wQ2hhcnRTZXREYXRhSXRlbSwgZ3JvdXBGaWVsZCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgICB0ZW1wQ2hhcnRTZXREYXRhLnB1c2godGVtcENoYXJ0U2V0RGF0YUl0ZW0pOwogICAgICAgICAgICAgICAgICAgIH0pOyAvLyDooaXlhajmlbDmja7pm4blkIgKCiAgICAgICAgICAgICAgICAgICAgX3RoaXM2LmNvbXBsZXRlRGF0YVNldCh0ZW1wQ2hhcnRTZXREYXRhLCBzaW5nbGVTZXJpZXMsIGFsbENvZGVMaXN0KTsgLy8g5bqP5YiX5Luj56CB6KGo5a2Y5Zyo5pe2LOihpeWFqOW6j+WIlwoKCiAgICAgICAgICAgICAgICAgICAgaWYgKHNpbmdsZVNlcmllcy5zZXJpZXNDb2RlTGlzdCkgewogICAgICAgICAgICAgICAgICAgICAgdmFyIHNlcmllc0NvZGVMaXN0ID0gYWxsQ29kZUxpc3QuZ2V0KHNpbmdsZVNlcmllcy5zZXJpZXNDb2RlTGlzdC50YWcpOwogICAgICAgICAgICAgICAgICAgICAgdGVtcFNlcmllc1ZhbHVlcyA9IG5ldyBNYXAoKTsKICAgICAgICAgICAgICAgICAgICAgIHNlcmllc0NvZGVMaXN0LmZvckVhY2goZnVuY3Rpb24gKGl0ZW0pIHsKICAgICAgICAgICAgICAgICAgICAgICAgdGVtcFNlcmllc1ZhbHVlcy5zZXQoaXRlbSwgaXRlbSk7CiAgICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgIHNpbmdsZVNlcmllcy5zZXJpZXNWYWx1ZXMgPSBfdG9Db25zdW1hYmxlQXJyYXkodGVtcFNlcmllc1ZhbHVlcy5rZXlzKCkpOwogICAgICAgICAgICAgICAgICAgIHZhciB0ZW1wU2VyaWVzTWFwT2JqID0ge307CiAgICAgICAgICAgICAgICAgICAgdGVtcFNlcmllc1ZhbHVlcy5mb3JFYWNoKGZ1bmN0aW9uICh2YWx1ZSwga2V5KSB7CiAgICAgICAgICAgICAgICAgICAgICB0ZW1wU2VyaWVzTWFwT2JqW2tleV0gPSB2YWx1ZTsKICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICBzaW5nbGVTZXJpZXMuc2VyaWVzTWFwID0gdGVtcFNlcmllc01hcE9iajsKICAgICAgICAgICAgICAgICAgICB2YXIgY2FsbGJhY2tGdW5jdGlvbiA9IGluZGV4ID09PSBPYmplY3QudmFsdWVzKF90aGlzNi5zZXJpZXNNb2RlbCkubGVuZ3RoIC0gMSA/IGNhbGxiYWNrIDogbnVsbDsKCiAgICAgICAgICAgICAgICAgICAgX3RoaXM2LnRyYW5zZm9ybVRvQ2hhcnRTZXJpZXNEYXRhU2V0KHRlbXBDaGFydFNldERhdGEsIHNpbmdsZVNlcmllcywgY2FsbGJhY2tGdW5jdGlvbiwgYWxsQ29kZUxpc3QpOwogICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgY2FzZSA4OgogICAgICAgICAgICAgIGNhc2UgImVuZCI6CiAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQuc3RvcCgpOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSwgX2NhbGxlZSwgdGhpcyk7CiAgICAgIH0pKTsKCiAgICAgIGZ1bmN0aW9uIHRyYW5zZm9ybVRvQmFzaWNDaGFydFNldERhdGEoX3gsIF94MikgewogICAgICAgIHJldHVybiBfdHJhbnNmb3JtVG9CYXNpY0NoYXJ0U2V0RGF0YS5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwogICAgICB9CgogICAgICByZXR1cm4gdHJhbnNmb3JtVG9CYXNpY0NoYXJ0U2V0RGF0YTsKICAgIH0oKQogICAgLyoqDQogICAgICog5p6E5bu65Zu+6KGo5bqP5YiX5pWw5o2u6ZuG5ZCIDQogICAgICoNCiAgICAgKiAxLuWIhue7hOaxguWSjA0KICAgICAqIDIu5o6S5bqP5rGC5ZKM5pWw57uEDQogICAgICoNCiAgICAgKiBAcGFyYW0ge0FycmF5PGFueT59IGRhdGEg5Lyg5YWl5pWw5o2uDQogICAgICogQHBhcmFtIHtBcnJheTxhbnk+fSBpdGVtIOWNleS4quW6j+WIlw0KICAgICAqIEBwYXJhbSB7QXJyYXk8YW55Pn0gY2FsbGJhY2sg5Zue6LCDDQogICAgICogQHBhcmFtIHsqfSBhbGxDb2RlTGlzdCDmiYDmnInku6PnoIHooagNCiAgICAgKg0KICAgICAqIEBtZW1iZXJvZiBQb3J0bGV0X09yZ1BlcnNvbk9yZ1R5cGVQaWVfY2hhcnRCYXNlDQogICAgICovCgogIH0sIHsKICAgIGtleTogInRyYW5zZm9ybVRvQ2hhcnRTZXJpZXNEYXRhU2V0IiwKICAgIHZhbHVlOiBmdW5jdGlvbiB0cmFuc2Zvcm1Ub0NoYXJ0U2VyaWVzRGF0YVNldChkYXRhLCBpdGVtLCBjYWxsYmFjaywgYWxsQ29kZUxpc3QpIHsKICAgICAgaWYgKGl0ZW0uc2VyaWVzSWRGaWVsZCkgewogICAgICAgIC8vIOWkmuW6j+WIlwogICAgICAgIHZhciBncm91cEZpZWxkID0gaXRlbS5kYXRhU2V0RmllbGRzLmZpbHRlcihmdW5jdGlvbiAoZGF0YXNldEZpZWxkKSB7CiAgICAgICAgICByZXR1cm4gZGF0YXNldEZpZWxkLm5hbWUgPT09IGl0ZW0uY2F0ZWdvckZpZWxkOwogICAgICAgIH0pOwogICAgICAgIHZhciB0ZW1wR3JvdXBGaWVsZCA9IGdyb3VwRmllbGQubWFwKGZ1bmN0aW9uIChpdGVtKSB7CiAgICAgICAgICByZXR1cm4gaXRlbS5uYW1lOwogICAgICAgIH0pOwogICAgICAgIHZhciBzZXJpZXNGaWVsZCA9IGl0ZW0uZGF0YVNldEZpZWxkcy5maWx0ZXIoZnVuY3Rpb24gKGRhdGFzZXRGaWVsZCkgewogICAgICAgICAgcmV0dXJuIGRhdGFzZXRGaWVsZC5uYW1lID09PSBpdGVtLnNlcmllc0lkRmllbGQ7CiAgICAgICAgfSk7CiAgICAgICAgdmFyIHRlbXBTZXJpZXNGaWVsZCA9IHNlcmllc0ZpZWxkLm1hcChmdW5jdGlvbiAoaXRlbSkgewogICAgICAgICAgcmV0dXJuIGl0ZW0ubmFtZTsKICAgICAgICB9KTsKICAgICAgICB2YXIgdmFsdWVGaWVsZCA9IGl0ZW0uZGF0YVNldEZpZWxkcy5maWx0ZXIoZnVuY3Rpb24gKGRhdGFzZXRGaWVsZCkgewogICAgICAgICAgcmV0dXJuIGRhdGFzZXRGaWVsZC5uYW1lID09PSBpdGVtLnZhbHVlRmllbGQ7CiAgICAgICAgfSk7CiAgICAgICAgdmFyIHRlbXBWYWx1ZUZpZWxkID0gdmFsdWVGaWVsZC5tYXAoZnVuY3Rpb24gKGl0ZW0pIHsKICAgICAgICAgIHJldHVybiBpdGVtLm5hbWU7CiAgICAgICAgfSk7CiAgICAgICAgaXRlbS5kYXRhID0gdGhpcy5ncm91cEFuZEFkZCh0ZW1wR3JvdXBGaWVsZCwgdGVtcFNlcmllc0ZpZWxkLCB0ZW1wVmFsdWVGaWVsZCwgZGF0YSwgaXRlbSwgZ3JvdXBGaWVsZCwgYWxsQ29kZUxpc3QpOwogICAgICB9IGVsc2UgewogICAgICAgIC8v5Y2V5bqP5YiXCiAgICAgICAgdmFyIF9ncm91cEZpZWxkID0gaXRlbS5kYXRhU2V0RmllbGRzLmZpbHRlcihmdW5jdGlvbiAoZGF0YXNldEZpZWxkKSB7CiAgICAgICAgICByZXR1cm4gZGF0YXNldEZpZWxkLm5hbWUgPT09IGl0ZW0uY2F0ZWdvckZpZWxkOwogICAgICAgIH0pOwoKICAgICAgICB2YXIgX3RlbXBHcm91cEZpZWxkID0gX2dyb3VwRmllbGQubWFwKGZ1bmN0aW9uIChpdGVtKSB7CiAgICAgICAgICByZXR1cm4gaXRlbS5uYW1lOwogICAgICAgIH0pOwoKICAgICAgICB2YXIgX3ZhbHVlRmllbGQgPSBpdGVtLmRhdGFTZXRGaWVsZHMuZmlsdGVyKGZ1bmN0aW9uIChkYXRhc2V0RmllbGQpIHsKICAgICAgICAgIHJldHVybiBkYXRhc2V0RmllbGQubmFtZSA9PT0gaXRlbS52YWx1ZUZpZWxkOwogICAgICAgIH0pOwoKICAgICAgICB2YXIgX3RlbXBWYWx1ZUZpZWxkID0gX3ZhbHVlRmllbGQubWFwKGZ1bmN0aW9uIChpdGVtKSB7CiAgICAgICAgICByZXR1cm4gaXRlbS5uYW1lOwogICAgICAgIH0pOwoKICAgICAgICBpdGVtLmRhdGEgPSB0aGlzLmdyb3VwQW5kQWRkKF90ZW1wR3JvdXBGaWVsZCwgW10sIF90ZW1wVmFsdWVGaWVsZCwgZGF0YSwgaXRlbSwgX2dyb3VwRmllbGQsIGFsbENvZGVMaXN0KTsKICAgICAgfQoKICAgICAgaWYgKGNhbGxiYWNrICYmIGNhbGxiYWNrIGluc3RhbmNlb2YgRnVuY3Rpb24pIHsKICAgICAgICBjYWxsYmFjayhhbGxDb2RlTGlzdCk7CiAgICAgIH0KICAgIH0KICAgIC8qKg0KICAgICAqIOWIhue7hOWSjOaxguWSjA0KICAgICAqIEBwYXJhbSB7QXJyYXk8YW55Pn0gZ3JvdXBGaWVsZCDliIbnu4TlsZ7mgKcNCiAgICAgKiBAcGFyYW0ge0FycmF5PGFueT59IGdyb3VwRmllbGQg5YC85bGe5oCnDQogICAgICogQHBhcmFtIHtBcnJheTxhbnk+fSBkYXRhIOS8oOWFpeaVsOaNrg0KICAgICAqIEBwYXJhbSB7Kn0gZ3JvdXBGaWVsZE1vZGVsIOWIhue7hOWxnuaAp+aooeWeiw0KICAgICAqIEBwYXJhbSB7Kn0gYWxsQ29kZUxpc3Qg5omA5pyJ5Luj56CB6KGoDQogICAgICoNCiAgICAgKiBAbWVtYmVyb2YgUG9ydGxldF9PcmdQZXJzb25PcmdUeXBlUGllX2NoYXJ0QmFzZQ0KICAgICAqLwoKICB9LCB7CiAgICBrZXk6ICJncm91cEFuZEFkZCIsCiAgICB2YWx1ZTogZnVuY3Rpb24gZ3JvdXBBbmRBZGQoZ3JvdXBGaWVsZCwgc2VyaWVzRmllbGQsIHZhbHVlRmllbGQsIGRhdGEsIGl0ZW0sIGdyb3VwRmllbGRNb2RlbCwgYWxsQ29kZUxpc3QpIHsKICAgICAgdmFyIHRlbXBNYXAgPSBuZXcgTWFwKCk7CiAgICAgIHZhciBncm91cE1vZGUgPSBncm91cEZpZWxkTW9kZWxbMF0uZ3JvdXBNb2RlOwogICAgICB2YXIgZ3JvdXBLZXlTdHIgPSAiIjsKICAgICAgZGF0YS5mb3JFYWNoKGZ1bmN0aW9uIChpdGVtKSB7CiAgICAgICAgdmFyIHRlbXBHcm91cEZpZWxkID0gZ3JvdXBGaWVsZFswXTsKICAgICAgICBncm91cEtleVN0ciA9IGl0ZW1bdGVtcEdyb3VwRmllbGRdOwogICAgICAgIHZhciB0ZW1wTWFwSXRlbSA9IHRlbXBNYXAuZ2V0KGdyb3VwS2V5U3RyKTsKCiAgICAgICAgaWYgKHRlbXBNYXBJdGVtKSB7CiAgICAgICAgICB0ZW1wTWFwSXRlbS5wdXNoKGl0ZW0pOwogICAgICAgICAgdGVtcE1hcC5zZXQoZ3JvdXBLZXlTdHIsIHRlbXBNYXBJdGVtKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgdGVtcE1hcC5zZXQoZ3JvdXBLZXlTdHIsIFtpdGVtXSk7CiAgICAgICAgfQogICAgICB9KTsgLy8g5aSE55CG5aSa5bqP5YiXCgogICAgICBpZiAoc2VyaWVzRmllbGQubGVuZ3RoID4gMCAmJiB0ZW1wTWFwLnNpemUgPiAwKSB7CiAgICAgICAgdmFyIHRlbXBTZXJpZXNGaWVsZCA9IHNlcmllc0ZpZWxkWzBdOwogICAgICAgIHRlbXBNYXAuZm9yRWFjaChmdW5jdGlvbiAoaXRlbSwga2V5KSB7CiAgICAgICAgICB2YXIgdGVtcEl0ZW1NYXAgPSBuZXcgTWFwKCk7CiAgICAgICAgICBpdGVtLmZvckVhY2goZnVuY3Rpb24gKHNpbmdsZUl0ZW0pIHsKICAgICAgICAgICAgdmFyIHNlcmllc1ZhbHVlQXJyYXkgPSB0ZW1wSXRlbU1hcC5nZXQoc2luZ2xlSXRlbVt0ZW1wU2VyaWVzRmllbGRdKTsKCiAgICAgICAgICAgIGlmIChzZXJpZXNWYWx1ZUFycmF5KSB7CiAgICAgICAgICAgICAgc2VyaWVzVmFsdWVBcnJheS5wdXNoKHNpbmdsZUl0ZW0pOwogICAgICAgICAgICAgIHRlbXBJdGVtTWFwLnNldChzaW5nbGVJdGVtW3RlbXBTZXJpZXNGaWVsZF0sIHNlcmllc1ZhbHVlQXJyYXkpOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgIHRlbXBJdGVtTWFwLnNldChzaW5nbGVJdGVtW3RlbXBTZXJpZXNGaWVsZF0sIFtzaW5nbGVJdGVtXSk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0pOwogICAgICAgICAgdGVtcE1hcC5zZXQoa2V5LCB0ZW1wSXRlbU1hcCk7CiAgICAgICAgfSk7CiAgICAgIH0KCiAgICAgIHZhciByZXR1cm5BcnJheSA9IFtdOwoKICAgICAgaWYgKHNlcmllc0ZpZWxkLmxlbmd0aCA9PSAwKSB7CiAgICAgICAgLy/ljZXluo/liJcKICAgICAgICB0ZW1wTWFwLmZvckVhY2goZnVuY3Rpb24gKHRlbXBJdGVtKSB7CiAgICAgICAgICBpZiAodGVtcEl0ZW0ubGVuZ3RoID4gMCkgewogICAgICAgICAgICB2YXIgY3VyT2JqZWN0ID0ge307CiAgICAgICAgICAgIHZhciB2YWx1ZVJlc3VsdCA9IDA7CiAgICAgICAgICAgIHZhciBjYXRlZ29yUmVzdWx0OwogICAgICAgICAgICB0ZW1wSXRlbS5mb3JFYWNoKGZ1bmN0aW9uIChzaW5nbGVJdGVtKSB7CiAgICAgICAgICAgICAgY2F0ZWdvclJlc3VsdCA9IHNpbmdsZUl0ZW1bZ3JvdXBGaWVsZFswXV07CiAgICAgICAgICAgICAgdmFsdWVSZXN1bHQgKz0gc2luZ2xlSXRlbVt2YWx1ZUZpZWxkWzBdXTsKICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShjdXJPYmplY3QsIGdyb3VwRmllbGRbMF0sIHsKICAgICAgICAgICAgICB2YWx1ZTogY2F0ZWdvclJlc3VsdCwKICAgICAgICAgICAgICB3cml0YWJsZTogdHJ1ZSwKICAgICAgICAgICAgICBlbnVtZXJhYmxlOiB0cnVlLAogICAgICAgICAgICAgIGNvbmZpZ3VyYWJsZTogdHJ1ZQogICAgICAgICAgICB9KTsKICAgICAgICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KGN1ck9iamVjdCwgdmFsdWVGaWVsZFswXSwgewogICAgICAgICAgICAgIHZhbHVlOiB2YWx1ZVJlc3VsdCwKICAgICAgICAgICAgICB3cml0YWJsZTogdHJ1ZSwKICAgICAgICAgICAgICBlbnVtZXJhYmxlOiB0cnVlLAogICAgICAgICAgICAgIGNvbmZpZ3VyYWJsZTogdHJ1ZQogICAgICAgICAgICB9KTsKICAgICAgICAgICAgcmV0dXJuQXJyYXkucHVzaChjdXJPYmplY3QpOwogICAgICAgICAgfQogICAgICAgIH0pOwogICAgICB9IGVsc2UgewogICAgICAgIC8vIOWkmuW6j+WIlwogICAgICAgIHZhciBzZXJpZXNWYWx1ZXNBcnJheSA9IGl0ZW0uc2VyaWVzVmFsdWVzOwogICAgICAgIHRlbXBNYXAuZm9yRWFjaChmdW5jdGlvbiAoZ3JvdXBJdGVtLCBncm91cEtleSkgewogICAgICAgICAgLy/msYLlkowKICAgICAgICAgIHZhciBjdXJPYmplY3QgPSB7fTsKICAgICAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShjdXJPYmplY3QsIGdyb3VwRmllbGRbMF0sIHsKICAgICAgICAgICAgdmFsdWU6IGdyb3VwS2V5LAogICAgICAgICAgICB3cml0YWJsZTogdHJ1ZSwKICAgICAgICAgICAgZW51bWVyYWJsZTogdHJ1ZSwKICAgICAgICAgICAgY29uZmlndXJhYmxlOiB0cnVlCiAgICAgICAgICB9KTsKICAgICAgICAgIHNlcmllc1ZhbHVlc0FycmF5LmZvckVhY2goZnVuY3Rpb24gKHNlcmllc1ZhbHVlSXRlbSkgewogICAgICAgICAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkoY3VyT2JqZWN0LCBzZXJpZXNWYWx1ZUl0ZW0sIHsKICAgICAgICAgICAgICB2YWx1ZTogMCwKICAgICAgICAgICAgICB3cml0YWJsZTogdHJ1ZSwKICAgICAgICAgICAgICBlbnVtZXJhYmxlOiB0cnVlLAogICAgICAgICAgICAgIGNvbmZpZ3VyYWJsZTogdHJ1ZQogICAgICAgICAgICB9KTsKICAgICAgICAgIH0pOwogICAgICAgICAgZ3JvdXBJdGVtLmZvckVhY2goZnVuY3Rpb24gKHNlcmllc0l0ZW0sIHNlcmllc0tleSkgewogICAgICAgICAgICB2YXIgc2VyaWVzTnVtID0gMDsKICAgICAgICAgICAgc2VyaWVzSXRlbS5mb3JFYWNoKGZ1bmN0aW9uIChkYXRhSXRlbSkgewogICAgICAgICAgICAgIHNlcmllc051bSArPSBkYXRhSXRlbVt2YWx1ZUZpZWxkWzBdXTsKICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIGN1ck9iamVjdFtzZXJpZXNLZXldID0gc2VyaWVzTnVtOwogICAgICAgICAgfSk7CiAgICAgICAgICByZXR1cm5BcnJheS5wdXNoKGN1ck9iamVjdCk7CiAgICAgICAgfSk7CiAgICAgIH0gLy8g6KGl5YWo56m655m95YiG57G7CgoKICAgICAgaWYgKHJldHVybkFycmF5Lmxlbmd0aCA+IDApIHsKICAgICAgICB2YXIgZW1wdHlUZXh0ID0gZ3JvdXBGaWVsZE1vZGVsWzBdICYmIGdyb3VwRmllbGRNb2RlbFswXS5jb2RlTGlzdCA/IGdyb3VwRmllbGRNb2RlbFswXS5jb2RlTGlzdC5lbXB0eXRleHQgOiAi5pyq5a6a5LmJIjsKICAgICAgICByZXR1cm5BcnJheS5mb3JFYWNoKGZ1bmN0aW9uIChpdGVtKSB7CiAgICAgICAgICBpZiAoIWl0ZW1bZ3JvdXBGaWVsZFswXV0pIHsKICAgICAgICAgICAgaXRlbVtncm91cEZpZWxkWzBdXSA9IGVtcHR5VGV4dDsKICAgICAgICAgIH0KICAgICAgICB9KTsKICAgICAgfQoKICAgICAgcmV0dXJuQXJyYXkgPSB0aGlzLnNvcnRSZXR1cm5BcnJheShyZXR1cm5BcnJheSwgZ3JvdXBGaWVsZE1vZGVsLCBhbGxDb2RlTGlzdCk7IC8vIOmbt+i+vuWbvuaVsOaNruagvOW8j+WkhOeQhgoKICAgICAgaWYgKE9iamVjdC5pcyhpdGVtLnR5cGUsICdyYWRhcicpICYmIHJldHVybkFycmF5Lmxlbmd0aCA+IDApIHsKICAgICAgICB2YXIgdGVtcFJldHVybkFycmF5ID0gW107CiAgICAgICAgdmFyIHNlcmllc1ZhbHVlcyA9IGl0ZW0uc2VyaWVzVmFsdWVzOwoKICAgICAgICBpZiAoc2VyaWVzVmFsdWVzICYmIHNlcmllc1ZhbHVlcy5sZW5ndGggPiAwKSB7CiAgICAgICAgICBzZXJpZXNWYWx1ZXMuZm9yRWFjaChmdW5jdGlvbiAoc2luZ2xlU2VyaWVzTmFtZSkgewogICAgICAgICAgICB2YXIgc2luZ2xlU2VyaWVzT2JqID0ge307CiAgICAgICAgICAgIHJldHVybkFycmF5LmZvckVhY2goZnVuY3Rpb24gKGl0ZW0pIHsKICAgICAgICAgICAgICBPYmplY3QuYXNzaWduKHNpbmdsZVNlcmllc09iaiwgX2RlZmluZVByb3BlcnR5KHt9LCBpdGVtW2dyb3VwRmllbGRbMF1dLCBpdGVtW3NpbmdsZVNlcmllc05hbWVdKSk7CiAgICAgICAgICAgIH0pOwogICAgICAgICAgICBPYmplY3QuYXNzaWduKHNpbmdsZVNlcmllc09iaiwgewogICAgICAgICAgICAgIHR5cGU6IHNpbmdsZVNlcmllc05hbWUKICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIHRlbXBSZXR1cm5BcnJheS5wdXNoKHNpbmdsZVNlcmllc09iaik7CiAgICAgICAgICB9KTsKICAgICAgICB9CgogICAgICAgIHJldHVybkFycmF5ID0gdGVtcFJldHVybkFycmF5OwogICAgICB9CgogICAgICBjb25zb2xlLmxvZyhKU09OLnN0cmluZ2lmeShyZXR1cm5BcnJheSkpOwogICAgICByZXR1cm4gcmV0dXJuQXJyYXk7CiAgICB9CiAgICAvKioNCiAgICAgKiDmjpLluo/mlbDnu4QNCiAgICAgKg0KICAgICAqIEBwYXJhbSB7QXJyYXk8YW55Pn0gYXJyIOS8oOWFpeaVsOe7hA0KICAgICAqIEBwYXJhbSB7Kn0gZ3JvdXBGaWVsZCDliIbnu4TlsZ7mgKcNCiAgICAgKiBAcGFyYW0geyp9IGFsbENvZGVMaXN0IOaJgOacieS7o+eggeihqA0KICAgICAqDQogICAgICogQG1lbWJlcm9mIFBvcnRsZXRfT3JnUGVyc29uT3JnVHlwZVBpZV9jaGFydEJhc2UNCiAgICAgKi8KCiAgfSwgewogICAga2V5OiAic29ydFJldHVybkFycmF5IiwKICAgIHZhbHVlOiBmdW5jdGlvbiBzb3J0UmV0dXJuQXJyYXkoYXJyLCBncm91cEZpZWxkLCBhbGxDb2RlTGlzdCkgewogICAgICB2YXIgcmV0dXJuQXJyYXkgPSBbXTsgLy8gdG9kbwogICAgICAvLyDliIbnu4TlsZ7mgKfmnInku6PnoIHooajnmoTmg4XlhrUo5pyA5ZCO5omn6KGMKQoKICAgICAgaWYgKGdyb3VwRmllbGRbMF0uY29kZWxpc3QpIHsKICAgICAgICB2YXIgY3VyQ29kZUxpc3QgPSBhbGxDb2RlTGlzdC5nZXQoZ3JvdXBGaWVsZFswXS5jb2RlbGlzdC50YWcpOwogICAgICAgIGN1ckNvZGVMaXN0LmZvckVhY2goZnVuY3Rpb24gKGNvZGVsaXN0KSB7CiAgICAgICAgICBhcnIuZm9yRWFjaChmdW5jdGlvbiAoaXRlbSkgewogICAgICAgICAgICBpZiAoT2JqZWN0LmlzKGl0ZW1bZ3JvdXBGaWVsZFswXS5uYW1lXSwgY29kZWxpc3QpKSB7CiAgICAgICAgICAgICAgcmV0dXJuQXJyYXkucHVzaChpdGVtKTsKICAgICAgICAgICAgICBpdGVtLmhhc3VzZWQgPSB0cnVlOwogICAgICAgICAgICB9CiAgICAgICAgICB9KTsKICAgICAgICB9KTsKICAgICAgICBhcnIuZm9yRWFjaChmdW5jdGlvbiAoaXRlbSwgaW5kZXgpIHsKICAgICAgICAgIGlmICghaXRlbS5oYXN1c2VkKSB7CiAgICAgICAgICAgIHJldHVybkFycmF5LnB1c2goaXRlbSk7CiAgICAgICAgICB9CiAgICAgICAgfSk7CiAgICAgICAgcmV0dXJuQXJyYXkuZm9yRWFjaChmdW5jdGlvbiAoaXRlbSkgewogICAgICAgICAgZGVsZXRlIGl0ZW0uaGFzdXNlZDsKICAgICAgICB9KTsKICAgICAgfSBlbHNlIHsKICAgICAgICAvLyDliIbnu4TkuLrlubTku70KICAgICAgICBpZiAoT2JqZWN0LmlzKGdyb3VwRmllbGRbMF0uZ3JvdXBNb2RlLCAiWUVBUiIpKSB7CiAgICAgICAgICByZXR1cm5BcnJheSA9IGFyci5zb3J0KGZ1bmN0aW9uIChhLCBiKSB7CiAgICAgICAgICAgIHJldHVybiBOdW1iZXIoYVtncm91cEZpZWxkWzBdLm5hbWVdKSAtIE51bWJlcihiW2dyb3VwRmllbGRbMF0ubmFtZV0pOwogICAgICAgICAgfSk7CiAgICAgICAgfSBlbHNlIGlmIChPYmplY3QuaXMoZ3JvdXBGaWVsZFswXS5ncm91cE1vZGUsICJRVUFSVEVSIikpIHsKICAgICAgICAgIHJldHVybkFycmF5ID0gdGhpcy5oYW5kbGVTb3J0R3JvdXBEYXRhKGFyciwgZ3JvdXBGaWVsZCwgIuWto+W6piIpOwogICAgICAgIH0gZWxzZSBpZiAoT2JqZWN0LmlzKGdyb3VwRmllbGRbMF0uZ3JvdXBNb2RlLCAiTU9OVEgiKSkgewogICAgICAgICAgcmV0dXJuQXJyYXkgPSB0aGlzLmhhbmRsZVNvcnRHcm91cERhdGEoYXJyLCBncm91cEZpZWxkLCAi5pyIIik7CiAgICAgICAgfSBlbHNlIGlmIChPYmplY3QuaXMoZ3JvdXBGaWVsZFswXS5ncm91cE1vZGUsICJZRUFSV0VFSyIpKSB7CiAgICAgICAgICByZXR1cm5BcnJheSA9IHRoaXMuaGFuZGxlU29ydEdyb3VwRGF0YShhcnIsIGdyb3VwRmllbGQsICLlkagiKTsKICAgICAgICB9IGVsc2UgaWYgKE9iamVjdC5pcyhncm91cEZpZWxkWzBdLmdyb3VwTW9kZSwgIkRBWSIpKSB7CiAgICAgICAgICByZXR1cm5BcnJheSA9IGFyci5zb3J0KGZ1bmN0aW9uIChhLCBiKSB7CiAgICAgICAgICAgIHJldHVybiBtb21lbnQoYVtncm91cEZpZWxkWzBdLm5hbWVdKS51bml4KCkgLSBtb21lbnQoYltncm91cEZpZWxkWzBdLm5hbWVdKS51bml4KCk7CiAgICAgICAgICB9KTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgdmFyIGdyb3VwRmllbGROYW1lID0gZ3JvdXBGaWVsZFswXS5uYW1lOwogICAgICAgICAgdmFyIGlzQ29udmVydCA9IHRydWU7CiAgICAgICAgICBhcnIuZm9yRWFjaChmdW5jdGlvbiAoaXRlbSkgewogICAgICAgICAgICBpZiAoaXNOYU4oaXRlbVtncm91cEZpZWxkTmFtZV0pKSB7CiAgICAgICAgICAgICAgaXNDb252ZXJ0ID0gZmFsc2U7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0pOwoKICAgICAgICAgIGlmIChpc0NvbnZlcnQpIHsKICAgICAgICAgICAgcmV0dXJuQXJyYXkgPSBhcnIuc29ydChmdW5jdGlvbiAoYSwgYikgewogICAgICAgICAgICAgIHJldHVybiBhW2dyb3VwRmllbGROYW1lXSAtIGJbZ3JvdXBGaWVsZE5hbWVdOwogICAgICAgICAgICB9KTsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHJldHVybkFycmF5ID0gYXJyOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfQoKICAgICAgcmV0dXJuIHJldHVybkFycmF5OwogICAgfQogICAgLyoqDQogICAgICog5o6S5bqP5YiG57uE5qih5byP5LiL55qE5pWw5o2uDQogICAgICoNCiAgICAgKiBAcGFyYW0ge0FycmF5PGFueT59IGFyciDkvKDlhaXmlbDmja4NCiAgICAgKiBAcGFyYW0ge0FycmF5PGFueT59IGdyb3VwRmllbGQg5YiG57uE5bGe5oCnDQogICAgICogQHBhcmFtIHtBcnJheTxhbnk+fSBsYWJlbCBsYWJlbOagh+etvg0KICAgICAqDQogICAgICogQG1lbWJlcm9mIFBvcnRsZXRfT3JnUGVyc29uT3JnVHlwZVBpZV9jaGFydEJhc2UNCiAgICAgKi8KCiAgfSwgewogICAga2V5OiAiaGFuZGxlU29ydEdyb3VwRGF0YSIsCiAgICB2YWx1ZTogZnVuY3Rpb24gaGFuZGxlU29ydEdyb3VwRGF0YShhcnIsIGdyb3VwRmllbGQsIGxhYmVsKSB7CiAgICAgIGFyci5mb3JFYWNoKGZ1bmN0aW9uIChpdGVtKSB7CiAgICAgICAgdmFyIHNvcnRGaWVsZFZhbHVlID0gaXRlbVtncm91cEZpZWxkWzBdLm5hbWVdLnNwbGl0KCItIik7CiAgICAgICAgT2JqZWN0LmFzc2lnbihpdGVtLCB7CiAgICAgICAgICBzb3J0RmllbGQ6IE51bWJlcihzb3J0RmllbGRWYWx1ZVswXSkgKiAxMDAwMCArIE51bWJlcihzb3J0RmllbGRWYWx1ZVsxXSkKICAgICAgICB9KTsKICAgICAgICBpdGVtW2dyb3VwRmllbGRbMF0ubmFtZV0gPSBzb3J0RmllbGRWYWx1ZVswXSArICLlubQiICsgc29ydEZpZWxkVmFsdWVbMV0gKyBsYWJlbDsKICAgICAgfSk7CiAgICAgIGFyci5zb3J0KGZ1bmN0aW9uIChhLCBiKSB7CiAgICAgICAgcmV0dXJuIE51bWJlcihhLnNvcnRGaWVsZCkgLSBOdW1iZXIoYi5zb3J0RmllbGQpOwogICAgICB9KTsKICAgICAgYXJyLmZvckVhY2goZnVuY3Rpb24gKGl0ZW0pIHsKICAgICAgICBkZWxldGUgaXRlbS5zb3J0RmllbGQ7CiAgICAgIH0pOwogICAgICByZXR1cm4gYXJyOwogICAgfQogICAgLyoqDQogICAgICog6KGl5YWo5pWw5o2u6ZuGDQogICAgICoNCiAgICAgKiBAcGFyYW0ge0FycmF5PGFueT59IGRhdGEg5Lyg5YWl5pWw5o2uDQogICAgICogQHBhcmFtIHtBcnJheTxhbnk+fSBpdGVtIOWNleS4quW6j+WIlw0KICAgICAqIEBwYXJhbSB7QXJyYXk8YW55Pn0gYWxsQ29kZUxpc3Qg5omA5pyJ55qE5Luj56CB6KGoDQogICAgICoNCiAgICAgKiBAbWVtYmVyb2YgUG9ydGxldF9PcmdQZXJzb25PcmdUeXBlUGllX2NoYXJ0QmFzZQ0KICAgICAqLwoKICB9LCB7CiAgICBrZXk6ICJjb21wbGV0ZURhdGFTZXQiLAogICAgdmFsdWU6IGZ1bmN0aW9uIGNvbXBsZXRlRGF0YVNldChkYXRhLCBpdGVtLCBhbGxDb2RlTGlzdCkgewogICAgICAvLyDliIbnu4TlsZ7mgKcKICAgICAgdmFyIGdyb3VwRmllbGQgPSBpdGVtLmRhdGFTZXRGaWVsZHMuZmluZChmdW5jdGlvbiAoZGF0YXNldEZpZWxkKSB7CiAgICAgICAgcmV0dXJuIGRhdGFzZXRGaWVsZC5uYW1lID09PSBpdGVtLmNhdGVnb3JGaWVsZDsKICAgICAgfSk7CgogICAgICBpZiAoT2JqZWN0LmlzKGdyb3VwRmllbGQuZ3JvdXBNb2RlLCAiIikpIHsKICAgICAgICByZXR1cm47CiAgICAgIH0gLy/liIbnu4TmqKHlvI/kuLrku6PnoIHooajvvIjooaXlgLzvvIkKCgogICAgICBpZiAoT2JqZWN0LmlzKGdyb3VwRmllbGQuZ3JvdXBNb2RlLCAnQ09ERUxJU1QnKSkgewogICAgICAgIHRoaXMuY29tcGxldGVDb2RlTGlzdChkYXRhLCBpdGVtLCBhbGxDb2RlTGlzdCk7CiAgICAgIH0gLy/liIbnu4TmqKHlvI/kuLrlubQv5a2j5bqmL+aciOS7ve+8iOacgOWkp+WAvO+8jOacgOWwj+WAvO+8jOWIhue7hO+8jOihpeWAvO+8iQoKCiAgICAgIGlmIChPYmplY3QuaXMoZ3JvdXBGaWVsZC5ncm91cE1vZGUsICJZRUFSIikgfHwgT2JqZWN0LmlzKGdyb3VwRmllbGQuZ3JvdXBNb2RlLCAiUVVBUlRFUiIpIHx8IE9iamVjdC5pcyhncm91cEZpZWxkLmdyb3VwTW9kZSwgIk1PTlRIIikgfHwgT2JqZWN0LmlzKGdyb3VwRmllbGQuZ3JvdXBNb2RlLCAiWUVBUldFRUsiKSB8fCBPYmplY3QuaXMoZ3JvdXBGaWVsZC5ncm91cE1vZGUsICJEQVkiKSkgewogICAgICAgIHRoaXMuaGFuZGxlVGltZURhdGEoZGF0YSwgaXRlbSwgYWxsQ29kZUxpc3QsIGdyb3VwRmllbGQpOwogICAgICB9CiAgICB9CiAgICAvKioNCiAgICAgKiDojrflj5bmnIDlpKflgLzmnIDlsI/lgLwNCiAgICAgKg0KICAgICAqIEBwYXJhbSB7QXJyYXk8YW55Pn0gdGVtcFRpbWVBcnJheSDkvKDlhaXmlbDmja4NCiAgICAgKg0KICAgICAqIEBtZW1iZXJvZiBQb3J0bGV0X09yZ1BlcnNvbk9yZ1R5cGVQaWVfY2hhcnRCYXNlDQogICAgICovCgogIH0sIHsKICAgIGtleTogImdldFJhbmdlRGF0YSIsCiAgICB2YWx1ZTogZnVuY3Rpb24gZ2V0UmFuZ2VEYXRhKHRlbXBUaW1lQXJyYXkpIHsKICAgICAgdGVtcFRpbWVBcnJheS5mb3JFYWNoKGZ1bmN0aW9uIChpdGVtKSB7CiAgICAgICAgdmFyIHRlbXBQYXJhbXMgPSBpdGVtLl9pLnNwbGl0KCItIik7CgogICAgICAgIGl0ZW0uc29ydEZpZWxkID0gTnVtYmVyKHRlbXBQYXJhbXNbMF0gKyB0ZW1wUGFyYW1zWzFdKTsKICAgICAgfSk7CiAgICAgIHRlbXBUaW1lQXJyYXkuc29ydChmdW5jdGlvbiAoYSwgYikgewogICAgICAgIHJldHVybiBOdW1iZXIoYS5zb3J0RmllbGQpIC0gTnVtYmVyKGIuc29ydEZpZWxkKTsKICAgICAgfSk7CiAgICAgIHRlbXBUaW1lQXJyYXkuZm9yRWFjaChmdW5jdGlvbiAoaXRlbSkgewogICAgICAgIGRlbGV0ZSBpdGVtLnNvcnRGaWVsZDsKICAgICAgfSk7CiAgICAgIHJldHVybiB0ZW1wVGltZUFycmF5OwogICAgfQogICAgLyoqDQogICAgICAqIOihpeWFqOaXtumXtOexu+Wei+aVsOaNrumbhg0KICAgICAgKg0KICAgICAgKiBAcGFyYW0ge0FycmF5PGFueT59IGRhdGEg5Lyg5YWl5pWw5o2uDQogICAgICAqIEBwYXJhbSB7QXJyYXk8YW55Pn0gaXRlbSDljZXkuKrluo/liJcNCiAgICAgICogQHBhcmFtIHtBcnJheTxhbnk+fSBhbGxDb2RlTGlzdCDmiYDmnInnmoTku6PnoIHooagNCiAgICAgICogQHBhcmFtIHtBcnJheTxhbnk+fSBncm91cEZpZWxkIOWIhue7hOWxnuaApw0KICAgICAgKg0KICAgICAgKiBAbWVtYmVyb2YgUG9ydGxldF9PcmdQZXJzb25PcmdUeXBlUGllX2NoYXJ0QmFzZQ0KICAgICAgKi8KCiAgfSwgewogICAga2V5OiAiaGFuZGxlVGltZURhdGEiLAogICAgdmFsdWU6IGZ1bmN0aW9uIGhhbmRsZVRpbWVEYXRhKGRhdGEsIGl0ZW0sIGFsbENvZGVMaXN0LCBncm91cEZpZWxkKSB7CiAgICAgIHZhciB2YWx1ZUZpZWxkID0gaXRlbS5kYXRhU2V0RmllbGRzLmZpbmQoZnVuY3Rpb24gKGRhdGFzZXRGaWVsZCkgewogICAgICAgIHJldHVybiBkYXRhc2V0RmllbGQubmFtZSA9PT0gaXRlbS52YWx1ZUZpZWxkOwogICAgICB9KTsKICAgICAgdmFyIGdyb3VwTW9kZSA9IGdyb3VwRmllbGQuZ3JvdXBNb2RlOyAvLyDmjpLluo/mlbDmja7vvIzmib7liLDmnIDlpKflgLzjgIHmnIDlsI/lgLwKCiAgICAgIHZhciB0ZW1wVGltZUFycmF5ID0gW107CgogICAgICBpZiAoZGF0YSAmJiBkYXRhLmxlbmd0aCA+IDApIHsKICAgICAgICBkYXRhLmZvckVhY2goZnVuY3Rpb24gKGRhdGFJdGVtKSB7CiAgICAgICAgICAvLyDliKTmlq3ml7bpl7TnsbvlnovmmK/lkKbkuLrnqbrvvIzkuLrnqbrkuI3lpITnkIYKICAgICAgICAgIGlmIChkYXRhSXRlbVtncm91cEZpZWxkLm5hbWVdKSB7CiAgICAgICAgICAgIHRlbXBUaW1lQXJyYXkucHVzaChtb21lbnQoZGF0YUl0ZW1bZ3JvdXBGaWVsZC5uYW1lXSkpOwogICAgICAgICAgfQogICAgICAgIH0pOwogICAgICB9CgogICAgICB2YXIgbWF4VGltZTsKICAgICAgdmFyIG1pblRpbWU7CgogICAgICBpZiAoT2JqZWN0LmlzKGdyb3VwTW9kZSwgIllFQVIiKSB8fCBPYmplY3QuaXMoZ3JvdXBNb2RlLCAiREFZIikpIHsKICAgICAgICBtYXhUaW1lID0gbW9tZW50Lm1heCh0ZW1wVGltZUFycmF5KTsKICAgICAgICBtaW5UaW1lID0gbW9tZW50Lm1pbih0ZW1wVGltZUFycmF5KTsKICAgICAgfQoKICAgICAgaWYgKE9iamVjdC5pcyhncm91cE1vZGUsICJRVUFSVEVSIikpIHsKICAgICAgICB0ZW1wVGltZUFycmF5ID0gdGhpcy5nZXRSYW5nZURhdGEodGVtcFRpbWVBcnJheSk7CiAgICAgICAgbWluVGltZSA9IG1vbWVudCgpLnllYXIodGVtcFRpbWVBcnJheVswXS5faS5zcGxpdCgiLSIpWzBdKS5xdWFydGVycyh0ZW1wVGltZUFycmF5WzBdLl9pLnNwbGl0KCItIilbMV0pOwogICAgICAgIG1heFRpbWUgPSBtb21lbnQoKS55ZWFyKHRlbXBUaW1lQXJyYXlbdGVtcFRpbWVBcnJheS5sZW5ndGggLSAxXS5faS5zcGxpdCgiLSIpWzBdKS5xdWFydGVycyh0ZW1wVGltZUFycmF5W3RlbXBUaW1lQXJyYXkubGVuZ3RoIC0gMV0uX2kuc3BsaXQoIi0iKVsxXSk7CiAgICAgIH0KCiAgICAgIGlmIChPYmplY3QuaXMoZ3JvdXBNb2RlLCAiTU9OVEgiKSkgewogICAgICAgIHRlbXBUaW1lQXJyYXkgPSB0aGlzLmdldFJhbmdlRGF0YSh0ZW1wVGltZUFycmF5KTsKICAgICAgICBtaW5UaW1lID0gbW9tZW50KCkueWVhcih0ZW1wVGltZUFycmF5WzBdLl9pLnNwbGl0KCItIilbMF0pLm1vbnRoKHRlbXBUaW1lQXJyYXlbMF0uX2kuc3BsaXQoIi0iKVsxXSk7CiAgICAgICAgbWF4VGltZSA9IG1vbWVudCgpLnllYXIodGVtcFRpbWVBcnJheVt0ZW1wVGltZUFycmF5Lmxlbmd0aCAtIDFdLl9pLnNwbGl0KCItIilbMF0pLm1vbnRoKHRlbXBUaW1lQXJyYXlbdGVtcFRpbWVBcnJheS5sZW5ndGggLSAxXS5faS5zcGxpdCgiLSIpWzFdKTsKICAgICAgfQoKICAgICAgaWYgKE9iamVjdC5pcyhncm91cE1vZGUsICJZRUFSV0VFSyIpKSB7CiAgICAgICAgdGVtcFRpbWVBcnJheSA9IHRoaXMuZ2V0UmFuZ2VEYXRhKHRlbXBUaW1lQXJyYXkpOwogICAgICAgIG1pblRpbWUgPSBtb21lbnQoKS55ZWFyKHRlbXBUaW1lQXJyYXlbMF0uX2kuc3BsaXQoIi0iKVswXSkud2Vlayh0ZW1wVGltZUFycmF5WzBdLl9pLnNwbGl0KCItIilbMV0pOwogICAgICAgIG1heFRpbWUgPSBtb21lbnQoKS55ZWFyKHRlbXBUaW1lQXJyYXlbdGVtcFRpbWVBcnJheS5sZW5ndGggLSAxXS5faS5zcGxpdCgiLSIpWzBdKS53ZWVrKHRlbXBUaW1lQXJyYXlbdGVtcFRpbWVBcnJheS5sZW5ndGggLSAxXS5faS5zcGxpdCgiLSIpWzFdKTsKICAgICAgfQoKICAgICAgdmFyIHRpbWVGcmFnbWVudEFycmF5ID0gW107CiAgICAgIHZhciB0ZW1wR3JvdW5wRGF0YSA9IG5ldyBNYXAoKTsgLy8g5pe26Ze05YiG5q61CiAgICAgIC8vZ3JvdXBNb2Rl5Li6IllFQVIiCgogICAgICBpZiAoT2JqZWN0LmlzKGdyb3VwTW9kZSwgIllFQVIiKSkgewogICAgICAgIHZhciBjdXJUaW1lID0gbWluVGltZTsKCiAgICAgICAgd2hpbGUgKGN1clRpbWUpIHsKICAgICAgICAgIGlmIChjdXJUaW1lLmlzU2FtZU9yQmVmb3JlKG1heFRpbWUpKSB7CiAgICAgICAgICAgIHZhciB0ZW1wY3VyVGltZSA9IGN1clRpbWUuY2xvbmUoKTsKICAgICAgICAgICAgdGltZUZyYWdtZW50QXJyYXkucHVzaCh0ZW1wY3VyVGltZS55ZWFyKCkudG9TdHJpbmcoKSk7CiAgICAgICAgICAgIGN1clRpbWUgPSB0ZW1wY3VyVGltZS5jbG9uZSgpLmFkZCgxLCAneWVhcnMnKTsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIGN1clRpbWUgPSBudWxsOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfSAvL2dyb3VwTW9kZeS4uiJRVUFSVEVSIgoKCiAgICAgIGlmIChPYmplY3QuaXMoZ3JvdXBNb2RlLCAiUVVBUlRFUiIpKSB7CiAgICAgICAgdmFyIF9jdXJUaW1lID0gbWluVGltZTsKCiAgICAgICAgd2hpbGUgKF9jdXJUaW1lKSB7CiAgICAgICAgICBpZiAoX2N1clRpbWUuaXNTYW1lT3JCZWZvcmUobWF4VGltZSkpIHsKICAgICAgICAgICAgdmFyIF90ZW1wY3VyVGltZSA9IF9jdXJUaW1lLmNsb25lKCk7CgogICAgICAgICAgICB0aW1lRnJhZ21lbnRBcnJheS5wdXNoKF90ZW1wY3VyVGltZS55ZWFyKCkudG9TdHJpbmcoKSArICItIiArIF90ZW1wY3VyVGltZS5xdWFydGVyKCkudG9TdHJpbmcoKSk7CiAgICAgICAgICAgIF9jdXJUaW1lID0gX3RlbXBjdXJUaW1lLmNsb25lKCkuYWRkKDEsICdxdWFydGVycycpOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgX2N1clRpbWUgPSBudWxsOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfSAvL2dyb3VwTW9kZeS4uiJNT05USCIKCgogICAgICBpZiAoT2JqZWN0LmlzKGdyb3VwTW9kZSwgIk1PTlRIIikpIHsKICAgICAgICB2YXIgX2N1clRpbWUyID0gbWluVGltZTsKCiAgICAgICAgd2hpbGUgKF9jdXJUaW1lMikgewogICAgICAgICAgaWYgKF9jdXJUaW1lMi5pc1NhbWVPckJlZm9yZShtYXhUaW1lKSkgewogICAgICAgICAgICB2YXIgX3RlbXBjdXJUaW1lMiA9IF9jdXJUaW1lMi5jbG9uZSgpOwoKICAgICAgICAgICAgdGltZUZyYWdtZW50QXJyYXkucHVzaChfdGVtcGN1clRpbWUyLnllYXIoKS50b1N0cmluZygpICsgIi0iICsgX3RlbXBjdXJUaW1lMi5tb250aCgpLnRvU3RyaW5nKCkpOwogICAgICAgICAgICBfY3VyVGltZTIgPSBfdGVtcGN1clRpbWUyLmNsb25lKCkuYWRkKDEsICdtb250aHMnKTsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIF9jdXJUaW1lMiA9IG51bGw7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9IC8vZ3JvdXBNb2Rl5Li6IllFQVJXRUVLIgoKCiAgICAgIGlmIChPYmplY3QuaXMoZ3JvdXBNb2RlLCAiWUVBUldFRUsiKSkgewogICAgICAgIHZhciBfY3VyVGltZTMgPSBtaW5UaW1lOwoKICAgICAgICB3aGlsZSAoX2N1clRpbWUzKSB7CiAgICAgICAgICBpZiAoX2N1clRpbWUzLmlzU2FtZU9yQmVmb3JlKG1heFRpbWUpKSB7CiAgICAgICAgICAgIHZhciBfdGVtcGN1clRpbWUzID0gX2N1clRpbWUzLmNsb25lKCk7CgogICAgICAgICAgICB0aW1lRnJhZ21lbnRBcnJheS5wdXNoKF90ZW1wY3VyVGltZTMueWVhcigpLnRvU3RyaW5nKCkgKyAiLSIgKyBfdGVtcGN1clRpbWUzLndlZWsoKS50b1N0cmluZygpKTsKICAgICAgICAgICAgX2N1clRpbWUzID0gX3RlbXBjdXJUaW1lMy5jbG9uZSgpLmFkZCgxLCAnd2Vla3MnKTsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIF9jdXJUaW1lMyA9IG51bGw7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9IC8vZ3JvdXBNb2Rl5Li6IkRBWSIKCgogICAgICBpZiAoT2JqZWN0LmlzKGdyb3VwTW9kZSwgIkRBWSIpKSB7CiAgICAgICAgdmFyIF9jdXJUaW1lNCA9IG1pblRpbWU7CgogICAgICAgIHdoaWxlIChfY3VyVGltZTQpIHsKICAgICAgICAgIGlmIChfY3VyVGltZTQuaXNTYW1lT3JCZWZvcmUobWF4VGltZSkpIHsKICAgICAgICAgICAgdmFyIF90ZW1wY3VyVGltZTQgPSBfY3VyVGltZTQuY2xvbmUoKTsKCiAgICAgICAgICAgIHRpbWVGcmFnbWVudEFycmF5LnB1c2goX3RlbXBjdXJUaW1lNC5mb3JtYXQoJ1lZWVktTU0tREQnKSk7CiAgICAgICAgICAgIF9jdXJUaW1lNCA9IF90ZW1wY3VyVGltZTQuY2xvbmUoKS5hZGQoMSwgJ2RheXMnKTsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIF9jdXJUaW1lNCA9IG51bGw7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9CgogICAgICBkYXRhLmZvckVhY2goZnVuY3Rpb24gKGl0ZW0pIHsKICAgICAgICB2YXIgdGVtcEtleVN0ciA9IGl0ZW1bZ3JvdXBGaWVsZC5uYW1lXTsKICAgICAgICB2YXIgdGVtcEdyb3VucEl0ZW0gPSB0ZW1wR3JvdW5wRGF0YS5nZXQodGVtcEtleVN0cik7CgogICAgICAgIGlmICghdGVtcEdyb3VucEl0ZW0pIHsKICAgICAgICAgIHRlbXBHcm91bnBEYXRhLnNldCh0ZW1wS2V5U3RyLCBpdGVtKTsKICAgICAgICB9CiAgICAgIH0pOwogICAgICB0aW1lRnJhZ21lbnRBcnJheS5mb3JFYWNoKGZ1bmN0aW9uICh0aW1lRnJhZ21lbnQpIHsKICAgICAgICBpZiAoIXRlbXBHcm91bnBEYXRhLmdldCh0aW1lRnJhZ21lbnQpKSB7CiAgICAgICAgICB2YXIgY29weVRlbXAgPSBKU09OLnBhcnNlKEpTT04uc3RyaW5naWZ5KGRhdGFbMF0pKTsKICAgICAgICAgIHZhciBjdXJPYmogPSB7fTsKICAgICAgICAgIGN1ck9ialtncm91cEZpZWxkLm5hbWVdID0gdGltZUZyYWdtZW50OwogICAgICAgICAgY3VyT2JqW3ZhbHVlRmllbGQubmFtZV0gPSAwOwogICAgICAgICAgT2JqZWN0LmFzc2lnbihjb3B5VGVtcCwgY3VyT2JqKTsKICAgICAgICAgIGRhdGEucHVzaChjb3B5VGVtcCk7CiAgICAgICAgfQogICAgICB9KTsKICAgIH0KICAgIC8qKg0KICAgICAqIOihpeWFqOS7o+eggeihqA0KICAgICAqDQogICAgICogQHBhcmFtIHtBcnJheTxhbnk+fSBkYXRhIOS8oOWFpeaVsOaNrg0KICAgICAqIEBwYXJhbSB7QXJyYXk8YW55Pn0gaXRlbSDljZXkuKrluo/liJcNCiAgICAgKiBAcGFyYW0ge0FycmF5PGFueT59IGFsbENvZGVMaXN0IOaJgOacieeahOS7o+eggeihqA0KICAgICAqDQogICAgICogQG1lbWJlcm9mIFBvcnRsZXRfT3JnUGVyc29uT3JnVHlwZVBpZV9jaGFydEJhc2UNCiAgICAgKi8KCiAgfSwgewogICAga2V5OiAiY29tcGxldGVDb2RlTGlzdCIsCiAgICB2YWx1ZTogZnVuY3Rpb24gY29tcGxldGVDb2RlTGlzdChkYXRhLCBpdGVtLCBhbGxDb2RlTGlzdCkgewogICAgICB2YXIgZ3JvdXBGaWVsZCA9IGl0ZW0uZGF0YVNldEZpZWxkcy5maW5kKGZ1bmN0aW9uIChkYXRhc2V0RmllbGQpIHsKICAgICAgICByZXR1cm4gZGF0YXNldEZpZWxkLm5hbWUgPT09IGl0ZW0uY2F0ZWdvckZpZWxkOwogICAgICB9KTsKCiAgICAgIGlmICghZ3JvdXBGaWVsZC5jb2RlbGlzdCkgewogICAgICAgIHJldHVybjsKICAgICAgfQoKICAgICAgdmFyIHZhbHVlRmllbGQgPSBpdGVtLmRhdGFTZXRGaWVsZHMuZmluZChmdW5jdGlvbiAoZGF0YXNldEZpZWxkKSB7CiAgICAgICAgcmV0dXJuIGRhdGFzZXRGaWVsZC5uYW1lID09PSBpdGVtLnZhbHVlRmllbGQ7CiAgICAgIH0pOwogICAgICB2YXIgY3VyQ29kZUxpc3QgPSBhbGxDb2RlTGlzdC5nZXQoZ3JvdXBGaWVsZC5jb2RlbGlzdC50YWcpOyAvLyDlr7nliIbnsbvlrp7njrDliIbnu4QKCiAgICAgIHZhciB0ZW1wR3JvdW5wRGF0YSA9IG5ldyBNYXAoKTsKICAgICAgZGF0YS5mb3JFYWNoKGZ1bmN0aW9uIChpdGVtKSB7CiAgICAgICAgdmFyIHRlbXBHcm91bnBJdGVtID0gdGVtcEdyb3VucERhdGEuZ2V0KGl0ZW1bZ3JvdXBGaWVsZC5uYW1lICsgJ19zcmZ2YWx1ZSddKTsKCiAgICAgICAgaWYgKCF0ZW1wR3JvdW5wSXRlbSkgewogICAgICAgICAgdGVtcEdyb3VucERhdGEuc2V0KGl0ZW1bZ3JvdXBGaWVsZC5uYW1lICsgJ19zcmZ2YWx1ZSddLCBpdGVtKTsKICAgICAgICB9CiAgICAgIH0pOwoKICAgICAgaWYgKGN1ckNvZGVMaXN0LnNpemUgIT09IHRlbXBHcm91bnBEYXRhLnNpemUpIHsKICAgICAgICBjdXJDb2RlTGlzdC5mb3JFYWNoKGZ1bmN0aW9uICh0ZXh0LCB2YWx1ZSkgewogICAgICAgICAgaWYgKCF0ZW1wR3JvdW5wRGF0YS5nZXQodmFsdWUpKSB7CiAgICAgICAgICAgIHZhciBjb3B5VGVtcCA9IEpTT04ucGFyc2UoSlNPTi5zdHJpbmdpZnkoZGF0YVswXSkpOwogICAgICAgICAgICB2YXIgY3VyT2JqID0ge307CiAgICAgICAgICAgIGN1ck9ialtncm91cEZpZWxkLm5hbWUgKyAnX3NyZnZhbHVlJ10gPSB2YWx1ZTsKICAgICAgICAgICAgY3VyT2JqW2dyb3VwRmllbGQubmFtZV0gPSB0ZXh0OwogICAgICAgICAgICBjdXJPYmpbdmFsdWVGaWVsZC5uYW1lXSA9IDA7CiAgICAgICAgICAgIE9iamVjdC5hc3NpZ24oY29weVRlbXAsIGN1ck9iaik7CiAgICAgICAgICAgIGRhdGEucHVzaChjb3B5VGVtcCk7CiAgICAgICAgICB9CiAgICAgICAgfSk7CiAgICAgIH0KICAgIH0KICAgIC8qKg0KICAgICAqIOWkhOeQhuWNleS4quWxnuaApw0KICAgICAqDQogICAgICogQHBhcmFtIHsqfSBpbnB1dCDovpPlhaXlgLwNCiAgICAgKiBAcGFyYW0geyp9IGZpZWxkIOWxnuaAp+WAvA0KICAgICAqIEBwYXJhbSB7Kn0gYWxsQ29kZUxpc3Qg5omA5pyJ5Luj56CB6KGoDQogICAgICogQHBhcmFtIHsqfSByZXN1bHQg57uT5p6c5YC8DQogICAgICoNCiAgICAgKiBAbWVtYmVyb2YgUG9ydGxldF9PcmdQZXJzb25PcmdUeXBlUGllX2NoYXJ0QmFzZQ0KICAgICAqLwoKICB9LCB7CiAgICBrZXk6ICJoYW5kbGVTaW5nbGVEYXRhU2V0RmllbGQiLAogICAgdmFsdWU6IGZ1bmN0aW9uIGhhbmRsZVNpbmdsZURhdGFTZXRGaWVsZChpbnB1dCwgZmllbGQsIGFsbENvZGVMaXN0LCByZXN1bHQsIGdyb3VwRmllbGQpIHsKICAgICAgdmFyIHRlbXBGaWVsZE9iaiA9IHt9OyAvL+WtmOWcqOS7o+eggeihqOeahOaDheWGtSjoh6rliqjovazljJblgLwpCgogICAgICBpZiAoZmllbGQuY29kZWxpc3QpIHsKICAgICAgICAvL+iOt+WPluS7o+eggeihqAogICAgICAgIHZhciBjdXJDb2RlTGlzdCA9IGFsbENvZGVMaXN0LmdldChmaWVsZC5jb2RlbGlzdC50YWcpOwogICAgICAgIHRlbXBGaWVsZE9ialtmaWVsZC5uYW1lXSA9IGN1ckNvZGVMaXN0LmdldChpbnB1dFtmaWVsZC5uYW1lXSk7CiAgICAgICAgdGVtcEZpZWxkT2JqW2ZpZWxkLm5hbWUgKyAnX3NyZnZhbHVlJ10gPSBpbnB1dFtmaWVsZC5uYW1lXTsKICAgICAgfSBlbHNlIHsKICAgICAgICAvLyDkuI3lrZjlnKjku6PnoIHooajnmoTmg4XlhrUKICAgICAgICBpZiAoZ3JvdXBGaWVsZCAmJiBPYmplY3QuaXMoZ3JvdXBGaWVsZC5uYW1lLCBmaWVsZC5uYW1lKSkgewogICAgICAgICAgaWYgKE9iamVjdC5pcyhncm91cEZpZWxkLmdyb3VwTW9kZSwgIllFQVIiKSkgewogICAgICAgICAgICB0ZW1wRmllbGRPYmpbZmllbGQubmFtZV0gPSBtb21lbnQoaW5wdXRbZmllbGQubmFtZV0pLnllYXIoKS50b1N0cmluZygpOwogICAgICAgICAgfSBlbHNlIGlmIChPYmplY3QuaXMoZ3JvdXBGaWVsZC5ncm91cE1vZGUsICJRVUFSVEVSIikpIHsKICAgICAgICAgICAgdGVtcEZpZWxkT2JqW2ZpZWxkLm5hbWVdID0gbW9tZW50KGlucHV0W2ZpZWxkLm5hbWVdKS55ZWFyKCkudG9TdHJpbmcoKSArICItIiArIG1vbWVudChpbnB1dFtmaWVsZC5uYW1lXSkucXVhcnRlcnMoKS50b1N0cmluZygpOwogICAgICAgICAgfSBlbHNlIGlmIChPYmplY3QuaXMoZ3JvdXBGaWVsZC5ncm91cE1vZGUsICJNT05USCIpKSB7CiAgICAgICAgICAgIHRlbXBGaWVsZE9ialtmaWVsZC5uYW1lXSA9IG1vbWVudChpbnB1dFtmaWVsZC5uYW1lXSkueWVhcigpLnRvU3RyaW5nKCkgKyAiLSIgKyBtb21lbnQoaW5wdXRbZmllbGQubmFtZV0pLm1vbnRoKCkudG9TdHJpbmcoKTsKICAgICAgICAgIH0gZWxzZSBpZiAoT2JqZWN0LmlzKGdyb3VwRmllbGQuZ3JvdXBNb2RlLCAiWUVBUldFRUsiKSkgewogICAgICAgICAgICB0ZW1wRmllbGRPYmpbZmllbGQubmFtZV0gPSBtb21lbnQoaW5wdXRbZmllbGQubmFtZV0pLnllYXIoKS50b1N0cmluZygpICsgIi0iICsgbW9tZW50KGlucHV0W2ZpZWxkLm5hbWVdKS53ZWVrKCkudG9TdHJpbmcoKTsKICAgICAgICAgIH0gZWxzZSBpZiAoT2JqZWN0LmlzKGdyb3VwRmllbGQuZ3JvdXBNb2RlLCAiREFZIikpIHsKICAgICAgICAgICAgdGVtcEZpZWxkT2JqW2ZpZWxkLm5hbWVdID0gbW9tZW50KGlucHV0W2ZpZWxkLm5hbWVdKS5mb3JtYXQoIllZWVktTU0tREQiKTsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHRlbXBGaWVsZE9ialtmaWVsZC5uYW1lXSA9IGlucHV0W2ZpZWxkLm5hbWVdOwogICAgICAgICAgfQogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICB0ZW1wRmllbGRPYmpbZmllbGQubmFtZV0gPSBpbnB1dFtmaWVsZC5uYW1lXTsKICAgICAgICB9CiAgICAgIH0KCiAgICAgIE9iamVjdC5hc3NpZ24ocmVzdWx0LCB0ZW1wRmllbGRPYmopOwogICAgfQogICAgLyoqDQogICAgICog6I635Y+W5Zu+6KGo5omA6ZyA5Luj56CB6KGoDQogICAgICoNCiAgICAgKiBAbWVtYmVyb2YgUG9ydGxldF9PcmdQZXJzb25PcmdUeXBlUGllX2NoYXJ0QmFzZQ0KICAgICAqLwoKICB9LCB7CiAgICBrZXk6ICJnZXRDaGFydEFsbENvZGVMaXN0IiwKICAgIHZhbHVlOiBmdW5jdGlvbiBnZXRDaGFydEFsbENvZGVMaXN0KCkgewogICAgICB2YXIgX3RoaXM3ID0gdGhpczsKCiAgICAgIHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbiAocmVzb2x2ZSwgcmVqZWN0KSB7CiAgICAgICAgdmFyIGNvZGVMaXN0TWFwID0gbmV3IE1hcCgpOwoKICAgICAgICBpZiAoT2JqZWN0LnZhbHVlcyhfdGhpczcuc2VyaWVzTW9kZWwpLmxlbmd0aCA+IDApIHsKICAgICAgICAgIHZhciB0ZW1wRmxhZyA9IHRydWU7CiAgICAgICAgICBPYmplY3QudmFsdWVzKF90aGlzNy5zZXJpZXNNb2RlbCkuZm9yRWFjaChmdW5jdGlvbiAoc2luZ2xlU2VyaWVzKSB7CiAgICAgICAgICAgIGlmIChzaW5nbGVTZXJpZXMuZGF0YVNldEZpZWxkcyAmJiBzaW5nbGVTZXJpZXMuZGF0YVNldEZpZWxkcy5sZW5ndGggPiAwKSB7CiAgICAgICAgICAgICAgdmFyIHByb21pc2VBcnJheSA9IFtdOwogICAgICAgICAgICAgIHZhciBwcm9taXNlS2V5QXJyYXkgPSBbXTsKICAgICAgICAgICAgICBzaW5nbGVTZXJpZXMuZGF0YVNldEZpZWxkcy5mb3JFYWNoKGZ1bmN0aW9uIChzaW5nbGVEYXRhU2V0RmllbGQsIGluZGV4KSB7CiAgICAgICAgICAgICAgICBpZiAoc2luZ2xlRGF0YVNldEZpZWxkLmNvZGVsaXN0KSB7CiAgICAgICAgICAgICAgICAgIHRlbXBGbGFnID0gZmFsc2U7CgogICAgICAgICAgICAgICAgICBpZiAoIWNvZGVMaXN0TWFwLmdldChzaW5nbGVEYXRhU2V0RmllbGQuY29kZWxpc3QudGFnKSkgewogICAgICAgICAgICAgICAgICAgIHByb21pc2VBcnJheS5wdXNoKF90aGlzNy5nZXRDb2RlTGlzdChzaW5nbGVEYXRhU2V0RmllbGQuY29kZWxpc3QpKTsKICAgICAgICAgICAgICAgICAgICBwcm9taXNlS2V5QXJyYXkucHVzaChzaW5nbGVEYXRhU2V0RmllbGQuY29kZWxpc3QudGFnKTsKICAgICAgICAgICAgICAgICAgICBQcm9taXNlLmFsbChwcm9taXNlQXJyYXkpLnRoZW4oZnVuY3Rpb24gKHJlc3VsdCkgewogICAgICAgICAgICAgICAgICAgICAgaWYgKHJlc3VsdCAmJiByZXN1bHQubGVuZ3RoID4gMCkgewogICAgICAgICAgICAgICAgICAgICAgICByZXN1bHQuZm9yRWFjaChmdW5jdGlvbiAoY29kZUxpc3QpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgdGVtcENvZGVMaXN0TWFwID0gbmV3IE1hcCgpOwoKICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoY29kZUxpc3QubGVuZ3RoID4gMCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgY29kZUxpc3QuZm9yRWFjaChmdW5jdGlvbiAoY29kZUxpc3RJdGVtKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRlbXBDb2RlTGlzdE1hcC5zZXQoY29kZUxpc3RJdGVtLnZhbHVlLCBjb2RlTGlzdEl0ZW0udGV4dCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgICAgICAgIGNvZGVMaXN0TWFwLnNldChzaW5nbGVEYXRhU2V0RmllbGQuY29kZWxpc3QudGFnLCB0ZW1wQ29kZUxpc3RNYXApOwogICAgICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZShjb2RlTGlzdE1hcCk7CiAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfQogICAgICAgICAgfSk7CgogICAgICAgICAgaWYgKHRlbXBGbGFnKSB7CiAgICAgICAgICAgIHJlc29sdmUoY29kZUxpc3RNYXApOwogICAgICAgICAgfQogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICByZXNvbHZlKGNvZGVMaXN0TWFwKTsKICAgICAgICB9CiAgICAgIH0pOwogICAgfQogICAgLyoqDQogICAgICog6I635Y+W5Luj56CB6KGoDQogICAgICoNCiAgICAgKiBAcmV0dXJucyB7UHJvbWlzZTxhbnk+fQ0KICAgICAqIEBtZW1iZXJvZiBQb3J0bGV0X09yZ1BlcnNvbk9yZ1R5cGVQaWVfY2hhcnRCYXNlDQogICAgICovCgogIH0sIHsKICAgIGtleTogImdldENvZGVMaXN0IiwKICAgIHZhbHVlOiBmdW5jdGlvbiBnZXRDb2RlTGlzdChjb2RlTGlzdE9iamVjdCkgewogICAgICB2YXIgX3RoaXM4ID0gdGhpczsKCiAgICAgIHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbiAocmVzb2x2ZSwgcmVqZWN0KSB7CiAgICAgICAgaWYgKGNvZGVMaXN0T2JqZWN0LnRhZyAmJiBPYmplY3QuaXMoY29kZUxpc3RPYmplY3QudHlwZSwgIlNUQVRJQyIpKSB7CiAgICAgICAgICB2YXIgY29kZWxpc3QgPSBfdGhpczguJHN0b3JlLmdldHRlcnMuZ2V0Q29kZUxpc3QoY29kZUxpc3RPYmplY3QudGFnKTsKCiAgICAgICAgICBpZiAoY29kZWxpc3QpIHsKICAgICAgICAgICAgcmVzb2x2ZShfdG9Db25zdW1hYmxlQXJyYXkoSlNPTi5wYXJzZShKU09OLnN0cmluZ2lmeShjb2RlbGlzdC5pdGVtcykpKSk7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBjb25zb2xlLmxvZygiLS0tLSIuY29uY2F0KGNvZGVMaXN0T2JqZWN0LnRhZywgIi0tLS1cdTRFRTNcdTc4MDFcdTg4NjhcdTRFMERcdTVCNThcdTU3MjgiKSk7CiAgICAgICAgICB9CiAgICAgICAgfSBlbHNlIGlmIChjb2RlTGlzdE9iamVjdC50YWcgJiYgT2JqZWN0LmlzKGNvZGVMaXN0T2JqZWN0LnR5cGUsICJEWU5BTUlDIikpIHsKICAgICAgICAgIF90aGlzOC5jb2RlTGlzdFNlcnZpY2UuZ2V0SXRlbXMoY29kZUxpc3RPYmplY3QudGFnKS50aGVuKGZ1bmN0aW9uIChyZXMpIHsKICAgICAgICAgICAgcmVzb2x2ZShyZXMpOwogICAgICAgICAgfSlbImNhdGNoIl0oZnVuY3Rpb24gKGVycm9yKSB7CiAgICAgICAgICAgIGNvbnNvbGUubG9nKCItLS0tIi5jb25jYXQoY29kZUxpc3RPYmplY3QudGFnLCAiLS0tLVx1NEVFM1x1NzgwMVx1ODg2OFx1NEUwRFx1NUI1OFx1NTcyOCIpKTsKICAgICAgICAgIH0pOwogICAgICAgIH0KICAgICAgfSk7CiAgICB9CiAgfV0pOwoKICByZXR1cm4gT3JnUGVyc29uT3JnVHlwZUJhc2U7Cn0oVnVlKTsKCnRzbGliXzEuX19kZWNvcmF0ZShbUHJvcCgpXSwgT3JnUGVyc29uT3JnVHlwZUJhc2UucHJvdG90eXBlLCAibmFtZSIsIHZvaWQgMCk7Cgp0c2xpYl8xLl9fZGVjb3JhdGUoW1Byb3AoKV0sIE9yZ1BlcnNvbk9yZ1R5cGVCYXNlLnByb3RvdHlwZSwgInZpZXdTdGF0ZSIsIHZvaWQgMCk7Cgp0c2xpYl8xLl9fZGVjb3JhdGUoW1Byb3AoKV0sIE9yZ1BlcnNvbk9yZ1R5cGVCYXNlLnByb3RvdHlwZSwgImNvbnRleHQiLCB2b2lkIDApOwoKdHNsaWJfMS5fX2RlY29yYXRlKFtQcm9wKCldLCBPcmdQZXJzb25PcmdUeXBlQmFzZS5wcm90b3R5cGUsICJ2aWV3cGFyYW1zIiwgdm9pZCAwKTsKCnRzbGliXzEuX19kZWNvcmF0ZShbUHJvcCh7CiAgImRlZmF1bHQiOiB0cnVlCn0pXSwgT3JnUGVyc29uT3JnVHlwZUJhc2UucHJvdG90eXBlLCAic2hvd0J1c3lJbmRpY2F0b3IiLCB2b2lkIDApOwoKdHNsaWJfMS5fX2RlY29yYXRlKFtQcm9wKCldLCBPcmdQZXJzb25PcmdUeXBlQmFzZS5wcm90b3R5cGUsICJmZXRjaEFjdGlvbiIsIHZvaWQgMCk7CgpPcmdQZXJzb25PcmdUeXBlQmFzZSA9IHRzbGliXzEuX19kZWNvcmF0ZShbQ29tcG9uZW50KHsKICBjb21wb25lbnRzOiB7fQp9KV0sIE9yZ1BlcnNvbk9yZ1R5cGVCYXNlKTsKZXhwb3J0IGRlZmF1bHQgT3JnUGVyc29uT3JnVHlwZUJhc2U7"},null]}
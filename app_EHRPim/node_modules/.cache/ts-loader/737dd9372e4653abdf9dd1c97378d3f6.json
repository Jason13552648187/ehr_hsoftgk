{"remainingRequest":"F:\\crod项目\\人事管理系统2\\iBizEHR\\app_EHRPim\\node_modules\\thread-loader\\dist\\cjs.js!F:\\crod项目\\人事管理系统2\\iBizEHR\\app_EHRPim\\node_modules\\babel-loader\\lib\\index.js!F:\\crod项目\\人事管理系统2\\iBizEHR\\app_EHRPim\\node_modules\\ts-loader\\index.js??ref--13-3!F:\\crod项目\\人事管理系统2\\iBizEHR\\app_EHRPim\\src\\service\\orm-org\\orm-org-service-base.ts","dependencies":[{"path":"F:\\crod项目\\人事管理系统2\\iBizEHR\\app_EHRPim\\src\\service\\orm-org\\orm-org-service-base.ts","mtime":1630509410420},{"path":"F:\\crod项目\\人事管理系统2\\iBizEHR\\app_EHRPim\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1630511852775},{"path":"F:\\crod项目\\人事管理系统2\\iBizEHR\\app_EHRPim\\node_modules\\thread-loader\\dist\\cjs.js","mtime":1630511853252},{"path":"F:\\crod项目\\人事管理系统2\\iBizEHR\\app_EHRPim\\node_modules\\babel-loader\\lib\\index.js","mtime":1630511852747},{"path":"F:\\crod项目\\人事管理系统2\\iBizEHR\\app_EHRPim\\node_modules\\ts-loader\\index.js","mtime":1630511985412}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:aW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkuZm9yLWVhY2giOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5vYmplY3QuaXMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy93ZWIuZG9tLWNvbGxlY3Rpb25zLmZvci1lYWNoIjsKaW1wb3J0ICJyZWdlbmVyYXRvci1ydW50aW1lL3J1bnRpbWUiOwppbXBvcnQgX2FzeW5jVG9HZW5lcmF0b3IgZnJvbSAiRjpcXGNyb2RcdTk4NzlcdTc2RUVcXFx1NEVCQVx1NEU4Qlx1N0JBMVx1NzQwNlx1N0NGQlx1N0VERjJcXGlCaXpFSFJcXGFwcF9FSFJQaW1cXG5vZGVfbW9kdWxlc1xcQGJhYmVsXFxydW50aW1lL2hlbHBlcnMvZXNtL2FzeW5jVG9HZW5lcmF0b3IiOwppbXBvcnQgX2NsYXNzQ2FsbENoZWNrIGZyb20gIkY6XFxjcm9kXHU5ODc5XHU3NkVFXFxcdTRFQkFcdTRFOEJcdTdCQTFcdTc0MDZcdTdDRkJcdTdFREYyXFxpQml6RUhSXFxhcHBfRUhSUGltXFxub2RlX21vZHVsZXNcXEBiYWJlbFxccnVudGltZS9oZWxwZXJzL2VzbS9jbGFzc0NhbGxDaGVjayI7CmltcG9ydCBfY3JlYXRlQ2xhc3MgZnJvbSAiRjpcXGNyb2RcdTk4NzlcdTc2RUVcXFx1NEVCQVx1NEU4Qlx1N0JBMVx1NzQwNlx1N0NGQlx1N0VERjJcXGlCaXpFSFJcXGFwcF9FSFJQaW1cXG5vZGVfbW9kdWxlc1xcQGJhYmVsXFxydW50aW1lL2hlbHBlcnMvZXNtL2NyZWF0ZUNsYXNzIjsKaW1wb3J0IF9wb3NzaWJsZUNvbnN0cnVjdG9yUmV0dXJuIGZyb20gIkY6XFxjcm9kXHU5ODc5XHU3NkVFXFxcdTRFQkFcdTRFOEJcdTdCQTFcdTc0MDZcdTdDRkJcdTdFREYyXFxpQml6RUhSXFxhcHBfRUhSUGltXFxub2RlX21vZHVsZXNcXEBiYWJlbFxccnVudGltZS9oZWxwZXJzL2VzbS9wb3NzaWJsZUNvbnN0cnVjdG9yUmV0dXJuIjsKaW1wb3J0IF9nZXRQcm90b3R5cGVPZiBmcm9tICJGOlxcY3JvZFx1OTg3OVx1NzZFRVxcXHU0RUJBXHU0RThCXHU3QkExXHU3NDA2XHU3Q0ZCXHU3RURGMlxcaUJpekVIUlxcYXBwX0VIUlBpbVxcbm9kZV9tb2R1bGVzXFxAYmFiZWxcXHJ1bnRpbWUvaGVscGVycy9lc20vZ2V0UHJvdG90eXBlT2YiOwppbXBvcnQgX2luaGVyaXRzIGZyb20gIkY6XFxjcm9kXHU5ODc5XHU3NkVFXFxcdTRFQkFcdTRFOEJcdTdCQTFcdTc0MDZcdTdDRkJcdTdFREYyXFxpQml6RUhSXFxhcHBfRUhSUGltXFxub2RlX21vZHVsZXNcXEBiYWJlbFxccnVudGltZS9oZWxwZXJzL2VzbS9pbmhlcml0cyI7CmltcG9ydCB7IEh0dHAgfSBmcm9tICdAL3V0aWxzJzsKaW1wb3J0IEVudGl0eVNlcnZpY2UgZnJvbSAnLi4vZW50aXR5LXNlcnZpY2UnOwovKioNCiAqIOe7hOe7h+euoeeQhuacjeWKoeWvueixoeWfuuexuw0KICoNCiAqIEBleHBvcnQNCiAqIEBjbGFzcyBPcm1PcmdTZXJ2aWNlQmFzZQ0KICogQGV4dGVuZHMge0VudGl0eVNlcnZpZX0NCiAqLwoKdmFyIE9ybU9yZ1NlcnZpY2VCYXNlID0KLyojX19QVVJFX18qLwpmdW5jdGlvbiAoX0VudGl0eVNlcnZpY2UpIHsKICBfaW5oZXJpdHMoT3JtT3JnU2VydmljZUJhc2UsIF9FbnRpdHlTZXJ2aWNlKTsKCiAgLyoqDQogICAqIENyZWF0ZXMgYW4gaW5zdGFuY2Ugb2YgIE9ybU9yZ1NlcnZpY2VCYXNlLg0KICAgKg0KICAgKiBAcGFyYW0geyp9IFtvcHRzPXt9XQ0KICAgKiBAbWVtYmVyb2YgIE9ybU9yZ1NlcnZpY2VCYXNlDQogICAqLwogIGZ1bmN0aW9uIE9ybU9yZ1NlcnZpY2VCYXNlKCkgewogICAgdmFyIG9wdHMgPSBhcmd1bWVudHMubGVuZ3RoID4gMCAmJiBhcmd1bWVudHNbMF0gIT09IHVuZGVmaW5lZCA/IGFyZ3VtZW50c1swXSA6IHt9OwoKICAgIF9jbGFzc0NhbGxDaGVjayh0aGlzLCBPcm1PcmdTZXJ2aWNlQmFzZSk7CgogICAgcmV0dXJuIF9wb3NzaWJsZUNvbnN0cnVjdG9yUmV0dXJuKHRoaXMsIF9nZXRQcm90b3R5cGVPZihPcm1PcmdTZXJ2aWNlQmFzZSkuY2FsbCh0aGlzLCBvcHRzKSk7CiAgfQogIC8qKg0KICAgKiDliJ3lp4vljJbln7rnoYDmlbDmja4NCiAgICoNCiAgICogQG1lbWJlcm9mIE9ybU9yZ1NlcnZpY2VCYXNlDQogICAqLwoKCiAgX2NyZWF0ZUNsYXNzKE9ybU9yZ1NlcnZpY2VCYXNlLCBbewogICAga2V5OiAiaW5pdEJhc2ljRGF0YSIsCiAgICB2YWx1ZTogZnVuY3Rpb24gaW5pdEJhc2ljRGF0YSgpIHsKICAgICAgdGhpcy5BUFBMWURFS0VZID0gJ29ybW9yZyc7CiAgICAgIHRoaXMuQVBQREVLRVkgPSAnb3JnaWQnOwogICAgICB0aGlzLkFQUERFTkFNRSA9ICdvcm1vcmdzJzsKICAgICAgdGhpcy5BUFBERVRFWFQgPSAnb3JnbmFtZSc7CiAgICAgIHRoaXMuQVBQTkFNRSA9ICdlaHJwaW0nOwogICAgICB0aGlzLlNZU1RFTU5BTUUgPSAnZWhyJzsKICAgIH0gLy8g5a6e5L2T5o6l5Y+jCgogICAgLyoqDQogICAgICogU2VsZWN05o6l5Y+j5pa55rOVDQogICAgICoNCiAgICAgKiBAcGFyYW0geyp9IFtjb250ZXh0PXt9XQ0KICAgICAqIEBwYXJhbSB7Kn0gW2RhdGE9e31dDQogICAgICogQHBhcmFtIHtib29sZWFufSBbaXNsb2FkaW5nXQ0KICAgICAqIEByZXR1cm5zIHtQcm9taXNlPGFueT59DQogICAgICogQG1lbWJlcm9mIE9ybU9yZ1NlcnZpY2VCYXNlDQogICAgICovCgogIH0sIHsKICAgIGtleTogIlNlbGVjdCIsCiAgICB2YWx1ZTogZnVuY3Rpb24gKCkgewogICAgICB2YXIgX1NlbGVjdCA9IF9hc3luY1RvR2VuZXJhdG9yKAogICAgICAvKiNfX1BVUkVfXyovCiAgICAgIHJlZ2VuZXJhdG9yUnVudGltZS5tYXJrKGZ1bmN0aW9uIF9jYWxsZWUoKSB7CiAgICAgICAgdmFyIGNvbnRleHQsCiAgICAgICAgICAgIGRhdGEsCiAgICAgICAgICAgIGlzbG9hZGluZywKICAgICAgICAgICAgX2FyZ3MgPSBhcmd1bWVudHM7CiAgICAgICAgcmV0dXJuIHJlZ2VuZXJhdG9yUnVudGltZS53cmFwKGZ1bmN0aW9uIF9jYWxsZWUkKF9jb250ZXh0KSB7CiAgICAgICAgICB3aGlsZSAoMSkgewogICAgICAgICAgICBzd2l0Y2ggKF9jb250ZXh0LnByZXYgPSBfY29udGV4dC5uZXh0KSB7CiAgICAgICAgICAgICAgY2FzZSAwOgogICAgICAgICAgICAgICAgY29udGV4dCA9IF9hcmdzLmxlbmd0aCA+IDAgJiYgX2FyZ3NbMF0gIT09IHVuZGVmaW5lZCA/IF9hcmdzWzBdIDoge307CiAgICAgICAgICAgICAgICBkYXRhID0gX2FyZ3MubGVuZ3RoID4gMSAmJiBfYXJnc1sxXSAhPT0gdW5kZWZpbmVkID8gX2FyZ3NbMV0gOiB7fTsKICAgICAgICAgICAgICAgIGlzbG9hZGluZyA9IF9hcmdzLmxlbmd0aCA+IDIgPyBfYXJnc1syXSA6IHVuZGVmaW5lZDsKICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dC5hYnJ1cHQoInJldHVybiIsIEh0dHAuZ2V0SW5zdGFuY2UoKS5nZXQoIi9vcm1vcmdzLyIuY29uY2F0KGNvbnRleHQub3Jtb3JnLCAiL3NlbGVjdCIpLCBpc2xvYWRpbmcpKTsKCiAgICAgICAgICAgICAgY2FzZSA0OgogICAgICAgICAgICAgIGNhc2UgImVuZCI6CiAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQuc3RvcCgpOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSwgX2NhbGxlZSk7CiAgICAgIH0pKTsKCiAgICAgIGZ1bmN0aW9uIFNlbGVjdCgpIHsKICAgICAgICByZXR1cm4gX1NlbGVjdC5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwogICAgICB9CgogICAgICByZXR1cm4gU2VsZWN0OwogICAgfSgpCiAgICAvKioNCiAgICAgKiBVcGRhdGXmjqXlj6Pmlrnms5UNCiAgICAgKg0KICAgICAqIEBwYXJhbSB7Kn0gW2NvbnRleHQ9e31dDQogICAgICogQHBhcmFtIHsqfSBbZGF0YT17fV0NCiAgICAgKiBAcGFyYW0ge2Jvb2xlYW59IFtpc2xvYWRpbmddDQogICAgICogQHJldHVybnMge1Byb21pc2U8YW55Pn0NCiAgICAgKiBAbWVtYmVyb2YgT3JtT3JnU2VydmljZUJhc2UNCiAgICAgKi8KCiAgfSwgewogICAga2V5OiAiVXBkYXRlIiwKICAgIHZhbHVlOiBmdW5jdGlvbiAoKSB7CiAgICAgIHZhciBfVXBkYXRlID0gX2FzeW5jVG9HZW5lcmF0b3IoCiAgICAgIC8qI19fUFVSRV9fKi8KICAgICAgcmVnZW5lcmF0b3JSdW50aW1lLm1hcmsoZnVuY3Rpb24gX2NhbGxlZTIoKSB7CiAgICAgICAgdmFyIGNvbnRleHQsCiAgICAgICAgICAgIGRhdGEsCiAgICAgICAgICAgIGlzbG9hZGluZywKICAgICAgICAgICAgbWFzdGVyRGF0YSwKICAgICAgICAgICAgb3Jtb3Jnc2VjdG9yc0RhdGEsCiAgICAgICAgICAgIHBpbWNvbnRyYWN0c2lnbm9yZ3NEYXRhLAogICAgICAgICAgICBvcm1wb3N0c0RhdGEsCiAgICAgICAgICAgIG9ybW9yZ3NEYXRhLAogICAgICAgICAgICByZXMsCiAgICAgICAgICAgIF9hcmdzMiA9IGFyZ3VtZW50czsKICAgICAgICByZXR1cm4gcmVnZW5lcmF0b3JSdW50aW1lLndyYXAoZnVuY3Rpb24gX2NhbGxlZTIkKF9jb250ZXh0MikgewogICAgICAgICAgd2hpbGUgKDEpIHsKICAgICAgICAgICAgc3dpdGNoIChfY29udGV4dDIucHJldiA9IF9jb250ZXh0Mi5uZXh0KSB7CiAgICAgICAgICAgICAgY2FzZSAwOgogICAgICAgICAgICAgICAgY29udGV4dCA9IF9hcmdzMi5sZW5ndGggPiAwICYmIF9hcmdzMlswXSAhPT0gdW5kZWZpbmVkID8gX2FyZ3MyWzBdIDoge307CiAgICAgICAgICAgICAgICBkYXRhID0gX2FyZ3MyLmxlbmd0aCA+IDEgJiYgX2FyZ3MyWzFdICE9PSB1bmRlZmluZWQgPyBfYXJnczJbMV0gOiB7fTsKICAgICAgICAgICAgICAgIGlzbG9hZGluZyA9IF9hcmdzMi5sZW5ndGggPiAyID8gX2FyZ3MyWzJdIDogdW5kZWZpbmVkOwogICAgICAgICAgICAgICAgbWFzdGVyRGF0YSA9IHt9OwogICAgICAgICAgICAgICAgb3Jtb3Jnc2VjdG9yc0RhdGEgPSBbXTsKCiAgICAgICAgICAgICAgICBpZiAoIU9iamVjdC5pcyh0aGlzLnRlbXBTdG9yYWdlLmdldEl0ZW0oY29udGV4dC5zcmZzZXNzaW9ua2V5ICsgJ19vcm1vcmdzZWN0b3JzJyksICd1bmRlZmluZWQnKSkgewogICAgICAgICAgICAgICAgICBvcm1vcmdzZWN0b3JzRGF0YSA9IEpTT04ucGFyc2UodGhpcy50ZW1wU3RvcmFnZS5nZXRJdGVtKGNvbnRleHQuc3Jmc2Vzc2lvbmtleSArICdfb3Jtb3Jnc2VjdG9ycycpKTsKCiAgICAgICAgICAgICAgICAgIGlmIChvcm1vcmdzZWN0b3JzRGF0YSAmJiBvcm1vcmdzZWN0b3JzRGF0YS5sZW5ndGggJiYgb3Jtb3Jnc2VjdG9yc0RhdGEubGVuZ3RoID4gMCkgewogICAgICAgICAgICAgICAgICAgIG9ybW9yZ3NlY3RvcnNEYXRhLmZvckVhY2goZnVuY3Rpb24gKGl0ZW0pIHsKICAgICAgICAgICAgICAgICAgICAgIGlmIChpdGVtLnNyZmZyb250dWYpIHsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKE9iamVjdC5pcyhpdGVtLnNyZmZyb250dWYsICIwIikpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICBpdGVtLm9yZ3NlY3RvcmlkID0gbnVsbDsKICAgICAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICAgICAgZGVsZXRlIGl0ZW0uc3JmZnJvbnR1ZjsKICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIG1hc3RlckRhdGEub3Jtb3Jnc2VjdG9ycyA9IG9ybW9yZ3NlY3RvcnNEYXRhOwogICAgICAgICAgICAgICAgcGltY29udHJhY3RzaWdub3Jnc0RhdGEgPSBbXTsKCiAgICAgICAgICAgICAgICBpZiAoIU9iamVjdC5pcyh0aGlzLnRlbXBTdG9yYWdlLmdldEl0ZW0oY29udGV4dC5zcmZzZXNzaW9ua2V5ICsgJ19waW1jb250cmFjdHNpZ25vcmdzJyksICd1bmRlZmluZWQnKSkgewogICAgICAgICAgICAgICAgICBwaW1jb250cmFjdHNpZ25vcmdzRGF0YSA9IEpTT04ucGFyc2UodGhpcy50ZW1wU3RvcmFnZS5nZXRJdGVtKGNvbnRleHQuc3Jmc2Vzc2lvbmtleSArICdfcGltY29udHJhY3RzaWdub3JncycpKTsKCiAgICAgICAgICAgICAgICAgIGlmIChwaW1jb250cmFjdHNpZ25vcmdzRGF0YSAmJiBwaW1jb250cmFjdHNpZ25vcmdzRGF0YS5sZW5ndGggJiYgcGltY29udHJhY3RzaWdub3Jnc0RhdGEubGVuZ3RoID4gMCkgewogICAgICAgICAgICAgICAgICAgIHBpbWNvbnRyYWN0c2lnbm9yZ3NEYXRhLmZvckVhY2goZnVuY3Rpb24gKGl0ZW0pIHsKICAgICAgICAgICAgICAgICAgICAgIGlmIChpdGVtLnNyZmZyb250dWYpIHsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKE9iamVjdC5pcyhpdGVtLnNyZmZyb250dWYsICIwIikpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICBpdGVtLmNvbnRyYWN0c2lnbm9yZ2lkID0gbnVsbDsKICAgICAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICAgICAgZGVsZXRlIGl0ZW0uc3JmZnJvbnR1ZjsKICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIG1hc3RlckRhdGEucGltY29udHJhY3RzaWdub3JncyA9IHBpbWNvbnRyYWN0c2lnbm9yZ3NEYXRhOwogICAgICAgICAgICAgICAgb3JtcG9zdHNEYXRhID0gW107CgogICAgICAgICAgICAgICAgaWYgKCFPYmplY3QuaXModGhpcy50ZW1wU3RvcmFnZS5nZXRJdGVtKGNvbnRleHQuc3Jmc2Vzc2lvbmtleSArICdfb3JtcG9zdHMnKSwgJ3VuZGVmaW5lZCcpKSB7CiAgICAgICAgICAgICAgICAgIG9ybXBvc3RzRGF0YSA9IEpTT04ucGFyc2UodGhpcy50ZW1wU3RvcmFnZS5nZXRJdGVtKGNvbnRleHQuc3Jmc2Vzc2lvbmtleSArICdfb3JtcG9zdHMnKSk7CgogICAgICAgICAgICAgICAgICBpZiAob3JtcG9zdHNEYXRhICYmIG9ybXBvc3RzRGF0YS5sZW5ndGggJiYgb3JtcG9zdHNEYXRhLmxlbmd0aCA+IDApIHsKICAgICAgICAgICAgICAgICAgICBvcm1wb3N0c0RhdGEuZm9yRWFjaChmdW5jdGlvbiAoaXRlbSkgewogICAgICAgICAgICAgICAgICAgICAgaWYgKGl0ZW0uc3JmZnJvbnR1ZikgewogICAgICAgICAgICAgICAgICAgICAgICBpZiAoT2JqZWN0LmlzKGl0ZW0uc3JmZnJvbnR1ZiwgIjAiKSkgewogICAgICAgICAgICAgICAgICAgICAgICAgIGl0ZW0ub3JtcG9zdGlkID0gbnVsbDsKICAgICAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICAgICAgZGVsZXRlIGl0ZW0uc3JmZnJvbnR1ZjsKICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIG1hc3RlckRhdGEub3JtcG9zdHMgPSBvcm1wb3N0c0RhdGE7CiAgICAgICAgICAgICAgICBvcm1vcmdzRGF0YSA9IFtdOwoKICAgICAgICAgICAgICAgIGlmICghT2JqZWN0LmlzKHRoaXMudGVtcFN0b3JhZ2UuZ2V0SXRlbShjb250ZXh0LnNyZnNlc3Npb25rZXkgKyAnX29ybW9yZ3MnKSwgJ3VuZGVmaW5lZCcpKSB7CiAgICAgICAgICAgICAgICAgIG9ybW9yZ3NEYXRhID0gSlNPTi5wYXJzZSh0aGlzLnRlbXBTdG9yYWdlLmdldEl0ZW0oY29udGV4dC5zcmZzZXNzaW9ua2V5ICsgJ19vcm1vcmdzJykpOwoKICAgICAgICAgICAgICAgICAgaWYgKG9ybW9yZ3NEYXRhICYmIG9ybW9yZ3NEYXRhLmxlbmd0aCAmJiBvcm1vcmdzRGF0YS5sZW5ndGggPiAwKSB7CiAgICAgICAgICAgICAgICAgICAgb3Jtb3Jnc0RhdGEuZm9yRWFjaChmdW5jdGlvbiAoaXRlbSkgewogICAgICAgICAgICAgICAgICAgICAgaWYgKGl0ZW0uc3JmZnJvbnR1ZikgewogICAgICAgICAgICAgICAgICAgICAgICBpZiAoT2JqZWN0LmlzKGl0ZW0uc3JmZnJvbnR1ZiwgIjAiKSkgewogICAgICAgICAgICAgICAgICAgICAgICAgIGl0ZW0ub3JnaWQgPSBudWxsOwogICAgICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgICAgICBkZWxldGUgaXRlbS5zcmZmcm9udHVmOwogICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgbWFzdGVyRGF0YS5vcm1vcmdzID0gb3Jtb3Jnc0RhdGE7CiAgICAgICAgICAgICAgICBPYmplY3QuYXNzaWduKGRhdGEsIG1hc3RlckRhdGEpOwogICAgICAgICAgICAgICAgX2NvbnRleHQyLm5leHQgPSAxOTsKICAgICAgICAgICAgICAgIHJldHVybiBIdHRwLmdldEluc3RhbmNlKCkucHV0KCIvb3Jtb3Jncy8iLmNvbmNhdChjb250ZXh0Lm9ybW9yZyksIGRhdGEsIGlzbG9hZGluZyk7CgogICAgICAgICAgICAgIGNhc2UgMTk6CiAgICAgICAgICAgICAgICByZXMgPSBfY29udGV4dDIuc2VudDsKICAgICAgICAgICAgICAgIHRoaXMudGVtcFN0b3JhZ2Uuc2V0SXRlbShjb250ZXh0LnNyZnNlc3Npb25rZXkgKyAnX29ybW9yZ3NlY3RvcnMnLCBKU09OLnN0cmluZ2lmeShyZXMuZGF0YS5vcm1vcmdzZWN0b3JzKSk7CiAgICAgICAgICAgICAgICB0aGlzLnRlbXBTdG9yYWdlLnNldEl0ZW0oY29udGV4dC5zcmZzZXNzaW9ua2V5ICsgJ19waW1jb250cmFjdHNpZ25vcmdzJywgSlNPTi5zdHJpbmdpZnkocmVzLmRhdGEucGltY29udHJhY3RzaWdub3JncykpOwogICAgICAgICAgICAgICAgdGhpcy50ZW1wU3RvcmFnZS5zZXRJdGVtKGNvbnRleHQuc3Jmc2Vzc2lvbmtleSArICdfb3JtcG9zdHMnLCBKU09OLnN0cmluZ2lmeShyZXMuZGF0YS5vcm1wb3N0cykpOwogICAgICAgICAgICAgICAgdGhpcy50ZW1wU3RvcmFnZS5zZXRJdGVtKGNvbnRleHQuc3Jmc2Vzc2lvbmtleSArICdfb3Jtb3JncycsIEpTT04uc3RyaW5naWZ5KHJlcy5kYXRhLm9ybW9yZ3MpKTsKICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDIuYWJydXB0KCJyZXR1cm4iLCByZXMpOwoKICAgICAgICAgICAgICBjYXNlIDI1OgogICAgICAgICAgICAgIGNhc2UgImVuZCI6CiAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQyLnN0b3AoKTsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0sIF9jYWxsZWUyLCB0aGlzKTsKICAgICAgfSkpOwoKICAgICAgZnVuY3Rpb24gVXBkYXRlKCkgewogICAgICAgIHJldHVybiBfVXBkYXRlLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7CiAgICAgIH0KCiAgICAgIHJldHVybiBVcGRhdGU7CiAgICB9KCkKICAgIC8qKg0KICAgICAqIFN5bk9yZ+aOpeWPo+aWueazlQ0KICAgICAqDQogICAgICogQHBhcmFtIHsqfSBbY29udGV4dD17fV0NCiAgICAgKiBAcGFyYW0geyp9IFtkYXRhPXt9XQ0KICAgICAqIEBwYXJhbSB7Ym9vbGVhbn0gW2lzbG9hZGluZ10NCiAgICAgKiBAcmV0dXJucyB7UHJvbWlzZTxhbnk+fQ0KICAgICAqIEBtZW1iZXJvZiBPcm1PcmdTZXJ2aWNlQmFzZQ0KICAgICAqLwoKICB9LCB7CiAgICBrZXk6ICJTeW5PcmciLAogICAgdmFsdWU6IGZ1bmN0aW9uICgpIHsKICAgICAgdmFyIF9TeW5PcmcgPSBfYXN5bmNUb0dlbmVyYXRvcigKICAgICAgLyojX19QVVJFX18qLwogICAgICByZWdlbmVyYXRvclJ1bnRpbWUubWFyayhmdW5jdGlvbiBfY2FsbGVlMygpIHsKICAgICAgICB2YXIgY29udGV4dCwKICAgICAgICAgICAgZGF0YSwKICAgICAgICAgICAgaXNsb2FkaW5nLAogICAgICAgICAgICBfYXJnczMgPSBhcmd1bWVudHM7CiAgICAgICAgcmV0dXJuIHJlZ2VuZXJhdG9yUnVudGltZS53cmFwKGZ1bmN0aW9uIF9jYWxsZWUzJChfY29udGV4dDMpIHsKICAgICAgICAgIHdoaWxlICgxKSB7CiAgICAgICAgICAgIHN3aXRjaCAoX2NvbnRleHQzLnByZXYgPSBfY29udGV4dDMubmV4dCkgewogICAgICAgICAgICAgIGNhc2UgMDoKICAgICAgICAgICAgICAgIGNvbnRleHQgPSBfYXJnczMubGVuZ3RoID4gMCAmJiBfYXJnczNbMF0gIT09IHVuZGVmaW5lZCA/IF9hcmdzM1swXSA6IHt9OwogICAgICAgICAgICAgICAgZGF0YSA9IF9hcmdzMy5sZW5ndGggPiAxICYmIF9hcmdzM1sxXSAhPT0gdW5kZWZpbmVkID8gX2FyZ3MzWzFdIDoge307CiAgICAgICAgICAgICAgICBpc2xvYWRpbmcgPSBfYXJnczMubGVuZ3RoID4gMiA/IF9hcmdzM1syXSA6IHVuZGVmaW5lZDsKICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDMuYWJydXB0KCJyZXR1cm4iLCBIdHRwLmdldEluc3RhbmNlKCkucG9zdCgiL29ybW9yZ3MvIi5jb25jYXQoY29udGV4dC5vcm1vcmcsICIvc3lub3JnIiksIGRhdGEsIGlzbG9hZGluZykpOwoKICAgICAgICAgICAgICBjYXNlIDQ6CiAgICAgICAgICAgICAgY2FzZSAiZW5kIjoKICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDMuc3RvcCgpOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSwgX2NhbGxlZTMpOwogICAgICB9KSk7CgogICAgICBmdW5jdGlvbiBTeW5PcmcoKSB7CiAgICAgICAgcmV0dXJuIF9TeW5PcmcuYXBwbHkodGhpcywgYXJndW1lbnRzKTsKICAgICAgfQoKICAgICAgcmV0dXJuIFN5bk9yZzsKICAgIH0oKQogICAgLyoqDQogICAgICogUmVtb3Zl5o6l5Y+j5pa55rOVDQogICAgICoNCiAgICAgKiBAcGFyYW0geyp9IFtjb250ZXh0PXt9XQ0KICAgICAqIEBwYXJhbSB7Kn0gW2RhdGE9e31dDQogICAgICogQHBhcmFtIHtib29sZWFufSBbaXNsb2FkaW5nXQ0KICAgICAqIEByZXR1cm5zIHtQcm9taXNlPGFueT59DQogICAgICogQG1lbWJlcm9mIE9ybU9yZ1NlcnZpY2VCYXNlDQogICAgICovCgogIH0sIHsKICAgIGtleTogIlJlbW92ZSIsCiAgICB2YWx1ZTogZnVuY3Rpb24gKCkgewogICAgICB2YXIgX1JlbW92ZSA9IF9hc3luY1RvR2VuZXJhdG9yKAogICAgICAvKiNfX1BVUkVfXyovCiAgICAgIHJlZ2VuZXJhdG9yUnVudGltZS5tYXJrKGZ1bmN0aW9uIF9jYWxsZWU0KCkgewogICAgICAgIHZhciBjb250ZXh0LAogICAgICAgICAgICBkYXRhLAogICAgICAgICAgICBpc2xvYWRpbmcsCiAgICAgICAgICAgIF9hcmdzNCA9IGFyZ3VtZW50czsKICAgICAgICByZXR1cm4gcmVnZW5lcmF0b3JSdW50aW1lLndyYXAoZnVuY3Rpb24gX2NhbGxlZTQkKF9jb250ZXh0NCkgewogICAgICAgICAgd2hpbGUgKDEpIHsKICAgICAgICAgICAgc3dpdGNoIChfY29udGV4dDQucHJldiA9IF9jb250ZXh0NC5uZXh0KSB7CiAgICAgICAgICAgICAgY2FzZSAwOgogICAgICAgICAgICAgICAgY29udGV4dCA9IF9hcmdzNC5sZW5ndGggPiAwICYmIF9hcmdzNFswXSAhPT0gdW5kZWZpbmVkID8gX2FyZ3M0WzBdIDoge307CiAgICAgICAgICAgICAgICBkYXRhID0gX2FyZ3M0Lmxlbmd0aCA+IDEgJiYgX2FyZ3M0WzFdICE9PSB1bmRlZmluZWQgPyBfYXJnczRbMV0gOiB7fTsKICAgICAgICAgICAgICAgIGlzbG9hZGluZyA9IF9hcmdzNC5sZW5ndGggPiAyID8gX2FyZ3M0WzJdIDogdW5kZWZpbmVkOwogICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0NC5hYnJ1cHQoInJldHVybiIsIEh0dHAuZ2V0SW5zdGFuY2UoKVsiZGVsZXRlIl0oIi9vcm1vcmdzLyIuY29uY2F0KGNvbnRleHQub3Jtb3JnKSwgaXNsb2FkaW5nKSk7CgogICAgICAgICAgICAgIGNhc2UgNDoKICAgICAgICAgICAgICBjYXNlICJlbmQiOgogICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0NC5zdG9wKCk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9LCBfY2FsbGVlNCk7CiAgICAgIH0pKTsKCiAgICAgIGZ1bmN0aW9uIFJlbW92ZSgpIHsKICAgICAgICByZXR1cm4gX1JlbW92ZS5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwogICAgICB9CgogICAgICByZXR1cm4gUmVtb3ZlOwogICAgfSgpCiAgICAvKioNCiAgICAgKiBHZXREcmFmdOaOpeWPo+aWueazlQ0KICAgICAqDQogICAgICogQHBhcmFtIHsqfSBbY29udGV4dD17fV0NCiAgICAgKiBAcGFyYW0geyp9IFtkYXRhPXt9XQ0KICAgICAqIEBwYXJhbSB7Ym9vbGVhbn0gW2lzbG9hZGluZ10NCiAgICAgKiBAcmV0dXJucyB7UHJvbWlzZTxhbnk+fQ0KICAgICAqIEBtZW1iZXJvZiBPcm1PcmdTZXJ2aWNlQmFzZQ0KICAgICAqLwoKICB9LCB7CiAgICBrZXk6ICJHZXREcmFmdCIsCiAgICB2YWx1ZTogZnVuY3Rpb24gKCkgewogICAgICB2YXIgX0dldERyYWZ0ID0gX2FzeW5jVG9HZW5lcmF0b3IoCiAgICAgIC8qI19fUFVSRV9fKi8KICAgICAgcmVnZW5lcmF0b3JSdW50aW1lLm1hcmsoZnVuY3Rpb24gX2NhbGxlZTUoKSB7CiAgICAgICAgdmFyIGNvbnRleHQsCiAgICAgICAgICAgIGRhdGEsCiAgICAgICAgICAgIGlzbG9hZGluZywKICAgICAgICAgICAgcmVzLAogICAgICAgICAgICBfYXJnczUgPSBhcmd1bWVudHM7CiAgICAgICAgcmV0dXJuIHJlZ2VuZXJhdG9yUnVudGltZS53cmFwKGZ1bmN0aW9uIF9jYWxsZWU1JChfY29udGV4dDUpIHsKICAgICAgICAgIHdoaWxlICgxKSB7CiAgICAgICAgICAgIHN3aXRjaCAoX2NvbnRleHQ1LnByZXYgPSBfY29udGV4dDUubmV4dCkgewogICAgICAgICAgICAgIGNhc2UgMDoKICAgICAgICAgICAgICAgIGNvbnRleHQgPSBfYXJnczUubGVuZ3RoID4gMCAmJiBfYXJnczVbMF0gIT09IHVuZGVmaW5lZCA/IF9hcmdzNVswXSA6IHt9OwogICAgICAgICAgICAgICAgZGF0YSA9IF9hcmdzNS5sZW5ndGggPiAxICYmIF9hcmdzNVsxXSAhPT0gdW5kZWZpbmVkID8gX2FyZ3M1WzFdIDoge307CiAgICAgICAgICAgICAgICBpc2xvYWRpbmcgPSBfYXJnczUubGVuZ3RoID4gMiA/IF9hcmdzNVsyXSA6IHVuZGVmaW5lZDsKICAgICAgICAgICAgICAgIF9jb250ZXh0NS5uZXh0ID0gNTsKICAgICAgICAgICAgICAgIHJldHVybiBIdHRwLmdldEluc3RhbmNlKCkuZ2V0KCIvb3Jtb3Jncy9nZXRkcmFmdCIsIGlzbG9hZGluZyk7CgogICAgICAgICAgICAgIGNhc2UgNToKICAgICAgICAgICAgICAgIHJlcyA9IF9jb250ZXh0NS5zZW50OwogICAgICAgICAgICAgICAgcmVzLmRhdGEub3Jtb3JnID0gZGF0YS5vcm1vcmc7CiAgICAgICAgICAgICAgICB0aGlzLnRlbXBTdG9yYWdlLnNldEl0ZW0oY29udGV4dC5zcmZzZXNzaW9ua2V5ICsgJ19vcm1vcmdzZWN0b3JzJywgSlNPTi5zdHJpbmdpZnkocmVzLmRhdGEub3Jtb3Jnc2VjdG9ycykpOwogICAgICAgICAgICAgICAgdGhpcy50ZW1wU3RvcmFnZS5zZXRJdGVtKGNvbnRleHQuc3Jmc2Vzc2lvbmtleSArICdfcGltY29udHJhY3RzaWdub3JncycsIEpTT04uc3RyaW5naWZ5KHJlcy5kYXRhLnBpbWNvbnRyYWN0c2lnbm9yZ3MpKTsKICAgICAgICAgICAgICAgIHRoaXMudGVtcFN0b3JhZ2Uuc2V0SXRlbShjb250ZXh0LnNyZnNlc3Npb25rZXkgKyAnX29ybXBvc3RzJywgSlNPTi5zdHJpbmdpZnkocmVzLmRhdGEub3JtcG9zdHMpKTsKICAgICAgICAgICAgICAgIHRoaXMudGVtcFN0b3JhZ2Uuc2V0SXRlbShjb250ZXh0LnNyZnNlc3Npb25rZXkgKyAnX29ybW9yZ3MnLCBKU09OLnN0cmluZ2lmeShyZXMuZGF0YS5vcm1vcmdzKSk7CiAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQ1LmFicnVwdCgicmV0dXJuIiwgcmVzKTsKCiAgICAgICAgICAgICAgY2FzZSAxMjoKICAgICAgICAgICAgICBjYXNlICJlbmQiOgogICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0NS5zdG9wKCk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9LCBfY2FsbGVlNSwgdGhpcyk7CiAgICAgIH0pKTsKCiAgICAgIGZ1bmN0aW9uIEdldERyYWZ0KCkgewogICAgICAgIHJldHVybiBfR2V0RHJhZnQuYXBwbHkodGhpcywgYXJndW1lbnRzKTsKICAgICAgfQoKICAgICAgcmV0dXJuIEdldERyYWZ0OwogICAgfSgpCiAgICAvKioNCiAgICAgKiBHZXTmjqXlj6Pmlrnms5UNCiAgICAgKg0KICAgICAqIEBwYXJhbSB7Kn0gW2NvbnRleHQ9e31dDQogICAgICogQHBhcmFtIHsqfSBbZGF0YT17fV0NCiAgICAgKiBAcGFyYW0ge2Jvb2xlYW59IFtpc2xvYWRpbmddDQogICAgICogQHJldHVybnMge1Byb21pc2U8YW55Pn0NCiAgICAgKiBAbWVtYmVyb2YgT3JtT3JnU2VydmljZUJhc2UNCiAgICAgKi8KCiAgfSwgewogICAga2V5OiAiR2V0IiwKICAgIHZhbHVlOiBmdW5jdGlvbiAoKSB7CiAgICAgIHZhciBfR2V0ID0gX2FzeW5jVG9HZW5lcmF0b3IoCiAgICAgIC8qI19fUFVSRV9fKi8KICAgICAgcmVnZW5lcmF0b3JSdW50aW1lLm1hcmsoZnVuY3Rpb24gX2NhbGxlZTYoKSB7CiAgICAgICAgdmFyIGNvbnRleHQsCiAgICAgICAgICAgIGRhdGEsCiAgICAgICAgICAgIGlzbG9hZGluZywKICAgICAgICAgICAgcmVzLAogICAgICAgICAgICBfYXJnczYgPSBhcmd1bWVudHM7CiAgICAgICAgcmV0dXJuIHJlZ2VuZXJhdG9yUnVudGltZS53cmFwKGZ1bmN0aW9uIF9jYWxsZWU2JChfY29udGV4dDYpIHsKICAgICAgICAgIHdoaWxlICgxKSB7CiAgICAgICAgICAgIHN3aXRjaCAoX2NvbnRleHQ2LnByZXYgPSBfY29udGV4dDYubmV4dCkgewogICAgICAgICAgICAgIGNhc2UgMDoKICAgICAgICAgICAgICAgIGNvbnRleHQgPSBfYXJnczYubGVuZ3RoID4gMCAmJiBfYXJnczZbMF0gIT09IHVuZGVmaW5lZCA/IF9hcmdzNlswXSA6IHt9OwogICAgICAgICAgICAgICAgZGF0YSA9IF9hcmdzNi5sZW5ndGggPiAxICYmIF9hcmdzNlsxXSAhPT0gdW5kZWZpbmVkID8gX2FyZ3M2WzFdIDoge307CiAgICAgICAgICAgICAgICBpc2xvYWRpbmcgPSBfYXJnczYubGVuZ3RoID4gMiA/IF9hcmdzNlsyXSA6IHVuZGVmaW5lZDsKICAgICAgICAgICAgICAgIF9jb250ZXh0Ni5uZXh0ID0gNTsKICAgICAgICAgICAgICAgIHJldHVybiBIdHRwLmdldEluc3RhbmNlKCkuZ2V0KCIvb3Jtb3Jncy8iLmNvbmNhdChjb250ZXh0Lm9ybW9yZyksIGlzbG9hZGluZyk7CgogICAgICAgICAgICAgIGNhc2UgNToKICAgICAgICAgICAgICAgIHJlcyA9IF9jb250ZXh0Ni5zZW50OwogICAgICAgICAgICAgICAgdGhpcy50ZW1wU3RvcmFnZS5zZXRJdGVtKGNvbnRleHQuc3Jmc2Vzc2lvbmtleSArICdfb3Jtb3Jnc2VjdG9ycycsIEpTT04uc3RyaW5naWZ5KHJlcy5kYXRhLm9ybW9yZ3NlY3RvcnMpKTsKICAgICAgICAgICAgICAgIHRoaXMudGVtcFN0b3JhZ2Uuc2V0SXRlbShjb250ZXh0LnNyZnNlc3Npb25rZXkgKyAnX3BpbWNvbnRyYWN0c2lnbm9yZ3MnLCBKU09OLnN0cmluZ2lmeShyZXMuZGF0YS5waW1jb250cmFjdHNpZ25vcmdzKSk7CiAgICAgICAgICAgICAgICB0aGlzLnRlbXBTdG9yYWdlLnNldEl0ZW0oY29udGV4dC5zcmZzZXNzaW9ua2V5ICsgJ19vcm1wb3N0cycsIEpTT04uc3RyaW5naWZ5KHJlcy5kYXRhLm9ybXBvc3RzKSk7CiAgICAgICAgICAgICAgICB0aGlzLnRlbXBTdG9yYWdlLnNldEl0ZW0oY29udGV4dC5zcmZzZXNzaW9ua2V5ICsgJ19vcm1vcmdzJywgSlNPTi5zdHJpbmdpZnkocmVzLmRhdGEub3Jtb3JncykpOwogICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0Ni5hYnJ1cHQoInJldHVybiIsIHJlcyk7CgogICAgICAgICAgICAgIGNhc2UgMTE6CiAgICAgICAgICAgICAgY2FzZSAiZW5kIjoKICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDYuc3RvcCgpOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSwgX2NhbGxlZTYsIHRoaXMpOwogICAgICB9KSk7CgogICAgICBmdW5jdGlvbiBHZXQoKSB7CiAgICAgICAgcmV0dXJuIF9HZXQuYXBwbHkodGhpcywgYXJndW1lbnRzKTsKICAgICAgfQoKICAgICAgcmV0dXJuIEdldDsKICAgIH0oKQogICAgLyoqDQogICAgICogQ2hlY2tLZXnmjqXlj6Pmlrnms5UNCiAgICAgKg0KICAgICAqIEBwYXJhbSB7Kn0gW2NvbnRleHQ9e31dDQogICAgICogQHBhcmFtIHsqfSBbZGF0YT17fV0NCiAgICAgKiBAcGFyYW0ge2Jvb2xlYW59IFtpc2xvYWRpbmddDQogICAgICogQHJldHVybnMge1Byb21pc2U8YW55Pn0NCiAgICAgKiBAbWVtYmVyb2YgT3JtT3JnU2VydmljZUJhc2UNCiAgICAgKi8KCiAgfSwgewogICAga2V5OiAiQ2hlY2tLZXkiLAogICAgdmFsdWU6IGZ1bmN0aW9uICgpIHsKICAgICAgdmFyIF9DaGVja0tleSA9IF9hc3luY1RvR2VuZXJhdG9yKAogICAgICAvKiNfX1BVUkVfXyovCiAgICAgIHJlZ2VuZXJhdG9yUnVudGltZS5tYXJrKGZ1bmN0aW9uIF9jYWxsZWU3KCkgewogICAgICAgIHZhciBjb250ZXh0LAogICAgICAgICAgICBkYXRhLAogICAgICAgICAgICBpc2xvYWRpbmcsCiAgICAgICAgICAgIF9hcmdzNyA9IGFyZ3VtZW50czsKICAgICAgICByZXR1cm4gcmVnZW5lcmF0b3JSdW50aW1lLndyYXAoZnVuY3Rpb24gX2NhbGxlZTckKF9jb250ZXh0NykgewogICAgICAgICAgd2hpbGUgKDEpIHsKICAgICAgICAgICAgc3dpdGNoIChfY29udGV4dDcucHJldiA9IF9jb250ZXh0Ny5uZXh0KSB7CiAgICAgICAgICAgICAgY2FzZSAwOgogICAgICAgICAgICAgICAgY29udGV4dCA9IF9hcmdzNy5sZW5ndGggPiAwICYmIF9hcmdzN1swXSAhPT0gdW5kZWZpbmVkID8gX2FyZ3M3WzBdIDoge307CiAgICAgICAgICAgICAgICBkYXRhID0gX2FyZ3M3Lmxlbmd0aCA+IDEgJiYgX2FyZ3M3WzFdICE9PSB1bmRlZmluZWQgPyBfYXJnczdbMV0gOiB7fTsKICAgICAgICAgICAgICAgIGlzbG9hZGluZyA9IF9hcmdzNy5sZW5ndGggPiAyID8gX2FyZ3M3WzJdIDogdW5kZWZpbmVkOwogICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0Ny5hYnJ1cHQoInJldHVybiIsIEh0dHAuZ2V0SW5zdGFuY2UoKS5wb3N0KCIvb3Jtb3Jncy8iLmNvbmNhdChjb250ZXh0Lm9ybW9yZywgIi9jaGVja2tleSIpLCBkYXRhLCBpc2xvYWRpbmcpKTsKCiAgICAgICAgICAgICAgY2FzZSA0OgogICAgICAgICAgICAgIGNhc2UgImVuZCI6CiAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQ3LnN0b3AoKTsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0sIF9jYWxsZWU3KTsKICAgICAgfSkpOwoKICAgICAgZnVuY3Rpb24gQ2hlY2tLZXkoKSB7CiAgICAgICAgcmV0dXJuIF9DaGVja0tleS5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwogICAgICB9CgogICAgICByZXR1cm4gQ2hlY2tLZXk7CiAgICB9KCkKICAgIC8qKg0KICAgICAqIENyZWF0ZeaOpeWPo+aWueazlQ0KICAgICAqDQogICAgICogQHBhcmFtIHsqfSBbY29udGV4dD17fV0NCiAgICAgKiBAcGFyYW0geyp9IFtkYXRhPXt9XQ0KICAgICAqIEBwYXJhbSB7Ym9vbGVhbn0gW2lzbG9hZGluZ10NCiAgICAgKiBAcmV0dXJucyB7UHJvbWlzZTxhbnk+fQ0KICAgICAqIEBtZW1iZXJvZiBPcm1PcmdTZXJ2aWNlQmFzZQ0KICAgICAqLwoKICB9LCB7CiAgICBrZXk6ICJDcmVhdGUiLAogICAgdmFsdWU6IGZ1bmN0aW9uICgpIHsKICAgICAgdmFyIF9DcmVhdGUgPSBfYXN5bmNUb0dlbmVyYXRvcigKICAgICAgLyojX19QVVJFX18qLwogICAgICByZWdlbmVyYXRvclJ1bnRpbWUubWFyayhmdW5jdGlvbiBfY2FsbGVlOCgpIHsKICAgICAgICB2YXIgY29udGV4dCwKICAgICAgICAgICAgZGF0YSwKICAgICAgICAgICAgaXNsb2FkaW5nLAogICAgICAgICAgICBtYXN0ZXJEYXRhLAogICAgICAgICAgICBvcm1vcmdzZWN0b3JzRGF0YSwKICAgICAgICAgICAgcGltY29udHJhY3RzaWdub3Jnc0RhdGEsCiAgICAgICAgICAgIG9ybXBvc3RzRGF0YSwKICAgICAgICAgICAgb3Jtb3Jnc0RhdGEsCiAgICAgICAgICAgIHRlbXBDb250ZXh0LAogICAgICAgICAgICByZXMsCiAgICAgICAgICAgIF9hcmdzOCA9IGFyZ3VtZW50czsKICAgICAgICByZXR1cm4gcmVnZW5lcmF0b3JSdW50aW1lLndyYXAoZnVuY3Rpb24gX2NhbGxlZTgkKF9jb250ZXh0OCkgewogICAgICAgICAgd2hpbGUgKDEpIHsKICAgICAgICAgICAgc3dpdGNoIChfY29udGV4dDgucHJldiA9IF9jb250ZXh0OC5uZXh0KSB7CiAgICAgICAgICAgICAgY2FzZSAwOgogICAgICAgICAgICAgICAgY29udGV4dCA9IF9hcmdzOC5sZW5ndGggPiAwICYmIF9hcmdzOFswXSAhPT0gdW5kZWZpbmVkID8gX2FyZ3M4WzBdIDoge307CiAgICAgICAgICAgICAgICBkYXRhID0gX2FyZ3M4Lmxlbmd0aCA+IDEgJiYgX2FyZ3M4WzFdICE9PSB1bmRlZmluZWQgPyBfYXJnczhbMV0gOiB7fTsKICAgICAgICAgICAgICAgIGlzbG9hZGluZyA9IF9hcmdzOC5sZW5ndGggPiAyID8gX2FyZ3M4WzJdIDogdW5kZWZpbmVkOwogICAgICAgICAgICAgICAgbWFzdGVyRGF0YSA9IHt9OwogICAgICAgICAgICAgICAgb3Jtb3Jnc2VjdG9yc0RhdGEgPSBbXTsKCiAgICAgICAgICAgICAgICBpZiAoIU9iamVjdC5pcyh0aGlzLnRlbXBTdG9yYWdlLmdldEl0ZW0oY29udGV4dC5zcmZzZXNzaW9ua2V5ICsgJ19vcm1vcmdzZWN0b3JzJyksICd1bmRlZmluZWQnKSkgewogICAgICAgICAgICAgICAgICBvcm1vcmdzZWN0b3JzRGF0YSA9IEpTT04ucGFyc2UodGhpcy50ZW1wU3RvcmFnZS5nZXRJdGVtKGNvbnRleHQuc3Jmc2Vzc2lvbmtleSArICdfb3Jtb3Jnc2VjdG9ycycpKTsKCiAgICAgICAgICAgICAgICAgIGlmIChvcm1vcmdzZWN0b3JzRGF0YSAmJiBvcm1vcmdzZWN0b3JzRGF0YS5sZW5ndGggJiYgb3Jtb3Jnc2VjdG9yc0RhdGEubGVuZ3RoID4gMCkgewogICAgICAgICAgICAgICAgICAgIG9ybW9yZ3NlY3RvcnNEYXRhLmZvckVhY2goZnVuY3Rpb24gKGl0ZW0pIHsKICAgICAgICAgICAgICAgICAgICAgIGlmIChpdGVtLnNyZmZyb250dWYpIHsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKE9iamVjdC5pcyhpdGVtLnNyZmZyb250dWYsICIwIikpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICBpdGVtLm9yZ3NlY3RvcmlkID0gbnVsbDsKICAgICAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICAgICAgZGVsZXRlIGl0ZW0uc3JmZnJvbnR1ZjsKICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIG1hc3RlckRhdGEub3Jtb3Jnc2VjdG9ycyA9IG9ybW9yZ3NlY3RvcnNEYXRhOwogICAgICAgICAgICAgICAgcGltY29udHJhY3RzaWdub3Jnc0RhdGEgPSBbXTsKCiAgICAgICAgICAgICAgICBpZiAoIU9iamVjdC5pcyh0aGlzLnRlbXBTdG9yYWdlLmdldEl0ZW0oY29udGV4dC5zcmZzZXNzaW9ua2V5ICsgJ19waW1jb250cmFjdHNpZ25vcmdzJyksICd1bmRlZmluZWQnKSkgewogICAgICAgICAgICAgICAgICBwaW1jb250cmFjdHNpZ25vcmdzRGF0YSA9IEpTT04ucGFyc2UodGhpcy50ZW1wU3RvcmFnZS5nZXRJdGVtKGNvbnRleHQuc3Jmc2Vzc2lvbmtleSArICdfcGltY29udHJhY3RzaWdub3JncycpKTsKCiAgICAgICAgICAgICAgICAgIGlmIChwaW1jb250cmFjdHNpZ25vcmdzRGF0YSAmJiBwaW1jb250cmFjdHNpZ25vcmdzRGF0YS5sZW5ndGggJiYgcGltY29udHJhY3RzaWdub3Jnc0RhdGEubGVuZ3RoID4gMCkgewogICAgICAgICAgICAgICAgICAgIHBpbWNvbnRyYWN0c2lnbm9yZ3NEYXRhLmZvckVhY2goZnVuY3Rpb24gKGl0ZW0pIHsKICAgICAgICAgICAgICAgICAgICAgIGlmIChpdGVtLnNyZmZyb250dWYpIHsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKE9iamVjdC5pcyhpdGVtLnNyZmZyb250dWYsICIwIikpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICBpdGVtLmNvbnRyYWN0c2lnbm9yZ2lkID0gbnVsbDsKICAgICAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICAgICAgZGVsZXRlIGl0ZW0uc3JmZnJvbnR1ZjsKICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIG1hc3RlckRhdGEucGltY29udHJhY3RzaWdub3JncyA9IHBpbWNvbnRyYWN0c2lnbm9yZ3NEYXRhOwogICAgICAgICAgICAgICAgb3JtcG9zdHNEYXRhID0gW107CgogICAgICAgICAgICAgICAgaWYgKCFPYmplY3QuaXModGhpcy50ZW1wU3RvcmFnZS5nZXRJdGVtKGNvbnRleHQuc3Jmc2Vzc2lvbmtleSArICdfb3JtcG9zdHMnKSwgJ3VuZGVmaW5lZCcpKSB7CiAgICAgICAgICAgICAgICAgIG9ybXBvc3RzRGF0YSA9IEpTT04ucGFyc2UodGhpcy50ZW1wU3RvcmFnZS5nZXRJdGVtKGNvbnRleHQuc3Jmc2Vzc2lvbmtleSArICdfb3JtcG9zdHMnKSk7CgogICAgICAgICAgICAgICAgICBpZiAob3JtcG9zdHNEYXRhICYmIG9ybXBvc3RzRGF0YS5sZW5ndGggJiYgb3JtcG9zdHNEYXRhLmxlbmd0aCA+IDApIHsKICAgICAgICAgICAgICAgICAgICBvcm1wb3N0c0RhdGEuZm9yRWFjaChmdW5jdGlvbiAoaXRlbSkgewogICAgICAgICAgICAgICAgICAgICAgaWYgKGl0ZW0uc3JmZnJvbnR1ZikgewogICAgICAgICAgICAgICAgICAgICAgICBpZiAoT2JqZWN0LmlzKGl0ZW0uc3JmZnJvbnR1ZiwgIjAiKSkgewogICAgICAgICAgICAgICAgICAgICAgICAgIGl0ZW0ub3JtcG9zdGlkID0gbnVsbDsKICAgICAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICAgICAgZGVsZXRlIGl0ZW0uc3JmZnJvbnR1ZjsKICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIG1hc3RlckRhdGEub3JtcG9zdHMgPSBvcm1wb3N0c0RhdGE7CiAgICAgICAgICAgICAgICBvcm1vcmdzRGF0YSA9IFtdOwoKICAgICAgICAgICAgICAgIGlmICghT2JqZWN0LmlzKHRoaXMudGVtcFN0b3JhZ2UuZ2V0SXRlbShjb250ZXh0LnNyZnNlc3Npb25rZXkgKyAnX29ybW9yZ3MnKSwgJ3VuZGVmaW5lZCcpKSB7CiAgICAgICAgICAgICAgICAgIG9ybW9yZ3NEYXRhID0gSlNPTi5wYXJzZSh0aGlzLnRlbXBTdG9yYWdlLmdldEl0ZW0oY29udGV4dC5zcmZzZXNzaW9ua2V5ICsgJ19vcm1vcmdzJykpOwoKICAgICAgICAgICAgICAgICAgaWYgKG9ybW9yZ3NEYXRhICYmIG9ybW9yZ3NEYXRhLmxlbmd0aCAmJiBvcm1vcmdzRGF0YS5sZW5ndGggPiAwKSB7CiAgICAgICAgICAgICAgICAgICAgb3Jtb3Jnc0RhdGEuZm9yRWFjaChmdW5jdGlvbiAoaXRlbSkgewogICAgICAgICAgICAgICAgICAgICAgaWYgKGl0ZW0uc3JmZnJvbnR1ZikgewogICAgICAgICAgICAgICAgICAgICAgICBpZiAoT2JqZWN0LmlzKGl0ZW0uc3JmZnJvbnR1ZiwgIjAiKSkgewogICAgICAgICAgICAgICAgICAgICAgICAgIGl0ZW0ub3JnaWQgPSBudWxsOwogICAgICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgICAgICBkZWxldGUgaXRlbS5zcmZmcm9udHVmOwogICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgbWFzdGVyRGF0YS5vcm1vcmdzID0gb3Jtb3Jnc0RhdGE7CiAgICAgICAgICAgICAgICBPYmplY3QuYXNzaWduKGRhdGEsIG1hc3RlckRhdGEpOwoKICAgICAgICAgICAgICAgIGlmICghZGF0YS5zcmZmcm9udHVmIHx8IGRhdGEuc3JmZnJvbnR1ZiAhPT0gIjEiKSB7CiAgICAgICAgICAgICAgICAgIGRhdGFbdGhpcy5BUFBERUtFWV0gPSBudWxsOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIGlmIChkYXRhLnNyZmZyb250dWYpIHsKICAgICAgICAgICAgICAgICAgZGVsZXRlIGRhdGEuc3JmZnJvbnR1ZjsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICB0ZW1wQ29udGV4dCA9IEpTT04ucGFyc2UoSlNPTi5zdHJpbmdpZnkoY29udGV4dCkpOwogICAgICAgICAgICAgICAgX2NvbnRleHQ4Lm5leHQgPSAyMjsKICAgICAgICAgICAgICAgIHJldHVybiBIdHRwLmdldEluc3RhbmNlKCkucG9zdCgiL29ybW9yZ3MiLCBkYXRhLCBpc2xvYWRpbmcpOwoKICAgICAgICAgICAgICBjYXNlIDIyOgogICAgICAgICAgICAgICAgcmVzID0gX2NvbnRleHQ4LnNlbnQ7CiAgICAgICAgICAgICAgICB0aGlzLnRlbXBTdG9yYWdlLnNldEl0ZW0odGVtcENvbnRleHQuc3Jmc2Vzc2lvbmtleSArICdfb3Jtb3Jnc2VjdG9ycycsIEpTT04uc3RyaW5naWZ5KHJlcy5kYXRhLm9ybW9yZ3NlY3RvcnMpKTsKICAgICAgICAgICAgICAgIHRoaXMudGVtcFN0b3JhZ2Uuc2V0SXRlbSh0ZW1wQ29udGV4dC5zcmZzZXNzaW9ua2V5ICsgJ19waW1jb250cmFjdHNpZ25vcmdzJywgSlNPTi5zdHJpbmdpZnkocmVzLmRhdGEucGltY29udHJhY3RzaWdub3JncykpOwogICAgICAgICAgICAgICAgdGhpcy50ZW1wU3RvcmFnZS5zZXRJdGVtKHRlbXBDb250ZXh0LnNyZnNlc3Npb25rZXkgKyAnX29ybXBvc3RzJywgSlNPTi5zdHJpbmdpZnkocmVzLmRhdGEub3JtcG9zdHMpKTsKICAgICAgICAgICAgICAgIHRoaXMudGVtcFN0b3JhZ2Uuc2V0SXRlbSh0ZW1wQ29udGV4dC5zcmZzZXNzaW9ua2V5ICsgJ19vcm1vcmdzJywgSlNPTi5zdHJpbmdpZnkocmVzLmRhdGEub3Jtb3JncykpOwogICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0OC5hYnJ1cHQoInJldHVybiIsIHJlcyk7CgogICAgICAgICAgICAgIGNhc2UgMjg6CiAgICAgICAgICAgICAgY2FzZSAiZW5kIjoKICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDguc3RvcCgpOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSwgX2NhbGxlZTgsIHRoaXMpOwogICAgICB9KSk7CgogICAgICBmdW5jdGlvbiBDcmVhdGUoKSB7CiAgICAgICAgcmV0dXJuIF9DcmVhdGUuYXBwbHkodGhpcywgYXJndW1lbnRzKTsKICAgICAgfQoKICAgICAgcmV0dXJuIENyZWF0ZTsKICAgIH0oKQogICAgLyoqDQogICAgICogU2F2ZeaOpeWPo+aWueazlQ0KICAgICAqDQogICAgICogQHBhcmFtIHsqfSBbY29udGV4dD17fV0NCiAgICAgKiBAcGFyYW0geyp9IFtkYXRhPXt9XQ0KICAgICAqIEBwYXJhbSB7Ym9vbGVhbn0gW2lzbG9hZGluZ10NCiAgICAgKiBAcmV0dXJucyB7UHJvbWlzZTxhbnk+fQ0KICAgICAqIEBtZW1iZXJvZiBPcm1PcmdTZXJ2aWNlQmFzZQ0KICAgICAqLwoKICB9LCB7CiAgICBrZXk6ICJTYXZlIiwKICAgIHZhbHVlOiBmdW5jdGlvbiAoKSB7CiAgICAgIHZhciBfU2F2ZSA9IF9hc3luY1RvR2VuZXJhdG9yKAogICAgICAvKiNfX1BVUkVfXyovCiAgICAgIHJlZ2VuZXJhdG9yUnVudGltZS5tYXJrKGZ1bmN0aW9uIF9jYWxsZWU5KCkgewogICAgICAgIHZhciBjb250ZXh0LAogICAgICAgICAgICBkYXRhLAogICAgICAgICAgICBpc2xvYWRpbmcsCiAgICAgICAgICAgIG1hc3RlckRhdGEsCiAgICAgICAgICAgIG9ybW9yZ3NlY3RvcnNEYXRhLAogICAgICAgICAgICBwaW1jb250cmFjdHNpZ25vcmdzRGF0YSwKICAgICAgICAgICAgb3JtcG9zdHNEYXRhLAogICAgICAgICAgICBvcm1vcmdzRGF0YSwKICAgICAgICAgICAgcmVzLAogICAgICAgICAgICBfYXJnczkgPSBhcmd1bWVudHM7CiAgICAgICAgcmV0dXJuIHJlZ2VuZXJhdG9yUnVudGltZS53cmFwKGZ1bmN0aW9uIF9jYWxsZWU5JChfY29udGV4dDkpIHsKICAgICAgICAgIHdoaWxlICgxKSB7CiAgICAgICAgICAgIHN3aXRjaCAoX2NvbnRleHQ5LnByZXYgPSBfY29udGV4dDkubmV4dCkgewogICAgICAgICAgICAgIGNhc2UgMDoKICAgICAgICAgICAgICAgIGNvbnRleHQgPSBfYXJnczkubGVuZ3RoID4gMCAmJiBfYXJnczlbMF0gIT09IHVuZGVmaW5lZCA/IF9hcmdzOVswXSA6IHt9OwogICAgICAgICAgICAgICAgZGF0YSA9IF9hcmdzOS5sZW5ndGggPiAxICYmIF9hcmdzOVsxXSAhPT0gdW5kZWZpbmVkID8gX2FyZ3M5WzFdIDoge307CiAgICAgICAgICAgICAgICBpc2xvYWRpbmcgPSBfYXJnczkubGVuZ3RoID4gMiA/IF9hcmdzOVsyXSA6IHVuZGVmaW5lZDsKICAgICAgICAgICAgICAgIG1hc3RlckRhdGEgPSB7fTsKICAgICAgICAgICAgICAgIG9ybW9yZ3NlY3RvcnNEYXRhID0gW107CgogICAgICAgICAgICAgICAgaWYgKCFPYmplY3QuaXModGhpcy50ZW1wU3RvcmFnZS5nZXRJdGVtKGNvbnRleHQuc3Jmc2Vzc2lvbmtleSArICdfb3Jtb3Jnc2VjdG9ycycpLCAndW5kZWZpbmVkJykpIHsKICAgICAgICAgICAgICAgICAgb3Jtb3Jnc2VjdG9yc0RhdGEgPSBKU09OLnBhcnNlKHRoaXMudGVtcFN0b3JhZ2UuZ2V0SXRlbShjb250ZXh0LnNyZnNlc3Npb25rZXkgKyAnX29ybW9yZ3NlY3RvcnMnKSk7CgogICAgICAgICAgICAgICAgICBpZiAob3Jtb3Jnc2VjdG9yc0RhdGEgJiYgb3Jtb3Jnc2VjdG9yc0RhdGEubGVuZ3RoICYmIG9ybW9yZ3NlY3RvcnNEYXRhLmxlbmd0aCA+IDApIHsKICAgICAgICAgICAgICAgICAgICBvcm1vcmdzZWN0b3JzRGF0YS5mb3JFYWNoKGZ1bmN0aW9uIChpdGVtKSB7CiAgICAgICAgICAgICAgICAgICAgICBpZiAoaXRlbS5zcmZmcm9udHVmKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChPYmplY3QuaXMoaXRlbS5zcmZmcm9udHVmLCAiMCIpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgaXRlbS5vcmdzZWN0b3JpZCA9IG51bGw7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgICAgIGRlbGV0ZSBpdGVtLnNyZmZyb250dWY7CiAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBtYXN0ZXJEYXRhLm9ybW9yZ3NlY3RvcnMgPSBvcm1vcmdzZWN0b3JzRGF0YTsKICAgICAgICAgICAgICAgIHBpbWNvbnRyYWN0c2lnbm9yZ3NEYXRhID0gW107CgogICAgICAgICAgICAgICAgaWYgKCFPYmplY3QuaXModGhpcy50ZW1wU3RvcmFnZS5nZXRJdGVtKGNvbnRleHQuc3Jmc2Vzc2lvbmtleSArICdfcGltY29udHJhY3RzaWdub3JncycpLCAndW5kZWZpbmVkJykpIHsKICAgICAgICAgICAgICAgICAgcGltY29udHJhY3RzaWdub3Jnc0RhdGEgPSBKU09OLnBhcnNlKHRoaXMudGVtcFN0b3JhZ2UuZ2V0SXRlbShjb250ZXh0LnNyZnNlc3Npb25rZXkgKyAnX3BpbWNvbnRyYWN0c2lnbm9yZ3MnKSk7CgogICAgICAgICAgICAgICAgICBpZiAocGltY29udHJhY3RzaWdub3Jnc0RhdGEgJiYgcGltY29udHJhY3RzaWdub3Jnc0RhdGEubGVuZ3RoICYmIHBpbWNvbnRyYWN0c2lnbm9yZ3NEYXRhLmxlbmd0aCA+IDApIHsKICAgICAgICAgICAgICAgICAgICBwaW1jb250cmFjdHNpZ25vcmdzRGF0YS5mb3JFYWNoKGZ1bmN0aW9uIChpdGVtKSB7CiAgICAgICAgICAgICAgICAgICAgICBpZiAoaXRlbS5zcmZmcm9udHVmKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChPYmplY3QuaXMoaXRlbS5zcmZmcm9udHVmLCAiMCIpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgaXRlbS5jb250cmFjdHNpZ25vcmdpZCA9IG51bGw7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgICAgIGRlbGV0ZSBpdGVtLnNyZmZyb250dWY7CiAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBtYXN0ZXJEYXRhLnBpbWNvbnRyYWN0c2lnbm9yZ3MgPSBwaW1jb250cmFjdHNpZ25vcmdzRGF0YTsKICAgICAgICAgICAgICAgIG9ybXBvc3RzRGF0YSA9IFtdOwoKICAgICAgICAgICAgICAgIGlmICghT2JqZWN0LmlzKHRoaXMudGVtcFN0b3JhZ2UuZ2V0SXRlbShjb250ZXh0LnNyZnNlc3Npb25rZXkgKyAnX29ybXBvc3RzJyksICd1bmRlZmluZWQnKSkgewogICAgICAgICAgICAgICAgICBvcm1wb3N0c0RhdGEgPSBKU09OLnBhcnNlKHRoaXMudGVtcFN0b3JhZ2UuZ2V0SXRlbShjb250ZXh0LnNyZnNlc3Npb25rZXkgKyAnX29ybXBvc3RzJykpOwoKICAgICAgICAgICAgICAgICAgaWYgKG9ybXBvc3RzRGF0YSAmJiBvcm1wb3N0c0RhdGEubGVuZ3RoICYmIG9ybXBvc3RzRGF0YS5sZW5ndGggPiAwKSB7CiAgICAgICAgICAgICAgICAgICAgb3JtcG9zdHNEYXRhLmZvckVhY2goZnVuY3Rpb24gKGl0ZW0pIHsKICAgICAgICAgICAgICAgICAgICAgIGlmIChpdGVtLnNyZmZyb250dWYpIHsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKE9iamVjdC5pcyhpdGVtLnNyZmZyb250dWYsICIwIikpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICBpdGVtLm9ybXBvc3RpZCA9IG51bGw7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgICAgIGRlbGV0ZSBpdGVtLnNyZmZyb250dWY7CiAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBtYXN0ZXJEYXRhLm9ybXBvc3RzID0gb3JtcG9zdHNEYXRhOwogICAgICAgICAgICAgICAgb3Jtb3Jnc0RhdGEgPSBbXTsKCiAgICAgICAgICAgICAgICBpZiAoIU9iamVjdC5pcyh0aGlzLnRlbXBTdG9yYWdlLmdldEl0ZW0oY29udGV4dC5zcmZzZXNzaW9ua2V5ICsgJ19vcm1vcmdzJyksICd1bmRlZmluZWQnKSkgewogICAgICAgICAgICAgICAgICBvcm1vcmdzRGF0YSA9IEpTT04ucGFyc2UodGhpcy50ZW1wU3RvcmFnZS5nZXRJdGVtKGNvbnRleHQuc3Jmc2Vzc2lvbmtleSArICdfb3Jtb3JncycpKTsKCiAgICAgICAgICAgICAgICAgIGlmIChvcm1vcmdzRGF0YSAmJiBvcm1vcmdzRGF0YS5sZW5ndGggJiYgb3Jtb3Jnc0RhdGEubGVuZ3RoID4gMCkgewogICAgICAgICAgICAgICAgICAgIG9ybW9yZ3NEYXRhLmZvckVhY2goZnVuY3Rpb24gKGl0ZW0pIHsKICAgICAgICAgICAgICAgICAgICAgIGlmIChpdGVtLnNyZmZyb250dWYpIHsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKE9iamVjdC5pcyhpdGVtLnNyZmZyb250dWYsICIwIikpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICBpdGVtLm9yZ2lkID0gbnVsbDsKICAgICAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICAgICAgZGVsZXRlIGl0ZW0uc3JmZnJvbnR1ZjsKICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIG1hc3RlckRhdGEub3Jtb3JncyA9IG9ybW9yZ3NEYXRhOwogICAgICAgICAgICAgICAgT2JqZWN0LmFzc2lnbihkYXRhLCBtYXN0ZXJEYXRhKTsKICAgICAgICAgICAgICAgIF9jb250ZXh0OS5uZXh0ID0gMTk7CiAgICAgICAgICAgICAgICByZXR1cm4gSHR0cC5nZXRJbnN0YW5jZSgpLnBvc3QoIi9vcm1vcmdzLyIuY29uY2F0KGNvbnRleHQub3Jtb3JnLCAiL3NhdmUiKSwgZGF0YSwgaXNsb2FkaW5nKTsKCiAgICAgICAgICAgICAgY2FzZSAxOToKICAgICAgICAgICAgICAgIHJlcyA9IF9jb250ZXh0OS5zZW50OwogICAgICAgICAgICAgICAgdGhpcy50ZW1wU3RvcmFnZS5zZXRJdGVtKGNvbnRleHQuc3Jmc2Vzc2lvbmtleSArICdfb3Jtb3Jnc2VjdG9ycycsIEpTT04uc3RyaW5naWZ5KHJlcy5kYXRhLm9ybW9yZ3NlY3RvcnMpKTsKICAgICAgICAgICAgICAgIHRoaXMudGVtcFN0b3JhZ2Uuc2V0SXRlbShjb250ZXh0LnNyZnNlc3Npb25rZXkgKyAnX3BpbWNvbnRyYWN0c2lnbm9yZ3MnLCBKU09OLnN0cmluZ2lmeShyZXMuZGF0YS5waW1jb250cmFjdHNpZ25vcmdzKSk7CiAgICAgICAgICAgICAgICB0aGlzLnRlbXBTdG9yYWdlLnNldEl0ZW0oY29udGV4dC5zcmZzZXNzaW9ua2V5ICsgJ19vcm1wb3N0cycsIEpTT04uc3RyaW5naWZ5KHJlcy5kYXRhLm9ybXBvc3RzKSk7CiAgICAgICAgICAgICAgICB0aGlzLnRlbXBTdG9yYWdlLnNldEl0ZW0oY29udGV4dC5zcmZzZXNzaW9ua2V5ICsgJ19vcm1vcmdzJywgSlNPTi5zdHJpbmdpZnkocmVzLmRhdGEub3Jtb3JncykpOwogICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0OS5hYnJ1cHQoInJldHVybiIsIHJlcyk7CgogICAgICAgICAgICAgIGNhc2UgMjU6CiAgICAgICAgICAgICAgY2FzZSAiZW5kIjoKICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDkuc3RvcCgpOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSwgX2NhbGxlZTksIHRoaXMpOwogICAgICB9KSk7CgogICAgICBmdW5jdGlvbiBTYXZlKCkgewogICAgICAgIHJldHVybiBfU2F2ZS5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwogICAgICB9CgogICAgICByZXR1cm4gU2F2ZTsKICAgIH0oKQogICAgLyoqDQogICAgICogRmV0Y2hBTExTSUdOT1JH5o6l5Y+j5pa55rOVDQogICAgICoNCiAgICAgKiBAcGFyYW0geyp9IFtjb250ZXh0PXt9XQ0KICAgICAqIEBwYXJhbSB7Kn0gW2RhdGE9e31dDQogICAgICogQHBhcmFtIHtib29sZWFufSBbaXNsb2FkaW5nXQ0KICAgICAqIEByZXR1cm5zIHtQcm9taXNlPGFueT59DQogICAgICogQG1lbWJlcm9mIE9ybU9yZ1NlcnZpY2VCYXNlDQogICAgICovCgogIH0sIHsKICAgIGtleTogIkZldGNoQUxMU0lHTk9SRyIsCiAgICB2YWx1ZTogZnVuY3Rpb24gKCkgewogICAgICB2YXIgX0ZldGNoQUxMU0lHTk9SRyA9IF9hc3luY1RvR2VuZXJhdG9yKAogICAgICAvKiNfX1BVUkVfXyovCiAgICAgIHJlZ2VuZXJhdG9yUnVudGltZS5tYXJrKGZ1bmN0aW9uIF9jYWxsZWUxMCgpIHsKICAgICAgICB2YXIgY29udGV4dCwKICAgICAgICAgICAgZGF0YSwKICAgICAgICAgICAgaXNsb2FkaW5nLAogICAgICAgICAgICB0ZW1wRGF0YSwKICAgICAgICAgICAgX2FyZ3MxMCA9IGFyZ3VtZW50czsKICAgICAgICByZXR1cm4gcmVnZW5lcmF0b3JSdW50aW1lLndyYXAoZnVuY3Rpb24gX2NhbGxlZTEwJChfY29udGV4dDEwKSB7CiAgICAgICAgICB3aGlsZSAoMSkgewogICAgICAgICAgICBzd2l0Y2ggKF9jb250ZXh0MTAucHJldiA9IF9jb250ZXh0MTAubmV4dCkgewogICAgICAgICAgICAgIGNhc2UgMDoKICAgICAgICAgICAgICAgIGNvbnRleHQgPSBfYXJnczEwLmxlbmd0aCA+IDAgJiYgX2FyZ3MxMFswXSAhPT0gdW5kZWZpbmVkID8gX2FyZ3MxMFswXSA6IHt9OwogICAgICAgICAgICAgICAgZGF0YSA9IF9hcmdzMTAubGVuZ3RoID4gMSAmJiBfYXJnczEwWzFdICE9PSB1bmRlZmluZWQgPyBfYXJnczEwWzFdIDoge307CiAgICAgICAgICAgICAgICBpc2xvYWRpbmcgPSBfYXJnczEwLmxlbmd0aCA+IDIgPyBfYXJnczEwWzJdIDogdW5kZWZpbmVkOwogICAgICAgICAgICAgICAgdGVtcERhdGEgPSBKU09OLnBhcnNlKEpTT04uc3RyaW5naWZ5KGRhdGEpKTsKICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDEwLmFicnVwdCgicmV0dXJuIiwgSHR0cC5nZXRJbnN0YW5jZSgpLmdldCgiL29ybW9yZ3MvZmV0Y2hhbGxzaWdub3JnIiwgdGVtcERhdGEsIGlzbG9hZGluZykpOwoKICAgICAgICAgICAgICBjYXNlIDU6CiAgICAgICAgICAgICAgY2FzZSAiZW5kIjoKICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDEwLnN0b3AoKTsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0sIF9jYWxsZWUxMCk7CiAgICAgIH0pKTsKCiAgICAgIGZ1bmN0aW9uIEZldGNoQUxMU0lHTk9SRygpIHsKICAgICAgICByZXR1cm4gX0ZldGNoQUxMU0lHTk9SRy5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwogICAgICB9CgogICAgICByZXR1cm4gRmV0Y2hBTExTSUdOT1JHOwogICAgfSgpCiAgICAvKioNCiAgICAgKiBGZXRjaEFsbExldmVsVHdvT3JnMuaOpeWPo+aWueazlQ0KICAgICAqDQogICAgICogQHBhcmFtIHsqfSBbY29udGV4dD17fV0NCiAgICAgKiBAcGFyYW0geyp9IFtkYXRhPXt9XQ0KICAgICAqIEBwYXJhbSB7Ym9vbGVhbn0gW2lzbG9hZGluZ10NCiAgICAgKiBAcmV0dXJucyB7UHJvbWlzZTxhbnk+fQ0KICAgICAqIEBtZW1iZXJvZiBPcm1PcmdTZXJ2aWNlQmFzZQ0KICAgICAqLwoKICB9LCB7CiAgICBrZXk6ICJGZXRjaEFsbExldmVsVHdvT3JnMiIsCiAgICB2YWx1ZTogZnVuY3Rpb24gKCkgewogICAgICB2YXIgX0ZldGNoQWxsTGV2ZWxUd29PcmcgPSBfYXN5bmNUb0dlbmVyYXRvcigKICAgICAgLyojX19QVVJFX18qLwogICAgICByZWdlbmVyYXRvclJ1bnRpbWUubWFyayhmdW5jdGlvbiBfY2FsbGVlMTEoKSB7CiAgICAgICAgdmFyIGNvbnRleHQsCiAgICAgICAgICAgIGRhdGEsCiAgICAgICAgICAgIGlzbG9hZGluZywKICAgICAgICAgICAgdGVtcERhdGEsCiAgICAgICAgICAgIF9hcmdzMTEgPSBhcmd1bWVudHM7CiAgICAgICAgcmV0dXJuIHJlZ2VuZXJhdG9yUnVudGltZS53cmFwKGZ1bmN0aW9uIF9jYWxsZWUxMSQoX2NvbnRleHQxMSkgewogICAgICAgICAgd2hpbGUgKDEpIHsKICAgICAgICAgICAgc3dpdGNoIChfY29udGV4dDExLnByZXYgPSBfY29udGV4dDExLm5leHQpIHsKICAgICAgICAgICAgICBjYXNlIDA6CiAgICAgICAgICAgICAgICBjb250ZXh0ID0gX2FyZ3MxMS5sZW5ndGggPiAwICYmIF9hcmdzMTFbMF0gIT09IHVuZGVmaW5lZCA/IF9hcmdzMTFbMF0gOiB7fTsKICAgICAgICAgICAgICAgIGRhdGEgPSBfYXJnczExLmxlbmd0aCA+IDEgJiYgX2FyZ3MxMVsxXSAhPT0gdW5kZWZpbmVkID8gX2FyZ3MxMVsxXSA6IHt9OwogICAgICAgICAgICAgICAgaXNsb2FkaW5nID0gX2FyZ3MxMS5sZW5ndGggPiAyID8gX2FyZ3MxMVsyXSA6IHVuZGVmaW5lZDsKICAgICAgICAgICAgICAgIHRlbXBEYXRhID0gSlNPTi5wYXJzZShKU09OLnN0cmluZ2lmeShkYXRhKSk7CiAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQxMS5hYnJ1cHQoInJldHVybiIsIEh0dHAuZ2V0SW5zdGFuY2UoKS5nZXQoIi9vcm1vcmdzL2ZldGNoYWxsbGV2ZWx0d29vcmcyIiwgdGVtcERhdGEsIGlzbG9hZGluZykpOwoKICAgICAgICAgICAgICBjYXNlIDU6CiAgICAgICAgICAgICAgY2FzZSAiZW5kIjoKICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDExLnN0b3AoKTsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0sIF9jYWxsZWUxMSk7CiAgICAgIH0pKTsKCiAgICAgIGZ1bmN0aW9uIEZldGNoQWxsTGV2ZWxUd29PcmcyKCkgewogICAgICAgIHJldHVybiBfRmV0Y2hBbGxMZXZlbFR3b09yZy5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwogICAgICB9CgogICAgICByZXR1cm4gRmV0Y2hBbGxMZXZlbFR3b09yZzI7CiAgICB9KCkKICAgIC8qKg0KICAgICAqIEZldGNoT3JnbGlzdF9Qcm9maWxl5o6l5Y+j5pa55rOVDQogICAgICoNCiAgICAgKiBAcGFyYW0geyp9IFtjb250ZXh0PXt9XQ0KICAgICAqIEBwYXJhbSB7Kn0gW2RhdGE9e31dDQogICAgICogQHBhcmFtIHtib29sZWFufSBbaXNsb2FkaW5nXQ0KICAgICAqIEByZXR1cm5zIHtQcm9taXNlPGFueT59DQogICAgICogQG1lbWJlcm9mIE9ybU9yZ1NlcnZpY2VCYXNlDQogICAgICovCgogIH0sIHsKICAgIGtleTogIkZldGNoT3JnbGlzdF9Qcm9maWxlIiwKICAgIHZhbHVlOiBmdW5jdGlvbiAoKSB7CiAgICAgIHZhciBfRmV0Y2hPcmdsaXN0X1Byb2ZpbGUgPSBfYXN5bmNUb0dlbmVyYXRvcigKICAgICAgLyojX19QVVJFX18qLwogICAgICByZWdlbmVyYXRvclJ1bnRpbWUubWFyayhmdW5jdGlvbiBfY2FsbGVlMTIoKSB7CiAgICAgICAgdmFyIGNvbnRleHQsCiAgICAgICAgICAgIGRhdGEsCiAgICAgICAgICAgIGlzbG9hZGluZywKICAgICAgICAgICAgdGVtcERhdGEsCiAgICAgICAgICAgIF9hcmdzMTIgPSBhcmd1bWVudHM7CiAgICAgICAgcmV0dXJuIHJlZ2VuZXJhdG9yUnVudGltZS53cmFwKGZ1bmN0aW9uIF9jYWxsZWUxMiQoX2NvbnRleHQxMikgewogICAgICAgICAgd2hpbGUgKDEpIHsKICAgICAgICAgICAgc3dpdGNoIChfY29udGV4dDEyLnByZXYgPSBfY29udGV4dDEyLm5leHQpIHsKICAgICAgICAgICAgICBjYXNlIDA6CiAgICAgICAgICAgICAgICBjb250ZXh0ID0gX2FyZ3MxMi5sZW5ndGggPiAwICYmIF9hcmdzMTJbMF0gIT09IHVuZGVmaW5lZCA/IF9hcmdzMTJbMF0gOiB7fTsKICAgICAgICAgICAgICAgIGRhdGEgPSBfYXJnczEyLmxlbmd0aCA+IDEgJiYgX2FyZ3MxMlsxXSAhPT0gdW5kZWZpbmVkID8gX2FyZ3MxMlsxXSA6IHt9OwogICAgICAgICAgICAgICAgaXNsb2FkaW5nID0gX2FyZ3MxMi5sZW5ndGggPiAyID8gX2FyZ3MxMlsyXSA6IHVuZGVmaW5lZDsKICAgICAgICAgICAgICAgIHRlbXBEYXRhID0gSlNPTi5wYXJzZShKU09OLnN0cmluZ2lmeShkYXRhKSk7CiAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQxMi5hYnJ1cHQoInJldHVybiIsIEh0dHAuZ2V0SW5zdGFuY2UoKS5nZXQoIi9vcm1vcmdzL2ZldGNob3JnbGlzdF9wcm9maWxlIiwgdGVtcERhdGEsIGlzbG9hZGluZykpOwoKICAgICAgICAgICAgICBjYXNlIDU6CiAgICAgICAgICAgICAgY2FzZSAiZW5kIjoKICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDEyLnN0b3AoKTsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0sIF9jYWxsZWUxMik7CiAgICAgIH0pKTsKCiAgICAgIGZ1bmN0aW9uIEZldGNoT3JnbGlzdF9Qcm9maWxlKCkgewogICAgICAgIHJldHVybiBfRmV0Y2hPcmdsaXN0X1Byb2ZpbGUuYXBwbHkodGhpcywgYXJndW1lbnRzKTsKICAgICAgfQoKICAgICAgcmV0dXJuIEZldGNoT3JnbGlzdF9Qcm9maWxlOwogICAgfSgpCiAgICAvKioNCiAgICAgKiBGZXRjaFJFUF9PUkfmjqXlj6Pmlrnms5UNCiAgICAgKg0KICAgICAqIEBwYXJhbSB7Kn0gW2NvbnRleHQ9e31dDQogICAgICogQHBhcmFtIHsqfSBbZGF0YT17fV0NCiAgICAgKiBAcGFyYW0ge2Jvb2xlYW59IFtpc2xvYWRpbmddDQogICAgICogQHJldHVybnMge1Byb21pc2U8YW55Pn0NCiAgICAgKiBAbWVtYmVyb2YgT3JtT3JnU2VydmljZUJhc2UNCiAgICAgKi8KCiAgfSwgewogICAga2V5OiAiRmV0Y2hSRVBfT1JHIiwKICAgIHZhbHVlOiBmdW5jdGlvbiAoKSB7CiAgICAgIHZhciBfRmV0Y2hSRVBfT1JHID0gX2FzeW5jVG9HZW5lcmF0b3IoCiAgICAgIC8qI19fUFVSRV9fKi8KICAgICAgcmVnZW5lcmF0b3JSdW50aW1lLm1hcmsoZnVuY3Rpb24gX2NhbGxlZTEzKCkgewogICAgICAgIHZhciBjb250ZXh0LAogICAgICAgICAgICBkYXRhLAogICAgICAgICAgICBpc2xvYWRpbmcsCiAgICAgICAgICAgIHRlbXBEYXRhLAogICAgICAgICAgICBfYXJnczEzID0gYXJndW1lbnRzOwogICAgICAgIHJldHVybiByZWdlbmVyYXRvclJ1bnRpbWUud3JhcChmdW5jdGlvbiBfY2FsbGVlMTMkKF9jb250ZXh0MTMpIHsKICAgICAgICAgIHdoaWxlICgxKSB7CiAgICAgICAgICAgIHN3aXRjaCAoX2NvbnRleHQxMy5wcmV2ID0gX2NvbnRleHQxMy5uZXh0KSB7CiAgICAgICAgICAgICAgY2FzZSAwOgogICAgICAgICAgICAgICAgY29udGV4dCA9IF9hcmdzMTMubGVuZ3RoID4gMCAmJiBfYXJnczEzWzBdICE9PSB1bmRlZmluZWQgPyBfYXJnczEzWzBdIDoge307CiAgICAgICAgICAgICAgICBkYXRhID0gX2FyZ3MxMy5sZW5ndGggPiAxICYmIF9hcmdzMTNbMV0gIT09IHVuZGVmaW5lZCA/IF9hcmdzMTNbMV0gOiB7fTsKICAgICAgICAgICAgICAgIGlzbG9hZGluZyA9IF9hcmdzMTMubGVuZ3RoID4gMiA/IF9hcmdzMTNbMl0gOiB1bmRlZmluZWQ7CiAgICAgICAgICAgICAgICB0ZW1wRGF0YSA9IEpTT04ucGFyc2UoSlNPTi5zdHJpbmdpZnkoZGF0YSkpOwogICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0MTMuYWJydXB0KCJyZXR1cm4iLCBIdHRwLmdldEluc3RhbmNlKCkuZ2V0KCIvb3Jtb3Jncy9mZXRjaHJlcF9vcmciLCB0ZW1wRGF0YSwgaXNsb2FkaW5nKSk7CgogICAgICAgICAgICAgIGNhc2UgNToKICAgICAgICAgICAgICBjYXNlICJlbmQiOgogICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0MTMuc3RvcCgpOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSwgX2NhbGxlZTEzKTsKICAgICAgfSkpOwoKICAgICAgZnVuY3Rpb24gRmV0Y2hSRVBfT1JHKCkgewogICAgICAgIHJldHVybiBfRmV0Y2hSRVBfT1JHLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7CiAgICAgIH0KCiAgICAgIHJldHVybiBGZXRjaFJFUF9PUkc7CiAgICB9KCkKICAgIC8qKg0KICAgICAqIEZldGNoQXV0aE9yZ+aOpeWPo+aWueazlQ0KICAgICAqDQogICAgICogQHBhcmFtIHsqfSBbY29udGV4dD17fV0NCiAgICAgKiBAcGFyYW0geyp9IFtkYXRhPXt9XQ0KICAgICAqIEBwYXJhbSB7Ym9vbGVhbn0gW2lzbG9hZGluZ10NCiAgICAgKiBAcmV0dXJucyB7UHJvbWlzZTxhbnk+fQ0KICAgICAqIEBtZW1iZXJvZiBPcm1PcmdTZXJ2aWNlQmFzZQ0KICAgICAqLwoKICB9LCB7CiAgICBrZXk6ICJGZXRjaEF1dGhPcmciLAogICAgdmFsdWU6IGZ1bmN0aW9uICgpIHsKICAgICAgdmFyIF9GZXRjaEF1dGhPcmcgPSBfYXN5bmNUb0dlbmVyYXRvcigKICAgICAgLyojX19QVVJFX18qLwogICAgICByZWdlbmVyYXRvclJ1bnRpbWUubWFyayhmdW5jdGlvbiBfY2FsbGVlMTQoKSB7CiAgICAgICAgdmFyIGNvbnRleHQsCiAgICAgICAgICAgIGRhdGEsCiAgICAgICAgICAgIGlzbG9hZGluZywKICAgICAgICAgICAgdGVtcERhdGEsCiAgICAgICAgICAgIF9hcmdzMTQgPSBhcmd1bWVudHM7CiAgICAgICAgcmV0dXJuIHJlZ2VuZXJhdG9yUnVudGltZS53cmFwKGZ1bmN0aW9uIF9jYWxsZWUxNCQoX2NvbnRleHQxNCkgewogICAgICAgICAgd2hpbGUgKDEpIHsKICAgICAgICAgICAgc3dpdGNoIChfY29udGV4dDE0LnByZXYgPSBfY29udGV4dDE0Lm5leHQpIHsKICAgICAgICAgICAgICBjYXNlIDA6CiAgICAgICAgICAgICAgICBjb250ZXh0ID0gX2FyZ3MxNC5sZW5ndGggPiAwICYmIF9hcmdzMTRbMF0gIT09IHVuZGVmaW5lZCA/IF9hcmdzMTRbMF0gOiB7fTsKICAgICAgICAgICAgICAgIGRhdGEgPSBfYXJnczE0Lmxlbmd0aCA+IDEgJiYgX2FyZ3MxNFsxXSAhPT0gdW5kZWZpbmVkID8gX2FyZ3MxNFsxXSA6IHt9OwogICAgICAgICAgICAgICAgaXNsb2FkaW5nID0gX2FyZ3MxNC5sZW5ndGggPiAyID8gX2FyZ3MxNFsyXSA6IHVuZGVmaW5lZDsKICAgICAgICAgICAgICAgIHRlbXBEYXRhID0gSlNPTi5wYXJzZShKU09OLnN0cmluZ2lmeShkYXRhKSk7CiAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQxNC5hYnJ1cHQoInJldHVybiIsIEh0dHAuZ2V0SW5zdGFuY2UoKS5nZXQoIi9vcm1vcmdzL2ZldGNoYXV0aG9yZyIsIHRlbXBEYXRhLCBpc2xvYWRpbmcpKTsKCiAgICAgICAgICAgICAgY2FzZSA1OgogICAgICAgICAgICAgIGNhc2UgImVuZCI6CiAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQxNC5zdG9wKCk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9LCBfY2FsbGVlMTQpOwogICAgICB9KSk7CgogICAgICBmdW5jdGlvbiBGZXRjaEF1dGhPcmcoKSB7CiAgICAgICAgcmV0dXJuIF9GZXRjaEF1dGhPcmcuYXBwbHkodGhpcywgYXJndW1lbnRzKTsKICAgICAgfQoKICAgICAgcmV0dXJuIEZldGNoQXV0aE9yZzsKICAgIH0oKQogICAgLyoqDQogICAgICogRmV0Y2hHU0dXWlnmjqXlj6Pmlrnms5UNCiAgICAgKg0KICAgICAqIEBwYXJhbSB7Kn0gW2NvbnRleHQ9e31dDQogICAgICogQHBhcmFtIHsqfSBbZGF0YT17fV0NCiAgICAgKiBAcGFyYW0ge2Jvb2xlYW59IFtpc2xvYWRpbmddDQogICAgICogQHJldHVybnMge1Byb21pc2U8YW55Pn0NCiAgICAgKiBAbWVtYmVyb2YgT3JtT3JnU2VydmljZUJhc2UNCiAgICAgKi8KCiAgfSwgewogICAga2V5OiAiRmV0Y2hHU0dXWlkiLAogICAgdmFsdWU6IGZ1bmN0aW9uICgpIHsKICAgICAgdmFyIF9GZXRjaEdTR1daWSA9IF9hc3luY1RvR2VuZXJhdG9yKAogICAgICAvKiNfX1BVUkVfXyovCiAgICAgIHJlZ2VuZXJhdG9yUnVudGltZS5tYXJrKGZ1bmN0aW9uIF9jYWxsZWUxNSgpIHsKICAgICAgICB2YXIgY29udGV4dCwKICAgICAgICAgICAgZGF0YSwKICAgICAgICAgICAgaXNsb2FkaW5nLAogICAgICAgICAgICB0ZW1wRGF0YSwKICAgICAgICAgICAgX2FyZ3MxNSA9IGFyZ3VtZW50czsKICAgICAgICByZXR1cm4gcmVnZW5lcmF0b3JSdW50aW1lLndyYXAoZnVuY3Rpb24gX2NhbGxlZTE1JChfY29udGV4dDE1KSB7CiAgICAgICAgICB3aGlsZSAoMSkgewogICAgICAgICAgICBzd2l0Y2ggKF9jb250ZXh0MTUucHJldiA9IF9jb250ZXh0MTUubmV4dCkgewogICAgICAgICAgICAgIGNhc2UgMDoKICAgICAgICAgICAgICAgIGNvbnRleHQgPSBfYXJnczE1Lmxlbmd0aCA+IDAgJiYgX2FyZ3MxNVswXSAhPT0gdW5kZWZpbmVkID8gX2FyZ3MxNVswXSA6IHt9OwogICAgICAgICAgICAgICAgZGF0YSA9IF9hcmdzMTUubGVuZ3RoID4gMSAmJiBfYXJnczE1WzFdICE9PSB1bmRlZmluZWQgPyBfYXJnczE1WzFdIDoge307CiAgICAgICAgICAgICAgICBpc2xvYWRpbmcgPSBfYXJnczE1Lmxlbmd0aCA+IDIgPyBfYXJnczE1WzJdIDogdW5kZWZpbmVkOwogICAgICAgICAgICAgICAgdGVtcERhdGEgPSBKU09OLnBhcnNlKEpTT04uc3RyaW5naWZ5KGRhdGEpKTsKICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDE1LmFicnVwdCgicmV0dXJuIiwgSHR0cC5nZXRJbnN0YW5jZSgpLmdldCgiL29ybW9yZ3MvZmV0Y2hnc2d3enkiLCB0ZW1wRGF0YSwgaXNsb2FkaW5nKSk7CgogICAgICAgICAgICAgIGNhc2UgNToKICAgICAgICAgICAgICBjYXNlICJlbmQiOgogICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0MTUuc3RvcCgpOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSwgX2NhbGxlZTE1KTsKICAgICAgfSkpOwoKICAgICAgZnVuY3Rpb24gRmV0Y2hHU0dXWlkoKSB7CiAgICAgICAgcmV0dXJuIF9GZXRjaEdTR1daWS5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwogICAgICB9CgogICAgICByZXR1cm4gRmV0Y2hHU0dXWlk7CiAgICB9KCkKICAgIC8qKg0KICAgICAqIEZldGNoU3ViU3ViT3Jn5o6l5Y+j5pa55rOVDQogICAgICoNCiAgICAgKiBAcGFyYW0geyp9IFtjb250ZXh0PXt9XQ0KICAgICAqIEBwYXJhbSB7Kn0gW2RhdGE9e31dDQogICAgICogQHBhcmFtIHtib29sZWFufSBbaXNsb2FkaW5nXQ0KICAgICAqIEByZXR1cm5zIHtQcm9taXNlPGFueT59DQogICAgICogQG1lbWJlcm9mIE9ybU9yZ1NlcnZpY2VCYXNlDQogICAgICovCgogIH0sIHsKICAgIGtleTogIkZldGNoU3ViU3ViT3JnIiwKICAgIHZhbHVlOiBmdW5jdGlvbiAoKSB7CiAgICAgIHZhciBfRmV0Y2hTdWJTdWJPcmcgPSBfYXN5bmNUb0dlbmVyYXRvcigKICAgICAgLyojX19QVVJFX18qLwogICAgICByZWdlbmVyYXRvclJ1bnRpbWUubWFyayhmdW5jdGlvbiBfY2FsbGVlMTYoKSB7CiAgICAgICAgdmFyIGNvbnRleHQsCiAgICAgICAgICAgIGRhdGEsCiAgICAgICAgICAgIGlzbG9hZGluZywKICAgICAgICAgICAgdGVtcERhdGEsCiAgICAgICAgICAgIF9hcmdzMTYgPSBhcmd1bWVudHM7CiAgICAgICAgcmV0dXJuIHJlZ2VuZXJhdG9yUnVudGltZS53cmFwKGZ1bmN0aW9uIF9jYWxsZWUxNiQoX2NvbnRleHQxNikgewogICAgICAgICAgd2hpbGUgKDEpIHsKICAgICAgICAgICAgc3dpdGNoIChfY29udGV4dDE2LnByZXYgPSBfY29udGV4dDE2Lm5leHQpIHsKICAgICAgICAgICAgICBjYXNlIDA6CiAgICAgICAgICAgICAgICBjb250ZXh0ID0gX2FyZ3MxNi5sZW5ndGggPiAwICYmIF9hcmdzMTZbMF0gIT09IHVuZGVmaW5lZCA/IF9hcmdzMTZbMF0gOiB7fTsKICAgICAgICAgICAgICAgIGRhdGEgPSBfYXJnczE2Lmxlbmd0aCA+IDEgJiYgX2FyZ3MxNlsxXSAhPT0gdW5kZWZpbmVkID8gX2FyZ3MxNlsxXSA6IHt9OwogICAgICAgICAgICAgICAgaXNsb2FkaW5nID0gX2FyZ3MxNi5sZW5ndGggPiAyID8gX2FyZ3MxNlsyXSA6IHVuZGVmaW5lZDsKICAgICAgICAgICAgICAgIHRlbXBEYXRhID0gSlNPTi5wYXJzZShKU09OLnN0cmluZ2lmeShkYXRhKSk7CiAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQxNi5hYnJ1cHQoInJldHVybiIsIEh0dHAuZ2V0SW5zdGFuY2UoKS5nZXQoIi9vcm1vcmdzL2ZldGNoc3Vic3Vib3JnIiwgdGVtcERhdGEsIGlzbG9hZGluZykpOwoKICAgICAgICAgICAgICBjYXNlIDU6CiAgICAgICAgICAgICAgY2FzZSAiZW5kIjoKICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDE2LnN0b3AoKTsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0sIF9jYWxsZWUxNik7CiAgICAgIH0pKTsKCiAgICAgIGZ1bmN0aW9uIEZldGNoU3ViU3ViT3JnKCkgewogICAgICAgIHJldHVybiBfRmV0Y2hTdWJTdWJPcmcuYXBwbHkodGhpcywgYXJndW1lbnRzKTsKICAgICAgfQoKICAgICAgcmV0dXJuIEZldGNoU3ViU3ViT3JnOwogICAgfSgpCiAgICAvKioNCiAgICAgKiBGZXRjaERlZmF1bHTmjqXlj6Pmlrnms5UNCiAgICAgKg0KICAgICAqIEBwYXJhbSB7Kn0gW2NvbnRleHQ9e31dDQogICAgICogQHBhcmFtIHsqfSBbZGF0YT17fV0NCiAgICAgKiBAcGFyYW0ge2Jvb2xlYW59IFtpc2xvYWRpbmddDQogICAgICogQHJldHVybnMge1Byb21pc2U8YW55Pn0NCiAgICAgKiBAbWVtYmVyb2YgT3JtT3JnU2VydmljZUJhc2UNCiAgICAgKi8KCiAgfSwgewogICAga2V5OiAiRmV0Y2hEZWZhdWx0IiwKICAgIHZhbHVlOiBmdW5jdGlvbiAoKSB7CiAgICAgIHZhciBfRmV0Y2hEZWZhdWx0ID0gX2FzeW5jVG9HZW5lcmF0b3IoCiAgICAgIC8qI19fUFVSRV9fKi8KICAgICAgcmVnZW5lcmF0b3JSdW50aW1lLm1hcmsoZnVuY3Rpb24gX2NhbGxlZTE3KCkgewogICAgICAgIHZhciBjb250ZXh0LAogICAgICAgICAgICBkYXRhLAogICAgICAgICAgICBpc2xvYWRpbmcsCiAgICAgICAgICAgIHRlbXBEYXRhLAogICAgICAgICAgICBfYXJnczE3ID0gYXJndW1lbnRzOwogICAgICAgIHJldHVybiByZWdlbmVyYXRvclJ1bnRpbWUud3JhcChmdW5jdGlvbiBfY2FsbGVlMTckKF9jb250ZXh0MTcpIHsKICAgICAgICAgIHdoaWxlICgxKSB7CiAgICAgICAgICAgIHN3aXRjaCAoX2NvbnRleHQxNy5wcmV2ID0gX2NvbnRleHQxNy5uZXh0KSB7CiAgICAgICAgICAgICAgY2FzZSAwOgogICAgICAgICAgICAgICAgY29udGV4dCA9IF9hcmdzMTcubGVuZ3RoID4gMCAmJiBfYXJnczE3WzBdICE9PSB1bmRlZmluZWQgPyBfYXJnczE3WzBdIDoge307CiAgICAgICAgICAgICAgICBkYXRhID0gX2FyZ3MxNy5sZW5ndGggPiAxICYmIF9hcmdzMTdbMV0gIT09IHVuZGVmaW5lZCA/IF9hcmdzMTdbMV0gOiB7fTsKICAgICAgICAgICAgICAgIGlzbG9hZGluZyA9IF9hcmdzMTcubGVuZ3RoID4gMiA/IF9hcmdzMTdbMl0gOiB1bmRlZmluZWQ7CiAgICAgICAgICAgICAgICB0ZW1wRGF0YSA9IEpTT04ucGFyc2UoSlNPTi5zdHJpbmdpZnkoZGF0YSkpOwogICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0MTcuYWJydXB0KCJyZXR1cm4iLCBIdHRwLmdldEluc3RhbmNlKCkuZ2V0KCIvb3Jtb3Jncy9mZXRjaGRlZmF1bHQiLCB0ZW1wRGF0YSwgaXNsb2FkaW5nKSk7CgogICAgICAgICAgICAgIGNhc2UgNToKICAgICAgICAgICAgICBjYXNlICJlbmQiOgogICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0MTcuc3RvcCgpOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSwgX2NhbGxlZTE3KTsKICAgICAgfSkpOwoKICAgICAgZnVuY3Rpb24gRmV0Y2hEZWZhdWx0KCkgewogICAgICAgIHJldHVybiBfRmV0Y2hEZWZhdWx0LmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7CiAgICAgIH0KCiAgICAgIHJldHVybiBGZXRjaERlZmF1bHQ7CiAgICB9KCkKICAgIC8qKg0KICAgICAqIEZldGNoQ3VyQ2hpbGTmjqXlj6Pmlrnms5UNCiAgICAgKg0KICAgICAqIEBwYXJhbSB7Kn0gW2NvbnRleHQ9e31dDQogICAgICogQHBhcmFtIHsqfSBbZGF0YT17fV0NCiAgICAgKiBAcGFyYW0ge2Jvb2xlYW59IFtpc2xvYWRpbmddDQogICAgICogQHJldHVybnMge1Byb21pc2U8YW55Pn0NCiAgICAgKiBAbWVtYmVyb2YgT3JtT3JnU2VydmljZUJhc2UNCiAgICAgKi8KCiAgfSwgewogICAga2V5OiAiRmV0Y2hDdXJDaGlsZCIsCiAgICB2YWx1ZTogZnVuY3Rpb24gKCkgewogICAgICB2YXIgX0ZldGNoQ3VyQ2hpbGQgPSBfYXN5bmNUb0dlbmVyYXRvcigKICAgICAgLyojX19QVVJFX18qLwogICAgICByZWdlbmVyYXRvclJ1bnRpbWUubWFyayhmdW5jdGlvbiBfY2FsbGVlMTgoKSB7CiAgICAgICAgdmFyIGNvbnRleHQsCiAgICAgICAgICAgIGRhdGEsCiAgICAgICAgICAgIGlzbG9hZGluZywKICAgICAgICAgICAgdGVtcERhdGEsCiAgICAgICAgICAgIF9hcmdzMTggPSBhcmd1bWVudHM7CiAgICAgICAgcmV0dXJuIHJlZ2VuZXJhdG9yUnVudGltZS53cmFwKGZ1bmN0aW9uIF9jYWxsZWUxOCQoX2NvbnRleHQxOCkgewogICAgICAgICAgd2hpbGUgKDEpIHsKICAgICAgICAgICAgc3dpdGNoIChfY29udGV4dDE4LnByZXYgPSBfY29udGV4dDE4Lm5leHQpIHsKICAgICAgICAgICAgICBjYXNlIDA6CiAgICAgICAgICAgICAgICBjb250ZXh0ID0gX2FyZ3MxOC5sZW5ndGggPiAwICYmIF9hcmdzMThbMF0gIT09IHVuZGVmaW5lZCA/IF9hcmdzMThbMF0gOiB7fTsKICAgICAgICAgICAgICAgIGRhdGEgPSBfYXJnczE4Lmxlbmd0aCA+IDEgJiYgX2FyZ3MxOFsxXSAhPT0gdW5kZWZpbmVkID8gX2FyZ3MxOFsxXSA6IHt9OwogICAgICAgICAgICAgICAgaXNsb2FkaW5nID0gX2FyZ3MxOC5sZW5ndGggPiAyID8gX2FyZ3MxOFsyXSA6IHVuZGVmaW5lZDsKICAgICAgICAgICAgICAgIHRlbXBEYXRhID0gSlNPTi5wYXJzZShKU09OLnN0cmluZ2lmeShkYXRhKSk7CiAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQxOC5hYnJ1cHQoInJldHVybiIsIEh0dHAuZ2V0SW5zdGFuY2UoKS5nZXQoIi9vcm1vcmdzL2ZldGNoY3VyY2hpbGQiLCB0ZW1wRGF0YSwgaXNsb2FkaW5nKSk7CgogICAgICAgICAgICAgIGNhc2UgNToKICAgICAgICAgICAgICBjYXNlICJlbmQiOgogICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0MTguc3RvcCgpOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSwgX2NhbGxlZTE4KTsKICAgICAgfSkpOwoKICAgICAgZnVuY3Rpb24gRmV0Y2hDdXJDaGlsZCgpIHsKICAgICAgICByZXR1cm4gX0ZldGNoQ3VyQ2hpbGQuYXBwbHkodGhpcywgYXJndW1lbnRzKTsKICAgICAgfQoKICAgICAgcmV0dXJuIEZldGNoQ3VyQ2hpbGQ7CiAgICB9KCkKICAgIC8qKg0KICAgICAqIEZldGNoU0pZWFpa5o6l5Y+j5pa55rOVDQogICAgICoNCiAgICAgKiBAcGFyYW0geyp9IFtjb250ZXh0PXt9XQ0KICAgICAqIEBwYXJhbSB7Kn0gW2RhdGE9e31dDQogICAgICogQHBhcmFtIHtib29sZWFufSBbaXNsb2FkaW5nXQ0KICAgICAqIEByZXR1cm5zIHtQcm9taXNlPGFueT59DQogICAgICogQG1lbWJlcm9mIE9ybU9yZ1NlcnZpY2VCYXNlDQogICAgICovCgogIH0sIHsKICAgIGtleTogIkZldGNoU0pZWFpaIiwKICAgIHZhbHVlOiBmdW5jdGlvbiAoKSB7CiAgICAgIHZhciBfRmV0Y2hTSllYWlogPSBfYXN5bmNUb0dlbmVyYXRvcigKICAgICAgLyojX19QVVJFX18qLwogICAgICByZWdlbmVyYXRvclJ1bnRpbWUubWFyayhmdW5jdGlvbiBfY2FsbGVlMTkoKSB7CiAgICAgICAgdmFyIGNvbnRleHQsCiAgICAgICAgICAgIGRhdGEsCiAgICAgICAgICAgIGlzbG9hZGluZywKICAgICAgICAgICAgdGVtcERhdGEsCiAgICAgICAgICAgIF9hcmdzMTkgPSBhcmd1bWVudHM7CiAgICAgICAgcmV0dXJuIHJlZ2VuZXJhdG9yUnVudGltZS53cmFwKGZ1bmN0aW9uIF9jYWxsZWUxOSQoX2NvbnRleHQxOSkgewogICAgICAgICAgd2hpbGUgKDEpIHsKICAgICAgICAgICAgc3dpdGNoIChfY29udGV4dDE5LnByZXYgPSBfY29udGV4dDE5Lm5leHQpIHsKICAgICAgICAgICAgICBjYXNlIDA6CiAgICAgICAgICAgICAgICBjb250ZXh0ID0gX2FyZ3MxOS5sZW5ndGggPiAwICYmIF9hcmdzMTlbMF0gIT09IHVuZGVmaW5lZCA/IF9hcmdzMTlbMF0gOiB7fTsKICAgICAgICAgICAgICAgIGRhdGEgPSBfYXJnczE5Lmxlbmd0aCA+IDEgJiYgX2FyZ3MxOVsxXSAhPT0gdW5kZWZpbmVkID8gX2FyZ3MxOVsxXSA6IHt9OwogICAgICAgICAgICAgICAgaXNsb2FkaW5nID0gX2FyZ3MxOS5sZW5ndGggPiAyID8gX2FyZ3MxOVsyXSA6IHVuZGVmaW5lZDsKICAgICAgICAgICAgICAgIHRlbXBEYXRhID0gSlNPTi5wYXJzZShKU09OLnN0cmluZ2lmeShkYXRhKSk7CiAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQxOS5hYnJ1cHQoInJldHVybiIsIEh0dHAuZ2V0SW5zdGFuY2UoKS5nZXQoIi9vcm1vcmdzL2ZldGNoc2p5eHp6IiwgdGVtcERhdGEsIGlzbG9hZGluZykpOwoKICAgICAgICAgICAgICBjYXNlIDU6CiAgICAgICAgICAgICAgY2FzZSAiZW5kIjoKICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDE5LnN0b3AoKTsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0sIF9jYWxsZWUxOSk7CiAgICAgIH0pKTsKCiAgICAgIGZ1bmN0aW9uIEZldGNoU0pZWFpaKCkgewogICAgICAgIHJldHVybiBfRmV0Y2hTSllYWlouYXBwbHkodGhpcywgYXJndW1lbnRzKTsKICAgICAgfQoKICAgICAgcmV0dXJuIEZldGNoU0pZWFpaOwogICAgfSgpCiAgICAvKioNCiAgICAgKiBGZXRjaFJFUF9PUkdQTlVN5o6l5Y+j5pa55rOVDQogICAgICoNCiAgICAgKiBAcGFyYW0geyp9IFtjb250ZXh0PXt9XQ0KICAgICAqIEBwYXJhbSB7Kn0gW2RhdGE9e31dDQogICAgICogQHBhcmFtIHtib29sZWFufSBbaXNsb2FkaW5nXQ0KICAgICAqIEByZXR1cm5zIHtQcm9taXNlPGFueT59DQogICAgICogQG1lbWJlcm9mIE9ybU9yZ1NlcnZpY2VCYXNlDQogICAgICovCgogIH0sIHsKICAgIGtleTogIkZldGNoUkVQX09SR1BOVU0iLAogICAgdmFsdWU6IGZ1bmN0aW9uICgpIHsKICAgICAgdmFyIF9GZXRjaFJFUF9PUkdQTlVNID0gX2FzeW5jVG9HZW5lcmF0b3IoCiAgICAgIC8qI19fUFVSRV9fKi8KICAgICAgcmVnZW5lcmF0b3JSdW50aW1lLm1hcmsoZnVuY3Rpb24gX2NhbGxlZTIwKCkgewogICAgICAgIHZhciBjb250ZXh0LAogICAgICAgICAgICBkYXRhLAogICAgICAgICAgICBpc2xvYWRpbmcsCiAgICAgICAgICAgIHRlbXBEYXRhLAogICAgICAgICAgICBfYXJnczIwID0gYXJndW1lbnRzOwogICAgICAgIHJldHVybiByZWdlbmVyYXRvclJ1bnRpbWUud3JhcChmdW5jdGlvbiBfY2FsbGVlMjAkKF9jb250ZXh0MjApIHsKICAgICAgICAgIHdoaWxlICgxKSB7CiAgICAgICAgICAgIHN3aXRjaCAoX2NvbnRleHQyMC5wcmV2ID0gX2NvbnRleHQyMC5uZXh0KSB7CiAgICAgICAgICAgICAgY2FzZSAwOgogICAgICAgICAgICAgICAgY29udGV4dCA9IF9hcmdzMjAubGVuZ3RoID4gMCAmJiBfYXJnczIwWzBdICE9PSB1bmRlZmluZWQgPyBfYXJnczIwWzBdIDoge307CiAgICAgICAgICAgICAgICBkYXRhID0gX2FyZ3MyMC5sZW5ndGggPiAxICYmIF9hcmdzMjBbMV0gIT09IHVuZGVmaW5lZCA/IF9hcmdzMjBbMV0gOiB7fTsKICAgICAgICAgICAgICAgIGlzbG9hZGluZyA9IF9hcmdzMjAubGVuZ3RoID4gMiA/IF9hcmdzMjBbMl0gOiB1bmRlZmluZWQ7CiAgICAgICAgICAgICAgICB0ZW1wRGF0YSA9IEpTT04ucGFyc2UoSlNPTi5zdHJpbmdpZnkoZGF0YSkpOwogICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0MjAuYWJydXB0KCJyZXR1cm4iLCBIdHRwLmdldEluc3RhbmNlKCkuZ2V0KCIvb3Jtb3Jncy9mZXRjaHJlcF9vcmdwbnVtIiwgdGVtcERhdGEsIGlzbG9hZGluZykpOwoKICAgICAgICAgICAgICBjYXNlIDU6CiAgICAgICAgICAgICAgY2FzZSAiZW5kIjoKICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDIwLnN0b3AoKTsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0sIF9jYWxsZWUyMCk7CiAgICAgIH0pKTsKCiAgICAgIGZ1bmN0aW9uIEZldGNoUkVQX09SR1BOVU0oKSB7CiAgICAgICAgcmV0dXJuIF9GZXRjaFJFUF9PUkdQTlVNLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7CiAgICAgIH0KCiAgICAgIHJldHVybiBGZXRjaFJFUF9PUkdQTlVNOwogICAgfSgpCiAgICAvKioNCiAgICAgKiBGZXRjaEtaU0paWlha5o6l5Y+j5pa55rOVDQogICAgICoNCiAgICAgKiBAcGFyYW0geyp9IFtjb250ZXh0PXt9XQ0KICAgICAqIEBwYXJhbSB7Kn0gW2RhdGE9e31dDQogICAgICogQHBhcmFtIHtib29sZWFufSBbaXNsb2FkaW5nXQ0KICAgICAqIEByZXR1cm5zIHtQcm9taXNlPGFueT59DQogICAgICogQG1lbWJlcm9mIE9ybU9yZ1NlcnZpY2VCYXNlDQogICAgICovCgogIH0sIHsKICAgIGtleTogIkZldGNoS1pTSlpaWFoiLAogICAgdmFsdWU6IGZ1bmN0aW9uICgpIHsKICAgICAgdmFyIF9GZXRjaEtaU0paWlhaID0gX2FzeW5jVG9HZW5lcmF0b3IoCiAgICAgIC8qI19fUFVSRV9fKi8KICAgICAgcmVnZW5lcmF0b3JSdW50aW1lLm1hcmsoZnVuY3Rpb24gX2NhbGxlZTIxKCkgewogICAgICAgIHZhciBjb250ZXh0LAogICAgICAgICAgICBkYXRhLAogICAgICAgICAgICBpc2xvYWRpbmcsCiAgICAgICAgICAgIHRlbXBEYXRhLAogICAgICAgICAgICBfYXJnczIxID0gYXJndW1lbnRzOwogICAgICAgIHJldHVybiByZWdlbmVyYXRvclJ1bnRpbWUud3JhcChmdW5jdGlvbiBfY2FsbGVlMjEkKF9jb250ZXh0MjEpIHsKICAgICAgICAgIHdoaWxlICgxKSB7CiAgICAgICAgICAgIHN3aXRjaCAoX2NvbnRleHQyMS5wcmV2ID0gX2NvbnRleHQyMS5uZXh0KSB7CiAgICAgICAgICAgICAgY2FzZSAwOgogICAgICAgICAgICAgICAgY29udGV4dCA9IF9hcmdzMjEubGVuZ3RoID4gMCAmJiBfYXJnczIxWzBdICE9PSB1bmRlZmluZWQgPyBfYXJnczIxWzBdIDoge307CiAgICAgICAgICAgICAgICBkYXRhID0gX2FyZ3MyMS5sZW5ndGggPiAxICYmIF9hcmdzMjFbMV0gIT09IHVuZGVmaW5lZCA/IF9hcmdzMjFbMV0gOiB7fTsKICAgICAgICAgICAgICAgIGlzbG9hZGluZyA9IF9hcmdzMjEubGVuZ3RoID4gMiA/IF9hcmdzMjFbMl0gOiB1bmRlZmluZWQ7CiAgICAgICAgICAgICAgICB0ZW1wRGF0YSA9IEpTT04ucGFyc2UoSlNPTi5zdHJpbmdpZnkoZGF0YSkpOwogICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0MjEuYWJydXB0KCJyZXR1cm4iLCBIdHRwLmdldEluc3RhbmNlKCkuZ2V0KCIvb3Jtb3Jncy9mZXRjaGt6c2p6enh6IiwgdGVtcERhdGEsIGlzbG9hZGluZykpOwoKICAgICAgICAgICAgICBjYXNlIDU6CiAgICAgICAgICAgICAgY2FzZSAiZW5kIjoKICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDIxLnN0b3AoKTsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0sIF9jYWxsZWUyMSk7CiAgICAgIH0pKTsKCiAgICAgIGZ1bmN0aW9uIEZldGNoS1pTSlpaWFooKSB7CiAgICAgICAgcmV0dXJuIF9GZXRjaEtaU0paWlhaLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7CiAgICAgIH0KCiAgICAgIHJldHVybiBGZXRjaEtaU0paWlhaOwogICAgfSgpCiAgICAvKioNCiAgICAgKiBGZXRjaERhblFpYW7mjqXlj6Pmlrnms5UNCiAgICAgKg0KICAgICAqIEBwYXJhbSB7Kn0gW2NvbnRleHQ9e31dDQogICAgICogQHBhcmFtIHsqfSBbZGF0YT17fV0NCiAgICAgKiBAcGFyYW0ge2Jvb2xlYW59IFtpc2xvYWRpbmddDQogICAgICogQHJldHVybnMge1Byb21pc2U8YW55Pn0NCiAgICAgKiBAbWVtYmVyb2YgT3JtT3JnU2VydmljZUJhc2UNCiAgICAgKi8KCiAgfSwgewogICAga2V5OiAiRmV0Y2hEYW5RaWFuIiwKICAgIHZhbHVlOiBmdW5jdGlvbiAoKSB7CiAgICAgIHZhciBfRmV0Y2hEYW5RaWFuID0gX2FzeW5jVG9HZW5lcmF0b3IoCiAgICAgIC8qI19fUFVSRV9fKi8KICAgICAgcmVnZW5lcmF0b3JSdW50aW1lLm1hcmsoZnVuY3Rpb24gX2NhbGxlZTIyKCkgewogICAgICAgIHZhciBjb250ZXh0LAogICAgICAgICAgICBkYXRhLAogICAgICAgICAgICBpc2xvYWRpbmcsCiAgICAgICAgICAgIHRlbXBEYXRhLAogICAgICAgICAgICBfYXJnczIyID0gYXJndW1lbnRzOwogICAgICAgIHJldHVybiByZWdlbmVyYXRvclJ1bnRpbWUud3JhcChmdW5jdGlvbiBfY2FsbGVlMjIkKF9jb250ZXh0MjIpIHsKICAgICAgICAgIHdoaWxlICgxKSB7CiAgICAgICAgICAgIHN3aXRjaCAoX2NvbnRleHQyMi5wcmV2ID0gX2NvbnRleHQyMi5uZXh0KSB7CiAgICAgICAgICAgICAgY2FzZSAwOgogICAgICAgICAgICAgICAgY29udGV4dCA9IF9hcmdzMjIubGVuZ3RoID4gMCAmJiBfYXJnczIyWzBdICE9PSB1bmRlZmluZWQgPyBfYXJnczIyWzBdIDoge307CiAgICAgICAgICAgICAgICBkYXRhID0gX2FyZ3MyMi5sZW5ndGggPiAxICYmIF9hcmdzMjJbMV0gIT09IHVuZGVmaW5lZCA/IF9hcmdzMjJbMV0gOiB7fTsKICAgICAgICAgICAgICAgIGlzbG9hZGluZyA9IF9hcmdzMjIubGVuZ3RoID4gMiA/IF9hcmdzMjJbMl0gOiB1bmRlZmluZWQ7CiAgICAgICAgICAgICAgICB0ZW1wRGF0YSA9IEpTT04ucGFyc2UoSlNPTi5zdHJpbmdpZnkoZGF0YSkpOwogICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0MjIuYWJydXB0KCJyZXR1cm4iLCBIdHRwLmdldEluc3RhbmNlKCkuZ2V0KCIvb3Jtb3Jncy9mZXRjaGRhbnFpYW4iLCB0ZW1wRGF0YSwgaXNsb2FkaW5nKSk7CgogICAgICAgICAgICAgIGNhc2UgNToKICAgICAgICAgICAgICBjYXNlICJlbmQiOgogICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0MjIuc3RvcCgpOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSwgX2NhbGxlZTIyKTsKICAgICAgfSkpOwoKICAgICAgZnVuY3Rpb24gRmV0Y2hEYW5RaWFuKCkgewogICAgICAgIHJldHVybiBfRmV0Y2hEYW5RaWFuLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7CiAgICAgIH0KCiAgICAgIHJldHVybiBGZXRjaERhblFpYW47CiAgICB9KCkKICAgIC8qKg0KICAgICAqIEZldGNoQWxsTGV2ZWxUd29PcmfmjqXlj6Pmlrnms5UNCiAgICAgKg0KICAgICAqIEBwYXJhbSB7Kn0gW2NvbnRleHQ9e31dDQogICAgICogQHBhcmFtIHsqfSBbZGF0YT17fV0NCiAgICAgKiBAcGFyYW0ge2Jvb2xlYW59IFtpc2xvYWRpbmddDQogICAgICogQHJldHVybnMge1Byb21pc2U8YW55Pn0NCiAgICAgKiBAbWVtYmVyb2YgT3JtT3JnU2VydmljZUJhc2UNCiAgICAgKi8KCiAgfSwgewogICAga2V5OiAiRmV0Y2hBbGxMZXZlbFR3b09yZyIsCiAgICB2YWx1ZTogZnVuY3Rpb24gKCkgewogICAgICB2YXIgX0ZldGNoQWxsTGV2ZWxUd29PcmcyID0gX2FzeW5jVG9HZW5lcmF0b3IoCiAgICAgIC8qI19fUFVSRV9fKi8KICAgICAgcmVnZW5lcmF0b3JSdW50aW1lLm1hcmsoZnVuY3Rpb24gX2NhbGxlZTIzKCkgewogICAgICAgIHZhciBjb250ZXh0LAogICAgICAgICAgICBkYXRhLAogICAgICAgICAgICBpc2xvYWRpbmcsCiAgICAgICAgICAgIHRlbXBEYXRhLAogICAgICAgICAgICBfYXJnczIzID0gYXJndW1lbnRzOwogICAgICAgIHJldHVybiByZWdlbmVyYXRvclJ1bnRpbWUud3JhcChmdW5jdGlvbiBfY2FsbGVlMjMkKF9jb250ZXh0MjMpIHsKICAgICAgICAgIHdoaWxlICgxKSB7CiAgICAgICAgICAgIHN3aXRjaCAoX2NvbnRleHQyMy5wcmV2ID0gX2NvbnRleHQyMy5uZXh0KSB7CiAgICAgICAgICAgICAgY2FzZSAwOgogICAgICAgICAgICAgICAgY29udGV4dCA9IF9hcmdzMjMubGVuZ3RoID4gMCAmJiBfYXJnczIzWzBdICE9PSB1bmRlZmluZWQgPyBfYXJnczIzWzBdIDoge307CiAgICAgICAgICAgICAgICBkYXRhID0gX2FyZ3MyMy5sZW5ndGggPiAxICYmIF9hcmdzMjNbMV0gIT09IHVuZGVmaW5lZCA/IF9hcmdzMjNbMV0gOiB7fTsKICAgICAgICAgICAgICAgIGlzbG9hZGluZyA9IF9hcmdzMjMubGVuZ3RoID4gMiA/IF9hcmdzMjNbMl0gOiB1bmRlZmluZWQ7CiAgICAgICAgICAgICAgICB0ZW1wRGF0YSA9IEpTT04ucGFyc2UoSlNPTi5zdHJpbmdpZnkoZGF0YSkpOwogICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0MjMuYWJydXB0KCJyZXR1cm4iLCBIdHRwLmdldEluc3RhbmNlKCkuZ2V0KCIvb3Jtb3Jncy9mZXRjaGFsbGxldmVsdHdvb3JnIiwgdGVtcERhdGEsIGlzbG9hZGluZykpOwoKICAgICAgICAgICAgICBjYXNlIDU6CiAgICAgICAgICAgICAgY2FzZSAiZW5kIjoKICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDIzLnN0b3AoKTsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0sIF9jYWxsZWUyMyk7CiAgICAgIH0pKTsKCiAgICAgIGZ1bmN0aW9uIEZldGNoQWxsTGV2ZWxUd29PcmcoKSB7CiAgICAgICAgcmV0dXJuIF9GZXRjaEFsbExldmVsVHdvT3JnMi5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwogICAgICB9CgogICAgICByZXR1cm4gRmV0Y2hBbGxMZXZlbFR3b09yZzsKICAgIH0oKQogICAgLyoqDQogICAgICogRmV0Y2hTdWJPcmfmjqXlj6Pmlrnms5UNCiAgICAgKg0KICAgICAqIEBwYXJhbSB7Kn0gW2NvbnRleHQ9e31dDQogICAgICogQHBhcmFtIHsqfSBbZGF0YT17fV0NCiAgICAgKiBAcGFyYW0ge2Jvb2xlYW59IFtpc2xvYWRpbmddDQogICAgICogQHJldHVybnMge1Byb21pc2U8YW55Pn0NCiAgICAgKiBAbWVtYmVyb2YgT3JtT3JnU2VydmljZUJhc2UNCiAgICAgKi8KCiAgfSwgewogICAga2V5OiAiRmV0Y2hTdWJPcmciLAogICAgdmFsdWU6IGZ1bmN0aW9uICgpIHsKICAgICAgdmFyIF9GZXRjaFN1Yk9yZyA9IF9hc3luY1RvR2VuZXJhdG9yKAogICAgICAvKiNfX1BVUkVfXyovCiAgICAgIHJlZ2VuZXJhdG9yUnVudGltZS5tYXJrKGZ1bmN0aW9uIF9jYWxsZWUyNCgpIHsKICAgICAgICB2YXIgY29udGV4dCwKICAgICAgICAgICAgZGF0YSwKICAgICAgICAgICAgaXNsb2FkaW5nLAogICAgICAgICAgICB0ZW1wRGF0YSwKICAgICAgICAgICAgX2FyZ3MyNCA9IGFyZ3VtZW50czsKICAgICAgICByZXR1cm4gcmVnZW5lcmF0b3JSdW50aW1lLndyYXAoZnVuY3Rpb24gX2NhbGxlZTI0JChfY29udGV4dDI0KSB7CiAgICAgICAgICB3aGlsZSAoMSkgewogICAgICAgICAgICBzd2l0Y2ggKF9jb250ZXh0MjQucHJldiA9IF9jb250ZXh0MjQubmV4dCkgewogICAgICAgICAgICAgIGNhc2UgMDoKICAgICAgICAgICAgICAgIGNvbnRleHQgPSBfYXJnczI0Lmxlbmd0aCA+IDAgJiYgX2FyZ3MyNFswXSAhPT0gdW5kZWZpbmVkID8gX2FyZ3MyNFswXSA6IHt9OwogICAgICAgICAgICAgICAgZGF0YSA9IF9hcmdzMjQubGVuZ3RoID4gMSAmJiBfYXJnczI0WzFdICE9PSB1bmRlZmluZWQgPyBfYXJnczI0WzFdIDoge307CiAgICAgICAgICAgICAgICBpc2xvYWRpbmcgPSBfYXJnczI0Lmxlbmd0aCA+IDIgPyBfYXJnczI0WzJdIDogdW5kZWZpbmVkOwogICAgICAgICAgICAgICAgdGVtcERhdGEgPSBKU09OLnBhcnNlKEpTT04uc3RyaW5naWZ5KGRhdGEpKTsKICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDI0LmFicnVwdCgicmV0dXJuIiwgSHR0cC5nZXRJbnN0YW5jZSgpLmdldCgiL29ybW9yZ3MvZmV0Y2hzdWJvcmciLCB0ZW1wRGF0YSwgaXNsb2FkaW5nKSk7CgogICAgICAgICAgICAgIGNhc2UgNToKICAgICAgICAgICAgICBjYXNlICJlbmQiOgogICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0MjQuc3RvcCgpOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSwgX2NhbGxlZTI0KTsKICAgICAgfSkpOwoKICAgICAgZnVuY3Rpb24gRmV0Y2hTdWJPcmcoKSB7CiAgICAgICAgcmV0dXJuIF9GZXRjaFN1Yk9yZy5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwogICAgICB9CgogICAgICByZXR1cm4gRmV0Y2hTdWJPcmc7CiAgICB9KCkKICAgIC8qKg0KICAgICAqIEZldGNoSFRHTERX5o6l5Y+j5pa55rOVDQogICAgICoNCiAgICAgKiBAcGFyYW0geyp9IFtjb250ZXh0PXt9XQ0KICAgICAqIEBwYXJhbSB7Kn0gW2RhdGE9e31dDQogICAgICogQHBhcmFtIHtib29sZWFufSBbaXNsb2FkaW5nXQ0KICAgICAqIEByZXR1cm5zIHtQcm9taXNlPGFueT59DQogICAgICogQG1lbWJlcm9mIE9ybU9yZ1NlcnZpY2VCYXNlDQogICAgICovCgogIH0sIHsKICAgIGtleTogIkZldGNoSFRHTERXIiwKICAgIHZhbHVlOiBmdW5jdGlvbiAoKSB7CiAgICAgIHZhciBfRmV0Y2hIVEdMRFcgPSBfYXN5bmNUb0dlbmVyYXRvcigKICAgICAgLyojX19QVVJFX18qLwogICAgICByZWdlbmVyYXRvclJ1bnRpbWUubWFyayhmdW5jdGlvbiBfY2FsbGVlMjUoKSB7CiAgICAgICAgdmFyIGNvbnRleHQsCiAgICAgICAgICAgIGRhdGEsCiAgICAgICAgICAgIGlzbG9hZGluZywKICAgICAgICAgICAgdGVtcERhdGEsCiAgICAgICAgICAgIF9hcmdzMjUgPSBhcmd1bWVudHM7CiAgICAgICAgcmV0dXJuIHJlZ2VuZXJhdG9yUnVudGltZS53cmFwKGZ1bmN0aW9uIF9jYWxsZWUyNSQoX2NvbnRleHQyNSkgewogICAgICAgICAgd2hpbGUgKDEpIHsKICAgICAgICAgICAgc3dpdGNoIChfY29udGV4dDI1LnByZXYgPSBfY29udGV4dDI1Lm5leHQpIHsKICAgICAgICAgICAgICBjYXNlIDA6CiAgICAgICAgICAgICAgICBjb250ZXh0ID0gX2FyZ3MyNS5sZW5ndGggPiAwICYmIF9hcmdzMjVbMF0gIT09IHVuZGVmaW5lZCA/IF9hcmdzMjVbMF0gOiB7fTsKICAgICAgICAgICAgICAgIGRhdGEgPSBfYXJnczI1Lmxlbmd0aCA+IDEgJiYgX2FyZ3MyNVsxXSAhPT0gdW5kZWZpbmVkID8gX2FyZ3MyNVsxXSA6IHt9OwogICAgICAgICAgICAgICAgaXNsb2FkaW5nID0gX2FyZ3MyNS5sZW5ndGggPiAyID8gX2FyZ3MyNVsyXSA6IHVuZGVmaW5lZDsKICAgICAgICAgICAgICAgIHRlbXBEYXRhID0gSlNPTi5wYXJzZShKU09OLnN0cmluZ2lmeShkYXRhKSk7CiAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQyNS5hYnJ1cHQoInJldHVybiIsIEh0dHAuZ2V0SW5zdGFuY2UoKS5nZXQoIi9vcm1vcmdzL2ZldGNoaHRnbGR3IiwgdGVtcERhdGEsIGlzbG9hZGluZykpOwoKICAgICAgICAgICAgICBjYXNlIDU6CiAgICAgICAgICAgICAgY2FzZSAiZW5kIjoKICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDI1LnN0b3AoKTsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0sIF9jYWxsZWUyNSk7CiAgICAgIH0pKTsKCiAgICAgIGZ1bmN0aW9uIEZldGNoSFRHTERXKCkgewogICAgICAgIHJldHVybiBfRmV0Y2hIVEdMRFcuYXBwbHkodGhpcywgYXJndW1lbnRzKTsKICAgICAgfQoKICAgICAgcmV0dXJuIEZldGNoSFRHTERXOwogICAgfSgpCiAgICAvKioNCiAgICAgKiBGZXRjaEtaWExYWuaOpeWPo+aWueazlQ0KICAgICAqDQogICAgICogQHBhcmFtIHsqfSBbY29udGV4dD17fV0NCiAgICAgKiBAcGFyYW0geyp9IFtkYXRhPXt9XQ0KICAgICAqIEBwYXJhbSB7Ym9vbGVhbn0gW2lzbG9hZGluZ10NCiAgICAgKiBAcmV0dXJucyB7UHJvbWlzZTxhbnk+fQ0KICAgICAqIEBtZW1iZXJvZiBPcm1PcmdTZXJ2aWNlQmFzZQ0KICAgICAqLwoKICB9LCB7CiAgICBrZXk6ICJGZXRjaEtaWExYWiIsCiAgICB2YWx1ZTogZnVuY3Rpb24gKCkgewogICAgICB2YXIgX0ZldGNoS1pYTFhaID0gX2FzeW5jVG9HZW5lcmF0b3IoCiAgICAgIC8qI19fUFVSRV9fKi8KICAgICAgcmVnZW5lcmF0b3JSdW50aW1lLm1hcmsoZnVuY3Rpb24gX2NhbGxlZTI2KCkgewogICAgICAgIHZhciBjb250ZXh0LAogICAgICAgICAgICBkYXRhLAogICAgICAgICAgICBpc2xvYWRpbmcsCiAgICAgICAgICAgIHRlbXBEYXRhLAogICAgICAgICAgICBfYXJnczI2ID0gYXJndW1lbnRzOwogICAgICAgIHJldHVybiByZWdlbmVyYXRvclJ1bnRpbWUud3JhcChmdW5jdGlvbiBfY2FsbGVlMjYkKF9jb250ZXh0MjYpIHsKICAgICAgICAgIHdoaWxlICgxKSB7CiAgICAgICAgICAgIHN3aXRjaCAoX2NvbnRleHQyNi5wcmV2ID0gX2NvbnRleHQyNi5uZXh0KSB7CiAgICAgICAgICAgICAgY2FzZSAwOgogICAgICAgICAgICAgICAgY29udGV4dCA9IF9hcmdzMjYubGVuZ3RoID4gMCAmJiBfYXJnczI2WzBdICE9PSB1bmRlZmluZWQgPyBfYXJnczI2WzBdIDoge307CiAgICAgICAgICAgICAgICBkYXRhID0gX2FyZ3MyNi5sZW5ndGggPiAxICYmIF9hcmdzMjZbMV0gIT09IHVuZGVmaW5lZCA/IF9hcmdzMjZbMV0gOiB7fTsKICAgICAgICAgICAgICAgIGlzbG9hZGluZyA9IF9hcmdzMjYubGVuZ3RoID4gMiA/IF9hcmdzMjZbMl0gOiB1bmRlZmluZWQ7CiAgICAgICAgICAgICAgICB0ZW1wRGF0YSA9IEpTT04ucGFyc2UoSlNPTi5zdHJpbmdpZnkoZGF0YSkpOwogICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0MjYuYWJydXB0KCJyZXR1cm4iLCBIdHRwLmdldEluc3RhbmNlKCkuZ2V0KCIvb3Jtb3Jncy9mZXRjaGt6eGx4eiIsIHRlbXBEYXRhLCBpc2xvYWRpbmcpKTsKCiAgICAgICAgICAgICAgY2FzZSA1OgogICAgICAgICAgICAgIGNhc2UgImVuZCI6CiAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQyNi5zdG9wKCk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9LCBfY2FsbGVlMjYpOwogICAgICB9KSk7CgogICAgICBmdW5jdGlvbiBGZXRjaEtaWExYWigpIHsKICAgICAgICByZXR1cm4gX0ZldGNoS1pYTFhaLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7CiAgICAgIH0KCiAgICAgIHJldHVybiBGZXRjaEtaWExYWjsKICAgIH0oKQogICAgLyoqDQogICAgICogRmV0Y2hBdXRoU0pZWFpa5o6l5Y+j5pa55rOVDQogICAgICoNCiAgICAgKiBAcGFyYW0geyp9IFtjb250ZXh0PXt9XQ0KICAgICAqIEBwYXJhbSB7Kn0gW2RhdGE9e31dDQogICAgICogQHBhcmFtIHtib29sZWFufSBbaXNsb2FkaW5nXQ0KICAgICAqIEByZXR1cm5zIHtQcm9taXNlPGFueT59DQogICAgICogQG1lbWJlcm9mIE9ybU9yZ1NlcnZpY2VCYXNlDQogICAgICovCgogIH0sIHsKICAgIGtleTogIkZldGNoQXV0aFNKWVhaWiIsCiAgICB2YWx1ZTogZnVuY3Rpb24gKCkgewogICAgICB2YXIgX0ZldGNoQXV0aFNKWVhaWiA9IF9hc3luY1RvR2VuZXJhdG9yKAogICAgICAvKiNfX1BVUkVfXyovCiAgICAgIHJlZ2VuZXJhdG9yUnVudGltZS5tYXJrKGZ1bmN0aW9uIF9jYWxsZWUyNygpIHsKICAgICAgICB2YXIgY29udGV4dCwKICAgICAgICAgICAgZGF0YSwKICAgICAgICAgICAgaXNsb2FkaW5nLAogICAgICAgICAgICB0ZW1wRGF0YSwKICAgICAgICAgICAgX2FyZ3MyNyA9IGFyZ3VtZW50czsKICAgICAgICByZXR1cm4gcmVnZW5lcmF0b3JSdW50aW1lLndyYXAoZnVuY3Rpb24gX2NhbGxlZTI3JChfY29udGV4dDI3KSB7CiAgICAgICAgICB3aGlsZSAoMSkgewogICAgICAgICAgICBzd2l0Y2ggKF9jb250ZXh0MjcucHJldiA9IF9jb250ZXh0MjcubmV4dCkgewogICAgICAgICAgICAgIGNhc2UgMDoKICAgICAgICAgICAgICAgIGNvbnRleHQgPSBfYXJnczI3Lmxlbmd0aCA+IDAgJiYgX2FyZ3MyN1swXSAhPT0gdW5kZWZpbmVkID8gX2FyZ3MyN1swXSA6IHt9OwogICAgICAgICAgICAgICAgZGF0YSA9IF9hcmdzMjcubGVuZ3RoID4gMSAmJiBfYXJnczI3WzFdICE9PSB1bmRlZmluZWQgPyBfYXJnczI3WzFdIDoge307CiAgICAgICAgICAgICAgICBpc2xvYWRpbmcgPSBfYXJnczI3Lmxlbmd0aCA+IDIgPyBfYXJnczI3WzJdIDogdW5kZWZpbmVkOwogICAgICAgICAgICAgICAgdGVtcERhdGEgPSBKU09OLnBhcnNlKEpTT04uc3RyaW5naWZ5KGRhdGEpKTsKICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDI3LmFicnVwdCgicmV0dXJuIiwgSHR0cC5nZXRJbnN0YW5jZSgpLmdldCgiL29ybW9yZ3MvZmV0Y2hhdXRoc2p5eHp6IiwgdGVtcERhdGEsIGlzbG9hZGluZykpOwoKICAgICAgICAgICAgICBjYXNlIDU6CiAgICAgICAgICAgICAgY2FzZSAiZW5kIjoKICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDI3LnN0b3AoKTsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0sIF9jYWxsZWUyNyk7CiAgICAgIH0pKTsKCiAgICAgIGZ1bmN0aW9uIEZldGNoQXV0aFNKWVhaWigpIHsKICAgICAgICByZXR1cm4gX0ZldGNoQXV0aFNKWVhaWi5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwogICAgICB9CgogICAgICByZXR1cm4gRmV0Y2hBdXRoU0pZWFpaOwogICAgfSgpCiAgICAvKioNCiAgICAgKiBGZXRjaFVzZUJ5RlDmjqXlj6Pmlrnms5UNCiAgICAgKg0KICAgICAqIEBwYXJhbSB7Kn0gW2NvbnRleHQ9e31dDQogICAgICogQHBhcmFtIHsqfSBbZGF0YT17fV0NCiAgICAgKiBAcGFyYW0ge2Jvb2xlYW59IFtpc2xvYWRpbmddDQogICAgICogQHJldHVybnMge1Byb21pc2U8YW55Pn0NCiAgICAgKiBAbWVtYmVyb2YgT3JtT3JnU2VydmljZUJhc2UNCiAgICAgKi8KCiAgfSwgewogICAga2V5OiAiRmV0Y2hVc2VCeUZQIiwKICAgIHZhbHVlOiBmdW5jdGlvbiAoKSB7CiAgICAgIHZhciBfRmV0Y2hVc2VCeUZQID0gX2FzeW5jVG9HZW5lcmF0b3IoCiAgICAgIC8qI19fUFVSRV9fKi8KICAgICAgcmVnZW5lcmF0b3JSdW50aW1lLm1hcmsoZnVuY3Rpb24gX2NhbGxlZTI4KCkgewogICAgICAgIHZhciBjb250ZXh0LAogICAgICAgICAgICBkYXRhLAogICAgICAgICAgICBpc2xvYWRpbmcsCiAgICAgICAgICAgIHRlbXBEYXRhLAogICAgICAgICAgICBfYXJnczI4ID0gYXJndW1lbnRzOwogICAgICAgIHJldHVybiByZWdlbmVyYXRvclJ1bnRpbWUud3JhcChmdW5jdGlvbiBfY2FsbGVlMjgkKF9jb250ZXh0MjgpIHsKICAgICAgICAgIHdoaWxlICgxKSB7CiAgICAgICAgICAgIHN3aXRjaCAoX2NvbnRleHQyOC5wcmV2ID0gX2NvbnRleHQyOC5uZXh0KSB7CiAgICAgICAgICAgICAgY2FzZSAwOgogICAgICAgICAgICAgICAgY29udGV4dCA9IF9hcmdzMjgubGVuZ3RoID4gMCAmJiBfYXJnczI4WzBdICE9PSB1bmRlZmluZWQgPyBfYXJnczI4WzBdIDoge307CiAgICAgICAgICAgICAgICBkYXRhID0gX2FyZ3MyOC5sZW5ndGggPiAxICYmIF9hcmdzMjhbMV0gIT09IHVuZGVmaW5lZCA/IF9hcmdzMjhbMV0gOiB7fTsKICAgICAgICAgICAgICAgIGlzbG9hZGluZyA9IF9hcmdzMjgubGVuZ3RoID4gMiA/IF9hcmdzMjhbMl0gOiB1bmRlZmluZWQ7CiAgICAgICAgICAgICAgICB0ZW1wRGF0YSA9IEpTT04ucGFyc2UoSlNPTi5zdHJpbmdpZnkoZGF0YSkpOwogICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0MjguYWJydXB0KCJyZXR1cm4iLCBIdHRwLmdldEluc3RhbmNlKCkuZ2V0KCIvb3Jtb3Jncy9mZXRjaHVzZWJ5ZnAiLCB0ZW1wRGF0YSwgaXNsb2FkaW5nKSk7CgogICAgICAgICAgICAgIGNhc2UgNToKICAgICAgICAgICAgICBjYXNlICJlbmQiOgogICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0Mjguc3RvcCgpOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSwgX2NhbGxlZTI4KTsKICAgICAgfSkpOwoKICAgICAgZnVuY3Rpb24gRmV0Y2hVc2VCeUZQKCkgewogICAgICAgIHJldHVybiBfRmV0Y2hVc2VCeUZQLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7CiAgICAgIH0KCiAgICAgIHJldHVybiBGZXRjaFVzZUJ5RlA7CiAgICB9KCkKICAgIC8qKg0KICAgICAqIEZldGNoQ3VyUG9yZ+aOpeWPo+aWueazlQ0KICAgICAqDQogICAgICogQHBhcmFtIHsqfSBbY29udGV4dD17fV0NCiAgICAgKiBAcGFyYW0geyp9IFtkYXRhPXt9XQ0KICAgICAqIEBwYXJhbSB7Ym9vbGVhbn0gW2lzbG9hZGluZ10NCiAgICAgKiBAcmV0dXJucyB7UHJvbWlzZTxhbnk+fQ0KICAgICAqIEBtZW1iZXJvZiBPcm1PcmdTZXJ2aWNlQmFzZQ0KICAgICAqLwoKICB9LCB7CiAgICBrZXk6ICJGZXRjaEN1clBvcmciLAogICAgdmFsdWU6IGZ1bmN0aW9uICgpIHsKICAgICAgdmFyIF9GZXRjaEN1clBvcmcgPSBfYXN5bmNUb0dlbmVyYXRvcigKICAgICAgLyojX19QVVJFX18qLwogICAgICByZWdlbmVyYXRvclJ1bnRpbWUubWFyayhmdW5jdGlvbiBfY2FsbGVlMjkoKSB7CiAgICAgICAgdmFyIGNvbnRleHQsCiAgICAgICAgICAgIGRhdGEsCiAgICAgICAgICAgIGlzbG9hZGluZywKICAgICAgICAgICAgdGVtcERhdGEsCiAgICAgICAgICAgIF9hcmdzMjkgPSBhcmd1bWVudHM7CiAgICAgICAgcmV0dXJuIHJlZ2VuZXJhdG9yUnVudGltZS53cmFwKGZ1bmN0aW9uIF9jYWxsZWUyOSQoX2NvbnRleHQyOSkgewogICAgICAgICAgd2hpbGUgKDEpIHsKICAgICAgICAgICAgc3dpdGNoIChfY29udGV4dDI5LnByZXYgPSBfY29udGV4dDI5Lm5leHQpIHsKICAgICAgICAgICAgICBjYXNlIDA6CiAgICAgICAgICAgICAgICBjb250ZXh0ID0gX2FyZ3MyOS5sZW5ndGggPiAwICYmIF9hcmdzMjlbMF0gIT09IHVuZGVmaW5lZCA/IF9hcmdzMjlbMF0gOiB7fTsKICAgICAgICAgICAgICAgIGRhdGEgPSBfYXJnczI5Lmxlbmd0aCA+IDEgJiYgX2FyZ3MyOVsxXSAhPT0gdW5kZWZpbmVkID8gX2FyZ3MyOVsxXSA6IHt9OwogICAgICAgICAgICAgICAgaXNsb2FkaW5nID0gX2FyZ3MyOS5sZW5ndGggPiAyID8gX2FyZ3MyOVsyXSA6IHVuZGVmaW5lZDsKICAgICAgICAgICAgICAgIHRlbXBEYXRhID0gSlNPTi5wYXJzZShKU09OLnN0cmluZ2lmeShkYXRhKSk7CiAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQyOS5hYnJ1cHQoInJldHVybiIsIEh0dHAuZ2V0SW5zdGFuY2UoKS5nZXQoIi9vcm1vcmdzL2ZldGNoY3VycG9yZyIsIHRlbXBEYXRhLCBpc2xvYWRpbmcpKTsKCiAgICAgICAgICAgICAgY2FzZSA1OgogICAgICAgICAgICAgIGNhc2UgImVuZCI6CiAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQyOS5zdG9wKCk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9LCBfY2FsbGVlMjkpOwogICAgICB9KSk7CgogICAgICBmdW5jdGlvbiBGZXRjaEN1clBvcmcoKSB7CiAgICAgICAgcmV0dXJuIF9GZXRjaEN1clBvcmcuYXBwbHkodGhpcywgYXJndW1lbnRzKTsKICAgICAgfQoKICAgICAgcmV0dXJuIEZldGNoQ3VyUG9yZzsKICAgIH0oKQogIH1dKTsKCiAgcmV0dXJuIE9ybU9yZ1NlcnZpY2VCYXNlOwp9KEVudGl0eVNlcnZpY2UpOwoKZXhwb3J0IHsgT3JtT3JnU2VydmljZUJhc2UgYXMgZGVmYXVsdCB9Ow=="},null]}
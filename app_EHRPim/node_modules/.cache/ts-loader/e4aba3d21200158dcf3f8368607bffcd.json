{"remainingRequest":"F:\\crod项目\\人事管理系统2\\iBizEHR\\app_EHRPim\\node_modules\\thread-loader\\dist\\cjs.js!F:\\crod项目\\人事管理系统2\\iBizEHR\\app_EHRPim\\node_modules\\babel-loader\\lib\\index.js!F:\\crod项目\\人事管理系统2\\iBizEHR\\app_EHRPim\\node_modules\\ts-loader\\index.js??ref--14-3!F:\\crod项目\\人事管理系统2\\iBizEHR\\app_EHRPim\\node_modules\\cache-loader\\dist\\cjs.js??ref--0-0!F:\\crod项目\\人事管理系统2\\iBizEHR\\app_EHRPim\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!F:\\crod项目\\人事管理系统2\\iBizEHR\\app_EHRPim\\src\\widgets\\pim-archives-change\\main-2-grid\\main-2-grid-base.vue?vue&type=script&lang=tsx&","dependencies":[{"path":"F:\\crod项目\\人事管理系统2\\iBizEHR\\app_EHRPim\\src\\widgets\\pim-archives-change\\main-2-grid\\main-2-grid-base.vue","mtime":1630509411277},{"path":"F:\\crod项目\\人事管理系统2\\iBizEHR\\app_EHRPim\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1630511852775},{"path":"F:\\crod项目\\人事管理系统2\\iBizEHR\\app_EHRPim\\node_modules\\thread-loader\\dist\\cjs.js","mtime":1630511853252},{"path":"F:\\crod项目\\人事管理系统2\\iBizEHR\\app_EHRPim\\node_modules\\babel-loader\\lib\\index.js","mtime":1630511852747},{"path":"F:\\crod项目\\人事管理系统2\\iBizEHR\\app_EHRPim\\node_modules\\ts-loader\\index.js","mtime":1630511985412},{"path":"F:\\crod项目\\人事管理系统2\\iBizEHR\\app_EHRPim\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1630511852775},{"path":"F:\\crod项目\\人事管理系统2\\iBizEHR\\app_EHRPim\\node_modules\\vue-loader\\lib\\index.js","mtime":1630512070338}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:aW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuc3ltYm9sIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuc3ltYm9sLmRlc2NyaXB0aW9uIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuc3ltYm9sLml0ZXJhdG9yIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkuZmlsdGVyIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkuZmluZCI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLmFycmF5LmZpbmQtaW5kZXgiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5hcnJheS5mb3ItZWFjaCI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLmFycmF5LmpvaW4iOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5hcnJheS5tYXAiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5hcnJheS5zb21lIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkuc3BsaWNlIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuZnVuY3Rpb24ubmFtZSI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLm9iamVjdC5kZWZpbmUtcHJvcGVydGllcyI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLm9iamVjdC5kZWZpbmUtcHJvcGVydHkiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5vYmplY3QuZ2V0LW93bi1wcm9wZXJ0eS1kZXNjcmlwdG9yIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMub2JqZWN0LmdldC1vd24tcHJvcGVydHktZGVzY3JpcHRvcnMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5vYmplY3QuaXMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5vYmplY3Qua2V5cyI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLm9iamVjdC50by1zdHJpbmciOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5wYXJzZS1pbnQiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5yZWdleHAuZXhlYyI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLnN0cmluZy5pdGVyYXRvciI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLnN0cmluZy5yZXBsYWNlIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuc3RyaW5nLnNlYXJjaCI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLnN0cmluZy5zcGxpdCI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL3dlYi5kb20tY29sbGVjdGlvbnMuZm9yLWVhY2giOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy93ZWIuZG9tLWNvbGxlY3Rpb25zLml0ZXJhdG9yIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvd2ViLnRpbWVycyI7CmltcG9ydCBfdG9Db25zdW1hYmxlQXJyYXkgZnJvbSAiRjpcXGNyb2RcdTk4NzlcdTc2RUVcXFx1NEVCQVx1NEU4Qlx1N0JBMVx1NzQwNlx1N0NGQlx1N0VERjJcXGlCaXpFSFJcXGFwcF9FSFJQaW1cXG5vZGVfbW9kdWxlc1xcQGJhYmVsXFxydW50aW1lL2hlbHBlcnMvZXNtL3RvQ29uc3VtYWJsZUFycmF5IjsKaW1wb3J0IF9kZWZpbmVQcm9wZXJ0eSBmcm9tICJGOlxcY3JvZFx1OTg3OVx1NzZFRVxcXHU0RUJBXHU0RThCXHU3QkExXHU3NDA2XHU3Q0ZCXHU3RURGMlxcaUJpekVIUlxcYXBwX0VIUlBpbVxcbm9kZV9tb2R1bGVzXFxAYmFiZWxcXHJ1bnRpbWUvaGVscGVycy9lc20vZGVmaW5lUHJvcGVydHkiOwppbXBvcnQgInJlZ2VuZXJhdG9yLXJ1bnRpbWUvcnVudGltZSI7CmltcG9ydCBfYXN5bmNUb0dlbmVyYXRvciBmcm9tICJGOlxcY3JvZFx1OTg3OVx1NzZFRVxcXHU0RUJBXHU0RThCXHU3QkExXHU3NDA2XHU3Q0ZCXHU3RURGMlxcaUJpekVIUlxcYXBwX0VIUlBpbVxcbm9kZV9tb2R1bGVzXFxAYmFiZWxcXHJ1bnRpbWUvaGVscGVycy9lc20vYXN5bmNUb0dlbmVyYXRvciI7CmltcG9ydCBfY2xhc3NDYWxsQ2hlY2sgZnJvbSAiRjpcXGNyb2RcdTk4NzlcdTc2RUVcXFx1NEVCQVx1NEU4Qlx1N0JBMVx1NzQwNlx1N0NGQlx1N0VERjJcXGlCaXpFSFJcXGFwcF9FSFJQaW1cXG5vZGVfbW9kdWxlc1xcQGJhYmVsXFxydW50aW1lL2hlbHBlcnMvZXNtL2NsYXNzQ2FsbENoZWNrIjsKaW1wb3J0IF9jcmVhdGVDbGFzcyBmcm9tICJGOlxcY3JvZFx1OTg3OVx1NzZFRVxcXHU0RUJBXHU0RThCXHU3QkExXHU3NDA2XHU3Q0ZCXHU3RURGMlxcaUJpekVIUlxcYXBwX0VIUlBpbVxcbm9kZV9tb2R1bGVzXFxAYmFiZWxcXHJ1bnRpbWUvaGVscGVycy9lc20vY3JlYXRlQ2xhc3MiOwppbXBvcnQgX3Bvc3NpYmxlQ29uc3RydWN0b3JSZXR1cm4gZnJvbSAiRjpcXGNyb2RcdTk4NzlcdTc2RUVcXFx1NEVCQVx1NEU4Qlx1N0JBMVx1NzQwNlx1N0NGQlx1N0VERjJcXGlCaXpFSFJcXGFwcF9FSFJQaW1cXG5vZGVfbW9kdWxlc1xcQGJhYmVsXFxydW50aW1lL2hlbHBlcnMvZXNtL3Bvc3NpYmxlQ29uc3RydWN0b3JSZXR1cm4iOwppbXBvcnQgX2dldFByb3RvdHlwZU9mIGZyb20gIkY6XFxjcm9kXHU5ODc5XHU3NkVFXFxcdTRFQkFcdTRFOEJcdTdCQTFcdTc0MDZcdTdDRkJcdTdFREYyXFxpQml6RUhSXFxhcHBfRUhSUGltXFxub2RlX21vZHVsZXNcXEBiYWJlbFxccnVudGltZS9oZWxwZXJzL2VzbS9nZXRQcm90b3R5cGVPZiI7CmltcG9ydCBfaW5oZXJpdHMgZnJvbSAiRjpcXGNyb2RcdTk4NzlcdTc2RUVcXFx1NEVCQVx1NEU4Qlx1N0JBMVx1NzQwNlx1N0NGQlx1N0VERjJcXGlCaXpFSFJcXGFwcF9FSFJQaW1cXG5vZGVfbW9kdWxlc1xcQGJhYmVsXFxydW50aW1lL2hlbHBlcnMvZXNtL2luaGVyaXRzIjsKCmZ1bmN0aW9uIG93bktleXMob2JqZWN0LCBlbnVtZXJhYmxlT25seSkgeyB2YXIga2V5cyA9IE9iamVjdC5rZXlzKG9iamVjdCk7IGlmIChPYmplY3QuZ2V0T3duUHJvcGVydHlTeW1ib2xzKSB7IHZhciBzeW1ib2xzID0gT2JqZWN0LmdldE93blByb3BlcnR5U3ltYm9scyhvYmplY3QpOyBpZiAoZW51bWVyYWJsZU9ubHkpIHN5bWJvbHMgPSBzeW1ib2xzLmZpbHRlcihmdW5jdGlvbiAoc3ltKSB7IHJldHVybiBPYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yKG9iamVjdCwgc3ltKS5lbnVtZXJhYmxlOyB9KTsga2V5cy5wdXNoLmFwcGx5KGtleXMsIHN5bWJvbHMpOyB9IHJldHVybiBrZXlzOyB9CgpmdW5jdGlvbiBfb2JqZWN0U3ByZWFkKHRhcmdldCkgeyBmb3IgKHZhciBpID0gMTsgaSA8IGFyZ3VtZW50cy5sZW5ndGg7IGkrKykgeyB2YXIgc291cmNlID0gYXJndW1lbnRzW2ldICE9IG51bGwgPyBhcmd1bWVudHNbaV0gOiB7fTsgaWYgKGkgJSAyKSB7IG93bktleXMoT2JqZWN0KHNvdXJjZSksIHRydWUpLmZvckVhY2goZnVuY3Rpb24gKGtleSkgeyBfZGVmaW5lUHJvcGVydHkodGFyZ2V0LCBrZXksIHNvdXJjZVtrZXldKTsgfSk7IH0gZWxzZSBpZiAoT2JqZWN0LmdldE93blByb3BlcnR5RGVzY3JpcHRvcnMpIHsgT2JqZWN0LmRlZmluZVByb3BlcnRpZXModGFyZ2V0LCBPYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9ycyhzb3VyY2UpKTsgfSBlbHNlIHsgb3duS2V5cyhPYmplY3Qoc291cmNlKSkuZm9yRWFjaChmdW5jdGlvbiAoa2V5KSB7IE9iamVjdC5kZWZpbmVQcm9wZXJ0eSh0YXJnZXQsIGtleSwgT2JqZWN0LmdldE93blByb3BlcnR5RGVzY3JpcHRvcihzb3VyY2UsIGtleSkpOyB9KTsgfSB9IHJldHVybiB0YXJnZXQ7IH0KCmltcG9ydCAqIGFzIHRzbGliXzEgZnJvbSAidHNsaWIiOwppbXBvcnQgeyBWdWUsIENvbXBvbmVudCwgUHJvcCwgV2F0Y2ggfSBmcm9tICd2dWUtcHJvcGVydHktZGVjb3JhdG9yJzsKaW1wb3J0IFBpbUFyY2hpdmVzQ2hhbmdlU2VydmljZSBmcm9tICdAL3NlcnZpY2UvcGltLWFyY2hpdmVzLWNoYW5nZS9waW0tYXJjaGl2ZXMtY2hhbmdlLXNlcnZpY2UnOwppbXBvcnQgTWFpbl8yU2VydmljZSBmcm9tICcuL21haW4tMi1ncmlkLXNlcnZpY2UnOwppbXBvcnQgQ29kZUxpc3RTZXJ2aWNlIGZyb20gIkBzZXJ2aWNlL2FwcC9jb2RlbGlzdC1zZXJ2aWNlIjsKaW1wb3J0IHsgRm9ybUl0ZW1Nb2RlbCB9IGZyb20gJ0AvbW9kZWwvZm9ybS1kZXRhaWwnOwoKdmFyIE1haW5fMkJhc2UgPQovKiNfX1BVUkVfXyovCmZ1bmN0aW9uIChfVnVlKSB7CiAgX2luaGVyaXRzKE1haW5fMkJhc2UsIF9WdWUpOwoKICBmdW5jdGlvbiBNYWluXzJCYXNlKCkgewogICAgdmFyIF90aGlzMjsKCiAgICBfY2xhc3NDYWxsQ2hlY2sodGhpcywgTWFpbl8yQmFzZSk7CgogICAgX3RoaXMyID0gX3Bvc3NpYmxlQ29uc3RydWN0b3JSZXR1cm4odGhpcywgX2dldFByb3RvdHlwZU9mKE1haW5fMkJhc2UpLmFwcGx5KHRoaXMsIGFyZ3VtZW50cykpOwogICAgLyoqDQogICAgICog6K6h5pWw5Zmo5pyN5Yqh5a+56LGh6ZuG5ZCIDQogICAgICoNCiAgICAgKiBAdHlwZSB7QXJyYXk8Kj59DQogICAgICogQG1lbWJlcm9mIE1haW5fMkJhc2UNCiAgICAgKi8KCiAgICBfdGhpczIuY291bnRlclNlcnZpY2VBcnJheSA9IFtdOwogICAgLyoqDQogICAgICog5bu65p6E6YOo5Lu25pyN5Yqh5a+56LGhDQogICAgICoNCiAgICAgKiBAdHlwZSB7TWFpbl8yU2VydmljZX0NCiAgICAgKiBAbWVtYmVyb2YgTWFpbl8yQmFzZQ0KICAgICAqLwoKICAgIF90aGlzMi5zZXJ2aWNlID0gbmV3IE1haW5fMlNlcnZpY2UoewogICAgICAkc3RvcmU6IF90aGlzMi4kc3RvcmUKICAgIH0pOwogICAgLyoqDQogICAgICog5a6e5L2T5pyN5Yqh5a+56LGhDQogICAgICoNCiAgICAgKiBAdHlwZSB7UGltQXJjaGl2ZXNDaGFuZ2VTZXJ2aWNlfQ0KICAgICAqIEBtZW1iZXJvZiBNYWluXzJCYXNlDQogICAgICovCgogICAgX3RoaXMyLmFwcEVudGl0eVNlcnZpY2UgPSBuZXcgUGltQXJjaGl2ZXNDaGFuZ2VTZXJ2aWNlKHsKICAgICAgJHN0b3JlOiBfdGhpczIuJHN0b3JlCiAgICB9KTsKICAgIC8qKg0KICAgICAqIOS7o+eggeihqOacjeWKoeWvueixoQ0KICAgICAqDQogICAgICogQHR5cGUge0NvZGVMaXN0U2VydmljZX0NCiAgICAgKiBAbWVtYmVyb2YgTWFpbl8yQmFzZQ0KICAgICAqLwoKICAgIF90aGlzMi5jb2RlTGlzdFNlcnZpY2UgPSBuZXcgQ29kZUxpc3RTZXJ2aWNlKHsKICAgICAgJHN0b3JlOiBfdGhpczIuJHN0b3JlCiAgICB9KTsKICAgIC8qKg0KICAgICAqIOW9k+WJjemhtQ0KICAgICAqDQogICAgICogQHR5cGUge251bWJlcn0NCiAgICAgKiBAbWVtYmVyb2YgTWFpbl8yQmFzZQ0KICAgICAqLwoKICAgIF90aGlzMi5jdXJQYWdlID0gMTsKICAgIC8qKg0KICAgICAqIOaVsOaNrg0KICAgICAqDQogICAgICogQHR5cGUge2FueVtdfQ0KICAgICAqIEBtZW1iZXJvZiBNYWluXzJCYXNlDQogICAgICovCgogICAgX3RoaXMyLml0ZW1zID0gW107CiAgICAvKioNCiAgICAgKiDmmK/lkKbmlK/mjIHliIbpobUNCiAgICAgKg0KICAgICAqIEB0eXBlIHtib29sZWFufQ0KICAgICAqIEBtZW1iZXJvZiBNYWluXzJCYXNlDQogICAgICovCgogICAgX3RoaXMyLmlzRW5hYmxlUGFnaW5nQmFyID0gdHJ1ZTsKICAgIC8qKg0KICAgICAqIOaYr+WQpuemgeeUqOaOkuW6jw0KICAgICAqDQogICAgICogQHR5cGUge2Jvb2xlYW59DQogICAgICogQG1lbWJlcm9mIE1haW5fMkJhc2UNCiAgICAgKi8KCiAgICBfdGhpczIuaXNOb1NvcnQgPSBmYWxzZTsKICAgIC8qKg0KICAgICAqIOaOkuW6j+aWueWQkQ0KICAgICAqDQogICAgICogQHR5cGUge3N0cmluZ30NCiAgICAgKiBAbWVtYmVyb2YgTWFpbl8yQmFzZQ0KICAgICAqLwoKICAgIF90aGlzMi5taW5vclNvcnREaXIgPSAnREVTQyc7CiAgICAvKioNCiAgICAgKiDmjpLluo/lrZfmrrUNCiAgICAgKg0KICAgICAqIEB0eXBlIHtzdHJpbmd9DQogICAgICogQG1lbWJlcm9mIE1haW5fMkJhc2UNCiAgICAgKi8KCiAgICBfdGhpczIubWlub3JTb3J0UFNERUYgPSAnZGFkZHJxJzsKICAgIC8qKg0KICAgICAqIOWIhumhteadoeaVsA0KICAgICAqDQogICAgICogQHR5cGUge251bWJlcn0NCiAgICAgKiBAbWVtYmVyb2YgTWFpbl8yQmFzZQ0KICAgICAqLwoKICAgIF90aGlzMi5saW1pdCA9IDIwOwogICAgLyoqDQogICAgICog5piv5ZCm5pi+56S65qCH6aKYDQogICAgICoNCiAgICAgKiBAdHlwZSB7Ym9vbGVhbn0NCiAgICAgKiBAbWVtYmVyb2YgTWFpbl8yQmFzZQ0KICAgICAqLwoKICAgIF90aGlzMi5pc0hpZGVIZWFkZXIgPSBmYWxzZTsKICAgIC8qKg0KICAgICAqIOWunumZheaYr+WQpuW8gOWQr+ihjOe8lui+kQ0KICAgICAqDQogICAgICogQHR5cGUge2Jvb2xlYW59DQogICAgICogQG1lbWJlcm9mIE1haW5fMkJhc2UNCiAgICAgKi8KCiAgICBfdGhpczIuYWN0dWFsSXNPcGVuRWRpdCA9IF90aGlzMi5pc09wZW5FZGl0OwogICAgLyoqDQogICAgICog5oC75p2h5pWwDQogICAgICoNCiAgICAgKiBAdHlwZSB7bnVtYmVyfQ0KICAgICAqIEBtZW1iZXJvZiBNYWluXzJCYXNlDQogICAgICovCgogICAgX3RoaXMyLnRvdGFscm93ID0gMDsKICAgIC8qKg0KICAgICAqIOmAieS4reihjOaVsOaNrg0KICAgICAqDQogICAgICogQHR5cGUge2FueVtdfQ0KICAgICAqIEBtZW1iZXJvZiBNYWluDQogICAgICovCgogICAgX3RoaXMyLnNlbGVjdGlvbnMgPSBbXTsKICAgIC8qKg0KICAgICAqIOaLpuaIquihjOmAieS4rQ0KICAgICAqDQogICAgICogQHR5cGUge2Jvb2xlYW59DQogICAgICogQG1lbWJlcm9mIE1haW4NCiAgICAgKi8KCiAgICBfdGhpczIuc3RvcFJvd0NsaWNrID0gZmFsc2U7CiAgICAvKioNCiAgICAgKiDooajmoLzmmK/lkKbmmL7npLoNCiAgICAgKg0KICAgICAqIEB0eXBlIHtib29sZWFufQ0KICAgICAqIEBtZW1iZXJvZiBNYWluXzJCYXNlDQogICAgICovCgogICAgX3RoaXMyLmlzRGlzcGxheSA9IHRydWU7CiAgICAvKioNCiAgICAqIOmAiemhueahhuWIl+WuvQ0KICAgICoNCiAgICAqIEB0eXBlIHtudW1iZXJ9DQogICAgKiBAbWVtYmVyb2YgQXBwSW5kZXgNCiAgICAqLwoKICAgIF90aGlzMi5jaGVja2JveENvbFdpZHRoID0gMzQ7CiAgICAvKioNCiAgICAgKiDmmK/lkKblhYHorrjmi5bliqjliJflrr0NCiAgICAgKg0KICAgICAqIEB0eXBlIHtib29sZWFufQ0KICAgICAqIEBtZW1iZXJvZiBBcHBFbWJlZFBpY2tlcg0KICAgICAqLwoKICAgIF90aGlzMi5pc0RyYWdlbmRDb2wgPSBmYWxzZTsKICAgIC8qKg0KICAgICAqIOaJgOacieWIl+aIkOWRmA0KICAgICAqDQogICAgICogQHR5cGUge2FueVtdfQ0KICAgICAqIEBtZW1iZXJvZiBNYWluXzJCYXNlDQogICAgICovCgogICAgX3RoaXMyLmFsbENvbHVtbnMgPSBbewogICAgICBuYW1lOiAneWdiaCcsCiAgICAgIGxhYmVsOiAn5ZGY5bel57yW5Y+3JywKICAgICAgbGFuZ3RhZzogJ2VudGl0aWVzLnBpbWFyY2hpdmVzY2hhbmdlLm1haW5fMl9ncmlkLmNvbHVtbnMueWdiaCcsCiAgICAgIHNob3c6IHRydWUsCiAgICAgIHV0aWw6ICdweCcKICAgIH0sIHsKICAgICAgbmFtZTogJ3BpbXBlcnNvbm5hbWUnLAogICAgICBsYWJlbDogJ+WRmOW3peWnk+WQjScsCiAgICAgIGxhbmd0YWc6ICdlbnRpdGllcy5waW1hcmNoaXZlc2NoYW5nZS5tYWluXzJfZ3JpZC5jb2x1bW5zLnBpbXBlcnNvbm5hbWUnLAogICAgICBzaG93OiB0cnVlLAogICAgICB1dGlsOiAncHgnCiAgICB9LCB7CiAgICAgIG5hbWU6ICdvcm1vcmduYW1lJywKICAgICAgbGFiZWw6ICfosIPlh7rljZXkvY0nLAogICAgICBsYW5ndGFnOiAnZW50aXRpZXMucGltYXJjaGl2ZXNjaGFuZ2UubWFpbl8yX2dyaWQuY29sdW1ucy5vcm1vcmduYW1lJywKICAgICAgc2hvdzogdHJ1ZSwKICAgICAgdXRpbDogJ3B4JwogICAgfSwgewogICAgICBuYW1lOiAnb3Jtb3JnbmFtZTInLAogICAgICBsYWJlbDogJ+iwg+WFpeWNleS9jScsCiAgICAgIGxhbmd0YWc6ICdlbnRpdGllcy5waW1hcmNoaXZlc2NoYW5nZS5tYWluXzJfZ3JpZC5jb2x1bW5zLm9ybW9yZ25hbWUyJywKICAgICAgc2hvdzogdHJ1ZSwKICAgICAgdXRpbDogJ3B4JwogICAgfSwgewogICAgICBuYW1lOiAnamxjc3NqJywKICAgICAgbGFiZWw6ICfosIPliqjml7bpl7QnLAogICAgICBsYW5ndGFnOiAnZW50aXRpZXMucGltYXJjaGl2ZXNjaGFuZ2UubWFpbl8yX2dyaWQuY29sdW1ucy5qbGNzc2onLAogICAgICBzaG93OiB0cnVlLAogICAgICB1dGlsOiAnUFgnCiAgICB9XTsKICAgIC8qKg0KICAgICAqIOihqOagvOaooeWei+mbhuWQiA0KICAgICAqDQogICAgICogQHR5cGUgeyp9DQogICAgICogQG1lbWJlcm9mIE1haW5fMkJhc2UNCiAgICAgKi8KCiAgICBfdGhpczIuZ3JpZEl0ZW1zTW9kZWwgPSBbXTsKICAgIC8qKg0KICAgICAqIOWxnuaAp+WAvOinhOWImQ0KICAgICAqDQogICAgICogQHR5cGUgeyp9DQogICAgICogQG1lbWJlcm9mIE1haW5fMkJhc2UNCiAgICAgKi8KCiAgICBfdGhpczIucnVsZXMgPSB7CiAgICAgIHBpbWFyY2hpdmVzaWQ6IFt7CiAgICAgICAgcmVxdWlyZWQ6IGZhbHNlLAogICAgICAgIHZhbGlkYXRvcjogZnVuY3Rpb24gdmFsaWRhdG9yKHJ1bGUsIHZhbHVlLCBjYWxsYmFjaykgewogICAgICAgICAgcmV0dXJuIHJ1bGUucmVxdWlyZWQgJiYgKHZhbHVlID09PSBudWxsIHx8IHZhbHVlID09PSB1bmRlZmluZWQgfHwgdmFsdWUgPT09ICIiKSA/IGZhbHNlIDogdHJ1ZTsKICAgICAgICB9LAogICAgICAgIG1lc3NhZ2U6ICfmoaPmoYjkv6Hmga/moIfor4Yg5YC85LiN6IO95Li656m6JywKICAgICAgICB0cmlnZ2VyOiAnY2hhbmdlJwogICAgICB9LCB7CiAgICAgICAgcmVxdWlyZWQ6IGZhbHNlLAogICAgICAgIHZhbGlkYXRvcjogZnVuY3Rpb24gdmFsaWRhdG9yKHJ1bGUsIHZhbHVlLCBjYWxsYmFjaykgewogICAgICAgICAgcmV0dXJuIHJ1bGUucmVxdWlyZWQgJiYgKHZhbHVlID09PSBudWxsIHx8IHZhbHVlID09PSB1bmRlZmluZWQgfHwgdmFsdWUgPT09ICIiKSA/IGZhbHNlIDogdHJ1ZTsKICAgICAgICB9LAogICAgICAgIG1lc3NhZ2U6ICfmoaPmoYjkv6Hmga/moIfor4Yg5YC85LiN6IO95Li656m6JywKICAgICAgICB0cmlnZ2VyOiAnYmx1cicKICAgICAgfV0sCiAgICAgIHNyZmtleTogW3sKICAgICAgICByZXF1aXJlZDogZmFsc2UsCiAgICAgICAgdmFsaWRhdG9yOiBmdW5jdGlvbiB2YWxpZGF0b3IocnVsZSwgdmFsdWUsIGNhbGxiYWNrKSB7CiAgICAgICAgICByZXR1cm4gcnVsZS5yZXF1aXJlZCAmJiAodmFsdWUgPT09IG51bGwgfHwgdmFsdWUgPT09IHVuZGVmaW5lZCB8fCB2YWx1ZSA9PT0gIiIpID8gZmFsc2UgOiB0cnVlOwogICAgICAgIH0sCiAgICAgICAgbWVzc2FnZTogJ+aho+ahiOW9kuaho+WcsOWPmOabtOiusOW9leagh+ivhiDlgLzkuI3og73kuLrnqbonLAogICAgICAgIHRyaWdnZXI6ICdjaGFuZ2UnCiAgICAgIH0sIHsKICAgICAgICByZXF1aXJlZDogZmFsc2UsCiAgICAgICAgdmFsaWRhdG9yOiBmdW5jdGlvbiB2YWxpZGF0b3IocnVsZSwgdmFsdWUsIGNhbGxiYWNrKSB7CiAgICAgICAgICByZXR1cm4gcnVsZS5yZXF1aXJlZCAmJiAodmFsdWUgPT09IG51bGwgfHwgdmFsdWUgPT09IHVuZGVmaW5lZCB8fCB2YWx1ZSA9PT0gIiIpID8gZmFsc2UgOiB0cnVlOwogICAgICAgIH0sCiAgICAgICAgbWVzc2FnZTogJ+aho+ahiOW9kuaho+WcsOWPmOabtOiusOW9leagh+ivhiDlgLzkuI3og73kuLrnqbonLAogICAgICAgIHRyaWdnZXI6ICdibHVyJwogICAgICB9XQogICAgfTsKICAgIHJldHVybiBfdGhpczI7CiAgfQogIC8qKg0KICAgKiDojrflj5bpg6jku7bnsbvlnosNCiAgICoNCiAgICogQHJldHVybnMge3N0cmluZ30NCiAgICogQG1lbWJlcm9mIE1haW5fMkJhc2UNCiAgICovCgoKICBfY3JlYXRlQ2xhc3MoTWFpbl8yQmFzZSwgW3sKICAgIGtleTogImdldENvbnRyb2xUeXBlIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBnZXRDb250cm9sVHlwZSgpIHsKICAgICAgcmV0dXJuICdHUklEJzsKICAgIH0KICAgIC8qKg0KICAgICAqIOWFs+mXreinhuWbvg0KICAgICAqDQogICAgICogQHBhcmFtIHthbnl9IGFyZ3MNCiAgICAgKiBAbWVtYmVyb2YgTWFpbl8yQmFzZQ0KICAgICAqLwoKICB9LCB7CiAgICBrZXk6ICJjbG9zZVZpZXciLAogICAgdmFsdWU6IGZ1bmN0aW9uIGNsb3NlVmlldyhhcmdzKSB7CiAgICAgIHZhciBfdGhpcyA9IHRoaXM7CgogICAgICBfdGhpcy4kZW1pdCgnY2xvc2V2aWV3JywgW2FyZ3NdKTsKICAgIH0KICAgIC8qKg0KICAgICAqICDorqHmlbDlmajliLfmlrANCiAgICAgKg0KICAgICAqIEBtZW1iZXJvZiBNYWluXzJCYXNlDQogICAgICovCgogIH0sIHsKICAgIGtleTogImNvdW50ZXJSZWZyZXNoIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBjb3VudGVyUmVmcmVzaCgpIHsKICAgICAgdmFyIF90aGlzID0gdGhpczsKCiAgICAgIGlmIChfdGhpcy5jb3VudGVyU2VydmljZUFycmF5ICYmIF90aGlzLmNvdW50ZXJTZXJ2aWNlQXJyYXkubGVuZ3RoID4gMCkgewogICAgICAgIF90aGlzLmNvdW50ZXJTZXJ2aWNlQXJyYXkuZm9yRWFjaChmdW5jdGlvbiAoaXRlbSkgewogICAgICAgICAgaWYgKGl0ZW0ucmVmcmVzaERhdGEgJiYgaXRlbS5yZWZyZXNoRGF0YSBpbnN0YW5jZW9mIEZ1bmN0aW9uKSB7CiAgICAgICAgICAgIGl0ZW0ucmVmcmVzaERhdGEoKTsKICAgICAgICAgIH0KICAgICAgICB9KTsKICAgICAgfQogICAgfQogICAgLyoqDQogICAgICog6I635Y+W5aSa6aG55pWw5o2uDQogICAgICoNCiAgICAgKiBAcmV0dXJucyB7YW55W119DQogICAgICogQG1lbWJlcm9mIE1haW5fMkJhc2UNCiAgICAgKi8KCiAgfSwgewogICAga2V5OiAiZ2V0RGF0YXMiLAogICAgdmFsdWU6IGZ1bmN0aW9uIGdldERhdGFzKCkgewogICAgICByZXR1cm4gdGhpcy5zZWxlY3Rpb25zOwogICAgfQogICAgLyoqDQogICAgICog6I635Y+W5Y2V6aG55qCRDQogICAgICoNCiAgICAgKiBAcmV0dXJucyB7Kn0NCiAgICAgKiBAbWVtYmVyb2YgTWFpbl8yQmFzZQ0KICAgICAqLwoKICB9LCB7CiAgICBrZXk6ICJnZXREYXRhIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBnZXREYXRhKCkgewogICAgICByZXR1cm4gdGhpcy5zZWxlY3Rpb25zWzBdOwogICAgfQogICAgLyoqDQogICAgICog6YCJ5Lit5YC85Y+Y5YyWDQogICAgICoNCiAgICAgKiBAcGFyYW0geyp9IG5ld1ZhbA0KICAgICAqIEBwYXJhbSB7Kn0gb2xkVmFsDQogICAgICogQG1lbWJlcm9mIE1haW5fMkJhc2UNCiAgICAgKi8KCiAgfSwgewogICAga2V5OiAib25WYWx1ZUNoYW5nZSIsCiAgICB2YWx1ZTogZnVuY3Rpb24gb25WYWx1ZUNoYW5nZShuZXdWYWwsIG9sZFZhbCkgewogICAgICB2YXIgX3RoaXMzID0gdGhpczsKCiAgICAgIHRoaXMuc2VsZWN0aW9ucyA9IFtdOwoKICAgICAgaWYgKHRoaXMuc2VsZWN0ZWREYXRhKSB7CiAgICAgICAgdmFyIHJlZnMgPSB0aGlzLiRyZWZzOwoKICAgICAgICBpZiAocmVmcy5tdWx0aXBsZVRhYmxlKSB7CiAgICAgICAgICByZWZzLm11bHRpcGxlVGFibGUuY2xlYXJTZWxlY3Rpb24oKTsKICAgICAgICAgIEpTT04ucGFyc2UodGhpcy5zZWxlY3RlZERhdGEpLmZvckVhY2goZnVuY3Rpb24gKHNlbGVjdGlvbikgewogICAgICAgICAgICB2YXIgc2VsZWN0ZWRJdGVtID0gX3RoaXMzLml0ZW1zLmZpbmQoZnVuY3Rpb24gKGl0ZW0pIHsKICAgICAgICAgICAgICByZXR1cm4gT2JqZWN0LmlzKGl0ZW0uc3Jma2V5LCBzZWxlY3Rpb24uc3Jma2V5KTsKICAgICAgICAgICAgfSk7CgogICAgICAgICAgICBpZiAoc2VsZWN0ZWRJdGVtKSB7CiAgICAgICAgICAgICAgX3RoaXMzLnJvd0NsaWNrKHNlbGVjdGVkSXRlbSk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0pOwogICAgICAgIH0KICAgICAgfQogICAgfQogICAgLyoqDQogICAgICog6YOo5Lu25Yi35pawDQogICAgICoNCiAgICAgKiBAcGFyYW0ge2FueVtdfSBhcmdzDQogICAgICogQG1lbWJlcm9mIE1haW5fMkJhc2UNCiAgICAgKi8KCiAgfSwgewogICAga2V5OiAicmVmcmVzaCIsCiAgICB2YWx1ZTogZnVuY3Rpb24gcmVmcmVzaChhcmdzKSB7CiAgICAgIHRoaXMubG9hZCgpOwogICAgfQogICAgLyoqDQogICAgICog6I635Y+W6KGo5qC86KGM5qih5Z6LDQogICAgICoNCiAgICAgKiBAdHlwZSB7Kn0NCiAgICAgKiBAbWVtYmVyb2YgTWFpbl8yQmFzZQ0KICAgICAqLwoKICB9LCB7CiAgICBrZXk6ICJnZXRHcmlkUm93TW9kZWwiLAogICAgdmFsdWU6IGZ1bmN0aW9uIGdldEdyaWRSb3dNb2RlbCgpIHsKICAgICAgcmV0dXJuIHsKICAgICAgICBwaW1hcmNoaXZlc2lkOiBuZXcgRm9ybUl0ZW1Nb2RlbCgpLAogICAgICAgIHNyZmtleTogbmV3IEZvcm1JdGVtTW9kZWwoKQogICAgICB9OwogICAgfQogICAgLyoqDQogICAgICog6KGo5qC86KGM57yW6L6R6aG55qCh6aqMDQogICAgICoNCiAgICAgKiBAcGFyYW0ge3N0cmluZ30gcHJvcGVydHkg5bGe5oCn5ZCNDQogICAgICogQHBhcmFtIHsqfSBkYXRhIOihjOaVsOaNrg0KICAgICAqIEBwYXJhbSB7bnVtYmVyfSByb3dJbmRleCDooYzntKLlvJUNCiAgICAgKiBAcmV0dXJucyBQcm9taXNlPGFueT4NCiAgICAgKg0KICAgICAqIEBtZW1iZXJvZiBNYWluXzJCYXNlDQogICAgICovCgogIH0sIHsKICAgIGtleTogInZhbGlkYXRlIiwKICAgIHZhbHVlOiBmdW5jdGlvbiB2YWxpZGF0ZShwcm9wZXJ0eSwgZGF0YSwgcm93SW5kZXgpIHsKICAgICAgdmFyIF90aGlzNCA9IHRoaXM7CgogICAgICByZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24gKHJlc29sdmUsIHJlamVjdCkgewogICAgICAgIF90aGlzNC4kdXRpbC52YWxpZGF0ZUl0ZW0ocHJvcGVydHksIGRhdGEsIF90aGlzNC5ydWxlcykudGhlbihmdW5jdGlvbiAoKSB7CiAgICAgICAgICBfdGhpczQuZ3JpZEl0ZW1zTW9kZWxbcm93SW5kZXhdW3Byb3BlcnR5XS5zZXRFcnJvcihudWxsKTsKCiAgICAgICAgICByZXNvbHZlKHRydWUpOwogICAgICAgIH0pWyJjYXRjaCJdKGZ1bmN0aW9uIChfcmVmKSB7CiAgICAgICAgICB2YXIgZXJyb3JzID0gX3JlZi5lcnJvcnMsCiAgICAgICAgICAgICAgZmllbGRzID0gX3JlZi5maWVsZHM7CgogICAgICAgICAgX3RoaXM0LmdyaWRJdGVtc01vZGVsW3Jvd0luZGV4XVtwcm9wZXJ0eV0uc2V0RXJyb3IoZXJyb3JzWzBdLm1lc3NhZ2UpOwoKICAgICAgICAgIHJlc29sdmUoZmFsc2UpOwogICAgICAgIH0pOwogICAgICB9KTsKICAgIH0KICAgIC8qKg0KICAgICAqIOagoemqjOaJgOacieS/ruaUuei/h+eahOe8lui+kemhuQ0KICAgICAqDQogICAgICogQHJldHVybnMgUHJvbWlzZTxhbnk+DQogICAgICogQG1lbWJlcm9mIE1haW5fMkJhc2UNCiAgICAgKi8KCiAgfSwgewogICAga2V5OiAidmFsaWRhdGVBbGwiLAogICAgdmFsdWU6IGZ1bmN0aW9uICgpIHsKICAgICAgdmFyIF92YWxpZGF0ZUFsbCA9IF9hc3luY1RvR2VuZXJhdG9yKAogICAgICAvKiNfX1BVUkVfXyovCiAgICAgIHJlZ2VuZXJhdG9yUnVudGltZS5tYXJrKGZ1bmN0aW9uIF9jYWxsZWUoKSB7CiAgICAgICAgdmFyIHZhbGlkYXRlU3RhdGUsIGluZGV4LCBfaXRlcmF0b3JOb3JtYWxDb21wbGV0aW9uLCBfZGlkSXRlcmF0b3JFcnJvciwgX2l0ZXJhdG9yRXJyb3IsIF9pdGVyYXRvciwgX3N0ZXAsIGl0ZW0sIF9pLCBfT2JqZWN0JGtleXMsIHByb3BlcnR5OwoKICAgICAgICByZXR1cm4gcmVnZW5lcmF0b3JSdW50aW1lLndyYXAoZnVuY3Rpb24gX2NhbGxlZSQoX2NvbnRleHQpIHsKICAgICAgICAgIHdoaWxlICgxKSB7CiAgICAgICAgICAgIHN3aXRjaCAoX2NvbnRleHQucHJldiA9IF9jb250ZXh0Lm5leHQpIHsKICAgICAgICAgICAgICBjYXNlIDA6CiAgICAgICAgICAgICAgICB2YWxpZGF0ZVN0YXRlID0gdHJ1ZTsKICAgICAgICAgICAgICAgIGluZGV4ID0gLTE7CiAgICAgICAgICAgICAgICBfaXRlcmF0b3JOb3JtYWxDb21wbGV0aW9uID0gdHJ1ZTsKICAgICAgICAgICAgICAgIF9kaWRJdGVyYXRvckVycm9yID0gZmFsc2U7CiAgICAgICAgICAgICAgICBfaXRlcmF0b3JFcnJvciA9IHVuZGVmaW5lZDsKICAgICAgICAgICAgICAgIF9jb250ZXh0LnByZXYgPSA1OwogICAgICAgICAgICAgICAgX2l0ZXJhdG9yID0gdGhpcy5pdGVtc1tTeW1ib2wuaXRlcmF0b3JdKCk7CgogICAgICAgICAgICAgIGNhc2UgNzoKICAgICAgICAgICAgICAgIGlmIChfaXRlcmF0b3JOb3JtYWxDb21wbGV0aW9uID0gKF9zdGVwID0gX2l0ZXJhdG9yLm5leHQoKSkuZG9uZSkgewogICAgICAgICAgICAgICAgICBfY29udGV4dC5uZXh0ID0gMjQ7CiAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIGl0ZW0gPSBfc3RlcC52YWx1ZTsKICAgICAgICAgICAgICAgIGluZGV4Kys7CgogICAgICAgICAgICAgICAgaWYgKCEoaXRlbS5yb3dEYXRhU3RhdGUgPT09ICJjcmVhdGUiIHx8IGl0ZW0ucm93RGF0YVN0YXRlID09PSAidXBkYXRlIikpIHsKICAgICAgICAgICAgICAgICAgX2NvbnRleHQubmV4dCA9IDIxOwogICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBfaSA9IDAsIF9PYmplY3Qka2V5cyA9IE9iamVjdC5rZXlzKHRoaXMucnVsZXMpOwoKICAgICAgICAgICAgICBjYXNlIDEyOgogICAgICAgICAgICAgICAgaWYgKCEoX2kgPCBfT2JqZWN0JGtleXMubGVuZ3RoKSkgewogICAgICAgICAgICAgICAgICBfY29udGV4dC5uZXh0ID0gMjE7CiAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIHByb3BlcnR5ID0gX09iamVjdCRrZXlzW19pXTsKICAgICAgICAgICAgICAgIF9jb250ZXh0Lm5leHQgPSAxNjsKICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLnZhbGlkYXRlKHByb3BlcnR5LCBpdGVtLCBpbmRleCk7CgogICAgICAgICAgICAgIGNhc2UgMTY6CiAgICAgICAgICAgICAgICBpZiAoX2NvbnRleHQuc2VudCkgewogICAgICAgICAgICAgICAgICBfY29udGV4dC5uZXh0ID0gMTg7CiAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIHZhbGlkYXRlU3RhdGUgPSBmYWxzZTsKCiAgICAgICAgICAgICAgY2FzZSAxODoKICAgICAgICAgICAgICAgIF9pKys7CiAgICAgICAgICAgICAgICBfY29udGV4dC5uZXh0ID0gMTI7CiAgICAgICAgICAgICAgICBicmVhazsKCiAgICAgICAgICAgICAgY2FzZSAyMToKICAgICAgICAgICAgICAgIF9pdGVyYXRvck5vcm1hbENvbXBsZXRpb24gPSB0cnVlOwogICAgICAgICAgICAgICAgX2NvbnRleHQubmV4dCA9IDc7CiAgICAgICAgICAgICAgICBicmVhazsKCiAgICAgICAgICAgICAgY2FzZSAyNDoKICAgICAgICAgICAgICAgIF9jb250ZXh0Lm5leHQgPSAzMDsKICAgICAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgICAgICBjYXNlIDI2OgogICAgICAgICAgICAgICAgX2NvbnRleHQucHJldiA9IDI2OwogICAgICAgICAgICAgICAgX2NvbnRleHQudDAgPSBfY29udGV4dFsiY2F0Y2giXSg1KTsKICAgICAgICAgICAgICAgIF9kaWRJdGVyYXRvckVycm9yID0gdHJ1ZTsKICAgICAgICAgICAgICAgIF9pdGVyYXRvckVycm9yID0gX2NvbnRleHQudDA7CgogICAgICAgICAgICAgIGNhc2UgMzA6CiAgICAgICAgICAgICAgICBfY29udGV4dC5wcmV2ID0gMzA7CiAgICAgICAgICAgICAgICBfY29udGV4dC5wcmV2ID0gMzE7CgogICAgICAgICAgICAgICAgaWYgKCFfaXRlcmF0b3JOb3JtYWxDb21wbGV0aW9uICYmIF9pdGVyYXRvclsicmV0dXJuIl0gIT0gbnVsbCkgewogICAgICAgICAgICAgICAgICBfaXRlcmF0b3JbInJldHVybiJdKCk7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgIGNhc2UgMzM6CiAgICAgICAgICAgICAgICBfY29udGV4dC5wcmV2ID0gMzM7CgogICAgICAgICAgICAgICAgaWYgKCFfZGlkSXRlcmF0b3JFcnJvcikgewogICAgICAgICAgICAgICAgICBfY29udGV4dC5uZXh0ID0gMzY7CiAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIHRocm93IF9pdGVyYXRvckVycm9yOwoKICAgICAgICAgICAgICBjYXNlIDM2OgogICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0LmZpbmlzaCgzMyk7CgogICAgICAgICAgICAgIGNhc2UgMzc6CiAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQuZmluaXNoKDMwKTsKCiAgICAgICAgICAgICAgY2FzZSAzODoKICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dC5hYnJ1cHQoInJldHVybiIsIHZhbGlkYXRlU3RhdGUpOwoKICAgICAgICAgICAgICBjYXNlIDM5OgogICAgICAgICAgICAgIGNhc2UgImVuZCI6CiAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQuc3RvcCgpOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSwgX2NhbGxlZSwgdGhpcywgW1s1LCAyNiwgMzAsIDM4XSwgWzMxLCwgMzMsIDM3XV0pOwogICAgICB9KSk7CgogICAgICBmdW5jdGlvbiB2YWxpZGF0ZUFsbCgpIHsKICAgICAgICByZXR1cm4gX3ZhbGlkYXRlQWxsLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7CiAgICAgIH0KCiAgICAgIHJldHVybiB2YWxpZGF0ZUFsbDsKICAgIH0oKQogICAgLyoqDQogICAgICog6KGo5qC85pWw5o2u5Yqg6L29DQogICAgICoNCiAgICAgKiBAcGFyYW0geyp9IFthcmc9e31dDQogICAgICogQG1lbWJlcm9mIE1haW5fMkJhc2UNCiAgICAgKi8KCiAgfSwgewogICAga2V5OiAibG9hZCIsCiAgICB2YWx1ZTogZnVuY3Rpb24gbG9hZCgpIHsKICAgICAgdmFyIF90aGlzNSA9IHRoaXM7CgogICAgICB2YXIgb3B0ID0gYXJndW1lbnRzLmxlbmd0aCA+IDAgJiYgYXJndW1lbnRzWzBdICE9PSB1bmRlZmluZWQgPyBhcmd1bWVudHNbMF0gOiB7fTsKICAgICAgdmFyIHBhZ2VSZXNldCA9IGFyZ3VtZW50cy5sZW5ndGggPiAxICYmIGFyZ3VtZW50c1sxXSAhPT0gdW5kZWZpbmVkID8gYXJndW1lbnRzWzFdIDogZmFsc2U7CgogICAgICBpZiAoIXRoaXMuZmV0Y2hBY3Rpb24pIHsKICAgICAgICB0aGlzLiROb3RpY2UuZXJyb3IoewogICAgICAgICAgdGl0bGU6ICfplJnor68nLAogICAgICAgICAgZGVzYzogJ1BJTUFSQ0hJVkVTQ0hBTkdFREFEQ0pMR3JpZFZpZXfop4blm77ooajmoLxmZXRjaEFjdGlvbuWPguaVsOacqumFjee9ricKICAgICAgICB9KTsKICAgICAgICByZXR1cm47CiAgICAgIH0KCiAgICAgIGlmIChwYWdlUmVzZXQpIHsKICAgICAgICB0aGlzLmN1clBhZ2UgPSAxOwogICAgICB9CgogICAgICB2YXIgYXJnID0gX29iamVjdFNwcmVhZCh7fSwgb3B0KTsKCiAgICAgIHZhciBwYWdlID0ge307CgogICAgICBpZiAodGhpcy5pc0VuYWJsZVBhZ2luZ0JhcikgewogICAgICAgIE9iamVjdC5hc3NpZ24ocGFnZSwgewogICAgICAgICAgcGFnZTogdGhpcy5jdXJQYWdlIC0gMSwKICAgICAgICAgIHNpemU6IHRoaXMubGltaXQKICAgICAgICB9KTsKICAgICAgfSAvLyDorr7nva7mjpLluo8KCgogICAgICBpZiAoIXRoaXMuaXNOb1NvcnQgJiYgIU9iamVjdC5pcyh0aGlzLm1pbm9yU29ydERpciwgJycpICYmICFPYmplY3QuaXModGhpcy5taW5vclNvcnRQU0RFRiwgJycpKSB7CiAgICAgICAgdmFyIHNvcnQgPSB0aGlzLm1pbm9yU29ydFBTREVGICsgIiwiICsgdGhpcy5taW5vclNvcnREaXI7CiAgICAgICAgT2JqZWN0LmFzc2lnbihwYWdlLCB7CiAgICAgICAgICBzb3J0OiBzb3J0CiAgICAgICAgfSk7CiAgICAgIH0KCiAgICAgIE9iamVjdC5hc3NpZ24oYXJnLCBwYWdlKTsKICAgICAgdmFyIHBhcmVudGRhdGEgPSB7fTsKICAgICAgdGhpcy4kZW1pdCgnYmVmb3JlbG9hZCcsIHBhcmVudGRhdGEpOwogICAgICBPYmplY3QuYXNzaWduKGFyZywgcGFyZW50ZGF0YSk7CiAgICAgIHZhciB0ZW1wVmlld1BhcmFtcyA9IHBhcmVudGRhdGEudmlld3BhcmFtcyA/IHBhcmVudGRhdGEudmlld3BhcmFtcyA6IHt9OwogICAgICBPYmplY3QuYXNzaWduKHRlbXBWaWV3UGFyYW1zLCBKU09OLnBhcnNlKEpTT04uc3RyaW5naWZ5KHRoaXMudmlld3BhcmFtcykpKTsKICAgICAgT2JqZWN0LmFzc2lnbihhcmcsIHsKICAgICAgICB2aWV3cGFyYW1zOiB0ZW1wVmlld1BhcmFtcwogICAgICB9KTsKICAgICAgdmFyIHBvc3QgPSB0aGlzLnNlcnZpY2Uuc2VhcmNoKHRoaXMuZmV0Y2hBY3Rpb24sIEpTT04ucGFyc2UoSlNPTi5zdHJpbmdpZnkodGhpcy5jb250ZXh0KSksIGFyZywgdGhpcy5zaG93QnVzeUluZGljYXRvcik7CiAgICAgIHBvc3QudGhlbihmdW5jdGlvbiAocmVzcG9uc2UpIHsKICAgICAgICBpZiAoIXJlc3BvbnNlLnN0YXR1cyB8fCByZXNwb25zZS5zdGF0dXMgIT09IDIwMCkgewogICAgICAgICAgaWYgKHJlc3BvbnNlLmVycm9yTWVzc2FnZSkgewogICAgICAgICAgICBfdGhpczUuJE5vdGljZS5lcnJvcih7CiAgICAgICAgICAgICAgdGl0bGU6ICfplJnor68nLAogICAgICAgICAgICAgIGRlc2M6IHJlc3BvbnNlLmVycm9yTWVzc2FnZQogICAgICAgICAgICB9KTsKICAgICAgICAgIH0KCiAgICAgICAgICByZXR1cm47CiAgICAgICAgfQoKICAgICAgICB2YXIgZGF0YSA9IHJlc3BvbnNlLmRhdGE7CiAgICAgICAgX3RoaXM1LnRvdGFscm93ID0gcmVzcG9uc2UudG90YWw7CiAgICAgICAgX3RoaXM1Lml0ZW1zID0gSlNPTi5wYXJzZShKU09OLnN0cmluZ2lmeShkYXRhKSk7IC8vIOa4heepunNlbGVjdGlvbnMsZ3JpZEl0ZW1zTW9kZWwKCiAgICAgICAgX3RoaXM1LnNlbGVjdGlvbnMgPSBbXTsKICAgICAgICBfdGhpczUuZ3JpZEl0ZW1zTW9kZWwgPSBbXTsKCiAgICAgICAgX3RoaXM1Lml0ZW1zLmZvckVhY2goZnVuY3Rpb24gKCkgewogICAgICAgICAgX3RoaXM1LmdyaWRJdGVtc01vZGVsLnB1c2goX3RoaXM1LmdldEdyaWRSb3dNb2RlbCgpKTsKICAgICAgICB9KTsKCiAgICAgICAgX3RoaXM1LiRlbWl0KCdsb2FkJywgX3RoaXM1Lml0ZW1zKTsgLy8g6K6+572u6buY6K6k6YCJ5LitCgoKICAgICAgICB2YXIgX3RoaXMgPSBfdGhpczU7CiAgICAgICAgc2V0VGltZW91dChmdW5jdGlvbiAoKSB7CiAgICAgICAgICBpZiAoX3RoaXMuaXNTZWxlY3RGaXJzdERlZmF1bHQpIHsKICAgICAgICAgICAgX3RoaXMucm93Q2xpY2soX3RoaXMuaXRlbXNbMF0pOwogICAgICAgICAgfQoKICAgICAgICAgIGlmIChfdGhpcy5zZWxlY3RlZERhdGEpIHsKICAgICAgICAgICAgdmFyIHJlZnMgPSBfdGhpcy4kcmVmczsKCiAgICAgICAgICAgIGlmIChyZWZzLm11bHRpcGxlVGFibGUpIHsKICAgICAgICAgICAgICByZWZzLm11bHRpcGxlVGFibGUuY2xlYXJTZWxlY3Rpb24oKTsKICAgICAgICAgICAgICBKU09OLnBhcnNlKF90aGlzLnNlbGVjdGVkRGF0YSkuZm9yRWFjaChmdW5jdGlvbiAoc2VsZWN0aW9uKSB7CiAgICAgICAgICAgICAgICB2YXIgc2VsZWN0ZWRJdGVtID0gX3RoaXMuaXRlbXMuZmluZChmdW5jdGlvbiAoaXRlbSkgewogICAgICAgICAgICAgICAgICByZXR1cm4gT2JqZWN0LmlzKGl0ZW0uc3Jma2V5LCBzZWxlY3Rpb24uc3Jma2V5KTsKICAgICAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgICAgIGlmIChzZWxlY3RlZEl0ZW0pIHsKICAgICAgICAgICAgICAgICAgX3RoaXMucm93Q2xpY2soc2VsZWN0ZWRJdGVtKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0sIDMwMCk7CiAgICAgIH0pWyJjYXRjaCJdKGZ1bmN0aW9uIChyZXNwb25zZSkgewogICAgICAgIGlmIChyZXNwb25zZSAmJiByZXNwb25zZS5zdGF0dXMgPT09IDQwMSkgewogICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KCiAgICAgICAgX3RoaXM1LiROb3RpY2UuZXJyb3IoewogICAgICAgICAgdGl0bGU6ICfplJnor68nLAogICAgICAgICAgZGVzYzogcmVzcG9uc2UuZXJyb3JNZXNzYWdlCiAgICAgICAgfSk7CiAgICAgIH0pOwogICAgfQogICAgLyoqDQogICAgICog5Yig6ZmkDQogICAgICoNCiAgICAgKiBAcGFyYW0ge2FueVtdfSBkYXRhcw0KICAgICAqIEByZXR1cm5zIHtQcm9taXNlPGFueT59DQogICAgICogQG1lbWJlcm9mIE1haW5fMkJhc2UNCiAgICAgKi8KCiAgfSwgewogICAga2V5OiAicmVtb3ZlIiwKICAgIHZhbHVlOiBmdW5jdGlvbiAoKSB7CiAgICAgIHZhciBfcmVtb3ZlID0gX2FzeW5jVG9HZW5lcmF0b3IoCiAgICAgIC8qI19fUFVSRV9fKi8KICAgICAgcmVnZW5lcmF0b3JSdW50aW1lLm1hcmsoZnVuY3Rpb24gX2NhbGxlZTIoZGF0YXMpIHsKICAgICAgICB2YXIgX3RoaXM2ID0gdGhpczsKCiAgICAgICAgdmFyIF9kYXRhcywgZGF0YUluZm8sIHJlbW92ZURhdGE7CgogICAgICAgIHJldHVybiByZWdlbmVyYXRvclJ1bnRpbWUud3JhcChmdW5jdGlvbiBfY2FsbGVlMiQoX2NvbnRleHQyKSB7CiAgICAgICAgICB3aGlsZSAoMSkgewogICAgICAgICAgICBzd2l0Y2ggKF9jb250ZXh0Mi5wcmV2ID0gX2NvbnRleHQyLm5leHQpIHsKICAgICAgICAgICAgICBjYXNlIDA6CiAgICAgICAgICAgICAgICBpZiAodGhpcy5yZW1vdmVBY3Rpb24pIHsKICAgICAgICAgICAgICAgICAgX2NvbnRleHQyLm5leHQgPSAzOwogICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICB0aGlzLiROb3RpY2UuZXJyb3IoewogICAgICAgICAgICAgICAgICB0aXRsZTogJ+mUmeivrycsCiAgICAgICAgICAgICAgICAgIGRlc2M6ICdQSU1BUkNISVZFU0NIQU5HRURBRENKTEdyaWRWaWV36KeG5Zu+6KGo5qC8cmVtb3ZlQWN0aW9u5Y+C5pWw5pyq6YWN572uJwogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQyLmFicnVwdCgicmV0dXJuIik7CgogICAgICAgICAgICAgIGNhc2UgMzoKICAgICAgICAgICAgICAgIF9kYXRhcyA9IFtdOwogICAgICAgICAgICAgICAgZGF0YXMuZm9yRWFjaChmdW5jdGlvbiAocmVjb3JkLCBpbmRleCkgewogICAgICAgICAgICAgICAgICBpZiAoT2JqZWN0LmlzKHJlY29yZC5zcmZ1ZiwgIjAiKSkgewogICAgICAgICAgICAgICAgICAgIF90aGlzNi5pdGVtcy5zb21lKGZ1bmN0aW9uICh2YWwsIG51bSkgewogICAgICAgICAgICAgICAgICAgICAgaWYgKEpTT04uc3RyaW5naWZ5KHZhbCkgPT0gSlNPTi5zdHJpbmdpZnkocmVjb3JkKSkgewogICAgICAgICAgICAgICAgICAgICAgICBfdGhpczYuaXRlbXMuc3BsaWNlKG51bSwgMSk7CgogICAgICAgICAgICAgICAgICAgICAgICBfdGhpczYuZ3JpZEl0ZW1zTW9kZWwuc3BsaWNlKG51bSwgMSk7CgogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICBfZGF0YXMucHVzaChkYXRhc1tpbmRleF0pOwogICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9KTsKCiAgICAgICAgICAgICAgICBpZiAoIShfZGF0YXMubGVuZ3RoID09PSAwKSkgewogICAgICAgICAgICAgICAgICBfY29udGV4dDIubmV4dCA9IDc7CiAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDIuYWJydXB0KCJyZXR1cm4iKTsKCiAgICAgICAgICAgICAgY2FzZSA3OgogICAgICAgICAgICAgICAgZGF0YUluZm8gPSAnJzsKCiAgICAgICAgICAgICAgICBfZGF0YXMuZm9yRWFjaChmdW5jdGlvbiAocmVjb3JkLCBpbmRleCkgewogICAgICAgICAgICAgICAgICB2YXIgc3JmbWFqb3J0ZXh0ID0gcmVjb3JkLnBpbWFyY2hpdmVzY2hhbmdlbmFtZTsKCiAgICAgICAgICAgICAgICAgIGlmIChpbmRleCA8IDUpIHsKICAgICAgICAgICAgICAgICAgICBpZiAoIU9iamVjdC5pcyhkYXRhSW5mbywgJycpKSB7CiAgICAgICAgICAgICAgICAgICAgICBkYXRhSW5mbyArPSAn44CBJzsKICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgIGRhdGFJbmZvICs9IHNyZm1ham9ydGV4dDsKICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgICAgIGlmIChfZGF0YXMubGVuZ3RoIDwgNSkgewogICAgICAgICAgICAgICAgICBkYXRhSW5mbyA9IGRhdGFJbmZvICsgJyDlhbEnICsgX2RhdGFzLmxlbmd0aCArICfmnaHmlbDmja4nOwogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgZGF0YUluZm8gPSBkYXRhSW5mbyArICcuLi4nICsgJyDlhbEnICsgX2RhdGFzLmxlbmd0aCArICfmnaHmlbDmja4nOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIHJlbW92ZURhdGEgPSBmdW5jdGlvbiByZW1vdmVEYXRhKCkgewogICAgICAgICAgICAgICAgICB2YXIga2V5cyA9IFtdOwoKICAgICAgICAgICAgICAgICAgX2RhdGFzLmZvckVhY2goZnVuY3Rpb24gKGRhdGEpIHsKICAgICAgICAgICAgICAgICAgICBrZXlzLnB1c2goZGF0YS5zcmZrZXkpOwogICAgICAgICAgICAgICAgICB9KTsKCiAgICAgICAgICAgICAgICAgIHZhciBfcmVtb3ZlQWN0aW9uID0ga2V5cy5sZW5ndGggPiAxID8gJ3JlbW92ZUJhdGNoJyA6IF90aGlzNi5yZW1vdmVBY3Rpb247CgogICAgICAgICAgICAgICAgICB2YXIgX2tleXMgPSBrZXlzLmxlbmd0aCA+IDEgPyBrZXlzIDoga2V5c1swXTsKCiAgICAgICAgICAgICAgICAgIHZhciBjb250ZXh0ID0gSlNPTi5wYXJzZShKU09OLnN0cmluZ2lmeShfdGhpczYuY29udGV4dCkpOwoKICAgICAgICAgICAgICAgICAgdmFyIHBvc3QgPSBfdGhpczYuc2VydmljZVsiZGVsZXRlIl0oX3JlbW92ZUFjdGlvbiwgT2JqZWN0LmFzc2lnbihjb250ZXh0LCB7CiAgICAgICAgICAgICAgICAgICAgcGltYXJjaGl2ZXNjaGFuZ2U6IF9rZXlzCiAgICAgICAgICAgICAgICAgIH0pLCBPYmplY3QuYXNzaWduKHsKICAgICAgICAgICAgICAgICAgICBwaW1hcmNoaXZlc2NoYW5nZTogX2tleXMKICAgICAgICAgICAgICAgICAgfSwgewogICAgICAgICAgICAgICAgICAgIHZpZXdwYXJhbXM6IF90aGlzNi52aWV3cGFyYW1zCiAgICAgICAgICAgICAgICAgIH0pLCBfdGhpczYuc2hvd0J1c3lJbmRpY2F0b3IpOwoKICAgICAgICAgICAgICAgICAgcmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uIChyZXNvbHZlLCByZWplY3QpIHsKICAgICAgICAgICAgICAgICAgICBwb3N0LnRoZW4oZnVuY3Rpb24gKHJlc3BvbnNlKSB7CiAgICAgICAgICAgICAgICAgICAgICBpZiAoIXJlc3BvbnNlIHx8IHJlc3BvbnNlLnN0YXR1cyAhPT0gMjAwKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIF90aGlzNi4kTm90aWNlLmVycm9yKHsKICAgICAgICAgICAgICAgICAgICAgICAgICB0aXRsZTogJycsCiAgICAgICAgICAgICAgICAgICAgICAgICAgZGVzYzogJ+WIoOmZpOaVsOaNruWksei0pSwnICsgcmVzcG9uc2UuaW5mbwogICAgICAgICAgICAgICAgICAgICAgICB9KTsKCiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgIF90aGlzNi4kTm90aWNlLnN1Y2Nlc3MoewogICAgICAgICAgICAgICAgICAgICAgICAgIHRpdGxlOiAnJywKICAgICAgICAgICAgICAgICAgICAgICAgICBkZXNjOiAn5Yig6Zmk5oiQ5YqfIScKICAgICAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgICB9IC8v5Yig6ZmkaXRlbXPkuK3lt7LliKDpmaTnmoTpobkKCgogICAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coX3RoaXM2Lml0ZW1zKTsKCiAgICAgICAgICAgICAgICAgICAgICBfZGF0YXMuZm9yRWFjaChmdW5jdGlvbiAoZGF0YSkgewogICAgICAgICAgICAgICAgICAgICAgICBfdGhpczYuaXRlbXMuc29tZShmdW5jdGlvbiAoaXRlbSwgaW5kZXgpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoT2JqZWN0LmlzKGl0ZW0uc3Jma2V5LCBkYXRhLnNyZmtleSkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIF90aGlzNi5pdGVtcy5zcGxpY2UoaW5kZXgsIDEpOwoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIF90aGlzNi5ncmlkSXRlbXNNb2RlbC5zcGxpY2UoaW5kZXgsIDEpOwoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgICB9KTsKCiAgICAgICAgICAgICAgICAgICAgICBfdGhpczYudG90YWxyb3cgLT0gX2RhdGFzLmxlbmd0aDsKCiAgICAgICAgICAgICAgICAgICAgICBfdGhpczYuJGVtaXQoJ3JlbW92ZScsIG51bGwpOwoKICAgICAgICAgICAgICAgICAgICAgIF90aGlzNi5zZWxlY3Rpb25zID0gW107CiAgICAgICAgICAgICAgICAgICAgICByZXNvbHZlKHJlc3BvbnNlKTsKICAgICAgICAgICAgICAgICAgICB9KVsiY2F0Y2giXShmdW5jdGlvbiAocmVzcG9uc2UpIHsKICAgICAgICAgICAgICAgICAgICAgIGlmIChyZXNwb25zZSAmJiByZXNwb25zZS5zdGF0dXMgPT09IDQwMSkgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgICAgaWYgKCFyZXNwb25zZSB8fCAhcmVzcG9uc2Uuc3RhdHVzIHx8ICFyZXNwb25zZS5kYXRhKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIF90aGlzNi4kTm90aWNlLmVycm9yKHsKICAgICAgICAgICAgICAgICAgICAgICAgICB0aXRsZTogJ+mUmeivrycsCiAgICAgICAgICAgICAgICAgICAgICAgICAgZGVzYzogJ+ezu+e7n+W8guW4uCcKICAgICAgICAgICAgICAgICAgICAgICAgfSk7CgogICAgICAgICAgICAgICAgICAgICAgICByZWplY3QocmVzcG9uc2UpOwogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgICAgcmVqZWN0KHJlc3BvbnNlKTsKICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICB9OwoKICAgICAgICAgICAgICAgIGRhdGFJbmZvID0gZGF0YUluZm8ucmVwbGFjZSgvW251bGxdL2csICcnKS5yZXBsYWNlKC9bdW5kZWZpbmVkXS9nLCAnJyk7CiAgICAgICAgICAgICAgICB0aGlzLiRNb2RhbC5jb25maXJtKHsKICAgICAgICAgICAgICAgICAgdGl0bGU6ICforablkYonLAogICAgICAgICAgICAgICAgICBjb250ZW50OiAn56Gu6K6k6KaB5Yig6ZmkICcgKyBkYXRhSW5mbyArICfvvIzliKDpmaTmk43kvZzlsIbkuI3lj6/mgaLlpI3vvJ8nLAogICAgICAgICAgICAgICAgICBvbk9rOiBmdW5jdGlvbiBvbk9rKCkgewogICAgICAgICAgICAgICAgICAgIHJlbW92ZURhdGEoKTsKICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgb25DYW5jZWw6IGZ1bmN0aW9uIG9uQ2FuY2VsKCkge30KICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0Mi5hYnJ1cHQoInJldHVybiIsIHJlbW92ZURhdGEpOwoKICAgICAgICAgICAgICBjYXNlIDE0OgogICAgICAgICAgICAgIGNhc2UgImVuZCI6CiAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQyLnN0b3AoKTsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0sIF9jYWxsZWUyLCB0aGlzKTsKICAgICAgfSkpOwoKICAgICAgZnVuY3Rpb24gcmVtb3ZlKF94KSB7CiAgICAgICAgcmV0dXJuIF9yZW1vdmUuYXBwbHkodGhpcywgYXJndW1lbnRzKTsKICAgICAgfQoKICAgICAgcmV0dXJuIHJlbW92ZTsKICAgIH0oKQogICAgLyoqDQogICAgICog5om56YeP5re75YqgDQogICAgICoNCiAgICAgKiBAcGFyYW0geyp9IFthcmc9e31dDQogICAgICogQG1lbWJlcm9mIE1haW5fMkJhc2UNCiAgICAgKi8KCiAgfSwgewogICAga2V5OiAiYWRkQmF0Y2giLAogICAgdmFsdWU6IGZ1bmN0aW9uIGFkZEJhdGNoKCkgewogICAgICB2YXIgYXJnID0gYXJndW1lbnRzLmxlbmd0aCA+IDAgJiYgYXJndW1lbnRzWzBdICE9PSB1bmRlZmluZWQgPyBhcmd1bWVudHNbMF0gOiB7fTsKCiAgICAgIGlmICghdGhpcy5mZXRjaEFjdGlvbikgewogICAgICAgIHRoaXMuJE5vdGljZS5lcnJvcih7CiAgICAgICAgICB0aXRsZTogJ+mUmeivrycsCiAgICAgICAgICBkZXNjOiAnUElNQVJDSElWRVNDSEFOR0VEQURDSkxHcmlkVmlld+inhuWbvuihqOagvGZldGNoQWN0aW9u5Y+C5pWw5pyq6YWN572uJwogICAgICAgIH0pOwogICAgICAgIHJldHVybjsKICAgICAgfQoKICAgICAgaWYgKCFhcmcpIHsKICAgICAgICBhcmcgPSB7fTsKICAgICAgfQoKICAgICAgY29uc29sZS5lcnJvcigi5om56YeP5re75Yqg5pyq5a6e546wIik7CiAgICB9CiAgICAvKioNCiAgICAgKiDmlbDmja7lr7zlhaUNCiAgICAgKg0KICAgICAqIEBwYXJhbSB7Kn0gZGF0YQ0KICAgICAqIEBtZW1iZXJvZiBNYWluXzJCYXNlDQogICAgICovCgogIH0sIHsKICAgIGtleTogImltcG9ydEV4Y2VsIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBpbXBvcnRFeGNlbCgpIHsKICAgICAgdmFyIF90aGlzNyA9IHRoaXM7CgogICAgICB2YXIgZGF0YSA9IGFyZ3VtZW50cy5sZW5ndGggPiAwICYmIGFyZ3VtZW50c1swXSAhPT0gdW5kZWZpbmVkID8gYXJndW1lbnRzWzBdIDoge307CiAgICAgIC8v5a+85YWlZXhjZWwKICAgICAgdmFyIGltcG9ydERhdGFNb2RlbCA9IHt9OwoKICAgICAgaWYgKE9iamVjdC5rZXlzKGltcG9ydERhdGFNb2RlbCkubGVuZ3RoID09IDApIHsKICAgICAgICB0aGlzLiROb3RpY2Uud2FybmluZyh7CiAgICAgICAgICAndGl0bGUnOiB0aGlzLiR0KCJhcHAudXRpbHZpZXcud2FybmluZyIpLAogICAgICAgICAgJ2Rlc2MnOiB0aGlzLiR0KCJhcHAudXRpbHZpZXcuaW5mbyIpCiAgICAgICAgfSk7CiAgICAgICAgcmV0dXJuOwogICAgICB9CgogICAgICB2YXIgdmlldyA9IHsKICAgICAgICB2aWV3bmFtZTogJ2FwcC1kYXRhLXVwbG9hZCcsCiAgICAgICAgdGl0bGU6IHRoaXMuJHQoImFwcC51dGlsdmlldy5pbXBvcnR2aWV3IiksCiAgICAgICAgd2lkdGg6IDkwMCwKICAgICAgICBoZWlnaHQ6IDcwMAogICAgICB9OwogICAgICB2YXIgY29udGFpbmVyID0gdGhpcy4kYXBwbW9kYWwub3Blbk1vZGFsKHZpZXcsIEpTT04ucGFyc2UoSlNPTi5zdHJpbmdpZnkodGhpcy5jb250ZXh0KSksIGltcG9ydERhdGFNb2RlbCk7CiAgICAgIGNvbnRhaW5lci5zdWJzY3JpYmUoZnVuY3Rpb24gKHJlc3VsdCkgewogICAgICAgIGlmIChPYmplY3QuaXMocmVzdWx0LnJldCwgJ09LJykpIHsKICAgICAgICAgIF90aGlzNy5yZWZyZXNoKHJlc3VsdC5kYXRhcyk7CiAgICAgICAgfQogICAgICB9KTsKICAgIH0KICAgIC8qKg0KICAgICAqIOaVsOaNruWvvOWHug0KICAgICAqDQogICAgICogQHBhcmFtIHsqfSBkYXRhDQogICAgICogQG1lbWJlcm9mIE1haW5fMkJhc2UNCiAgICAgKi8KCiAgfSwgewogICAga2V5OiAiZXhwb3J0RXhjZWwiLAogICAgdmFsdWU6IGZ1bmN0aW9uIGV4cG9ydEV4Y2VsKCkgewogICAgICB2YXIgX3RoaXM4ID0gdGhpczsKCiAgICAgIHZhciBkYXRhID0gYXJndW1lbnRzLmxlbmd0aCA+IDAgJiYgYXJndW1lbnRzWzBdICE9PSB1bmRlZmluZWQgPyBhcmd1bWVudHNbMF0gOiB7fTsKCiAgICAgIC8vIOWvvOWHukV4Y2VsCiAgICAgIHZhciBkb0V4cG9ydCA9CiAgICAgIC8qI19fUFVSRV9fKi8KICAgICAgZnVuY3Rpb24gKCkgewogICAgICAgIHZhciBfcmVmMiA9IF9hc3luY1RvR2VuZXJhdG9yKAogICAgICAgIC8qI19fUFVSRV9fKi8KICAgICAgICByZWdlbmVyYXRvclJ1bnRpbWUubWFyayhmdW5jdGlvbiBfY2FsbGVlMyhfZGF0YSkgewogICAgICAgICAgdmFyIHRIZWFkZXIsIGZpbHRlclZhbCwgZGF0YTsKICAgICAgICAgIHJldHVybiByZWdlbmVyYXRvclJ1bnRpbWUud3JhcChmdW5jdGlvbiBfY2FsbGVlMyQoX2NvbnRleHQzKSB7CiAgICAgICAgICAgIHdoaWxlICgxKSB7CiAgICAgICAgICAgICAgc3dpdGNoIChfY29udGV4dDMucHJldiA9IF9jb250ZXh0My5uZXh0KSB7CiAgICAgICAgICAgICAgICBjYXNlIDA6CiAgICAgICAgICAgICAgICAgIHRIZWFkZXIgPSBbXTsKICAgICAgICAgICAgICAgICAgZmlsdGVyVmFsID0gW107CgogICAgICAgICAgICAgICAgICBfdGhpczguYWxsQ29sdW1ucy5mb3JFYWNoKGZ1bmN0aW9uIChpdGVtKSB7CiAgICAgICAgICAgICAgICAgICAgaXRlbS5zaG93ICYmIGl0ZW0ubGFiZWwgPyB0SGVhZGVyLnB1c2goX3RoaXM4LiR0KGl0ZW0ubGFuZ3RhZykpIDogIiI7CiAgICAgICAgICAgICAgICAgICAgaXRlbS5zaG93ICYmIGl0ZW0ubmFtZSA/IGZpbHRlclZhbC5wdXNoKGl0ZW0ubmFtZSkgOiAiIjsKICAgICAgICAgICAgICAgICAgfSk7CgogICAgICAgICAgICAgICAgICBfY29udGV4dDMubmV4dCA9IDU7CiAgICAgICAgICAgICAgICAgIHJldHVybiBfdGhpczguZm9ybWF0RXhjZWxEYXRhKGZpbHRlclZhbCwgX2RhdGEpOwoKICAgICAgICAgICAgICAgIGNhc2UgNToKICAgICAgICAgICAgICAgICAgZGF0YSA9IF9jb250ZXh0My5zZW50OwoKICAgICAgICAgICAgICAgICAgX3RoaXM4LiRleHBvcnQuZXhwb3J0RXhjZWwoKS50aGVuKGZ1bmN0aW9uIChleGNlbCkgewogICAgICAgICAgICAgICAgICAgIGV4Y2VsLmV4cG9ydF9qc29uX3RvX2V4Y2VsKHsKICAgICAgICAgICAgICAgICAgICAgIGhlYWRlcjogdEhlYWRlciwKICAgICAgICAgICAgICAgICAgICAgIGRhdGE6IGRhdGEsCiAgICAgICAgICAgICAgICAgICAgICBmaWxlbmFtZTogIuaho+ahiOW9kuaho+WcsOWPmOabtOiusOW9leihqCIsCiAgICAgICAgICAgICAgICAgICAgICBhdXRvV2lkdGg6IHRydWUsCiAgICAgICAgICAgICAgICAgICAgICBib29rVHlwZTogInhsc3giIC8v6Z2e5b+F5aGrCgogICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICB9KTsKCiAgICAgICAgICAgICAgICBjYXNlIDc6CiAgICAgICAgICAgICAgICBjYXNlICJlbmQiOgogICAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQzLnN0b3AoKTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgIH0sIF9jYWxsZWUzKTsKICAgICAgICB9KSk7CgogICAgICAgIHJldHVybiBmdW5jdGlvbiBkb0V4cG9ydChfeDIpIHsKICAgICAgICAgIHJldHVybiBfcmVmMi5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwogICAgICAgIH07CiAgICAgIH0oKTsKCiAgICAgIHZhciBwYWdlID0ge307IC8vIOiuvue9rnBhZ2XvvIxzaXplCgogICAgICBpZiAoT2JqZWN0LmlzKGRhdGEudHlwZSwgJ21heFJvd0NvdW50JykpIHsKICAgICAgICBPYmplY3QuYXNzaWduKHBhZ2UsIHsKICAgICAgICAgIHBhZ2U6IDAsCiAgICAgICAgICBzaXplOiBkYXRhLm1heFJvd0NvdW50CiAgICAgICAgfSk7CiAgICAgIH0gZWxzZSBpZiAoT2JqZWN0LmlzKGRhdGEudHlwZSwgJ2FjdGl2YXRlZFBhZ2UnKSkgewogICAgICAgIHRyeSB7CiAgICAgICAgICBkb0V4cG9ydChKU09OLnBhcnNlKEpTT04uc3RyaW5naWZ5KHRoaXMuaXRlbXMpKSk7CiAgICAgICAgfSBjYXRjaCAoZXJyb3IpIHsKICAgICAgICAgIGNvbnNvbGUuZXJyb3IoZXJyb3IpOwogICAgICAgIH0KCiAgICAgICAgcmV0dXJuOwogICAgICB9IC8vIOiuvue9ruaOkuW6jwoKCiAgICAgIGlmICghdGhpcy5pc05vU29ydCAmJiAhT2JqZWN0LmlzKHRoaXMubWlub3JTb3J0RGlyLCAnJykgJiYgIU9iamVjdC5pcyh0aGlzLm1pbm9yU29ydFBTREVGLCAnJykpIHsKICAgICAgICB2YXIgc29ydCA9IHRoaXMubWlub3JTb3J0UFNERUYgKyAiLCIgKyB0aGlzLm1pbm9yU29ydERpcjsKICAgICAgICBPYmplY3QuYXNzaWduKHBhZ2UsIHsKICAgICAgICAgIHNvcnQ6IHNvcnQKICAgICAgICB9KTsKICAgICAgfQoKICAgICAgdmFyIGFyZyA9IHt9OwogICAgICBPYmplY3QuYXNzaWduKGFyZywgcGFnZSk7IC8vIOiOt+WPlnF1ZXJ5LOaQnOe0ouihqOWNle+8jHZpZXdwYXJhbXPnrYnniLbmlbDmja4KCiAgICAgIHZhciBwYXJlbnRkYXRhID0ge307CiAgICAgIHRoaXMuJGVtaXQoJ2JlZm9yZWxvYWQnLCBwYXJlbnRkYXRhKTsKICAgICAgT2JqZWN0LmFzc2lnbihhcmcsIHBhcmVudGRhdGEpOwogICAgICB2YXIgcG9zdCA9IHRoaXMuc2VydmljZS5zZWFyY2godGhpcy5mZXRjaEFjdGlvbiwgSlNPTi5wYXJzZShKU09OLnN0cmluZ2lmeSh0aGlzLmNvbnRleHQpKSwgYXJnLCB0aGlzLnNob3dCdXN5SW5kaWNhdG9yKTsKICAgICAgcG9zdC50aGVuKGZ1bmN0aW9uIChyZXNwb25zZSkgewogICAgICAgIGlmICghcmVzcG9uc2UgfHwgcmVzcG9uc2Uuc3RhdHVzICE9PSAyMDApIHsKICAgICAgICAgIF90aGlzOC4kTm90aWNlLmVycm9yKHsKICAgICAgICAgICAgdGl0bGU6ICcnLAogICAgICAgICAgICBkZXNjOiAn5pWw5o2u5a+85Ye65aSx6LSlLCcgKyByZXNwb25zZS5pbmZvCiAgICAgICAgICB9KTsKCiAgICAgICAgICByZXR1cm47CiAgICAgICAgfQoKICAgICAgICB0cnkgewogICAgICAgICAgZG9FeHBvcnQoSlNPTi5wYXJzZShKU09OLnN0cmluZ2lmeShyZXNwb25zZS5kYXRhKSkpOwogICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7CiAgICAgICAgICBjb25zb2xlLmVycm9yKGVycm9yKTsKICAgICAgICB9CiAgICAgIH0pWyJjYXRjaCJdKGZ1bmN0aW9uIChyZXNwb25zZSkgewogICAgICAgIGlmIChyZXNwb25zZSAmJiByZXNwb25zZS5zdGF0dXMgPT09IDQwMSkgewogICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KCiAgICAgICAgX3RoaXM4LiROb3RpY2UuZXJyb3IoewogICAgICAgICAgdGl0bGU6ICcnLAogICAgICAgICAgZGVzYzogJ+aVsOaNruWvvOWHuuWksei0pScKICAgICAgICB9KTsKICAgICAgfSk7CiAgICB9CiAgICAvKioNCiAgICAgKiDlr7zlh7rmlbDmja7moLzlvI/ljJYNCiAgICAgKg0KICAgICAqIEBwYXJhbSB7Kn0gZmlsdGVyVmFsDQogICAgICogQHBhcmFtIHsqfSBqc29uRGF0YQ0KICAgICAqIEByZXR1cm5zIHtbXX0NCiAgICAgKiBAbWVtYmVyb2YgTWFpbl8yQmFzZQ0KICAgICAqLwoKICB9LCB7CiAgICBrZXk6ICJmb3JtYXRFeGNlbERhdGEiLAogICAgdmFsdWU6IGZ1bmN0aW9uICgpIHsKICAgICAgdmFyIF9mb3JtYXRFeGNlbERhdGEgPSBfYXN5bmNUb0dlbmVyYXRvcigKICAgICAgLyojX19QVVJFX18qLwogICAgICByZWdlbmVyYXRvclJ1bnRpbWUubWFyayhmdW5jdGlvbiBfY2FsbGVlNChmaWx0ZXJWYWwsIGpzb25EYXRhKSB7CiAgICAgICAgdmFyIGNvZGVsaXN0Q29sdW1ucywgX3RoaXMsIF9sb29wLCBfaTIsIF9jb2RlbGlzdENvbHVtbnM7CgogICAgICAgIHJldHVybiByZWdlbmVyYXRvclJ1bnRpbWUud3JhcChmdW5jdGlvbiBfY2FsbGVlNCQoX2NvbnRleHQ1KSB7CiAgICAgICAgICB3aGlsZSAoMSkgewogICAgICAgICAgICBzd2l0Y2ggKF9jb250ZXh0NS5wcmV2ID0gX2NvbnRleHQ1Lm5leHQpIHsKICAgICAgICAgICAgICBjYXNlIDA6CiAgICAgICAgICAgICAgICBjb2RlbGlzdENvbHVtbnMgPSBbXTsKICAgICAgICAgICAgICAgIF90aGlzID0gdGhpczsKICAgICAgICAgICAgICAgIF9sb29wID0KICAgICAgICAgICAgICAgIC8qI19fUFVSRV9fKi8KICAgICAgICAgICAgICAgIHJlZ2VuZXJhdG9yUnVudGltZS5tYXJrKGZ1bmN0aW9uIF9sb29wKCkgewogICAgICAgICAgICAgICAgICB2YXIgY29kZWxpc3QsIGl0ZW1zLCBfaXRlbXM7CgogICAgICAgICAgICAgICAgICByZXR1cm4gcmVnZW5lcmF0b3JSdW50aW1lLndyYXAoZnVuY3Rpb24gX2xvb3AkKF9jb250ZXh0NCkgewogICAgICAgICAgICAgICAgICAgIHdoaWxlICgxKSB7CiAgICAgICAgICAgICAgICAgICAgICBzd2l0Y2ggKF9jb250ZXh0NC5wcmV2ID0gX2NvbnRleHQ0Lm5leHQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAwOgogICAgICAgICAgICAgICAgICAgICAgICAgIGNvZGVsaXN0ID0gX2NvZGVsaXN0Q29sdW1uc1tfaTJdOwoKICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoIU9iamVjdC5pcyhjb2RlbGlzdC5jb2RlbGlzdFR5cGUsICJEWU5BTUlDIikpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIF9jb250ZXh0NC5uZXh0ID0gODsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgICAgICAgX2NvbnRleHQ0Lm5leHQgPSA0OwogICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBfdGhpcy5jb2RlTGlzdFNlcnZpY2UuZ2V0SXRlbXMoY29kZWxpc3Quc3Jma2V5KTsKCiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgNDoKICAgICAgICAgICAgICAgICAgICAgICAgICBpdGVtcyA9IF9jb250ZXh0NC5zZW50OwogICAgICAgICAgICAgICAgICAgICAgICAgIGpzb25EYXRhLmZvckVhY2goZnVuY3Rpb24gKHJvdykgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgcm93W2NvZGVsaXN0Lm5hbWVdID0gX3RoaXMuZ2V0Q29kZWxpc3RWYWx1ZShpdGVtcywgcm93W2NvZGVsaXN0Lm5hbWVdLCBjb2RlbGlzdCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7IC8vIOmdmeaAgeWkhOeQhgoKICAgICAgICAgICAgICAgICAgICAgICAgICBfY29udGV4dDQubmV4dCA9IDEzOwogICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSA4OgogICAgICAgICAgICAgICAgICAgICAgICAgIGlmICghT2JqZWN0LmlzKGNvZGVsaXN0LmNvZGVsaXN0VHlwZSwgIlNUQVRJQyIpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBfY29udGV4dDQubmV4dCA9IDEzOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICAgICAgICBfY29udGV4dDQubmV4dCA9IDExOwogICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBfdGhpcy4kc3RvcmUuZ2V0dGVycy5nZXRDb2RlTGlzdEl0ZW1zKGNvZGVsaXN0LnNyZmtleSk7CgogICAgICAgICAgICAgICAgICAgICAgICBjYXNlIDExOgogICAgICAgICAgICAgICAgICAgICAgICAgIF9pdGVtcyA9IF9jb250ZXh0NC5zZW50OwogICAgICAgICAgICAgICAgICAgICAgICAgIGpzb25EYXRhLmZvckVhY2goZnVuY3Rpb24gKHJvdykgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgcm93W2NvZGVsaXN0Lm5hbWVdID0gX3RoaXMuZ2V0Q29kZWxpc3RWYWx1ZShfaXRlbXMsIHJvd1tjb2RlbGlzdC5uYW1lXSwgY29kZWxpc3QpOwogICAgICAgICAgICAgICAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAxMzoKICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAiZW5kIjoKICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQ0LnN0b3AoKTsKICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgIH0sIF9sb29wKTsKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgX2kyID0gMCwgX2NvZGVsaXN0Q29sdW1ucyA9IGNvZGVsaXN0Q29sdW1uczsKCiAgICAgICAgICAgICAgY2FzZSA0OgogICAgICAgICAgICAgICAgaWYgKCEoX2kyIDwgX2NvZGVsaXN0Q29sdW1ucy5sZW5ndGgpKSB7CiAgICAgICAgICAgICAgICAgIF9jb250ZXh0NS5uZXh0ID0gOTsKICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0NS5kZWxlZ2F0ZVlpZWxkKF9sb29wKCksICJ0MCIsIDYpOwoKICAgICAgICAgICAgICBjYXNlIDY6CiAgICAgICAgICAgICAgICBfaTIrKzsKICAgICAgICAgICAgICAgIF9jb250ZXh0NS5uZXh0ID0gNDsKICAgICAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgICAgICBjYXNlIDk6CiAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQ1LmFicnVwdCgicmV0dXJuIiwganNvbkRhdGEubWFwKGZ1bmN0aW9uICh2KSB7CiAgICAgICAgICAgICAgICAgIHJldHVybiBmaWx0ZXJWYWwubWFwKGZ1bmN0aW9uIChqKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHZbal07CiAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgfSkpOwoKICAgICAgICAgICAgICBjYXNlIDEwOgogICAgICAgICAgICAgIGNhc2UgImVuZCI6CiAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQ1LnN0b3AoKTsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0sIF9jYWxsZWU0LCB0aGlzKTsKICAgICAgfSkpOwoKICAgICAgZnVuY3Rpb24gZm9ybWF0RXhjZWxEYXRhKF94MywgX3g0KSB7CiAgICAgICAgcmV0dXJuIF9mb3JtYXRFeGNlbERhdGEuYXBwbHkodGhpcywgYXJndW1lbnRzKTsKICAgICAgfQoKICAgICAgcmV0dXJuIGZvcm1hdEV4Y2VsRGF0YTsKICAgIH0oKQogICAgLyoqDQogICAgICog6Kej5p6Q5Luj56CB6KGo5ZKMdmxhdWXvvIzorr7nva5pdGVtcw0KICAgICAqDQogICAgICogQHB1YmxpYw0KICAgICAqIEBwYXJhbSB7YW55W119IGl0ZW1zIOS7o+eggeihqOaVsOaNrg0KICAgICAqIEBwYXJhbSB7Kn0gdmFsdWUNCiAgICAgKiBAcmV0dXJucyB7Kn0NCiAgICAgKiBAbWVtYmVyb2YgTWFpbl8yQmFzZQ0KICAgICAqLwoKICB9LCB7CiAgICBrZXk6ICJnZXRDb2RlbGlzdFZhbHVlIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBnZXRDb2RlbGlzdFZhbHVlKGl0ZW1zLCB2YWx1ZSwgY29kZWxpc3QpIHsKICAgICAgdmFyIF90aGlzOSA9IHRoaXM7CgogICAgICBpZiAoIXZhbHVlKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuJHQoJ2NvZGVsaXN0LicgKyBjb2RlbGlzdC5zcmZrZXkgKyAnLmVtcHR5Jyk7CiAgICAgIH0KCiAgICAgIGlmIChpdGVtcykgewogICAgICAgIHZhciByZXN1bHQgPSBbXTsKCiAgICAgICAgaWYgKE9iamVjdC5pcyhjb2RlbGlzdC5yZW5kZXJNb2RlLCAibnVtYmVyIikpIHsKICAgICAgICAgIGl0ZW1zLm1hcChmdW5jdGlvbiAoX2l0ZW0sIGluZGV4KSB7CiAgICAgICAgICAgIHZhciBuVmFsdWUgPSBwYXJzZUludCh2YWx1ZSwgMTApOwogICAgICAgICAgICB2YXIgY29kZXZhbHVlID0gX2l0ZW0udmFsdWU7CgogICAgICAgICAgICBpZiAoKHBhcnNlSW50KGNvZGV2YWx1ZSwgMTApICYgblZhbHVlKSA+IDApIHsKICAgICAgICAgICAgICByZXN1bHQucHVzaChfaXRlbSk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0pOwogICAgICAgIH0gZWxzZSBpZiAoT2JqZWN0LmlzKGNvZGVsaXN0LnJlbmRlck1vZGUsICJzdHJpbmciKSkgewogICAgICAgICAgdmFyIGFycmF5VmFsdWUgPSB2YWx1ZS5zcGxpdChjb2RlbGlzdC52YWx1ZVNlcGFyYXRvcik7CiAgICAgICAgICBhcnJheVZhbHVlLm1hcChmdW5jdGlvbiAodmFsdWUsIGluZGV4KSB7CiAgICAgICAgICAgIHJlc3VsdC5wdXNoKFtdKTsKICAgICAgICAgICAgdmFyIHZhbHVlcyA9IE9iamVjdC5pcyhfdGhpczkuJHV0aWwudHlwZU9mKHZhbHVlKSwgJ251bWJlcicpID8gW3ZhbHVlXSA6IF90b0NvbnN1bWFibGVBcnJheSh2YWx1ZS5zcGxpdChjb2RlbGlzdC52YWx1ZVNlcGFyYXRvcikpOwogICAgICAgICAgICB2YWx1ZXMubWFwKGZ1bmN0aW9uICh2YWwsIG51bSkgewogICAgICAgICAgICAgIHZhciBpdGVtID0gX3RoaXM5LmdldEl0ZW0oaXRlbXMsIHZhbCwgY29kZWxpc3QpOwoKICAgICAgICAgICAgICBpZiAoaXRlbSkgewogICAgICAgICAgICAgICAgcmVzdWx0W2luZGV4XS5wdXNoKGl0ZW0pOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSk7CiAgICAgICAgICB9KTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgdmFyIHZhbHVlcyA9IE9iamVjdC5pcyh0aGlzLiR1dGlsLnR5cGVPZih2YWx1ZSksICdudW1iZXInKSA/IFt2YWx1ZV0gOiBfdG9Db25zdW1hYmxlQXJyYXkodmFsdWUuc3BsaXQoY29kZWxpc3QudmFsdWVTZXBhcmF0b3IpKTsKICAgICAgICAgIHZhbHVlcy5tYXAoZnVuY3Rpb24gKHZhbHVlLCBpbmRleCkgewogICAgICAgICAgICB2YXIgaXRlbSA9IF90aGlzOS5nZXRJdGVtKGl0ZW1zLCB2YWx1ZSwgY29kZWxpc3QpOwoKICAgICAgICAgICAgaWYgKGl0ZW0pIHsKICAgICAgICAgICAgICByZXN1bHQucHVzaChpdGVtKTsKICAgICAgICAgICAgfQogICAgICAgICAgfSk7CiAgICAgICAgfSAvLyDorr7nva5pdGVtcwoKCiAgICAgICAgaWYgKHJlc3VsdC5sZW5ndGggIT0gMCkgewogICAgICAgICAgcmV0dXJuIHJlc3VsdC5qb2luKGNvZGVsaXN0LnZhbHVlU2VwYXJhdG9yKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgcmV0dXJuIHZhbHVlOwogICAgICAgIH0KICAgICAgfQogICAgfQogICAgLyoqDQogICAgICog6I635Y+W5Luj56CB6aG5DQogICAgICoNCiAgICAgKiBAcHVibGljDQogICAgICogQHBhcmFtIHthbnlbXX0gaXRlbXMNCiAgICAgKiBAcGFyYW0geyp9IHZhbHVlDQogICAgICogQHJldHVybnMgeyp9DQogICAgICogQG1lbWJlcm9mIE1haW5fMkJhc2UNCiAgICAgKi8KCiAgfSwgewogICAga2V5OiAiZ2V0SXRlbSIsCiAgICB2YWx1ZTogZnVuY3Rpb24gZ2V0SXRlbShpdGVtcywgdmFsdWUsIGNvZGVsaXN0KSB7CiAgICAgIHZhciBhcnIgPSBpdGVtcy5maWx0ZXIoZnVuY3Rpb24gKGl0ZW0pIHsKICAgICAgICByZXR1cm4gaXRlbS52YWx1ZSA9PSB2YWx1ZTsKICAgICAgfSk7CgogICAgICBpZiAoYXJyLmxlbmd0aCAhPT0gMSkgewogICAgICAgIHJldHVybiB1bmRlZmluZWQ7CiAgICAgIH0KCiAgICAgIGlmIChPYmplY3QuaXMoY29kZWxpc3QuY29kZWxpc3RUeXBlLCAnU1RBVElDJykpIHsKICAgICAgICByZXR1cm4gdGhpcy4kdCgnY29kZWxpc3QuJyArIGNvZGVsaXN0LnNyZmtleSArICcuJyArIGFyclswXS52YWx1ZSk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgcmV0dXJuIGFyclswXS50ZXh0OwogICAgICB9CiAgICB9CiAgICAvKioNCiAgICAgKiDnlJ/lkb3lkajmnJ8NCiAgICAgKg0KICAgICAqIEBtZW1iZXJvZiBNYWluXzJCYXNlDQogICAgICovCgogIH0sIHsKICAgIGtleTogImNyZWF0ZWQiLAogICAgdmFsdWU6IGZ1bmN0aW9uIGNyZWF0ZWQoKSB7CiAgICAgIHRoaXMuYWZ0ZXJDcmVhdGVkKCk7CiAgICB9CiAgICAvKioNCiAgICAgKiDmiafooYxjcmVhdGVk5ZCO55qE6YC76L6RDQogICAgICoNCiAgICAgKiAgQG1lbWJlcm9mIE1haW5fMkJhc2UNCiAgICAgKi8KCiAgfSwgewogICAga2V5OiAiYWZ0ZXJDcmVhdGVkIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBhZnRlckNyZWF0ZWQoKSB7CiAgICAgIHZhciBfdGhpczEwID0gdGhpczsKCiAgICAgIHRoaXMuc2V0Q29sU3RhdGUoKTsKCiAgICAgIGlmICh0aGlzLnZpZXdTdGF0ZSkgewogICAgICAgIHRoaXMudmlld1N0YXRlRXZlbnQgPSB0aGlzLnZpZXdTdGF0ZS5zdWJzY3JpYmUoZnVuY3Rpb24gKF9yZWYzKSB7CiAgICAgICAgICB2YXIgdGFnID0gX3JlZjMudGFnLAogICAgICAgICAgICAgIGFjdGlvbiA9IF9yZWYzLmFjdGlvbiwKICAgICAgICAgICAgICBkYXRhID0gX3JlZjMuZGF0YTsKCiAgICAgICAgICBpZiAoIU9iamVjdC5pcyh0YWcsIF90aGlzMTAubmFtZSkpIHsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgfQoKICAgICAgICAgIGlmIChPYmplY3QuaXMoJ2xvYWQnLCBhY3Rpb24pKSB7CiAgICAgICAgICAgIF90aGlzMTAubG9hZChkYXRhKTsKICAgICAgICAgIH0KCiAgICAgICAgICBpZiAoT2JqZWN0LmlzKCdyZW1vdmUnLCBhY3Rpb24pKSB7CiAgICAgICAgICAgIF90aGlzMTAucmVtb3ZlKGRhdGEpOwogICAgICAgICAgfQoKICAgICAgICAgIGlmIChPYmplY3QuaXMoJ3NhdmUnLCBhY3Rpb24pKSB7CiAgICAgICAgICAgIF90aGlzMTAuc2F2ZShkYXRhKTsKICAgICAgICAgIH0KICAgICAgICB9KTsKICAgICAgfQogICAgfQogICAgLyoqDQogICAgICogdnVlIOeUn+WRveWRqOacnw0KICAgICAqDQogICAgICogQG1lbWJlcm9mIE1haW5fMkJhc2UNCiAgICAgKi8KCiAgfSwgewogICAga2V5OiAiZGVzdHJveWVkIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBkZXN0cm95ZWQoKSB7CiAgICAgIHRoaXMuYWZ0ZXJEZXN0cm95KCk7CiAgICB9CiAgICAvKioNCiAgICAgKiDmiafooYxkZXN0cm95ZWTlkI7nmoTpgLvovpENCiAgICAgKg0KICAgICAqIEBtZW1iZXJvZiBNYWluXzJCYXNlDQogICAgICovCgogIH0sIHsKICAgIGtleTogImFmdGVyRGVzdHJveSIsCiAgICB2YWx1ZTogZnVuY3Rpb24gYWZ0ZXJEZXN0cm95KCkgewogICAgICBpZiAodGhpcy52aWV3U3RhdGVFdmVudCkgewogICAgICAgIHRoaXMudmlld1N0YXRlRXZlbnQudW5zdWJzY3JpYmUoKTsKICAgICAgfQogICAgfQogICAgLyoqDQogICAgICog6I635Y+W6YCJ5Lit6KGM6IOh5pWw5o2uDQogICAgICoNCiAgICAgKiBAcmV0dXJucyB7YW55W119DQogICAgICogQG1lbWJlcm9mIE1haW5fMkJhc2UNCiAgICAgKi8KCiAgfSwgewogICAga2V5OiAiZ2V0U2VsZWN0aW9uIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBnZXRTZWxlY3Rpb24oKSB7CiAgICAgIHJldHVybiB0aGlzLnNlbGVjdGlvbnM7CiAgICB9CiAgICAvKioNCiAgICAgKiDooYzlj4zlh7vkuovku7YNCiAgICAgKg0KICAgICAqIEBwYXJhbSB7Kn0gJGV2ZW50DQogICAgICogQHJldHVybnMge3ZvaWR9DQogICAgICogQG1lbWJlcm9mIE1haW5fMkJhc2UNCiAgICAgKi8KCiAgfSwgewogICAga2V5OiAicm93REJMQ2xpY2siLAogICAgdmFsdWU6IGZ1bmN0aW9uIHJvd0RCTENsaWNrKCRldmVudCkgewogICAgICBpZiAoISRldmVudCB8fCB0aGlzLmFjdHVhbElzT3BlbkVkaXQgfHwgT2JqZWN0LmlzKHRoaXMuZ3JpZFJvd0FjdGl2ZU1vZGUsIDApKSB7CiAgICAgICAgcmV0dXJuOwogICAgICB9CgogICAgICB0aGlzLnNlbGVjdGlvbnMgPSBbXTsKICAgICAgdGhpcy5zZWxlY3Rpb25zLnB1c2goSlNPTi5wYXJzZShKU09OLnN0cmluZ2lmeSgkZXZlbnQpKSk7CiAgICAgIHZhciByZWZzID0gdGhpcy4kcmVmczsKCiAgICAgIGlmIChyZWZzLm11bHRpcGxlVGFibGUpIHsKICAgICAgICByZWZzLm11bHRpcGxlVGFibGUuY2xlYXJTZWxlY3Rpb24oKTsKICAgICAgICByZWZzLm11bHRpcGxlVGFibGUudG9nZ2xlUm93U2VsZWN0aW9uKCRldmVudCk7CiAgICAgIH0KCiAgICAgIHRoaXMuJGVtaXQoJ3Jvd2RibGNsaWNrJywgdGhpcy5zZWxlY3Rpb25zKTsKICAgICAgdGhpcy4kZW1pdCgnc2VsZWN0aW9uY2hhbmdlJywgdGhpcy5zZWxlY3Rpb25zKTsKICAgIH0KICAgIC8qKg0KICAgICAqIOWkjemAieahhuaVsOaNrumAieS4rQ0KICAgICAqDQogICAgICogQHBhcmFtIHsqfSAkZXZlbnQNCiAgICAgKiBAcmV0dXJucyB7dm9pZH0NCiAgICAgKiBAbWVtYmVyb2YgTWFpbl8yQmFzZQ0KICAgICAqLwoKICB9LCB7CiAgICBrZXk6ICJzZWxlY3QiLAogICAgdmFsdWU6IGZ1bmN0aW9uIHNlbGVjdCgkZXZlbnQpIHsKICAgICAgaWYgKCEkZXZlbnQpIHsKICAgICAgICByZXR1cm47CiAgICAgIH0KCiAgICAgIHRoaXMuc2VsZWN0aW9ucyA9IFtdOwogICAgICB0aGlzLnNlbGVjdGlvbnMgPSBfdG9Db25zdW1hYmxlQXJyYXkoSlNPTi5wYXJzZShKU09OLnN0cmluZ2lmeSgkZXZlbnQpKSk7CiAgICAgIHRoaXMuJGVtaXQoJ3NlbGVjdGlvbmNoYW5nZScsIHRoaXMuc2VsZWN0aW9ucyk7CiAgICB9CiAgICAvKioNCiAgICAgKiDlpI3pgInmoYbmlbDmja7lhajpg6jpgInkuK0NCiAgICAgKg0KICAgICAqIEBwYXJhbSB7Kn0gJGV2ZW50DQogICAgICogQG1lbWJlcm9mIE1haW5fMkJhc2UNCiAgICAgKi8KCiAgfSwgewogICAga2V5OiAic2VsZWN0QWxsIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBzZWxlY3RBbGwoJGV2ZW50KSB7CiAgICAgIGlmICghJGV2ZW50KSB7CiAgICAgICAgcmV0dXJuOwogICAgICB9CgogICAgICB0aGlzLnNlbGVjdGlvbnMgPSBbXTsKICAgICAgdGhpcy5zZWxlY3Rpb25zID0gX3RvQ29uc3VtYWJsZUFycmF5KEpTT04ucGFyc2UoSlNPTi5zdHJpbmdpZnkoJGV2ZW50KSkpOwogICAgICB0aGlzLiRlbWl0KCdzZWxlY3Rpb25jaGFuZ2UnLCB0aGlzLnNlbGVjdGlvbnMpOwogICAgfQogICAgLyoqDQogICAgICog6KGM5Y2V5Ye76YCJ5LitDQogICAgICoNCiAgICAgKiBAcGFyYW0geyp9ICRldmVudA0KICAgICAqIEByZXR1cm5zIHt2b2lkfQ0KICAgICAqIEBtZW1iZXJvZiBNYWluXzJCYXNlDQogICAgICovCgogIH0sIHsKICAgIGtleTogInJvd0NsaWNrIiwKICAgIHZhbHVlOiBmdW5jdGlvbiByb3dDbGljaygkZXZlbnQpIHsKICAgICAgdmFyIGlmQWx3YXlzID0gYXJndW1lbnRzLmxlbmd0aCA+IDEgJiYgYXJndW1lbnRzWzFdICE9PSB1bmRlZmluZWQgPyBhcmd1bWVudHNbMV0gOiBmYWxzZTsKCiAgICAgIGlmICghaWZBbHdheXMgJiYgKCEkZXZlbnQgfHwgdGhpcy5hY3R1YWxJc09wZW5FZGl0KSkgewogICAgICAgIHJldHVybjsKICAgICAgfQoKICAgICAgaWYgKHRoaXMuc3RvcFJvd0NsaWNrKSB7CiAgICAgICAgdGhpcy5zdG9wUm93Q2xpY2sgPSBmYWxzZTsKICAgICAgICByZXR1cm47CiAgICAgIH0KCiAgICAgIGlmICh0aGlzLmlzU2luZ2xlU2VsZWN0KSB7CiAgICAgICAgdGhpcy5zZWxlY3Rpb25zID0gW107CiAgICAgIH0gLy8g5bey6YCJ5Lit5YiZ5Yig6Zmk77yM5rKh6YCJ5Lit5YiZ5re75YqgCgoKICAgICAgdmFyIHNlbGVjdEluZGV4ID0gdGhpcy5zZWxlY3Rpb25zLmZpbmRJbmRleChmdW5jdGlvbiAoaXRlbSkgewogICAgICAgIHJldHVybiBPYmplY3QuaXMoaXRlbS5waW1hcmNoaXZlc2NoYW5nZSwgJGV2ZW50LnBpbWFyY2hpdmVzY2hhbmdlKTsKICAgICAgfSk7CgogICAgICBpZiAoT2JqZWN0LmlzKHNlbGVjdEluZGV4LCAtMSkpIHsKICAgICAgICB0aGlzLnNlbGVjdGlvbnMucHVzaChKU09OLnBhcnNlKEpTT04uc3RyaW5naWZ5KCRldmVudCkpKTsKICAgICAgfSBlbHNlIHsKICAgICAgICB0aGlzLnNlbGVjdGlvbnMuc3BsaWNlKHNlbGVjdEluZGV4LCAxKTsKICAgICAgfQoKICAgICAgdmFyIHJlZnMgPSB0aGlzLiRyZWZzOwoKICAgICAgaWYgKHJlZnMubXVsdGlwbGVUYWJsZSkgewogICAgICAgIGlmICh0aGlzLmlzU2luZ2xlU2VsZWN0KSB7CiAgICAgICAgICByZWZzLm11bHRpcGxlVGFibGUuY2xlYXJTZWxlY3Rpb24oKTsKICAgICAgICAgIHJlZnMubXVsdGlwbGVUYWJsZS5zZXRDdXJyZW50Um93KCRldmVudCk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIHJlZnMubXVsdGlwbGVUYWJsZS50b2dnbGVSb3dTZWxlY3Rpb24oJGV2ZW50KTsKICAgICAgICB9CiAgICAgIH0KCiAgICAgIHRoaXMuJGVtaXQoJ3NlbGVjdGlvbmNoYW5nZScsIHRoaXMuc2VsZWN0aW9ucyk7CiAgICB9CiAgICAvKioNCiAgICAgKiDpobXpnaLlj5jljJYNCiAgICAgKg0KICAgICAqIEBwYXJhbSB7Kn0gJGV2ZW50DQogICAgICogQHJldHVybnMge3ZvaWR9DQogICAgICogQG1lbWJlcm9mIE1haW5fMkJhc2UNCiAgICAgKi8KCiAgfSwgewogICAga2V5OiAicGFnZU9uQ2hhbmdlIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBwYWdlT25DaGFuZ2UoJGV2ZW50KSB7CiAgICAgIGlmICghJGV2ZW50KSB7CiAgICAgICAgcmV0dXJuOwogICAgICB9CgogICAgICBpZiAoJGV2ZW50ID09PSB0aGlzLmN1clBhZ2UpIHsKICAgICAgICByZXR1cm47CiAgICAgIH0KCiAgICAgIHRoaXMuY3VyUGFnZSA9ICRldmVudDsKICAgICAgdGhpcy5sb2FkKHt9KTsKICAgIH0KICAgIC8qKg0KICAgICAqIOWIhumhteadoeaVsOWPmOWMlg0KICAgICAqDQogICAgICogQHBhcmFtIHsqfSAkZXZlbnQNCiAgICAgKiBAcmV0dXJucyB7dm9pZH0NCiAgICAgKiBAbWVtYmVyb2YgTWFpbl8yQmFzZQ0KICAgICAqLwoKICB9LCB7CiAgICBrZXk6ICJvblBhZ2VTaXplQ2hhbmdlIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBvblBhZ2VTaXplQ2hhbmdlKCRldmVudCkgewogICAgICBpZiAoISRldmVudCkgewogICAgICAgIHJldHVybjsKICAgICAgfQoKICAgICAgaWYgKCRldmVudCA9PT0gdGhpcy5saW1pdCkgewogICAgICAgIHJldHVybjsKICAgICAgfQoKICAgICAgdGhpcy5saW1pdCA9ICRldmVudDsKCiAgICAgIGlmICh0aGlzLmN1clBhZ2UgPT09IDEpIHsKICAgICAgICB0aGlzLmxvYWQoe30pOwogICAgICB9CiAgICB9CiAgICAvKioNCiAgICAgKiDliIbpobXliLfmlrANCiAgICAgKg0KICAgICAqIEBtZW1iZXJvZiBNYWluXzJCYXNlDQogICAgICovCgogIH0sIHsKICAgIGtleTogInBhZ2VSZWZyZXNoIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBwYWdlUmVmcmVzaCgpIHsKICAgICAgdGhpcy5sb2FkKHt9KTsKICAgIH0KICAgIC8qKg0KICAgICAqIOaOkuW6j+WPmOWMlg0KICAgICAqDQogICAgICogQHBhcmFtIHt7IGNvbHVtbjogYW55LCBwcm9wOiBhbnksIG9yZGVyOiBhbnkgfX0geyBjb2x1bW4sIHByb3AsIG9yZGVyIH0NCiAgICAgKiBAbWVtYmVyb2YgTWFpbl8yQmFzZQ0KICAgICAqLwoKICB9LCB7CiAgICBrZXk6ICJvblNvcnRDaGFuZ2UiLAogICAgdmFsdWU6IGZ1bmN0aW9uIG9uU29ydENoYW5nZShfcmVmNCkgewogICAgICB2YXIgY29sdW1uID0gX3JlZjQuY29sdW1uLAogICAgICAgICAgcHJvcCA9IF9yZWY0LnByb3AsCiAgICAgICAgICBvcmRlciA9IF9yZWY0Lm9yZGVyOwogICAgICB2YXIgZGlyID0gT2JqZWN0LmlzKG9yZGVyLCAnYXNjZW5kaW5nJykgPyAnYXNjJyA6IE9iamVjdC5pcyhvcmRlciwgJ2Rlc2NlbmRpbmcnKSA/ICdkZXNjJyA6ICcnOwoKICAgICAgaWYgKE9iamVjdC5pcyhkaXIsIHRoaXMubWlub3JTb3J0RGlyKSAmJiBPYmplY3QuaXModGhpcy5taW5vclNvcnRQU0RFRiwgcHJvcCkpIHsKICAgICAgICByZXR1cm47CiAgICAgIH0KCiAgICAgIHRoaXMubWlub3JTb3J0RGlyID0gZGlyOwogICAgICB0aGlzLm1pbm9yU29ydFBTREVGID0gcHJvcCA/IHByb3AgOiAnJzsKICAgICAgdGhpcy5sb2FkKHt9KTsKICAgIH0KICAgIC8qKg0KICAgICAqIOihqOagvOihjOmAieS4reagt+W8jw0KICAgICAqDQogICAgICogQHBhcmFtIHt7IHJvdzogYW55LCByb3dJbmRleDogYW55IH19IHsgcm93LCByb3dJbmRleCB9DQogICAgICogQHJldHVybnMge3N0cmluZ30NCiAgICAgKiBAbWVtYmVyb2YgTWFpbl8yQmFzZQ0KICAgICAqLwoKICB9LCB7CiAgICBrZXk6ICJvblJvd0NsYXNzTmFtZSIsCiAgICB2YWx1ZTogZnVuY3Rpb24gb25Sb3dDbGFzc05hbWUoX3JlZjUpIHsKICAgICAgdmFyIHJvdyA9IF9yZWY1LnJvdywKICAgICAgICAgIHJvd0luZGV4ID0gX3JlZjUucm93SW5kZXg7CiAgICAgIHZhciBpbmRleCA9IHRoaXMuc2VsZWN0aW9ucy5maW5kSW5kZXgoZnVuY3Rpb24gKHNlbGVjdCkgewogICAgICAgIHJldHVybiBPYmplY3QuaXMoc2VsZWN0LnNyZmtleSwgcm93LnNyZmtleSk7CiAgICAgIH0pOwogICAgICByZXR1cm4gaW5kZXggIT09IC0xID8gJ2dyaWQtcm93LXNlbGVjdCcgOiAnJzsKICAgIH0KICAgIC8qKg0KICAgICAqIOeVjOmdouihjOS4ug0KICAgICAqDQogICAgICogQHBhcmFtIHsqfSByb3cNCiAgICAgKiBAcGFyYW0geyp9IHRhZw0KICAgICAqIEBwYXJhbSB7Kn0gJGV2ZW50DQogICAgICogQG1lbWJlcm9mIE1haW5fMkJhc2UNCiAgICAgKi8KCiAgfSwgewogICAga2V5OiAidWlBY3Rpb24iLAogICAgdmFsdWU6IGZ1bmN0aW9uIHVpQWN0aW9uKHJvdywgdGFnLCAkZXZlbnQpIHsKICAgICAgLy8gdGhpcy5yb3dDbGljayhyb3csIHRydWUpOwogICAgICAkZXZlbnQuc3RvcFByb3BhZ2F0aW9uKCk7CiAgICB9CiAgICAvKioNCiAgICAgKiDorr7nva7liJfnirbmgIENCiAgICAgKg0KICAgICAqIEBtZW1iZXJvZiBNYWluXzJCYXNlDQogICAgICovCgogIH0sIHsKICAgIGtleTogInNldENvbFN0YXRlIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBzZXRDb2xTdGF0ZSgpIHsKICAgICAgdmFyIF90aGlzMTEgPSB0aGlzOwoKICAgICAgdmFyIF9kYXRhID0gbG9jYWxTdG9yYWdlLmdldEl0ZW0oJ3BpbWFyY2hpdmVzY2hhbmdlX21haW5fMl9ncmlkJyk7CgogICAgICBpZiAoX2RhdGEpIHsKICAgICAgICB2YXIgY29sdW1ucyA9IEpTT04ucGFyc2UoX2RhdGEpOwogICAgICAgIGNvbHVtbnMuZm9yRWFjaChmdW5jdGlvbiAoY29sKSB7CiAgICAgICAgICB2YXIgY29sdW1uID0gX3RoaXMxMS5hbGxDb2x1bW5zLmZpbmQoZnVuY3Rpb24gKGl0ZW0pIHsKICAgICAgICAgICAgcmV0dXJuIE9iamVjdC5pcyhjb2wubmFtZSwgaXRlbS5uYW1lKTsKICAgICAgICAgIH0pOwoKICAgICAgICAgIGlmIChjb2x1bW4pIHsKICAgICAgICAgICAgT2JqZWN0LmFzc2lnbihjb2x1bW4sIGNvbCk7CiAgICAgICAgICB9CiAgICAgICAgfSk7CiAgICAgIH0KICAgIH0KICAgIC8qKg0KICAgICAqIOWIl+WPmOWMlg0KICAgICAqDQogICAgICogQG1lbWJlcm9mIE1haW5fMkJhc2UNCiAgICAgKi8KCiAgfSwgewogICAga2V5OiAib25Db2xDaGFuZ2UiLAogICAgdmFsdWU6IGZ1bmN0aW9uIG9uQ29sQ2hhbmdlKCkgewogICAgICBsb2NhbFN0b3JhZ2Uuc2V0SXRlbSgncGltYXJjaGl2ZXNjaGFuZ2VfbWFpbl8yX2dyaWQnLCBKU09OLnN0cmluZ2lmeSh0aGlzLmFsbENvbHVtbnMpKTsKICAgIH0KICAgIC8qKg0KICAgICAqIOiOt+WPluWIl+eKtuaAgQ0KICAgICAqDQogICAgICogQHBhcmFtIHtzdHJpbmd9IG5hbWUNCiAgICAgKiBAcmV0dXJucyB7Ym9vbGVhbn0NCiAgICAgKiBAbWVtYmVyb2YgTWFpbl8yQmFzZQ0KICAgICAqLwoKICB9LCB7CiAgICBrZXk6ICJnZXRDb2x1bW5TdGF0ZSIsCiAgICB2YWx1ZTogZnVuY3Rpb24gZ2V0Q29sdW1uU3RhdGUobmFtZSkgewogICAgICB2YXIgY29sdW1uID0gdGhpcy5hbGxDb2x1bW5zLmZpbmQoZnVuY3Rpb24gKGNvbCkgewogICAgICAgIHJldHVybiBPYmplY3QuaXMobmFtZSwgY29sLm5hbWUpOwogICAgICB9KTsKICAgICAgcmV0dXJuIGNvbHVtbi5zaG93ID8gdHJ1ZSA6IGZhbHNlOwogICAgfQogICAgLyoqDQogICAgICog6KGo5qC85YiX5piv5ZCm6Ieq6YCC5bqU5biD5bGADQogICAgICoNCiAgICAgKiBAcmVhZG9ubHkNCiAgICAgKiBAdHlwZSB7Ym9vbGVhbn0NCiAgICAgKiBAbWVtYmVyb2YgTWFpbl8yQmFzZQ0KICAgICAqLwoKICB9LCB7CiAgICBrZXk6ICJzYXZlIiwKCiAgICAvKioNCiAgICAgKiDkv53lrZgNCiAgICAgKg0KICAgICAqIEBwYXJhbSB7Kn0gJGV2ZW50DQogICAgICogQHJldHVybnMge1Byb21pc2U8YW55Pn0NCiAgICAgKiBAbWVtYmVyb2YgTWFpbl8yQmFzZQ0KICAgICAqLwogICAgdmFsdWU6IGZ1bmN0aW9uICgpIHsKICAgICAgdmFyIF9zYXZlID0gX2FzeW5jVG9HZW5lcmF0b3IoCiAgICAgIC8qI19fUFVSRV9fKi8KICAgICAgcmVnZW5lcmF0b3JSdW50aW1lLm1hcmsoZnVuY3Rpb24gX2NhbGxlZTUoYXJncywgcGFyYW1zLCAkZXZlbnQsIHhEYXRhKSB7CiAgICAgICAgdmFyIF90aGlzMTIgPSB0aGlzOwoKICAgICAgICB2YXIgX3RoaXMsIHN1Y2Nlc3NJdGVtcywgZXJyb3JJdGVtcywgZXJyb3JNZXNzYWdlLCBfaXRlcmF0b3JOb3JtYWxDb21wbGV0aW9uMiwgX2RpZEl0ZXJhdG9yRXJyb3IyLCBfaXRlcmF0b3JFcnJvcjIsIF9pdGVyYXRvcjIsIF9zdGVwMiwgaXRlbSwgcmVzcG9uc2UsIF9yZXNwb25zZTsKCiAgICAgICAgcmV0dXJuIHJlZ2VuZXJhdG9yUnVudGltZS53cmFwKGZ1bmN0aW9uIF9jYWxsZWU1JChfY29udGV4dDYpIHsKICAgICAgICAgIHdoaWxlICgxKSB7CiAgICAgICAgICAgIHN3aXRjaCAoX2NvbnRleHQ2LnByZXYgPSBfY29udGV4dDYubmV4dCkgewogICAgICAgICAgICAgIGNhc2UgMDoKICAgICAgICAgICAgICAgIF90aGlzID0gdGhpczsKICAgICAgICAgICAgICAgIF9jb250ZXh0Ni5uZXh0ID0gMzsKICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLnZhbGlkYXRlQWxsKCk7CgogICAgICAgICAgICAgIGNhc2UgMzoKICAgICAgICAgICAgICAgIGlmIChfY29udGV4dDYuc2VudCkgewogICAgICAgICAgICAgICAgICBfY29udGV4dDYubmV4dCA9IDY7CiAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIHRoaXMuJE5vdGljZS5lcnJvcih7CiAgICAgICAgICAgICAgICAgIHRpdGxlOiAn6ZSZ6K+vJywKICAgICAgICAgICAgICAgICAgZGVzYzogJ+WAvOinhOWImeagoemqjOW8guW4uCcKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0Ni5hYnJ1cHQoInJldHVybiIsIFtdKTsKCiAgICAgICAgICAgICAgY2FzZSA2OgogICAgICAgICAgICAgICAgc3VjY2Vzc0l0ZW1zID0gW107CiAgICAgICAgICAgICAgICBlcnJvckl0ZW1zID0gW107CiAgICAgICAgICAgICAgICBlcnJvck1lc3NhZ2UgPSBbXTsKICAgICAgICAgICAgICAgIF9pdGVyYXRvck5vcm1hbENvbXBsZXRpb24yID0gdHJ1ZTsKICAgICAgICAgICAgICAgIF9kaWRJdGVyYXRvckVycm9yMiA9IGZhbHNlOwogICAgICAgICAgICAgICAgX2l0ZXJhdG9yRXJyb3IyID0gdW5kZWZpbmVkOwogICAgICAgICAgICAgICAgX2NvbnRleHQ2LnByZXYgPSAxMjsKICAgICAgICAgICAgICAgIF9pdGVyYXRvcjIgPSBfdGhpcy5pdGVtc1tTeW1ib2wuaXRlcmF0b3JdKCk7CgogICAgICAgICAgICAgIGNhc2UgMTQ6CiAgICAgICAgICAgICAgICBpZiAoX2l0ZXJhdG9yTm9ybWFsQ29tcGxldGlvbjIgPSAoX3N0ZXAyID0gX2l0ZXJhdG9yMi5uZXh0KCkpLmRvbmUpIHsKICAgICAgICAgICAgICAgICAgX2NvbnRleHQ2Lm5leHQgPSA0OTsKICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgaXRlbSA9IF9zdGVwMi52YWx1ZTsKICAgICAgICAgICAgICAgIF9jb250ZXh0Ni5wcmV2ID0gMTY7CgogICAgICAgICAgICAgICAgaWYgKCFPYmplY3QuaXMoaXRlbS5yb3dEYXRhU3RhdGUsICdjcmVhdGUnKSkgewogICAgICAgICAgICAgICAgICBfY29udGV4dDYubmV4dCA9IDI5OwogICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBpZiAodGhpcy5jcmVhdGVBY3Rpb24pIHsKICAgICAgICAgICAgICAgICAgX2NvbnRleHQ2Lm5leHQgPSAyMjsKICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgdGhpcy4kTm90aWNlLmVycm9yKHsKICAgICAgICAgICAgICAgICAgdGl0bGU6ICfplJnor68nLAogICAgICAgICAgICAgICAgICBkZXNjOiAnUElNQVJDSElWRVNDSEFOR0VEQURDSkxHcmlkVmlld+inhuWbvuihqOagvGNyZWF0ZUFjdGlvbuWPguaVsOacqumFjee9ricKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgX2NvbnRleHQ2Lm5leHQgPSAyNzsKICAgICAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgICAgICBjYXNlIDIyOgogICAgICAgICAgICAgICAgT2JqZWN0LmFzc2lnbihpdGVtLCB7CiAgICAgICAgICAgICAgICAgIHZpZXdwYXJhbXM6IHRoaXMudmlld3BhcmFtcwogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICBfY29udGV4dDYubmV4dCA9IDI1OwogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuc2VydmljZS5hZGQodGhpcy5jcmVhdGVBY3Rpb24sIEpTT04ucGFyc2UoSlNPTi5zdHJpbmdpZnkodGhpcy5jb250ZXh0KSksIGl0ZW0sIHRoaXMuc2hvd0J1c3lJbmRpY2F0b3IpOwoKICAgICAgICAgICAgICBjYXNlIDI1OgogICAgICAgICAgICAgICAgcmVzcG9uc2UgPSBfY29udGV4dDYuc2VudDsKICAgICAgICAgICAgICAgIHN1Y2Nlc3NJdGVtcy5wdXNoKEpTT04ucGFyc2UoSlNPTi5zdHJpbmdpZnkocmVzcG9uc2UuZGF0YSkpKTsKCiAgICAgICAgICAgICAgY2FzZSAyNzoKICAgICAgICAgICAgICAgIF9jb250ZXh0Ni5uZXh0ID0gNDA7CiAgICAgICAgICAgICAgICBicmVhazsKCiAgICAgICAgICAgICAgY2FzZSAyOToKICAgICAgICAgICAgICAgIGlmICghT2JqZWN0LmlzKGl0ZW0ucm93RGF0YVN0YXRlLCAndXBkYXRlJykpIHsKICAgICAgICAgICAgICAgICAgX2NvbnRleHQ2Lm5leHQgPSA0MDsKICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgaWYgKHRoaXMudXBkYXRlQWN0aW9uKSB7CiAgICAgICAgICAgICAgICAgIF9jb250ZXh0Ni5uZXh0ID0gMzQ7CiAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIHRoaXMuJE5vdGljZS5lcnJvcih7CiAgICAgICAgICAgICAgICAgIHRpdGxlOiAn6ZSZ6K+vJywKICAgICAgICAgICAgICAgICAgZGVzYzogJ1BJTUFSQ0hJVkVTQ0hBTkdFREFEQ0pMR3JpZFZpZXfop4blm77ooajmoLx1cGRhdGVBY3Rpb27lj4LmlbDmnKrphY3nva4nCiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIF9jb250ZXh0Ni5uZXh0ID0gNDA7CiAgICAgICAgICAgICAgICBicmVhazsKCiAgICAgICAgICAgICAgY2FzZSAzNDoKICAgICAgICAgICAgICAgIE9iamVjdC5hc3NpZ24oaXRlbSwgewogICAgICAgICAgICAgICAgICB2aWV3cGFyYW1zOiB0aGlzLnZpZXdwYXJhbXMKICAgICAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgICAgIGlmIChpdGVtLnBpbWFyY2hpdmVzY2hhbmdlKSB7CiAgICAgICAgICAgICAgICAgIE9iamVjdC5hc3NpZ24odGhpcy5jb250ZXh0LCB7CiAgICAgICAgICAgICAgICAgICAgcGltYXJjaGl2ZXNjaGFuZ2U6IGl0ZW0ucGltYXJjaGl2ZXNjaGFuZ2UKICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgX2NvbnRleHQ2Lm5leHQgPSAzODsKICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLnNlcnZpY2UuYWRkKHRoaXMudXBkYXRlQWN0aW9uLCBKU09OLnBhcnNlKEpTT04uc3RyaW5naWZ5KHRoaXMuY29udGV4dCkpLCBpdGVtLCB0aGlzLnNob3dCdXN5SW5kaWNhdG9yKTsKCiAgICAgICAgICAgICAgY2FzZSAzODoKICAgICAgICAgICAgICAgIF9yZXNwb25zZSA9IF9jb250ZXh0Ni5zZW50OwogICAgICAgICAgICAgICAgc3VjY2Vzc0l0ZW1zLnB1c2goSlNPTi5wYXJzZShKU09OLnN0cmluZ2lmeShfcmVzcG9uc2UuZGF0YSkpKTsKCiAgICAgICAgICAgICAgY2FzZSA0MDoKICAgICAgICAgICAgICAgIF9jb250ZXh0Ni5uZXh0ID0gNDY7CiAgICAgICAgICAgICAgICBicmVhazsKCiAgICAgICAgICAgICAgY2FzZSA0MjoKICAgICAgICAgICAgICAgIF9jb250ZXh0Ni5wcmV2ID0gNDI7CiAgICAgICAgICAgICAgICBfY29udGV4dDYudDAgPSBfY29udGV4dDZbImNhdGNoIl0oMTYpOwogICAgICAgICAgICAgICAgZXJyb3JJdGVtcy5wdXNoKEpTT04ucGFyc2UoSlNPTi5zdHJpbmdpZnkoaXRlbSkpKTsKICAgICAgICAgICAgICAgIGVycm9yTWVzc2FnZS5wdXNoKF9jb250ZXh0Ni50MCk7CgogICAgICAgICAgICAgIGNhc2UgNDY6CiAgICAgICAgICAgICAgICBfaXRlcmF0b3JOb3JtYWxDb21wbGV0aW9uMiA9IHRydWU7CiAgICAgICAgICAgICAgICBfY29udGV4dDYubmV4dCA9IDE0OwogICAgICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgICAgIGNhc2UgNDk6CiAgICAgICAgICAgICAgICBfY29udGV4dDYubmV4dCA9IDU1OwogICAgICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgICAgIGNhc2UgNTE6CiAgICAgICAgICAgICAgICBfY29udGV4dDYucHJldiA9IDUxOwogICAgICAgICAgICAgICAgX2NvbnRleHQ2LnQxID0gX2NvbnRleHQ2WyJjYXRjaCJdKDEyKTsKICAgICAgICAgICAgICAgIF9kaWRJdGVyYXRvckVycm9yMiA9IHRydWU7CiAgICAgICAgICAgICAgICBfaXRlcmF0b3JFcnJvcjIgPSBfY29udGV4dDYudDE7CgogICAgICAgICAgICAgIGNhc2UgNTU6CiAgICAgICAgICAgICAgICBfY29udGV4dDYucHJldiA9IDU1OwogICAgICAgICAgICAgICAgX2NvbnRleHQ2LnByZXYgPSA1NjsKCiAgICAgICAgICAgICAgICBpZiAoIV9pdGVyYXRvck5vcm1hbENvbXBsZXRpb24yICYmIF9pdGVyYXRvcjJbInJldHVybiJdICE9IG51bGwpIHsKICAgICAgICAgICAgICAgICAgX2l0ZXJhdG9yMlsicmV0dXJuIl0oKTsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgY2FzZSA1ODoKICAgICAgICAgICAgICAgIF9jb250ZXh0Ni5wcmV2ID0gNTg7CgogICAgICAgICAgICAgICAgaWYgKCFfZGlkSXRlcmF0b3JFcnJvcjIpIHsKICAgICAgICAgICAgICAgICAgX2NvbnRleHQ2Lm5leHQgPSA2MTsKICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgdGhyb3cgX2l0ZXJhdG9yRXJyb3IyOwoKICAgICAgICAgICAgICBjYXNlIDYxOgogICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0Ni5maW5pc2goNTgpOwoKICAgICAgICAgICAgICBjYXNlIDYyOgogICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0Ni5maW5pc2goNTUpOwoKICAgICAgICAgICAgICBjYXNlIDYzOgogICAgICAgICAgICAgICAgdGhpcy4kZW1pdCgnc2F2ZScsIHN1Y2Nlc3NJdGVtcyk7CiAgICAgICAgICAgICAgICB0aGlzLnJlZnJlc2goW10pOwoKICAgICAgICAgICAgICAgIGlmIChlcnJvckl0ZW1zLmxlbmd0aCA9PT0gMCkgewogICAgICAgICAgICAgICAgICB0aGlzLiROb3RpY2Uuc3VjY2Vzcyh7CiAgICAgICAgICAgICAgICAgICAgdGl0bGU6ICcnLAogICAgICAgICAgICAgICAgICAgIGRlc2M6ICfkv53lrZjmiJDlip8hJwogICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgIGVycm9ySXRlbXMuZm9yRWFjaChmdW5jdGlvbiAoaXRlbSwgaW5kZXgpIHsKICAgICAgICAgICAgICAgICAgICBfdGhpczEyLiROb3RpY2UuZXJyb3IoewogICAgICAgICAgICAgICAgICAgICAgdGl0bGU6ICfkv53lrZjlpLHotKUnLAogICAgICAgICAgICAgICAgICAgICAgZGVzYzogaXRlbS5tYWpvcmVudGl0eW5hbWUgKyAn5L+d5a2Y5aSx6LSl77yBJwogICAgICAgICAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmVycm9yKGVycm9yTWVzc2FnZVtpbmRleF0pOwogICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQ2LmFicnVwdCgicmV0dXJuIiwgc3VjY2Vzc0l0ZW1zKTsKCiAgICAgICAgICAgICAgY2FzZSA2NzoKICAgICAgICAgICAgICBjYXNlICJlbmQiOgogICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0Ni5zdG9wKCk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9LCBfY2FsbGVlNSwgdGhpcywgW1sxMiwgNTEsIDU1LCA2M10sIFsxNiwgNDJdLCBbNTYsLCA1OCwgNjJdXSk7CiAgICAgIH0pKTsKCiAgICAgIGZ1bmN0aW9uIHNhdmUoX3g1LCBfeDYsIF94NywgX3g4KSB7CiAgICAgICAgcmV0dXJuIF9zYXZlLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7CiAgICAgIH0KCiAgICAgIHJldHVybiBzYXZlOwogICAgfSgpCiAgICAvKioNCiAgICAgKiDmlrDlu7rooYwNCiAgICAgKg0KICAgICAqIEBwYXJhbSB7Kn0gJGV2ZW50DQogICAgICogQHJldHVybnMge3ZvaWR9DQogICAgICogQG1lbWJlcm9mIE1haW5fMkJhc2UNCiAgICAgKi8KCiAgfSwgewogICAga2V5OiAibmV3Um93IiwKICAgIHZhbHVlOiBmdW5jdGlvbiBuZXdSb3coYXJncywgcGFyYW1zLCAkZXZlbnQsIHhEYXRhKSB7CiAgICAgIHZhciBfdGhpczEzID0gdGhpczsKCiAgICAgIGlmICghdGhpcy5sb2FkZHJhZnRBY3Rpb24pIHsKICAgICAgICB0aGlzLiROb3RpY2UuZXJyb3IoewogICAgICAgICAgdGl0bGU6ICfplJnor68nLAogICAgICAgICAgZGVzYzogJ1BJTUFSQ0hJVkVTQ0hBTkdFREFEQ0pMR3JpZFZpZXfop4blm77ooajmoLxsb2FkZHJhZnRBY3Rpb27lj4LmlbDmnKrphY3nva4nCiAgICAgICAgfSk7CiAgICAgICAgcmV0dXJuOwogICAgICB9CgogICAgICB2YXIgX3RoaXMgPSB0aGlzOwoKICAgICAgT2JqZWN0LmFzc2lnbihhcmdzWzBdLCB7CiAgICAgICAgdmlld3BhcmFtczogdGhpcy52aWV3cGFyYW1zCiAgICAgIH0pOwogICAgICB2YXIgcG9zdCA9IHRoaXMuc2VydmljZS5sb2FkRHJhZnQodGhpcy5sb2FkZHJhZnRBY3Rpb24sIEpTT04ucGFyc2UoSlNPTi5zdHJpbmdpZnkodGhpcy5jb250ZXh0KSksIGFyZ3NbMF0sIHRoaXMuc2hvd0J1c3lJbmRpY2F0b3IpOwogICAgICBwb3N0LnRoZW4oZnVuY3Rpb24gKHJlc3BvbnNlKSB7CiAgICAgICAgaWYgKCFyZXNwb25zZS5zdGF0dXMgfHwgcmVzcG9uc2Uuc3RhdHVzICE9PSAyMDApIHsKICAgICAgICAgIGlmIChyZXNwb25zZS5lcnJvck1lc3NhZ2UpIHsKICAgICAgICAgICAgX3RoaXMxMy4kTm90aWNlLmVycm9yKHsKICAgICAgICAgICAgICB0aXRsZTogJ+mUmeivrycsCiAgICAgICAgICAgICAgZGVzYzogcmVzcG9uc2UuZXJyb3JNZXNzYWdlCiAgICAgICAgICAgIH0pOwogICAgICAgICAgfQoKICAgICAgICAgIHJldHVybjsKICAgICAgICB9CgogICAgICAgIHZhciBkYXRhID0gcmVzcG9uc2UuZGF0YTsKCiAgICAgICAgX3RoaXMxMy5jcmVhdGVEZWZhdWx0KGRhdGEpOwoKICAgICAgICBkYXRhLnJvd0RhdGFTdGF0ZSA9ICJjcmVhdGUiOwoKICAgICAgICBfdGhpcy5pdGVtcy5wdXNoKGRhdGEpOwoKICAgICAgICBfdGhpcy5ncmlkSXRlbXNNb2RlbC5wdXNoKF90aGlzLmdldEdyaWRSb3dNb2RlbCgpKTsKICAgICAgfSlbImNhdGNoIl0oZnVuY3Rpb24gKHJlc3BvbnNlKSB7CiAgICAgICAgaWYgKHJlc3BvbnNlICYmIHJlc3BvbnNlLnN0YXR1cyA9PT0gNDAxKSB7CiAgICAgICAgICByZXR1cm47CiAgICAgICAgfQoKICAgICAgICBpZiAoIXJlc3BvbnNlIHx8ICFyZXNwb25zZS5zdGF0dXMgfHwgIXJlc3BvbnNlLmRhdGEpIHsKICAgICAgICAgIF90aGlzMTMuJE5vdGljZS5lcnJvcih7CiAgICAgICAgICAgIHRpdGxlOiAn6ZSZ6K+vJywKICAgICAgICAgICAgZGVzYzogJ+ezu+e7n+W8guW4uCcKICAgICAgICAgIH0pOwoKICAgICAgICAgIHJldHVybjsKICAgICAgICB9CiAgICAgIH0pOwogICAgfQogICAgLyoqDQogICAgICog6KGo5qC857yW6L6R6aG55YC85Y+Y5pu0DQogICAgICoNCiAgICAgKiBAcGFyYW0gcm93IOihjOaVsOaNrg0KICAgICAqIEBwYXJhbSB7eyBuYW1lOiBzdHJpbmcsIHZhbHVlOiBhbnkgfX0gJGV2ZW50DQogICAgICogQHJldHVybnMge3ZvaWR9DQogICAgICogQG1lbWJlcm9mIE1haW5fMkJhc2UNCiAgICAgKi8KCiAgfSwgewogICAga2V5OiAib25HcmlkSXRlbVZhbHVlQ2hhbmdlIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBvbkdyaWRJdGVtVmFsdWVDaGFuZ2Uocm93LCAkZXZlbnQsIHJvd0luZGV4KSB7CiAgICAgIGlmICghJGV2ZW50KSB7CiAgICAgICAgcmV0dXJuOwogICAgICB9CgogICAgICBpZiAoISRldmVudC5uYW1lIHx8IE9iamVjdC5pcygkZXZlbnQubmFtZSwgJycpIHx8ICFyb3cuaGFzT3duUHJvcGVydHkoJGV2ZW50Lm5hbWUpKSB7CiAgICAgICAgcmV0dXJuOwogICAgICB9CgogICAgICByb3dbJGV2ZW50Lm5hbWVdID0gJGV2ZW50LnZhbHVlOwogICAgICB0aGlzLmdyaWRFZGl0SXRlbUNoYW5nZShyb3csICRldmVudC5uYW1lLCAkZXZlbnQudmFsdWUsIHJvd0luZGV4KTsKICAgIH0KICAgIC8qKg0KICAgICAqIOihqOagvOe8lui+kemhueWAvOWPmOWMlg0KICAgICAqDQogICAgICogQHB1YmxpYw0KICAgICAqIEBwYXJhbSByb3cg6KGM5pWw5o2uDQogICAgICogQHBhcmFtIHByb3BlcnR5IOWIl+e8lui+kemhueWQjQ0KICAgICAqIEBwYXJhbSByb3cg5YiX57yW6L6R6aG55YC8DQogICAgICogQHJldHVybnMge3ZvaWR9DQogICAgICogQG1lbWJlcm9mIE1haW5fMkJhc2UNCiAgICAgKi8KCiAgfSwgewogICAga2V5OiAiZ3JpZEVkaXRJdGVtQ2hhbmdlIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBncmlkRWRpdEl0ZW1DaGFuZ2Uocm93LCBwcm9wZXJ0eSwgdmFsdWUsIHJvd0luZGV4KSB7CiAgICAgIHJvdy5yb3dEYXRhU3RhdGUgPSByb3cucm93RGF0YVN0YXRlID8gcm93LnJvd0RhdGFTdGF0ZSA6ICJ1cGRhdGUiOwogICAgICB0aGlzLnZhbGlkYXRlKHByb3BlcnR5LCByb3csIHJvd0luZGV4KTsKICAgIH0KICAgIC8qKg0KICAgICAqIOihqOagvOe8lui+kemhueabtOaWsA0KICAgICAqDQogICAgICogQHBhcmFtIHtzdHJpbmd9IG1vZGUg55WM6Z2i6KGM5Li65ZCN56ewDQogICAgICogQHBhcmFtIHsqfSBbZGF0YT17fV0g6K+35rGC5pWw5o2uDQogICAgICogQHBhcmFtIHtzdHJpbmdbXX0gdXBkYXRlRGV0YWlscyDmm7TmlrDpobkNCiAgICAgKiBAcGFyYW0ge2Jvb2xlYW59IFtzaG93bG9hZGluZ10g5piv5ZCm5pi+56S65Yqg6L2954q25oCBDQogICAgICogQHJldHVybnMge3ZvaWR9DQogICAgICogQG1lbWJlcm9mIE1haW5fMkJhc2UNCiAgICAgKi8KCiAgfSwgewogICAga2V5OiAidXBkYXRlR3JpZEVkaXRJdGVtIiwKICAgIHZhbHVlOiBmdW5jdGlvbiB1cGRhdGVHcmlkRWRpdEl0ZW0obW9kZSkgewogICAgICB2YXIgX3RoaXMxNCA9IHRoaXM7CgogICAgICB2YXIgZGF0YSA9IGFyZ3VtZW50cy5sZW5ndGggPiAxICYmIGFyZ3VtZW50c1sxXSAhPT0gdW5kZWZpbmVkID8gYXJndW1lbnRzWzFdIDoge307CiAgICAgIHZhciB1cGRhdGVEZXRhaWxzID0gYXJndW1lbnRzLmxlbmd0aCA+IDIgPyBhcmd1bWVudHNbMl0gOiB1bmRlZmluZWQ7CiAgICAgIHZhciBzaG93bG9hZGluZyA9IGFyZ3VtZW50cy5sZW5ndGggPiAzID8gYXJndW1lbnRzWzNdIDogdW5kZWZpbmVkOwoKICAgICAgaWYgKCFtb2RlIHx8IG1vZGUgJiYgT2JqZWN0LmlzKG1vZGUsICcnKSkgewogICAgICAgIHJldHVybjsKICAgICAgfQoKICAgICAgdmFyIGFyZyA9IEpTT04ucGFyc2UoSlNPTi5zdHJpbmdpZnkoZGF0YSkpOwogICAgICBPYmplY3QuYXNzaWduKGFyZywgewogICAgICAgIHZpZXdwYXJhbXM6IHRoaXMudmlld3BhcmFtcwogICAgICB9KTsKICAgICAgdmFyIHBvc3QgPSB0aGlzLnNlcnZpY2UuZnJvbnRMb2dpYyhtb2RlLCBKU09OLnBhcnNlKEpTT04uc3RyaW5naWZ5KHRoaXMuY29udGV4dCkpLCBhcmcsIHNob3dsb2FkaW5nKTsKICAgICAgcG9zdC50aGVuKGZ1bmN0aW9uIChyZXNwb25zZSkgewogICAgICAgIGlmICghcmVzcG9uc2UgfHwgcmVzcG9uc2Uuc3RhdHVzICE9PSAyMDApIHsKICAgICAgICAgIF90aGlzMTQuJE5vdGljZS5lcnJvcih7CiAgICAgICAgICAgIHRpdGxlOiAn6ZSZ6K+vJywKICAgICAgICAgICAgZGVzYzogJ+ihqOWNlemhueabtOaWsOWksei0pScKICAgICAgICAgIH0pOwoKICAgICAgICAgIHJldHVybjsKICAgICAgICB9CgogICAgICAgIHZhciBfZGF0YSA9IHJlc3BvbnNlLmRhdGE7CgogICAgICAgIGlmICghX2RhdGEpIHsKICAgICAgICAgIHJldHVybjsKICAgICAgICB9CgogICAgICAgIHVwZGF0ZURldGFpbHMuZm9yRWFjaChmdW5jdGlvbiAobmFtZSkgewogICAgICAgICAgaWYgKCFfZGF0YS5oYXNPd25Qcm9wZXJ0eShuYW1lKSkgewogICAgICAgICAgICByZXR1cm47CiAgICAgICAgICB9CgogICAgICAgICAgZGF0YVtuYW1lXSA9IF9kYXRhW25hbWVdOwogICAgICAgIH0pOwogICAgICB9KVsiY2F0Y2giXShmdW5jdGlvbiAocmVzcG9uc2UpIHsKICAgICAgICBpZiAocmVzcG9uc2UgJiYgcmVzcG9uc2Uuc3RhdHVzID09PSA0MDEpIHsKICAgICAgICAgIHJldHVybjsKICAgICAgICB9CgogICAgICAgIGlmICghcmVzcG9uc2UgfHwgIXJlc3BvbnNlLnN0YXR1cyB8fCAhcmVzcG9uc2UuZGF0YSkgewogICAgICAgICAgX3RoaXMxNC4kTm90aWNlLmVycm9yKHsKICAgICAgICAgICAgdGl0bGU6ICfplJnor68nLAogICAgICAgICAgICBkZXNjOiAn57O757uf5byC5bi4JwogICAgICAgICAgfSk7CgogICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KICAgICAgfSk7CiAgICB9CiAgICAvKioNCiAgICAgKiDojrflj5blr7nlupTooYxjbGFzcw0KICAgICAqDQogICAgICogQHBhcmFtIHsqfSAkYXJncyByb3cg6KGM5pWw5o2u77yMcm93SW5kZXgg6KGM57Si5byVDQogICAgICogQHJldHVybnMge3ZvaWR9DQogICAgICogQG1lbWJlcm9mIE1haW5fMkJhc2UNCiAgICAgKi8KCiAgfSwgewogICAga2V5OiAiZ2V0Um93Q2xhc3NOYW1lIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBnZXRSb3dDbGFzc05hbWUoYXJncykgewogICAgICB2YXIgaXNTZWxlY3RlZCA9IHRoaXMuc2VsZWN0aW9ucy5zb21lKGZ1bmN0aW9uIChpdGVtKSB7CiAgICAgICAgcmV0dXJuIE9iamVjdC5pcyhpdGVtLnBpbWFyY2hpdmVzY2hhbmdlLCBhcmdzLnJvdy5waW1hcmNoaXZlc2NoYW5nZSk7CiAgICAgIH0pOwogICAgICByZXR1cm4gaXNTZWxlY3RlZCA/ICJncmlkLXNlbGVjdGVkLXJvdyIgOiAiIjsKICAgIH0KICAgIC8qKg0KICAgICAqIOiOt+WPluWvueW6lOWIl2NsYXNzDQogICAgICoNCiAgICAgKiBAcGFyYW0geyp9ICRhcmdzIHJvdyDooYzmlbDmja7vvIxjb2x1bW4g5YiX5pWw5o2u77yMcm93SW5kZXgg6KGM57Si5byV77yM5YiX57Si5byVDQogICAgICogQHJldHVybnMge3ZvaWR9DQogICAgICogQG1lbWJlcm9mIE1haW5fMkJhc2UNCiAgICAgKi8KCiAgfSwgewogICAga2V5OiAiZ2V0Q2VsbENsYXNzTmFtZSIsCiAgICB2YWx1ZTogZnVuY3Rpb24gZ2V0Q2VsbENsYXNzTmFtZShhcmdzKSB7CiAgICAgIHZhciBoYXNSb3dFZGl0ID0gewogICAgICAgICd5Z2JoJzogZmFsc2UsCiAgICAgICAgJ3BpbXBlcnNvbm5hbWUnOiBmYWxzZSwKICAgICAgICAnb3Jtb3JnbmFtZSc6IGZhbHNlLAogICAgICAgICdvcm1vcmduYW1lMic6IGZhbHNlLAogICAgICAgICdqbGNzc2onOiBmYWxzZQogICAgICB9OwogICAgICByZXR1cm4gaGFzUm93RWRpdFthcmdzLmNvbHVtbi5wcm9wZXJ0eV0gJiYgdGhpcy5hY3R1YWxJc09wZW5FZGl0ID8gImVkaXQtY2VsbCIgOiAiaW5mby1jZWxsIjsKICAgIH0KICAgIC8qKg0KICAgICAqIOaWsOW7uum7mOiupOWAvA0KICAgICAqIEBwYXJhbSB7Kn0gIHJvdyDooYzmlbDmja4NCiAgICAgKiBAbWVtYmVyb2YgTWFpbl8yQmFzZQ0KICAgICAqLwoKICB9LCB7CiAgICBrZXk6ICJjcmVhdGVEZWZhdWx0IiwKICAgIHZhbHVlOiBmdW5jdGlvbiBjcmVhdGVEZWZhdWx0KHJvdykgewogICAgICBpZiAocm93Lmhhc093blByb3BlcnR5KCdwaW1hcmNoaXZlc2lkJykpIHsKICAgICAgICByb3dbJ3BpbWFyY2hpdmVzaWQnXSA9IHRoaXMudmlld3BhcmFtc1snc3JmcGFyZW50a2V5J107CiAgICAgIH0KICAgIH0KICB9LCB7CiAgICBrZXk6ICJhZGFwdGl2ZVN0YXRlIiwKICAgIGdldDogZnVuY3Rpb24gZ2V0KCkgewogICAgICByZXR1cm4gIXRoaXMuYWxsQ29sdW1ucy5maW5kKGZ1bmN0aW9uIChjb2x1bW4pIHsKICAgICAgICByZXR1cm4gY29sdW1uLnNob3cgJiYgT2JqZWN0LmlzKGNvbHVtbi51dGlsLCAnU1RBUicpOwogICAgICB9KTsKICAgIH0KICB9XSk7CgogIHJldHVybiBNYWluXzJCYXNlOwp9KFZ1ZSk7Cgp0c2xpYl8xLl9fZGVjb3JhdGUoW1Byb3AoKV0sIE1haW5fMkJhc2UucHJvdG90eXBlLCAibmFtZSIsIHZvaWQgMCk7Cgp0c2xpYl8xLl9fZGVjb3JhdGUoW1Byb3AoKV0sIE1haW5fMkJhc2UucHJvdG90eXBlLCAidmlld1N0YXRlIiwgdm9pZCAwKTsKCnRzbGliXzEuX19kZWNvcmF0ZShbUHJvcCgpXSwgTWFpbl8yQmFzZS5wcm90b3R5cGUsICJjb250ZXh0Iiwgdm9pZCAwKTsKCnRzbGliXzEuX19kZWNvcmF0ZShbUHJvcCgpXSwgTWFpbl8yQmFzZS5wcm90b3R5cGUsICJ2aWV3cGFyYW1zIiwgdm9pZCAwKTsKCnRzbGliXzEuX19kZWNvcmF0ZShbUHJvcCgpXSwgTWFpbl8yQmFzZS5wcm90b3R5cGUsICJuZXdkYXRhIiwgdm9pZCAwKTsKCnRzbGliXzEuX19kZWNvcmF0ZShbUHJvcCgpXSwgTWFpbl8yQmFzZS5wcm90b3R5cGUsICJvcGVuZGF0YSIsIHZvaWQgMCk7Cgp0c2xpYl8xLl9fZGVjb3JhdGUoW1Byb3AoewogICJkZWZhdWx0IjogdHJ1ZQp9KV0sIE1haW5fMkJhc2UucHJvdG90eXBlLCAic2hvd0J1c3lJbmRpY2F0b3IiLCB2b2lkIDApOwoKdHNsaWJfMS5fX2RlY29yYXRlKFtQcm9wKCldLCBNYWluXzJCYXNlLnByb3RvdHlwZSwgInVwZGF0ZUFjdGlvbiIsIHZvaWQgMCk7Cgp0c2xpYl8xLl9fZGVjb3JhdGUoW1Byb3AoKV0sIE1haW5fMkJhc2UucHJvdG90eXBlLCAiZmV0Y2hBY3Rpb24iLCB2b2lkIDApOwoKdHNsaWJfMS5fX2RlY29yYXRlKFtQcm9wKCldLCBNYWluXzJCYXNlLnByb3RvdHlwZSwgInJlbW92ZUFjdGlvbiIsIHZvaWQgMCk7Cgp0c2xpYl8xLl9fZGVjb3JhdGUoW1Byb3AoKV0sIE1haW5fMkJhc2UucHJvdG90eXBlLCAibG9hZEFjdGlvbiIsIHZvaWQgMCk7Cgp0c2xpYl8xLl9fZGVjb3JhdGUoW1Byb3AoKV0sIE1haW5fMkJhc2UucHJvdG90eXBlLCAibG9hZGRyYWZ0QWN0aW9uIiwgdm9pZCAwKTsKCnRzbGliXzEuX19kZWNvcmF0ZShbUHJvcCgpXSwgTWFpbl8yQmFzZS5wcm90b3R5cGUsICJjcmVhdGVBY3Rpb24iLCB2b2lkIDApOwoKdHNsaWJfMS5fX2RlY29yYXRlKFtQcm9wKHsKICAiZGVmYXVsdCI6IGZhbHNlCn0pXSwgTWFpbl8yQmFzZS5wcm90b3R5cGUsICJpc1NlbGVjdEZpcnN0RGVmYXVsdCIsIHZvaWQgMCk7Cgp0c2xpYl8xLl9fZGVjb3JhdGUoW1Byb3AoKV0sIE1haW5fMkJhc2UucHJvdG90eXBlLCAiaXNTaW5nbGVTZWxlY3QiLCB2b2lkIDApOwoKdHNsaWJfMS5fX2RlY29yYXRlKFtQcm9wKCldLCBNYWluXzJCYXNlLnByb3RvdHlwZSwgInNlbGVjdGVkRGF0YSIsIHZvaWQgMCk7Cgp0c2xpYl8xLl9fZGVjb3JhdGUoW1dhdGNoKCdzZWxlY3RlZERhdGEnKV0sIE1haW5fMkJhc2UucHJvdG90eXBlLCAib25WYWx1ZUNoYW5nZSIsIG51bGwpOwoKdHNsaWJfMS5fX2RlY29yYXRlKFtQcm9wKHsKICAiZGVmYXVsdCI6IDIKfSldLCBNYWluXzJCYXNlLnByb3RvdHlwZSwgImdyaWRSb3dBY3RpdmVNb2RlIiwgdm9pZCAwKTsKCnRzbGliXzEuX19kZWNvcmF0ZShbUHJvcCh7CiAgImRlZmF1bHQiOiBmYWxzZQp9KV0sIE1haW5fMkJhc2UucHJvdG90eXBlLCAiaXNPcGVuRWRpdCIsIHZvaWQgMCk7CgpNYWluXzJCYXNlID0gdHNsaWJfMS5fX2RlY29yYXRlKFtDb21wb25lbnQoewogIGNvbXBvbmVudHM6IHt9Cn0pXSwgTWFpbl8yQmFzZSk7CmV4cG9ydCBkZWZhdWx0IE1haW5fMkJhc2U7"},null]}
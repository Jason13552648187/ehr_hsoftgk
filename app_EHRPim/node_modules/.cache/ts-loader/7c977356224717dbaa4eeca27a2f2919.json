{"remainingRequest":"F:\\crod项目\\人事管理系统2\\iBizEHR\\app_EHRPim\\node_modules\\thread-loader\\dist\\cjs.js!F:\\crod项目\\人事管理系统2\\iBizEHR\\app_EHRPim\\node_modules\\babel-loader\\lib\\index.js!F:\\crod项目\\人事管理系统2\\iBizEHR\\app_EHRPim\\node_modules\\ts-loader\\index.js??ref--13-3!F:\\crod项目\\人事管理系统2\\iBizEHR\\app_EHRPim\\src\\widgets\\pim-contract\\tree-treeview\\tree-treeview-service.ts","dependencies":[{"path":"F:\\crod项目\\人事管理系统2\\iBizEHR\\app_EHRPim\\src\\widgets\\pim-contract\\tree-treeview\\tree-treeview-service.ts","mtime":1630509411482},{"path":"F:\\crod项目\\人事管理系统2\\iBizEHR\\app_EHRPim\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1630511852775},{"path":"F:\\crod项目\\人事管理系统2\\iBizEHR\\app_EHRPim\\node_modules\\thread-loader\\dist\\cjs.js","mtime":1630511853252},{"path":"F:\\crod项目\\人事管理系统2\\iBizEHR\\app_EHRPim\\node_modules\\babel-loader\\lib\\index.js","mtime":1630511852747},{"path":"F:\\crod项目\\人事管理系统2\\iBizEHR\\app_EHRPim\\node_modules\\ts-loader\\index.js","mtime":1630511985412}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:aW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkuZm9yLWVhY2giOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5hcnJheS5pbmRleC1vZiI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLm9iamVjdC5kZWZpbmUtcHJvcGVydHkiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5vYmplY3QuaXMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5vYmplY3Qua2V5cyI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLm9iamVjdC50by1zdHJpbmciOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5yZWdleHAuZXhlYyI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLnN0cmluZy5zcGxpdCI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL3dlYi5kb20tY29sbGVjdGlvbnMuZm9yLWVhY2giOwppbXBvcnQgInJlZ2VuZXJhdG9yLXJ1bnRpbWUvcnVudGltZSI7CmltcG9ydCBfYXN5bmNUb0dlbmVyYXRvciBmcm9tICJGOlxcY3JvZFx1OTg3OVx1NzZFRVxcXHU0RUJBXHU0RThCXHU3QkExXHU3NDA2XHU3Q0ZCXHU3RURGMlxcaUJpekVIUlxcYXBwX0VIUlBpbVxcbm9kZV9tb2R1bGVzXFxAYmFiZWxcXHJ1bnRpbWUvaGVscGVycy9lc20vYXN5bmNUb0dlbmVyYXRvciI7CmltcG9ydCBfY2xhc3NDYWxsQ2hlY2sgZnJvbSAiRjpcXGNyb2RcdTk4NzlcdTc2RUVcXFx1NEVCQVx1NEU4Qlx1N0JBMVx1NzQwNlx1N0NGQlx1N0VERjJcXGlCaXpFSFJcXGFwcF9FSFJQaW1cXG5vZGVfbW9kdWxlc1xcQGJhYmVsXFxydW50aW1lL2hlbHBlcnMvZXNtL2NsYXNzQ2FsbENoZWNrIjsKaW1wb3J0IF9jcmVhdGVDbGFzcyBmcm9tICJGOlxcY3JvZFx1OTg3OVx1NzZFRVxcXHU0RUJBXHU0RThCXHU3QkExXHU3NDA2XHU3Q0ZCXHU3RURGMlxcaUJpekVIUlxcYXBwX0VIUlBpbVxcbm9kZV9tb2R1bGVzXFxAYmFiZWxcXHJ1bnRpbWUvaGVscGVycy9lc20vY3JlYXRlQ2xhc3MiOwppbXBvcnQgX3Bvc3NpYmxlQ29uc3RydWN0b3JSZXR1cm4gZnJvbSAiRjpcXGNyb2RcdTk4NzlcdTc2RUVcXFx1NEVCQVx1NEU4Qlx1N0JBMVx1NzQwNlx1N0NGQlx1N0VERjJcXGlCaXpFSFJcXGFwcF9FSFJQaW1cXG5vZGVfbW9kdWxlc1xcQGJhYmVsXFxydW50aW1lL2hlbHBlcnMvZXNtL3Bvc3NpYmxlQ29uc3RydWN0b3JSZXR1cm4iOwppbXBvcnQgX2dldFByb3RvdHlwZU9mIGZyb20gIkY6XFxjcm9kXHU5ODc5XHU3NkVFXFxcdTRFQkFcdTRFOEJcdTdCQTFcdTc0MDZcdTdDRkJcdTdFREYyXFxpQml6RUhSXFxhcHBfRUhSUGltXFxub2RlX21vZHVsZXNcXEBiYWJlbFxccnVudGltZS9oZWxwZXJzL2VzbS9nZXRQcm90b3R5cGVPZiI7CmltcG9ydCBfaW5oZXJpdHMgZnJvbSAiRjpcXGNyb2RcdTk4NzlcdTc2RUVcXFx1NEVCQVx1NEU4Qlx1N0JBMVx1NzQwNlx1N0NGQlx1N0VERjJcXGlCaXpFSFJcXGFwcF9FSFJQaW1cXG5vZGVfbW9kdWxlc1xcQGJhYmVsXFxydW50aW1lL2hlbHBlcnMvZXNtL2luaGVyaXRzIjsKaW1wb3J0ICogYXMgdHNsaWJfMSBmcm9tICJ0c2xpYiI7CmltcG9ydCB7IEVycm9ybG9nIH0gZnJvbSAnQC91dGlscyc7CmltcG9ydCBDb250cm9sU2VydmljZSBmcm9tICdAL3dpZGdldHMvY29udHJvbC1zZXJ2aWNlJzsKaW1wb3J0IFBpbUNvbnRyYWN0U2VydmljZSBmcm9tICdAL3NlcnZpY2UvcGltLWNvbnRyYWN0L3BpbS1jb250cmFjdC1zZXJ2aWNlJzsKaW1wb3J0IFRyZWVNb2RlbCBmcm9tICcuL3RyZWUtdHJlZXZpZXctbW9kZWwnOwppbXBvcnQgQ29kZUxpc3RTZXJ2aWNlIGZyb20gJ0BzZXJ2aWNlL2FwcC9jb2RlbGlzdC1zZXJ2aWNlJzsKaW1wb3J0IE9ybU9yZ1NlcnZpY2UgZnJvbSAnQHNlcnZpY2Uvb3JtLW9yZy9vcm0tb3JnLXNlcnZpY2UnOwovKioNCiAqIFRyZWUg6YOo5Lu25pyN5Yqh5a+56LGhDQogKg0KICogQGV4cG9ydA0KICogQGNsYXNzIFRyZWVTZXJ2aWNlDQogKi8KCnZhciBUcmVlU2VydmljZSA9Ci8qI19fUFVSRV9fKi8KZnVuY3Rpb24gKF9Db250cm9sU2VydmljZSkgewogIF9pbmhlcml0cyhUcmVlU2VydmljZSwgX0NvbnRyb2xTZXJ2aWNlKTsKCiAgLyoqDQogICAqIENyZWF0ZXMgYW4gaW5zdGFuY2Ugb2YgVHJlZVNlcnZpY2UuDQogICAqDQogICAqIEBwYXJhbSB7Kn0gW29wdHM9e31dDQogICAqIEBtZW1iZXJvZiBUcmVlU2VydmljZQ0KICAgKi8KICBmdW5jdGlvbiBUcmVlU2VydmljZSgpIHsKICAgIHZhciBfdGhpczsKCiAgICB2YXIgb3B0cyA9IGFyZ3VtZW50cy5sZW5ndGggPiAwICYmIGFyZ3VtZW50c1swXSAhPT0gdW5kZWZpbmVkID8gYXJndW1lbnRzWzBdIDoge307CgogICAgX2NsYXNzQ2FsbENoZWNrKHRoaXMsIFRyZWVTZXJ2aWNlKTsKCiAgICBfdGhpcyA9IF9wb3NzaWJsZUNvbnN0cnVjdG9yUmV0dXJuKHRoaXMsIF9nZXRQcm90b3R5cGVPZihUcmVlU2VydmljZSkuY2FsbCh0aGlzLCBvcHRzKSk7CiAgICAvKioNCiAgICAgKiDlkIjlkIzkv6Hmga/mnI3liqHlr7nosaENCiAgICAgKg0KICAgICAqIEB0eXBlIHtQaW1Db250cmFjdFNlcnZpY2V9DQogICAgICogQG1lbWJlcm9mIFRyZWVTZXJ2aWNlDQogICAgICovCgogICAgX3RoaXMuYXBwRW50aXR5U2VydmljZSA9IG5ldyBQaW1Db250cmFjdFNlcnZpY2UoewogICAgICAkc3RvcmU6IF90aGlzLmdldFN0b3JlKCkKICAgIH0pOwogICAgLyoqDQogICAgICog5Luj56CB6KGo5pyN5Yqh5a+56LGhDQogICAgICoNCiAgICAgKiBAdHlwZSB7Q29kZUxpc3RTZXJ2aWNlfQ0KICAgICAqIEBtZW1iZXJvZiBUcmVlU2VydmljZQ0KICAgICAqLwoKICAgIF90aGlzLmNvZGVMaXN0U2VydmljZSA9IG5ldyBDb2RlTGlzdFNlcnZpY2UoewogICAgICAkc3RvcmU6IF90aGlzLmdldFN0b3JlKCkKICAgIH0pOwogICAgLyoqDQogICAgICog57uE57uH566h55CG5pyN5Yqh5a+56LGhDQogICAgICoNCiAgICAgKiBAdHlwZSB7T3JtT3JnU2VydmljZX0NCiAgICAgKiBAbWVtYmVyb2YgVHJlZVNlcnZpY2UNCiAgICAgKi8KCiAgICBfdGhpcy5vcm1vcmdTZXJ2aWNlID0gbmV3IE9ybU9yZ1NlcnZpY2UoewogICAgICAkc3RvcmU6IF90aGlzLmdldFN0b3JlKCkKICAgIH0pOwogICAgLyoqDQogICAgICog6IqC54K55YiG6ZqU56ym5Y+3DQogICAgICoNCiAgICAgKiBAcHVibGljDQogICAgICogQHR5cGUge3N0cmluZ30NCiAgICAgKiBAbWVtYmVyb2YgVHJlZVNlcnZpY2UNCiAgICAgKi8KCiAgICBfdGhpcy5UUkVFTk9ERV9TRVBBUkFUT1IgPSAnOyc7CiAgICAvKioNCiAgICAgKiDlrZDnu4Tnu4foioLngrnoioLngrnliIbpmpTnrKblj7cNCiAgICAgKg0KICAgICAqIEBwdWJsaWMNCiAgICAgKiBAdHlwZSB7c3RyaW5nfQ0KICAgICAqIEBtZW1iZXJvZiBUcmVlU2VydmljZQ0KICAgICAqLwoKICAgIF90aGlzLlRSRUVOT0RFX1NVQk9SRyA9ICdTdWJPUkcnOwogICAgLyoqDQogICAgICog5qC557uE57uH6IqC54K56IqC54K55YiG6ZqU56ym5Y+3DQogICAgICoNCiAgICAgKiBAcHVibGljDQogICAgICogQHR5cGUge3N0cmluZ30NCiAgICAgKiBAbWVtYmVyb2YgVHJlZVNlcnZpY2UNCiAgICAgKi8KCiAgICBfdGhpcy5UUkVFTk9ERV9PUkcgPSAnT1JHJzsKICAgIC8qKg0KICAgICAqIOm7mOiupOagueiKgueCueiKgueCueWIhumalOespuWPtw0KICAgICAqDQogICAgICogQHB1YmxpYw0KICAgICAqIEB0eXBlIHtzdHJpbmd9DQogICAgICogQG1lbWJlcm9mIFRyZWVTZXJ2aWNlDQogICAgICovCgogICAgX3RoaXMuVFJFRU5PREVfUk9PVCA9ICdST09UJzsKICAgIF90aGlzLm1vZGVsID0gbmV3IFRyZWVNb2RlbCgpOwogICAgcmV0dXJuIF90aGlzOwogIH0KICAvKioNCiAgICog6K6+572u5LuO5pWw5o2u5qih5byPDQogICAqDQogICAqIEB0eXBlIHtib29sZWFufQ0KICAgKiBAbWVtYmVyb2YgVHJlZVNlcnZpY2UNCiAgICovCgoKICBfY3JlYXRlQ2xhc3MoVHJlZVNlcnZpY2UsIFt7CiAgICBrZXk6ICJzZXRUZW1wTW9kZSIsCiAgICB2YWx1ZTogZnVuY3Rpb24gc2V0VGVtcE1vZGUoKSB7CiAgICAgIHRoaXMuaXNUZW1wTW9kZSA9IGZhbHNlOwogICAgfQogICAgLyoqDQogICAgICog6I635Y+W6IqC54K55pWw5o2uDQogICAgICoNCiAgICAgKiBAcGFyYW0ge3N0cmluZ30gYWN0aW9uDQogICAgICogQHBhcmFtIHsqfSBbZGF0YT17fV0NCiAgICAgKiBAcGFyYW0ge2Jvb2xlYW59IFtpc2xvYWRpbmddDQogICAgICogQHJldHVybnMge1Byb21pc2U8YW55Pn0NCiAgICAgKiBAbWVtYmVyb2YgVHJlZVNlcnZpY2UNCiAgICAgKi8KCiAgfSwgewogICAga2V5OiAiZ2V0Tm9kZXMiLAogICAgdmFsdWU6IGZ1bmN0aW9uICgpIHsKICAgICAgdmFyIF9nZXROb2RlcyA9IF9hc3luY1RvR2VuZXJhdG9yKAogICAgICAvKiNfX1BVUkVfXyovCiAgICAgIHJlZ2VuZXJhdG9yUnVudGltZS5tYXJrKGZ1bmN0aW9uIF9jYWxsZWUoKSB7CiAgICAgICAgdmFyIGNvbnRleHQsCiAgICAgICAgICAgIGRhdGEsCiAgICAgICAgICAgIGlzbG9hZGluZywKICAgICAgICAgICAgc3JmcGFyZW50a2V5LAogICAgICAgICAgICBzcmZjYXQsCiAgICAgICAgICAgIHNyZm5vZGVpZCwKICAgICAgICAgICAgc3Jmbm9kZWZpbHRlciwKICAgICAgICAgICAgcXVlcnksCiAgICAgICAgICAgIGxpc3QsCiAgICAgICAgICAgIGZpbHRlciwKICAgICAgICAgICAgc3RyVHJlZU5vZGVJZCwKICAgICAgICAgICAgc3RyUmVhbE5vZGVJZCwKICAgICAgICAgICAgYlJvb3RTZWxlY3QsCiAgICAgICAgICAgIHN0ck5vZGVUeXBlLAogICAgICAgICAgICBzdHJSb290U2VsZWN0Tm9kZSwKICAgICAgICAgICAgblBvcywKICAgICAgICAgICAgbm9kZWlkLAogICAgICAgICAgICBpLAogICAgICAgICAgICBfYXJncyA9IGFyZ3VtZW50czsKICAgICAgICByZXR1cm4gcmVnZW5lcmF0b3JSdW50aW1lLndyYXAoZnVuY3Rpb24gX2NhbGxlZSQoX2NvbnRleHQpIHsKICAgICAgICAgIHdoaWxlICgxKSB7CiAgICAgICAgICAgIHN3aXRjaCAoX2NvbnRleHQucHJldiA9IF9jb250ZXh0Lm5leHQpIHsKICAgICAgICAgICAgICBjYXNlIDA6CiAgICAgICAgICAgICAgICBjb250ZXh0ID0gX2FyZ3MubGVuZ3RoID4gMCAmJiBfYXJnc1swXSAhPT0gdW5kZWZpbmVkID8gX2FyZ3NbMF0gOiB7fTsKICAgICAgICAgICAgICAgIGRhdGEgPSBfYXJncy5sZW5ndGggPiAxICYmIF9hcmdzWzFdICE9PSB1bmRlZmluZWQgPyBfYXJnc1sxXSA6IHt9OwogICAgICAgICAgICAgICAgaXNsb2FkaW5nID0gX2FyZ3MubGVuZ3RoID4gMiA/IF9hcmdzWzJdIDogdW5kZWZpbmVkOwogICAgICAgICAgICAgICAgc3JmcGFyZW50a2V5ID0gZGF0YS5zcmZwYXJlbnRrZXksIHNyZmNhdCA9IGRhdGEuc3JmY2F0LCBzcmZub2RlaWQgPSBkYXRhLnNyZm5vZGVpZCwgc3Jmbm9kZWZpbHRlciA9IGRhdGEuc3Jmbm9kZWZpbHRlciwgcXVlcnkgPSBkYXRhLnF1ZXJ5OwogICAgICAgICAgICAgICAgc3Jmbm9kZWZpbHRlciA9IHF1ZXJ5ID8gcXVlcnkgOiBzcmZub2RlZmlsdGVyOwogICAgICAgICAgICAgICAgbGlzdCA9IFtdOwogICAgICAgICAgICAgICAgZmlsdGVyID0ge307CgogICAgICAgICAgICAgICAgaWYgKCFzcmZub2RlaWQgfHwgT2JqZWN0LmlzKHNyZm5vZGVpZCwgJyMnKSkgewogICAgICAgICAgICAgICAgICBzcmZub2RlaWQgPSB0aGlzLlRSRUVOT0RFX1JPT1Q7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgc3RyVHJlZU5vZGVJZCA9IHNyZm5vZGVpZDsKICAgICAgICAgICAgICAgIHN0clJlYWxOb2RlSWQgPSAnJzsKICAgICAgICAgICAgICAgIGJSb290U2VsZWN0ID0gZmFsc2U7CiAgICAgICAgICAgICAgICBzdHJOb2RlVHlwZSA9IG51bGw7CiAgICAgICAgICAgICAgICBzdHJSb290U2VsZWN0Tm9kZSA9ICcnOwoKICAgICAgICAgICAgICAgIGlmICghT2JqZWN0LmlzKHN0clRyZWVOb2RlSWQsIHRoaXMuVFJFRU5PREVfUk9PVCkpIHsKICAgICAgICAgICAgICAgICAgX2NvbnRleHQubmV4dCA9IDE4OwogICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBzdHJOb2RlVHlwZSA9IHRoaXMuVFJFRU5PREVfUk9PVDsKCiAgICAgICAgICAgICAgICBpZiAoc3JmcGFyZW50a2V5KSB7CiAgICAgICAgICAgICAgICAgIHN0clJlYWxOb2RlSWQgPSBzcmZwYXJlbnRrZXk7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgX2NvbnRleHQubmV4dCA9IDIzOwogICAgICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgICAgIGNhc2UgMTg6CiAgICAgICAgICAgICAgICBuUG9zID0gc3RyVHJlZU5vZGVJZC5pbmRleE9mKHRoaXMuVFJFRU5PREVfU0VQQVJBVE9SKTsKCiAgICAgICAgICAgICAgICBpZiAoIShuUG9zID09PSAtMSkpIHsKICAgICAgICAgICAgICAgICAgX2NvbnRleHQubmV4dCA9IDIxOwogICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQuYWJydXB0KCJyZXR1cm4iLCBQcm9taXNlLnJlamVjdCh7CiAgICAgICAgICAgICAgICAgIHN0YXR1czogNTAwLAogICAgICAgICAgICAgICAgICBkYXRhOiB7CiAgICAgICAgICAgICAgICAgICAgdGl0bGU6ICflpLHotKUnLAogICAgICAgICAgICAgICAgICAgIG1lc3NhZ2U6ICJcdTY4MTFcdTgyODJcdTcwQjkiLmNvbmNhdChzdHJUcmVlTm9kZUlkLCAiXHU2ODA3XHU4QkM2XHU2NUUwXHU2NTQ4IikKICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSkpOwoKICAgICAgICAgICAgICBjYXNlIDIxOgogICAgICAgICAgICAgICAgc3RyTm9kZVR5cGUgPSBzdHJUcmVlTm9kZUlkLnN1YnN0cmluZygwLCBuUG9zKTsKICAgICAgICAgICAgICAgIHN0clJlYWxOb2RlSWQgPSBzdHJUcmVlTm9kZUlkLnN1YnN0cmluZyhuUG9zICsgMSk7CgogICAgICAgICAgICAgIGNhc2UgMjM6CiAgICAgICAgICAgICAgICBPYmplY3QuYXNzaWduKGZpbHRlciwgewogICAgICAgICAgICAgICAgICBzcmZwYXJlbnRrZXk6IHNyZnBhcmVudGtleSwKICAgICAgICAgICAgICAgICAgc3JmY2F0OiBzcmZjYXQsCiAgICAgICAgICAgICAgICAgIHNyZm5vZGVmaWx0ZXI6IHNyZm5vZGVmaWx0ZXIsCiAgICAgICAgICAgICAgICAgIHN0clJlYWxOb2RlSWQ6IHN0clJlYWxOb2RlSWQsCiAgICAgICAgICAgICAgICAgIHNyZm5vZGVpZDogc3Jmbm9kZWlkLAogICAgICAgICAgICAgICAgICBzdHJOb2RlVHlwZTogc3RyTm9kZVR5cGUsCiAgICAgICAgICAgICAgICAgIHZpZXdwYXJhbXM6IEpTT04ucGFyc2UoSlNPTi5zdHJpbmdpZnkoZGF0YSkpLnZpZXdwYXJhbXMKICAgICAgICAgICAgICAgIH0pOyAvLyDliIbop6PoioLngrnmoIfor4YKCiAgICAgICAgICAgICAgICBub2RlaWQgPSBzdHJSZWFsTm9kZUlkLnNwbGl0KHRoaXMuVFJFRU5PREVfU0VQQVJBVE9SKTsKICAgICAgICAgICAgICAgIGkgPSAwOwoKICAgICAgICAgICAgICBjYXNlIDI2OgogICAgICAgICAgICAgICAgaWYgKCEoaSA8IG5vZGVpZC5sZW5ndGgpKSB7CiAgICAgICAgICAgICAgICAgIF9jb250ZXh0Lm5leHQgPSA0MjsKICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgX2NvbnRleHQudDAgPSBpOwogICAgICAgICAgICAgICAgX2NvbnRleHQubmV4dCA9IF9jb250ZXh0LnQwID09PSAwID8gMzAgOiBfY29udGV4dC50MCA9PT0gMSA/IDMyIDogX2NvbnRleHQudDAgPT09IDIgPyAzNCA6IF9jb250ZXh0LnQwID09PSAzID8gMzYgOiAzODsKICAgICAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgICAgICBjYXNlIDMwOgogICAgICAgICAgICAgICAgT2JqZWN0LmFzc2lnbihmaWx0ZXIsIHsKICAgICAgICAgICAgICAgICAgbm9kZWlkOiBub2RlaWRbMF0KICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0LmFicnVwdCgiYnJlYWsiLCAzOSk7CgogICAgICAgICAgICAgIGNhc2UgMzI6CiAgICAgICAgICAgICAgICBPYmplY3QuYXNzaWduKGZpbHRlciwgewogICAgICAgICAgICAgICAgICBub2RlaWQyOiBub2RlaWRbMV0KICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0LmFicnVwdCgiYnJlYWsiLCAzOSk7CgogICAgICAgICAgICAgIGNhc2UgMzQ6CiAgICAgICAgICAgICAgICBPYmplY3QuYXNzaWduKGZpbHRlciwgewogICAgICAgICAgICAgICAgICBub2RlaWQzOiBub2RlaWRbMl0KICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0LmFicnVwdCgiYnJlYWsiLCAzOSk7CgogICAgICAgICAgICAgIGNhc2UgMzY6CiAgICAgICAgICAgICAgICBPYmplY3QuYXNzaWduKGZpbHRlciwgewogICAgICAgICAgICAgICAgICBub2RlaWQ0OiBub2RlaWRbM10KICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0LmFicnVwdCgiYnJlYWsiLCAzOSk7CgogICAgICAgICAgICAgIGNhc2UgMzg6CiAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQuYWJydXB0KCJicmVhayIsIDM5KTsKCiAgICAgICAgICAgICAgY2FzZSAzOToKICAgICAgICAgICAgICAgIGkrKzsKICAgICAgICAgICAgICAgIF9jb250ZXh0Lm5leHQgPSAyNjsKICAgICAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgICAgICBjYXNlIDQyOgogICAgICAgICAgICAgICAgaWYgKCFPYmplY3QuaXMoc3RyTm9kZVR5cGUsIHRoaXMuVFJFRU5PREVfU1VCT1JHKSkgewogICAgICAgICAgICAgICAgICBfY29udGV4dC5uZXh0ID0gNDY7CiAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIF9jb250ZXh0Lm5leHQgPSA0NTsKICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLmZpbGxTdWJvcmdOb2RlQ2hpbGRzKGNvbnRleHQsIGZpbHRlciwgbGlzdCk7CgogICAgICAgICAgICAgIGNhc2UgNDU6CiAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQuYWJydXB0KCJyZXR1cm4iLCBQcm9taXNlLnJlc29sdmUoewogICAgICAgICAgICAgICAgICBzdGF0dXM6IDIwMCwKICAgICAgICAgICAgICAgICAgZGF0YTogbGlzdAogICAgICAgICAgICAgICAgfSkpOwoKICAgICAgICAgICAgICBjYXNlIDQ2OgogICAgICAgICAgICAgICAgaWYgKCFPYmplY3QuaXMoc3RyTm9kZVR5cGUsIHRoaXMuVFJFRU5PREVfT1JHKSkgewogICAgICAgICAgICAgICAgICBfY29udGV4dC5uZXh0ID0gNTA7CiAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIF9jb250ZXh0Lm5leHQgPSA0OTsKICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLmZpbGxPcmdOb2RlQ2hpbGRzKGNvbnRleHQsIGZpbHRlciwgbGlzdCk7CgogICAgICAgICAgICAgIGNhc2UgNDk6CiAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQuYWJydXB0KCJyZXR1cm4iLCBQcm9taXNlLnJlc29sdmUoewogICAgICAgICAgICAgICAgICBzdGF0dXM6IDIwMCwKICAgICAgICAgICAgICAgICAgZGF0YTogbGlzdAogICAgICAgICAgICAgICAgfSkpOwoKICAgICAgICAgICAgICBjYXNlIDUwOgogICAgICAgICAgICAgICAgaWYgKCFPYmplY3QuaXMoc3RyTm9kZVR5cGUsIHRoaXMuVFJFRU5PREVfUk9PVCkpIHsKICAgICAgICAgICAgICAgICAgX2NvbnRleHQubmV4dCA9IDU0OwogICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBfY29udGV4dC5uZXh0ID0gNTM7CiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5maWxsUm9vdE5vZGVDaGlsZHMoY29udGV4dCwgZmlsdGVyLCBsaXN0KTsKCiAgICAgICAgICAgICAgY2FzZSA1MzoKICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dC5hYnJ1cHQoInJldHVybiIsIFByb21pc2UucmVzb2x2ZSh7CiAgICAgICAgICAgICAgICAgIHN0YXR1czogMjAwLAogICAgICAgICAgICAgICAgICBkYXRhOiBsaXN0CiAgICAgICAgICAgICAgICB9KSk7CgogICAgICAgICAgICAgIGNhc2UgNTQ6CiAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQuYWJydXB0KCJyZXR1cm4iLCBQcm9taXNlLnJlc29sdmUoewogICAgICAgICAgICAgICAgICBzdGF0dXM6IDUwMCwKICAgICAgICAgICAgICAgICAgZGF0YTogewogICAgICAgICAgICAgICAgICAgIHRpdGxlOiAn5aSx6LSlJywKICAgICAgICAgICAgICAgICAgICBtZXNzYWdlOiAiXHU2ODExXHU4MjgyXHU3MEI5Ii5jb25jYXQoc3RyVHJlZU5vZGVJZCwgIlx1NjgwN1x1OEJDNlx1NjVFMFx1NjU0OCIpCiAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0pKTsKCiAgICAgICAgICAgICAgY2FzZSA1NToKICAgICAgICAgICAgICBjYXNlICJlbmQiOgogICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0LnN0b3AoKTsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0sIF9jYWxsZWUsIHRoaXMpOwogICAgICB9KSk7CgogICAgICBmdW5jdGlvbiBnZXROb2RlcygpIHsKICAgICAgICByZXR1cm4gX2dldE5vZGVzLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7CiAgICAgIH0KCiAgICAgIHJldHVybiBnZXROb2RlczsKICAgIH0oKQogICAgLyoqDQogICAgICog5aGr5YWFIOagkeinhuWbvuiKgueCuVvlrZDnu4Tnu4foioLngrldDQogICAgICoNCiAgICAgKiBAcHVibGljDQogICAgICogQHBhcmFtIHthbnl7fX0gY29udGV4dA0KICAgICAqIEBwYXJhbSB7Kn0gZmlsdGVyDQogICAgICogQHBhcmFtIHthbnlbXX0gbGlzdA0KICAgICAqIEBwYXJhbSB7Kn0gcnNOYXZDb250ZXh0DQogICAgICogQHBhcmFtIHsqfSByc05hdlBhcmFtcw0KICAgICAqIEBwYXJhbSB7Kn0gcnNQYXJhbXMNCiAgICAgKiBAcmV0dXJucyB7UHJvbWlzZTxhbnk+fQ0KICAgICAqIEBtZW1iZXJvZiBUcmVlU2VydmljZQ0KICAgICAqLwoKICB9LCB7CiAgICBrZXk6ICJmaWxsU3Vib3JnTm9kZXMiLAogICAgdmFsdWU6IGZ1bmN0aW9uIGZpbGxTdWJvcmdOb2RlcygpIHsKICAgICAgdmFyIF90aGlzMiA9IHRoaXM7CgogICAgICB2YXIgY29udGV4dCA9IGFyZ3VtZW50cy5sZW5ndGggPiAwICYmIGFyZ3VtZW50c1swXSAhPT0gdW5kZWZpbmVkID8gYXJndW1lbnRzWzBdIDoge307CiAgICAgIHZhciBmaWx0ZXIgPSBhcmd1bWVudHMubGVuZ3RoID4gMSA/IGFyZ3VtZW50c1sxXSA6IHVuZGVmaW5lZDsKICAgICAgdmFyIGxpc3QgPSBhcmd1bWVudHMubGVuZ3RoID4gMiA/IGFyZ3VtZW50c1syXSA6IHVuZGVmaW5lZDsKICAgICAgdmFyIHJzTmF2Q29udGV4dCA9IGFyZ3VtZW50cy5sZW5ndGggPiAzID8gYXJndW1lbnRzWzNdIDogdW5kZWZpbmVkOwogICAgICB2YXIgcnNOYXZQYXJhbXMgPSBhcmd1bWVudHMubGVuZ3RoID4gNCA/IGFyZ3VtZW50c1s0XSA6IHVuZGVmaW5lZDsKICAgICAgdmFyIHJzUGFyYW1zID0gYXJndW1lbnRzLmxlbmd0aCA+IDUgPyBhcmd1bWVudHNbNV0gOiB1bmRlZmluZWQ7CiAgICAgIGNvbnRleHQgPSB0aGlzLmhhbmRsZVJlc05hdkNvbnRleHQoY29udGV4dCwgZmlsdGVyLCByc05hdkNvbnRleHQpOwogICAgICBmaWx0ZXIgPSB0aGlzLmhhbmRsZVJlc05hdlBhcmFtcyhjb250ZXh0LCBmaWx0ZXIsIHJzTmF2UGFyYW1zLCByc1BhcmFtcyk7CiAgICAgIHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbiAocmVzb2x2ZSwgcmVqZWN0KSB7CiAgICAgICAgdmFyIHNlYXJjaEZpbHRlciA9IHt9OwoKICAgICAgICBpZiAoT2JqZWN0LmlzKGZpbHRlci5zdHJOb2RlVHlwZSwgX3RoaXMyLlRSRUVOT0RFX09SRykpIHsKICAgICAgICAgIE9iamVjdC5hc3NpZ24oc2VhcmNoRmlsdGVyLCB7CiAgICAgICAgICAgIG5fcG9yZ2lkX2VxOiBmaWx0ZXIubm9kZWlkCiAgICAgICAgICB9KTsKICAgICAgICB9CgogICAgICAgIGlmIChPYmplY3QuaXMoZmlsdGVyLnN0ck5vZGVUeXBlLCBfdGhpczIuVFJFRU5PREVfU1VCT1JHKSkgewogICAgICAgICAgT2JqZWN0LmFzc2lnbihzZWFyY2hGaWx0ZXIsIHsKICAgICAgICAgICAgbl9wb3JnaWRfZXE6IGZpbHRlci5ub2RlaWQKICAgICAgICAgIH0pOwogICAgICAgIH0KCiAgICAgICAgT2JqZWN0LmFzc2lnbihzZWFyY2hGaWx0ZXIsIHsKICAgICAgICAgIHRvdGFsOiBmYWxzZQogICAgICAgIH0pOwogICAgICAgIE9iamVjdC5hc3NpZ24oc2VhcmNoRmlsdGVyLCB7CiAgICAgICAgICBxdWVyeTogZmlsdGVyLnNyZm5vZGVmaWx0ZXIKICAgICAgICB9KTsKICAgICAgICB2YXIgYkZpcnN0ID0gdHJ1ZTsKICAgICAgICB2YXIgcmVjb3JkcyA9IFtdOwoKICAgICAgICB0cnkgewogICAgICAgICAgX3RoaXMyLnNlYXJjaFN1Ym9yZyhjb250ZXh0LCBzZWFyY2hGaWx0ZXIsIGZpbHRlcikudGhlbihmdW5jdGlvbiAocmVjb3JkcykgewogICAgICAgICAgICBpZiAocmVjb3JkcyAmJiByZWNvcmRzLmxlbmd0aCA+IDApIHsKICAgICAgICAgICAgICByZWNvcmRzLmZvckVhY2goZnVuY3Rpb24gKGVudGl0eSkgewogICAgICAgICAgICAgICAgdmFyIHRyZWVOb2RlID0ge307IC8vIOaVtOeQhmNvbnRleHQKCiAgICAgICAgICAgICAgICB2YXIgc3RySWQgPSBlbnRpdHkub3JnaWQ7CiAgICAgICAgICAgICAgICB2YXIgc3RyVGV4dCA9IGVudGl0eS5zaG9ydG5hbWU7CiAgICAgICAgICAgICAgICBPYmplY3QuYXNzaWduKHRyZWVOb2RlLCB7CiAgICAgICAgICAgICAgICAgIHNyZnBhcmVudGRlbmFtZTogJ09ybU9yZycsCiAgICAgICAgICAgICAgICAgIHNyZnBhcmVudGtleTogZW50aXR5Lm9yZ2lkCiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIHZhciB0ZW1wQ29udGV4dCA9IEpTT04ucGFyc2UoSlNPTi5zdHJpbmdpZnkoY29udGV4dCkpOwogICAgICAgICAgICAgICAgT2JqZWN0LmFzc2lnbih0ZW1wQ29udGV4dCwgewogICAgICAgICAgICAgICAgICBzcmZwYXJlbnRkZW5hbWU6ICdPcm1PcmcnLAogICAgICAgICAgICAgICAgICBzcmZwYXJlbnRrZXk6IGVudGl0eS5vcmdpZCwKICAgICAgICAgICAgICAgICAgb3Jtb3JnOiBzdHJJZAogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICBPYmplY3QuYXNzaWduKHRyZWVOb2RlLCB7CiAgICAgICAgICAgICAgICAgIHNyZmFwcGN0eDogdGVtcENvbnRleHQKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgT2JqZWN0LmFzc2lnbih0cmVlTm9kZSwgewogICAgICAgICAgICAgICAgICAnb3Jtb3JnJzogc3RySWQKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgT2JqZWN0LmFzc2lnbih0cmVlTm9kZSwgewogICAgICAgICAgICAgICAgICBzcmZrZXk6IHN0cklkCiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIE9iamVjdC5hc3NpZ24odHJlZU5vZGUsIHsKICAgICAgICAgICAgICAgICAgdGV4dDogc3RyVGV4dCwKICAgICAgICAgICAgICAgICAgc3JmbWFqb3J0ZXh0OiBzdHJUZXh0CiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIHZhciBzdHJOb2RlSWQgPSAnU3ViT1JHJzsKICAgICAgICAgICAgICAgIHN0ck5vZGVJZCArPSBfdGhpczIuVFJFRU5PREVfU0VQQVJBVE9SOwogICAgICAgICAgICAgICAgc3RyTm9kZUlkICs9IHN0cklkOwogICAgICAgICAgICAgICAgT2JqZWN0LmFzc2lnbih0cmVlTm9kZSwgewogICAgICAgICAgICAgICAgICBpZDogc3RyTm9kZUlkCiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIE9iamVjdC5hc3NpZ24odHJlZU5vZGUsIHsKICAgICAgICAgICAgICAgICAgZXhwYW5kZWQ6IGZpbHRlci5pc2F1dG9leHBhbmQKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgT2JqZWN0LmFzc2lnbih0cmVlTm9kZSwgewogICAgICAgICAgICAgICAgICBsZWFmOiBmYWxzZQogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICBPYmplY3QuYXNzaWduKHRyZWVOb2RlLCB7CiAgICAgICAgICAgICAgICAgIG5hdmZpbHRlcjogIm5fb3Jtb3JnaWRfZXEiCiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIE9iamVjdC5hc3NpZ24odHJlZU5vZGUsIHsKICAgICAgICAgICAgICAgICAgY3VyRGF0YTogZW50aXR5CiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIE9iamVjdC5hc3NpZ24odHJlZU5vZGUsIHsKICAgICAgICAgICAgICAgICAgbm9kZWlkOiB0cmVlTm9kZS5zcmZrZXkKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgT2JqZWN0LmFzc2lnbih0cmVlTm9kZSwgewogICAgICAgICAgICAgICAgICBub2RlaWQyOiBmaWx0ZXIuc3RyUmVhbE5vZGVJZAogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICBsaXN0LnB1c2godHJlZU5vZGUpOwogICAgICAgICAgICAgICAgcmVzb2x2ZShsaXN0KTsKICAgICAgICAgICAgICAgIGJGaXJzdCA9IGZhbHNlOwogICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgIHJlc29sdmUobGlzdCk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0pOwogICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7CiAgICAgICAgICBjb25zb2xlLmVycm9yKGVycm9yKTsKICAgICAgICB9CiAgICAgIH0pOwogICAgfQogICAgLyoqDQogICAgICog6I635Y+W5p+l6K+i6ZuG5ZCIDQogICAgICoNCiAgICAgKiBAcHVibGljDQogICAgICogQHBhcmFtIHthbnl7fX0gY29udGV4dA0KICAgICAqIEBwYXJhbSB7Kn0gc2VhcmNoRmlsdGVyDQogICAgICogQHBhcmFtIHsqfSBmaWx0ZXINCiAgICAgKiBAcmV0dXJucyB7YW55W119DQogICAgICogQG1lbWJlcm9mIFRlc3RFbmV0aXR5RGF0YXNTZXJ2aWNlDQogICAgICovCgogIH0sIHsKICAgIGtleTogInNlYXJjaFN1Ym9yZyIsCiAgICB2YWx1ZTogZnVuY3Rpb24gc2VhcmNoU3Vib3JnKCkgewogICAgICB2YXIgX3RoaXMzID0gdGhpczsKCiAgICAgIHZhciBjb250ZXh0ID0gYXJndW1lbnRzLmxlbmd0aCA+IDAgJiYgYXJndW1lbnRzWzBdICE9PSB1bmRlZmluZWQgPyBhcmd1bWVudHNbMF0gOiB7fTsKICAgICAgdmFyIHNlYXJjaEZpbHRlciA9IGFyZ3VtZW50cy5sZW5ndGggPiAxID8gYXJndW1lbnRzWzFdIDogdW5kZWZpbmVkOwogICAgICB2YXIgZmlsdGVyID0gYXJndW1lbnRzLmxlbmd0aCA+IDIgPyBhcmd1bWVudHNbMl0gOiB1bmRlZmluZWQ7CiAgICAgIHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbiAocmVzb2x2ZSwgcmVqZWN0KSB7CiAgICAgICAgaWYgKGZpbHRlci52aWV3cGFyYW1zKSB7CiAgICAgICAgICBPYmplY3QuYXNzaWduKHNlYXJjaEZpbHRlciwgZmlsdGVyLnZpZXdwYXJhbXMpOwogICAgICAgIH0KCiAgICAgICAgaWYgKCFzZWFyY2hGaWx0ZXIucGFnZSkgewogICAgICAgICAgT2JqZWN0LmFzc2lnbihzZWFyY2hGaWx0ZXIsIHsKICAgICAgICAgICAgcGFnZTogMAogICAgICAgICAgfSk7CiAgICAgICAgfQoKICAgICAgICBpZiAoIXNlYXJjaEZpbHRlci5zaXplKSB7CiAgICAgICAgICBPYmplY3QuYXNzaWduKHNlYXJjaEZpbHRlciwgewogICAgICAgICAgICBzaXplOiAxMDAwCiAgICAgICAgICB9KTsKICAgICAgICB9CgogICAgICAgIGlmIChjb250ZXh0ICYmIGNvbnRleHQuc3JmcGFyZW50ZGVuYW1lKSB7CiAgICAgICAgICBPYmplY3QuYXNzaWduKHNlYXJjaEZpbHRlciwgewogICAgICAgICAgICBzcmZwYXJlbnRkZW5hbWU6IEpTT04ucGFyc2UoSlNPTi5zdHJpbmdpZnkoY29udGV4dCkpLnNyZnBhcmVudGRlbmFtZQogICAgICAgICAgfSk7CiAgICAgICAgfQoKICAgICAgICBpZiAoY29udGV4dCAmJiBjb250ZXh0LnNyZnBhcmVudGtleSkgewogICAgICAgICAgT2JqZWN0LmFzc2lnbihzZWFyY2hGaWx0ZXIsIHsKICAgICAgICAgICAgc3JmcGFyZW50a2V5OiBKU09OLnBhcnNlKEpTT04uc3RyaW5naWZ5KGNvbnRleHQpKS5zcmZwYXJlbnRrZXkKICAgICAgICAgIH0pOwogICAgICAgIH0KCiAgICAgICAgT2JqZWN0LmFzc2lnbihzZWFyY2hGaWx0ZXIsIHsKICAgICAgICAgIHNvcnQ6ICdweCxhc2MnCiAgICAgICAgfSk7CiAgICAgICAgdmFyIF9hcHBFbnRpdHlTZXJ2aWNlID0gX3RoaXMzLm9ybW9yZ1NlcnZpY2U7CiAgICAgICAgdmFyIGxpc3QgPSBbXTsKCiAgICAgICAgaWYgKF9hcHBFbnRpdHlTZXJ2aWNlWydGZXRjaEN1ckNoaWxkJ10gJiYgX2FwcEVudGl0eVNlcnZpY2VbJ0ZldGNoQ3VyQ2hpbGQnXSBpbnN0YW5jZW9mIEZ1bmN0aW9uKSB7CiAgICAgICAgICB2YXIgcmVzcG9uc2UgPSBfYXBwRW50aXR5U2VydmljZVsnRmV0Y2hDdXJDaGlsZCddKGNvbnRleHQsIHNlYXJjaEZpbHRlciwgZmFsc2UpOwoKICAgICAgICAgIHJlc3BvbnNlLnRoZW4oZnVuY3Rpb24gKHJlc3BvbnNlKSB7CiAgICAgICAgICAgIGlmICghcmVzcG9uc2Uuc3RhdHVzIHx8IHJlc3BvbnNlLnN0YXR1cyAhPT0gMjAwKSB7CiAgICAgICAgICAgICAgcmVzb2x2ZShbXSk7CiAgICAgICAgICAgICAgY29uc29sZS5sb2coSlNPTi5zdHJpbmdpZnkoY29udGV4dCkpOwogICAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoJ+afpeivokZldGNoQ3VyQ2hpbGTmlbDmja7pm4blvILluLghJyk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHZhciBkYXRhID0gcmVzcG9uc2UuZGF0YTsKCiAgICAgICAgICAgIGlmIChPYmplY3Qua2V5cyhkYXRhKS5sZW5ndGggPiAwKSB7CiAgICAgICAgICAgICAgbGlzdCA9IEpTT04ucGFyc2UoSlNPTi5zdHJpbmdpZnkoZGF0YSkpOwogICAgICAgICAgICAgIHJlc29sdmUobGlzdCk7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgcmVzb2x2ZShbXSk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0pWyJjYXRjaCJdKGZ1bmN0aW9uIChyZXNwb25zZSkgewogICAgICAgICAgICByZXNvbHZlKFtdKTsKICAgICAgICAgICAgY29uc29sZS5sb2coSlNPTi5zdHJpbmdpZnkoY29udGV4dCkpOwogICAgICAgICAgICBjb25zb2xlLmVycm9yKCfmn6Xor6JGZXRjaEN1ckNoaWxk5pWw5o2u6ZuG5byC5bi4IScpOwogICAgICAgICAgfSk7CiAgICAgICAgfQogICAgICB9KTsKICAgIH0KICAgIC8qKg0KICAgICAqIOWhq+WFhSDmoJHop4blm77oioLngrlb5a2Q57uE57uH6IqC54K5XeWtkOiKgueCuQ0KICAgICAqDQogICAgICogQHB1YmxpYw0KICAgICAqIEBwYXJhbSB7YW55e319IGNvbnRleHQNCiAgICAgKiBAcGFyYW0geyp9IGZpbHRlcg0KICAgICAqIEBwYXJhbSB7YW55W119IGxpc3QNCiAgICAgKiBAcmV0dXJucyB7UHJvbWlzZTxhbnk+fQ0KICAgICAqIEBtZW1iZXJvZiBUcmVlU2VydmljZQ0KICAgICAqLwoKICB9LCB7CiAgICBrZXk6ICJmaWxsU3Vib3JnTm9kZUNoaWxkcyIsCiAgICB2YWx1ZTogZnVuY3Rpb24gKCkgewogICAgICB2YXIgX2ZpbGxTdWJvcmdOb2RlQ2hpbGRzID0gX2FzeW5jVG9HZW5lcmF0b3IoCiAgICAgIC8qI19fUFVSRV9fKi8KICAgICAgcmVnZW5lcmF0b3JSdW50aW1lLm1hcmsoZnVuY3Rpb24gX2NhbGxlZTIoKSB7CiAgICAgICAgdmFyIGNvbnRleHQsCiAgICAgICAgICAgIGZpbHRlciwKICAgICAgICAgICAgbGlzdCwKICAgICAgICAgICAgU3Vib3JnUnNOYXZDb250ZXh0LAogICAgICAgICAgICBTdWJvcmdSc05hdlBhcmFtcywKICAgICAgICAgICAgU3Vib3JnUnNQYXJhbXMsCiAgICAgICAgICAgIF9TdWJvcmdSc05hdkNvbnRleHQsCiAgICAgICAgICAgIF9TdWJvcmdSc05hdlBhcmFtcywKICAgICAgICAgICAgX1N1Ym9yZ1JzUGFyYW1zLAogICAgICAgICAgICBfYXJnczIgPSBhcmd1bWVudHM7CgogICAgICAgIHJldHVybiByZWdlbmVyYXRvclJ1bnRpbWUud3JhcChmdW5jdGlvbiBfY2FsbGVlMiQoX2NvbnRleHQyKSB7CiAgICAgICAgICB3aGlsZSAoMSkgewogICAgICAgICAgICBzd2l0Y2ggKF9jb250ZXh0Mi5wcmV2ID0gX2NvbnRleHQyLm5leHQpIHsKICAgICAgICAgICAgICBjYXNlIDA6CiAgICAgICAgICAgICAgICBjb250ZXh0ID0gX2FyZ3MyLmxlbmd0aCA+IDAgJiYgX2FyZ3MyWzBdICE9PSB1bmRlZmluZWQgPyBfYXJnczJbMF0gOiB7fTsKICAgICAgICAgICAgICAgIGZpbHRlciA9IF9hcmdzMi5sZW5ndGggPiAxID8gX2FyZ3MyWzFdIDogdW5kZWZpbmVkOwogICAgICAgICAgICAgICAgbGlzdCA9IF9hcmdzMi5sZW5ndGggPiAyID8gX2FyZ3MyWzJdIDogdW5kZWZpbmVkOwoKICAgICAgICAgICAgICAgIGlmICghKGZpbHRlci5zcmZub2RlZmlsdGVyICYmICFPYmplY3QuaXMoZmlsdGVyLnNyZm5vZGVmaWx0ZXIsICIiKSkpIHsKICAgICAgICAgICAgICAgICAgX2NvbnRleHQyLm5leHQgPSAxMTsKICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgLy8g5aGr5YWF5a2Q57uE57uH6IqC54K5CiAgICAgICAgICAgICAgICBTdWJvcmdSc05hdkNvbnRleHQgPSB7fTsKICAgICAgICAgICAgICAgIFN1Ym9yZ1JzTmF2UGFyYW1zID0ge307CiAgICAgICAgICAgICAgICBTdWJvcmdSc1BhcmFtcyA9IHt9OwogICAgICAgICAgICAgICAgX2NvbnRleHQyLm5leHQgPSA5OwogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuZmlsbFN1Ym9yZ05vZGVzKGNvbnRleHQsIGZpbHRlciwgbGlzdCwgU3Vib3JnUnNOYXZDb250ZXh0LCBTdWJvcmdSc05hdlBhcmFtcywgU3Vib3JnUnNQYXJhbXMpOwoKICAgICAgICAgICAgICBjYXNlIDk6CiAgICAgICAgICAgICAgICBfY29udGV4dDIubmV4dCA9IDE2OwogICAgICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgICAgIGNhc2UgMTE6CiAgICAgICAgICAgICAgICAvLyDloavlhYXlrZDnu4Tnu4foioLngrkKICAgICAgICAgICAgICAgIF9TdWJvcmdSc05hdkNvbnRleHQgPSB7fTsKICAgICAgICAgICAgICAgIF9TdWJvcmdSc05hdlBhcmFtcyA9IHt9OwogICAgICAgICAgICAgICAgX1N1Ym9yZ1JzUGFyYW1zID0ge307CiAgICAgICAgICAgICAgICBfY29udGV4dDIubmV4dCA9IDE2OwogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuZmlsbFN1Ym9yZ05vZGVzKGNvbnRleHQsIGZpbHRlciwgbGlzdCwgX1N1Ym9yZ1JzTmF2Q29udGV4dCwgX1N1Ym9yZ1JzTmF2UGFyYW1zLCBfU3Vib3JnUnNQYXJhbXMpOwoKICAgICAgICAgICAgICBjYXNlIDE2OgogICAgICAgICAgICAgIGNhc2UgImVuZCI6CiAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQyLnN0b3AoKTsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0sIF9jYWxsZWUyLCB0aGlzKTsKICAgICAgfSkpOwoKICAgICAgZnVuY3Rpb24gZmlsbFN1Ym9yZ05vZGVDaGlsZHMoKSB7CiAgICAgICAgcmV0dXJuIF9maWxsU3Vib3JnTm9kZUNoaWxkcy5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwogICAgICB9CgogICAgICByZXR1cm4gZmlsbFN1Ym9yZ05vZGVDaGlsZHM7CiAgICB9KCkKICAgIC8qKg0KICAgICAqIOWhq+WFhSDmoJHop4blm77oioLngrlb5qC557uE57uH6IqC54K5XQ0KICAgICAqDQogICAgICogQHB1YmxpYw0KICAgICAqIEBwYXJhbSB7YW55e319IGNvbnRleHQNCiAgICAgKiBAcGFyYW0geyp9IGZpbHRlcg0KICAgICAqIEBwYXJhbSB7YW55W119IGxpc3QNCiAgICAgKiBAcGFyYW0geyp9IHJzTmF2Q29udGV4dA0KICAgICAqIEBwYXJhbSB7Kn0gcnNOYXZQYXJhbXMNCiAgICAgKiBAcGFyYW0geyp9IHJzUGFyYW1zDQogICAgICogQHJldHVybnMge1Byb21pc2U8YW55Pn0NCiAgICAgKiBAbWVtYmVyb2YgVHJlZVNlcnZpY2UNCiAgICAgKi8KCiAgfSwgewogICAga2V5OiAiZmlsbE9yZ05vZGVzIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBmaWxsT3JnTm9kZXMoKSB7CiAgICAgIHZhciBfdGhpczQgPSB0aGlzOwoKICAgICAgdmFyIGNvbnRleHQgPSBhcmd1bWVudHMubGVuZ3RoID4gMCAmJiBhcmd1bWVudHNbMF0gIT09IHVuZGVmaW5lZCA/IGFyZ3VtZW50c1swXSA6IHt9OwogICAgICB2YXIgZmlsdGVyID0gYXJndW1lbnRzLmxlbmd0aCA+IDEgPyBhcmd1bWVudHNbMV0gOiB1bmRlZmluZWQ7CiAgICAgIHZhciBsaXN0ID0gYXJndW1lbnRzLmxlbmd0aCA+IDIgPyBhcmd1bWVudHNbMl0gOiB1bmRlZmluZWQ7CiAgICAgIHZhciByc05hdkNvbnRleHQgPSBhcmd1bWVudHMubGVuZ3RoID4gMyA/IGFyZ3VtZW50c1szXSA6IHVuZGVmaW5lZDsKICAgICAgdmFyIHJzTmF2UGFyYW1zID0gYXJndW1lbnRzLmxlbmd0aCA+IDQgPyBhcmd1bWVudHNbNF0gOiB1bmRlZmluZWQ7CiAgICAgIHZhciByc1BhcmFtcyA9IGFyZ3VtZW50cy5sZW5ndGggPiA1ID8gYXJndW1lbnRzWzVdIDogdW5kZWZpbmVkOwogICAgICBjb250ZXh0ID0gdGhpcy5oYW5kbGVSZXNOYXZDb250ZXh0KGNvbnRleHQsIGZpbHRlciwgcnNOYXZDb250ZXh0KTsKICAgICAgZmlsdGVyID0gdGhpcy5oYW5kbGVSZXNOYXZQYXJhbXMoY29udGV4dCwgZmlsdGVyLCByc05hdlBhcmFtcywgcnNQYXJhbXMpOwogICAgICByZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24gKHJlc29sdmUsIHJlamVjdCkgewogICAgICAgIHZhciBzZWFyY2hGaWx0ZXIgPSB7fTsKICAgICAgICBPYmplY3QuYXNzaWduKHNlYXJjaEZpbHRlciwgewogICAgICAgICAgdG90YWw6IGZhbHNlCiAgICAgICAgfSk7CiAgICAgICAgT2JqZWN0LmFzc2lnbihzZWFyY2hGaWx0ZXIsIHsKICAgICAgICAgIHF1ZXJ5OiBmaWx0ZXIuc3Jmbm9kZWZpbHRlcgogICAgICAgIH0pOwogICAgICAgIHZhciBiRmlyc3QgPSB0cnVlOwogICAgICAgIHZhciByZWNvcmRzID0gW107CgogICAgICAgIHRyeSB7CiAgICAgICAgICBfdGhpczQuc2VhcmNoT3JnKGNvbnRleHQsIHNlYXJjaEZpbHRlciwgZmlsdGVyKS50aGVuKGZ1bmN0aW9uIChyZWNvcmRzKSB7CiAgICAgICAgICAgIGlmIChyZWNvcmRzICYmIHJlY29yZHMubGVuZ3RoID4gMCkgewogICAgICAgICAgICAgIHJlY29yZHMuZm9yRWFjaChmdW5jdGlvbiAoZW50aXR5KSB7CiAgICAgICAgICAgICAgICB2YXIgdHJlZU5vZGUgPSB7fTsgLy8g5pW055CGY29udGV4dAoKICAgICAgICAgICAgICAgIHZhciBzdHJJZCA9IGVudGl0eS5vcmdpZDsKICAgICAgICAgICAgICAgIHZhciBzdHJUZXh0ID0gZW50aXR5LnNob3J0bmFtZTsKICAgICAgICAgICAgICAgIE9iamVjdC5hc3NpZ24odHJlZU5vZGUsIHsKICAgICAgICAgICAgICAgICAgc3JmcGFyZW50ZGVuYW1lOiAnT3JtT3JnJywKICAgICAgICAgICAgICAgICAgc3JmcGFyZW50a2V5OiBlbnRpdHkub3JnaWQKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgdmFyIHRlbXBDb250ZXh0ID0gSlNPTi5wYXJzZShKU09OLnN0cmluZ2lmeShjb250ZXh0KSk7CiAgICAgICAgICAgICAgICBPYmplY3QuYXNzaWduKHRlbXBDb250ZXh0LCB7CiAgICAgICAgICAgICAgICAgIHNyZnBhcmVudGRlbmFtZTogJ09ybU9yZycsCiAgICAgICAgICAgICAgICAgIHNyZnBhcmVudGtleTogZW50aXR5Lm9yZ2lkLAogICAgICAgICAgICAgICAgICBvcm1vcmc6IHN0cklkCiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIE9iamVjdC5hc3NpZ24odHJlZU5vZGUsIHsKICAgICAgICAgICAgICAgICAgc3JmYXBwY3R4OiB0ZW1wQ29udGV4dAogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICBPYmplY3QuYXNzaWduKHRyZWVOb2RlLCB7CiAgICAgICAgICAgICAgICAgICdvcm1vcmcnOiBzdHJJZAogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICBPYmplY3QuYXNzaWduKHRyZWVOb2RlLCB7CiAgICAgICAgICAgICAgICAgIHNyZmtleTogc3RySWQKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgT2JqZWN0LmFzc2lnbih0cmVlTm9kZSwgewogICAgICAgICAgICAgICAgICB0ZXh0OiBzdHJUZXh0LAogICAgICAgICAgICAgICAgICBzcmZtYWpvcnRleHQ6IHN0clRleHQKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgdmFyIHN0ck5vZGVJZCA9ICdPUkcnOwogICAgICAgICAgICAgICAgc3RyTm9kZUlkICs9IF90aGlzNC5UUkVFTk9ERV9TRVBBUkFUT1I7CiAgICAgICAgICAgICAgICBzdHJOb2RlSWQgKz0gc3RySWQ7CiAgICAgICAgICAgICAgICBPYmplY3QuYXNzaWduKHRyZWVOb2RlLCB7CiAgICAgICAgICAgICAgICAgIGlkOiBzdHJOb2RlSWQKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgT2JqZWN0LmFzc2lnbih0cmVlTm9kZSwgewogICAgICAgICAgICAgICAgICBleHBhbmRlZDogdHJ1ZQogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICBPYmplY3QuYXNzaWduKHRyZWVOb2RlLCB7CiAgICAgICAgICAgICAgICAgIGxlYWY6IGZhbHNlCiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIE9iamVjdC5hc3NpZ24odHJlZU5vZGUsIHsKICAgICAgICAgICAgICAgICAgY3VyRGF0YTogZW50aXR5CiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIE9iamVjdC5hc3NpZ24odHJlZU5vZGUsIHsKICAgICAgICAgICAgICAgICAgbm9kZWlkOiB0cmVlTm9kZS5zcmZrZXkKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgT2JqZWN0LmFzc2lnbih0cmVlTm9kZSwgewogICAgICAgICAgICAgICAgICBub2RlaWQyOiBmaWx0ZXIuc3RyUmVhbE5vZGVJZAogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICBsaXN0LnB1c2godHJlZU5vZGUpOwogICAgICAgICAgICAgICAgcmVzb2x2ZShsaXN0KTsKICAgICAgICAgICAgICAgIGJGaXJzdCA9IGZhbHNlOwogICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgIHJlc29sdmUobGlzdCk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0pOwogICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7CiAgICAgICAgICBjb25zb2xlLmVycm9yKGVycm9yKTsKICAgICAgICB9CiAgICAgIH0pOwogICAgfQogICAgLyoqDQogICAgICog6I635Y+W5p+l6K+i6ZuG5ZCIDQogICAgICoNCiAgICAgKiBAcHVibGljDQogICAgICogQHBhcmFtIHthbnl7fX0gY29udGV4dA0KICAgICAqIEBwYXJhbSB7Kn0gc2VhcmNoRmlsdGVyDQogICAgICogQHBhcmFtIHsqfSBmaWx0ZXINCiAgICAgKiBAcmV0dXJucyB7YW55W119DQogICAgICogQG1lbWJlcm9mIFRlc3RFbmV0aXR5RGF0YXNTZXJ2aWNlDQogICAgICovCgogIH0sIHsKICAgIGtleTogInNlYXJjaE9yZyIsCiAgICB2YWx1ZTogZnVuY3Rpb24gc2VhcmNoT3JnKCkgewogICAgICB2YXIgX3RoaXM1ID0gdGhpczsKCiAgICAgIHZhciBjb250ZXh0ID0gYXJndW1lbnRzLmxlbmd0aCA+IDAgJiYgYXJndW1lbnRzWzBdICE9PSB1bmRlZmluZWQgPyBhcmd1bWVudHNbMF0gOiB7fTsKICAgICAgdmFyIHNlYXJjaEZpbHRlciA9IGFyZ3VtZW50cy5sZW5ndGggPiAxID8gYXJndW1lbnRzWzFdIDogdW5kZWZpbmVkOwogICAgICB2YXIgZmlsdGVyID0gYXJndW1lbnRzLmxlbmd0aCA+IDIgPyBhcmd1bWVudHNbMl0gOiB1bmRlZmluZWQ7CiAgICAgIHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbiAocmVzb2x2ZSwgcmVqZWN0KSB7CiAgICAgICAgaWYgKGZpbHRlci52aWV3cGFyYW1zKSB7CiAgICAgICAgICBPYmplY3QuYXNzaWduKHNlYXJjaEZpbHRlciwgZmlsdGVyLnZpZXdwYXJhbXMpOwogICAgICAgIH0KCiAgICAgICAgaWYgKCFzZWFyY2hGaWx0ZXIucGFnZSkgewogICAgICAgICAgT2JqZWN0LmFzc2lnbihzZWFyY2hGaWx0ZXIsIHsKICAgICAgICAgICAgcGFnZTogMAogICAgICAgICAgfSk7CiAgICAgICAgfQoKICAgICAgICBpZiAoIXNlYXJjaEZpbHRlci5zaXplKSB7CiAgICAgICAgICBPYmplY3QuYXNzaWduKHNlYXJjaEZpbHRlciwgewogICAgICAgICAgICBzaXplOiAxMDAwCiAgICAgICAgICB9KTsKICAgICAgICB9CgogICAgICAgIGlmIChjb250ZXh0ICYmIGNvbnRleHQuc3JmcGFyZW50ZGVuYW1lKSB7CiAgICAgICAgICBPYmplY3QuYXNzaWduKHNlYXJjaEZpbHRlciwgewogICAgICAgICAgICBzcmZwYXJlbnRkZW5hbWU6IEpTT04ucGFyc2UoSlNPTi5zdHJpbmdpZnkoY29udGV4dCkpLnNyZnBhcmVudGRlbmFtZQogICAgICAgICAgfSk7CiAgICAgICAgfQoKICAgICAgICBpZiAoY29udGV4dCAmJiBjb250ZXh0LnNyZnBhcmVudGtleSkgewogICAgICAgICAgT2JqZWN0LmFzc2lnbihzZWFyY2hGaWx0ZXIsIHsKICAgICAgICAgICAgc3JmcGFyZW50a2V5OiBKU09OLnBhcnNlKEpTT04uc3RyaW5naWZ5KGNvbnRleHQpKS5zcmZwYXJlbnRrZXkKICAgICAgICAgIH0pOwogICAgICAgIH0KCiAgICAgICAgT2JqZWN0LmFzc2lnbihzZWFyY2hGaWx0ZXIsIHsKICAgICAgICAgIHNvcnQ6ICdweCxhc2MnCiAgICAgICAgfSk7CiAgICAgICAgdmFyIF9hcHBFbnRpdHlTZXJ2aWNlID0gX3RoaXM1Lm9ybW9yZ1NlcnZpY2U7CiAgICAgICAgdmFyIGxpc3QgPSBbXTsKCiAgICAgICAgaWYgKF9hcHBFbnRpdHlTZXJ2aWNlWydGZXRjaEN1clBvcmcnXSAmJiBfYXBwRW50aXR5U2VydmljZVsnRmV0Y2hDdXJQb3JnJ10gaW5zdGFuY2VvZiBGdW5jdGlvbikgewogICAgICAgICAgdmFyIHJlc3BvbnNlID0gX2FwcEVudGl0eVNlcnZpY2VbJ0ZldGNoQ3VyUG9yZyddKGNvbnRleHQsIHNlYXJjaEZpbHRlciwgZmFsc2UpOwoKICAgICAgICAgIHJlc3BvbnNlLnRoZW4oZnVuY3Rpb24gKHJlc3BvbnNlKSB7CiAgICAgICAgICAgIGlmICghcmVzcG9uc2Uuc3RhdHVzIHx8IHJlc3BvbnNlLnN0YXR1cyAhPT0gMjAwKSB7CiAgICAgICAgICAgICAgcmVzb2x2ZShbXSk7CiAgICAgICAgICAgICAgY29uc29sZS5sb2coSlNPTi5zdHJpbmdpZnkoY29udGV4dCkpOwogICAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoJ+afpeivokZldGNoQ3VyUG9yZ+aVsOaNrumbhuW8guW4uCEnKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgdmFyIGRhdGEgPSByZXNwb25zZS5kYXRhOwoKICAgICAgICAgICAgaWYgKE9iamVjdC5rZXlzKGRhdGEpLmxlbmd0aCA+IDApIHsKICAgICAgICAgICAgICBsaXN0ID0gSlNPTi5wYXJzZShKU09OLnN0cmluZ2lmeShkYXRhKSk7CiAgICAgICAgICAgICAgcmVzb2x2ZShsaXN0KTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICByZXNvbHZlKFtdKTsKICAgICAgICAgICAgfQogICAgICAgICAgfSlbImNhdGNoIl0oZnVuY3Rpb24gKHJlc3BvbnNlKSB7CiAgICAgICAgICAgIHJlc29sdmUoW10pOwogICAgICAgICAgICBjb25zb2xlLmxvZyhKU09OLnN0cmluZ2lmeShjb250ZXh0KSk7CiAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoJ+afpeivokZldGNoQ3VyUG9yZ+aVsOaNrumbhuW8guW4uCEnKTsKICAgICAgICAgIH0pOwogICAgICAgIH0KICAgICAgfSk7CiAgICB9CiAgICAvKioNCiAgICAgKiDloavlhYUg5qCR6KeG5Zu+6IqC54K5W+aguee7hOe7h+iKgueCuV3lrZDoioLngrkNCiAgICAgKg0KICAgICAqIEBwdWJsaWMNCiAgICAgKiBAcGFyYW0ge2FueXt9fSBjb250ZXh0DQogICAgICogQHBhcmFtIHsqfSBmaWx0ZXINCiAgICAgKiBAcGFyYW0ge2FueVtdfSBsaXN0DQogICAgICogQHJldHVybnMge1Byb21pc2U8YW55Pn0NCiAgICAgKiBAbWVtYmVyb2YgVHJlZVNlcnZpY2UNCiAgICAgKi8KCiAgfSwgewogICAga2V5OiAiZmlsbE9yZ05vZGVDaGlsZHMiLAogICAgdmFsdWU6IGZ1bmN0aW9uICgpIHsKICAgICAgdmFyIF9maWxsT3JnTm9kZUNoaWxkcyA9IF9hc3luY1RvR2VuZXJhdG9yKAogICAgICAvKiNfX1BVUkVfXyovCiAgICAgIHJlZ2VuZXJhdG9yUnVudGltZS5tYXJrKGZ1bmN0aW9uIF9jYWxsZWUzKCkgewogICAgICAgIHZhciBjb250ZXh0LAogICAgICAgICAgICBmaWx0ZXIsCiAgICAgICAgICAgIGxpc3QsCiAgICAgICAgICAgIFN1Ym9yZ1JzTmF2Q29udGV4dCwKICAgICAgICAgICAgU3Vib3JnUnNOYXZQYXJhbXMsCiAgICAgICAgICAgIFN1Ym9yZ1JzUGFyYW1zLAogICAgICAgICAgICBfU3Vib3JnUnNOYXZDb250ZXh0MiwKICAgICAgICAgICAgX1N1Ym9yZ1JzTmF2UGFyYW1zMiwKICAgICAgICAgICAgX1N1Ym9yZ1JzUGFyYW1zMiwKICAgICAgICAgICAgX2FyZ3MzID0gYXJndW1lbnRzOwoKICAgICAgICByZXR1cm4gcmVnZW5lcmF0b3JSdW50aW1lLndyYXAoZnVuY3Rpb24gX2NhbGxlZTMkKF9jb250ZXh0MykgewogICAgICAgICAgd2hpbGUgKDEpIHsKICAgICAgICAgICAgc3dpdGNoIChfY29udGV4dDMucHJldiA9IF9jb250ZXh0My5uZXh0KSB7CiAgICAgICAgICAgICAgY2FzZSAwOgogICAgICAgICAgICAgICAgY29udGV4dCA9IF9hcmdzMy5sZW5ndGggPiAwICYmIF9hcmdzM1swXSAhPT0gdW5kZWZpbmVkID8gX2FyZ3MzWzBdIDoge307CiAgICAgICAgICAgICAgICBmaWx0ZXIgPSBfYXJnczMubGVuZ3RoID4gMSA/IF9hcmdzM1sxXSA6IHVuZGVmaW5lZDsKICAgICAgICAgICAgICAgIGxpc3QgPSBfYXJnczMubGVuZ3RoID4gMiA/IF9hcmdzM1syXSA6IHVuZGVmaW5lZDsKCiAgICAgICAgICAgICAgICBpZiAoIShmaWx0ZXIuc3Jmbm9kZWZpbHRlciAmJiAhT2JqZWN0LmlzKGZpbHRlci5zcmZub2RlZmlsdGVyLCAiIikpKSB7CiAgICAgICAgICAgICAgICAgIF9jb250ZXh0My5uZXh0ID0gMTE7CiAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIC8vIOWhq+WFheWtkOe7hOe7h+iKgueCuQogICAgICAgICAgICAgICAgU3Vib3JnUnNOYXZDb250ZXh0ID0ge307CiAgICAgICAgICAgICAgICBTdWJvcmdSc05hdlBhcmFtcyA9IHt9OwogICAgICAgICAgICAgICAgU3Vib3JnUnNQYXJhbXMgPSB7fTsKICAgICAgICAgICAgICAgIF9jb250ZXh0My5uZXh0ID0gOTsKICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLmZpbGxTdWJvcmdOb2Rlcyhjb250ZXh0LCBmaWx0ZXIsIGxpc3QsIFN1Ym9yZ1JzTmF2Q29udGV4dCwgU3Vib3JnUnNOYXZQYXJhbXMsIFN1Ym9yZ1JzUGFyYW1zKTsKCiAgICAgICAgICAgICAgY2FzZSA5OgogICAgICAgICAgICAgICAgX2NvbnRleHQzLm5leHQgPSAxNjsKICAgICAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgICAgICBjYXNlIDExOgogICAgICAgICAgICAgICAgLy8g5aGr5YWF5a2Q57uE57uH6IqC54K5CiAgICAgICAgICAgICAgICBfU3Vib3JnUnNOYXZDb250ZXh0MiA9IHt9OwogICAgICAgICAgICAgICAgX1N1Ym9yZ1JzTmF2UGFyYW1zMiA9IHt9OwogICAgICAgICAgICAgICAgX1N1Ym9yZ1JzUGFyYW1zMiA9IHt9OwogICAgICAgICAgICAgICAgX2NvbnRleHQzLm5leHQgPSAxNjsKICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLmZpbGxTdWJvcmdOb2Rlcyhjb250ZXh0LCBmaWx0ZXIsIGxpc3QsIF9TdWJvcmdSc05hdkNvbnRleHQyLCBfU3Vib3JnUnNOYXZQYXJhbXMyLCBfU3Vib3JnUnNQYXJhbXMyKTsKCiAgICAgICAgICAgICAgY2FzZSAxNjoKICAgICAgICAgICAgICBjYXNlICJlbmQiOgogICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0My5zdG9wKCk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9LCBfY2FsbGVlMywgdGhpcyk7CiAgICAgIH0pKTsKCiAgICAgIGZ1bmN0aW9uIGZpbGxPcmdOb2RlQ2hpbGRzKCkgewogICAgICAgIHJldHVybiBfZmlsbE9yZ05vZGVDaGlsZHMuYXBwbHkodGhpcywgYXJndW1lbnRzKTsKICAgICAgfQoKICAgICAgcmV0dXJuIGZpbGxPcmdOb2RlQ2hpbGRzOwogICAgfSgpCiAgICAvKioNCiAgICAgKiDloavlhYUg5qCR6KeG5Zu+6IqC54K5W+m7mOiupOagueiKgueCuV0NCiAgICAgKg0KICAgICAqIEBwdWJsaWMNCiAgICAgKiBAcGFyYW0ge2FueXt9fSBjb250ZXh0DQogICAgICogQHBhcmFtIHsqfSBmaWx0ZXINCiAgICAgKiBAcGFyYW0ge2FueVtdfSBsaXN0DQogICAgICogQHBhcmFtIHsqfSByc05hdkNvbnRleHQNCiAgICAgKiBAcGFyYW0geyp9IHJzTmF2UGFyYW1zDQogICAgICogQHBhcmFtIHsqfSByc1BhcmFtcw0KICAgICAqIEByZXR1cm5zIHtQcm9taXNlPGFueT59DQogICAgICogQG1lbWJlcm9mIFRyZWVTZXJ2aWNlDQogICAgICovCgogIH0sIHsKICAgIGtleTogImZpbGxSb290Tm9kZXMiLAogICAgdmFsdWU6IGZ1bmN0aW9uIGZpbGxSb290Tm9kZXMoKSB7CiAgICAgIHZhciBfdGhpczYgPSB0aGlzOwoKICAgICAgdmFyIGNvbnRleHQgPSBhcmd1bWVudHMubGVuZ3RoID4gMCAmJiBhcmd1bWVudHNbMF0gIT09IHVuZGVmaW5lZCA/IGFyZ3VtZW50c1swXSA6IHt9OwogICAgICB2YXIgZmlsdGVyID0gYXJndW1lbnRzLmxlbmd0aCA+IDEgPyBhcmd1bWVudHNbMV0gOiB1bmRlZmluZWQ7CiAgICAgIHZhciBsaXN0ID0gYXJndW1lbnRzLmxlbmd0aCA+IDIgPyBhcmd1bWVudHNbMl0gOiB1bmRlZmluZWQ7CiAgICAgIHZhciByc05hdkNvbnRleHQgPSBhcmd1bWVudHMubGVuZ3RoID4gMyA/IGFyZ3VtZW50c1szXSA6IHVuZGVmaW5lZDsKICAgICAgdmFyIHJzTmF2UGFyYW1zID0gYXJndW1lbnRzLmxlbmd0aCA+IDQgPyBhcmd1bWVudHNbNF0gOiB1bmRlZmluZWQ7CiAgICAgIHZhciByc1BhcmFtcyA9IGFyZ3VtZW50cy5sZW5ndGggPiA1ID8gYXJndW1lbnRzWzVdIDogdW5kZWZpbmVkOwogICAgICBjb250ZXh0ID0gdGhpcy5oYW5kbGVSZXNOYXZDb250ZXh0KGNvbnRleHQsIGZpbHRlciwgcnNOYXZDb250ZXh0KTsKICAgICAgZmlsdGVyID0gdGhpcy5oYW5kbGVSZXNOYXZQYXJhbXMoY29udGV4dCwgZmlsdGVyLCByc05hdlBhcmFtcywgcnNQYXJhbXMpOwogICAgICByZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24gKHJlc29sdmUsIHJlamVjdCkgewogICAgICAgIHZhciB0cmVlTm9kZSA9IHt9OwogICAgICAgIE9iamVjdC5hc3NpZ24odHJlZU5vZGUsIHsKICAgICAgICAgIHRleHQ6ICdlbnRpdGllcy5waW1jb250cmFjdC50cmVlX3RyZWV2aWV3Lm5vZGVzLnJvb3QnCiAgICAgICAgfSk7CiAgICAgICAgT2JqZWN0LmFzc2lnbih0cmVlTm9kZSwgewogICAgICAgICAgaXNVc2VMYW5nUmVzOiB0cnVlCiAgICAgICAgfSk7CiAgICAgICAgT2JqZWN0LmFzc2lnbih0cmVlTm9kZSwgewogICAgICAgICAgc3JmYXBwY3R4OiBjb250ZXh0CiAgICAgICAgfSk7CiAgICAgICAgT2JqZWN0LmFzc2lnbih0cmVlTm9kZSwgewogICAgICAgICAgc3JmbWFqb3J0ZXh0OiB0cmVlTm9kZS50ZXh0CiAgICAgICAgfSk7CiAgICAgICAgdmFyIHN0ck5vZGVJZCA9ICdST09UJzsKICAgICAgICBPYmplY3QuYXNzaWduKHRyZWVOb2RlLCB7CiAgICAgICAgICBzcmZrZXk6ICdyb290JwogICAgICAgIH0pOwogICAgICAgIHN0ck5vZGVJZCArPSBfdGhpczYuVFJFRU5PREVfU0VQQVJBVE9SOwogICAgICAgIHN0ck5vZGVJZCArPSAncm9vdCc7CiAgICAgICAgT2JqZWN0LmFzc2lnbih0cmVlTm9kZSwgewogICAgICAgICAgaWQ6IHN0ck5vZGVJZAogICAgICAgIH0pOwogICAgICAgIE9iamVjdC5hc3NpZ24odHJlZU5vZGUsIHsKICAgICAgICAgIGV4cGFuZGVkOiB0cnVlCiAgICAgICAgfSk7CiAgICAgICAgT2JqZWN0LmFzc2lnbih0cmVlTm9kZSwgewogICAgICAgICAgbGVhZjogZmFsc2UKICAgICAgICB9KTsKICAgICAgICBPYmplY3QuYXNzaWduKHRyZWVOb2RlLCB7CiAgICAgICAgICBub2RlaWQ6IHRyZWVOb2RlLnNyZmtleQogICAgICAgIH0pOwogICAgICAgIE9iamVjdC5hc3NpZ24odHJlZU5vZGUsIHsKICAgICAgICAgIG5vZGVpZDI6IGZpbHRlci5zdHJSZWFsTm9kZUlkCiAgICAgICAgfSk7CiAgICAgICAgbGlzdC5wdXNoKHRyZWVOb2RlKTsKICAgICAgICByZXNvbHZlKGxpc3QpOwogICAgICB9KTsKICAgIH0KICAgIC8qKg0KICAgICAqIOWhq+WFhSDmoJHop4blm77oioLngrlb6buY6K6k5qC56IqC54K5XeWtkOiKgueCuQ0KICAgICAqDQogICAgICogQHB1YmxpYw0KICAgICAqIEBwYXJhbSB7YW55e319IGNvbnRleHQNCiAgICAgKiBAcGFyYW0geyp9IGZpbHRlcg0KICAgICAqIEBwYXJhbSB7YW55W119IGxpc3QNCiAgICAgKiBAcmV0dXJucyB7UHJvbWlzZTxhbnk+fQ0KICAgICAqIEBtZW1iZXJvZiBUcmVlU2VydmljZQ0KICAgICAqLwoKICB9LCB7CiAgICBrZXk6ICJmaWxsUm9vdE5vZGVDaGlsZHMiLAogICAgdmFsdWU6IGZ1bmN0aW9uICgpIHsKICAgICAgdmFyIF9maWxsUm9vdE5vZGVDaGlsZHMgPSBfYXN5bmNUb0dlbmVyYXRvcigKICAgICAgLyojX19QVVJFX18qLwogICAgICByZWdlbmVyYXRvclJ1bnRpbWUubWFyayhmdW5jdGlvbiBfY2FsbGVlNCgpIHsKICAgICAgICB2YXIgY29udGV4dCwKICAgICAgICAgICAgZmlsdGVyLAogICAgICAgICAgICBsaXN0LAogICAgICAgICAgICBPcmdSc05hdkNvbnRleHQsCiAgICAgICAgICAgIE9yZ1JzTmF2UGFyYW1zLAogICAgICAgICAgICBPcmdSc1BhcmFtcywKICAgICAgICAgICAgX09yZ1JzTmF2Q29udGV4dCwKICAgICAgICAgICAgX09yZ1JzTmF2UGFyYW1zLAogICAgICAgICAgICBfT3JnUnNQYXJhbXMsCiAgICAgICAgICAgIF9hcmdzNCA9IGFyZ3VtZW50czsKCiAgICAgICAgcmV0dXJuIHJlZ2VuZXJhdG9yUnVudGltZS53cmFwKGZ1bmN0aW9uIF9jYWxsZWU0JChfY29udGV4dDQpIHsKICAgICAgICAgIHdoaWxlICgxKSB7CiAgICAgICAgICAgIHN3aXRjaCAoX2NvbnRleHQ0LnByZXYgPSBfY29udGV4dDQubmV4dCkgewogICAgICAgICAgICAgIGNhc2UgMDoKICAgICAgICAgICAgICAgIGNvbnRleHQgPSBfYXJnczQubGVuZ3RoID4gMCAmJiBfYXJnczRbMF0gIT09IHVuZGVmaW5lZCA/IF9hcmdzNFswXSA6IHt9OwogICAgICAgICAgICAgICAgZmlsdGVyID0gX2FyZ3M0Lmxlbmd0aCA+IDEgPyBfYXJnczRbMV0gOiB1bmRlZmluZWQ7CiAgICAgICAgICAgICAgICBsaXN0ID0gX2FyZ3M0Lmxlbmd0aCA+IDIgPyBfYXJnczRbMl0gOiB1bmRlZmluZWQ7CgogICAgICAgICAgICAgICAgaWYgKCEoZmlsdGVyLnNyZm5vZGVmaWx0ZXIgJiYgIU9iamVjdC5pcyhmaWx0ZXIuc3Jmbm9kZWZpbHRlciwgIiIpKSkgewogICAgICAgICAgICAgICAgICBfY29udGV4dDQubmV4dCA9IDExOwogICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAvLyDloavlhYXmoLnnu4Tnu4foioLngrkKICAgICAgICAgICAgICAgIE9yZ1JzTmF2Q29udGV4dCA9IHt9OwogICAgICAgICAgICAgICAgT3JnUnNOYXZQYXJhbXMgPSB7fTsKICAgICAgICAgICAgICAgIE9yZ1JzUGFyYW1zID0ge307CiAgICAgICAgICAgICAgICBfY29udGV4dDQubmV4dCA9IDk7CiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5maWxsT3JnTm9kZXMoY29udGV4dCwgZmlsdGVyLCBsaXN0LCBPcmdSc05hdkNvbnRleHQsIE9yZ1JzTmF2UGFyYW1zLCBPcmdSc1BhcmFtcyk7CgogICAgICAgICAgICAgIGNhc2UgOToKICAgICAgICAgICAgICAgIF9jb250ZXh0NC5uZXh0ID0gMTY7CiAgICAgICAgICAgICAgICBicmVhazsKCiAgICAgICAgICAgICAgY2FzZSAxMToKICAgICAgICAgICAgICAgIC8vIOWhq+WFheaguee7hOe7h+iKgueCuQogICAgICAgICAgICAgICAgX09yZ1JzTmF2Q29udGV4dCA9IHt9OwogICAgICAgICAgICAgICAgX09yZ1JzTmF2UGFyYW1zID0ge307CiAgICAgICAgICAgICAgICBfT3JnUnNQYXJhbXMgPSB7fTsKICAgICAgICAgICAgICAgIF9jb250ZXh0NC5uZXh0ID0gMTY7CiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5maWxsT3JnTm9kZXMoY29udGV4dCwgZmlsdGVyLCBsaXN0LCBfT3JnUnNOYXZDb250ZXh0LCBfT3JnUnNOYXZQYXJhbXMsIF9PcmdSc1BhcmFtcyk7CgogICAgICAgICAgICAgIGNhc2UgMTY6CiAgICAgICAgICAgICAgY2FzZSAiZW5kIjoKICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDQuc3RvcCgpOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSwgX2NhbGxlZTQsIHRoaXMpOwogICAgICB9KSk7CgogICAgICBmdW5jdGlvbiBmaWxsUm9vdE5vZGVDaGlsZHMoKSB7CiAgICAgICAgcmV0dXJuIF9maWxsUm9vdE5vZGVDaGlsZHMuYXBwbHkodGhpcywgYXJndW1lbnRzKTsKICAgICAgfQoKICAgICAgcmV0dXJuIGZpbGxSb290Tm9kZUNoaWxkczsKICAgIH0oKQogICAgLyoqDQogICAgICog5aSE55CG5Luj56CB6KGo6L+U5Zue5pWw5o2uKOagkeeKtue7k+aehCkNCiAgICAgKg0KICAgICAqIEBwYXJhbSByZXN1bHQg6L+U5Zue5pWw57uEDQogICAgICogQHBhcmFtIGNvbnRleHQg5bqU55So5LiK5LiL5paHDQogICAgICogQHBhcmFtIGNhbGxCYWNrIOWbnuiwgw0KICAgICAqIEBtZW1iZXJvZiBUcmVlU2VydmljZQ0KICAgICAqLwoKICB9LCB7CiAgICBrZXk6ICJoYW5kbGVEYXRhU2V0IiwKICAgIHZhbHVlOiBmdW5jdGlvbiBoYW5kbGVEYXRhU2V0KHJlc3VsdCwgY29udGV4dCwgY2FsbEJhY2spIHsKICAgICAgdmFyIF90aGlzNyA9IHRoaXM7CgogICAgICB2YXIgbGlzdCA9IFtdOwoKICAgICAgaWYgKHJlc3VsdC5sZW5ndGggPT09IDApIHsKICAgICAgICByZXR1cm4gbGlzdDsKICAgICAgfQoKICAgICAgcmVzdWx0LmZvckVhY2goZnVuY3Rpb24gKGNvZGVJdGVtKSB7CiAgICAgICAgaWYgKCFjb2RlSXRlbS5wdmFsdWUpIHsKICAgICAgICAgIHZhciB2YWx1ZUZpZWxkID0gY29kZUl0ZW0udmFsdWU7CgogICAgICAgICAgX3RoaXM3LnNldENoaWxkQ29kZUl0ZW1zKHZhbHVlRmllbGQsIHJlc3VsdCwgY29kZUl0ZW0pOwoKICAgICAgICAgIGxpc3QucHVzaChjb2RlSXRlbSk7CiAgICAgICAgfQogICAgICB9KTsKICAgICAgdGhpcy5zZXROb2RlRGF0YShsaXN0LCBjb250ZXh0LCBjYWxsQmFjayk7CiAgICAgIHJldHVybiBsaXN0OwogICAgfQogICAgLyoqDQogICAgICog5aSE55CG6Z2e5qC56IqC54K55pWw5o2uDQogICAgICoNCiAgICAgKiBAcGFyYW0gcmVzdWx0IOi/lOWbnuaVsOe7hA0KICAgICAqIEBwYXJhbSBjb250ZXh0IOW6lOeUqOS4iuS4i+aWhw0KICAgICAqIEBwYXJhbSBjYWxsQmFjayDlm57osIMNCiAgICAgKiBAbWVtYmVyb2YgVHJlZVNlcnZpY2UNCiAgICAgKi8KCiAgfSwgewogICAga2V5OiAic2V0Q2hpbGRDb2RlSXRlbXMiLAogICAgdmFsdWU6IGZ1bmN0aW9uIHNldENoaWxkQ29kZUl0ZW1zKHBWYWx1ZSwgcmVzdWx0LCBjb2RlSXRlbSkgewogICAgICB2YXIgX3RoaXM4ID0gdGhpczsKCiAgICAgIHJlc3VsdC5mb3JFYWNoKGZ1bmN0aW9uIChpdGVtKSB7CiAgICAgICAgaWYgKGl0ZW0ucHZhbHVlID09IHBWYWx1ZSkgewogICAgICAgICAgdmFyIHZhbHVlRmllbGQgPSBpdGVtLnZhbHVlOwoKICAgICAgICAgIF90aGlzOC5zZXRDaGlsZENvZGVJdGVtcyh2YWx1ZUZpZWxkLCByZXN1bHQsIGl0ZW0pOwoKICAgICAgICAgIGlmICghY29kZUl0ZW0uY2hpbGRyZW4pIHsKICAgICAgICAgICAgY29kZUl0ZW0uY2hpbGRyZW4gPSBbXTsKICAgICAgICAgIH0KCiAgICAgICAgICBjb2RlSXRlbS5jaGlsZHJlbi5wdXNoKGl0ZW0pOwogICAgICAgIH0KICAgICAgfSk7CiAgICB9CiAgICAvKioNCiAgICAgKiDorr7nva7oioLngrlVSeaVsOaNrg0KICAgICAqDQogICAgICogQHBhcmFtIHJlc3VsdCDov5Tlm57mlbDnu4QNCiAgICAgKiBAcGFyYW0gY29udGV4dCDlupTnlKjkuIrkuIvmlocNCiAgICAgKiBAcGFyYW0gY2FsbEJhY2sg5Zue6LCDDQogICAgICogQG1lbWJlcm9mIFRyZWVTZXJ2aWNlDQogICAgICovCgogIH0sIHsKICAgIGtleTogInNldE5vZGVEYXRhIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBzZXROb2RlRGF0YShyZXN1bHQsIGNvbnRleHQsIGNhbGxCYWNrKSB7CiAgICAgIHZhciBfdGhpczkgPSB0aGlzOwoKICAgICAgcmVzdWx0LmZvckVhY2goZnVuY3Rpb24gKGl0ZW0pIHsKICAgICAgICBpZiAoaXRlbS5jaGlsZHJlbikgewogICAgICAgICAgaXRlbS5sZWFmID0gZmFsc2U7CgogICAgICAgICAgX3RoaXM5LnNldE5vZGVEYXRhKGl0ZW0uY2hpbGRyZW4sIGNvbnRleHQsIGNhbGxCYWNrKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgaXRlbS5sZWFmID0gdHJ1ZTsKICAgICAgICB9CgogICAgICAgIGNhbGxCYWNrKGNvbnRleHQsIGl0ZW0pOwogICAgICB9KTsKICAgIH0KICAgIC8qKg0KICAgICAqIOWkhOeQhuiKgueCueWFs+ezu+WvvOiIquS4iuS4i+aWhw0KICAgICAqDQogICAgICogQHBhcmFtIGNvbnRleHQg5bqU55So5LiK5LiL5paHDQogICAgICogQHBhcmFtIGZpbHRlciDlj4LmlbANCiAgICAgKiBAcGFyYW0gcmVzTmF2Q29udGV4dCDoioLngrnlhbPns7vlr7zoiKrkuIrkuIvmlocNCiAgICAgKg0KICAgICAqIEBtZW1iZXJvZiBUcmVlU2VydmljZQ0KICAgICAqLwoKICB9LCB7CiAgICBrZXk6ICJoYW5kbGVSZXNOYXZDb250ZXh0IiwKICAgIHZhbHVlOiBmdW5jdGlvbiBoYW5kbGVSZXNOYXZDb250ZXh0KGNvbnRleHQsIGZpbHRlciwgcmVzTmF2Q29udGV4dCkgewogICAgICB2YXIgX3RoaXMxMCA9IHRoaXM7CgogICAgICBpZiAocmVzTmF2Q29udGV4dCAmJiBPYmplY3Qua2V5cyhyZXNOYXZDb250ZXh0KS5sZW5ndGggPiAwKSB7CiAgICAgICAgdmFyIHRlbXBDb250ZXh0RGF0YSA9IEpTT04ucGFyc2UoSlNPTi5zdHJpbmdpZnkoY29udGV4dCkpOwogICAgICAgIHZhciB0ZW1wVmlld1BhcmFtcyA9IHt9OwoKICAgICAgICBpZiAoZmlsdGVyICYmIGZpbHRlci52aWV3cGFyYW1zKSB7CiAgICAgICAgICB0ZW1wVmlld1BhcmFtcyA9IGZpbHRlci52aWV3cGFyYW1zOwogICAgICAgIH0KCiAgICAgICAgT2JqZWN0LmtleXMocmVzTmF2Q29udGV4dCkuZm9yRWFjaChmdW5jdGlvbiAoaXRlbSkgewogICAgICAgICAgdmFyIGN1ckRhdGFPYmogPSByZXNOYXZDb250ZXh0W2l0ZW1dOwoKICAgICAgICAgIF90aGlzMTAuaGFuZGxlQ3VzdG9tRGF0YUxvZ2ljKGNvbnRleHQsIHRlbXBWaWV3UGFyYW1zLCBjdXJEYXRhT2JqLCB0ZW1wQ29udGV4dERhdGEsIGl0ZW0pOwogICAgICAgIH0pOwogICAgICAgIHJldHVybiB0ZW1wQ29udGV4dERhdGE7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgcmV0dXJuIGNvbnRleHQ7CiAgICAgIH0KICAgIH0KICAgIC8qKg0KICAgICAqIOWkhOeQhuWFs+ezu+WvvOiIquWPguaVsA0KICAgICAqDQogICAgICogQHBhcmFtIGNvbnRleHQg5bqU55So5LiK5LiL5paHDQogICAgICogQHBhcmFtIGZpbHRlciDlj4LmlbANCiAgICAgKiBAcGFyYW0gcmVzTmF2UGFyYW1zIOiKgueCueWFs+ezu+WvvOiIquWPguaVsA0KICAgICAqIEBwYXJhbSByZXNQYXJhbXMg6IqC54K55YWz57O75Y+C5pWwDQogICAgICoNCiAgICAgKiBAbWVtYmVyb2YgVHJlZVNlcnZpY2UNCiAgICAgKi8KCiAgfSwgewogICAga2V5OiAiaGFuZGxlUmVzTmF2UGFyYW1zIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBoYW5kbGVSZXNOYXZQYXJhbXMoY29udGV4dCwgZmlsdGVyLCByZXNOYXZQYXJhbXMsIHJlc1BhcmFtcykgewogICAgICB2YXIgX3RoaXMxMSA9IHRoaXM7CgogICAgICBpZiAocmVzTmF2UGFyYW1zICYmIE9iamVjdC5rZXlzKHJlc05hdlBhcmFtcykubGVuZ3RoID4gMCB8fCByZXNQYXJhbXMgJiYgT2JqZWN0LmtleXMocmVzUGFyYW1zKS5sZW5ndGggPiAwKSB7CiAgICAgICAgdmFyIHRlbXBWaWV3UGFyYW1EYXRhID0ge307CiAgICAgICAgdmFyIHRlbXBWaWV3UGFyYW1zID0ge307CgogICAgICAgIGlmIChmaWx0ZXIgJiYgZmlsdGVyLnZpZXdwYXJhbXMpIHsKICAgICAgICAgIHRlbXBWaWV3UGFyYW1zID0gZmlsdGVyLnZpZXdwYXJhbXM7CiAgICAgICAgICB0ZW1wVmlld1BhcmFtRGF0YSA9IEpTT04ucGFyc2UoSlNPTi5zdHJpbmdpZnkoZmlsdGVyLnZpZXdwYXJhbXMpKTsKICAgICAgICB9CgogICAgICAgIGlmIChPYmplY3Qua2V5cyhyZXNOYXZQYXJhbXMpLmxlbmd0aCA+IDApIHsKICAgICAgICAgIE9iamVjdC5rZXlzKHJlc05hdlBhcmFtcykuZm9yRWFjaChmdW5jdGlvbiAoaXRlbSkgewogICAgICAgICAgICB2YXIgY3VyRGF0YU9iaiA9IHJlc05hdlBhcmFtc1tpdGVtXTsKCiAgICAgICAgICAgIF90aGlzMTEuaGFuZGxlQ3VzdG9tRGF0YUxvZ2ljKGNvbnRleHQsIHRlbXBWaWV3UGFyYW1zLCBjdXJEYXRhT2JqLCB0ZW1wVmlld1BhcmFtRGF0YSwgaXRlbSk7CiAgICAgICAgICB9KTsKICAgICAgICB9CgogICAgICAgIGlmIChPYmplY3Qua2V5cyhyZXNQYXJhbXMpLmxlbmd0aCA+IDApIHsKICAgICAgICAgIE9iamVjdC5rZXlzKHJlc1BhcmFtcykuZm9yRWFjaChmdW5jdGlvbiAoaXRlbSkgewogICAgICAgICAgICB2YXIgY3VyRGF0YU9iaiA9IHJlc1BhcmFtc1tpdGVtXTsKICAgICAgICAgICAgdGVtcFZpZXdQYXJhbURhdGFbaXRlbS50b0xvd2VyQ2FzZSgpXSA9IGN1ckRhdGFPYmoudmFsdWU7CiAgICAgICAgICB9KTsKICAgICAgICB9CgogICAgICAgIE9iamVjdC5hc3NpZ24oZmlsdGVyLCB7CiAgICAgICAgICB2aWV3cGFyYW1zOiB0ZW1wVmlld1BhcmFtRGF0YQogICAgICAgIH0pOwogICAgICAgIHJldHVybiBmaWx0ZXI7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgcmV0dXJuIGZpbHRlcjsKICAgICAgfQogICAgfQogICAgLyoqDQogICAgICog5aSE55CG6Ieq5a6a5LmJ6IqC54K55YWz57O75a+86Iiq5pWw5o2uDQogICAgICoNCiAgICAgKiBAcGFyYW0gY29udGV4dCDlupTnlKjkuIrkuIvmlocNCiAgICAgKiBAcGFyYW0gdmlld3BhcmFtcyDlj4LmlbANCiAgICAgKiBAcGFyYW0gY3VyTmF2RGF0YSDoioLngrnlhbPns7vlr7zoiKrlj4LmlbDlr7nosaENCiAgICAgKiBAcGFyYW0gdGVtcERhdGEg6L+U5Zue5pWw5o2uDQogICAgICogQHBhcmFtIGl0ZW0g6IqC54K55YWz57O75a+86Iiq5Y+C5pWw6ZSu5YC8DQogICAgICoNCiAgICAgKiBAbWVtYmVyb2YgVHJlZVNlcnZpY2UNCiAgICAgKi8KCiAgfSwgewogICAga2V5OiAiaGFuZGxlQ3VzdG9tRGF0YUxvZ2ljIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBoYW5kbGVDdXN0b21EYXRhTG9naWMoY29udGV4dCwgdmlld3BhcmFtcywgY3VyTmF2RGF0YSwgdGVtcERhdGEsIGl0ZW0pIHsKICAgICAgLy8g55u05o6l5YC855u05o6l6LWL5YC8CiAgICAgIGlmIChjdXJOYXZEYXRhLmlzUmF3VmFsdWUpIHsKICAgICAgICBpZiAoT2JqZWN0LmlzKGN1ck5hdkRhdGEudmFsdWUsICJudWxsIikgfHwgT2JqZWN0LmlzKGN1ck5hdkRhdGEudmFsdWUsICIiKSkgewogICAgICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KHRlbXBEYXRhLCBpdGVtLnRvTG93ZXJDYXNlKCksIHsKICAgICAgICAgICAgdmFsdWU6IG51bGwsCiAgICAgICAgICAgIHdyaXRhYmxlOiB0cnVlLAogICAgICAgICAgICBlbnVtZXJhYmxlOiB0cnVlLAogICAgICAgICAgICBjb25maWd1cmFibGU6IHRydWUKICAgICAgICAgIH0pOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkodGVtcERhdGEsIGl0ZW0udG9Mb3dlckNhc2UoKSwgewogICAgICAgICAgICB2YWx1ZTogY3VyTmF2RGF0YS52YWx1ZSwKICAgICAgICAgICAgd3JpdGFibGU6IHRydWUsCiAgICAgICAgICAgIGVudW1lcmFibGU6IHRydWUsCiAgICAgICAgICAgIGNvbmZpZ3VyYWJsZTogdHJ1ZQogICAgICAgICAgfSk7CiAgICAgICAgfQogICAgICB9IGVsc2UgewogICAgICAgIC8vIOWFiOS7juWvvOiIquS4iuS4i+aWh+WPluaVsO+8jOayoeacieWGjeS7juWvvOiIquWPguaVsO+8iFVSTO+8ieWPluaVsO+8jOWmguaenOWvvOiIquS4iuS4i+aWh+WSjOWvvOiIquWPguaVsOmDveayoeacieWImeS4um51bGwKICAgICAgICBpZiAoY29udGV4dFtjdXJOYXZEYXRhLnZhbHVlLnRvTG93ZXJDYXNlKCldKSB7CiAgICAgICAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkodGVtcERhdGEsIGl0ZW0udG9Mb3dlckNhc2UoKSwgewogICAgICAgICAgICB2YWx1ZTogY29udGV4dFtjdXJOYXZEYXRhLnZhbHVlLnRvTG93ZXJDYXNlKCldLAogICAgICAgICAgICB3cml0YWJsZTogdHJ1ZSwKICAgICAgICAgICAgZW51bWVyYWJsZTogdHJ1ZSwKICAgICAgICAgICAgY29uZmlndXJhYmxlOiB0cnVlCiAgICAgICAgICB9KTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgaWYgKHZpZXdwYXJhbXNbY3VyTmF2RGF0YS52YWx1ZS50b0xvd2VyQ2FzZSgpXSkgewogICAgICAgICAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkodGVtcERhdGEsIGl0ZW0udG9Mb3dlckNhc2UoKSwgewogICAgICAgICAgICAgIHZhbHVlOiB2aWV3cGFyYW1zW2N1ck5hdkRhdGEudmFsdWUudG9Mb3dlckNhc2UoKV0sCiAgICAgICAgICAgICAgd3JpdGFibGU6IHRydWUsCiAgICAgICAgICAgICAgZW51bWVyYWJsZTogdHJ1ZSwKICAgICAgICAgICAgICBjb25maWd1cmFibGU6IHRydWUKICAgICAgICAgICAgfSk7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkodGVtcERhdGEsIGl0ZW0udG9Mb3dlckNhc2UoKSwgewogICAgICAgICAgICAgIHZhbHVlOiBudWxsLAogICAgICAgICAgICAgIHdyaXRhYmxlOiB0cnVlLAogICAgICAgICAgICAgIGVudW1lcmFibGU6IHRydWUsCiAgICAgICAgICAgICAgY29uZmlndXJhYmxlOiB0cnVlCiAgICAgICAgICAgIH0pOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfQogICAgfQogIH1dKTsKCiAgcmV0dXJuIFRyZWVTZXJ2aWNlOwp9KENvbnRyb2xTZXJ2aWNlKTsKCmV4cG9ydCB7IFRyZWVTZXJ2aWNlIGFzIGRlZmF1bHQgfTsKCnRzbGliXzEuX19kZWNvcmF0ZShbRXJyb3Jsb2ddLCBUcmVlU2VydmljZS5wcm90b3R5cGUsICJnZXROb2RlcyIsIG51bGwpOwoKdHNsaWJfMS5fX2RlY29yYXRlKFtFcnJvcmxvZ10sIFRyZWVTZXJ2aWNlLnByb3RvdHlwZSwgImZpbGxTdWJvcmdOb2RlcyIsIG51bGwpOwoKdHNsaWJfMS5fX2RlY29yYXRlKFtFcnJvcmxvZ10sIFRyZWVTZXJ2aWNlLnByb3RvdHlwZSwgInNlYXJjaFN1Ym9yZyIsIG51bGwpOwoKdHNsaWJfMS5fX2RlY29yYXRlKFtFcnJvcmxvZ10sIFRyZWVTZXJ2aWNlLnByb3RvdHlwZSwgImZpbGxTdWJvcmdOb2RlQ2hpbGRzIiwgbnVsbCk7Cgp0c2xpYl8xLl9fZGVjb3JhdGUoW0Vycm9ybG9nXSwgVHJlZVNlcnZpY2UucHJvdG90eXBlLCAiZmlsbE9yZ05vZGVzIiwgbnVsbCk7Cgp0c2xpYl8xLl9fZGVjb3JhdGUoW0Vycm9ybG9nXSwgVHJlZVNlcnZpY2UucHJvdG90eXBlLCAic2VhcmNoT3JnIiwgbnVsbCk7Cgp0c2xpYl8xLl9fZGVjb3JhdGUoW0Vycm9ybG9nXSwgVHJlZVNlcnZpY2UucHJvdG90eXBlLCAiZmlsbE9yZ05vZGVDaGlsZHMiLCBudWxsKTsKCnRzbGliXzEuX19kZWNvcmF0ZShbRXJyb3Jsb2ddLCBUcmVlU2VydmljZS5wcm90b3R5cGUsICJmaWxsUm9vdE5vZGVzIiwgbnVsbCk7Cgp0c2xpYl8xLl9fZGVjb3JhdGUoW0Vycm9ybG9nXSwgVHJlZVNlcnZpY2UucHJvdG90eXBlLCAiZmlsbFJvb3ROb2RlQ2hpbGRzIiwgbnVsbCk7"},null]}
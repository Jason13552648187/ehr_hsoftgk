{"remainingRequest":"F:\\crod项目\\人事管理系统2\\iBizEHR\\app_EHRPim\\node_modules\\thread-loader\\dist\\cjs.js!F:\\crod项目\\人事管理系统2\\iBizEHR\\app_EHRPim\\node_modules\\babel-loader\\lib\\index.js!F:\\crod项目\\人事管理系统2\\iBizEHR\\app_EHRPim\\node_modules\\ts-loader\\index.js??ref--13-3!F:\\crod项目\\人事管理系统2\\iBizEHR\\app_EHRPim\\src\\widgets\\pim-person\\personinfotree-treeview\\personinfotree-treeview-service.ts","dependencies":[{"path":"F:\\crod项目\\人事管理系统2\\iBizEHR\\app_EHRPim\\src\\widgets\\pim-person\\personinfotree-treeview\\personinfotree-treeview-service.ts","mtime":1630509411925},{"path":"F:\\crod项目\\人事管理系统2\\iBizEHR\\app_EHRPim\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1630511852775},{"path":"F:\\crod项目\\人事管理系统2\\iBizEHR\\app_EHRPim\\node_modules\\thread-loader\\dist\\cjs.js","mtime":1630511853252},{"path":"F:\\crod项目\\人事管理系统2\\iBizEHR\\app_EHRPim\\node_modules\\babel-loader\\lib\\index.js","mtime":1630511852747},{"path":"F:\\crod项目\\人事管理系统2\\iBizEHR\\app_EHRPim\\node_modules\\ts-loader\\index.js","mtime":1630511985412}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:aW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkuZm9yLWVhY2giOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5hcnJheS5pbmRleC1vZiI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLm9iamVjdC5kZWZpbmUtcHJvcGVydHkiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5vYmplY3QuaXMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5vYmplY3Qua2V5cyI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLm9iamVjdC50by1zdHJpbmciOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5yZWdleHAuZXhlYyI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLnN0cmluZy5zcGxpdCI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL3dlYi5kb20tY29sbGVjdGlvbnMuZm9yLWVhY2giOwppbXBvcnQgInJlZ2VuZXJhdG9yLXJ1bnRpbWUvcnVudGltZSI7CmltcG9ydCBfYXN5bmNUb0dlbmVyYXRvciBmcm9tICJGOlxcY3JvZFx1OTg3OVx1NzZFRVxcXHU0RUJBXHU0RThCXHU3QkExXHU3NDA2XHU3Q0ZCXHU3RURGMlxcaUJpekVIUlxcYXBwX0VIUlBpbVxcbm9kZV9tb2R1bGVzXFxAYmFiZWxcXHJ1bnRpbWUvaGVscGVycy9lc20vYXN5bmNUb0dlbmVyYXRvciI7CmltcG9ydCBfY2xhc3NDYWxsQ2hlY2sgZnJvbSAiRjpcXGNyb2RcdTk4NzlcdTc2RUVcXFx1NEVCQVx1NEU4Qlx1N0JBMVx1NzQwNlx1N0NGQlx1N0VERjJcXGlCaXpFSFJcXGFwcF9FSFJQaW1cXG5vZGVfbW9kdWxlc1xcQGJhYmVsXFxydW50aW1lL2hlbHBlcnMvZXNtL2NsYXNzQ2FsbENoZWNrIjsKaW1wb3J0IF9jcmVhdGVDbGFzcyBmcm9tICJGOlxcY3JvZFx1OTg3OVx1NzZFRVxcXHU0RUJBXHU0RThCXHU3QkExXHU3NDA2XHU3Q0ZCXHU3RURGMlxcaUJpekVIUlxcYXBwX0VIUlBpbVxcbm9kZV9tb2R1bGVzXFxAYmFiZWxcXHJ1bnRpbWUvaGVscGVycy9lc20vY3JlYXRlQ2xhc3MiOwppbXBvcnQgX3Bvc3NpYmxlQ29uc3RydWN0b3JSZXR1cm4gZnJvbSAiRjpcXGNyb2RcdTk4NzlcdTc2RUVcXFx1NEVCQVx1NEU4Qlx1N0JBMVx1NzQwNlx1N0NGQlx1N0VERjJcXGlCaXpFSFJcXGFwcF9FSFJQaW1cXG5vZGVfbW9kdWxlc1xcQGJhYmVsXFxydW50aW1lL2hlbHBlcnMvZXNtL3Bvc3NpYmxlQ29uc3RydWN0b3JSZXR1cm4iOwppbXBvcnQgX2dldFByb3RvdHlwZU9mIGZyb20gIkY6XFxjcm9kXHU5ODc5XHU3NkVFXFxcdTRFQkFcdTRFOEJcdTdCQTFcdTc0MDZcdTdDRkJcdTdFREYyXFxpQml6RUhSXFxhcHBfRUhSUGltXFxub2RlX21vZHVsZXNcXEBiYWJlbFxccnVudGltZS9oZWxwZXJzL2VzbS9nZXRQcm90b3R5cGVPZiI7CmltcG9ydCBfaW5oZXJpdHMgZnJvbSAiRjpcXGNyb2RcdTk4NzlcdTc2RUVcXFx1NEVCQVx1NEU4Qlx1N0JBMVx1NzQwNlx1N0NGQlx1N0VERjJcXGlCaXpFSFJcXGFwcF9FSFJQaW1cXG5vZGVfbW9kdWxlc1xcQGJhYmVsXFxydW50aW1lL2hlbHBlcnMvZXNtL2luaGVyaXRzIjsKaW1wb3J0ICogYXMgdHNsaWJfMSBmcm9tICJ0c2xpYiI7CmltcG9ydCB7IEVycm9ybG9nIH0gZnJvbSAnQC91dGlscyc7CmltcG9ydCBDb250cm9sU2VydmljZSBmcm9tICdAL3dpZGdldHMvY29udHJvbC1zZXJ2aWNlJzsKaW1wb3J0IFBpbVBlcnNvblNlcnZpY2UgZnJvbSAnQC9zZXJ2aWNlL3BpbS1wZXJzb24vcGltLXBlcnNvbi1zZXJ2aWNlJzsKaW1wb3J0IFBFUlNPTklORk9UUkVFTW9kZWwgZnJvbSAnLi9wZXJzb25pbmZvdHJlZS10cmVldmlldy1tb2RlbCc7CmltcG9ydCBDb2RlTGlzdFNlcnZpY2UgZnJvbSAnQHNlcnZpY2UvYXBwL2NvZGVsaXN0LXNlcnZpY2UnOwppbXBvcnQgT3JtT3JnU2VydmljZSBmcm9tICdAc2VydmljZS9vcm0tb3JnL29ybS1vcmctc2VydmljZSc7CmltcG9ydCBPcm1PcmdzZWN0b3JTZXJ2aWNlIGZyb20gJ0BzZXJ2aWNlL29ybS1vcmdzZWN0b3Ivb3JtLW9yZ3NlY3Rvci1zZXJ2aWNlJzsKLyoqDQogKiBQRVJTT05JTkZPVFJFRSDpg6jku7bmnI3liqHlr7nosaENCiAqDQogKiBAZXhwb3J0DQogKiBAY2xhc3MgUEVSU09OSU5GT1RSRUVTZXJ2aWNlDQogKi8KCnZhciBQRVJTT05JTkZPVFJFRVNlcnZpY2UgPQovKiNfX1BVUkVfXyovCmZ1bmN0aW9uIChfQ29udHJvbFNlcnZpY2UpIHsKICBfaW5oZXJpdHMoUEVSU09OSU5GT1RSRUVTZXJ2aWNlLCBfQ29udHJvbFNlcnZpY2UpOwoKICAvKioNCiAgICogQ3JlYXRlcyBhbiBpbnN0YW5jZSBvZiBQRVJTT05JTkZPVFJFRVNlcnZpY2UuDQogICAqDQogICAqIEBwYXJhbSB7Kn0gW29wdHM9e31dDQogICAqIEBtZW1iZXJvZiBQRVJTT05JTkZPVFJFRVNlcnZpY2UNCiAgICovCiAgZnVuY3Rpb24gUEVSU09OSU5GT1RSRUVTZXJ2aWNlKCkgewogICAgdmFyIF90aGlzOwoKICAgIHZhciBvcHRzID0gYXJndW1lbnRzLmxlbmd0aCA+IDAgJiYgYXJndW1lbnRzWzBdICE9PSB1bmRlZmluZWQgPyBhcmd1bWVudHNbMF0gOiB7fTsKCiAgICBfY2xhc3NDYWxsQ2hlY2sodGhpcywgUEVSU09OSU5GT1RSRUVTZXJ2aWNlKTsKCiAgICBfdGhpcyA9IF9wb3NzaWJsZUNvbnN0cnVjdG9yUmV0dXJuKHRoaXMsIF9nZXRQcm90b3R5cGVPZihQRVJTT05JTkZPVFJFRVNlcnZpY2UpLmNhbGwodGhpcywgb3B0cykpOwogICAgLyoqDQogICAgICog5Lq65ZGY5L+h5oGv5pyN5Yqh5a+56LGhDQogICAgICoNCiAgICAgKiBAdHlwZSB7UGltUGVyc29uU2VydmljZX0NCiAgICAgKiBAbWVtYmVyb2YgUEVSU09OSU5GT1RSRUVTZXJ2aWNlDQogICAgICovCgogICAgX3RoaXMuYXBwRW50aXR5U2VydmljZSA9IG5ldyBQaW1QZXJzb25TZXJ2aWNlKHsKICAgICAgJHN0b3JlOiBfdGhpcy5nZXRTdG9yZSgpCiAgICB9KTsKICAgIC8qKg0KICAgICAqIOS7o+eggeihqOacjeWKoeWvueixoQ0KICAgICAqDQogICAgICogQHR5cGUge0NvZGVMaXN0U2VydmljZX0NCiAgICAgKiBAbWVtYmVyb2YgUEVSU09OSU5GT1RSRUVTZXJ2aWNlDQogICAgICovCgogICAgX3RoaXMuY29kZUxpc3RTZXJ2aWNlID0gbmV3IENvZGVMaXN0U2VydmljZSh7CiAgICAgICRzdG9yZTogX3RoaXMuZ2V0U3RvcmUoKQogICAgfSk7CiAgICAvKioNCiAgICAgKiDnu4Tnu4fnrqHnkIbmnI3liqHlr7nosaENCiAgICAgKg0KICAgICAqIEB0eXBlIHtPcm1PcmdTZXJ2aWNlfQ0KICAgICAqIEBtZW1iZXJvZiBQRVJTT05JTkZPVFJFRVNlcnZpY2UNCiAgICAgKi8KCiAgICBfdGhpcy5vcm1vcmdTZXJ2aWNlID0gbmV3IE9ybU9yZ1NlcnZpY2UoewogICAgICAkc3RvcmU6IF90aGlzLmdldFN0b3JlKCkKICAgIH0pOwogICAgLyoqDQogICAgICog6YOo6Zeo566h55CG5pyN5Yqh5a+56LGhDQogICAgICoNCiAgICAgKiBAdHlwZSB7T3JtT3Jnc2VjdG9yU2VydmljZX0NCiAgICAgKiBAbWVtYmVyb2YgUEVSU09OSU5GT1RSRUVTZXJ2aWNlDQogICAgICovCgogICAgX3RoaXMub3Jtb3Jnc2VjdG9yU2VydmljZSA9IG5ldyBPcm1PcmdzZWN0b3JTZXJ2aWNlKHsKICAgICAgJHN0b3JlOiBfdGhpcy5nZXRTdG9yZSgpCiAgICB9KTsKICAgIC8qKg0KICAgICAqIOiKgueCueWIhumalOespuWPtw0KICAgICAqDQogICAgICogQHB1YmxpYw0KICAgICAqIEB0eXBlIHtzdHJpbmd9DQogICAgICogQG1lbWJlcm9mIFBFUlNPTklORk9UUkVFU2VydmljZQ0KICAgICAqLwoKICAgIF90aGlzLlRSRUVOT0RFX1NFUEFSQVRPUiA9ICc7JzsKICAgIC8qKg0KICAgICAqIOaguee7hOe7h+iKgueCueiKgueCueWIhumalOespuWPtw0KICAgICAqDQogICAgICogQHB1YmxpYw0KICAgICAqIEB0eXBlIHtzdHJpbmd9DQogICAgICogQG1lbWJlcm9mIFBFUlNPTklORk9UUkVFU2VydmljZQ0KICAgICAqLwoKICAgIF90aGlzLlRSRUVOT0RFX09STU9SR0lORk8gPSAnT1JNT1JHSU5GTyc7CiAgICAvKioNCiAgICAgKiDlrZDnu4Tnu4foioLngrnoioLngrnliIbpmpTnrKblj7cNCiAgICAgKg0KICAgICAqIEBwdWJsaWMNCiAgICAgKiBAdHlwZSB7c3RyaW5nfQ0KICAgICAqIEBtZW1iZXJvZiBQRVJTT05JTkZPVFJFRVNlcnZpY2UNCiAgICAgKi8KCiAgICBfdGhpcy5UUkVFTk9ERV9TVUJPUk1PUkdJTkZPID0gJ1NVQk9STU9SR0lORk8nOwogICAgLyoqDQogICAgICog5a2Q5a2Q57uE57uH6IqC54K56IqC54K55YiG6ZqU56ym5Y+3DQogICAgICoNCiAgICAgKiBAcHVibGljDQogICAgICogQHR5cGUge3N0cmluZ30NCiAgICAgKiBAbWVtYmVyb2YgUEVSU09OSU5GT1RSRUVTZXJ2aWNlDQogICAgICovCgogICAgX3RoaXMuVFJFRU5PREVfU1VCU1VCT1JNT1JHSU5GTyA9ICdTdWJTdWJPUk1PUkdJTkZPJzsKICAgIC8qKg0KICAgICAqIOWtkOmDqOmXqOiKgueCueiKgueCueWIhumalOespuWPtw0KICAgICAqDQogICAgICogQHB1YmxpYw0KICAgICAqIEB0eXBlIHtzdHJpbmd9DQogICAgICogQG1lbWJlcm9mIFBFUlNPTklORk9UUkVFU2VydmljZQ0KICAgICAqLwoKICAgIF90aGlzLlRSRUVOT0RFX09STU9SR1NFQ1RPUiA9ICdPUk1PUkdTRUNUT1InOwogICAgLyoqDQogICAgICog6buY6K6k5qC56IqC54K56IqC54K55YiG6ZqU56ym5Y+3DQogICAgICoNCiAgICAgKiBAcHVibGljDQogICAgICogQHR5cGUge3N0cmluZ30NCiAgICAgKiBAbWVtYmVyb2YgUEVSU09OSU5GT1RSRUVTZXJ2aWNlDQogICAgICovCgogICAgX3RoaXMuVFJFRU5PREVfUk9PVCA9ICdST09UJzsKICAgIF90aGlzLm1vZGVsID0gbmV3IFBFUlNPTklORk9UUkVFTW9kZWwoKTsKICAgIHJldHVybiBfdGhpczsKICB9CiAgLyoqDQogICAqIOiuvue9ruS7juaVsOaNruaooeW8jw0KICAgKg0KICAgKiBAdHlwZSB7Ym9vbGVhbn0NCiAgICogQG1lbWJlcm9mIFBFUlNPTklORk9UUkVFU2VydmljZQ0KICAgKi8KCgogIF9jcmVhdGVDbGFzcyhQRVJTT05JTkZPVFJFRVNlcnZpY2UsIFt7CiAgICBrZXk6ICJzZXRUZW1wTW9kZSIsCiAgICB2YWx1ZTogZnVuY3Rpb24gc2V0VGVtcE1vZGUoKSB7CiAgICAgIHRoaXMuaXNUZW1wTW9kZSA9IGZhbHNlOwogICAgfQogICAgLyoqDQogICAgICog6I635Y+W6IqC54K55pWw5o2uDQogICAgICoNCiAgICAgKiBAcGFyYW0ge3N0cmluZ30gYWN0aW9uDQogICAgICogQHBhcmFtIHsqfSBbZGF0YT17fV0NCiAgICAgKiBAcGFyYW0ge2Jvb2xlYW59IFtpc2xvYWRpbmddDQogICAgICogQHJldHVybnMge1Byb21pc2U8YW55Pn0NCiAgICAgKiBAbWVtYmVyb2YgUEVSU09OSU5GT1RSRUVTZXJ2aWNlDQogICAgICovCgogIH0sIHsKICAgIGtleTogImdldE5vZGVzIiwKICAgIHZhbHVlOiBmdW5jdGlvbiAoKSB7CiAgICAgIHZhciBfZ2V0Tm9kZXMgPSBfYXN5bmNUb0dlbmVyYXRvcigKICAgICAgLyojX19QVVJFX18qLwogICAgICByZWdlbmVyYXRvclJ1bnRpbWUubWFyayhmdW5jdGlvbiBfY2FsbGVlKCkgewogICAgICAgIHZhciBjb250ZXh0LAogICAgICAgICAgICBkYXRhLAogICAgICAgICAgICBpc2xvYWRpbmcsCiAgICAgICAgICAgIHNyZnBhcmVudGtleSwKICAgICAgICAgICAgc3JmY2F0LAogICAgICAgICAgICBzcmZub2RlaWQsCiAgICAgICAgICAgIHNyZm5vZGVmaWx0ZXIsCiAgICAgICAgICAgIHF1ZXJ5LAogICAgICAgICAgICBsaXN0LAogICAgICAgICAgICBmaWx0ZXIsCiAgICAgICAgICAgIHN0clRyZWVOb2RlSWQsCiAgICAgICAgICAgIHN0clJlYWxOb2RlSWQsCiAgICAgICAgICAgIGJSb290U2VsZWN0LAogICAgICAgICAgICBzdHJOb2RlVHlwZSwKICAgICAgICAgICAgc3RyUm9vdFNlbGVjdE5vZGUsCiAgICAgICAgICAgIG5Qb3MsCiAgICAgICAgICAgIG5vZGVpZCwKICAgICAgICAgICAgaSwKICAgICAgICAgICAgX2FyZ3MgPSBhcmd1bWVudHM7CiAgICAgICAgcmV0dXJuIHJlZ2VuZXJhdG9yUnVudGltZS53cmFwKGZ1bmN0aW9uIF9jYWxsZWUkKF9jb250ZXh0KSB7CiAgICAgICAgICB3aGlsZSAoMSkgewogICAgICAgICAgICBzd2l0Y2ggKF9jb250ZXh0LnByZXYgPSBfY29udGV4dC5uZXh0KSB7CiAgICAgICAgICAgICAgY2FzZSAwOgogICAgICAgICAgICAgICAgY29udGV4dCA9IF9hcmdzLmxlbmd0aCA+IDAgJiYgX2FyZ3NbMF0gIT09IHVuZGVmaW5lZCA/IF9hcmdzWzBdIDoge307CiAgICAgICAgICAgICAgICBkYXRhID0gX2FyZ3MubGVuZ3RoID4gMSAmJiBfYXJnc1sxXSAhPT0gdW5kZWZpbmVkID8gX2FyZ3NbMV0gOiB7fTsKICAgICAgICAgICAgICAgIGlzbG9hZGluZyA9IF9hcmdzLmxlbmd0aCA+IDIgPyBfYXJnc1syXSA6IHVuZGVmaW5lZDsKICAgICAgICAgICAgICAgIHNyZnBhcmVudGtleSA9IGRhdGEuc3JmcGFyZW50a2V5LCBzcmZjYXQgPSBkYXRhLnNyZmNhdCwgc3Jmbm9kZWlkID0gZGF0YS5zcmZub2RlaWQsIHNyZm5vZGVmaWx0ZXIgPSBkYXRhLnNyZm5vZGVmaWx0ZXIsIHF1ZXJ5ID0gZGF0YS5xdWVyeTsKICAgICAgICAgICAgICAgIHNyZm5vZGVmaWx0ZXIgPSBxdWVyeSA/IHF1ZXJ5IDogc3Jmbm9kZWZpbHRlcjsKICAgICAgICAgICAgICAgIGxpc3QgPSBbXTsKICAgICAgICAgICAgICAgIGZpbHRlciA9IHt9OwoKICAgICAgICAgICAgICAgIGlmICghc3Jmbm9kZWlkIHx8IE9iamVjdC5pcyhzcmZub2RlaWQsICcjJykpIHsKICAgICAgICAgICAgICAgICAgc3Jmbm9kZWlkID0gdGhpcy5UUkVFTk9ERV9ST09UOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIHN0clRyZWVOb2RlSWQgPSBzcmZub2RlaWQ7CiAgICAgICAgICAgICAgICBzdHJSZWFsTm9kZUlkID0gJyc7CiAgICAgICAgICAgICAgICBiUm9vdFNlbGVjdCA9IGZhbHNlOwogICAgICAgICAgICAgICAgc3RyTm9kZVR5cGUgPSBudWxsOwogICAgICAgICAgICAgICAgc3RyUm9vdFNlbGVjdE5vZGUgPSAnJzsKCiAgICAgICAgICAgICAgICBpZiAoIU9iamVjdC5pcyhzdHJUcmVlTm9kZUlkLCB0aGlzLlRSRUVOT0RFX1JPT1QpKSB7CiAgICAgICAgICAgICAgICAgIF9jb250ZXh0Lm5leHQgPSAxODsKICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgc3RyTm9kZVR5cGUgPSB0aGlzLlRSRUVOT0RFX1JPT1Q7CgogICAgICAgICAgICAgICAgaWYgKHNyZnBhcmVudGtleSkgewogICAgICAgICAgICAgICAgICBzdHJSZWFsTm9kZUlkID0gc3JmcGFyZW50a2V5OwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIF9jb250ZXh0Lm5leHQgPSAyMzsKICAgICAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgICAgICBjYXNlIDE4OgogICAgICAgICAgICAgICAgblBvcyA9IHN0clRyZWVOb2RlSWQuaW5kZXhPZih0aGlzLlRSRUVOT0RFX1NFUEFSQVRPUik7CgogICAgICAgICAgICAgICAgaWYgKCEoblBvcyA9PT0gLTEpKSB7CiAgICAgICAgICAgICAgICAgIF9jb250ZXh0Lm5leHQgPSAyMTsKICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0LmFicnVwdCgicmV0dXJuIiwgUHJvbWlzZS5yZWplY3QoewogICAgICAgICAgICAgICAgICBzdGF0dXM6IDUwMCwKICAgICAgICAgICAgICAgICAgZGF0YTogewogICAgICAgICAgICAgICAgICAgIHRpdGxlOiAn5aSx6LSlJywKICAgICAgICAgICAgICAgICAgICBtZXNzYWdlOiAiXHU2ODExXHU4MjgyXHU3MEI5Ii5jb25jYXQoc3RyVHJlZU5vZGVJZCwgIlx1NjgwN1x1OEJDNlx1NjVFMFx1NjU0OCIpCiAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0pKTsKCiAgICAgICAgICAgICAgY2FzZSAyMToKICAgICAgICAgICAgICAgIHN0ck5vZGVUeXBlID0gc3RyVHJlZU5vZGVJZC5zdWJzdHJpbmcoMCwgblBvcyk7CiAgICAgICAgICAgICAgICBzdHJSZWFsTm9kZUlkID0gc3RyVHJlZU5vZGVJZC5zdWJzdHJpbmcoblBvcyArIDEpOwoKICAgICAgICAgICAgICBjYXNlIDIzOgogICAgICAgICAgICAgICAgT2JqZWN0LmFzc2lnbihmaWx0ZXIsIHsKICAgICAgICAgICAgICAgICAgc3JmcGFyZW50a2V5OiBzcmZwYXJlbnRrZXksCiAgICAgICAgICAgICAgICAgIHNyZmNhdDogc3JmY2F0LAogICAgICAgICAgICAgICAgICBzcmZub2RlZmlsdGVyOiBzcmZub2RlZmlsdGVyLAogICAgICAgICAgICAgICAgICBzdHJSZWFsTm9kZUlkOiBzdHJSZWFsTm9kZUlkLAogICAgICAgICAgICAgICAgICBzcmZub2RlaWQ6IHNyZm5vZGVpZCwKICAgICAgICAgICAgICAgICAgc3RyTm9kZVR5cGU6IHN0ck5vZGVUeXBlLAogICAgICAgICAgICAgICAgICB2aWV3cGFyYW1zOiBKU09OLnBhcnNlKEpTT04uc3RyaW5naWZ5KGRhdGEpKS52aWV3cGFyYW1zCiAgICAgICAgICAgICAgICB9KTsgLy8g5YiG6Kej6IqC54K55qCH6K+GCgogICAgICAgICAgICAgICAgbm9kZWlkID0gc3RyUmVhbE5vZGVJZC5zcGxpdCh0aGlzLlRSRUVOT0RFX1NFUEFSQVRPUik7CiAgICAgICAgICAgICAgICBpID0gMDsKCiAgICAgICAgICAgICAgY2FzZSAyNjoKICAgICAgICAgICAgICAgIGlmICghKGkgPCBub2RlaWQubGVuZ3RoKSkgewogICAgICAgICAgICAgICAgICBfY29udGV4dC5uZXh0ID0gNDI7CiAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIF9jb250ZXh0LnQwID0gaTsKICAgICAgICAgICAgICAgIF9jb250ZXh0Lm5leHQgPSBfY29udGV4dC50MCA9PT0gMCA/IDMwIDogX2NvbnRleHQudDAgPT09IDEgPyAzMiA6IF9jb250ZXh0LnQwID09PSAyID8gMzQgOiBfY29udGV4dC50MCA9PT0gMyA/IDM2IDogMzg7CiAgICAgICAgICAgICAgICBicmVhazsKCiAgICAgICAgICAgICAgY2FzZSAzMDoKICAgICAgICAgICAgICAgIE9iamVjdC5hc3NpZ24oZmlsdGVyLCB7CiAgICAgICAgICAgICAgICAgIG5vZGVpZDogbm9kZWlkWzBdCiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dC5hYnJ1cHQoImJyZWFrIiwgMzkpOwoKICAgICAgICAgICAgICBjYXNlIDMyOgogICAgICAgICAgICAgICAgT2JqZWN0LmFzc2lnbihmaWx0ZXIsIHsKICAgICAgICAgICAgICAgICAgbm9kZWlkMjogbm9kZWlkWzFdCiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dC5hYnJ1cHQoImJyZWFrIiwgMzkpOwoKICAgICAgICAgICAgICBjYXNlIDM0OgogICAgICAgICAgICAgICAgT2JqZWN0LmFzc2lnbihmaWx0ZXIsIHsKICAgICAgICAgICAgICAgICAgbm9kZWlkMzogbm9kZWlkWzJdCiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dC5hYnJ1cHQoImJyZWFrIiwgMzkpOwoKICAgICAgICAgICAgICBjYXNlIDM2OgogICAgICAgICAgICAgICAgT2JqZWN0LmFzc2lnbihmaWx0ZXIsIHsKICAgICAgICAgICAgICAgICAgbm9kZWlkNDogbm9kZWlkWzNdCiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dC5hYnJ1cHQoImJyZWFrIiwgMzkpOwoKICAgICAgICAgICAgICBjYXNlIDM4OgogICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0LmFicnVwdCgiYnJlYWsiLCAzOSk7CgogICAgICAgICAgICAgIGNhc2UgMzk6CiAgICAgICAgICAgICAgICBpKys7CiAgICAgICAgICAgICAgICBfY29udGV4dC5uZXh0ID0gMjY7CiAgICAgICAgICAgICAgICBicmVhazsKCiAgICAgICAgICAgICAgY2FzZSA0MjoKICAgICAgICAgICAgICAgIGlmICghT2JqZWN0LmlzKHN0ck5vZGVUeXBlLCB0aGlzLlRSRUVOT0RFX09STU9SR0lORk8pKSB7CiAgICAgICAgICAgICAgICAgIF9jb250ZXh0Lm5leHQgPSA0NjsKICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgX2NvbnRleHQubmV4dCA9IDQ1OwogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuZmlsbE9ybW9yZ2luZm9Ob2RlQ2hpbGRzKGNvbnRleHQsIGZpbHRlciwgbGlzdCk7CgogICAgICAgICAgICAgIGNhc2UgNDU6CiAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQuYWJydXB0KCJyZXR1cm4iLCBQcm9taXNlLnJlc29sdmUoewogICAgICAgICAgICAgICAgICBzdGF0dXM6IDIwMCwKICAgICAgICAgICAgICAgICAgZGF0YTogbGlzdAogICAgICAgICAgICAgICAgfSkpOwoKICAgICAgICAgICAgICBjYXNlIDQ2OgogICAgICAgICAgICAgICAgaWYgKCFPYmplY3QuaXMoc3RyTm9kZVR5cGUsIHRoaXMuVFJFRU5PREVfU1VCT1JNT1JHSU5GTykpIHsKICAgICAgICAgICAgICAgICAgX2NvbnRleHQubmV4dCA9IDUwOwogICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBfY29udGV4dC5uZXh0ID0gNDk7CiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5maWxsU3Vib3Jtb3JnaW5mb05vZGVDaGlsZHMoY29udGV4dCwgZmlsdGVyLCBsaXN0KTsKCiAgICAgICAgICAgICAgY2FzZSA0OToKICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dC5hYnJ1cHQoInJldHVybiIsIFByb21pc2UucmVzb2x2ZSh7CiAgICAgICAgICAgICAgICAgIHN0YXR1czogMjAwLAogICAgICAgICAgICAgICAgICBkYXRhOiBsaXN0CiAgICAgICAgICAgICAgICB9KSk7CgogICAgICAgICAgICAgIGNhc2UgNTA6CiAgICAgICAgICAgICAgICBpZiAoIU9iamVjdC5pcyhzdHJOb2RlVHlwZSwgdGhpcy5UUkVFTk9ERV9TVUJTVUJPUk1PUkdJTkZPKSkgewogICAgICAgICAgICAgICAgICBfY29udGV4dC5uZXh0ID0gNTQ7CiAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIF9jb250ZXh0Lm5leHQgPSA1MzsKICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLmZpbGxTdWJzdWJvcm1vcmdpbmZvTm9kZUNoaWxkcyhjb250ZXh0LCBmaWx0ZXIsIGxpc3QpOwoKICAgICAgICAgICAgICBjYXNlIDUzOgogICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0LmFicnVwdCgicmV0dXJuIiwgUHJvbWlzZS5yZXNvbHZlKHsKICAgICAgICAgICAgICAgICAgc3RhdHVzOiAyMDAsCiAgICAgICAgICAgICAgICAgIGRhdGE6IGxpc3QKICAgICAgICAgICAgICAgIH0pKTsKCiAgICAgICAgICAgICAgY2FzZSA1NDoKICAgICAgICAgICAgICAgIGlmICghT2JqZWN0LmlzKHN0ck5vZGVUeXBlLCB0aGlzLlRSRUVOT0RFX09STU9SR1NFQ1RPUikpIHsKICAgICAgICAgICAgICAgICAgX2NvbnRleHQubmV4dCA9IDU4OwogICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBfY29udGV4dC5uZXh0ID0gNTc7CiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5maWxsT3Jtb3Jnc2VjdG9yTm9kZUNoaWxkcyhjb250ZXh0LCBmaWx0ZXIsIGxpc3QpOwoKICAgICAgICAgICAgICBjYXNlIDU3OgogICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0LmFicnVwdCgicmV0dXJuIiwgUHJvbWlzZS5yZXNvbHZlKHsKICAgICAgICAgICAgICAgICAgc3RhdHVzOiAyMDAsCiAgICAgICAgICAgICAgICAgIGRhdGE6IGxpc3QKICAgICAgICAgICAgICAgIH0pKTsKCiAgICAgICAgICAgICAgY2FzZSA1ODoKICAgICAgICAgICAgICAgIGlmICghT2JqZWN0LmlzKHN0ck5vZGVUeXBlLCB0aGlzLlRSRUVOT0RFX1JPT1QpKSB7CiAgICAgICAgICAgICAgICAgIF9jb250ZXh0Lm5leHQgPSA2MjsKICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgX2NvbnRleHQubmV4dCA9IDYxOwogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuZmlsbFJvb3ROb2RlQ2hpbGRzKGNvbnRleHQsIGZpbHRlciwgbGlzdCk7CgogICAgICAgICAgICAgIGNhc2UgNjE6CiAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQuYWJydXB0KCJyZXR1cm4iLCBQcm9taXNlLnJlc29sdmUoewogICAgICAgICAgICAgICAgICBzdGF0dXM6IDIwMCwKICAgICAgICAgICAgICAgICAgZGF0YTogbGlzdAogICAgICAgICAgICAgICAgfSkpOwoKICAgICAgICAgICAgICBjYXNlIDYyOgogICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0LmFicnVwdCgicmV0dXJuIiwgUHJvbWlzZS5yZXNvbHZlKHsKICAgICAgICAgICAgICAgICAgc3RhdHVzOiA1MDAsCiAgICAgICAgICAgICAgICAgIGRhdGE6IHsKICAgICAgICAgICAgICAgICAgICB0aXRsZTogJ+Wksei0pScsCiAgICAgICAgICAgICAgICAgICAgbWVzc2FnZTogIlx1NjgxMVx1ODI4Mlx1NzBCOSIuY29uY2F0KHN0clRyZWVOb2RlSWQsICJcdTY4MDdcdThCQzZcdTY1RTBcdTY1NDgiKQogICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9KSk7CgogICAgICAgICAgICAgIGNhc2UgNjM6CiAgICAgICAgICAgICAgY2FzZSAiZW5kIjoKICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dC5zdG9wKCk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9LCBfY2FsbGVlLCB0aGlzKTsKICAgICAgfSkpOwoKICAgICAgZnVuY3Rpb24gZ2V0Tm9kZXMoKSB7CiAgICAgICAgcmV0dXJuIF9nZXROb2Rlcy5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwogICAgICB9CgogICAgICByZXR1cm4gZ2V0Tm9kZXM7CiAgICB9KCkKICAgIC8qKg0KICAgICAqIOWhq+WFhSDmoJHop4blm77oioLngrlb5qC557uE57uH6IqC54K5XQ0KICAgICAqDQogICAgICogQHB1YmxpYw0KICAgICAqIEBwYXJhbSB7YW55e319IGNvbnRleHQNCiAgICAgKiBAcGFyYW0geyp9IGZpbHRlcg0KICAgICAqIEBwYXJhbSB7YW55W119IGxpc3QNCiAgICAgKiBAcGFyYW0geyp9IHJzTmF2Q29udGV4dA0KICAgICAqIEBwYXJhbSB7Kn0gcnNOYXZQYXJhbXMNCiAgICAgKiBAcGFyYW0geyp9IHJzUGFyYW1zDQogICAgICogQHJldHVybnMge1Byb21pc2U8YW55Pn0NCiAgICAgKiBAbWVtYmVyb2YgUEVSU09OSU5GT1RSRUVTZXJ2aWNlDQogICAgICovCgogIH0sIHsKICAgIGtleTogImZpbGxPcm1vcmdpbmZvTm9kZXMiLAogICAgdmFsdWU6IGZ1bmN0aW9uIGZpbGxPcm1vcmdpbmZvTm9kZXMoKSB7CiAgICAgIHZhciBfdGhpczIgPSB0aGlzOwoKICAgICAgdmFyIGNvbnRleHQgPSBhcmd1bWVudHMubGVuZ3RoID4gMCAmJiBhcmd1bWVudHNbMF0gIT09IHVuZGVmaW5lZCA/IGFyZ3VtZW50c1swXSA6IHt9OwogICAgICB2YXIgZmlsdGVyID0gYXJndW1lbnRzLmxlbmd0aCA+IDEgPyBhcmd1bWVudHNbMV0gOiB1bmRlZmluZWQ7CiAgICAgIHZhciBsaXN0ID0gYXJndW1lbnRzLmxlbmd0aCA+IDIgPyBhcmd1bWVudHNbMl0gOiB1bmRlZmluZWQ7CiAgICAgIHZhciByc05hdkNvbnRleHQgPSBhcmd1bWVudHMubGVuZ3RoID4gMyA/IGFyZ3VtZW50c1szXSA6IHVuZGVmaW5lZDsKICAgICAgdmFyIHJzTmF2UGFyYW1zID0gYXJndW1lbnRzLmxlbmd0aCA+IDQgPyBhcmd1bWVudHNbNF0gOiB1bmRlZmluZWQ7CiAgICAgIHZhciByc1BhcmFtcyA9IGFyZ3VtZW50cy5sZW5ndGggPiA1ID8gYXJndW1lbnRzWzVdIDogdW5kZWZpbmVkOwogICAgICBjb250ZXh0ID0gdGhpcy5oYW5kbGVSZXNOYXZDb250ZXh0KGNvbnRleHQsIGZpbHRlciwgcnNOYXZDb250ZXh0KTsKICAgICAgZmlsdGVyID0gdGhpcy5oYW5kbGVSZXNOYXZQYXJhbXMoY29udGV4dCwgZmlsdGVyLCByc05hdlBhcmFtcywgcnNQYXJhbXMpOwogICAgICByZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24gKHJlc29sdmUsIHJlamVjdCkgewogICAgICAgIHZhciBzZWFyY2hGaWx0ZXIgPSB7fTsKICAgICAgICBPYmplY3QuYXNzaWduKHNlYXJjaEZpbHRlciwgewogICAgICAgICAgdG90YWw6IGZhbHNlCiAgICAgICAgfSk7CiAgICAgICAgT2JqZWN0LmFzc2lnbihzZWFyY2hGaWx0ZXIsIHsKICAgICAgICAgIHF1ZXJ5OiBmaWx0ZXIuc3Jmbm9kZWZpbHRlcgogICAgICAgIH0pOwogICAgICAgIHZhciBiRmlyc3QgPSB0cnVlOwogICAgICAgIHZhciByZWNvcmRzID0gW107CgogICAgICAgIHRyeSB7CiAgICAgICAgICBfdGhpczIuc2VhcmNoT3Jtb3JnaW5mbyhjb250ZXh0LCBzZWFyY2hGaWx0ZXIsIGZpbHRlcikudGhlbihmdW5jdGlvbiAocmVjb3JkcykgewogICAgICAgICAgICBpZiAocmVjb3JkcyAmJiByZWNvcmRzLmxlbmd0aCA+IDApIHsKICAgICAgICAgICAgICByZWNvcmRzLmZvckVhY2goZnVuY3Rpb24gKGVudGl0eSkgewogICAgICAgICAgICAgICAgdmFyIHRyZWVOb2RlID0ge307IC8vIOaVtOeQhmNvbnRleHQKCiAgICAgICAgICAgICAgICB2YXIgc3RySWQgPSBlbnRpdHkub3JnaWQ7CiAgICAgICAgICAgICAgICB2YXIgc3RyVGV4dCA9IGVudGl0eS5zaG9ydG5hbWU7CiAgICAgICAgICAgICAgICBPYmplY3QuYXNzaWduKHRyZWVOb2RlLCB7CiAgICAgICAgICAgICAgICAgIHNyZnBhcmVudGRlbmFtZTogJ09ybU9yZycsCiAgICAgICAgICAgICAgICAgIHNyZnBhcmVudGtleTogZW50aXR5Lm9yZ2lkCiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIHZhciB0ZW1wQ29udGV4dCA9IEpTT04ucGFyc2UoSlNPTi5zdHJpbmdpZnkoY29udGV4dCkpOwogICAgICAgICAgICAgICAgT2JqZWN0LmFzc2lnbih0ZW1wQ29udGV4dCwgewogICAgICAgICAgICAgICAgICBzcmZwYXJlbnRkZW5hbWU6ICdPcm1PcmcnLAogICAgICAgICAgICAgICAgICBzcmZwYXJlbnRrZXk6IGVudGl0eS5vcmdpZCwKICAgICAgICAgICAgICAgICAgb3Jtb3JnOiBzdHJJZAogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICBPYmplY3QuYXNzaWduKHRyZWVOb2RlLCB7CiAgICAgICAgICAgICAgICAgIHNyZmFwcGN0eDogdGVtcENvbnRleHQKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgT2JqZWN0LmFzc2lnbih0cmVlTm9kZSwgewogICAgICAgICAgICAgICAgICAnb3Jtb3JnJzogc3RySWQKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgT2JqZWN0LmFzc2lnbih0cmVlTm9kZSwgewogICAgICAgICAgICAgICAgICBzcmZrZXk6IHN0cklkCiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIE9iamVjdC5hc3NpZ24odHJlZU5vZGUsIHsKICAgICAgICAgICAgICAgICAgdGV4dDogc3RyVGV4dCwKICAgICAgICAgICAgICAgICAgc3JmbWFqb3J0ZXh0OiBzdHJUZXh0CiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIHZhciBzdHJOb2RlSWQgPSAnT1JNT1JHSU5GTyc7CiAgICAgICAgICAgICAgICBzdHJOb2RlSWQgKz0gX3RoaXMyLlRSRUVOT0RFX1NFUEFSQVRPUjsKICAgICAgICAgICAgICAgIHN0ck5vZGVJZCArPSBzdHJJZDsKICAgICAgICAgICAgICAgIE9iamVjdC5hc3NpZ24odHJlZU5vZGUsIHsKICAgICAgICAgICAgICAgICAgaWQ6IHN0ck5vZGVJZAogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICBPYmplY3QuYXNzaWduKHRyZWVOb2RlLCB7CiAgICAgICAgICAgICAgICAgIGV4cGFuZGVkOiB0cnVlCiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIE9iamVjdC5hc3NpZ24odHJlZU5vZGUsIHsKICAgICAgICAgICAgICAgICAgbGVhZjogZmFsc2UKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgT2JqZWN0LmFzc2lnbih0cmVlTm9kZSwgewogICAgICAgICAgICAgICAgICBjdXJEYXRhOiBlbnRpdHkKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgT2JqZWN0LmFzc2lnbih0cmVlTm9kZSwgewogICAgICAgICAgICAgICAgICBub2RlaWQ6IHRyZWVOb2RlLnNyZmtleQogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICBPYmplY3QuYXNzaWduKHRyZWVOb2RlLCB7CiAgICAgICAgICAgICAgICAgIG5vZGVpZDI6IGZpbHRlci5zdHJSZWFsTm9kZUlkCiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIGxpc3QucHVzaCh0cmVlTm9kZSk7CiAgICAgICAgICAgICAgICByZXNvbHZlKGxpc3QpOwogICAgICAgICAgICAgICAgYkZpcnN0ID0gZmFsc2U7CiAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgcmVzb2x2ZShsaXN0KTsKICAgICAgICAgICAgfQogICAgICAgICAgfSk7CiAgICAgICAgfSBjYXRjaCAoZXJyb3IpIHsKICAgICAgICAgIGNvbnNvbGUuZXJyb3IoZXJyb3IpOwogICAgICAgIH0KICAgICAgfSk7CiAgICB9CiAgICAvKioNCiAgICAgKiDojrflj5bmn6Xor6Lpm4blkIgNCiAgICAgKg0KICAgICAqIEBwdWJsaWMNCiAgICAgKiBAcGFyYW0ge2FueXt9fSBjb250ZXh0DQogICAgICogQHBhcmFtIHsqfSBzZWFyY2hGaWx0ZXINCiAgICAgKiBAcGFyYW0geyp9IGZpbHRlcg0KICAgICAqIEByZXR1cm5zIHthbnlbXX0NCiAgICAgKiBAbWVtYmVyb2YgVGVzdEVuZXRpdHlEYXRhc1NlcnZpY2UNCiAgICAgKi8KCiAgfSwgewogICAga2V5OiAic2VhcmNoT3Jtb3JnaW5mbyIsCiAgICB2YWx1ZTogZnVuY3Rpb24gc2VhcmNoT3Jtb3JnaW5mbygpIHsKICAgICAgdmFyIF90aGlzMyA9IHRoaXM7CgogICAgICB2YXIgY29udGV4dCA9IGFyZ3VtZW50cy5sZW5ndGggPiAwICYmIGFyZ3VtZW50c1swXSAhPT0gdW5kZWZpbmVkID8gYXJndW1lbnRzWzBdIDoge307CiAgICAgIHZhciBzZWFyY2hGaWx0ZXIgPSBhcmd1bWVudHMubGVuZ3RoID4gMSA/IGFyZ3VtZW50c1sxXSA6IHVuZGVmaW5lZDsKICAgICAgdmFyIGZpbHRlciA9IGFyZ3VtZW50cy5sZW5ndGggPiAyID8gYXJndW1lbnRzWzJdIDogdW5kZWZpbmVkOwogICAgICByZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24gKHJlc29sdmUsIHJlamVjdCkgewogICAgICAgIGlmIChmaWx0ZXIudmlld3BhcmFtcykgewogICAgICAgICAgT2JqZWN0LmFzc2lnbihzZWFyY2hGaWx0ZXIsIGZpbHRlci52aWV3cGFyYW1zKTsKICAgICAgICB9CgogICAgICAgIGlmICghc2VhcmNoRmlsdGVyLnBhZ2UpIHsKICAgICAgICAgIE9iamVjdC5hc3NpZ24oc2VhcmNoRmlsdGVyLCB7CiAgICAgICAgICAgIHBhZ2U6IDAKICAgICAgICAgIH0pOwogICAgICAgIH0KCiAgICAgICAgaWYgKCFzZWFyY2hGaWx0ZXIuc2l6ZSkgewogICAgICAgICAgT2JqZWN0LmFzc2lnbihzZWFyY2hGaWx0ZXIsIHsKICAgICAgICAgICAgc2l6ZTogMTAwMAogICAgICAgICAgfSk7CiAgICAgICAgfQoKICAgICAgICBpZiAoY29udGV4dCAmJiBjb250ZXh0LnNyZnBhcmVudGRlbmFtZSkgewogICAgICAgICAgT2JqZWN0LmFzc2lnbihzZWFyY2hGaWx0ZXIsIHsKICAgICAgICAgICAgc3JmcGFyZW50ZGVuYW1lOiBKU09OLnBhcnNlKEpTT04uc3RyaW5naWZ5KGNvbnRleHQpKS5zcmZwYXJlbnRkZW5hbWUKICAgICAgICAgIH0pOwogICAgICAgIH0KCiAgICAgICAgaWYgKGNvbnRleHQgJiYgY29udGV4dC5zcmZwYXJlbnRrZXkpIHsKICAgICAgICAgIE9iamVjdC5hc3NpZ24oc2VhcmNoRmlsdGVyLCB7CiAgICAgICAgICAgIHNyZnBhcmVudGtleTogSlNPTi5wYXJzZShKU09OLnN0cmluZ2lmeShjb250ZXh0KSkuc3JmcGFyZW50a2V5CiAgICAgICAgICB9KTsKICAgICAgICB9CgogICAgICAgIE9iamVjdC5hc3NpZ24oc2VhcmNoRmlsdGVyLCB7CiAgICAgICAgICBzb3J0OiAncHgsYXNjJwogICAgICAgIH0pOwogICAgICAgIHZhciBfYXBwRW50aXR5U2VydmljZSA9IF90aGlzMy5vcm1vcmdTZXJ2aWNlOwogICAgICAgIHZhciBsaXN0ID0gW107CgogICAgICAgIGlmIChfYXBwRW50aXR5U2VydmljZVsnRmV0Y2hDdXJQb3JnJ10gJiYgX2FwcEVudGl0eVNlcnZpY2VbJ0ZldGNoQ3VyUG9yZyddIGluc3RhbmNlb2YgRnVuY3Rpb24pIHsKICAgICAgICAgIHZhciByZXNwb25zZSA9IF9hcHBFbnRpdHlTZXJ2aWNlWydGZXRjaEN1clBvcmcnXShjb250ZXh0LCBzZWFyY2hGaWx0ZXIsIGZhbHNlKTsKCiAgICAgICAgICByZXNwb25zZS50aGVuKGZ1bmN0aW9uIChyZXNwb25zZSkgewogICAgICAgICAgICBpZiAoIXJlc3BvbnNlLnN0YXR1cyB8fCByZXNwb25zZS5zdGF0dXMgIT09IDIwMCkgewogICAgICAgICAgICAgIHJlc29sdmUoW10pOwogICAgICAgICAgICAgIGNvbnNvbGUubG9nKEpTT04uc3RyaW5naWZ5KGNvbnRleHQpKTsKICAgICAgICAgICAgICBjb25zb2xlLmVycm9yKCfmn6Xor6JGZXRjaEN1clBvcmfmlbDmja7pm4blvILluLghJyk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHZhciBkYXRhID0gcmVzcG9uc2UuZGF0YTsKCiAgICAgICAgICAgIGlmIChPYmplY3Qua2V5cyhkYXRhKS5sZW5ndGggPiAwKSB7CiAgICAgICAgICAgICAgbGlzdCA9IEpTT04ucGFyc2UoSlNPTi5zdHJpbmdpZnkoZGF0YSkpOwogICAgICAgICAgICAgIHJlc29sdmUobGlzdCk7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgcmVzb2x2ZShbXSk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0pWyJjYXRjaCJdKGZ1bmN0aW9uIChyZXNwb25zZSkgewogICAgICAgICAgICByZXNvbHZlKFtdKTsKICAgICAgICAgICAgY29uc29sZS5sb2coSlNPTi5zdHJpbmdpZnkoY29udGV4dCkpOwogICAgICAgICAgICBjb25zb2xlLmVycm9yKCfmn6Xor6JGZXRjaEN1clBvcmfmlbDmja7pm4blvILluLghJyk7CiAgICAgICAgICB9KTsKICAgICAgICB9CiAgICAgIH0pOwogICAgfQogICAgLyoqDQogICAgICog5aGr5YWFIOagkeinhuWbvuiKgueCuVvmoLnnu4Tnu4foioLngrld5a2Q6IqC54K5DQogICAgICoNCiAgICAgKiBAcHVibGljDQogICAgICogQHBhcmFtIHthbnl7fX0gY29udGV4dA0KICAgICAqIEBwYXJhbSB7Kn0gZmlsdGVyDQogICAgICogQHBhcmFtIHthbnlbXX0gbGlzdA0KICAgICAqIEByZXR1cm5zIHtQcm9taXNlPGFueT59DQogICAgICogQG1lbWJlcm9mIFBFUlNPTklORk9UUkVFU2VydmljZQ0KICAgICAqLwoKICB9LCB7CiAgICBrZXk6ICJmaWxsT3Jtb3JnaW5mb05vZGVDaGlsZHMiLAogICAgdmFsdWU6IGZ1bmN0aW9uICgpIHsKICAgICAgdmFyIF9maWxsT3Jtb3JnaW5mb05vZGVDaGlsZHMgPSBfYXN5bmNUb0dlbmVyYXRvcigKICAgICAgLyojX19QVVJFX18qLwogICAgICByZWdlbmVyYXRvclJ1bnRpbWUubWFyayhmdW5jdGlvbiBfY2FsbGVlMigpIHsKICAgICAgICB2YXIgY29udGV4dCwKICAgICAgICAgICAgZmlsdGVyLAogICAgICAgICAgICBsaXN0LAogICAgICAgICAgICBPcm1vcmdzZWN0b3JSc05hdkNvbnRleHQsCiAgICAgICAgICAgIE9ybW9yZ3NlY3RvclJzTmF2UGFyYW1zLAogICAgICAgICAgICBPcm1vcmdzZWN0b3JSc1BhcmFtcywKICAgICAgICAgICAgU3Vib3Jtb3JnaW5mb1JzTmF2Q29udGV4dCwKICAgICAgICAgICAgU3Vib3Jtb3JnaW5mb1JzTmF2UGFyYW1zLAogICAgICAgICAgICBTdWJvcm1vcmdpbmZvUnNQYXJhbXMsCiAgICAgICAgICAgIF9Pcm1vcmdzZWN0b3JSc05hdkNvbnRleHQsCiAgICAgICAgICAgIF9Pcm1vcmdzZWN0b3JSc05hdlBhcmFtcywKICAgICAgICAgICAgX09ybW9yZ3NlY3RvclJzUGFyYW1zLAogICAgICAgICAgICBfU3Vib3Jtb3JnaW5mb1JzTmF2Q29udGV4dCwKICAgICAgICAgICAgX1N1Ym9ybW9yZ2luZm9Sc05hdlBhcmFtcywKICAgICAgICAgICAgX1N1Ym9ybW9yZ2luZm9Sc1BhcmFtcywKICAgICAgICAgICAgX2FyZ3MyID0gYXJndW1lbnRzOwoKICAgICAgICByZXR1cm4gcmVnZW5lcmF0b3JSdW50aW1lLndyYXAoZnVuY3Rpb24gX2NhbGxlZTIkKF9jb250ZXh0MikgewogICAgICAgICAgd2hpbGUgKDEpIHsKICAgICAgICAgICAgc3dpdGNoIChfY29udGV4dDIucHJldiA9IF9jb250ZXh0Mi5uZXh0KSB7CiAgICAgICAgICAgICAgY2FzZSAwOgogICAgICAgICAgICAgICAgY29udGV4dCA9IF9hcmdzMi5sZW5ndGggPiAwICYmIF9hcmdzMlswXSAhPT0gdW5kZWZpbmVkID8gX2FyZ3MyWzBdIDoge307CiAgICAgICAgICAgICAgICBmaWx0ZXIgPSBfYXJnczIubGVuZ3RoID4gMSA/IF9hcmdzMlsxXSA6IHVuZGVmaW5lZDsKICAgICAgICAgICAgICAgIGxpc3QgPSBfYXJnczIubGVuZ3RoID4gMiA/IF9hcmdzMlsyXSA6IHVuZGVmaW5lZDsKCiAgICAgICAgICAgICAgICBpZiAoIShmaWx0ZXIuc3Jmbm9kZWZpbHRlciAmJiAhT2JqZWN0LmlzKGZpbHRlci5zcmZub2RlZmlsdGVyLCAiIikpKSB7CiAgICAgICAgICAgICAgICAgIF9jb250ZXh0Mi5uZXh0ID0gMTY7CiAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIC8vIOWhq+WFheWtkOmDqOmXqOiKgueCuQogICAgICAgICAgICAgICAgT3Jtb3Jnc2VjdG9yUnNOYXZDb250ZXh0ID0ge307CiAgICAgICAgICAgICAgICBPcm1vcmdzZWN0b3JSc05hdlBhcmFtcyA9IHt9OwogICAgICAgICAgICAgICAgT3Jtb3Jnc2VjdG9yUnNQYXJhbXMgPSB7fTsKICAgICAgICAgICAgICAgIF9jb250ZXh0Mi5uZXh0ID0gOTsKICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLmZpbGxPcm1vcmdzZWN0b3JOb2Rlcyhjb250ZXh0LCBmaWx0ZXIsIGxpc3QsIE9ybW9yZ3NlY3RvclJzTmF2Q29udGV4dCwgT3Jtb3Jnc2VjdG9yUnNOYXZQYXJhbXMsIE9ybW9yZ3NlY3RvclJzUGFyYW1zKTsKCiAgICAgICAgICAgICAgY2FzZSA5OgogICAgICAgICAgICAgICAgLy8g5aGr5YWF5a2Q57uE57uH6IqC54K5CiAgICAgICAgICAgICAgICBTdWJvcm1vcmdpbmZvUnNOYXZDb250ZXh0ID0ge307CiAgICAgICAgICAgICAgICBTdWJvcm1vcmdpbmZvUnNOYXZQYXJhbXMgPSB7fTsKICAgICAgICAgICAgICAgIFN1Ym9ybW9yZ2luZm9Sc1BhcmFtcyA9IHt9OwogICAgICAgICAgICAgICAgX2NvbnRleHQyLm5leHQgPSAxNDsKICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLmZpbGxTdWJvcm1vcmdpbmZvTm9kZXMoY29udGV4dCwgZmlsdGVyLCBsaXN0LCBTdWJvcm1vcmdpbmZvUnNOYXZDb250ZXh0LCBTdWJvcm1vcmdpbmZvUnNOYXZQYXJhbXMsIFN1Ym9ybW9yZ2luZm9Sc1BhcmFtcyk7CgogICAgICAgICAgICAgIGNhc2UgMTQ6CiAgICAgICAgICAgICAgICBfY29udGV4dDIubmV4dCA9IDI2OwogICAgICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgICAgIGNhc2UgMTY6CiAgICAgICAgICAgICAgICAvLyDloavlhYXlrZDpg6jpl6joioLngrkKICAgICAgICAgICAgICAgIF9Pcm1vcmdzZWN0b3JSc05hdkNvbnRleHQgPSB7fTsKICAgICAgICAgICAgICAgIF9Pcm1vcmdzZWN0b3JSc05hdlBhcmFtcyA9IHt9OwogICAgICAgICAgICAgICAgX09ybW9yZ3NlY3RvclJzUGFyYW1zID0ge307CiAgICAgICAgICAgICAgICBfY29udGV4dDIubmV4dCA9IDIxOwogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuZmlsbE9ybW9yZ3NlY3Rvck5vZGVzKGNvbnRleHQsIGZpbHRlciwgbGlzdCwgX09ybW9yZ3NlY3RvclJzTmF2Q29udGV4dCwgX09ybW9yZ3NlY3RvclJzTmF2UGFyYW1zLCBfT3Jtb3Jnc2VjdG9yUnNQYXJhbXMpOwoKICAgICAgICAgICAgICBjYXNlIDIxOgogICAgICAgICAgICAgICAgLy8g5aGr5YWF5a2Q57uE57uH6IqC54K5CiAgICAgICAgICAgICAgICBfU3Vib3Jtb3JnaW5mb1JzTmF2Q29udGV4dCA9IHt9OwogICAgICAgICAgICAgICAgX1N1Ym9ybW9yZ2luZm9Sc05hdlBhcmFtcyA9IHt9OwogICAgICAgICAgICAgICAgX1N1Ym9ybW9yZ2luZm9Sc1BhcmFtcyA9IHt9OwogICAgICAgICAgICAgICAgX2NvbnRleHQyLm5leHQgPSAyNjsKICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLmZpbGxTdWJvcm1vcmdpbmZvTm9kZXMoY29udGV4dCwgZmlsdGVyLCBsaXN0LCBfU3Vib3Jtb3JnaW5mb1JzTmF2Q29udGV4dCwgX1N1Ym9ybW9yZ2luZm9Sc05hdlBhcmFtcywgX1N1Ym9ybW9yZ2luZm9Sc1BhcmFtcyk7CgogICAgICAgICAgICAgIGNhc2UgMjY6CiAgICAgICAgICAgICAgY2FzZSAiZW5kIjoKICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDIuc3RvcCgpOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSwgX2NhbGxlZTIsIHRoaXMpOwogICAgICB9KSk7CgogICAgICBmdW5jdGlvbiBmaWxsT3Jtb3JnaW5mb05vZGVDaGlsZHMoKSB7CiAgICAgICAgcmV0dXJuIF9maWxsT3Jtb3JnaW5mb05vZGVDaGlsZHMuYXBwbHkodGhpcywgYXJndW1lbnRzKTsKICAgICAgfQoKICAgICAgcmV0dXJuIGZpbGxPcm1vcmdpbmZvTm9kZUNoaWxkczsKICAgIH0oKQogICAgLyoqDQogICAgICog5aGr5YWFIOagkeinhuWbvuiKgueCuVvlrZDnu4Tnu4foioLngrldDQogICAgICoNCiAgICAgKiBAcHVibGljDQogICAgICogQHBhcmFtIHthbnl7fX0gY29udGV4dA0KICAgICAqIEBwYXJhbSB7Kn0gZmlsdGVyDQogICAgICogQHBhcmFtIHthbnlbXX0gbGlzdA0KICAgICAqIEBwYXJhbSB7Kn0gcnNOYXZDb250ZXh0DQogICAgICogQHBhcmFtIHsqfSByc05hdlBhcmFtcw0KICAgICAqIEBwYXJhbSB7Kn0gcnNQYXJhbXMNCiAgICAgKiBAcmV0dXJucyB7UHJvbWlzZTxhbnk+fQ0KICAgICAqIEBtZW1iZXJvZiBQRVJTT05JTkZPVFJFRVNlcnZpY2UNCiAgICAgKi8KCiAgfSwgewogICAga2V5OiAiZmlsbFN1Ym9ybW9yZ2luZm9Ob2RlcyIsCiAgICB2YWx1ZTogZnVuY3Rpb24gZmlsbFN1Ym9ybW9yZ2luZm9Ob2RlcygpIHsKICAgICAgdmFyIF90aGlzNCA9IHRoaXM7CgogICAgICB2YXIgY29udGV4dCA9IGFyZ3VtZW50cy5sZW5ndGggPiAwICYmIGFyZ3VtZW50c1swXSAhPT0gdW5kZWZpbmVkID8gYXJndW1lbnRzWzBdIDoge307CiAgICAgIHZhciBmaWx0ZXIgPSBhcmd1bWVudHMubGVuZ3RoID4gMSA/IGFyZ3VtZW50c1sxXSA6IHVuZGVmaW5lZDsKICAgICAgdmFyIGxpc3QgPSBhcmd1bWVudHMubGVuZ3RoID4gMiA/IGFyZ3VtZW50c1syXSA6IHVuZGVmaW5lZDsKICAgICAgdmFyIHJzTmF2Q29udGV4dCA9IGFyZ3VtZW50cy5sZW5ndGggPiAzID8gYXJndW1lbnRzWzNdIDogdW5kZWZpbmVkOwogICAgICB2YXIgcnNOYXZQYXJhbXMgPSBhcmd1bWVudHMubGVuZ3RoID4gNCA/IGFyZ3VtZW50c1s0XSA6IHVuZGVmaW5lZDsKICAgICAgdmFyIHJzUGFyYW1zID0gYXJndW1lbnRzLmxlbmd0aCA+IDUgPyBhcmd1bWVudHNbNV0gOiB1bmRlZmluZWQ7CiAgICAgIGNvbnRleHQgPSB0aGlzLmhhbmRsZVJlc05hdkNvbnRleHQoY29udGV4dCwgZmlsdGVyLCByc05hdkNvbnRleHQpOwogICAgICBmaWx0ZXIgPSB0aGlzLmhhbmRsZVJlc05hdlBhcmFtcyhjb250ZXh0LCBmaWx0ZXIsIHJzTmF2UGFyYW1zLCByc1BhcmFtcyk7CiAgICAgIHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbiAocmVzb2x2ZSwgcmVqZWN0KSB7CiAgICAgICAgdmFyIHNlYXJjaEZpbHRlciA9IHt9OwoKICAgICAgICBpZiAoT2JqZWN0LmlzKGZpbHRlci5zdHJOb2RlVHlwZSwgX3RoaXM0LlRSRUVOT0RFX09STU9SR0lORk8pKSB7CiAgICAgICAgICBPYmplY3QuYXNzaWduKHNlYXJjaEZpbHRlciwgewogICAgICAgICAgICBuX3BvcmdpZF9lcTogZmlsdGVyLm5vZGVpZAogICAgICAgICAgfSk7CiAgICAgICAgfQoKICAgICAgICBPYmplY3QuYXNzaWduKHNlYXJjaEZpbHRlciwgewogICAgICAgICAgdG90YWw6IGZhbHNlCiAgICAgICAgfSk7CiAgICAgICAgT2JqZWN0LmFzc2lnbihzZWFyY2hGaWx0ZXIsIHsKICAgICAgICAgIHF1ZXJ5OiBmaWx0ZXIuc3Jmbm9kZWZpbHRlcgogICAgICAgIH0pOwogICAgICAgIHZhciBiRmlyc3QgPSB0cnVlOwogICAgICAgIHZhciByZWNvcmRzID0gW107CgogICAgICAgIHRyeSB7CiAgICAgICAgICBfdGhpczQuc2VhcmNoU3Vib3Jtb3JnaW5mbyhjb250ZXh0LCBzZWFyY2hGaWx0ZXIsIGZpbHRlcikudGhlbihmdW5jdGlvbiAocmVjb3JkcykgewogICAgICAgICAgICBpZiAocmVjb3JkcyAmJiByZWNvcmRzLmxlbmd0aCA+IDApIHsKICAgICAgICAgICAgICByZWNvcmRzLmZvckVhY2goZnVuY3Rpb24gKGVudGl0eSkgewogICAgICAgICAgICAgICAgdmFyIHRyZWVOb2RlID0ge307IC8vIOaVtOeQhmNvbnRleHQKCiAgICAgICAgICAgICAgICB2YXIgc3RySWQgPSBlbnRpdHkub3JnaWQ7CiAgICAgICAgICAgICAgICB2YXIgc3RyVGV4dCA9IGVudGl0eS5zaG9ydG5hbWU7CiAgICAgICAgICAgICAgICBPYmplY3QuYXNzaWduKHRyZWVOb2RlLCB7CiAgICAgICAgICAgICAgICAgIHNyZnBhcmVudGRlbmFtZTogJ09ybU9yZycsCiAgICAgICAgICAgICAgICAgIHNyZnBhcmVudGtleTogZW50aXR5Lm9yZ2lkCiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIHZhciB0ZW1wQ29udGV4dCA9IEpTT04ucGFyc2UoSlNPTi5zdHJpbmdpZnkoY29udGV4dCkpOwogICAgICAgICAgICAgICAgT2JqZWN0LmFzc2lnbih0ZW1wQ29udGV4dCwgewogICAgICAgICAgICAgICAgICBzcmZwYXJlbnRkZW5hbWU6ICdPcm1PcmcnLAogICAgICAgICAgICAgICAgICBzcmZwYXJlbnRrZXk6IGVudGl0eS5vcmdpZCwKICAgICAgICAgICAgICAgICAgb3Jtb3JnOiBzdHJJZAogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICBPYmplY3QuYXNzaWduKHRyZWVOb2RlLCB7CiAgICAgICAgICAgICAgICAgIHNyZmFwcGN0eDogdGVtcENvbnRleHQKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgT2JqZWN0LmFzc2lnbih0cmVlTm9kZSwgewogICAgICAgICAgICAgICAgICAnb3Jtb3JnJzogc3RySWQKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgT2JqZWN0LmFzc2lnbih0cmVlTm9kZSwgewogICAgICAgICAgICAgICAgICBzcmZrZXk6IHN0cklkCiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIE9iamVjdC5hc3NpZ24odHJlZU5vZGUsIHsKICAgICAgICAgICAgICAgICAgdGV4dDogc3RyVGV4dCwKICAgICAgICAgICAgICAgICAgc3JmbWFqb3J0ZXh0OiBzdHJUZXh0CiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIHZhciBzdHJOb2RlSWQgPSAnU1VCT1JNT1JHSU5GTyc7CiAgICAgICAgICAgICAgICBzdHJOb2RlSWQgKz0gX3RoaXM0LlRSRUVOT0RFX1NFUEFSQVRPUjsKICAgICAgICAgICAgICAgIHN0ck5vZGVJZCArPSBzdHJJZDsKICAgICAgICAgICAgICAgIE9iamVjdC5hc3NpZ24odHJlZU5vZGUsIHsKICAgICAgICAgICAgICAgICAgaWQ6IHN0ck5vZGVJZAogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICBPYmplY3QuYXNzaWduKHRyZWVOb2RlLCB7CiAgICAgICAgICAgICAgICAgIGV4cGFuZGVkOiBmaWx0ZXIuaXNhdXRvZXhwYW5kCiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIE9iamVjdC5hc3NpZ24odHJlZU5vZGUsIHsKICAgICAgICAgICAgICAgICAgbGVhZjogZmFsc2UKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgT2JqZWN0LmFzc2lnbih0cmVlTm9kZSwgewogICAgICAgICAgICAgICAgICBuYXZmaWx0ZXI6ICJuX29ybW9yZ2lkX2VxIgogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICBPYmplY3QuYXNzaWduKHRyZWVOb2RlLCB7CiAgICAgICAgICAgICAgICAgIGN1ckRhdGE6IGVudGl0eQogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICBPYmplY3QuYXNzaWduKHRyZWVOb2RlLCB7CiAgICAgICAgICAgICAgICAgIG5hdmlnYXRlUGFyYW1zOiB7CiAgICAgICAgICAgICAgICAgICAgbl96Z2NvZGVfZXE6ICIxMCIsCiAgICAgICAgICAgICAgICAgICAgbm9kZWlkOiAiJU5PREVJRCUiCiAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgT2JqZWN0LmFzc2lnbih0cmVlTm9kZSwgewogICAgICAgICAgICAgICAgICBub2RlaWQ6IHRyZWVOb2RlLnNyZmtleQogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICBPYmplY3QuYXNzaWduKHRyZWVOb2RlLCB7CiAgICAgICAgICAgICAgICAgIG5vZGVpZDI6IGZpbHRlci5zdHJSZWFsTm9kZUlkCiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIGxpc3QucHVzaCh0cmVlTm9kZSk7CiAgICAgICAgICAgICAgICByZXNvbHZlKGxpc3QpOwogICAgICAgICAgICAgICAgYkZpcnN0ID0gZmFsc2U7CiAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgcmVzb2x2ZShsaXN0KTsKICAgICAgICAgICAgfQogICAgICAgICAgfSk7CiAgICAgICAgfSBjYXRjaCAoZXJyb3IpIHsKICAgICAgICAgIGNvbnNvbGUuZXJyb3IoZXJyb3IpOwogICAgICAgIH0KICAgICAgfSk7CiAgICB9CiAgICAvKioNCiAgICAgKiDojrflj5bmn6Xor6Lpm4blkIgNCiAgICAgKg0KICAgICAqIEBwdWJsaWMNCiAgICAgKiBAcGFyYW0ge2FueXt9fSBjb250ZXh0DQogICAgICogQHBhcmFtIHsqfSBzZWFyY2hGaWx0ZXINCiAgICAgKiBAcGFyYW0geyp9IGZpbHRlcg0KICAgICAqIEByZXR1cm5zIHthbnlbXX0NCiAgICAgKiBAbWVtYmVyb2YgVGVzdEVuZXRpdHlEYXRhc1NlcnZpY2UNCiAgICAgKi8KCiAgfSwgewogICAga2V5OiAic2VhcmNoU3Vib3Jtb3JnaW5mbyIsCiAgICB2YWx1ZTogZnVuY3Rpb24gc2VhcmNoU3Vib3Jtb3JnaW5mbygpIHsKICAgICAgdmFyIF90aGlzNSA9IHRoaXM7CgogICAgICB2YXIgY29udGV4dCA9IGFyZ3VtZW50cy5sZW5ndGggPiAwICYmIGFyZ3VtZW50c1swXSAhPT0gdW5kZWZpbmVkID8gYXJndW1lbnRzWzBdIDoge307CiAgICAgIHZhciBzZWFyY2hGaWx0ZXIgPSBhcmd1bWVudHMubGVuZ3RoID4gMSA/IGFyZ3VtZW50c1sxXSA6IHVuZGVmaW5lZDsKICAgICAgdmFyIGZpbHRlciA9IGFyZ3VtZW50cy5sZW5ndGggPiAyID8gYXJndW1lbnRzWzJdIDogdW5kZWZpbmVkOwogICAgICByZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24gKHJlc29sdmUsIHJlamVjdCkgewogICAgICAgIGlmIChmaWx0ZXIudmlld3BhcmFtcykgewogICAgICAgICAgT2JqZWN0LmFzc2lnbihzZWFyY2hGaWx0ZXIsIGZpbHRlci52aWV3cGFyYW1zKTsKICAgICAgICB9CgogICAgICAgIGlmICghc2VhcmNoRmlsdGVyLnBhZ2UpIHsKICAgICAgICAgIE9iamVjdC5hc3NpZ24oc2VhcmNoRmlsdGVyLCB7CiAgICAgICAgICAgIHBhZ2U6IDAKICAgICAgICAgIH0pOwogICAgICAgIH0KCiAgICAgICAgaWYgKCFzZWFyY2hGaWx0ZXIuc2l6ZSkgewogICAgICAgICAgT2JqZWN0LmFzc2lnbihzZWFyY2hGaWx0ZXIsIHsKICAgICAgICAgICAgc2l6ZTogMTAwMAogICAgICAgICAgfSk7CiAgICAgICAgfQoKICAgICAgICBpZiAoY29udGV4dCAmJiBjb250ZXh0LnNyZnBhcmVudGRlbmFtZSkgewogICAgICAgICAgT2JqZWN0LmFzc2lnbihzZWFyY2hGaWx0ZXIsIHsKICAgICAgICAgICAgc3JmcGFyZW50ZGVuYW1lOiBKU09OLnBhcnNlKEpTT04uc3RyaW5naWZ5KGNvbnRleHQpKS5zcmZwYXJlbnRkZW5hbWUKICAgICAgICAgIH0pOwogICAgICAgIH0KCiAgICAgICAgaWYgKGNvbnRleHQgJiYgY29udGV4dC5zcmZwYXJlbnRrZXkpIHsKICAgICAgICAgIE9iamVjdC5hc3NpZ24oc2VhcmNoRmlsdGVyLCB7CiAgICAgICAgICAgIHNyZnBhcmVudGtleTogSlNPTi5wYXJzZShKU09OLnN0cmluZ2lmeShjb250ZXh0KSkuc3JmcGFyZW50a2V5CiAgICAgICAgICB9KTsKICAgICAgICB9CgogICAgICAgIE9iamVjdC5hc3NpZ24oc2VhcmNoRmlsdGVyLCB7CiAgICAgICAgICBzb3J0OiAncHgsYXNjJwogICAgICAgIH0pOwogICAgICAgIHZhciBfYXBwRW50aXR5U2VydmljZSA9IF90aGlzNS5vcm1vcmdTZXJ2aWNlOwogICAgICAgIHZhciBsaXN0ID0gW107CgogICAgICAgIGlmIChfYXBwRW50aXR5U2VydmljZVsnRmV0Y2hDdXJDaGlsZCddICYmIF9hcHBFbnRpdHlTZXJ2aWNlWydGZXRjaEN1ckNoaWxkJ10gaW5zdGFuY2VvZiBGdW5jdGlvbikgewogICAgICAgICAgdmFyIHJlc3BvbnNlID0gX2FwcEVudGl0eVNlcnZpY2VbJ0ZldGNoQ3VyQ2hpbGQnXShjb250ZXh0LCBzZWFyY2hGaWx0ZXIsIGZhbHNlKTsKCiAgICAgICAgICByZXNwb25zZS50aGVuKGZ1bmN0aW9uIChyZXNwb25zZSkgewogICAgICAgICAgICBpZiAoIXJlc3BvbnNlLnN0YXR1cyB8fCByZXNwb25zZS5zdGF0dXMgIT09IDIwMCkgewogICAgICAgICAgICAgIHJlc29sdmUoW10pOwogICAgICAgICAgICAgIGNvbnNvbGUubG9nKEpTT04uc3RyaW5naWZ5KGNvbnRleHQpKTsKICAgICAgICAgICAgICBjb25zb2xlLmVycm9yKCfmn6Xor6JGZXRjaEN1ckNoaWxk5pWw5o2u6ZuG5byC5bi4IScpOwogICAgICAgICAgICB9CgogICAgICAgICAgICB2YXIgZGF0YSA9IHJlc3BvbnNlLmRhdGE7CgogICAgICAgICAgICBpZiAoT2JqZWN0LmtleXMoZGF0YSkubGVuZ3RoID4gMCkgewogICAgICAgICAgICAgIGxpc3QgPSBKU09OLnBhcnNlKEpTT04uc3RyaW5naWZ5KGRhdGEpKTsKICAgICAgICAgICAgICByZXNvbHZlKGxpc3QpOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgIHJlc29sdmUoW10pOwogICAgICAgICAgICB9CiAgICAgICAgICB9KVsiY2F0Y2giXShmdW5jdGlvbiAocmVzcG9uc2UpIHsKICAgICAgICAgICAgcmVzb2x2ZShbXSk7CiAgICAgICAgICAgIGNvbnNvbGUubG9nKEpTT04uc3RyaW5naWZ5KGNvbnRleHQpKTsKICAgICAgICAgICAgY29uc29sZS5lcnJvcign5p+l6K+iRmV0Y2hDdXJDaGlsZOaVsOaNrumbhuW8guW4uCEnKTsKICAgICAgICAgIH0pOwogICAgICAgIH0KICAgICAgfSk7CiAgICB9CiAgICAvKioNCiAgICAgKiDloavlhYUg5qCR6KeG5Zu+6IqC54K5W+WtkOe7hOe7h+iKgueCuV3lrZDoioLngrkNCiAgICAgKg0KICAgICAqIEBwdWJsaWMNCiAgICAgKiBAcGFyYW0ge2FueXt9fSBjb250ZXh0DQogICAgICogQHBhcmFtIHsqfSBmaWx0ZXINCiAgICAgKiBAcGFyYW0ge2FueVtdfSBsaXN0DQogICAgICogQHJldHVybnMge1Byb21pc2U8YW55Pn0NCiAgICAgKiBAbWVtYmVyb2YgUEVSU09OSU5GT1RSRUVTZXJ2aWNlDQogICAgICovCgogIH0sIHsKICAgIGtleTogImZpbGxTdWJvcm1vcmdpbmZvTm9kZUNoaWxkcyIsCiAgICB2YWx1ZTogZnVuY3Rpb24gKCkgewogICAgICB2YXIgX2ZpbGxTdWJvcm1vcmdpbmZvTm9kZUNoaWxkcyA9IF9hc3luY1RvR2VuZXJhdG9yKAogICAgICAvKiNfX1BVUkVfXyovCiAgICAgIHJlZ2VuZXJhdG9yUnVudGltZS5tYXJrKGZ1bmN0aW9uIF9jYWxsZWUzKCkgewogICAgICAgIHZhciBjb250ZXh0LAogICAgICAgICAgICBmaWx0ZXIsCiAgICAgICAgICAgIGxpc3QsCiAgICAgICAgICAgIE9ybW9yZ3NlY3RvclJzTmF2Q29udGV4dCwKICAgICAgICAgICAgT3Jtb3Jnc2VjdG9yUnNOYXZQYXJhbXMsCiAgICAgICAgICAgIE9ybW9yZ3NlY3RvclJzUGFyYW1zLAogICAgICAgICAgICBTdWJzdWJvcm1vcmdpbmZvUnNOYXZDb250ZXh0LAogICAgICAgICAgICBTdWJzdWJvcm1vcmdpbmZvUnNOYXZQYXJhbXMsCiAgICAgICAgICAgIFN1YnN1Ym9ybW9yZ2luZm9Sc1BhcmFtcywKICAgICAgICAgICAgX09ybW9yZ3NlY3RvclJzTmF2Q29udGV4dDIsCiAgICAgICAgICAgIF9Pcm1vcmdzZWN0b3JSc05hdlBhcmFtczIsCiAgICAgICAgICAgIF9Pcm1vcmdzZWN0b3JSc1BhcmFtczIsCiAgICAgICAgICAgIF9TdWJzdWJvcm1vcmdpbmZvUnNOYXZDb250ZXh0LAogICAgICAgICAgICBfU3Vic3Vib3Jtb3JnaW5mb1JzTmF2UGFyYW1zLAogICAgICAgICAgICBfU3Vic3Vib3Jtb3JnaW5mb1JzUGFyYW1zLAogICAgICAgICAgICBfYXJnczMgPSBhcmd1bWVudHM7CgogICAgICAgIHJldHVybiByZWdlbmVyYXRvclJ1bnRpbWUud3JhcChmdW5jdGlvbiBfY2FsbGVlMyQoX2NvbnRleHQzKSB7CiAgICAgICAgICB3aGlsZSAoMSkgewogICAgICAgICAgICBzd2l0Y2ggKF9jb250ZXh0My5wcmV2ID0gX2NvbnRleHQzLm5leHQpIHsKICAgICAgICAgICAgICBjYXNlIDA6CiAgICAgICAgICAgICAgICBjb250ZXh0ID0gX2FyZ3MzLmxlbmd0aCA+IDAgJiYgX2FyZ3MzWzBdICE9PSB1bmRlZmluZWQgPyBfYXJnczNbMF0gOiB7fTsKICAgICAgICAgICAgICAgIGZpbHRlciA9IF9hcmdzMy5sZW5ndGggPiAxID8gX2FyZ3MzWzFdIDogdW5kZWZpbmVkOwogICAgICAgICAgICAgICAgbGlzdCA9IF9hcmdzMy5sZW5ndGggPiAyID8gX2FyZ3MzWzJdIDogdW5kZWZpbmVkOwoKICAgICAgICAgICAgICAgIGlmICghKGZpbHRlci5zcmZub2RlZmlsdGVyICYmICFPYmplY3QuaXMoZmlsdGVyLnNyZm5vZGVmaWx0ZXIsICIiKSkpIHsKICAgICAgICAgICAgICAgICAgX2NvbnRleHQzLm5leHQgPSAxNjsKICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgLy8g5aGr5YWF5a2Q6YOo6Zeo6IqC54K5CiAgICAgICAgICAgICAgICBPcm1vcmdzZWN0b3JSc05hdkNvbnRleHQgPSB7fTsKICAgICAgICAgICAgICAgIE9ybW9yZ3NlY3RvclJzTmF2UGFyYW1zID0ge307CiAgICAgICAgICAgICAgICBPcm1vcmdzZWN0b3JSc1BhcmFtcyA9IHt9OwogICAgICAgICAgICAgICAgX2NvbnRleHQzLm5leHQgPSA5OwogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuZmlsbE9ybW9yZ3NlY3Rvck5vZGVzKGNvbnRleHQsIGZpbHRlciwgbGlzdCwgT3Jtb3Jnc2VjdG9yUnNOYXZDb250ZXh0LCBPcm1vcmdzZWN0b3JSc05hdlBhcmFtcywgT3Jtb3Jnc2VjdG9yUnNQYXJhbXMpOwoKICAgICAgICAgICAgICBjYXNlIDk6CiAgICAgICAgICAgICAgICAvLyDloavlhYXlrZDlrZDnu4Tnu4foioLngrkKICAgICAgICAgICAgICAgIFN1YnN1Ym9ybW9yZ2luZm9Sc05hdkNvbnRleHQgPSB7fTsKICAgICAgICAgICAgICAgIFN1YnN1Ym9ybW9yZ2luZm9Sc05hdlBhcmFtcyA9IHt9OwogICAgICAgICAgICAgICAgU3Vic3Vib3Jtb3JnaW5mb1JzUGFyYW1zID0ge307CiAgICAgICAgICAgICAgICBfY29udGV4dDMubmV4dCA9IDE0OwogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuZmlsbFN1YnN1Ym9ybW9yZ2luZm9Ob2Rlcyhjb250ZXh0LCBmaWx0ZXIsIGxpc3QsIFN1YnN1Ym9ybW9yZ2luZm9Sc05hdkNvbnRleHQsIFN1YnN1Ym9ybW9yZ2luZm9Sc05hdlBhcmFtcywgU3Vic3Vib3Jtb3JnaW5mb1JzUGFyYW1zKTsKCiAgICAgICAgICAgICAgY2FzZSAxNDoKICAgICAgICAgICAgICAgIF9jb250ZXh0My5uZXh0ID0gMjY7CiAgICAgICAgICAgICAgICBicmVhazsKCiAgICAgICAgICAgICAgY2FzZSAxNjoKICAgICAgICAgICAgICAgIC8vIOWhq+WFheWtkOmDqOmXqOiKgueCuQogICAgICAgICAgICAgICAgX09ybW9yZ3NlY3RvclJzTmF2Q29udGV4dDIgPSB7fTsKICAgICAgICAgICAgICAgIF9Pcm1vcmdzZWN0b3JSc05hdlBhcmFtczIgPSB7fTsKICAgICAgICAgICAgICAgIF9Pcm1vcmdzZWN0b3JSc1BhcmFtczIgPSB7fTsKICAgICAgICAgICAgICAgIF9jb250ZXh0My5uZXh0ID0gMjE7CiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5maWxsT3Jtb3Jnc2VjdG9yTm9kZXMoY29udGV4dCwgZmlsdGVyLCBsaXN0LCBfT3Jtb3Jnc2VjdG9yUnNOYXZDb250ZXh0MiwgX09ybW9yZ3NlY3RvclJzTmF2UGFyYW1zMiwgX09ybW9yZ3NlY3RvclJzUGFyYW1zMik7CgogICAgICAgICAgICAgIGNhc2UgMjE6CiAgICAgICAgICAgICAgICAvLyDloavlhYXlrZDlrZDnu4Tnu4foioLngrkKICAgICAgICAgICAgICAgIF9TdWJzdWJvcm1vcmdpbmZvUnNOYXZDb250ZXh0ID0ge307CiAgICAgICAgICAgICAgICBfU3Vic3Vib3Jtb3JnaW5mb1JzTmF2UGFyYW1zID0ge307CiAgICAgICAgICAgICAgICBfU3Vic3Vib3Jtb3JnaW5mb1JzUGFyYW1zID0ge307CiAgICAgICAgICAgICAgICBfY29udGV4dDMubmV4dCA9IDI2OwogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuZmlsbFN1YnN1Ym9ybW9yZ2luZm9Ob2Rlcyhjb250ZXh0LCBmaWx0ZXIsIGxpc3QsIF9TdWJzdWJvcm1vcmdpbmZvUnNOYXZDb250ZXh0LCBfU3Vic3Vib3Jtb3JnaW5mb1JzTmF2UGFyYW1zLCBfU3Vic3Vib3Jtb3JnaW5mb1JzUGFyYW1zKTsKCiAgICAgICAgICAgICAgY2FzZSAyNjoKICAgICAgICAgICAgICBjYXNlICJlbmQiOgogICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0My5zdG9wKCk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9LCBfY2FsbGVlMywgdGhpcyk7CiAgICAgIH0pKTsKCiAgICAgIGZ1bmN0aW9uIGZpbGxTdWJvcm1vcmdpbmZvTm9kZUNoaWxkcygpIHsKICAgICAgICByZXR1cm4gX2ZpbGxTdWJvcm1vcmdpbmZvTm9kZUNoaWxkcy5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwogICAgICB9CgogICAgICByZXR1cm4gZmlsbFN1Ym9ybW9yZ2luZm9Ob2RlQ2hpbGRzOwogICAgfSgpCiAgICAvKioNCiAgICAgKiDloavlhYUg5qCR6KeG5Zu+6IqC54K5W+WtkOWtkOe7hOe7h+iKgueCuV0NCiAgICAgKg0KICAgICAqIEBwdWJsaWMNCiAgICAgKiBAcGFyYW0ge2FueXt9fSBjb250ZXh0DQogICAgICogQHBhcmFtIHsqfSBmaWx0ZXINCiAgICAgKiBAcGFyYW0ge2FueVtdfSBsaXN0DQogICAgICogQHBhcmFtIHsqfSByc05hdkNvbnRleHQNCiAgICAgKiBAcGFyYW0geyp9IHJzTmF2UGFyYW1zDQogICAgICogQHBhcmFtIHsqfSByc1BhcmFtcw0KICAgICAqIEByZXR1cm5zIHtQcm9taXNlPGFueT59DQogICAgICogQG1lbWJlcm9mIFBFUlNPTklORk9UUkVFU2VydmljZQ0KICAgICAqLwoKICB9LCB7CiAgICBrZXk6ICJmaWxsU3Vic3Vib3Jtb3JnaW5mb05vZGVzIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBmaWxsU3Vic3Vib3Jtb3JnaW5mb05vZGVzKCkgewogICAgICB2YXIgX3RoaXM2ID0gdGhpczsKCiAgICAgIHZhciBjb250ZXh0ID0gYXJndW1lbnRzLmxlbmd0aCA+IDAgJiYgYXJndW1lbnRzWzBdICE9PSB1bmRlZmluZWQgPyBhcmd1bWVudHNbMF0gOiB7fTsKICAgICAgdmFyIGZpbHRlciA9IGFyZ3VtZW50cy5sZW5ndGggPiAxID8gYXJndW1lbnRzWzFdIDogdW5kZWZpbmVkOwogICAgICB2YXIgbGlzdCA9IGFyZ3VtZW50cy5sZW5ndGggPiAyID8gYXJndW1lbnRzWzJdIDogdW5kZWZpbmVkOwogICAgICB2YXIgcnNOYXZDb250ZXh0ID0gYXJndW1lbnRzLmxlbmd0aCA+IDMgPyBhcmd1bWVudHNbM10gOiB1bmRlZmluZWQ7CiAgICAgIHZhciByc05hdlBhcmFtcyA9IGFyZ3VtZW50cy5sZW5ndGggPiA0ID8gYXJndW1lbnRzWzRdIDogdW5kZWZpbmVkOwogICAgICB2YXIgcnNQYXJhbXMgPSBhcmd1bWVudHMubGVuZ3RoID4gNSA/IGFyZ3VtZW50c1s1XSA6IHVuZGVmaW5lZDsKICAgICAgY29udGV4dCA9IHRoaXMuaGFuZGxlUmVzTmF2Q29udGV4dChjb250ZXh0LCBmaWx0ZXIsIHJzTmF2Q29udGV4dCk7CiAgICAgIGZpbHRlciA9IHRoaXMuaGFuZGxlUmVzTmF2UGFyYW1zKGNvbnRleHQsIGZpbHRlciwgcnNOYXZQYXJhbXMsIHJzUGFyYW1zKTsKICAgICAgcmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uIChyZXNvbHZlLCByZWplY3QpIHsKICAgICAgICB2YXIgc2VhcmNoRmlsdGVyID0ge307CgogICAgICAgIGlmIChPYmplY3QuaXMoZmlsdGVyLnN0ck5vZGVUeXBlLCBfdGhpczYuVFJFRU5PREVfU1VCT1JNT1JHSU5GTykpIHsKICAgICAgICAgIE9iamVjdC5hc3NpZ24oc2VhcmNoRmlsdGVyLCB7CiAgICAgICAgICAgIG5fcG9yZ2lkX2VxOiBmaWx0ZXIubm9kZWlkCiAgICAgICAgICB9KTsKICAgICAgICB9CgogICAgICAgIE9iamVjdC5hc3NpZ24oc2VhcmNoRmlsdGVyLCB7CiAgICAgICAgICB0b3RhbDogZmFsc2UKICAgICAgICB9KTsKICAgICAgICBPYmplY3QuYXNzaWduKHNlYXJjaEZpbHRlciwgewogICAgICAgICAgcXVlcnk6IGZpbHRlci5zcmZub2RlZmlsdGVyCiAgICAgICAgfSk7CiAgICAgICAgdmFyIGJGaXJzdCA9IHRydWU7CiAgICAgICAgdmFyIHJlY29yZHMgPSBbXTsKCiAgICAgICAgdHJ5IHsKICAgICAgICAgIF90aGlzNi5zZWFyY2hTdWJzdWJvcm1vcmdpbmZvKGNvbnRleHQsIHNlYXJjaEZpbHRlciwgZmlsdGVyKS50aGVuKGZ1bmN0aW9uIChyZWNvcmRzKSB7CiAgICAgICAgICAgIGlmIChyZWNvcmRzICYmIHJlY29yZHMubGVuZ3RoID4gMCkgewogICAgICAgICAgICAgIHJlY29yZHMuZm9yRWFjaChmdW5jdGlvbiAoZW50aXR5KSB7CiAgICAgICAgICAgICAgICB2YXIgdHJlZU5vZGUgPSB7fTsgLy8g5pW055CGY29udGV4dAoKICAgICAgICAgICAgICAgIHZhciBzdHJJZCA9IGVudGl0eS5vcmdpZDsKICAgICAgICAgICAgICAgIHZhciBzdHJUZXh0ID0gZW50aXR5LnNob3J0bmFtZTsKICAgICAgICAgICAgICAgIE9iamVjdC5hc3NpZ24odHJlZU5vZGUsIHsKICAgICAgICAgICAgICAgICAgc3JmcGFyZW50ZGVuYW1lOiAnT3JtT3JnJywKICAgICAgICAgICAgICAgICAgc3JmcGFyZW50a2V5OiBlbnRpdHkub3JnaWQKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgdmFyIHRlbXBDb250ZXh0ID0gSlNPTi5wYXJzZShKU09OLnN0cmluZ2lmeShjb250ZXh0KSk7CiAgICAgICAgICAgICAgICBPYmplY3QuYXNzaWduKHRlbXBDb250ZXh0LCB7CiAgICAgICAgICAgICAgICAgIHNyZnBhcmVudGRlbmFtZTogJ09ybU9yZycsCiAgICAgICAgICAgICAgICAgIHNyZnBhcmVudGtleTogZW50aXR5Lm9yZ2lkLAogICAgICAgICAgICAgICAgICBvcm1vcmc6IHN0cklkCiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIE9iamVjdC5hc3NpZ24odHJlZU5vZGUsIHsKICAgICAgICAgICAgICAgICAgc3JmYXBwY3R4OiB0ZW1wQ29udGV4dAogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICBPYmplY3QuYXNzaWduKHRyZWVOb2RlLCB7CiAgICAgICAgICAgICAgICAgICdvcm1vcmcnOiBzdHJJZAogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICBPYmplY3QuYXNzaWduKHRyZWVOb2RlLCB7CiAgICAgICAgICAgICAgICAgIHNyZmtleTogc3RySWQKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgT2JqZWN0LmFzc2lnbih0cmVlTm9kZSwgewogICAgICAgICAgICAgICAgICB0ZXh0OiBzdHJUZXh0LAogICAgICAgICAgICAgICAgICBzcmZtYWpvcnRleHQ6IHN0clRleHQKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgdmFyIHN0ck5vZGVJZCA9ICdTdWJTdWJPUk1PUkdJTkZPJzsKICAgICAgICAgICAgICAgIHN0ck5vZGVJZCArPSBfdGhpczYuVFJFRU5PREVfU0VQQVJBVE9SOwogICAgICAgICAgICAgICAgc3RyTm9kZUlkICs9IHN0cklkOwogICAgICAgICAgICAgICAgT2JqZWN0LmFzc2lnbih0cmVlTm9kZSwgewogICAgICAgICAgICAgICAgICBpZDogc3RyTm9kZUlkCiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIE9iamVjdC5hc3NpZ24odHJlZU5vZGUsIHsKICAgICAgICAgICAgICAgICAgZXhwYW5kZWQ6IGZpbHRlci5pc2F1dG9leHBhbmQKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgT2JqZWN0LmFzc2lnbih0cmVlTm9kZSwgewogICAgICAgICAgICAgICAgICBsZWFmOiBmYWxzZQogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICBPYmplY3QuYXNzaWduKHRyZWVOb2RlLCB7CiAgICAgICAgICAgICAgICAgIGN1ckRhdGE6IGVudGl0eQogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICBPYmplY3QuYXNzaWduKHRyZWVOb2RlLCB7CiAgICAgICAgICAgICAgICAgIG5hdmlnYXRlUGFyYW1zOiB7CiAgICAgICAgICAgICAgICAgICAgbl96Z2NvZGVfZXE6ICIxMCIsCiAgICAgICAgICAgICAgICAgICAgbm9kZWlkOiAiJU5PREVJRCUiCiAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgT2JqZWN0LmFzc2lnbih0cmVlTm9kZSwgewogICAgICAgICAgICAgICAgICBub2RlaWQ6IHRyZWVOb2RlLnNyZmtleQogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICBPYmplY3QuYXNzaWduKHRyZWVOb2RlLCB7CiAgICAgICAgICAgICAgICAgIG5vZGVpZDI6IGZpbHRlci5zdHJSZWFsTm9kZUlkCiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIGxpc3QucHVzaCh0cmVlTm9kZSk7CiAgICAgICAgICAgICAgICByZXNvbHZlKGxpc3QpOwogICAgICAgICAgICAgICAgYkZpcnN0ID0gZmFsc2U7CiAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgcmVzb2x2ZShsaXN0KTsKICAgICAgICAgICAgfQogICAgICAgICAgfSk7CiAgICAgICAgfSBjYXRjaCAoZXJyb3IpIHsKICAgICAgICAgIGNvbnNvbGUuZXJyb3IoZXJyb3IpOwogICAgICAgIH0KICAgICAgfSk7CiAgICB9CiAgICAvKioNCiAgICAgKiDojrflj5bmn6Xor6Lpm4blkIgNCiAgICAgKg0KICAgICAqIEBwdWJsaWMNCiAgICAgKiBAcGFyYW0ge2FueXt9fSBjb250ZXh0DQogICAgICogQHBhcmFtIHsqfSBzZWFyY2hGaWx0ZXINCiAgICAgKiBAcGFyYW0geyp9IGZpbHRlcg0KICAgICAqIEByZXR1cm5zIHthbnlbXX0NCiAgICAgKiBAbWVtYmVyb2YgVGVzdEVuZXRpdHlEYXRhc1NlcnZpY2UNCiAgICAgKi8KCiAgfSwgewogICAga2V5OiAic2VhcmNoU3Vic3Vib3Jtb3JnaW5mbyIsCiAgICB2YWx1ZTogZnVuY3Rpb24gc2VhcmNoU3Vic3Vib3Jtb3JnaW5mbygpIHsKICAgICAgdmFyIF90aGlzNyA9IHRoaXM7CgogICAgICB2YXIgY29udGV4dCA9IGFyZ3VtZW50cy5sZW5ndGggPiAwICYmIGFyZ3VtZW50c1swXSAhPT0gdW5kZWZpbmVkID8gYXJndW1lbnRzWzBdIDoge307CiAgICAgIHZhciBzZWFyY2hGaWx0ZXIgPSBhcmd1bWVudHMubGVuZ3RoID4gMSA/IGFyZ3VtZW50c1sxXSA6IHVuZGVmaW5lZDsKICAgICAgdmFyIGZpbHRlciA9IGFyZ3VtZW50cy5sZW5ndGggPiAyID8gYXJndW1lbnRzWzJdIDogdW5kZWZpbmVkOwogICAgICByZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24gKHJlc29sdmUsIHJlamVjdCkgewogICAgICAgIGlmIChmaWx0ZXIudmlld3BhcmFtcykgewogICAgICAgICAgT2JqZWN0LmFzc2lnbihzZWFyY2hGaWx0ZXIsIGZpbHRlci52aWV3cGFyYW1zKTsKICAgICAgICB9CgogICAgICAgIGlmICghc2VhcmNoRmlsdGVyLnBhZ2UpIHsKICAgICAgICAgIE9iamVjdC5hc3NpZ24oc2VhcmNoRmlsdGVyLCB7CiAgICAgICAgICAgIHBhZ2U6IDAKICAgICAgICAgIH0pOwogICAgICAgIH0KCiAgICAgICAgaWYgKCFzZWFyY2hGaWx0ZXIuc2l6ZSkgewogICAgICAgICAgT2JqZWN0LmFzc2lnbihzZWFyY2hGaWx0ZXIsIHsKICAgICAgICAgICAgc2l6ZTogMTAwMAogICAgICAgICAgfSk7CiAgICAgICAgfQoKICAgICAgICBpZiAoY29udGV4dCAmJiBjb250ZXh0LnNyZnBhcmVudGRlbmFtZSkgewogICAgICAgICAgT2JqZWN0LmFzc2lnbihzZWFyY2hGaWx0ZXIsIHsKICAgICAgICAgICAgc3JmcGFyZW50ZGVuYW1lOiBKU09OLnBhcnNlKEpTT04uc3RyaW5naWZ5KGNvbnRleHQpKS5zcmZwYXJlbnRkZW5hbWUKICAgICAgICAgIH0pOwogICAgICAgIH0KCiAgICAgICAgaWYgKGNvbnRleHQgJiYgY29udGV4dC5zcmZwYXJlbnRrZXkpIHsKICAgICAgICAgIE9iamVjdC5hc3NpZ24oc2VhcmNoRmlsdGVyLCB7CiAgICAgICAgICAgIHNyZnBhcmVudGtleTogSlNPTi5wYXJzZShKU09OLnN0cmluZ2lmeShjb250ZXh0KSkuc3JmcGFyZW50a2V5CiAgICAgICAgICB9KTsKICAgICAgICB9CgogICAgICAgIE9iamVjdC5hc3NpZ24oc2VhcmNoRmlsdGVyLCB7CiAgICAgICAgICBzb3J0OiAncHgsYXNjJwogICAgICAgIH0pOwogICAgICAgIHZhciBfYXBwRW50aXR5U2VydmljZSA9IF90aGlzNy5vcm1vcmdTZXJ2aWNlOwogICAgICAgIHZhciBsaXN0ID0gW107CgogICAgICAgIGlmIChfYXBwRW50aXR5U2VydmljZVsnRmV0Y2hDdXJDaGlsZCddICYmIF9hcHBFbnRpdHlTZXJ2aWNlWydGZXRjaEN1ckNoaWxkJ10gaW5zdGFuY2VvZiBGdW5jdGlvbikgewogICAgICAgICAgdmFyIHJlc3BvbnNlID0gX2FwcEVudGl0eVNlcnZpY2VbJ0ZldGNoQ3VyQ2hpbGQnXShjb250ZXh0LCBzZWFyY2hGaWx0ZXIsIGZhbHNlKTsKCiAgICAgICAgICByZXNwb25zZS50aGVuKGZ1bmN0aW9uIChyZXNwb25zZSkgewogICAgICAgICAgICBpZiAoIXJlc3BvbnNlLnN0YXR1cyB8fCByZXNwb25zZS5zdGF0dXMgIT09IDIwMCkgewogICAgICAgICAgICAgIHJlc29sdmUoW10pOwogICAgICAgICAgICAgIGNvbnNvbGUubG9nKEpTT04uc3RyaW5naWZ5KGNvbnRleHQpKTsKICAgICAgICAgICAgICBjb25zb2xlLmVycm9yKCfmn6Xor6JGZXRjaEN1ckNoaWxk5pWw5o2u6ZuG5byC5bi4IScpOwogICAgICAgICAgICB9CgogICAgICAgICAgICB2YXIgZGF0YSA9IHJlc3BvbnNlLmRhdGE7CgogICAgICAgICAgICBpZiAoT2JqZWN0LmtleXMoZGF0YSkubGVuZ3RoID4gMCkgewogICAgICAgICAgICAgIGxpc3QgPSBKU09OLnBhcnNlKEpTT04uc3RyaW5naWZ5KGRhdGEpKTsKICAgICAgICAgICAgICByZXNvbHZlKGxpc3QpOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgIHJlc29sdmUoW10pOwogICAgICAgICAgICB9CiAgICAgICAgICB9KVsiY2F0Y2giXShmdW5jdGlvbiAocmVzcG9uc2UpIHsKICAgICAgICAgICAgcmVzb2x2ZShbXSk7CiAgICAgICAgICAgIGNvbnNvbGUubG9nKEpTT04uc3RyaW5naWZ5KGNvbnRleHQpKTsKICAgICAgICAgICAgY29uc29sZS5lcnJvcign5p+l6K+iRmV0Y2hDdXJDaGlsZOaVsOaNrumbhuW8guW4uCEnKTsKICAgICAgICAgIH0pOwogICAgICAgIH0KICAgICAgfSk7CiAgICB9CiAgICAvKioNCiAgICAgKiDloavlhYUg5qCR6KeG5Zu+6IqC54K5W+WtkOWtkOe7hOe7h+iKgueCuV3lrZDoioLngrkNCiAgICAgKg0KICAgICAqIEBwdWJsaWMNCiAgICAgKiBAcGFyYW0ge2FueXt9fSBjb250ZXh0DQogICAgICogQHBhcmFtIHsqfSBmaWx0ZXINCiAgICAgKiBAcGFyYW0ge2FueVtdfSBsaXN0DQogICAgICogQHJldHVybnMge1Byb21pc2U8YW55Pn0NCiAgICAgKiBAbWVtYmVyb2YgUEVSU09OSU5GT1RSRUVTZXJ2aWNlDQogICAgICovCgogIH0sIHsKICAgIGtleTogImZpbGxTdWJzdWJvcm1vcmdpbmZvTm9kZUNoaWxkcyIsCiAgICB2YWx1ZTogZnVuY3Rpb24gKCkgewogICAgICB2YXIgX2ZpbGxTdWJzdWJvcm1vcmdpbmZvTm9kZUNoaWxkcyA9IF9hc3luY1RvR2VuZXJhdG9yKAogICAgICAvKiNfX1BVUkVfXyovCiAgICAgIHJlZ2VuZXJhdG9yUnVudGltZS5tYXJrKGZ1bmN0aW9uIF9jYWxsZWU0KCkgewogICAgICAgIHZhciBjb250ZXh0LAogICAgICAgICAgICBmaWx0ZXIsCiAgICAgICAgICAgIGxpc3QsCiAgICAgICAgICAgIE9ybW9yZ3NlY3RvclJzTmF2Q29udGV4dCwKICAgICAgICAgICAgT3Jtb3Jnc2VjdG9yUnNOYXZQYXJhbXMsCiAgICAgICAgICAgIE9ybW9yZ3NlY3RvclJzUGFyYW1zLAogICAgICAgICAgICBfT3Jtb3Jnc2VjdG9yUnNOYXZDb250ZXh0MywKICAgICAgICAgICAgX09ybW9yZ3NlY3RvclJzTmF2UGFyYW1zMywKICAgICAgICAgICAgX09ybW9yZ3NlY3RvclJzUGFyYW1zMywKICAgICAgICAgICAgX2FyZ3M0ID0gYXJndW1lbnRzOwoKICAgICAgICByZXR1cm4gcmVnZW5lcmF0b3JSdW50aW1lLndyYXAoZnVuY3Rpb24gX2NhbGxlZTQkKF9jb250ZXh0NCkgewogICAgICAgICAgd2hpbGUgKDEpIHsKICAgICAgICAgICAgc3dpdGNoIChfY29udGV4dDQucHJldiA9IF9jb250ZXh0NC5uZXh0KSB7CiAgICAgICAgICAgICAgY2FzZSAwOgogICAgICAgICAgICAgICAgY29udGV4dCA9IF9hcmdzNC5sZW5ndGggPiAwICYmIF9hcmdzNFswXSAhPT0gdW5kZWZpbmVkID8gX2FyZ3M0WzBdIDoge307CiAgICAgICAgICAgICAgICBmaWx0ZXIgPSBfYXJnczQubGVuZ3RoID4gMSA/IF9hcmdzNFsxXSA6IHVuZGVmaW5lZDsKICAgICAgICAgICAgICAgIGxpc3QgPSBfYXJnczQubGVuZ3RoID4gMiA/IF9hcmdzNFsyXSA6IHVuZGVmaW5lZDsKCiAgICAgICAgICAgICAgICBpZiAoIShmaWx0ZXIuc3Jmbm9kZWZpbHRlciAmJiAhT2JqZWN0LmlzKGZpbHRlci5zcmZub2RlZmlsdGVyLCAiIikpKSB7CiAgICAgICAgICAgICAgICAgIF9jb250ZXh0NC5uZXh0ID0gMTE7CiAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIC8vIOWhq+WFheWtkOmDqOmXqOiKgueCuQogICAgICAgICAgICAgICAgT3Jtb3Jnc2VjdG9yUnNOYXZDb250ZXh0ID0ge307CiAgICAgICAgICAgICAgICBPcm1vcmdzZWN0b3JSc05hdlBhcmFtcyA9IHt9OwogICAgICAgICAgICAgICAgT3Jtb3Jnc2VjdG9yUnNQYXJhbXMgPSB7fTsKICAgICAgICAgICAgICAgIF9jb250ZXh0NC5uZXh0ID0gOTsKICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLmZpbGxPcm1vcmdzZWN0b3JOb2Rlcyhjb250ZXh0LCBmaWx0ZXIsIGxpc3QsIE9ybW9yZ3NlY3RvclJzTmF2Q29udGV4dCwgT3Jtb3Jnc2VjdG9yUnNOYXZQYXJhbXMsIE9ybW9yZ3NlY3RvclJzUGFyYW1zKTsKCiAgICAgICAgICAgICAgY2FzZSA5OgogICAgICAgICAgICAgICAgX2NvbnRleHQ0Lm5leHQgPSAxNjsKICAgICAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgICAgICBjYXNlIDExOgogICAgICAgICAgICAgICAgLy8g5aGr5YWF5a2Q6YOo6Zeo6IqC54K5CiAgICAgICAgICAgICAgICBfT3Jtb3Jnc2VjdG9yUnNOYXZDb250ZXh0MyA9IHt9OwogICAgICAgICAgICAgICAgX09ybW9yZ3NlY3RvclJzTmF2UGFyYW1zMyA9IHt9OwogICAgICAgICAgICAgICAgX09ybW9yZ3NlY3RvclJzUGFyYW1zMyA9IHt9OwogICAgICAgICAgICAgICAgX2NvbnRleHQ0Lm5leHQgPSAxNjsKICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLmZpbGxPcm1vcmdzZWN0b3JOb2Rlcyhjb250ZXh0LCBmaWx0ZXIsIGxpc3QsIF9Pcm1vcmdzZWN0b3JSc05hdkNvbnRleHQzLCBfT3Jtb3Jnc2VjdG9yUnNOYXZQYXJhbXMzLCBfT3Jtb3Jnc2VjdG9yUnNQYXJhbXMzKTsKCiAgICAgICAgICAgICAgY2FzZSAxNjoKICAgICAgICAgICAgICBjYXNlICJlbmQiOgogICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0NC5zdG9wKCk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9LCBfY2FsbGVlNCwgdGhpcyk7CiAgICAgIH0pKTsKCiAgICAgIGZ1bmN0aW9uIGZpbGxTdWJzdWJvcm1vcmdpbmZvTm9kZUNoaWxkcygpIHsKICAgICAgICByZXR1cm4gX2ZpbGxTdWJzdWJvcm1vcmdpbmZvTm9kZUNoaWxkcy5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwogICAgICB9CgogICAgICByZXR1cm4gZmlsbFN1YnN1Ym9ybW9yZ2luZm9Ob2RlQ2hpbGRzOwogICAgfSgpCiAgICAvKioNCiAgICAgKiDloavlhYUg5qCR6KeG5Zu+6IqC54K5W+WtkOmDqOmXqOiKgueCuV0NCiAgICAgKg0KICAgICAqIEBwdWJsaWMNCiAgICAgKiBAcGFyYW0ge2FueXt9fSBjb250ZXh0DQogICAgICogQHBhcmFtIHsqfSBmaWx0ZXINCiAgICAgKiBAcGFyYW0ge2FueVtdfSBsaXN0DQogICAgICogQHBhcmFtIHsqfSByc05hdkNvbnRleHQNCiAgICAgKiBAcGFyYW0geyp9IHJzTmF2UGFyYW1zDQogICAgICogQHBhcmFtIHsqfSByc1BhcmFtcw0KICAgICAqIEByZXR1cm5zIHtQcm9taXNlPGFueT59DQogICAgICogQG1lbWJlcm9mIFBFUlNPTklORk9UUkVFU2VydmljZQ0KICAgICAqLwoKICB9LCB7CiAgICBrZXk6ICJmaWxsT3Jtb3Jnc2VjdG9yTm9kZXMiLAogICAgdmFsdWU6IGZ1bmN0aW9uIGZpbGxPcm1vcmdzZWN0b3JOb2RlcygpIHsKICAgICAgdmFyIF90aGlzOCA9IHRoaXM7CgogICAgICB2YXIgY29udGV4dCA9IGFyZ3VtZW50cy5sZW5ndGggPiAwICYmIGFyZ3VtZW50c1swXSAhPT0gdW5kZWZpbmVkID8gYXJndW1lbnRzWzBdIDoge307CiAgICAgIHZhciBmaWx0ZXIgPSBhcmd1bWVudHMubGVuZ3RoID4gMSA/IGFyZ3VtZW50c1sxXSA6IHVuZGVmaW5lZDsKICAgICAgdmFyIGxpc3QgPSBhcmd1bWVudHMubGVuZ3RoID4gMiA/IGFyZ3VtZW50c1syXSA6IHVuZGVmaW5lZDsKICAgICAgdmFyIHJzTmF2Q29udGV4dCA9IGFyZ3VtZW50cy5sZW5ndGggPiAzID8gYXJndW1lbnRzWzNdIDogdW5kZWZpbmVkOwogICAgICB2YXIgcnNOYXZQYXJhbXMgPSBhcmd1bWVudHMubGVuZ3RoID4gNCA/IGFyZ3VtZW50c1s0XSA6IHVuZGVmaW5lZDsKICAgICAgdmFyIHJzUGFyYW1zID0gYXJndW1lbnRzLmxlbmd0aCA+IDUgPyBhcmd1bWVudHNbNV0gOiB1bmRlZmluZWQ7CiAgICAgIGNvbnRleHQgPSB0aGlzLmhhbmRsZVJlc05hdkNvbnRleHQoY29udGV4dCwgZmlsdGVyLCByc05hdkNvbnRleHQpOwogICAgICBmaWx0ZXIgPSB0aGlzLmhhbmRsZVJlc05hdlBhcmFtcyhjb250ZXh0LCBmaWx0ZXIsIHJzTmF2UGFyYW1zLCByc1BhcmFtcyk7CiAgICAgIHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbiAocmVzb2x2ZSwgcmVqZWN0KSB7CiAgICAgICAgdmFyIHNlYXJjaEZpbHRlciA9IHt9OwogICAgICAgIE9iamVjdC5hc3NpZ24oc2VhcmNoRmlsdGVyLCB7CiAgICAgICAgICB0b3RhbDogZmFsc2UKICAgICAgICB9KTsKICAgICAgICB2YXIgYkZpcnN0ID0gdHJ1ZTsKICAgICAgICB2YXIgcmVjb3JkcyA9IFtdOwoKICAgICAgICB0cnkgewogICAgICAgICAgX3RoaXM4LnNlYXJjaE9ybW9yZ3NlY3Rvcihjb250ZXh0LCBzZWFyY2hGaWx0ZXIsIGZpbHRlcikudGhlbihmdW5jdGlvbiAocmVjb3JkcykgewogICAgICAgICAgICBpZiAocmVjb3JkcyAmJiByZWNvcmRzLmxlbmd0aCA+IDApIHsKICAgICAgICAgICAgICByZWNvcmRzLmZvckVhY2goZnVuY3Rpb24gKGVudGl0eSkgewogICAgICAgICAgICAgICAgdmFyIHRyZWVOb2RlID0ge307IC8vIOaVtOeQhmNvbnRleHQKCiAgICAgICAgICAgICAgICB2YXIgc3RySWQgPSBlbnRpdHkub3Jnc2VjdG9yaWQ7CiAgICAgICAgICAgICAgICB2YXIgc3RyVGV4dCA9IGVudGl0eS5zaG9ydG5hbWU7CiAgICAgICAgICAgICAgICBPYmplY3QuYXNzaWduKHRyZWVOb2RlLCB7CiAgICAgICAgICAgICAgICAgIHNyZnBhcmVudGRlbmFtZTogJ09ybU9yZ3NlY3RvcicsCiAgICAgICAgICAgICAgICAgIHNyZnBhcmVudGtleTogZW50aXR5Lm9yZ3NlY3RvcmlkCiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIHZhciB0ZW1wQ29udGV4dCA9IEpTT04ucGFyc2UoSlNPTi5zdHJpbmdpZnkoY29udGV4dCkpOwogICAgICAgICAgICAgICAgT2JqZWN0LmFzc2lnbih0ZW1wQ29udGV4dCwgewogICAgICAgICAgICAgICAgICBzcmZwYXJlbnRkZW5hbWU6ICdPcm1PcmdzZWN0b3InLAogICAgICAgICAgICAgICAgICBzcmZwYXJlbnRrZXk6IGVudGl0eS5vcmdzZWN0b3JpZCwKICAgICAgICAgICAgICAgICAgb3Jtb3Jnc2VjdG9yOiBzdHJJZAogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICBPYmplY3QuYXNzaWduKHRyZWVOb2RlLCB7CiAgICAgICAgICAgICAgICAgIHNyZmFwcGN0eDogdGVtcENvbnRleHQKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgT2JqZWN0LmFzc2lnbih0cmVlTm9kZSwgewogICAgICAgICAgICAgICAgICAnb3Jtb3Jnc2VjdG9yJzogc3RySWQKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgT2JqZWN0LmFzc2lnbih0cmVlTm9kZSwgewogICAgICAgICAgICAgICAgICBzcmZrZXk6IHN0cklkCiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIE9iamVjdC5hc3NpZ24odHJlZU5vZGUsIHsKICAgICAgICAgICAgICAgICAgdGV4dDogc3RyVGV4dCwKICAgICAgICAgICAgICAgICAgc3JmbWFqb3J0ZXh0OiBzdHJUZXh0CiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIHZhciBzdHJOb2RlSWQgPSAnT1JNT1JHU0VDVE9SJzsKICAgICAgICAgICAgICAgIHN0ck5vZGVJZCArPSBfdGhpczguVFJFRU5PREVfU0VQQVJBVE9SOwogICAgICAgICAgICAgICAgc3RyTm9kZUlkICs9IHN0cklkOwogICAgICAgICAgICAgICAgT2JqZWN0LmFzc2lnbih0cmVlTm9kZSwgewogICAgICAgICAgICAgICAgICBpZDogc3RyTm9kZUlkCiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIE9iamVjdC5hc3NpZ24odHJlZU5vZGUsIHsKICAgICAgICAgICAgICAgICAgZXhwYW5kZWQ6IGZpbHRlci5pc2F1dG9leHBhbmQKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgT2JqZWN0LmFzc2lnbih0cmVlTm9kZSwgewogICAgICAgICAgICAgICAgICBsZWFmOiB0cnVlCiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIE9iamVjdC5hc3NpZ24odHJlZU5vZGUsIHsKICAgICAgICAgICAgICAgICAgY3VyRGF0YTogZW50aXR5CiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIE9iamVjdC5hc3NpZ24odHJlZU5vZGUsIHsKICAgICAgICAgICAgICAgICAgbmF2aWdhdGVQYXJhbXM6IHsKICAgICAgICAgICAgICAgICAgICBuX3pnY29kZV9lcTogIjEwIiwKICAgICAgICAgICAgICAgICAgICBub2RlaWQ6ICIlTk9ERUlEJSIKICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICBPYmplY3QuYXNzaWduKHRyZWVOb2RlLCB7CiAgICAgICAgICAgICAgICAgIG5vZGVpZDogdHJlZU5vZGUuc3Jma2V5CiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIE9iamVjdC5hc3NpZ24odHJlZU5vZGUsIHsKICAgICAgICAgICAgICAgICAgbm9kZWlkMjogZmlsdGVyLnN0clJlYWxOb2RlSWQKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgbGlzdC5wdXNoKHRyZWVOb2RlKTsKICAgICAgICAgICAgICAgIHJlc29sdmUobGlzdCk7CiAgICAgICAgICAgICAgICBiRmlyc3QgPSBmYWxzZTsKICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICByZXNvbHZlKGxpc3QpOwogICAgICAgICAgICB9CiAgICAgICAgICB9KTsKICAgICAgICB9IGNhdGNoIChlcnJvcikgewogICAgICAgICAgY29uc29sZS5lcnJvcihlcnJvcik7CiAgICAgICAgfQogICAgICB9KTsKICAgIH0KICAgIC8qKg0KICAgICAqIOiOt+WPluafpeivoumbhuWQiA0KICAgICAqDQogICAgICogQHB1YmxpYw0KICAgICAqIEBwYXJhbSB7YW55e319IGNvbnRleHQNCiAgICAgKiBAcGFyYW0geyp9IHNlYXJjaEZpbHRlcg0KICAgICAqIEBwYXJhbSB7Kn0gZmlsdGVyDQogICAgICogQHJldHVybnMge2FueVtdfQ0KICAgICAqIEBtZW1iZXJvZiBUZXN0RW5ldGl0eURhdGFzU2VydmljZQ0KICAgICAqLwoKICB9LCB7CiAgICBrZXk6ICJzZWFyY2hPcm1vcmdzZWN0b3IiLAogICAgdmFsdWU6IGZ1bmN0aW9uIHNlYXJjaE9ybW9yZ3NlY3RvcigpIHsKICAgICAgdmFyIF90aGlzOSA9IHRoaXM7CgogICAgICB2YXIgY29udGV4dCA9IGFyZ3VtZW50cy5sZW5ndGggPiAwICYmIGFyZ3VtZW50c1swXSAhPT0gdW5kZWZpbmVkID8gYXJndW1lbnRzWzBdIDoge307CiAgICAgIHZhciBzZWFyY2hGaWx0ZXIgPSBhcmd1bWVudHMubGVuZ3RoID4gMSA/IGFyZ3VtZW50c1sxXSA6IHVuZGVmaW5lZDsKICAgICAgdmFyIGZpbHRlciA9IGFyZ3VtZW50cy5sZW5ndGggPiAyID8gYXJndW1lbnRzWzJdIDogdW5kZWZpbmVkOwogICAgICByZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24gKHJlc29sdmUsIHJlamVjdCkgewogICAgICAgIGlmIChmaWx0ZXIudmlld3BhcmFtcykgewogICAgICAgICAgT2JqZWN0LmFzc2lnbihzZWFyY2hGaWx0ZXIsIGZpbHRlci52aWV3cGFyYW1zKTsKICAgICAgICB9CgogICAgICAgIGlmICghc2VhcmNoRmlsdGVyLnBhZ2UpIHsKICAgICAgICAgIE9iamVjdC5hc3NpZ24oc2VhcmNoRmlsdGVyLCB7CiAgICAgICAgICAgIHBhZ2U6IDAKICAgICAgICAgIH0pOwogICAgICAgIH0KCiAgICAgICAgaWYgKCFzZWFyY2hGaWx0ZXIuc2l6ZSkgewogICAgICAgICAgT2JqZWN0LmFzc2lnbihzZWFyY2hGaWx0ZXIsIHsKICAgICAgICAgICAgc2l6ZTogMTAwMAogICAgICAgICAgfSk7CiAgICAgICAgfQoKICAgICAgICBpZiAoY29udGV4dCAmJiBjb250ZXh0LnNyZnBhcmVudGRlbmFtZSkgewogICAgICAgICAgT2JqZWN0LmFzc2lnbihzZWFyY2hGaWx0ZXIsIHsKICAgICAgICAgICAgc3JmcGFyZW50ZGVuYW1lOiBKU09OLnBhcnNlKEpTT04uc3RyaW5naWZ5KGNvbnRleHQpKS5zcmZwYXJlbnRkZW5hbWUKICAgICAgICAgIH0pOwogICAgICAgIH0KCiAgICAgICAgaWYgKGNvbnRleHQgJiYgY29udGV4dC5zcmZwYXJlbnRrZXkpIHsKICAgICAgICAgIE9iamVjdC5hc3NpZ24oc2VhcmNoRmlsdGVyLCB7CiAgICAgICAgICAgIHNyZnBhcmVudGtleTogSlNPTi5wYXJzZShKU09OLnN0cmluZ2lmeShjb250ZXh0KSkuc3JmcGFyZW50a2V5CiAgICAgICAgICB9KTsKICAgICAgICB9CgogICAgICAgIE9iamVjdC5hc3NpZ24oc2VhcmNoRmlsdGVyLCB7CiAgICAgICAgICBzb3J0OiAnb3JkZXJ2YWx1ZSxhc2MnCiAgICAgICAgfSk7CiAgICAgICAgdmFyIF9hcHBFbnRpdHlTZXJ2aWNlID0gX3RoaXM5Lm9ybW9yZ3NlY3RvclNlcnZpY2U7CiAgICAgICAgdmFyIGxpc3QgPSBbXTsKCiAgICAgICAgaWYgKF9hcHBFbnRpdHlTZXJ2aWNlWydGZXRjaFBpbXBlcnNvbkluZm9PcmdzZWN0b3InXSAmJiBfYXBwRW50aXR5U2VydmljZVsnRmV0Y2hQaW1wZXJzb25JbmZvT3Jnc2VjdG9yJ10gaW5zdGFuY2VvZiBGdW5jdGlvbikgewogICAgICAgICAgdmFyIHJlc3BvbnNlID0gX2FwcEVudGl0eVNlcnZpY2VbJ0ZldGNoUGltcGVyc29uSW5mb09yZ3NlY3RvciddKGNvbnRleHQsIHNlYXJjaEZpbHRlciwgZmFsc2UpOwoKICAgICAgICAgIHJlc3BvbnNlLnRoZW4oZnVuY3Rpb24gKHJlc3BvbnNlKSB7CiAgICAgICAgICAgIGlmICghcmVzcG9uc2Uuc3RhdHVzIHx8IHJlc3BvbnNlLnN0YXR1cyAhPT0gMjAwKSB7CiAgICAgICAgICAgICAgcmVzb2x2ZShbXSk7CiAgICAgICAgICAgICAgY29uc29sZS5sb2coSlNPTi5zdHJpbmdpZnkoY29udGV4dCkpOwogICAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoJ+afpeivokZldGNoUGltcGVyc29uSW5mb09yZ3NlY3RvcuaVsOaNrumbhuW8guW4uCEnKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgdmFyIGRhdGEgPSByZXNwb25zZS5kYXRhOwoKICAgICAgICAgICAgaWYgKE9iamVjdC5rZXlzKGRhdGEpLmxlbmd0aCA+IDApIHsKICAgICAgICAgICAgICBsaXN0ID0gSlNPTi5wYXJzZShKU09OLnN0cmluZ2lmeShkYXRhKSk7CiAgICAgICAgICAgICAgcmVzb2x2ZShsaXN0KTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICByZXNvbHZlKFtdKTsKICAgICAgICAgICAgfQogICAgICAgICAgfSlbImNhdGNoIl0oZnVuY3Rpb24gKHJlc3BvbnNlKSB7CiAgICAgICAgICAgIHJlc29sdmUoW10pOwogICAgICAgICAgICBjb25zb2xlLmxvZyhKU09OLnN0cmluZ2lmeShjb250ZXh0KSk7CiAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoJ+afpeivokZldGNoUGltcGVyc29uSW5mb09yZ3NlY3RvcuaVsOaNrumbhuW8guW4uCEnKTsKICAgICAgICAgIH0pOwogICAgICAgIH0KICAgICAgfSk7CiAgICB9CiAgICAvKioNCiAgICAgKiDloavlhYUg5qCR6KeG5Zu+6IqC54K5W+WtkOmDqOmXqOiKgueCuV3lrZDoioLngrkNCiAgICAgKg0KICAgICAqIEBwdWJsaWMNCiAgICAgKiBAcGFyYW0ge2FueXt9fSBjb250ZXh0DQogICAgICogQHBhcmFtIHsqfSBmaWx0ZXINCiAgICAgKiBAcGFyYW0ge2FueVtdfSBsaXN0DQogICAgICogQHJldHVybnMge1Byb21pc2U8YW55Pn0NCiAgICAgKiBAbWVtYmVyb2YgUEVSU09OSU5GT1RSRUVTZXJ2aWNlDQogICAgICovCgogIH0sIHsKICAgIGtleTogImZpbGxPcm1vcmdzZWN0b3JOb2RlQ2hpbGRzIiwKICAgIHZhbHVlOiBmdW5jdGlvbiAoKSB7CiAgICAgIHZhciBfZmlsbE9ybW9yZ3NlY3Rvck5vZGVDaGlsZHMgPSBfYXN5bmNUb0dlbmVyYXRvcigKICAgICAgLyojX19QVVJFX18qLwogICAgICByZWdlbmVyYXRvclJ1bnRpbWUubWFyayhmdW5jdGlvbiBfY2FsbGVlNSgpIHsKICAgICAgICB2YXIgY29udGV4dCwKICAgICAgICAgICAgZmlsdGVyLAogICAgICAgICAgICBsaXN0LAogICAgICAgICAgICBfYXJnczUgPSBhcmd1bWVudHM7CiAgICAgICAgcmV0dXJuIHJlZ2VuZXJhdG9yUnVudGltZS53cmFwKGZ1bmN0aW9uIF9jYWxsZWU1JChfY29udGV4dDUpIHsKICAgICAgICAgIHdoaWxlICgxKSB7CiAgICAgICAgICAgIHN3aXRjaCAoX2NvbnRleHQ1LnByZXYgPSBfY29udGV4dDUubmV4dCkgewogICAgICAgICAgICAgIGNhc2UgMDoKICAgICAgICAgICAgICAgIGNvbnRleHQgPSBfYXJnczUubGVuZ3RoID4gMCAmJiBfYXJnczVbMF0gIT09IHVuZGVmaW5lZCA/IF9hcmdzNVswXSA6IHt9OwogICAgICAgICAgICAgICAgZmlsdGVyID0gX2FyZ3M1Lmxlbmd0aCA+IDEgPyBfYXJnczVbMV0gOiB1bmRlZmluZWQ7CiAgICAgICAgICAgICAgICBsaXN0ID0gX2FyZ3M1Lmxlbmd0aCA+IDIgPyBfYXJnczVbMl0gOiB1bmRlZmluZWQ7CgogICAgICAgICAgICAgICAgaWYgKGZpbHRlci5zcmZub2RlZmlsdGVyICYmICFPYmplY3QuaXMoZmlsdGVyLnNyZm5vZGVmaWx0ZXIsICIiKSkge30gZWxzZSB7fQoKICAgICAgICAgICAgICBjYXNlIDQ6CiAgICAgICAgICAgICAgY2FzZSAiZW5kIjoKICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDUuc3RvcCgpOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSwgX2NhbGxlZTUpOwogICAgICB9KSk7CgogICAgICBmdW5jdGlvbiBmaWxsT3Jtb3Jnc2VjdG9yTm9kZUNoaWxkcygpIHsKICAgICAgICByZXR1cm4gX2ZpbGxPcm1vcmdzZWN0b3JOb2RlQ2hpbGRzLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7CiAgICAgIH0KCiAgICAgIHJldHVybiBmaWxsT3Jtb3Jnc2VjdG9yTm9kZUNoaWxkczsKICAgIH0oKQogICAgLyoqDQogICAgICog5aGr5YWFIOagkeinhuWbvuiKgueCuVvpu5jorqTmoLnoioLngrldDQogICAgICoNCiAgICAgKiBAcHVibGljDQogICAgICogQHBhcmFtIHthbnl7fX0gY29udGV4dA0KICAgICAqIEBwYXJhbSB7Kn0gZmlsdGVyDQogICAgICogQHBhcmFtIHthbnlbXX0gbGlzdA0KICAgICAqIEBwYXJhbSB7Kn0gcnNOYXZDb250ZXh0DQogICAgICogQHBhcmFtIHsqfSByc05hdlBhcmFtcw0KICAgICAqIEBwYXJhbSB7Kn0gcnNQYXJhbXMNCiAgICAgKiBAcmV0dXJucyB7UHJvbWlzZTxhbnk+fQ0KICAgICAqIEBtZW1iZXJvZiBQRVJTT05JTkZPVFJFRVNlcnZpY2UNCiAgICAgKi8KCiAgfSwgewogICAga2V5OiAiZmlsbFJvb3ROb2RlcyIsCiAgICB2YWx1ZTogZnVuY3Rpb24gZmlsbFJvb3ROb2RlcygpIHsKICAgICAgdmFyIF90aGlzMTAgPSB0aGlzOwoKICAgICAgdmFyIGNvbnRleHQgPSBhcmd1bWVudHMubGVuZ3RoID4gMCAmJiBhcmd1bWVudHNbMF0gIT09IHVuZGVmaW5lZCA/IGFyZ3VtZW50c1swXSA6IHt9OwogICAgICB2YXIgZmlsdGVyID0gYXJndW1lbnRzLmxlbmd0aCA+IDEgPyBhcmd1bWVudHNbMV0gOiB1bmRlZmluZWQ7CiAgICAgIHZhciBsaXN0ID0gYXJndW1lbnRzLmxlbmd0aCA+IDIgPyBhcmd1bWVudHNbMl0gOiB1bmRlZmluZWQ7CiAgICAgIHZhciByc05hdkNvbnRleHQgPSBhcmd1bWVudHMubGVuZ3RoID4gMyA/IGFyZ3VtZW50c1szXSA6IHVuZGVmaW5lZDsKICAgICAgdmFyIHJzTmF2UGFyYW1zID0gYXJndW1lbnRzLmxlbmd0aCA+IDQgPyBhcmd1bWVudHNbNF0gOiB1bmRlZmluZWQ7CiAgICAgIHZhciByc1BhcmFtcyA9IGFyZ3VtZW50cy5sZW5ndGggPiA1ID8gYXJndW1lbnRzWzVdIDogdW5kZWZpbmVkOwogICAgICBjb250ZXh0ID0gdGhpcy5oYW5kbGVSZXNOYXZDb250ZXh0KGNvbnRleHQsIGZpbHRlciwgcnNOYXZDb250ZXh0KTsKICAgICAgZmlsdGVyID0gdGhpcy5oYW5kbGVSZXNOYXZQYXJhbXMoY29udGV4dCwgZmlsdGVyLCByc05hdlBhcmFtcywgcnNQYXJhbXMpOwogICAgICByZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24gKHJlc29sdmUsIHJlamVjdCkgewogICAgICAgIHZhciB0cmVlTm9kZSA9IHt9OwogICAgICAgIE9iamVjdC5hc3NpZ24odHJlZU5vZGUsIHsKICAgICAgICAgIHRleHQ6ICdlbnRpdGllcy5waW1wZXJzb24ucGVyc29uaW5mb3RyZWVfdHJlZXZpZXcubm9kZXMucm9vdCcKICAgICAgICB9KTsKICAgICAgICBPYmplY3QuYXNzaWduKHRyZWVOb2RlLCB7CiAgICAgICAgICBpc1VzZUxhbmdSZXM6IHRydWUKICAgICAgICB9KTsKICAgICAgICBPYmplY3QuYXNzaWduKHRyZWVOb2RlLCB7CiAgICAgICAgICBzcmZhcHBjdHg6IGNvbnRleHQKICAgICAgICB9KTsKICAgICAgICBPYmplY3QuYXNzaWduKHRyZWVOb2RlLCB7CiAgICAgICAgICBzcmZtYWpvcnRleHQ6IHRyZWVOb2RlLnRleHQKICAgICAgICB9KTsKICAgICAgICB2YXIgc3RyTm9kZUlkID0gJ1JPT1QnOwogICAgICAgIE9iamVjdC5hc3NpZ24odHJlZU5vZGUsIHsKICAgICAgICAgIHNyZmtleTogJ3Jvb3QnCiAgICAgICAgfSk7CiAgICAgICAgc3RyTm9kZUlkICs9IF90aGlzMTAuVFJFRU5PREVfU0VQQVJBVE9SOwogICAgICAgIHN0ck5vZGVJZCArPSAncm9vdCc7CiAgICAgICAgT2JqZWN0LmFzc2lnbih0cmVlTm9kZSwgewogICAgICAgICAgaWQ6IHN0ck5vZGVJZAogICAgICAgIH0pOwogICAgICAgIE9iamVjdC5hc3NpZ24odHJlZU5vZGUsIHsKICAgICAgICAgIGV4cGFuZGVkOiBmaWx0ZXIuaXNBdXRvZXhwYW5kCiAgICAgICAgfSk7CiAgICAgICAgT2JqZWN0LmFzc2lnbih0cmVlTm9kZSwgewogICAgICAgICAgbGVhZjogZmFsc2UKICAgICAgICB9KTsKICAgICAgICBPYmplY3QuYXNzaWduKHRyZWVOb2RlLCB7CiAgICAgICAgICBub2RlaWQ6IHRyZWVOb2RlLnNyZmtleQogICAgICAgIH0pOwogICAgICAgIE9iamVjdC5hc3NpZ24odHJlZU5vZGUsIHsKICAgICAgICAgIG5vZGVpZDI6IGZpbHRlci5zdHJSZWFsTm9kZUlkCiAgICAgICAgfSk7CiAgICAgICAgbGlzdC5wdXNoKHRyZWVOb2RlKTsKICAgICAgICByZXNvbHZlKGxpc3QpOwogICAgICB9KTsKICAgIH0KICAgIC8qKg0KICAgICAqIOWhq+WFhSDmoJHop4blm77oioLngrlb6buY6K6k5qC56IqC54K5XeWtkOiKgueCuQ0KICAgICAqDQogICAgICogQHB1YmxpYw0KICAgICAqIEBwYXJhbSB7YW55e319IGNvbnRleHQNCiAgICAgKiBAcGFyYW0geyp9IGZpbHRlcg0KICAgICAqIEBwYXJhbSB7YW55W119IGxpc3QNCiAgICAgKiBAcmV0dXJucyB7UHJvbWlzZTxhbnk+fQ0KICAgICAqIEBtZW1iZXJvZiBQRVJTT05JTkZPVFJFRVNlcnZpY2UNCiAgICAgKi8KCiAgfSwgewogICAga2V5OiAiZmlsbFJvb3ROb2RlQ2hpbGRzIiwKICAgIHZhbHVlOiBmdW5jdGlvbiAoKSB7CiAgICAgIHZhciBfZmlsbFJvb3ROb2RlQ2hpbGRzID0gX2FzeW5jVG9HZW5lcmF0b3IoCiAgICAgIC8qI19fUFVSRV9fKi8KICAgICAgcmVnZW5lcmF0b3JSdW50aW1lLm1hcmsoZnVuY3Rpb24gX2NhbGxlZTYoKSB7CiAgICAgICAgdmFyIGNvbnRleHQsCiAgICAgICAgICAgIGZpbHRlciwKICAgICAgICAgICAgbGlzdCwKICAgICAgICAgICAgT3Jtb3JnaW5mb1JzTmF2Q29udGV4dCwKICAgICAgICAgICAgT3Jtb3JnaW5mb1JzTmF2UGFyYW1zLAogICAgICAgICAgICBPcm1vcmdpbmZvUnNQYXJhbXMsCiAgICAgICAgICAgIF9Pcm1vcmdpbmZvUnNOYXZDb250ZXh0LAogICAgICAgICAgICBfT3Jtb3JnaW5mb1JzTmF2UGFyYW1zLAogICAgICAgICAgICBfT3Jtb3JnaW5mb1JzUGFyYW1zLAogICAgICAgICAgICBfYXJnczYgPSBhcmd1bWVudHM7CgogICAgICAgIHJldHVybiByZWdlbmVyYXRvclJ1bnRpbWUud3JhcChmdW5jdGlvbiBfY2FsbGVlNiQoX2NvbnRleHQ2KSB7CiAgICAgICAgICB3aGlsZSAoMSkgewogICAgICAgICAgICBzd2l0Y2ggKF9jb250ZXh0Ni5wcmV2ID0gX2NvbnRleHQ2Lm5leHQpIHsKICAgICAgICAgICAgICBjYXNlIDA6CiAgICAgICAgICAgICAgICBjb250ZXh0ID0gX2FyZ3M2Lmxlbmd0aCA+IDAgJiYgX2FyZ3M2WzBdICE9PSB1bmRlZmluZWQgPyBfYXJnczZbMF0gOiB7fTsKICAgICAgICAgICAgICAgIGZpbHRlciA9IF9hcmdzNi5sZW5ndGggPiAxID8gX2FyZ3M2WzFdIDogdW5kZWZpbmVkOwogICAgICAgICAgICAgICAgbGlzdCA9IF9hcmdzNi5sZW5ndGggPiAyID8gX2FyZ3M2WzJdIDogdW5kZWZpbmVkOwoKICAgICAgICAgICAgICAgIGlmICghKGZpbHRlci5zcmZub2RlZmlsdGVyICYmICFPYmplY3QuaXMoZmlsdGVyLnNyZm5vZGVmaWx0ZXIsICIiKSkpIHsKICAgICAgICAgICAgICAgICAgX2NvbnRleHQ2Lm5leHQgPSAxMTsKICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgLy8g5aGr5YWF5qC557uE57uH6IqC54K5CiAgICAgICAgICAgICAgICBPcm1vcmdpbmZvUnNOYXZDb250ZXh0ID0ge307CiAgICAgICAgICAgICAgICBPcm1vcmdpbmZvUnNOYXZQYXJhbXMgPSB7fTsKICAgICAgICAgICAgICAgIE9ybW9yZ2luZm9Sc1BhcmFtcyA9IHt9OwogICAgICAgICAgICAgICAgX2NvbnRleHQ2Lm5leHQgPSA5OwogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuZmlsbE9ybW9yZ2luZm9Ob2Rlcyhjb250ZXh0LCBmaWx0ZXIsIGxpc3QsIE9ybW9yZ2luZm9Sc05hdkNvbnRleHQsIE9ybW9yZ2luZm9Sc05hdlBhcmFtcywgT3Jtb3JnaW5mb1JzUGFyYW1zKTsKCiAgICAgICAgICAgICAgY2FzZSA5OgogICAgICAgICAgICAgICAgX2NvbnRleHQ2Lm5leHQgPSAxNjsKICAgICAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgICAgICBjYXNlIDExOgogICAgICAgICAgICAgICAgLy8g5aGr5YWF5qC557uE57uH6IqC54K5CiAgICAgICAgICAgICAgICBfT3Jtb3JnaW5mb1JzTmF2Q29udGV4dCA9IHt9OwogICAgICAgICAgICAgICAgX09ybW9yZ2luZm9Sc05hdlBhcmFtcyA9IHt9OwogICAgICAgICAgICAgICAgX09ybW9yZ2luZm9Sc1BhcmFtcyA9IHt9OwogICAgICAgICAgICAgICAgX2NvbnRleHQ2Lm5leHQgPSAxNjsKICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLmZpbGxPcm1vcmdpbmZvTm9kZXMoY29udGV4dCwgZmlsdGVyLCBsaXN0LCBfT3Jtb3JnaW5mb1JzTmF2Q29udGV4dCwgX09ybW9yZ2luZm9Sc05hdlBhcmFtcywgX09ybW9yZ2luZm9Sc1BhcmFtcyk7CgogICAgICAgICAgICAgIGNhc2UgMTY6CiAgICAgICAgICAgICAgY2FzZSAiZW5kIjoKICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDYuc3RvcCgpOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSwgX2NhbGxlZTYsIHRoaXMpOwogICAgICB9KSk7CgogICAgICBmdW5jdGlvbiBmaWxsUm9vdE5vZGVDaGlsZHMoKSB7CiAgICAgICAgcmV0dXJuIF9maWxsUm9vdE5vZGVDaGlsZHMuYXBwbHkodGhpcywgYXJndW1lbnRzKTsKICAgICAgfQoKICAgICAgcmV0dXJuIGZpbGxSb290Tm9kZUNoaWxkczsKICAgIH0oKQogICAgLyoqDQogICAgICog5aSE55CG5Luj56CB6KGo6L+U5Zue5pWw5o2uKOagkeeKtue7k+aehCkNCiAgICAgKg0KICAgICAqIEBwYXJhbSByZXN1bHQg6L+U5Zue5pWw57uEDQogICAgICogQHBhcmFtIGNvbnRleHQg5bqU55So5LiK5LiL5paHDQogICAgICogQHBhcmFtIGNhbGxCYWNrIOWbnuiwgw0KICAgICAqIEBtZW1iZXJvZiBQRVJTT05JTkZPVFJFRVNlcnZpY2UNCiAgICAgKi8KCiAgfSwgewogICAga2V5OiAiaGFuZGxlRGF0YVNldCIsCiAgICB2YWx1ZTogZnVuY3Rpb24gaGFuZGxlRGF0YVNldChyZXN1bHQsIGNvbnRleHQsIGNhbGxCYWNrKSB7CiAgICAgIHZhciBfdGhpczExID0gdGhpczsKCiAgICAgIHZhciBsaXN0ID0gW107CgogICAgICBpZiAocmVzdWx0Lmxlbmd0aCA9PT0gMCkgewogICAgICAgIHJldHVybiBsaXN0OwogICAgICB9CgogICAgICByZXN1bHQuZm9yRWFjaChmdW5jdGlvbiAoY29kZUl0ZW0pIHsKICAgICAgICBpZiAoIWNvZGVJdGVtLnB2YWx1ZSkgewogICAgICAgICAgdmFyIHZhbHVlRmllbGQgPSBjb2RlSXRlbS52YWx1ZTsKCiAgICAgICAgICBfdGhpczExLnNldENoaWxkQ29kZUl0ZW1zKHZhbHVlRmllbGQsIHJlc3VsdCwgY29kZUl0ZW0pOwoKICAgICAgICAgIGxpc3QucHVzaChjb2RlSXRlbSk7CiAgICAgICAgfQogICAgICB9KTsKICAgICAgdGhpcy5zZXROb2RlRGF0YShsaXN0LCBjb250ZXh0LCBjYWxsQmFjayk7CiAgICAgIHJldHVybiBsaXN0OwogICAgfQogICAgLyoqDQogICAgICog5aSE55CG6Z2e5qC56IqC54K55pWw5o2uDQogICAgICoNCiAgICAgKiBAcGFyYW0gcmVzdWx0IOi/lOWbnuaVsOe7hA0KICAgICAqIEBwYXJhbSBjb250ZXh0IOW6lOeUqOS4iuS4i+aWhw0KICAgICAqIEBwYXJhbSBjYWxsQmFjayDlm57osIMNCiAgICAgKiBAbWVtYmVyb2YgUEVSU09OSU5GT1RSRUVTZXJ2aWNlDQogICAgICovCgogIH0sIHsKICAgIGtleTogInNldENoaWxkQ29kZUl0ZW1zIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBzZXRDaGlsZENvZGVJdGVtcyhwVmFsdWUsIHJlc3VsdCwgY29kZUl0ZW0pIHsKICAgICAgdmFyIF90aGlzMTIgPSB0aGlzOwoKICAgICAgcmVzdWx0LmZvckVhY2goZnVuY3Rpb24gKGl0ZW0pIHsKICAgICAgICBpZiAoaXRlbS5wdmFsdWUgPT0gcFZhbHVlKSB7CiAgICAgICAgICB2YXIgdmFsdWVGaWVsZCA9IGl0ZW0udmFsdWU7CgogICAgICAgICAgX3RoaXMxMi5zZXRDaGlsZENvZGVJdGVtcyh2YWx1ZUZpZWxkLCByZXN1bHQsIGl0ZW0pOwoKICAgICAgICAgIGlmICghY29kZUl0ZW0uY2hpbGRyZW4pIHsKICAgICAgICAgICAgY29kZUl0ZW0uY2hpbGRyZW4gPSBbXTsKICAgICAgICAgIH0KCiAgICAgICAgICBjb2RlSXRlbS5jaGlsZHJlbi5wdXNoKGl0ZW0pOwogICAgICAgIH0KICAgICAgfSk7CiAgICB9CiAgICAvKioNCiAgICAgKiDorr7nva7oioLngrlVSeaVsOaNrg0KICAgICAqDQogICAgICogQHBhcmFtIHJlc3VsdCDov5Tlm57mlbDnu4QNCiAgICAgKiBAcGFyYW0gY29udGV4dCDlupTnlKjkuIrkuIvmlocNCiAgICAgKiBAcGFyYW0gY2FsbEJhY2sg5Zue6LCDDQogICAgICogQG1lbWJlcm9mIFBFUlNPTklORk9UUkVFU2VydmljZQ0KICAgICAqLwoKICB9LCB7CiAgICBrZXk6ICJzZXROb2RlRGF0YSIsCiAgICB2YWx1ZTogZnVuY3Rpb24gc2V0Tm9kZURhdGEocmVzdWx0LCBjb250ZXh0LCBjYWxsQmFjaykgewogICAgICB2YXIgX3RoaXMxMyA9IHRoaXM7CgogICAgICByZXN1bHQuZm9yRWFjaChmdW5jdGlvbiAoaXRlbSkgewogICAgICAgIGlmIChpdGVtLmNoaWxkcmVuKSB7CiAgICAgICAgICBpdGVtLmxlYWYgPSBmYWxzZTsKCiAgICAgICAgICBfdGhpczEzLnNldE5vZGVEYXRhKGl0ZW0uY2hpbGRyZW4sIGNvbnRleHQsIGNhbGxCYWNrKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgaXRlbS5sZWFmID0gdHJ1ZTsKICAgICAgICB9CgogICAgICAgIGNhbGxCYWNrKGNvbnRleHQsIGl0ZW0pOwogICAgICB9KTsKICAgIH0KICAgIC8qKg0KICAgICAqIOWkhOeQhuiKgueCueWFs+ezu+WvvOiIquS4iuS4i+aWhw0KICAgICAqDQogICAgICogQHBhcmFtIGNvbnRleHQg5bqU55So5LiK5LiL5paHDQogICAgICogQHBhcmFtIGZpbHRlciDlj4LmlbANCiAgICAgKiBAcGFyYW0gcmVzTmF2Q29udGV4dCDoioLngrnlhbPns7vlr7zoiKrkuIrkuIvmlocNCiAgICAgKg0KICAgICAqIEBtZW1iZXJvZiBQRVJTT05JTkZPVFJFRVNlcnZpY2UNCiAgICAgKi8KCiAgfSwgewogICAga2V5OiAiaGFuZGxlUmVzTmF2Q29udGV4dCIsCiAgICB2YWx1ZTogZnVuY3Rpb24gaGFuZGxlUmVzTmF2Q29udGV4dChjb250ZXh0LCBmaWx0ZXIsIHJlc05hdkNvbnRleHQpIHsKICAgICAgdmFyIF90aGlzMTQgPSB0aGlzOwoKICAgICAgaWYgKHJlc05hdkNvbnRleHQgJiYgT2JqZWN0LmtleXMocmVzTmF2Q29udGV4dCkubGVuZ3RoID4gMCkgewogICAgICAgIHZhciB0ZW1wQ29udGV4dERhdGEgPSBKU09OLnBhcnNlKEpTT04uc3RyaW5naWZ5KGNvbnRleHQpKTsKICAgICAgICB2YXIgdGVtcFZpZXdQYXJhbXMgPSB7fTsKCiAgICAgICAgaWYgKGZpbHRlciAmJiBmaWx0ZXIudmlld3BhcmFtcykgewogICAgICAgICAgdGVtcFZpZXdQYXJhbXMgPSBmaWx0ZXIudmlld3BhcmFtczsKICAgICAgICB9CgogICAgICAgIE9iamVjdC5rZXlzKHJlc05hdkNvbnRleHQpLmZvckVhY2goZnVuY3Rpb24gKGl0ZW0pIHsKICAgICAgICAgIHZhciBjdXJEYXRhT2JqID0gcmVzTmF2Q29udGV4dFtpdGVtXTsKCiAgICAgICAgICBfdGhpczE0LmhhbmRsZUN1c3RvbURhdGFMb2dpYyhjb250ZXh0LCB0ZW1wVmlld1BhcmFtcywgY3VyRGF0YU9iaiwgdGVtcENvbnRleHREYXRhLCBpdGVtKTsKICAgICAgICB9KTsKICAgICAgICByZXR1cm4gdGVtcENvbnRleHREYXRhOwogICAgICB9IGVsc2UgewogICAgICAgIHJldHVybiBjb250ZXh0OwogICAgICB9CiAgICB9CiAgICAvKioNCiAgICAgKiDlpITnkIblhbPns7vlr7zoiKrlj4LmlbANCiAgICAgKg0KICAgICAqIEBwYXJhbSBjb250ZXh0IOW6lOeUqOS4iuS4i+aWhw0KICAgICAqIEBwYXJhbSBmaWx0ZXIg5Y+C5pWwDQogICAgICogQHBhcmFtIHJlc05hdlBhcmFtcyDoioLngrnlhbPns7vlr7zoiKrlj4LmlbANCiAgICAgKiBAcGFyYW0gcmVzUGFyYW1zIOiKgueCueWFs+ezu+WPguaVsA0KICAgICAqDQogICAgICogQG1lbWJlcm9mIFBFUlNPTklORk9UUkVFU2VydmljZQ0KICAgICAqLwoKICB9LCB7CiAgICBrZXk6ICJoYW5kbGVSZXNOYXZQYXJhbXMiLAogICAgdmFsdWU6IGZ1bmN0aW9uIGhhbmRsZVJlc05hdlBhcmFtcyhjb250ZXh0LCBmaWx0ZXIsIHJlc05hdlBhcmFtcywgcmVzUGFyYW1zKSB7CiAgICAgIHZhciBfdGhpczE1ID0gdGhpczsKCiAgICAgIGlmIChyZXNOYXZQYXJhbXMgJiYgT2JqZWN0LmtleXMocmVzTmF2UGFyYW1zKS5sZW5ndGggPiAwIHx8IHJlc1BhcmFtcyAmJiBPYmplY3Qua2V5cyhyZXNQYXJhbXMpLmxlbmd0aCA+IDApIHsKICAgICAgICB2YXIgdGVtcFZpZXdQYXJhbURhdGEgPSB7fTsKICAgICAgICB2YXIgdGVtcFZpZXdQYXJhbXMgPSB7fTsKCiAgICAgICAgaWYgKGZpbHRlciAmJiBmaWx0ZXIudmlld3BhcmFtcykgewogICAgICAgICAgdGVtcFZpZXdQYXJhbXMgPSBmaWx0ZXIudmlld3BhcmFtczsKICAgICAgICAgIHRlbXBWaWV3UGFyYW1EYXRhID0gSlNPTi5wYXJzZShKU09OLnN0cmluZ2lmeShmaWx0ZXIudmlld3BhcmFtcykpOwogICAgICAgIH0KCiAgICAgICAgaWYgKE9iamVjdC5rZXlzKHJlc05hdlBhcmFtcykubGVuZ3RoID4gMCkgewogICAgICAgICAgT2JqZWN0LmtleXMocmVzTmF2UGFyYW1zKS5mb3JFYWNoKGZ1bmN0aW9uIChpdGVtKSB7CiAgICAgICAgICAgIHZhciBjdXJEYXRhT2JqID0gcmVzTmF2UGFyYW1zW2l0ZW1dOwoKICAgICAgICAgICAgX3RoaXMxNS5oYW5kbGVDdXN0b21EYXRhTG9naWMoY29udGV4dCwgdGVtcFZpZXdQYXJhbXMsIGN1ckRhdGFPYmosIHRlbXBWaWV3UGFyYW1EYXRhLCBpdGVtKTsKICAgICAgICAgIH0pOwogICAgICAgIH0KCiAgICAgICAgaWYgKE9iamVjdC5rZXlzKHJlc1BhcmFtcykubGVuZ3RoID4gMCkgewogICAgICAgICAgT2JqZWN0LmtleXMocmVzUGFyYW1zKS5mb3JFYWNoKGZ1bmN0aW9uIChpdGVtKSB7CiAgICAgICAgICAgIHZhciBjdXJEYXRhT2JqID0gcmVzUGFyYW1zW2l0ZW1dOwogICAgICAgICAgICB0ZW1wVmlld1BhcmFtRGF0YVtpdGVtLnRvTG93ZXJDYXNlKCldID0gY3VyRGF0YU9iai52YWx1ZTsKICAgICAgICAgIH0pOwogICAgICAgIH0KCiAgICAgICAgT2JqZWN0LmFzc2lnbihmaWx0ZXIsIHsKICAgICAgICAgIHZpZXdwYXJhbXM6IHRlbXBWaWV3UGFyYW1EYXRhCiAgICAgICAgfSk7CiAgICAgICAgcmV0dXJuIGZpbHRlcjsKICAgICAgfSBlbHNlIHsKICAgICAgICByZXR1cm4gZmlsdGVyOwogICAgICB9CiAgICB9CiAgICAvKioNCiAgICAgKiDlpITnkIboh6rlrprkuYnoioLngrnlhbPns7vlr7zoiKrmlbDmja4NCiAgICAgKg0KICAgICAqIEBwYXJhbSBjb250ZXh0IOW6lOeUqOS4iuS4i+aWhw0KICAgICAqIEBwYXJhbSB2aWV3cGFyYW1zIOWPguaVsA0KICAgICAqIEBwYXJhbSBjdXJOYXZEYXRhIOiKgueCueWFs+ezu+WvvOiIquWPguaVsOWvueixoQ0KICAgICAqIEBwYXJhbSB0ZW1wRGF0YSDov5Tlm57mlbDmja4NCiAgICAgKiBAcGFyYW0gaXRlbSDoioLngrnlhbPns7vlr7zoiKrlj4LmlbDplK7lgLwNCiAgICAgKg0KICAgICAqIEBtZW1iZXJvZiBQRVJTT05JTkZPVFJFRVNlcnZpY2UNCiAgICAgKi8KCiAgfSwgewogICAga2V5OiAiaGFuZGxlQ3VzdG9tRGF0YUxvZ2ljIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBoYW5kbGVDdXN0b21EYXRhTG9naWMoY29udGV4dCwgdmlld3BhcmFtcywgY3VyTmF2RGF0YSwgdGVtcERhdGEsIGl0ZW0pIHsKICAgICAgLy8g55u05o6l5YC855u05o6l6LWL5YC8CiAgICAgIGlmIChjdXJOYXZEYXRhLmlzUmF3VmFsdWUpIHsKICAgICAgICBpZiAoT2JqZWN0LmlzKGN1ck5hdkRhdGEudmFsdWUsICJudWxsIikgfHwgT2JqZWN0LmlzKGN1ck5hdkRhdGEudmFsdWUsICIiKSkgewogICAgICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KHRlbXBEYXRhLCBpdGVtLnRvTG93ZXJDYXNlKCksIHsKICAgICAgICAgICAgdmFsdWU6IG51bGwsCiAgICAgICAgICAgIHdyaXRhYmxlOiB0cnVlLAogICAgICAgICAgICBlbnVtZXJhYmxlOiB0cnVlLAogICAgICAgICAgICBjb25maWd1cmFibGU6IHRydWUKICAgICAgICAgIH0pOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkodGVtcERhdGEsIGl0ZW0udG9Mb3dlckNhc2UoKSwgewogICAgICAgICAgICB2YWx1ZTogY3VyTmF2RGF0YS52YWx1ZSwKICAgICAgICAgICAgd3JpdGFibGU6IHRydWUsCiAgICAgICAgICAgIGVudW1lcmFibGU6IHRydWUsCiAgICAgICAgICAgIGNvbmZpZ3VyYWJsZTogdHJ1ZQogICAgICAgICAgfSk7CiAgICAgICAgfQogICAgICB9IGVsc2UgewogICAgICAgIC8vIOWFiOS7juWvvOiIquS4iuS4i+aWh+WPluaVsO+8jOayoeacieWGjeS7juWvvOiIquWPguaVsO+8iFVSTO+8ieWPluaVsO+8jOWmguaenOWvvOiIquS4iuS4i+aWh+WSjOWvvOiIquWPguaVsOmDveayoeacieWImeS4um51bGwKICAgICAgICBpZiAoY29udGV4dFtjdXJOYXZEYXRhLnZhbHVlLnRvTG93ZXJDYXNlKCldKSB7CiAgICAgICAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkodGVtcERhdGEsIGl0ZW0udG9Mb3dlckNhc2UoKSwgewogICAgICAgICAgICB2YWx1ZTogY29udGV4dFtjdXJOYXZEYXRhLnZhbHVlLnRvTG93ZXJDYXNlKCldLAogICAgICAgICAgICB3cml0YWJsZTogdHJ1ZSwKICAgICAgICAgICAgZW51bWVyYWJsZTogdHJ1ZSwKICAgICAgICAgICAgY29uZmlndXJhYmxlOiB0cnVlCiAgICAgICAgICB9KTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgaWYgKHZpZXdwYXJhbXNbY3VyTmF2RGF0YS52YWx1ZS50b0xvd2VyQ2FzZSgpXSkgewogICAgICAgICAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkodGVtcERhdGEsIGl0ZW0udG9Mb3dlckNhc2UoKSwgewogICAgICAgICAgICAgIHZhbHVlOiB2aWV3cGFyYW1zW2N1ck5hdkRhdGEudmFsdWUudG9Mb3dlckNhc2UoKV0sCiAgICAgICAgICAgICAgd3JpdGFibGU6IHRydWUsCiAgICAgICAgICAgICAgZW51bWVyYWJsZTogdHJ1ZSwKICAgICAgICAgICAgICBjb25maWd1cmFibGU6IHRydWUKICAgICAgICAgICAgfSk7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkodGVtcERhdGEsIGl0ZW0udG9Mb3dlckNhc2UoKSwgewogICAgICAgICAgICAgIHZhbHVlOiBudWxsLAogICAgICAgICAgICAgIHdyaXRhYmxlOiB0cnVlLAogICAgICAgICAgICAgIGVudW1lcmFibGU6IHRydWUsCiAgICAgICAgICAgICAgY29uZmlndXJhYmxlOiB0cnVlCiAgICAgICAgICAgIH0pOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfQogICAgfQogIH1dKTsKCiAgcmV0dXJuIFBFUlNPTklORk9UUkVFU2VydmljZTsKfShDb250cm9sU2VydmljZSk7CgpleHBvcnQgeyBQRVJTT05JTkZPVFJFRVNlcnZpY2UgYXMgZGVmYXVsdCB9OwoKdHNsaWJfMS5fX2RlY29yYXRlKFtFcnJvcmxvZ10sIFBFUlNPTklORk9UUkVFU2VydmljZS5wcm90b3R5cGUsICJnZXROb2RlcyIsIG51bGwpOwoKdHNsaWJfMS5fX2RlY29yYXRlKFtFcnJvcmxvZ10sIFBFUlNPTklORk9UUkVFU2VydmljZS5wcm90b3R5cGUsICJmaWxsT3Jtb3JnaW5mb05vZGVzIiwgbnVsbCk7Cgp0c2xpYl8xLl9fZGVjb3JhdGUoW0Vycm9ybG9nXSwgUEVSU09OSU5GT1RSRUVTZXJ2aWNlLnByb3RvdHlwZSwgInNlYXJjaE9ybW9yZ2luZm8iLCBudWxsKTsKCnRzbGliXzEuX19kZWNvcmF0ZShbRXJyb3Jsb2ddLCBQRVJTT05JTkZPVFJFRVNlcnZpY2UucHJvdG90eXBlLCAiZmlsbE9ybW9yZ2luZm9Ob2RlQ2hpbGRzIiwgbnVsbCk7Cgp0c2xpYl8xLl9fZGVjb3JhdGUoW0Vycm9ybG9nXSwgUEVSU09OSU5GT1RSRUVTZXJ2aWNlLnByb3RvdHlwZSwgImZpbGxTdWJvcm1vcmdpbmZvTm9kZXMiLCBudWxsKTsKCnRzbGliXzEuX19kZWNvcmF0ZShbRXJyb3Jsb2ddLCBQRVJTT05JTkZPVFJFRVNlcnZpY2UucHJvdG90eXBlLCAic2VhcmNoU3Vib3Jtb3JnaW5mbyIsIG51bGwpOwoKdHNsaWJfMS5fX2RlY29yYXRlKFtFcnJvcmxvZ10sIFBFUlNPTklORk9UUkVFU2VydmljZS5wcm90b3R5cGUsICJmaWxsU3Vib3Jtb3JnaW5mb05vZGVDaGlsZHMiLCBudWxsKTsKCnRzbGliXzEuX19kZWNvcmF0ZShbRXJyb3Jsb2ddLCBQRVJTT05JTkZPVFJFRVNlcnZpY2UucHJvdG90eXBlLCAiZmlsbFN1YnN1Ym9ybW9yZ2luZm9Ob2RlcyIsIG51bGwpOwoKdHNsaWJfMS5fX2RlY29yYXRlKFtFcnJvcmxvZ10sIFBFUlNPTklORk9UUkVFU2VydmljZS5wcm90b3R5cGUsICJzZWFyY2hTdWJzdWJvcm1vcmdpbmZvIiwgbnVsbCk7Cgp0c2xpYl8xLl9fZGVjb3JhdGUoW0Vycm9ybG9nXSwgUEVSU09OSU5GT1RSRUVTZXJ2aWNlLnByb3RvdHlwZSwgImZpbGxTdWJzdWJvcm1vcmdpbmZvTm9kZUNoaWxkcyIsIG51bGwpOwoKdHNsaWJfMS5fX2RlY29yYXRlKFtFcnJvcmxvZ10sIFBFUlNPTklORk9UUkVFU2VydmljZS5wcm90b3R5cGUsICJmaWxsT3Jtb3Jnc2VjdG9yTm9kZXMiLCBudWxsKTsKCnRzbGliXzEuX19kZWNvcmF0ZShbRXJyb3Jsb2ddLCBQRVJTT05JTkZPVFJFRVNlcnZpY2UucHJvdG90eXBlLCAic2VhcmNoT3Jtb3Jnc2VjdG9yIiwgbnVsbCk7Cgp0c2xpYl8xLl9fZGVjb3JhdGUoW0Vycm9ybG9nXSwgUEVSU09OSU5GT1RSRUVTZXJ2aWNlLnByb3RvdHlwZSwgImZpbGxPcm1vcmdzZWN0b3JOb2RlQ2hpbGRzIiwgbnVsbCk7Cgp0c2xpYl8xLl9fZGVjb3JhdGUoW0Vycm9ybG9nXSwgUEVSU09OSU5GT1RSRUVTZXJ2aWNlLnByb3RvdHlwZSwgImZpbGxSb290Tm9kZXMiLCBudWxsKTsKCnRzbGliXzEuX19kZWNvcmF0ZShbRXJyb3Jsb2ddLCBQRVJTT05JTkZPVFJFRVNlcnZpY2UucHJvdG90eXBlLCAiZmlsbFJvb3ROb2RlQ2hpbGRzIiwgbnVsbCk7"},null]}
{"remainingRequest":"F:\\crod项目\\人事管理系统2\\iBizEHR\\app_EHRPim\\node_modules\\thread-loader\\dist\\cjs.js!F:\\crod项目\\人事管理系统2\\iBizEHR\\app_EHRPim\\node_modules\\babel-loader\\lib\\index.js!F:\\crod项目\\人事管理系统2\\iBizEHR\\app_EHRPim\\node_modules\\ts-loader\\index.js??ref--14-3!F:\\crod项目\\人事管理系统2\\iBizEHR\\app_EHRPim\\node_modules\\cache-loader\\dist\\cjs.js??ref--0-0!F:\\crod项目\\人事管理系统2\\iBizEHR\\app_EHRPim\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!F:\\crod项目\\人事管理系统2\\iBizEHR\\app_EHRPim\\src\\widgets\\pim-patent\\main-grid\\main-grid-base.vue?vue&type=script&lang=tsx&","dependencies":[{"path":"F:\\crod项目\\人事管理系统2\\iBizEHR\\app_EHRPim\\src\\widgets\\pim-patent\\main-grid\\main-grid-base.vue","mtime":1630509411801},{"path":"F:\\crod项目\\人事管理系统2\\iBizEHR\\app_EHRPim\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1630511852775},{"path":"F:\\crod项目\\人事管理系统2\\iBizEHR\\app_EHRPim\\node_modules\\thread-loader\\dist\\cjs.js","mtime":1630511853252},{"path":"F:\\crod项目\\人事管理系统2\\iBizEHR\\app_EHRPim\\node_modules\\babel-loader\\lib\\index.js","mtime":1630511852747},{"path":"F:\\crod项目\\人事管理系统2\\iBizEHR\\app_EHRPim\\node_modules\\ts-loader\\index.js","mtime":1630511985412},{"path":"F:\\crod项目\\人事管理系统2\\iBizEHR\\app_EHRPim\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1630511852775},{"path":"F:\\crod项目\\人事管理系统2\\iBizEHR\\app_EHRPim\\node_modules\\vue-loader\\lib\\index.js","mtime":1630512070338}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:aW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuc3ltYm9sIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuc3ltYm9sLmRlc2NyaXB0aW9uIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuc3ltYm9sLml0ZXJhdG9yIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkuZmlsdGVyIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkuZmluZCI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLmFycmF5LmZpbmQtaW5kZXgiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5hcnJheS5mb3ItZWFjaCI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLmFycmF5LmpvaW4iOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5hcnJheS5tYXAiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5hcnJheS5zb21lIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkuc3BsaWNlIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuZnVuY3Rpb24ubmFtZSI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLm9iamVjdC5kZWZpbmUtcHJvcGVydGllcyI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLm9iamVjdC5kZWZpbmUtcHJvcGVydHkiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5vYmplY3QuZ2V0LW93bi1wcm9wZXJ0eS1kZXNjcmlwdG9yIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMub2JqZWN0LmdldC1vd24tcHJvcGVydHktZGVzY3JpcHRvcnMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5vYmplY3QuaXMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5vYmplY3Qua2V5cyI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLm9iamVjdC50by1zdHJpbmciOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5wYXJzZS1pbnQiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5yZWdleHAuZXhlYyI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLnN0cmluZy5pdGVyYXRvciI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLnN0cmluZy5yZXBsYWNlIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuc3RyaW5nLnNlYXJjaCI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLnN0cmluZy5zcGxpdCI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL3dlYi5kb20tY29sbGVjdGlvbnMuZm9yLWVhY2giOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy93ZWIuZG9tLWNvbGxlY3Rpb25zLml0ZXJhdG9yIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvd2ViLnRpbWVycyI7CmltcG9ydCBfdG9Db25zdW1hYmxlQXJyYXkgZnJvbSAiRjpcXGNyb2RcdTk4NzlcdTc2RUVcXFx1NEVCQVx1NEU4Qlx1N0JBMVx1NzQwNlx1N0NGQlx1N0VERjJcXGlCaXpFSFJcXGFwcF9FSFJQaW1cXG5vZGVfbW9kdWxlc1xcQGJhYmVsXFxydW50aW1lL2hlbHBlcnMvZXNtL3RvQ29uc3VtYWJsZUFycmF5IjsKaW1wb3J0IF9kZWZpbmVQcm9wZXJ0eSBmcm9tICJGOlxcY3JvZFx1OTg3OVx1NzZFRVxcXHU0RUJBXHU0RThCXHU3QkExXHU3NDA2XHU3Q0ZCXHU3RURGMlxcaUJpekVIUlxcYXBwX0VIUlBpbVxcbm9kZV9tb2R1bGVzXFxAYmFiZWxcXHJ1bnRpbWUvaGVscGVycy9lc20vZGVmaW5lUHJvcGVydHkiOwppbXBvcnQgInJlZ2VuZXJhdG9yLXJ1bnRpbWUvcnVudGltZSI7CmltcG9ydCBfYXN5bmNUb0dlbmVyYXRvciBmcm9tICJGOlxcY3JvZFx1OTg3OVx1NzZFRVxcXHU0RUJBXHU0RThCXHU3QkExXHU3NDA2XHU3Q0ZCXHU3RURGMlxcaUJpekVIUlxcYXBwX0VIUlBpbVxcbm9kZV9tb2R1bGVzXFxAYmFiZWxcXHJ1bnRpbWUvaGVscGVycy9lc20vYXN5bmNUb0dlbmVyYXRvciI7CmltcG9ydCBfY2xhc3NDYWxsQ2hlY2sgZnJvbSAiRjpcXGNyb2RcdTk4NzlcdTc2RUVcXFx1NEVCQVx1NEU4Qlx1N0JBMVx1NzQwNlx1N0NGQlx1N0VERjJcXGlCaXpFSFJcXGFwcF9FSFJQaW1cXG5vZGVfbW9kdWxlc1xcQGJhYmVsXFxydW50aW1lL2hlbHBlcnMvZXNtL2NsYXNzQ2FsbENoZWNrIjsKaW1wb3J0IF9jcmVhdGVDbGFzcyBmcm9tICJGOlxcY3JvZFx1OTg3OVx1NzZFRVxcXHU0RUJBXHU0RThCXHU3QkExXHU3NDA2XHU3Q0ZCXHU3RURGMlxcaUJpekVIUlxcYXBwX0VIUlBpbVxcbm9kZV9tb2R1bGVzXFxAYmFiZWxcXHJ1bnRpbWUvaGVscGVycy9lc20vY3JlYXRlQ2xhc3MiOwppbXBvcnQgX3Bvc3NpYmxlQ29uc3RydWN0b3JSZXR1cm4gZnJvbSAiRjpcXGNyb2RcdTk4NzlcdTc2RUVcXFx1NEVCQVx1NEU4Qlx1N0JBMVx1NzQwNlx1N0NGQlx1N0VERjJcXGlCaXpFSFJcXGFwcF9FSFJQaW1cXG5vZGVfbW9kdWxlc1xcQGJhYmVsXFxydW50aW1lL2hlbHBlcnMvZXNtL3Bvc3NpYmxlQ29uc3RydWN0b3JSZXR1cm4iOwppbXBvcnQgX2dldFByb3RvdHlwZU9mIGZyb20gIkY6XFxjcm9kXHU5ODc5XHU3NkVFXFxcdTRFQkFcdTRFOEJcdTdCQTFcdTc0MDZcdTdDRkJcdTdFREYyXFxpQml6RUhSXFxhcHBfRUhSUGltXFxub2RlX21vZHVsZXNcXEBiYWJlbFxccnVudGltZS9oZWxwZXJzL2VzbS9nZXRQcm90b3R5cGVPZiI7CmltcG9ydCBfaW5oZXJpdHMgZnJvbSAiRjpcXGNyb2RcdTk4NzlcdTc2RUVcXFx1NEVCQVx1NEU4Qlx1N0JBMVx1NzQwNlx1N0NGQlx1N0VERjJcXGlCaXpFSFJcXGFwcF9FSFJQaW1cXG5vZGVfbW9kdWxlc1xcQGJhYmVsXFxydW50aW1lL2hlbHBlcnMvZXNtL2luaGVyaXRzIjsKCmZ1bmN0aW9uIG93bktleXMob2JqZWN0LCBlbnVtZXJhYmxlT25seSkgeyB2YXIga2V5cyA9IE9iamVjdC5rZXlzKG9iamVjdCk7IGlmIChPYmplY3QuZ2V0T3duUHJvcGVydHlTeW1ib2xzKSB7IHZhciBzeW1ib2xzID0gT2JqZWN0LmdldE93blByb3BlcnR5U3ltYm9scyhvYmplY3QpOyBpZiAoZW51bWVyYWJsZU9ubHkpIHN5bWJvbHMgPSBzeW1ib2xzLmZpbHRlcihmdW5jdGlvbiAoc3ltKSB7IHJldHVybiBPYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yKG9iamVjdCwgc3ltKS5lbnVtZXJhYmxlOyB9KTsga2V5cy5wdXNoLmFwcGx5KGtleXMsIHN5bWJvbHMpOyB9IHJldHVybiBrZXlzOyB9CgpmdW5jdGlvbiBfb2JqZWN0U3ByZWFkKHRhcmdldCkgeyBmb3IgKHZhciBpID0gMTsgaSA8IGFyZ3VtZW50cy5sZW5ndGg7IGkrKykgeyB2YXIgc291cmNlID0gYXJndW1lbnRzW2ldICE9IG51bGwgPyBhcmd1bWVudHNbaV0gOiB7fTsgaWYgKGkgJSAyKSB7IG93bktleXMoT2JqZWN0KHNvdXJjZSksIHRydWUpLmZvckVhY2goZnVuY3Rpb24gKGtleSkgeyBfZGVmaW5lUHJvcGVydHkodGFyZ2V0LCBrZXksIHNvdXJjZVtrZXldKTsgfSk7IH0gZWxzZSBpZiAoT2JqZWN0LmdldE93blByb3BlcnR5RGVzY3JpcHRvcnMpIHsgT2JqZWN0LmRlZmluZVByb3BlcnRpZXModGFyZ2V0LCBPYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9ycyhzb3VyY2UpKTsgfSBlbHNlIHsgb3duS2V5cyhPYmplY3Qoc291cmNlKSkuZm9yRWFjaChmdW5jdGlvbiAoa2V5KSB7IE9iamVjdC5kZWZpbmVQcm9wZXJ0eSh0YXJnZXQsIGtleSwgT2JqZWN0LmdldE93blByb3BlcnR5RGVzY3JpcHRvcihzb3VyY2UsIGtleSkpOyB9KTsgfSB9IHJldHVybiB0YXJnZXQ7IH0KCmltcG9ydCAqIGFzIHRzbGliXzEgZnJvbSAidHNsaWIiOwppbXBvcnQgeyBWdWUsIENvbXBvbmVudCwgUHJvcCwgV2F0Y2ggfSBmcm9tICd2dWUtcHJvcGVydHktZGVjb3JhdG9yJzsKaW1wb3J0IFBpbVBhdGVudFNlcnZpY2UgZnJvbSAnQC9zZXJ2aWNlL3BpbS1wYXRlbnQvcGltLXBhdGVudC1zZXJ2aWNlJzsKaW1wb3J0IE1haW5TZXJ2aWNlIGZyb20gJy4vbWFpbi1ncmlkLXNlcnZpY2UnOwppbXBvcnQgQ29kZUxpc3RTZXJ2aWNlIGZyb20gIkBzZXJ2aWNlL2FwcC9jb2RlbGlzdC1zZXJ2aWNlIjsKaW1wb3J0IHsgRm9ybUl0ZW1Nb2RlbCB9IGZyb20gJ0AvbW9kZWwvZm9ybS1kZXRhaWwnOwoKdmFyIE1haW5CYXNlID0KLyojX19QVVJFX18qLwpmdW5jdGlvbiAoX1Z1ZSkgewogIF9pbmhlcml0cyhNYWluQmFzZSwgX1Z1ZSk7CgogIGZ1bmN0aW9uIE1haW5CYXNlKCkgewogICAgdmFyIF90aGlzMjsKCiAgICBfY2xhc3NDYWxsQ2hlY2sodGhpcywgTWFpbkJhc2UpOwoKICAgIF90aGlzMiA9IF9wb3NzaWJsZUNvbnN0cnVjdG9yUmV0dXJuKHRoaXMsIF9nZXRQcm90b3R5cGVPZihNYWluQmFzZSkuYXBwbHkodGhpcywgYXJndW1lbnRzKSk7CiAgICAvKioNCiAgICAgKiDorqHmlbDlmajmnI3liqHlr7nosaHpm4blkIgNCiAgICAgKg0KICAgICAqIEB0eXBlIHtBcnJheTwqPn0NCiAgICAgKiBAbWVtYmVyb2YgTWFpbkJhc2UNCiAgICAgKi8KCiAgICBfdGhpczIuY291bnRlclNlcnZpY2VBcnJheSA9IFtdOwogICAgLyoqDQogICAgICog5bu65p6E6YOo5Lu25pyN5Yqh5a+56LGhDQogICAgICoNCiAgICAgKiBAdHlwZSB7TWFpblNlcnZpY2V9DQogICAgICogQG1lbWJlcm9mIE1haW5CYXNlDQogICAgICovCgogICAgX3RoaXMyLnNlcnZpY2UgPSBuZXcgTWFpblNlcnZpY2UoewogICAgICAkc3RvcmU6IF90aGlzMi4kc3RvcmUKICAgIH0pOwogICAgLyoqDQogICAgICog5a6e5L2T5pyN5Yqh5a+56LGhDQogICAgICoNCiAgICAgKiBAdHlwZSB7UGltUGF0ZW50U2VydmljZX0NCiAgICAgKiBAbWVtYmVyb2YgTWFpbkJhc2UNCiAgICAgKi8KCiAgICBfdGhpczIuYXBwRW50aXR5U2VydmljZSA9IG5ldyBQaW1QYXRlbnRTZXJ2aWNlKHsKICAgICAgJHN0b3JlOiBfdGhpczIuJHN0b3JlCiAgICB9KTsKICAgIC8qKg0KICAgICAqIOS7o+eggeihqOacjeWKoeWvueixoQ0KICAgICAqDQogICAgICogQHR5cGUge0NvZGVMaXN0U2VydmljZX0NCiAgICAgKiBAbWVtYmVyb2YgTWFpbkJhc2UNCiAgICAgKi8KCiAgICBfdGhpczIuY29kZUxpc3RTZXJ2aWNlID0gbmV3IENvZGVMaXN0U2VydmljZSh7CiAgICAgICRzdG9yZTogX3RoaXMyLiRzdG9yZQogICAgfSk7CiAgICAvKioNCiAgICAgKiDlvZPliY3pobUNCiAgICAgKg0KICAgICAqIEB0eXBlIHtudW1iZXJ9DQogICAgICogQG1lbWJlcm9mIE1haW5CYXNlDQogICAgICovCgogICAgX3RoaXMyLmN1clBhZ2UgPSAxOwogICAgLyoqDQogICAgICog5pWw5o2uDQogICAgICoNCiAgICAgKiBAdHlwZSB7YW55W119DQogICAgICogQG1lbWJlcm9mIE1haW5CYXNlDQogICAgICovCgogICAgX3RoaXMyLml0ZW1zID0gW107CiAgICAvKioNCiAgICAgKiDmmK/lkKbmlK/mjIHliIbpobUNCiAgICAgKg0KICAgICAqIEB0eXBlIHtib29sZWFufQ0KICAgICAqIEBtZW1iZXJvZiBNYWluQmFzZQ0KICAgICAqLwoKICAgIF90aGlzMi5pc0VuYWJsZVBhZ2luZ0JhciA9IGZhbHNlOwogICAgLyoqDQogICAgICog5piv5ZCm56aB55So5o6S5bqPDQogICAgICoNCiAgICAgKiBAdHlwZSB7Ym9vbGVhbn0NCiAgICAgKiBAbWVtYmVyb2YgTWFpbkJhc2UNCiAgICAgKi8KCiAgICBfdGhpczIuaXNOb1NvcnQgPSBmYWxzZTsKICAgIC8qKg0KICAgICAqIOaOkuW6j+aWueWQkQ0KICAgICAqDQogICAgICogQHR5cGUge3N0cmluZ30NCiAgICAgKiBAbWVtYmVyb2YgTWFpbkJhc2UNCiAgICAgKi8KCiAgICBfdGhpczIubWlub3JTb3J0RGlyID0gJ0RFU0MnOwogICAgLyoqDQogICAgICog5o6S5bqP5a2X5q61DQogICAgICoNCiAgICAgKiBAdHlwZSB7c3RyaW5nfQ0KICAgICAqIEBtZW1iZXJvZiBNYWluQmFzZQ0KICAgICAqLwoKICAgIF90aGlzMi5taW5vclNvcnRQU0RFRiA9ICd6bGhxc2onOwogICAgLyoqDQogICAgICog5YiG6aG15p2h5pWwDQogICAgICoNCiAgICAgKiBAdHlwZSB7bnVtYmVyfQ0KICAgICAqIEBtZW1iZXJvZiBNYWluQmFzZQ0KICAgICAqLwoKICAgIF90aGlzMi5saW1pdCA9IDIwOwogICAgLyoqDQogICAgICog5piv5ZCm5pi+56S65qCH6aKYDQogICAgICoNCiAgICAgKiBAdHlwZSB7Ym9vbGVhbn0NCiAgICAgKiBAbWVtYmVyb2YgTWFpbkJhc2UNCiAgICAgKi8KCiAgICBfdGhpczIuaXNIaWRlSGVhZGVyID0gZmFsc2U7CiAgICAvKioNCiAgICAgKiDlrp7pmYXmmK/lkKblvIDlkK/ooYznvJbovpENCiAgICAgKg0KICAgICAqIEB0eXBlIHtib29sZWFufQ0KICAgICAqIEBtZW1iZXJvZiBNYWluQmFzZQ0KICAgICAqLwoKICAgIF90aGlzMi5hY3R1YWxJc09wZW5FZGl0ID0gX3RoaXMyLmlzT3BlbkVkaXQ7CiAgICAvKioNCiAgICAgKiDmgLvmnaHmlbANCiAgICAgKg0KICAgICAqIEB0eXBlIHtudW1iZXJ9DQogICAgICogQG1lbWJlcm9mIE1haW5CYXNlDQogICAgICovCgogICAgX3RoaXMyLnRvdGFscm93ID0gMDsKICAgIC8qKg0KICAgICAqIOmAieS4reihjOaVsOaNrg0KICAgICAqDQogICAgICogQHR5cGUge2FueVtdfQ0KICAgICAqIEBtZW1iZXJvZiBNYWluDQogICAgICovCgogICAgX3RoaXMyLnNlbGVjdGlvbnMgPSBbXTsKICAgIC8qKg0KICAgICAqIOaLpuaIquihjOmAieS4rQ0KICAgICAqDQogICAgICogQHR5cGUge2Jvb2xlYW59DQogICAgICogQG1lbWJlcm9mIE1haW4NCiAgICAgKi8KCiAgICBfdGhpczIuc3RvcFJvd0NsaWNrID0gZmFsc2U7CiAgICAvKioNCiAgICAgKiDooajmoLzmmK/lkKbmmL7npLoNCiAgICAgKg0KICAgICAqIEB0eXBlIHtib29sZWFufQ0KICAgICAqIEBtZW1iZXJvZiBNYWluQmFzZQ0KICAgICAqLwoKICAgIF90aGlzMi5pc0Rpc3BsYXkgPSB0cnVlOwogICAgLyoqDQogICAgKiDpgInpobnmoYbliJflrr0NCiAgICAqDQogICAgKiBAdHlwZSB7bnVtYmVyfQ0KICAgICogQG1lbWJlcm9mIEFwcEluZGV4DQogICAgKi8KCiAgICBfdGhpczIuY2hlY2tib3hDb2xXaWR0aCA9IDM0OwogICAgLyoqDQogICAgICog5piv5ZCm5YWB6K645ouW5Yqo5YiX5a69DQogICAgICoNCiAgICAgKiBAdHlwZSB7Ym9vbGVhbn0NCiAgICAgKiBAbWVtYmVyb2YgQXBwRW1iZWRQaWNrZXINCiAgICAgKi8KCiAgICBfdGhpczIuaXNEcmFnZW5kQ29sID0gZmFsc2U7CiAgICAvKioNCiAgICAgKiDmiYDmnInliJfmiJDlkZgNCiAgICAgKg0KICAgICAqIEB0eXBlIHthbnlbXX0NCiAgICAgKiBAbWVtYmVyb2YgTWFpbkJhc2UNCiAgICAgKi8KCiAgICBfdGhpczIuYWxsQ29sdW1ucyA9IFt7CiAgICAgIG5hbWU6ICd6bGgnLAogICAgICBsYWJlbDogJ+S4k+WIqeWPtygqKScsCiAgICAgIGxhbmd0YWc6ICdlbnRpdGllcy5waW1wYXRlbnQubWFpbl9ncmlkLmNvbHVtbnMuemxoJywKICAgICAgc2hvdzogdHJ1ZSwKICAgICAgdXRpbDogJ1BYJwogICAgfSwgewogICAgICBuYW1lOiAncGltcGF0ZW50bmFtZScsCiAgICAgIGxhYmVsOiAn5LiT5Yip5ZCN56ewKCopJywKICAgICAgbGFuZ3RhZzogJ2VudGl0aWVzLnBpbXBhdGVudC5tYWluX2dyaWQuY29sdW1ucy5waW1wYXRlbnRuYW1lJywKICAgICAgc2hvdzogdHJ1ZSwKICAgICAgdXRpbDogJ1BYJwogICAgfSwgewogICAgICBuYW1lOiAnemxocXNqJywKICAgICAgbGFiZWw6ICfkuJPliKnojrflj5bml7bpl7QoKiknLAogICAgICBsYW5ndGFnOiAnZW50aXRpZXMucGltcGF0ZW50Lm1haW5fZ3JpZC5jb2x1bW5zLnpsaHFzaicsCiAgICAgIHNob3c6IHRydWUsCiAgICAgIHV0aWw6ICdQWCcKICAgIH0sIHsKICAgICAgbmFtZTogJ3pscHpnYicsCiAgICAgIGxhYmVsOiAn5LiT5Yip5om55YeG5Zu95YirKCopJywKICAgICAgbGFuZ3RhZzogJ2VudGl0aWVzLnBpbXBhdGVudC5tYWluX2dyaWQuY29sdW1ucy56bHB6Z2InLAogICAgICBzaG93OiB0cnVlLAogICAgICB1dGlsOiAnUFgnCiAgICB9LCB7CiAgICAgIG5hbWU6ICdlbmNsb2x1cmUnLAogICAgICBsYWJlbDogJ+mZhOS7ticsCiAgICAgIGxhbmd0YWc6ICdlbnRpdGllcy5waW1wYXRlbnQubWFpbl9ncmlkLmNvbHVtbnMuZW5jbG9sdXJlJywKICAgICAgc2hvdzogdHJ1ZSwKICAgICAgdXRpbDogJ1BYJwogICAgfV07CiAgICAvKioNCiAgICAgKiDooajmoLzmqKHlnovpm4blkIgNCiAgICAgKg0KICAgICAqIEB0eXBlIHsqfQ0KICAgICAqIEBtZW1iZXJvZiBNYWluQmFzZQ0KICAgICAqLwoKICAgIF90aGlzMi5ncmlkSXRlbXNNb2RlbCA9IFtdOwogICAgLyoqDQogICAgICog5bGe5oCn5YC86KeE5YiZDQogICAgICoNCiAgICAgKiBAdHlwZSB7Kn0NCiAgICAgKiBAbWVtYmVyb2YgTWFpbkJhc2UNCiAgICAgKi8KCiAgICBfdGhpczIucnVsZXMgPSB7CiAgICAgIGpsY3p6OiBbewogICAgICAgIHJlcXVpcmVkOiBmYWxzZSwKICAgICAgICB2YWxpZGF0b3I6IGZ1bmN0aW9uIHZhbGlkYXRvcihydWxlLCB2YWx1ZSwgY2FsbGJhY2spIHsKICAgICAgICAgIHJldHVybiBydWxlLnJlcXVpcmVkICYmICh2YWx1ZSA9PT0gbnVsbCB8fCB2YWx1ZSA9PT0gdW5kZWZpbmVkIHx8IHZhbHVlID09PSAiIikgPyBmYWxzZSA6IHRydWU7CiAgICAgICAgfSwKICAgICAgICBtZXNzYWdlOiAn6K6w5b2V5pON5L2c6ICFIOWAvOS4jeiDveS4uuepuicsCiAgICAgICAgdHJpZ2dlcjogJ2NoYW5nZScKICAgICAgfSwgewogICAgICAgIHJlcXVpcmVkOiBmYWxzZSwKICAgICAgICB2YWxpZGF0b3I6IGZ1bmN0aW9uIHZhbGlkYXRvcihydWxlLCB2YWx1ZSwgY2FsbGJhY2spIHsKICAgICAgICAgIHJldHVybiBydWxlLnJlcXVpcmVkICYmICh2YWx1ZSA9PT0gbnVsbCB8fCB2YWx1ZSA9PT0gdW5kZWZpbmVkIHx8IHZhbHVlID09PSAiIikgPyBmYWxzZSA6IHRydWU7CiAgICAgICAgfSwKICAgICAgICBtZXNzYWdlOiAn6K6w5b2V5pON5L2c6ICFIOWAvOS4jeiDveS4uuepuicsCiAgICAgICAgdHJpZ2dlcjogJ2JsdXInCiAgICAgIH1dLAogICAgICB6bGhxc2o6IFt7CiAgICAgICAgcmVxdWlyZWQ6IHRydWUsCiAgICAgICAgdmFsaWRhdG9yOiBmdW5jdGlvbiB2YWxpZGF0b3IocnVsZSwgdmFsdWUsIGNhbGxiYWNrKSB7CiAgICAgICAgICByZXR1cm4gcnVsZS5yZXF1aXJlZCAmJiAodmFsdWUgPT09IG51bGwgfHwgdmFsdWUgPT09IHVuZGVmaW5lZCB8fCB2YWx1ZSA9PT0gIiIpID8gZmFsc2UgOiB0cnVlOwogICAgICAgIH0sCiAgICAgICAgbWVzc2FnZTogJ+S4k+WIqeiOt+WPluaXtumXtCgqKSDlgLzkuI3og73kuLrnqbonLAogICAgICAgIHRyaWdnZXI6ICdjaGFuZ2UnCiAgICAgIH0sIHsKICAgICAgICByZXF1aXJlZDogdHJ1ZSwKICAgICAgICB2YWxpZGF0b3I6IGZ1bmN0aW9uIHZhbGlkYXRvcihydWxlLCB2YWx1ZSwgY2FsbGJhY2spIHsKICAgICAgICAgIHJldHVybiBydWxlLnJlcXVpcmVkICYmICh2YWx1ZSA9PT0gbnVsbCB8fCB2YWx1ZSA9PT0gdW5kZWZpbmVkIHx8IHZhbHVlID09PSAiIikgPyBmYWxzZSA6IHRydWU7CiAgICAgICAgfSwKICAgICAgICBtZXNzYWdlOiAn5LiT5Yip6I635Y+W5pe26Ze0KCopIOWAvOS4jeiDveS4uuepuicsCiAgICAgICAgdHJpZ2dlcjogJ2JsdXInCiAgICAgIH1dLAogICAgICB6bGg6IFt7CiAgICAgICAgcmVxdWlyZWQ6IHRydWUsCiAgICAgICAgdmFsaWRhdG9yOiBmdW5jdGlvbiB2YWxpZGF0b3IocnVsZSwgdmFsdWUsIGNhbGxiYWNrKSB7CiAgICAgICAgICByZXR1cm4gcnVsZS5yZXF1aXJlZCAmJiAodmFsdWUgPT09IG51bGwgfHwgdmFsdWUgPT09IHVuZGVmaW5lZCB8fCB2YWx1ZSA9PT0gIiIpID8gZmFsc2UgOiB0cnVlOwogICAgICAgIH0sCiAgICAgICAgbWVzc2FnZTogJ+S4k+WIqeWPtygqKSDlgLzkuI3og73kuLrnqbonLAogICAgICAgIHRyaWdnZXI6ICdjaGFuZ2UnCiAgICAgIH0sIHsKICAgICAgICByZXF1aXJlZDogdHJ1ZSwKICAgICAgICB2YWxpZGF0b3I6IGZ1bmN0aW9uIHZhbGlkYXRvcihydWxlLCB2YWx1ZSwgY2FsbGJhY2spIHsKICAgICAgICAgIHJldHVybiBydWxlLnJlcXVpcmVkICYmICh2YWx1ZSA9PT0gbnVsbCB8fCB2YWx1ZSA9PT0gdW5kZWZpbmVkIHx8IHZhbHVlID09PSAiIikgPyBmYWxzZSA6IHRydWU7CiAgICAgICAgfSwKICAgICAgICBtZXNzYWdlOiAn5LiT5Yip5Y+3KCopIOWAvOS4jeiDveS4uuepuicsCiAgICAgICAgdHJpZ2dlcjogJ2JsdXInCiAgICAgIH1dLAogICAgICBwaW1wYXRlbnRuYW1lOiBbewogICAgICAgIHJlcXVpcmVkOiB0cnVlLAogICAgICAgIHZhbGlkYXRvcjogZnVuY3Rpb24gdmFsaWRhdG9yKHJ1bGUsIHZhbHVlLCBjYWxsYmFjaykgewogICAgICAgICAgcmV0dXJuIHJ1bGUucmVxdWlyZWQgJiYgKHZhbHVlID09PSBudWxsIHx8IHZhbHVlID09PSB1bmRlZmluZWQgfHwgdmFsdWUgPT09ICIiKSA/IGZhbHNlIDogdHJ1ZTsKICAgICAgICB9LAogICAgICAgIG1lc3NhZ2U6ICfkuJPliKnlkI3np7AoKikg5YC85LiN6IO95Li656m6JywKICAgICAgICB0cmlnZ2VyOiAnY2hhbmdlJwogICAgICB9LCB7CiAgICAgICAgcmVxdWlyZWQ6IHRydWUsCiAgICAgICAgdmFsaWRhdG9yOiBmdW5jdGlvbiB2YWxpZGF0b3IocnVsZSwgdmFsdWUsIGNhbGxiYWNrKSB7CiAgICAgICAgICByZXR1cm4gcnVsZS5yZXF1aXJlZCAmJiAodmFsdWUgPT09IG51bGwgfHwgdmFsdWUgPT09IHVuZGVmaW5lZCB8fCB2YWx1ZSA9PT0gIiIpID8gZmFsc2UgOiB0cnVlOwogICAgICAgIH0sCiAgICAgICAgbWVzc2FnZTogJ+S4k+WIqeWQjeensCgqKSDlgLzkuI3og73kuLrnqbonLAogICAgICAgIHRyaWdnZXI6ICdibHVyJwogICAgICB9XSwKICAgICAgcGltcGVyc29uaWQ6IFt7CiAgICAgICAgcmVxdWlyZWQ6IGZhbHNlLAogICAgICAgIHZhbGlkYXRvcjogZnVuY3Rpb24gdmFsaWRhdG9yKHJ1bGUsIHZhbHVlLCBjYWxsYmFjaykgewogICAgICAgICAgcmV0dXJuIHJ1bGUucmVxdWlyZWQgJiYgKHZhbHVlID09PSBudWxsIHx8IHZhbHVlID09PSB1bmRlZmluZWQgfHwgdmFsdWUgPT09ICIiKSA/IGZhbHNlIDogdHJ1ZTsKICAgICAgICB9LAogICAgICAgIG1lc3NhZ2U6ICfkurrlkZjkv6Hmga/moIfor4Yg5YC85LiN6IO95Li656m6JywKICAgICAgICB0cmlnZ2VyOiAnY2hhbmdlJwogICAgICB9LCB7CiAgICAgICAgcmVxdWlyZWQ6IGZhbHNlLAogICAgICAgIHZhbGlkYXRvcjogZnVuY3Rpb24gdmFsaWRhdG9yKHJ1bGUsIHZhbHVlLCBjYWxsYmFjaykgewogICAgICAgICAgcmV0dXJuIHJ1bGUucmVxdWlyZWQgJiYgKHZhbHVlID09PSBudWxsIHx8IHZhbHVlID09PSB1bmRlZmluZWQgfHwgdmFsdWUgPT09ICIiKSA/IGZhbHNlIDogdHJ1ZTsKICAgICAgICB9LAogICAgICAgIG1lc3NhZ2U6ICfkurrlkZjkv6Hmga/moIfor4Yg5YC85LiN6IO95Li656m6JywKICAgICAgICB0cmlnZ2VyOiAnYmx1cicKICAgICAgfV0sCiAgICAgIHpscHpnYjogW3sKICAgICAgICByZXF1aXJlZDogdHJ1ZSwKICAgICAgICB2YWxpZGF0b3I6IGZ1bmN0aW9uIHZhbGlkYXRvcihydWxlLCB2YWx1ZSwgY2FsbGJhY2spIHsKICAgICAgICAgIHJldHVybiBydWxlLnJlcXVpcmVkICYmICh2YWx1ZSA9PT0gbnVsbCB8fCB2YWx1ZSA9PT0gdW5kZWZpbmVkIHx8IHZhbHVlID09PSAiIikgPyBmYWxzZSA6IHRydWU7CiAgICAgICAgfSwKICAgICAgICBtZXNzYWdlOiAn5LiT5Yip5om55YeG5Zu95YirKCopIOWAvOS4jeiDveS4uuepuicsCiAgICAgICAgdHJpZ2dlcjogJ2NoYW5nZScKICAgICAgfSwgewogICAgICAgIHJlcXVpcmVkOiB0cnVlLAogICAgICAgIHZhbGlkYXRvcjogZnVuY3Rpb24gdmFsaWRhdG9yKHJ1bGUsIHZhbHVlLCBjYWxsYmFjaykgewogICAgICAgICAgcmV0dXJuIHJ1bGUucmVxdWlyZWQgJiYgKHZhbHVlID09PSBudWxsIHx8IHZhbHVlID09PSB1bmRlZmluZWQgfHwgdmFsdWUgPT09ICIiKSA/IGZhbHNlIDogdHJ1ZTsKICAgICAgICB9LAogICAgICAgIG1lc3NhZ2U6ICfkuJPliKnmibnlh4blm73liKsoKikg5YC85LiN6IO95Li656m6JywKICAgICAgICB0cmlnZ2VyOiAnYmx1cicKICAgICAgfV0sCiAgICAgIHNyZmtleTogW3sKICAgICAgICByZXF1aXJlZDogZmFsc2UsCiAgICAgICAgdmFsaWRhdG9yOiBmdW5jdGlvbiB2YWxpZGF0b3IocnVsZSwgdmFsdWUsIGNhbGxiYWNrKSB7CiAgICAgICAgICByZXR1cm4gcnVsZS5yZXF1aXJlZCAmJiAodmFsdWUgPT09IG51bGwgfHwgdmFsdWUgPT09IHVuZGVmaW5lZCB8fCB2YWx1ZSA9PT0gIiIpID8gZmFsc2UgOiB0cnVlOwogICAgICAgIH0sCiAgICAgICAgbWVzc2FnZTogJ+S4k+WIqeS/oeaBr+e8lueggSDlgLzkuI3og73kuLrnqbonLAogICAgICAgIHRyaWdnZXI6ICdjaGFuZ2UnCiAgICAgIH0sIHsKICAgICAgICByZXF1aXJlZDogZmFsc2UsCiAgICAgICAgdmFsaWRhdG9yOiBmdW5jdGlvbiB2YWxpZGF0b3IocnVsZSwgdmFsdWUsIGNhbGxiYWNrKSB7CiAgICAgICAgICByZXR1cm4gcnVsZS5yZXF1aXJlZCAmJiAodmFsdWUgPT09IG51bGwgfHwgdmFsdWUgPT09IHVuZGVmaW5lZCB8fCB2YWx1ZSA9PT0gIiIpID8gZmFsc2UgOiB0cnVlOwogICAgICAgIH0sCiAgICAgICAgbWVzc2FnZTogJ+S4k+WIqeS/oeaBr+e8lueggSDlgLzkuI3og73kuLrnqbonLAogICAgICAgIHRyaWdnZXI6ICdibHVyJwogICAgICB9XSwKICAgICAgZW5jbG9sdXJlOiBbewogICAgICAgIHJlcXVpcmVkOiBmYWxzZSwKICAgICAgICB2YWxpZGF0b3I6IGZ1bmN0aW9uIHZhbGlkYXRvcihydWxlLCB2YWx1ZSwgY2FsbGJhY2spIHsKICAgICAgICAgIHJldHVybiBydWxlLnJlcXVpcmVkICYmICh2YWx1ZSA9PT0gbnVsbCB8fCB2YWx1ZSA9PT0gdW5kZWZpbmVkIHx8IHZhbHVlID09PSAiIikgPyBmYWxzZSA6IHRydWU7CiAgICAgICAgfSwKICAgICAgICBtZXNzYWdlOiAn6ZmE5Lu2IOWAvOS4jeiDveS4uuepuicsCiAgICAgICAgdHJpZ2dlcjogJ2NoYW5nZScKICAgICAgfSwgewogICAgICAgIHJlcXVpcmVkOiBmYWxzZSwKICAgICAgICB2YWxpZGF0b3I6IGZ1bmN0aW9uIHZhbGlkYXRvcihydWxlLCB2YWx1ZSwgY2FsbGJhY2spIHsKICAgICAgICAgIHJldHVybiBydWxlLnJlcXVpcmVkICYmICh2YWx1ZSA9PT0gbnVsbCB8fCB2YWx1ZSA9PT0gdW5kZWZpbmVkIHx8IHZhbHVlID09PSAiIikgPyBmYWxzZSA6IHRydWU7CiAgICAgICAgfSwKICAgICAgICBtZXNzYWdlOiAn6ZmE5Lu2IOWAvOS4jeiDveS4uuepuicsCiAgICAgICAgdHJpZ2dlcjogJ2JsdXInCiAgICAgIH1dCiAgICB9OwogICAgcmV0dXJuIF90aGlzMjsKICB9CiAgLyoqDQogICAqIOiOt+WPlumDqOS7tuexu+Weiw0KICAgKg0KICAgKiBAcmV0dXJucyB7c3RyaW5nfQ0KICAgKiBAbWVtYmVyb2YgTWFpbkJhc2UNCiAgICovCgoKICBfY3JlYXRlQ2xhc3MoTWFpbkJhc2UsIFt7CiAgICBrZXk6ICJnZXRDb250cm9sVHlwZSIsCiAgICB2YWx1ZTogZnVuY3Rpb24gZ2V0Q29udHJvbFR5cGUoKSB7CiAgICAgIHJldHVybiAnR1JJRCc7CiAgICB9CiAgICAvKioNCiAgICAgKiDlhbPpl63op4blm74NCiAgICAgKg0KICAgICAqIEBwYXJhbSB7YW55fSBhcmdzDQogICAgICogQG1lbWJlcm9mIE1haW5CYXNlDQogICAgICovCgogIH0sIHsKICAgIGtleTogImNsb3NlVmlldyIsCiAgICB2YWx1ZTogZnVuY3Rpb24gY2xvc2VWaWV3KGFyZ3MpIHsKICAgICAgdmFyIF90aGlzID0gdGhpczsKCiAgICAgIF90aGlzLiRlbWl0KCdjbG9zZXZpZXcnLCBbYXJnc10pOwogICAgfQogICAgLyoqDQogICAgICogIOiuoeaVsOWZqOWIt+aWsA0KICAgICAqDQogICAgICogQG1lbWJlcm9mIE1haW5CYXNlDQogICAgICovCgogIH0sIHsKICAgIGtleTogImNvdW50ZXJSZWZyZXNoIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBjb3VudGVyUmVmcmVzaCgpIHsKICAgICAgdmFyIF90aGlzID0gdGhpczsKCiAgICAgIGlmIChfdGhpcy5jb3VudGVyU2VydmljZUFycmF5ICYmIF90aGlzLmNvdW50ZXJTZXJ2aWNlQXJyYXkubGVuZ3RoID4gMCkgewogICAgICAgIF90aGlzLmNvdW50ZXJTZXJ2aWNlQXJyYXkuZm9yRWFjaChmdW5jdGlvbiAoaXRlbSkgewogICAgICAgICAgaWYgKGl0ZW0ucmVmcmVzaERhdGEgJiYgaXRlbS5yZWZyZXNoRGF0YSBpbnN0YW5jZW9mIEZ1bmN0aW9uKSB7CiAgICAgICAgICAgIGl0ZW0ucmVmcmVzaERhdGEoKTsKICAgICAgICAgIH0KICAgICAgICB9KTsKICAgICAgfQogICAgfQogICAgLyoqDQogICAgICog6I635Y+W5aSa6aG55pWw5o2uDQogICAgICoNCiAgICAgKiBAcmV0dXJucyB7YW55W119DQogICAgICogQG1lbWJlcm9mIE1haW5CYXNlDQogICAgICovCgogIH0sIHsKICAgIGtleTogImdldERhdGFzIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBnZXREYXRhcygpIHsKICAgICAgcmV0dXJuIHRoaXMuc2VsZWN0aW9uczsKICAgIH0KICAgIC8qKg0KICAgICAqIOiOt+WPluWNlemhueagkQ0KICAgICAqDQogICAgICogQHJldHVybnMgeyp9DQogICAgICogQG1lbWJlcm9mIE1haW5CYXNlDQogICAgICovCgogIH0sIHsKICAgIGtleTogImdldERhdGEiLAogICAgdmFsdWU6IGZ1bmN0aW9uIGdldERhdGEoKSB7CiAgICAgIHJldHVybiB0aGlzLnNlbGVjdGlvbnNbMF07CiAgICB9CiAgICAvKioNCiAgICAgKiDpgInkuK3lgLzlj5jljJYNCiAgICAgKg0KICAgICAqIEBwYXJhbSB7Kn0gbmV3VmFsDQogICAgICogQHBhcmFtIHsqfSBvbGRWYWwNCiAgICAgKiBAbWVtYmVyb2YgTWFpbkJhc2UNCiAgICAgKi8KCiAgfSwgewogICAga2V5OiAib25WYWx1ZUNoYW5nZSIsCiAgICB2YWx1ZTogZnVuY3Rpb24gb25WYWx1ZUNoYW5nZShuZXdWYWwsIG9sZFZhbCkgewogICAgICB2YXIgX3RoaXMzID0gdGhpczsKCiAgICAgIHRoaXMuc2VsZWN0aW9ucyA9IFtdOwoKICAgICAgaWYgKHRoaXMuc2VsZWN0ZWREYXRhKSB7CiAgICAgICAgdmFyIHJlZnMgPSB0aGlzLiRyZWZzOwoKICAgICAgICBpZiAocmVmcy5tdWx0aXBsZVRhYmxlKSB7CiAgICAgICAgICByZWZzLm11bHRpcGxlVGFibGUuY2xlYXJTZWxlY3Rpb24oKTsKICAgICAgICAgIEpTT04ucGFyc2UodGhpcy5zZWxlY3RlZERhdGEpLmZvckVhY2goZnVuY3Rpb24gKHNlbGVjdGlvbikgewogICAgICAgICAgICB2YXIgc2VsZWN0ZWRJdGVtID0gX3RoaXMzLml0ZW1zLmZpbmQoZnVuY3Rpb24gKGl0ZW0pIHsKICAgICAgICAgICAgICByZXR1cm4gT2JqZWN0LmlzKGl0ZW0uc3Jma2V5LCBzZWxlY3Rpb24uc3Jma2V5KTsKICAgICAgICAgICAgfSk7CgogICAgICAgICAgICBpZiAoc2VsZWN0ZWRJdGVtKSB7CiAgICAgICAgICAgICAgX3RoaXMzLnJvd0NsaWNrKHNlbGVjdGVkSXRlbSk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0pOwogICAgICAgIH0KICAgICAgfQogICAgfQogICAgLyoqDQogICAgICog6YOo5Lu25Yi35pawDQogICAgICoNCiAgICAgKiBAcGFyYW0ge2FueVtdfSBhcmdzDQogICAgICogQG1lbWJlcm9mIE1haW5CYXNlDQogICAgICovCgogIH0sIHsKICAgIGtleTogInJlZnJlc2giLAogICAgdmFsdWU6IGZ1bmN0aW9uIHJlZnJlc2goYXJncykgewogICAgICB0aGlzLmxvYWQoKTsKICAgIH0KICAgIC8qKg0KICAgICAqIOiOt+WPluihqOagvOihjOaooeWeiw0KICAgICAqDQogICAgICogQHR5cGUgeyp9DQogICAgICogQG1lbWJlcm9mIE1haW5CYXNlDQogICAgICovCgogIH0sIHsKICAgIGtleTogImdldEdyaWRSb3dNb2RlbCIsCiAgICB2YWx1ZTogZnVuY3Rpb24gZ2V0R3JpZFJvd01vZGVsKCkgewogICAgICByZXR1cm4gewogICAgICAgIGpsY3p6OiBuZXcgRm9ybUl0ZW1Nb2RlbCgpLAogICAgICAgIHpsaHFzajogbmV3IEZvcm1JdGVtTW9kZWwoKSwKICAgICAgICB6bGg6IG5ldyBGb3JtSXRlbU1vZGVsKCksCiAgICAgICAgcGltcGF0ZW50bmFtZTogbmV3IEZvcm1JdGVtTW9kZWwoKSwKICAgICAgICBwaW1wZXJzb25pZDogbmV3IEZvcm1JdGVtTW9kZWwoKSwKICAgICAgICB6bHB6Z2I6IG5ldyBGb3JtSXRlbU1vZGVsKCksCiAgICAgICAgc3Jma2V5OiBuZXcgRm9ybUl0ZW1Nb2RlbCgpLAogICAgICAgIGVuY2xvbHVyZTogbmV3IEZvcm1JdGVtTW9kZWwoKQogICAgICB9OwogICAgfQogICAgLyoqDQogICAgICog6KGo5qC86KGM57yW6L6R6aG55qCh6aqMDQogICAgICoNCiAgICAgKiBAcGFyYW0ge3N0cmluZ30gcHJvcGVydHkg5bGe5oCn5ZCNDQogICAgICogQHBhcmFtIHsqfSBkYXRhIOihjOaVsOaNrg0KICAgICAqIEBwYXJhbSB7bnVtYmVyfSByb3dJbmRleCDooYzntKLlvJUNCiAgICAgKiBAcmV0dXJucyBQcm9taXNlPGFueT4NCiAgICAgKg0KICAgICAqIEBtZW1iZXJvZiBNYWluQmFzZQ0KICAgICAqLwoKICB9LCB7CiAgICBrZXk6ICJ2YWxpZGF0ZSIsCiAgICB2YWx1ZTogZnVuY3Rpb24gdmFsaWRhdGUocHJvcGVydHksIGRhdGEsIHJvd0luZGV4KSB7CiAgICAgIHZhciBfdGhpczQgPSB0aGlzOwoKICAgICAgcmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uIChyZXNvbHZlLCByZWplY3QpIHsKICAgICAgICBfdGhpczQuJHV0aWwudmFsaWRhdGVJdGVtKHByb3BlcnR5LCBkYXRhLCBfdGhpczQucnVsZXMpLnRoZW4oZnVuY3Rpb24gKCkgewogICAgICAgICAgX3RoaXM0LmdyaWRJdGVtc01vZGVsW3Jvd0luZGV4XVtwcm9wZXJ0eV0uc2V0RXJyb3IobnVsbCk7CgogICAgICAgICAgcmVzb2x2ZSh0cnVlKTsKICAgICAgICB9KVsiY2F0Y2giXShmdW5jdGlvbiAoX3JlZikgewogICAgICAgICAgdmFyIGVycm9ycyA9IF9yZWYuZXJyb3JzLAogICAgICAgICAgICAgIGZpZWxkcyA9IF9yZWYuZmllbGRzOwoKICAgICAgICAgIF90aGlzNC5ncmlkSXRlbXNNb2RlbFtyb3dJbmRleF1bcHJvcGVydHldLnNldEVycm9yKGVycm9yc1swXS5tZXNzYWdlKTsKCiAgICAgICAgICByZXNvbHZlKGZhbHNlKTsKICAgICAgICB9KTsKICAgICAgfSk7CiAgICB9CiAgICAvKioNCiAgICAgKiDmoKHpqozmiYDmnInkv67mlLnov4fnmoTnvJbovpHpobkNCiAgICAgKg0KICAgICAqIEByZXR1cm5zIFByb21pc2U8YW55Pg0KICAgICAqIEBtZW1iZXJvZiBNYWluQmFzZQ0KICAgICAqLwoKICB9LCB7CiAgICBrZXk6ICJ2YWxpZGF0ZUFsbCIsCiAgICB2YWx1ZTogZnVuY3Rpb24gKCkgewogICAgICB2YXIgX3ZhbGlkYXRlQWxsID0gX2FzeW5jVG9HZW5lcmF0b3IoCiAgICAgIC8qI19fUFVSRV9fKi8KICAgICAgcmVnZW5lcmF0b3JSdW50aW1lLm1hcmsoZnVuY3Rpb24gX2NhbGxlZSgpIHsKICAgICAgICB2YXIgdmFsaWRhdGVTdGF0ZSwgaW5kZXgsIF9pdGVyYXRvck5vcm1hbENvbXBsZXRpb24sIF9kaWRJdGVyYXRvckVycm9yLCBfaXRlcmF0b3JFcnJvciwgX2l0ZXJhdG9yLCBfc3RlcCwgaXRlbSwgX2ksIF9PYmplY3Qka2V5cywgcHJvcGVydHk7CgogICAgICAgIHJldHVybiByZWdlbmVyYXRvclJ1bnRpbWUud3JhcChmdW5jdGlvbiBfY2FsbGVlJChfY29udGV4dCkgewogICAgICAgICAgd2hpbGUgKDEpIHsKICAgICAgICAgICAgc3dpdGNoIChfY29udGV4dC5wcmV2ID0gX2NvbnRleHQubmV4dCkgewogICAgICAgICAgICAgIGNhc2UgMDoKICAgICAgICAgICAgICAgIHZhbGlkYXRlU3RhdGUgPSB0cnVlOwogICAgICAgICAgICAgICAgaW5kZXggPSAtMTsKICAgICAgICAgICAgICAgIF9pdGVyYXRvck5vcm1hbENvbXBsZXRpb24gPSB0cnVlOwogICAgICAgICAgICAgICAgX2RpZEl0ZXJhdG9yRXJyb3IgPSBmYWxzZTsKICAgICAgICAgICAgICAgIF9pdGVyYXRvckVycm9yID0gdW5kZWZpbmVkOwogICAgICAgICAgICAgICAgX2NvbnRleHQucHJldiA9IDU7CiAgICAgICAgICAgICAgICBfaXRlcmF0b3IgPSB0aGlzLml0ZW1zW1N5bWJvbC5pdGVyYXRvcl0oKTsKCiAgICAgICAgICAgICAgY2FzZSA3OgogICAgICAgICAgICAgICAgaWYgKF9pdGVyYXRvck5vcm1hbENvbXBsZXRpb24gPSAoX3N0ZXAgPSBfaXRlcmF0b3IubmV4dCgpKS5kb25lKSB7CiAgICAgICAgICAgICAgICAgIF9jb250ZXh0Lm5leHQgPSAyNDsKICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgaXRlbSA9IF9zdGVwLnZhbHVlOwogICAgICAgICAgICAgICAgaW5kZXgrKzsKCiAgICAgICAgICAgICAgICBpZiAoIShpdGVtLnJvd0RhdGFTdGF0ZSA9PT0gImNyZWF0ZSIgfHwgaXRlbS5yb3dEYXRhU3RhdGUgPT09ICJ1cGRhdGUiKSkgewogICAgICAgICAgICAgICAgICBfY29udGV4dC5uZXh0ID0gMjE7CiAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIF9pID0gMCwgX09iamVjdCRrZXlzID0gT2JqZWN0LmtleXModGhpcy5ydWxlcyk7CgogICAgICAgICAgICAgIGNhc2UgMTI6CiAgICAgICAgICAgICAgICBpZiAoIShfaSA8IF9PYmplY3Qka2V5cy5sZW5ndGgpKSB7CiAgICAgICAgICAgICAgICAgIF9jb250ZXh0Lm5leHQgPSAyMTsKICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgcHJvcGVydHkgPSBfT2JqZWN0JGtleXNbX2ldOwogICAgICAgICAgICAgICAgX2NvbnRleHQubmV4dCA9IDE2OwogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMudmFsaWRhdGUocHJvcGVydHksIGl0ZW0sIGluZGV4KTsKCiAgICAgICAgICAgICAgY2FzZSAxNjoKICAgICAgICAgICAgICAgIGlmIChfY29udGV4dC5zZW50KSB7CiAgICAgICAgICAgICAgICAgIF9jb250ZXh0Lm5leHQgPSAxODsKICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgdmFsaWRhdGVTdGF0ZSA9IGZhbHNlOwoKICAgICAgICAgICAgICBjYXNlIDE4OgogICAgICAgICAgICAgICAgX2krKzsKICAgICAgICAgICAgICAgIF9jb250ZXh0Lm5leHQgPSAxMjsKICAgICAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgICAgICBjYXNlIDIxOgogICAgICAgICAgICAgICAgX2l0ZXJhdG9yTm9ybWFsQ29tcGxldGlvbiA9IHRydWU7CiAgICAgICAgICAgICAgICBfY29udGV4dC5uZXh0ID0gNzsKICAgICAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgICAgICBjYXNlIDI0OgogICAgICAgICAgICAgICAgX2NvbnRleHQubmV4dCA9IDMwOwogICAgICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgICAgIGNhc2UgMjY6CiAgICAgICAgICAgICAgICBfY29udGV4dC5wcmV2ID0gMjY7CiAgICAgICAgICAgICAgICBfY29udGV4dC50MCA9IF9jb250ZXh0WyJjYXRjaCJdKDUpOwogICAgICAgICAgICAgICAgX2RpZEl0ZXJhdG9yRXJyb3IgPSB0cnVlOwogICAgICAgICAgICAgICAgX2l0ZXJhdG9yRXJyb3IgPSBfY29udGV4dC50MDsKCiAgICAgICAgICAgICAgY2FzZSAzMDoKICAgICAgICAgICAgICAgIF9jb250ZXh0LnByZXYgPSAzMDsKICAgICAgICAgICAgICAgIF9jb250ZXh0LnByZXYgPSAzMTsKCiAgICAgICAgICAgICAgICBpZiAoIV9pdGVyYXRvck5vcm1hbENvbXBsZXRpb24gJiYgX2l0ZXJhdG9yWyJyZXR1cm4iXSAhPSBudWxsKSB7CiAgICAgICAgICAgICAgICAgIF9pdGVyYXRvclsicmV0dXJuIl0oKTsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgY2FzZSAzMzoKICAgICAgICAgICAgICAgIF9jb250ZXh0LnByZXYgPSAzMzsKCiAgICAgICAgICAgICAgICBpZiAoIV9kaWRJdGVyYXRvckVycm9yKSB7CiAgICAgICAgICAgICAgICAgIF9jb250ZXh0Lm5leHQgPSAzNjsKICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgdGhyb3cgX2l0ZXJhdG9yRXJyb3I7CgogICAgICAgICAgICAgIGNhc2UgMzY6CiAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQuZmluaXNoKDMzKTsKCiAgICAgICAgICAgICAgY2FzZSAzNzoKICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dC5maW5pc2goMzApOwoKICAgICAgICAgICAgICBjYXNlIDM4OgogICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0LmFicnVwdCgicmV0dXJuIiwgdmFsaWRhdGVTdGF0ZSk7CgogICAgICAgICAgICAgIGNhc2UgMzk6CiAgICAgICAgICAgICAgY2FzZSAiZW5kIjoKICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dC5zdG9wKCk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9LCBfY2FsbGVlLCB0aGlzLCBbWzUsIDI2LCAzMCwgMzhdLCBbMzEsLCAzMywgMzddXSk7CiAgICAgIH0pKTsKCiAgICAgIGZ1bmN0aW9uIHZhbGlkYXRlQWxsKCkgewogICAgICAgIHJldHVybiBfdmFsaWRhdGVBbGwuYXBwbHkodGhpcywgYXJndW1lbnRzKTsKICAgICAgfQoKICAgICAgcmV0dXJuIHZhbGlkYXRlQWxsOwogICAgfSgpCiAgICAvKioNCiAgICAgKiDooajmoLzmlbDmja7liqDovb0NCiAgICAgKg0KICAgICAqIEBwYXJhbSB7Kn0gW2FyZz17fV0NCiAgICAgKiBAbWVtYmVyb2YgTWFpbkJhc2UNCiAgICAgKi8KCiAgfSwgewogICAga2V5OiAibG9hZCIsCiAgICB2YWx1ZTogZnVuY3Rpb24gbG9hZCgpIHsKICAgICAgdmFyIF90aGlzNSA9IHRoaXM7CgogICAgICB2YXIgb3B0ID0gYXJndW1lbnRzLmxlbmd0aCA+IDAgJiYgYXJndW1lbnRzWzBdICE9PSB1bmRlZmluZWQgPyBhcmd1bWVudHNbMF0gOiB7fTsKICAgICAgdmFyIHBhZ2VSZXNldCA9IGFyZ3VtZW50cy5sZW5ndGggPiAxICYmIGFyZ3VtZW50c1sxXSAhPT0gdW5kZWZpbmVkID8gYXJndW1lbnRzWzFdIDogZmFsc2U7CgogICAgICBpZiAoIXRoaXMuZmV0Y2hBY3Rpb24pIHsKICAgICAgICB0aGlzLiROb3RpY2UuZXJyb3IoewogICAgICAgICAgdGl0bGU6ICfplJnor68nLAogICAgICAgICAgZGVzYzogJ1BJTVBBVEVOVFBBVEVOVEdyaWRWaWV36KeG5Zu+6KGo5qC8ZmV0Y2hBY3Rpb27lj4LmlbDmnKrphY3nva4nCiAgICAgICAgfSk7CiAgICAgICAgcmV0dXJuOwogICAgICB9CgogICAgICBpZiAocGFnZVJlc2V0KSB7CiAgICAgICAgdGhpcy5jdXJQYWdlID0gMTsKICAgICAgfQoKICAgICAgdmFyIGFyZyA9IF9vYmplY3RTcHJlYWQoe30sIG9wdCk7CgogICAgICB2YXIgcGFnZSA9IHt9OwoKICAgICAgaWYgKHRoaXMuaXNFbmFibGVQYWdpbmdCYXIpIHsKICAgICAgICBPYmplY3QuYXNzaWduKHBhZ2UsIHsKICAgICAgICAgIHBhZ2U6IHRoaXMuY3VyUGFnZSAtIDEsCiAgICAgICAgICBzaXplOiB0aGlzLmxpbWl0CiAgICAgICAgfSk7CiAgICAgIH0gLy8g6K6+572u5o6S5bqPCgoKICAgICAgaWYgKCF0aGlzLmlzTm9Tb3J0ICYmICFPYmplY3QuaXModGhpcy5taW5vclNvcnREaXIsICcnKSAmJiAhT2JqZWN0LmlzKHRoaXMubWlub3JTb3J0UFNERUYsICcnKSkgewogICAgICAgIHZhciBzb3J0ID0gdGhpcy5taW5vclNvcnRQU0RFRiArICIsIiArIHRoaXMubWlub3JTb3J0RGlyOwogICAgICAgIE9iamVjdC5hc3NpZ24ocGFnZSwgewogICAgICAgICAgc29ydDogc29ydAogICAgICAgIH0pOwogICAgICB9CgogICAgICBPYmplY3QuYXNzaWduKGFyZywgcGFnZSk7CiAgICAgIHZhciBwYXJlbnRkYXRhID0ge307CiAgICAgIHRoaXMuJGVtaXQoJ2JlZm9yZWxvYWQnLCBwYXJlbnRkYXRhKTsKICAgICAgT2JqZWN0LmFzc2lnbihhcmcsIHBhcmVudGRhdGEpOwogICAgICB2YXIgdGVtcFZpZXdQYXJhbXMgPSBwYXJlbnRkYXRhLnZpZXdwYXJhbXMgPyBwYXJlbnRkYXRhLnZpZXdwYXJhbXMgOiB7fTsKICAgICAgT2JqZWN0LmFzc2lnbih0ZW1wVmlld1BhcmFtcywgSlNPTi5wYXJzZShKU09OLnN0cmluZ2lmeSh0aGlzLnZpZXdwYXJhbXMpKSk7CiAgICAgIE9iamVjdC5hc3NpZ24oYXJnLCB7CiAgICAgICAgdmlld3BhcmFtczogdGVtcFZpZXdQYXJhbXMKICAgICAgfSk7CiAgICAgIHZhciBwb3N0ID0gdGhpcy5zZXJ2aWNlLnNlYXJjaCh0aGlzLmZldGNoQWN0aW9uLCBKU09OLnBhcnNlKEpTT04uc3RyaW5naWZ5KHRoaXMuY29udGV4dCkpLCBhcmcsIHRoaXMuc2hvd0J1c3lJbmRpY2F0b3IpOwogICAgICBwb3N0LnRoZW4oZnVuY3Rpb24gKHJlc3BvbnNlKSB7CiAgICAgICAgaWYgKCFyZXNwb25zZS5zdGF0dXMgfHwgcmVzcG9uc2Uuc3RhdHVzICE9PSAyMDApIHsKICAgICAgICAgIGlmIChyZXNwb25zZS5lcnJvck1lc3NhZ2UpIHsKICAgICAgICAgICAgX3RoaXM1LiROb3RpY2UuZXJyb3IoewogICAgICAgICAgICAgIHRpdGxlOiAn6ZSZ6K+vJywKICAgICAgICAgICAgICBkZXNjOiByZXNwb25zZS5lcnJvck1lc3NhZ2UKICAgICAgICAgICAgfSk7CiAgICAgICAgICB9CgogICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KCiAgICAgICAgdmFyIGRhdGEgPSByZXNwb25zZS5kYXRhOwogICAgICAgIF90aGlzNS50b3RhbHJvdyA9IHJlc3BvbnNlLnRvdGFsOwogICAgICAgIF90aGlzNS5pdGVtcyA9IEpTT04ucGFyc2UoSlNPTi5zdHJpbmdpZnkoZGF0YSkpOyAvLyDmuIXnqbpzZWxlY3Rpb25zLGdyaWRJdGVtc01vZGVsCgogICAgICAgIF90aGlzNS5zZWxlY3Rpb25zID0gW107CiAgICAgICAgX3RoaXM1LmdyaWRJdGVtc01vZGVsID0gW107CgogICAgICAgIF90aGlzNS5pdGVtcy5mb3JFYWNoKGZ1bmN0aW9uICgpIHsKICAgICAgICAgIF90aGlzNS5ncmlkSXRlbXNNb2RlbC5wdXNoKF90aGlzNS5nZXRHcmlkUm93TW9kZWwoKSk7CiAgICAgICAgfSk7CgogICAgICAgIF90aGlzNS4kZW1pdCgnbG9hZCcsIF90aGlzNS5pdGVtcyk7IC8vIOiuvue9rum7mOiupOmAieS4rQoKCiAgICAgICAgdmFyIF90aGlzID0gX3RoaXM1OwogICAgICAgIHNldFRpbWVvdXQoZnVuY3Rpb24gKCkgewogICAgICAgICAgaWYgKF90aGlzLmlzU2VsZWN0Rmlyc3REZWZhdWx0KSB7CiAgICAgICAgICAgIF90aGlzLnJvd0NsaWNrKF90aGlzLml0ZW1zWzBdKTsKICAgICAgICAgIH0KCiAgICAgICAgICBpZiAoX3RoaXMuc2VsZWN0ZWREYXRhKSB7CiAgICAgICAgICAgIHZhciByZWZzID0gX3RoaXMuJHJlZnM7CgogICAgICAgICAgICBpZiAocmVmcy5tdWx0aXBsZVRhYmxlKSB7CiAgICAgICAgICAgICAgcmVmcy5tdWx0aXBsZVRhYmxlLmNsZWFyU2VsZWN0aW9uKCk7CiAgICAgICAgICAgICAgSlNPTi5wYXJzZShfdGhpcy5zZWxlY3RlZERhdGEpLmZvckVhY2goZnVuY3Rpb24gKHNlbGVjdGlvbikgewogICAgICAgICAgICAgICAgdmFyIHNlbGVjdGVkSXRlbSA9IF90aGlzLml0ZW1zLmZpbmQoZnVuY3Rpb24gKGl0ZW0pIHsKICAgICAgICAgICAgICAgICAgcmV0dXJuIE9iamVjdC5pcyhpdGVtLnNyZmtleSwgc2VsZWN0aW9uLnNyZmtleSk7CiAgICAgICAgICAgICAgICB9KTsKCiAgICAgICAgICAgICAgICBpZiAoc2VsZWN0ZWRJdGVtKSB7CiAgICAgICAgICAgICAgICAgIF90aGlzLnJvd0NsaWNrKHNlbGVjdGVkSXRlbSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9LCAzMDApOwogICAgICB9KVsiY2F0Y2giXShmdW5jdGlvbiAocmVzcG9uc2UpIHsKICAgICAgICBpZiAocmVzcG9uc2UgJiYgcmVzcG9uc2Uuc3RhdHVzID09PSA0MDEpIHsKICAgICAgICAgIHJldHVybjsKICAgICAgICB9CgogICAgICAgIF90aGlzNS4kTm90aWNlLmVycm9yKHsKICAgICAgICAgIHRpdGxlOiAn6ZSZ6K+vJywKICAgICAgICAgIGRlc2M6IHJlc3BvbnNlLmVycm9yTWVzc2FnZQogICAgICAgIH0pOwogICAgICB9KTsKICAgIH0KICAgIC8qKg0KICAgICAqIOWIoOmZpA0KICAgICAqDQogICAgICogQHBhcmFtIHthbnlbXX0gZGF0YXMNCiAgICAgKiBAcmV0dXJucyB7UHJvbWlzZTxhbnk+fQ0KICAgICAqIEBtZW1iZXJvZiBNYWluQmFzZQ0KICAgICAqLwoKICB9LCB7CiAgICBrZXk6ICJyZW1vdmUiLAogICAgdmFsdWU6IGZ1bmN0aW9uICgpIHsKICAgICAgdmFyIF9yZW1vdmUgPSBfYXN5bmNUb0dlbmVyYXRvcigKICAgICAgLyojX19QVVJFX18qLwogICAgICByZWdlbmVyYXRvclJ1bnRpbWUubWFyayhmdW5jdGlvbiBfY2FsbGVlMihkYXRhcykgewogICAgICAgIHZhciBfdGhpczYgPSB0aGlzOwoKICAgICAgICB2YXIgX2RhdGFzLCBkYXRhSW5mbywgcmVtb3ZlRGF0YTsKCiAgICAgICAgcmV0dXJuIHJlZ2VuZXJhdG9yUnVudGltZS53cmFwKGZ1bmN0aW9uIF9jYWxsZWUyJChfY29udGV4dDIpIHsKICAgICAgICAgIHdoaWxlICgxKSB7CiAgICAgICAgICAgIHN3aXRjaCAoX2NvbnRleHQyLnByZXYgPSBfY29udGV4dDIubmV4dCkgewogICAgICAgICAgICAgIGNhc2UgMDoKICAgICAgICAgICAgICAgIGlmICh0aGlzLnJlbW92ZUFjdGlvbikgewogICAgICAgICAgICAgICAgICBfY29udGV4dDIubmV4dCA9IDM7CiAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIHRoaXMuJE5vdGljZS5lcnJvcih7CiAgICAgICAgICAgICAgICAgIHRpdGxlOiAn6ZSZ6K+vJywKICAgICAgICAgICAgICAgICAgZGVzYzogJ1BJTVBBVEVOVFBBVEVOVEdyaWRWaWV36KeG5Zu+6KGo5qC8cmVtb3ZlQWN0aW9u5Y+C5pWw5pyq6YWN572uJwogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQyLmFicnVwdCgicmV0dXJuIik7CgogICAgICAgICAgICAgIGNhc2UgMzoKICAgICAgICAgICAgICAgIF9kYXRhcyA9IFtdOwogICAgICAgICAgICAgICAgZGF0YXMuZm9yRWFjaChmdW5jdGlvbiAocmVjb3JkLCBpbmRleCkgewogICAgICAgICAgICAgICAgICBpZiAoT2JqZWN0LmlzKHJlY29yZC5zcmZ1ZiwgIjAiKSkgewogICAgICAgICAgICAgICAgICAgIF90aGlzNi5pdGVtcy5zb21lKGZ1bmN0aW9uICh2YWwsIG51bSkgewogICAgICAgICAgICAgICAgICAgICAgaWYgKEpTT04uc3RyaW5naWZ5KHZhbCkgPT0gSlNPTi5zdHJpbmdpZnkocmVjb3JkKSkgewogICAgICAgICAgICAgICAgICAgICAgICBfdGhpczYuaXRlbXMuc3BsaWNlKG51bSwgMSk7CgogICAgICAgICAgICAgICAgICAgICAgICBfdGhpczYuZ3JpZEl0ZW1zTW9kZWwuc3BsaWNlKG51bSwgMSk7CgogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICBfZGF0YXMucHVzaChkYXRhc1tpbmRleF0pOwogICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9KTsKCiAgICAgICAgICAgICAgICBpZiAoIShfZGF0YXMubGVuZ3RoID09PSAwKSkgewogICAgICAgICAgICAgICAgICBfY29udGV4dDIubmV4dCA9IDc7CiAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDIuYWJydXB0KCJyZXR1cm4iKTsKCiAgICAgICAgICAgICAgY2FzZSA3OgogICAgICAgICAgICAgICAgZGF0YUluZm8gPSAnJzsKCiAgICAgICAgICAgICAgICBfZGF0YXMuZm9yRWFjaChmdW5jdGlvbiAocmVjb3JkLCBpbmRleCkgewogICAgICAgICAgICAgICAgICB2YXIgc3JmbWFqb3J0ZXh0ID0gcmVjb3JkLnBpbXBhdGVudG5hbWU7CgogICAgICAgICAgICAgICAgICBpZiAoaW5kZXggPCA1KSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKCFPYmplY3QuaXMoZGF0YUluZm8sICcnKSkgewogICAgICAgICAgICAgICAgICAgICAgZGF0YUluZm8gKz0gJ+OAgSc7CiAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICBkYXRhSW5mbyArPSBzcmZtYWpvcnRleHQ7CiAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9KTsKCiAgICAgICAgICAgICAgICBpZiAoX2RhdGFzLmxlbmd0aCA8IDUpIHsKICAgICAgICAgICAgICAgICAgZGF0YUluZm8gPSBkYXRhSW5mbyArICcg5YWxJyArIF9kYXRhcy5sZW5ndGggKyAn5p2h5pWw5o2uJzsKICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgIGRhdGFJbmZvID0gZGF0YUluZm8gKyAnLi4uJyArICcg5YWxJyArIF9kYXRhcy5sZW5ndGggKyAn5p2h5pWw5o2uJzsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICByZW1vdmVEYXRhID0gZnVuY3Rpb24gcmVtb3ZlRGF0YSgpIHsKICAgICAgICAgICAgICAgICAgdmFyIGtleXMgPSBbXTsKCiAgICAgICAgICAgICAgICAgIF9kYXRhcy5mb3JFYWNoKGZ1bmN0aW9uIChkYXRhKSB7CiAgICAgICAgICAgICAgICAgICAga2V5cy5wdXNoKGRhdGEuc3Jma2V5KTsKICAgICAgICAgICAgICAgICAgfSk7CgogICAgICAgICAgICAgICAgICB2YXIgX3JlbW92ZUFjdGlvbiA9IGtleXMubGVuZ3RoID4gMSA/ICdyZW1vdmVCYXRjaCcgOiBfdGhpczYucmVtb3ZlQWN0aW9uOwoKICAgICAgICAgICAgICAgICAgdmFyIF9rZXlzID0ga2V5cy5sZW5ndGggPiAxID8ga2V5cyA6IGtleXNbMF07CgogICAgICAgICAgICAgICAgICB2YXIgY29udGV4dCA9IEpTT04ucGFyc2UoSlNPTi5zdHJpbmdpZnkoX3RoaXM2LmNvbnRleHQpKTsKCiAgICAgICAgICAgICAgICAgIHZhciBwb3N0ID0gX3RoaXM2LnNlcnZpY2VbImRlbGV0ZSJdKF9yZW1vdmVBY3Rpb24sIE9iamVjdC5hc3NpZ24oY29udGV4dCwgewogICAgICAgICAgICAgICAgICAgIHBpbXBhdGVudDogX2tleXMKICAgICAgICAgICAgICAgICAgfSksIE9iamVjdC5hc3NpZ24oewogICAgICAgICAgICAgICAgICAgIHBpbXBhdGVudDogX2tleXMKICAgICAgICAgICAgICAgICAgfSwgewogICAgICAgICAgICAgICAgICAgIHZpZXdwYXJhbXM6IF90aGlzNi52aWV3cGFyYW1zCiAgICAgICAgICAgICAgICAgIH0pLCBfdGhpczYuc2hvd0J1c3lJbmRpY2F0b3IpOwoKICAgICAgICAgICAgICAgICAgcmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uIChyZXNvbHZlLCByZWplY3QpIHsKICAgICAgICAgICAgICAgICAgICBwb3N0LnRoZW4oZnVuY3Rpb24gKHJlc3BvbnNlKSB7CiAgICAgICAgICAgICAgICAgICAgICBpZiAoIXJlc3BvbnNlIHx8IHJlc3BvbnNlLnN0YXR1cyAhPT0gMjAwKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIF90aGlzNi4kTm90aWNlLmVycm9yKHsKICAgICAgICAgICAgICAgICAgICAgICAgICB0aXRsZTogJycsCiAgICAgICAgICAgICAgICAgICAgICAgICAgZGVzYzogJ+WIoOmZpOaVsOaNruWksei0pSwnICsgcmVzcG9uc2UuaW5mbwogICAgICAgICAgICAgICAgICAgICAgICB9KTsKCiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgIF90aGlzNi4kTm90aWNlLnN1Y2Nlc3MoewogICAgICAgICAgICAgICAgICAgICAgICAgIHRpdGxlOiAnJywKICAgICAgICAgICAgICAgICAgICAgICAgICBkZXNjOiAn5Yig6Zmk5oiQ5YqfIScKICAgICAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgICB9IC8v5Yig6ZmkaXRlbXPkuK3lt7LliKDpmaTnmoTpobkKCgogICAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coX3RoaXM2Lml0ZW1zKTsKCiAgICAgICAgICAgICAgICAgICAgICBfZGF0YXMuZm9yRWFjaChmdW5jdGlvbiAoZGF0YSkgewogICAgICAgICAgICAgICAgICAgICAgICBfdGhpczYuaXRlbXMuc29tZShmdW5jdGlvbiAoaXRlbSwgaW5kZXgpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoT2JqZWN0LmlzKGl0ZW0uc3Jma2V5LCBkYXRhLnNyZmtleSkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIF90aGlzNi5pdGVtcy5zcGxpY2UoaW5kZXgsIDEpOwoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIF90aGlzNi5ncmlkSXRlbXNNb2RlbC5zcGxpY2UoaW5kZXgsIDEpOwoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgICB9KTsKCiAgICAgICAgICAgICAgICAgICAgICBfdGhpczYudG90YWxyb3cgLT0gX2RhdGFzLmxlbmd0aDsKCiAgICAgICAgICAgICAgICAgICAgICBfdGhpczYuJGVtaXQoJ3JlbW92ZScsIG51bGwpOwoKICAgICAgICAgICAgICAgICAgICAgIF90aGlzNi5zZWxlY3Rpb25zID0gW107CiAgICAgICAgICAgICAgICAgICAgICByZXNvbHZlKHJlc3BvbnNlKTsKICAgICAgICAgICAgICAgICAgICB9KVsiY2F0Y2giXShmdW5jdGlvbiAocmVzcG9uc2UpIHsKICAgICAgICAgICAgICAgICAgICAgIGlmIChyZXNwb25zZSAmJiByZXNwb25zZS5zdGF0dXMgPT09IDQwMSkgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgICAgaWYgKCFyZXNwb25zZSB8fCAhcmVzcG9uc2Uuc3RhdHVzIHx8ICFyZXNwb25zZS5kYXRhKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIF90aGlzNi4kTm90aWNlLmVycm9yKHsKICAgICAgICAgICAgICAgICAgICAgICAgICB0aXRsZTogJ+mUmeivrycsCiAgICAgICAgICAgICAgICAgICAgICAgICAgZGVzYzogJ+ezu+e7n+W8guW4uCcKICAgICAgICAgICAgICAgICAgICAgICAgfSk7CgogICAgICAgICAgICAgICAgICAgICAgICByZWplY3QocmVzcG9uc2UpOwogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgICAgcmVqZWN0KHJlc3BvbnNlKTsKICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICB9OwoKICAgICAgICAgICAgICAgIGRhdGFJbmZvID0gZGF0YUluZm8ucmVwbGFjZSgvW251bGxdL2csICcnKS5yZXBsYWNlKC9bdW5kZWZpbmVkXS9nLCAnJyk7CiAgICAgICAgICAgICAgICB0aGlzLiRNb2RhbC5jb25maXJtKHsKICAgICAgICAgICAgICAgICAgdGl0bGU6ICforablkYonLAogICAgICAgICAgICAgICAgICBjb250ZW50OiAn56Gu6K6k6KaB5Yig6ZmkICcgKyBkYXRhSW5mbyArICfvvIzliKDpmaTmk43kvZzlsIbkuI3lj6/mgaLlpI3vvJ8nLAogICAgICAgICAgICAgICAgICBvbk9rOiBmdW5jdGlvbiBvbk9rKCkgewogICAgICAgICAgICAgICAgICAgIHJlbW92ZURhdGEoKTsKICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgb25DYW5jZWw6IGZ1bmN0aW9uIG9uQ2FuY2VsKCkge30KICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0Mi5hYnJ1cHQoInJldHVybiIsIHJlbW92ZURhdGEpOwoKICAgICAgICAgICAgICBjYXNlIDE0OgogICAgICAgICAgICAgIGNhc2UgImVuZCI6CiAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQyLnN0b3AoKTsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0sIF9jYWxsZWUyLCB0aGlzKTsKICAgICAgfSkpOwoKICAgICAgZnVuY3Rpb24gcmVtb3ZlKF94KSB7CiAgICAgICAgcmV0dXJuIF9yZW1vdmUuYXBwbHkodGhpcywgYXJndW1lbnRzKTsKICAgICAgfQoKICAgICAgcmV0dXJuIHJlbW92ZTsKICAgIH0oKQogICAgLyoqDQogICAgICog5om56YeP5re75YqgDQogICAgICoNCiAgICAgKiBAcGFyYW0geyp9IFthcmc9e31dDQogICAgICogQG1lbWJlcm9mIE1haW5CYXNlDQogICAgICovCgogIH0sIHsKICAgIGtleTogImFkZEJhdGNoIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBhZGRCYXRjaCgpIHsKICAgICAgdmFyIGFyZyA9IGFyZ3VtZW50cy5sZW5ndGggPiAwICYmIGFyZ3VtZW50c1swXSAhPT0gdW5kZWZpbmVkID8gYXJndW1lbnRzWzBdIDoge307CgogICAgICBpZiAoIXRoaXMuZmV0Y2hBY3Rpb24pIHsKICAgICAgICB0aGlzLiROb3RpY2UuZXJyb3IoewogICAgICAgICAgdGl0bGU6ICfplJnor68nLAogICAgICAgICAgZGVzYzogJ1BJTVBBVEVOVFBBVEVOVEdyaWRWaWV36KeG5Zu+6KGo5qC8ZmV0Y2hBY3Rpb27lj4LmlbDmnKrphY3nva4nCiAgICAgICAgfSk7CiAgICAgICAgcmV0dXJuOwogICAgICB9CgogICAgICBpZiAoIWFyZykgewogICAgICAgIGFyZyA9IHt9OwogICAgICB9CgogICAgICBjb25zb2xlLmVycm9yKCLmibnph4/mt7vliqDmnKrlrp7njrAiKTsKICAgIH0KICAgIC8qKg0KICAgICAqIOaVsOaNruWvvOWFpQ0KICAgICAqDQogICAgICogQHBhcmFtIHsqfSBkYXRhDQogICAgICogQG1lbWJlcm9mIE1haW5CYXNlDQogICAgICovCgogIH0sIHsKICAgIGtleTogImltcG9ydEV4Y2VsIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBpbXBvcnRFeGNlbCgpIHsKICAgICAgdmFyIF90aGlzNyA9IHRoaXM7CgogICAgICB2YXIgZGF0YSA9IGFyZ3VtZW50cy5sZW5ndGggPiAwICYmIGFyZ3VtZW50c1swXSAhPT0gdW5kZWZpbmVkID8gYXJndW1lbnRzWzBdIDoge307CiAgICAgIC8v5a+85YWlZXhjZWwKICAgICAgdmFyIGltcG9ydERhdGFNb2RlbCA9IHt9OwoKICAgICAgaWYgKE9iamVjdC5rZXlzKGltcG9ydERhdGFNb2RlbCkubGVuZ3RoID09IDApIHsKICAgICAgICB0aGlzLiROb3RpY2Uud2FybmluZyh7CiAgICAgICAgICAndGl0bGUnOiB0aGlzLiR0KCJhcHAudXRpbHZpZXcud2FybmluZyIpLAogICAgICAgICAgJ2Rlc2MnOiB0aGlzLiR0KCJhcHAudXRpbHZpZXcuaW5mbyIpCiAgICAgICAgfSk7CiAgICAgICAgcmV0dXJuOwogICAgICB9CgogICAgICB2YXIgdmlldyA9IHsKICAgICAgICB2aWV3bmFtZTogJ2FwcC1kYXRhLXVwbG9hZCcsCiAgICAgICAgdGl0bGU6IHRoaXMuJHQoImFwcC51dGlsdmlldy5pbXBvcnR2aWV3IiksCiAgICAgICAgd2lkdGg6IDkwMCwKICAgICAgICBoZWlnaHQ6IDcwMAogICAgICB9OwogICAgICB2YXIgY29udGFpbmVyID0gdGhpcy4kYXBwbW9kYWwub3Blbk1vZGFsKHZpZXcsIEpTT04ucGFyc2UoSlNPTi5zdHJpbmdpZnkodGhpcy5jb250ZXh0KSksIGltcG9ydERhdGFNb2RlbCk7CiAgICAgIGNvbnRhaW5lci5zdWJzY3JpYmUoZnVuY3Rpb24gKHJlc3VsdCkgewogICAgICAgIGlmIChPYmplY3QuaXMocmVzdWx0LnJldCwgJ09LJykpIHsKICAgICAgICAgIF90aGlzNy5yZWZyZXNoKHJlc3VsdC5kYXRhcyk7CiAgICAgICAgfQogICAgICB9KTsKICAgIH0KICAgIC8qKg0KICAgICAqIOaVsOaNruWvvOWHug0KICAgICAqDQogICAgICogQHBhcmFtIHsqfSBkYXRhDQogICAgICogQG1lbWJlcm9mIE1haW5CYXNlDQogICAgICovCgogIH0sIHsKICAgIGtleTogImV4cG9ydEV4Y2VsIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBleHBvcnRFeGNlbCgpIHsKICAgICAgdmFyIF90aGlzOCA9IHRoaXM7CgogICAgICB2YXIgZGF0YSA9IGFyZ3VtZW50cy5sZW5ndGggPiAwICYmIGFyZ3VtZW50c1swXSAhPT0gdW5kZWZpbmVkID8gYXJndW1lbnRzWzBdIDoge307CgogICAgICAvLyDlr7zlh7pFeGNlbAogICAgICB2YXIgZG9FeHBvcnQgPQogICAgICAvKiNfX1BVUkVfXyovCiAgICAgIGZ1bmN0aW9uICgpIHsKICAgICAgICB2YXIgX3JlZjIgPSBfYXN5bmNUb0dlbmVyYXRvcigKICAgICAgICAvKiNfX1BVUkVfXyovCiAgICAgICAgcmVnZW5lcmF0b3JSdW50aW1lLm1hcmsoZnVuY3Rpb24gX2NhbGxlZTMoX2RhdGEpIHsKICAgICAgICAgIHZhciB0SGVhZGVyLCBmaWx0ZXJWYWwsIGRhdGE7CiAgICAgICAgICByZXR1cm4gcmVnZW5lcmF0b3JSdW50aW1lLndyYXAoZnVuY3Rpb24gX2NhbGxlZTMkKF9jb250ZXh0MykgewogICAgICAgICAgICB3aGlsZSAoMSkgewogICAgICAgICAgICAgIHN3aXRjaCAoX2NvbnRleHQzLnByZXYgPSBfY29udGV4dDMubmV4dCkgewogICAgICAgICAgICAgICAgY2FzZSAwOgogICAgICAgICAgICAgICAgICB0SGVhZGVyID0gW107CiAgICAgICAgICAgICAgICAgIGZpbHRlclZhbCA9IFtdOwoKICAgICAgICAgICAgICAgICAgX3RoaXM4LmFsbENvbHVtbnMuZm9yRWFjaChmdW5jdGlvbiAoaXRlbSkgewogICAgICAgICAgICAgICAgICAgIGl0ZW0uc2hvdyAmJiBpdGVtLmxhYmVsID8gdEhlYWRlci5wdXNoKF90aGlzOC4kdChpdGVtLmxhbmd0YWcpKSA6ICIiOwogICAgICAgICAgICAgICAgICAgIGl0ZW0uc2hvdyAmJiBpdGVtLm5hbWUgPyBmaWx0ZXJWYWwucHVzaChpdGVtLm5hbWUpIDogIiI7CiAgICAgICAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgICAgICAgX2NvbnRleHQzLm5leHQgPSA1OwogICAgICAgICAgICAgICAgICByZXR1cm4gX3RoaXM4LmZvcm1hdEV4Y2VsRGF0YShmaWx0ZXJWYWwsIF9kYXRhKTsKCiAgICAgICAgICAgICAgICBjYXNlIDU6CiAgICAgICAgICAgICAgICAgIGRhdGEgPSBfY29udGV4dDMuc2VudDsKCiAgICAgICAgICAgICAgICAgIF90aGlzOC4kZXhwb3J0LmV4cG9ydEV4Y2VsKCkudGhlbihmdW5jdGlvbiAoZXhjZWwpIHsKICAgICAgICAgICAgICAgICAgICBleGNlbC5leHBvcnRfanNvbl90b19leGNlbCh7CiAgICAgICAgICAgICAgICAgICAgICBoZWFkZXI6IHRIZWFkZXIsCiAgICAgICAgICAgICAgICAgICAgICBkYXRhOiBkYXRhLAogICAgICAgICAgICAgICAgICAgICAgZmlsZW5hbWU6ICLkuJPliKnkv6Hmga/ooagiLAogICAgICAgICAgICAgICAgICAgICAgYXV0b1dpZHRoOiB0cnVlLAogICAgICAgICAgICAgICAgICAgICAgYm9va1R5cGU6ICJ4bHN4IiAvL+mdnuW/heWhqwoKICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgfSk7CgogICAgICAgICAgICAgICAgY2FzZSA3OgogICAgICAgICAgICAgICAgY2FzZSAiZW5kIjoKICAgICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0My5zdG9wKCk7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICB9LCBfY2FsbGVlMyk7CiAgICAgICAgfSkpOwoKICAgICAgICByZXR1cm4gZnVuY3Rpb24gZG9FeHBvcnQoX3gyKSB7CiAgICAgICAgICByZXR1cm4gX3JlZjIuYXBwbHkodGhpcywgYXJndW1lbnRzKTsKICAgICAgICB9OwogICAgICB9KCk7CgogICAgICB2YXIgcGFnZSA9IHt9OyAvLyDorr7nva5wYWdl77yMc2l6ZQoKICAgICAgaWYgKE9iamVjdC5pcyhkYXRhLnR5cGUsICdtYXhSb3dDb3VudCcpKSB7CiAgICAgICAgT2JqZWN0LmFzc2lnbihwYWdlLCB7CiAgICAgICAgICBwYWdlOiAwLAogICAgICAgICAgc2l6ZTogZGF0YS5tYXhSb3dDb3VudAogICAgICAgIH0pOwogICAgICB9IGVsc2UgaWYgKE9iamVjdC5pcyhkYXRhLnR5cGUsICdhY3RpdmF0ZWRQYWdlJykpIHsKICAgICAgICB0cnkgewogICAgICAgICAgZG9FeHBvcnQoSlNPTi5wYXJzZShKU09OLnN0cmluZ2lmeSh0aGlzLml0ZW1zKSkpOwogICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7CiAgICAgICAgICBjb25zb2xlLmVycm9yKGVycm9yKTsKICAgICAgICB9CgogICAgICAgIHJldHVybjsKICAgICAgfSAvLyDorr7nva7mjpLluo8KCgogICAgICBpZiAoIXRoaXMuaXNOb1NvcnQgJiYgIU9iamVjdC5pcyh0aGlzLm1pbm9yU29ydERpciwgJycpICYmICFPYmplY3QuaXModGhpcy5taW5vclNvcnRQU0RFRiwgJycpKSB7CiAgICAgICAgdmFyIHNvcnQgPSB0aGlzLm1pbm9yU29ydFBTREVGICsgIiwiICsgdGhpcy5taW5vclNvcnREaXI7CiAgICAgICAgT2JqZWN0LmFzc2lnbihwYWdlLCB7CiAgICAgICAgICBzb3J0OiBzb3J0CiAgICAgICAgfSk7CiAgICAgIH0KCiAgICAgIHZhciBhcmcgPSB7fTsKICAgICAgT2JqZWN0LmFzc2lnbihhcmcsIHBhZ2UpOyAvLyDojrflj5ZxdWVyeSzmkJzntKLooajljZXvvIx2aWV3cGFyYW1z562J54i25pWw5o2uCgogICAgICB2YXIgcGFyZW50ZGF0YSA9IHt9OwogICAgICB0aGlzLiRlbWl0KCdiZWZvcmVsb2FkJywgcGFyZW50ZGF0YSk7CiAgICAgIE9iamVjdC5hc3NpZ24oYXJnLCBwYXJlbnRkYXRhKTsKICAgICAgdmFyIHBvc3QgPSB0aGlzLnNlcnZpY2Uuc2VhcmNoKHRoaXMuZmV0Y2hBY3Rpb24sIEpTT04ucGFyc2UoSlNPTi5zdHJpbmdpZnkodGhpcy5jb250ZXh0KSksIGFyZywgdGhpcy5zaG93QnVzeUluZGljYXRvcik7CiAgICAgIHBvc3QudGhlbihmdW5jdGlvbiAocmVzcG9uc2UpIHsKICAgICAgICBpZiAoIXJlc3BvbnNlIHx8IHJlc3BvbnNlLnN0YXR1cyAhPT0gMjAwKSB7CiAgICAgICAgICBfdGhpczguJE5vdGljZS5lcnJvcih7CiAgICAgICAgICAgIHRpdGxlOiAnJywKICAgICAgICAgICAgZGVzYzogJ+aVsOaNruWvvOWHuuWksei0pSwnICsgcmVzcG9uc2UuaW5mbwogICAgICAgICAgfSk7CgogICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KCiAgICAgICAgdHJ5IHsKICAgICAgICAgIGRvRXhwb3J0KEpTT04ucGFyc2UoSlNPTi5zdHJpbmdpZnkocmVzcG9uc2UuZGF0YSkpKTsKICAgICAgICB9IGNhdGNoIChlcnJvcikgewogICAgICAgICAgY29uc29sZS5lcnJvcihlcnJvcik7CiAgICAgICAgfQogICAgICB9KVsiY2F0Y2giXShmdW5jdGlvbiAocmVzcG9uc2UpIHsKICAgICAgICBpZiAocmVzcG9uc2UgJiYgcmVzcG9uc2Uuc3RhdHVzID09PSA0MDEpIHsKICAgICAgICAgIHJldHVybjsKICAgICAgICB9CgogICAgICAgIF90aGlzOC4kTm90aWNlLmVycm9yKHsKICAgICAgICAgIHRpdGxlOiAnJywKICAgICAgICAgIGRlc2M6ICfmlbDmja7lr7zlh7rlpLHotKUnCiAgICAgICAgfSk7CiAgICAgIH0pOwogICAgfQogICAgLyoqDQogICAgICog5a+85Ye65pWw5o2u5qC85byP5YyWDQogICAgICoNCiAgICAgKiBAcGFyYW0geyp9IGZpbHRlclZhbA0KICAgICAqIEBwYXJhbSB7Kn0ganNvbkRhdGENCiAgICAgKiBAcmV0dXJucyB7W119DQogICAgICogQG1lbWJlcm9mIE1haW5CYXNlDQogICAgICovCgogIH0sIHsKICAgIGtleTogImZvcm1hdEV4Y2VsRGF0YSIsCiAgICB2YWx1ZTogZnVuY3Rpb24gKCkgewogICAgICB2YXIgX2Zvcm1hdEV4Y2VsRGF0YSA9IF9hc3luY1RvR2VuZXJhdG9yKAogICAgICAvKiNfX1BVUkVfXyovCiAgICAgIHJlZ2VuZXJhdG9yUnVudGltZS5tYXJrKGZ1bmN0aW9uIF9jYWxsZWU0KGZpbHRlclZhbCwganNvbkRhdGEpIHsKICAgICAgICB2YXIgY29kZWxpc3RDb2x1bW5zLCBfdGhpcywgX2xvb3AsIF9pMiwgX2NvZGVsaXN0Q29sdW1uczsKCiAgICAgICAgcmV0dXJuIHJlZ2VuZXJhdG9yUnVudGltZS53cmFwKGZ1bmN0aW9uIF9jYWxsZWU0JChfY29udGV4dDUpIHsKICAgICAgICAgIHdoaWxlICgxKSB7CiAgICAgICAgICAgIHN3aXRjaCAoX2NvbnRleHQ1LnByZXYgPSBfY29udGV4dDUubmV4dCkgewogICAgICAgICAgICAgIGNhc2UgMDoKICAgICAgICAgICAgICAgIGNvZGVsaXN0Q29sdW1ucyA9IFtdOwogICAgICAgICAgICAgICAgX3RoaXMgPSB0aGlzOwogICAgICAgICAgICAgICAgX2xvb3AgPQogICAgICAgICAgICAgICAgLyojX19QVVJFX18qLwogICAgICAgICAgICAgICAgcmVnZW5lcmF0b3JSdW50aW1lLm1hcmsoZnVuY3Rpb24gX2xvb3AoKSB7CiAgICAgICAgICAgICAgICAgIHZhciBjb2RlbGlzdCwgaXRlbXMsIF9pdGVtczsKCiAgICAgICAgICAgICAgICAgIHJldHVybiByZWdlbmVyYXRvclJ1bnRpbWUud3JhcChmdW5jdGlvbiBfbG9vcCQoX2NvbnRleHQ0KSB7CiAgICAgICAgICAgICAgICAgICAgd2hpbGUgKDEpIHsKICAgICAgICAgICAgICAgICAgICAgIHN3aXRjaCAoX2NvbnRleHQ0LnByZXYgPSBfY29udGV4dDQubmV4dCkgewogICAgICAgICAgICAgICAgICAgICAgICBjYXNlIDA6CiAgICAgICAgICAgICAgICAgICAgICAgICAgY29kZWxpc3QgPSBfY29kZWxpc3RDb2x1bW5zW19pMl07CgogICAgICAgICAgICAgICAgICAgICAgICAgIGlmICghT2JqZWN0LmlzKGNvZGVsaXN0LmNvZGVsaXN0VHlwZSwgIkRZTkFNSUMiKSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgX2NvbnRleHQ0Lm5leHQgPSA4OwogICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICAgICAgICBfY29udGV4dDQubmV4dCA9IDQ7CiAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIF90aGlzLmNvZGVMaXN0U2VydmljZS5nZXRJdGVtcyhjb2RlbGlzdC5zcmZrZXkpOwoKICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSA0OgogICAgICAgICAgICAgICAgICAgICAgICAgIGl0ZW1zID0gX2NvbnRleHQ0LnNlbnQ7CiAgICAgICAgICAgICAgICAgICAgICAgICAganNvbkRhdGEuZm9yRWFjaChmdW5jdGlvbiAocm93KSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICByb3dbY29kZWxpc3QubmFtZV0gPSBfdGhpcy5nZXRDb2RlbGlzdFZhbHVlKGl0ZW1zLCByb3dbY29kZWxpc3QubmFtZV0sIGNvZGVsaXN0KTsKICAgICAgICAgICAgICAgICAgICAgICAgICB9KTsgLy8g6Z2Z5oCB5aSE55CGCgogICAgICAgICAgICAgICAgICAgICAgICAgIF9jb250ZXh0NC5uZXh0ID0gMTM7CiAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgICAgICAgICAgICAgICBjYXNlIDg6CiAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCFPYmplY3QuaXMoY29kZWxpc3QuY29kZWxpc3RUeXBlLCAiU1RBVElDIikpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIF9jb250ZXh0NC5uZXh0ID0gMTM7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgICAgICAgIF9jb250ZXh0NC5uZXh0ID0gMTE7CiAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIF90aGlzLiRzdG9yZS5nZXR0ZXJzLmdldENvZGVMaXN0SXRlbXMoY29kZWxpc3Quc3Jma2V5KTsKCiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgMTE6CiAgICAgICAgICAgICAgICAgICAgICAgICAgX2l0ZW1zID0gX2NvbnRleHQ0LnNlbnQ7CiAgICAgICAgICAgICAgICAgICAgICAgICAganNvbkRhdGEuZm9yRWFjaChmdW5jdGlvbiAocm93KSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICByb3dbY29kZWxpc3QubmFtZV0gPSBfdGhpcy5nZXRDb2RlbGlzdFZhbHVlKF9pdGVtcywgcm93W2NvZGVsaXN0Lm5hbWVdLCBjb2RlbGlzdCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7CgogICAgICAgICAgICAgICAgICAgICAgICBjYXNlIDEzOgogICAgICAgICAgICAgICAgICAgICAgICBjYXNlICJlbmQiOgogICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDQuc3RvcCgpOwogICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgfSwgX2xvb3ApOwogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICBfaTIgPSAwLCBfY29kZWxpc3RDb2x1bW5zID0gY29kZWxpc3RDb2x1bW5zOwoKICAgICAgICAgICAgICBjYXNlIDQ6CiAgICAgICAgICAgICAgICBpZiAoIShfaTIgPCBfY29kZWxpc3RDb2x1bW5zLmxlbmd0aCkpIHsKICAgICAgICAgICAgICAgICAgX2NvbnRleHQ1Lm5leHQgPSA5OwogICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQ1LmRlbGVnYXRlWWllbGQoX2xvb3AoKSwgInQwIiwgNik7CgogICAgICAgICAgICAgIGNhc2UgNjoKICAgICAgICAgICAgICAgIF9pMisrOwogICAgICAgICAgICAgICAgX2NvbnRleHQ1Lm5leHQgPSA0OwogICAgICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgICAgIGNhc2UgOToKICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDUuYWJydXB0KCJyZXR1cm4iLCBqc29uRGF0YS5tYXAoZnVuY3Rpb24gKHYpIHsKICAgICAgICAgICAgICAgICAgcmV0dXJuIGZpbHRlclZhbC5tYXAoZnVuY3Rpb24gKGopIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gdltqXTsKICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICB9KSk7CgogICAgICAgICAgICAgIGNhc2UgMTA6CiAgICAgICAgICAgICAgY2FzZSAiZW5kIjoKICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDUuc3RvcCgpOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSwgX2NhbGxlZTQsIHRoaXMpOwogICAgICB9KSk7CgogICAgICBmdW5jdGlvbiBmb3JtYXRFeGNlbERhdGEoX3gzLCBfeDQpIHsKICAgICAgICByZXR1cm4gX2Zvcm1hdEV4Y2VsRGF0YS5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwogICAgICB9CgogICAgICByZXR1cm4gZm9ybWF0RXhjZWxEYXRhOwogICAgfSgpCiAgICAvKioNCiAgICAgKiDop6PmnpDku6PnoIHooajlkox2bGF1Ze+8jOiuvue9rml0ZW1zDQogICAgICoNCiAgICAgKiBAcHVibGljDQogICAgICogQHBhcmFtIHthbnlbXX0gaXRlbXMg5Luj56CB6KGo5pWw5o2uDQogICAgICogQHBhcmFtIHsqfSB2YWx1ZQ0KICAgICAqIEByZXR1cm5zIHsqfQ0KICAgICAqIEBtZW1iZXJvZiBNYWluQmFzZQ0KICAgICAqLwoKICB9LCB7CiAgICBrZXk6ICJnZXRDb2RlbGlzdFZhbHVlIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBnZXRDb2RlbGlzdFZhbHVlKGl0ZW1zLCB2YWx1ZSwgY29kZWxpc3QpIHsKICAgICAgdmFyIF90aGlzOSA9IHRoaXM7CgogICAgICBpZiAoIXZhbHVlKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuJHQoJ2NvZGVsaXN0LicgKyBjb2RlbGlzdC5zcmZrZXkgKyAnLmVtcHR5Jyk7CiAgICAgIH0KCiAgICAgIGlmIChpdGVtcykgewogICAgICAgIHZhciByZXN1bHQgPSBbXTsKCiAgICAgICAgaWYgKE9iamVjdC5pcyhjb2RlbGlzdC5yZW5kZXJNb2RlLCAibnVtYmVyIikpIHsKICAgICAgICAgIGl0ZW1zLm1hcChmdW5jdGlvbiAoX2l0ZW0sIGluZGV4KSB7CiAgICAgICAgICAgIHZhciBuVmFsdWUgPSBwYXJzZUludCh2YWx1ZSwgMTApOwogICAgICAgICAgICB2YXIgY29kZXZhbHVlID0gX2l0ZW0udmFsdWU7CgogICAgICAgICAgICBpZiAoKHBhcnNlSW50KGNvZGV2YWx1ZSwgMTApICYgblZhbHVlKSA+IDApIHsKICAgICAgICAgICAgICByZXN1bHQucHVzaChfaXRlbSk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0pOwogICAgICAgIH0gZWxzZSBpZiAoT2JqZWN0LmlzKGNvZGVsaXN0LnJlbmRlck1vZGUsICJzdHJpbmciKSkgewogICAgICAgICAgdmFyIGFycmF5VmFsdWUgPSB2YWx1ZS5zcGxpdChjb2RlbGlzdC52YWx1ZVNlcGFyYXRvcik7CiAgICAgICAgICBhcnJheVZhbHVlLm1hcChmdW5jdGlvbiAodmFsdWUsIGluZGV4KSB7CiAgICAgICAgICAgIHJlc3VsdC5wdXNoKFtdKTsKICAgICAgICAgICAgdmFyIHZhbHVlcyA9IE9iamVjdC5pcyhfdGhpczkuJHV0aWwudHlwZU9mKHZhbHVlKSwgJ251bWJlcicpID8gW3ZhbHVlXSA6IF90b0NvbnN1bWFibGVBcnJheSh2YWx1ZS5zcGxpdChjb2RlbGlzdC52YWx1ZVNlcGFyYXRvcikpOwogICAgICAgICAgICB2YWx1ZXMubWFwKGZ1bmN0aW9uICh2YWwsIG51bSkgewogICAgICAgICAgICAgIHZhciBpdGVtID0gX3RoaXM5LmdldEl0ZW0oaXRlbXMsIHZhbCwgY29kZWxpc3QpOwoKICAgICAgICAgICAgICBpZiAoaXRlbSkgewogICAgICAgICAgICAgICAgcmVzdWx0W2luZGV4XS5wdXNoKGl0ZW0pOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSk7CiAgICAgICAgICB9KTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgdmFyIHZhbHVlcyA9IE9iamVjdC5pcyh0aGlzLiR1dGlsLnR5cGVPZih2YWx1ZSksICdudW1iZXInKSA/IFt2YWx1ZV0gOiBfdG9Db25zdW1hYmxlQXJyYXkodmFsdWUuc3BsaXQoY29kZWxpc3QudmFsdWVTZXBhcmF0b3IpKTsKICAgICAgICAgIHZhbHVlcy5tYXAoZnVuY3Rpb24gKHZhbHVlLCBpbmRleCkgewogICAgICAgICAgICB2YXIgaXRlbSA9IF90aGlzOS5nZXRJdGVtKGl0ZW1zLCB2YWx1ZSwgY29kZWxpc3QpOwoKICAgICAgICAgICAgaWYgKGl0ZW0pIHsKICAgICAgICAgICAgICByZXN1bHQucHVzaChpdGVtKTsKICAgICAgICAgICAgfQogICAgICAgICAgfSk7CiAgICAgICAgfSAvLyDorr7nva5pdGVtcwoKCiAgICAgICAgaWYgKHJlc3VsdC5sZW5ndGggIT0gMCkgewogICAgICAgICAgcmV0dXJuIHJlc3VsdC5qb2luKGNvZGVsaXN0LnZhbHVlU2VwYXJhdG9yKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgcmV0dXJuIHZhbHVlOwogICAgICAgIH0KICAgICAgfQogICAgfQogICAgLyoqDQogICAgICog6I635Y+W5Luj56CB6aG5DQogICAgICoNCiAgICAgKiBAcHVibGljDQogICAgICogQHBhcmFtIHthbnlbXX0gaXRlbXMNCiAgICAgKiBAcGFyYW0geyp9IHZhbHVlDQogICAgICogQHJldHVybnMgeyp9DQogICAgICogQG1lbWJlcm9mIE1haW5CYXNlDQogICAgICovCgogIH0sIHsKICAgIGtleTogImdldEl0ZW0iLAogICAgdmFsdWU6IGZ1bmN0aW9uIGdldEl0ZW0oaXRlbXMsIHZhbHVlLCBjb2RlbGlzdCkgewogICAgICB2YXIgYXJyID0gaXRlbXMuZmlsdGVyKGZ1bmN0aW9uIChpdGVtKSB7CiAgICAgICAgcmV0dXJuIGl0ZW0udmFsdWUgPT0gdmFsdWU7CiAgICAgIH0pOwoKICAgICAgaWYgKGFyci5sZW5ndGggIT09IDEpIHsKICAgICAgICByZXR1cm4gdW5kZWZpbmVkOwogICAgICB9CgogICAgICBpZiAoT2JqZWN0LmlzKGNvZGVsaXN0LmNvZGVsaXN0VHlwZSwgJ1NUQVRJQycpKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuJHQoJ2NvZGVsaXN0LicgKyBjb2RlbGlzdC5zcmZrZXkgKyAnLicgKyBhcnJbMF0udmFsdWUpOwogICAgICB9IGVsc2UgewogICAgICAgIHJldHVybiBhcnJbMF0udGV4dDsKICAgICAgfQogICAgfQogICAgLyoqDQogICAgICog55Sf5ZG95ZGo5pyfDQogICAgICoNCiAgICAgKiBAbWVtYmVyb2YgTWFpbkJhc2UNCiAgICAgKi8KCiAgfSwgewogICAga2V5OiAiY3JlYXRlZCIsCiAgICB2YWx1ZTogZnVuY3Rpb24gY3JlYXRlZCgpIHsKICAgICAgdGhpcy5hZnRlckNyZWF0ZWQoKTsKICAgIH0KICAgIC8qKg0KICAgICAqIOaJp+ihjGNyZWF0ZWTlkI7nmoTpgLvovpENCiAgICAgKg0KICAgICAqICBAbWVtYmVyb2YgTWFpbkJhc2UNCiAgICAgKi8KCiAgfSwgewogICAga2V5OiAiYWZ0ZXJDcmVhdGVkIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBhZnRlckNyZWF0ZWQoKSB7CiAgICAgIHZhciBfdGhpczEwID0gdGhpczsKCiAgICAgIHRoaXMuc2V0Q29sU3RhdGUoKTsKCiAgICAgIGlmICh0aGlzLnZpZXdTdGF0ZSkgewogICAgICAgIHRoaXMudmlld1N0YXRlRXZlbnQgPSB0aGlzLnZpZXdTdGF0ZS5zdWJzY3JpYmUoZnVuY3Rpb24gKF9yZWYzKSB7CiAgICAgICAgICB2YXIgdGFnID0gX3JlZjMudGFnLAogICAgICAgICAgICAgIGFjdGlvbiA9IF9yZWYzLmFjdGlvbiwKICAgICAgICAgICAgICBkYXRhID0gX3JlZjMuZGF0YTsKCiAgICAgICAgICBpZiAoIU9iamVjdC5pcyh0YWcsIF90aGlzMTAubmFtZSkpIHsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgfQoKICAgICAgICAgIGlmIChPYmplY3QuaXMoJ2xvYWQnLCBhY3Rpb24pKSB7CiAgICAgICAgICAgIF90aGlzMTAubG9hZChkYXRhKTsKICAgICAgICAgIH0KCiAgICAgICAgICBpZiAoT2JqZWN0LmlzKCdyZW1vdmUnLCBhY3Rpb24pKSB7CiAgICAgICAgICAgIF90aGlzMTAucmVtb3ZlKGRhdGEpOwogICAgICAgICAgfQoKICAgICAgICAgIGlmIChPYmplY3QuaXMoJ3NhdmUnLCBhY3Rpb24pKSB7CiAgICAgICAgICAgIF90aGlzMTAuc2F2ZShkYXRhKTsKICAgICAgICAgIH0KICAgICAgICB9KTsKICAgICAgfQogICAgfQogICAgLyoqDQogICAgICogdnVlIOeUn+WRveWRqOacnw0KICAgICAqDQogICAgICogQG1lbWJlcm9mIE1haW5CYXNlDQogICAgICovCgogIH0sIHsKICAgIGtleTogImRlc3Ryb3llZCIsCiAgICB2YWx1ZTogZnVuY3Rpb24gZGVzdHJveWVkKCkgewogICAgICB0aGlzLmFmdGVyRGVzdHJveSgpOwogICAgfQogICAgLyoqDQogICAgICog5omn6KGMZGVzdHJveWVk5ZCO55qE6YC76L6RDQogICAgICoNCiAgICAgKiBAbWVtYmVyb2YgTWFpbkJhc2UNCiAgICAgKi8KCiAgfSwgewogICAga2V5OiAiYWZ0ZXJEZXN0cm95IiwKICAgIHZhbHVlOiBmdW5jdGlvbiBhZnRlckRlc3Ryb3koKSB7CiAgICAgIGlmICh0aGlzLnZpZXdTdGF0ZUV2ZW50KSB7CiAgICAgICAgdGhpcy52aWV3U3RhdGVFdmVudC51bnN1YnNjcmliZSgpOwogICAgICB9CiAgICB9CiAgICAvKioNCiAgICAgKiDojrflj5bpgInkuK3ooYzog6HmlbDmja4NCiAgICAgKg0KICAgICAqIEByZXR1cm5zIHthbnlbXX0NCiAgICAgKiBAbWVtYmVyb2YgTWFpbkJhc2UNCiAgICAgKi8KCiAgfSwgewogICAga2V5OiAiZ2V0U2VsZWN0aW9uIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBnZXRTZWxlY3Rpb24oKSB7CiAgICAgIHJldHVybiB0aGlzLnNlbGVjdGlvbnM7CiAgICB9CiAgICAvKioNCiAgICAgKiDooYzlj4zlh7vkuovku7YNCiAgICAgKg0KICAgICAqIEBwYXJhbSB7Kn0gJGV2ZW50DQogICAgICogQHJldHVybnMge3ZvaWR9DQogICAgICogQG1lbWJlcm9mIE1haW5CYXNlDQogICAgICovCgogIH0sIHsKICAgIGtleTogInJvd0RCTENsaWNrIiwKICAgIHZhbHVlOiBmdW5jdGlvbiByb3dEQkxDbGljaygkZXZlbnQpIHsKICAgICAgaWYgKCEkZXZlbnQgfHwgdGhpcy5hY3R1YWxJc09wZW5FZGl0IHx8IE9iamVjdC5pcyh0aGlzLmdyaWRSb3dBY3RpdmVNb2RlLCAwKSkgewogICAgICAgIHJldHVybjsKICAgICAgfQoKICAgICAgdGhpcy5zZWxlY3Rpb25zID0gW107CiAgICAgIHRoaXMuc2VsZWN0aW9ucy5wdXNoKEpTT04ucGFyc2UoSlNPTi5zdHJpbmdpZnkoJGV2ZW50KSkpOwogICAgICB2YXIgcmVmcyA9IHRoaXMuJHJlZnM7CgogICAgICBpZiAocmVmcy5tdWx0aXBsZVRhYmxlKSB7CiAgICAgICAgcmVmcy5tdWx0aXBsZVRhYmxlLmNsZWFyU2VsZWN0aW9uKCk7CiAgICAgICAgcmVmcy5tdWx0aXBsZVRhYmxlLnRvZ2dsZVJvd1NlbGVjdGlvbigkZXZlbnQpOwogICAgICB9CgogICAgICB0aGlzLiRlbWl0KCdyb3dkYmxjbGljaycsIHRoaXMuc2VsZWN0aW9ucyk7CiAgICAgIHRoaXMuJGVtaXQoJ3NlbGVjdGlvbmNoYW5nZScsIHRoaXMuc2VsZWN0aW9ucyk7CiAgICB9CiAgICAvKioNCiAgICAgKiDlpI3pgInmoYbmlbDmja7pgInkuK0NCiAgICAgKg0KICAgICAqIEBwYXJhbSB7Kn0gJGV2ZW50DQogICAgICogQHJldHVybnMge3ZvaWR9DQogICAgICogQG1lbWJlcm9mIE1haW5CYXNlDQogICAgICovCgogIH0sIHsKICAgIGtleTogInNlbGVjdCIsCiAgICB2YWx1ZTogZnVuY3Rpb24gc2VsZWN0KCRldmVudCkgewogICAgICBpZiAoISRldmVudCkgewogICAgICAgIHJldHVybjsKICAgICAgfQoKICAgICAgdGhpcy5zZWxlY3Rpb25zID0gW107CiAgICAgIHRoaXMuc2VsZWN0aW9ucyA9IF90b0NvbnN1bWFibGVBcnJheShKU09OLnBhcnNlKEpTT04uc3RyaW5naWZ5KCRldmVudCkpKTsKICAgICAgdGhpcy4kZW1pdCgnc2VsZWN0aW9uY2hhbmdlJywgdGhpcy5zZWxlY3Rpb25zKTsKICAgIH0KICAgIC8qKg0KICAgICAqIOWkjemAieahhuaVsOaNruWFqOmDqOmAieS4rQ0KICAgICAqDQogICAgICogQHBhcmFtIHsqfSAkZXZlbnQNCiAgICAgKiBAbWVtYmVyb2YgTWFpbkJhc2UNCiAgICAgKi8KCiAgfSwgewogICAga2V5OiAic2VsZWN0QWxsIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBzZWxlY3RBbGwoJGV2ZW50KSB7CiAgICAgIGlmICghJGV2ZW50KSB7CiAgICAgICAgcmV0dXJuOwogICAgICB9CgogICAgICB0aGlzLnNlbGVjdGlvbnMgPSBbXTsKICAgICAgdGhpcy5zZWxlY3Rpb25zID0gX3RvQ29uc3VtYWJsZUFycmF5KEpTT04ucGFyc2UoSlNPTi5zdHJpbmdpZnkoJGV2ZW50KSkpOwogICAgICB0aGlzLiRlbWl0KCdzZWxlY3Rpb25jaGFuZ2UnLCB0aGlzLnNlbGVjdGlvbnMpOwogICAgfQogICAgLyoqDQogICAgICog6KGM5Y2V5Ye76YCJ5LitDQogICAgICoNCiAgICAgKiBAcGFyYW0geyp9ICRldmVudA0KICAgICAqIEByZXR1cm5zIHt2b2lkfQ0KICAgICAqIEBtZW1iZXJvZiBNYWluQmFzZQ0KICAgICAqLwoKICB9LCB7CiAgICBrZXk6ICJyb3dDbGljayIsCiAgICB2YWx1ZTogZnVuY3Rpb24gcm93Q2xpY2soJGV2ZW50KSB7CiAgICAgIHZhciBpZkFsd2F5cyA9IGFyZ3VtZW50cy5sZW5ndGggPiAxICYmIGFyZ3VtZW50c1sxXSAhPT0gdW5kZWZpbmVkID8gYXJndW1lbnRzWzFdIDogZmFsc2U7CgogICAgICBpZiAoIWlmQWx3YXlzICYmICghJGV2ZW50IHx8IHRoaXMuYWN0dWFsSXNPcGVuRWRpdCkpIHsKICAgICAgICByZXR1cm47CiAgICAgIH0KCiAgICAgIGlmICh0aGlzLnN0b3BSb3dDbGljaykgewogICAgICAgIHRoaXMuc3RvcFJvd0NsaWNrID0gZmFsc2U7CiAgICAgICAgcmV0dXJuOwogICAgICB9CgogICAgICBpZiAodGhpcy5pc1NpbmdsZVNlbGVjdCkgewogICAgICAgIHRoaXMuc2VsZWN0aW9ucyA9IFtdOwogICAgICB9IC8vIOW3sumAieS4reWImeWIoOmZpO+8jOayoemAieS4reWImea3u+WKoAoKCiAgICAgIHZhciBzZWxlY3RJbmRleCA9IHRoaXMuc2VsZWN0aW9ucy5maW5kSW5kZXgoZnVuY3Rpb24gKGl0ZW0pIHsKICAgICAgICByZXR1cm4gT2JqZWN0LmlzKGl0ZW0ucGltcGF0ZW50LCAkZXZlbnQucGltcGF0ZW50KTsKICAgICAgfSk7CgogICAgICBpZiAoT2JqZWN0LmlzKHNlbGVjdEluZGV4LCAtMSkpIHsKICAgICAgICB0aGlzLnNlbGVjdGlvbnMucHVzaChKU09OLnBhcnNlKEpTT04uc3RyaW5naWZ5KCRldmVudCkpKTsKICAgICAgfSBlbHNlIHsKICAgICAgICB0aGlzLnNlbGVjdGlvbnMuc3BsaWNlKHNlbGVjdEluZGV4LCAxKTsKICAgICAgfQoKICAgICAgdmFyIHJlZnMgPSB0aGlzLiRyZWZzOwoKICAgICAgaWYgKHJlZnMubXVsdGlwbGVUYWJsZSkgewogICAgICAgIGlmICh0aGlzLmlzU2luZ2xlU2VsZWN0KSB7CiAgICAgICAgICByZWZzLm11bHRpcGxlVGFibGUuY2xlYXJTZWxlY3Rpb24oKTsKICAgICAgICAgIHJlZnMubXVsdGlwbGVUYWJsZS5zZXRDdXJyZW50Um93KCRldmVudCk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIHJlZnMubXVsdGlwbGVUYWJsZS50b2dnbGVSb3dTZWxlY3Rpb24oJGV2ZW50KTsKICAgICAgICB9CiAgICAgIH0KCiAgICAgIHRoaXMuJGVtaXQoJ3NlbGVjdGlvbmNoYW5nZScsIHRoaXMuc2VsZWN0aW9ucyk7CiAgICB9CiAgICAvKioNCiAgICAgKiDpobXpnaLlj5jljJYNCiAgICAgKg0KICAgICAqIEBwYXJhbSB7Kn0gJGV2ZW50DQogICAgICogQHJldHVybnMge3ZvaWR9DQogICAgICogQG1lbWJlcm9mIE1haW5CYXNlDQogICAgICovCgogIH0sIHsKICAgIGtleTogInBhZ2VPbkNoYW5nZSIsCiAgICB2YWx1ZTogZnVuY3Rpb24gcGFnZU9uQ2hhbmdlKCRldmVudCkgewogICAgICBpZiAoISRldmVudCkgewogICAgICAgIHJldHVybjsKICAgICAgfQoKICAgICAgaWYgKCRldmVudCA9PT0gdGhpcy5jdXJQYWdlKSB7CiAgICAgICAgcmV0dXJuOwogICAgICB9CgogICAgICB0aGlzLmN1clBhZ2UgPSAkZXZlbnQ7CiAgICAgIHRoaXMubG9hZCh7fSk7CiAgICB9CiAgICAvKioNCiAgICAgKiDliIbpobXmnaHmlbDlj5jljJYNCiAgICAgKg0KICAgICAqIEBwYXJhbSB7Kn0gJGV2ZW50DQogICAgICogQHJldHVybnMge3ZvaWR9DQogICAgICogQG1lbWJlcm9mIE1haW5CYXNlDQogICAgICovCgogIH0sIHsKICAgIGtleTogIm9uUGFnZVNpemVDaGFuZ2UiLAogICAgdmFsdWU6IGZ1bmN0aW9uIG9uUGFnZVNpemVDaGFuZ2UoJGV2ZW50KSB7CiAgICAgIGlmICghJGV2ZW50KSB7CiAgICAgICAgcmV0dXJuOwogICAgICB9CgogICAgICBpZiAoJGV2ZW50ID09PSB0aGlzLmxpbWl0KSB7CiAgICAgICAgcmV0dXJuOwogICAgICB9CgogICAgICB0aGlzLmxpbWl0ID0gJGV2ZW50OwoKICAgICAgaWYgKHRoaXMuY3VyUGFnZSA9PT0gMSkgewogICAgICAgIHRoaXMubG9hZCh7fSk7CiAgICAgIH0KICAgIH0KICAgIC8qKg0KICAgICAqIOWIhumhteWIt+aWsA0KICAgICAqDQogICAgICogQG1lbWJlcm9mIE1haW5CYXNlDQogICAgICovCgogIH0sIHsKICAgIGtleTogInBhZ2VSZWZyZXNoIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBwYWdlUmVmcmVzaCgpIHsKICAgICAgdGhpcy5sb2FkKHt9KTsKICAgIH0KICAgIC8qKg0KICAgICAqIOaOkuW6j+WPmOWMlg0KICAgICAqDQogICAgICogQHBhcmFtIHt7IGNvbHVtbjogYW55LCBwcm9wOiBhbnksIG9yZGVyOiBhbnkgfX0geyBjb2x1bW4sIHByb3AsIG9yZGVyIH0NCiAgICAgKiBAbWVtYmVyb2YgTWFpbkJhc2UNCiAgICAgKi8KCiAgfSwgewogICAga2V5OiAib25Tb3J0Q2hhbmdlIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBvblNvcnRDaGFuZ2UoX3JlZjQpIHsKICAgICAgdmFyIGNvbHVtbiA9IF9yZWY0LmNvbHVtbiwKICAgICAgICAgIHByb3AgPSBfcmVmNC5wcm9wLAogICAgICAgICAgb3JkZXIgPSBfcmVmNC5vcmRlcjsKICAgICAgdmFyIGRpciA9IE9iamVjdC5pcyhvcmRlciwgJ2FzY2VuZGluZycpID8gJ2FzYycgOiBPYmplY3QuaXMob3JkZXIsICdkZXNjZW5kaW5nJykgPyAnZGVzYycgOiAnJzsKCiAgICAgIGlmIChPYmplY3QuaXMoZGlyLCB0aGlzLm1pbm9yU29ydERpcikgJiYgT2JqZWN0LmlzKHRoaXMubWlub3JTb3J0UFNERUYsIHByb3ApKSB7CiAgICAgICAgcmV0dXJuOwogICAgICB9CgogICAgICB0aGlzLm1pbm9yU29ydERpciA9IGRpcjsKICAgICAgdGhpcy5taW5vclNvcnRQU0RFRiA9IHByb3AgPyBwcm9wIDogJyc7CiAgICAgIHRoaXMubG9hZCh7fSk7CiAgICB9CiAgICAvKioNCiAgICAgKiDooajmoLzooYzpgInkuK3moLflvI8NCiAgICAgKg0KICAgICAqIEBwYXJhbSB7eyByb3c6IGFueSwgcm93SW5kZXg6IGFueSB9fSB7IHJvdywgcm93SW5kZXggfQ0KICAgICAqIEByZXR1cm5zIHtzdHJpbmd9DQogICAgICogQG1lbWJlcm9mIE1haW5CYXNlDQogICAgICovCgogIH0sIHsKICAgIGtleTogIm9uUm93Q2xhc3NOYW1lIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBvblJvd0NsYXNzTmFtZShfcmVmNSkgewogICAgICB2YXIgcm93ID0gX3JlZjUucm93LAogICAgICAgICAgcm93SW5kZXggPSBfcmVmNS5yb3dJbmRleDsKICAgICAgdmFyIGluZGV4ID0gdGhpcy5zZWxlY3Rpb25zLmZpbmRJbmRleChmdW5jdGlvbiAoc2VsZWN0KSB7CiAgICAgICAgcmV0dXJuIE9iamVjdC5pcyhzZWxlY3Quc3Jma2V5LCByb3cuc3Jma2V5KTsKICAgICAgfSk7CiAgICAgIHJldHVybiBpbmRleCAhPT0gLTEgPyAnZ3JpZC1yb3ctc2VsZWN0JyA6ICcnOwogICAgfQogICAgLyoqDQogICAgICog55WM6Z2i6KGM5Li6DQogICAgICoNCiAgICAgKiBAcGFyYW0geyp9IHJvdw0KICAgICAqIEBwYXJhbSB7Kn0gdGFnDQogICAgICogQHBhcmFtIHsqfSAkZXZlbnQNCiAgICAgKiBAbWVtYmVyb2YgTWFpbkJhc2UNCiAgICAgKi8KCiAgfSwgewogICAga2V5OiAidWlBY3Rpb24iLAogICAgdmFsdWU6IGZ1bmN0aW9uIHVpQWN0aW9uKHJvdywgdGFnLCAkZXZlbnQpIHsKICAgICAgLy8gdGhpcy5yb3dDbGljayhyb3csIHRydWUpOwogICAgICAkZXZlbnQuc3RvcFByb3BhZ2F0aW9uKCk7CiAgICB9CiAgICAvKioNCiAgICAgKiDorr7nva7liJfnirbmgIENCiAgICAgKg0KICAgICAqIEBtZW1iZXJvZiBNYWluQmFzZQ0KICAgICAqLwoKICB9LCB7CiAgICBrZXk6ICJzZXRDb2xTdGF0ZSIsCiAgICB2YWx1ZTogZnVuY3Rpb24gc2V0Q29sU3RhdGUoKSB7CiAgICAgIHZhciBfdGhpczExID0gdGhpczsKCiAgICAgIHZhciBfZGF0YSA9IGxvY2FsU3RvcmFnZS5nZXRJdGVtKCdwaW1wYXRlbnRfbWFpbl9ncmlkJyk7CgogICAgICBpZiAoX2RhdGEpIHsKICAgICAgICB2YXIgY29sdW1ucyA9IEpTT04ucGFyc2UoX2RhdGEpOwogICAgICAgIGNvbHVtbnMuZm9yRWFjaChmdW5jdGlvbiAoY29sKSB7CiAgICAgICAgICB2YXIgY29sdW1uID0gX3RoaXMxMS5hbGxDb2x1bW5zLmZpbmQoZnVuY3Rpb24gKGl0ZW0pIHsKICAgICAgICAgICAgcmV0dXJuIE9iamVjdC5pcyhjb2wubmFtZSwgaXRlbS5uYW1lKTsKICAgICAgICAgIH0pOwoKICAgICAgICAgIGlmIChjb2x1bW4pIHsKICAgICAgICAgICAgT2JqZWN0LmFzc2lnbihjb2x1bW4sIGNvbCk7CiAgICAgICAgICB9CiAgICAgICAgfSk7CiAgICAgIH0KICAgIH0KICAgIC8qKg0KICAgICAqIOWIl+WPmOWMlg0KICAgICAqDQogICAgICogQG1lbWJlcm9mIE1haW5CYXNlDQogICAgICovCgogIH0sIHsKICAgIGtleTogIm9uQ29sQ2hhbmdlIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBvbkNvbENoYW5nZSgpIHsKICAgICAgbG9jYWxTdG9yYWdlLnNldEl0ZW0oJ3BpbXBhdGVudF9tYWluX2dyaWQnLCBKU09OLnN0cmluZ2lmeSh0aGlzLmFsbENvbHVtbnMpKTsKICAgIH0KICAgIC8qKg0KICAgICAqIOiOt+WPluWIl+eKtuaAgQ0KICAgICAqDQogICAgICogQHBhcmFtIHtzdHJpbmd9IG5hbWUNCiAgICAgKiBAcmV0dXJucyB7Ym9vbGVhbn0NCiAgICAgKiBAbWVtYmVyb2YgTWFpbkJhc2UNCiAgICAgKi8KCiAgfSwgewogICAga2V5OiAiZ2V0Q29sdW1uU3RhdGUiLAogICAgdmFsdWU6IGZ1bmN0aW9uIGdldENvbHVtblN0YXRlKG5hbWUpIHsKICAgICAgdmFyIGNvbHVtbiA9IHRoaXMuYWxsQ29sdW1ucy5maW5kKGZ1bmN0aW9uIChjb2wpIHsKICAgICAgICByZXR1cm4gT2JqZWN0LmlzKG5hbWUsIGNvbC5uYW1lKTsKICAgICAgfSk7CiAgICAgIHJldHVybiBjb2x1bW4uc2hvdyA/IHRydWUgOiBmYWxzZTsKICAgIH0KICAgIC8qKg0KICAgICAqIOihqOagvOWIl+aYr+WQpuiHqumAguW6lOW4g+WxgA0KICAgICAqDQogICAgICogQHJlYWRvbmx5DQogICAgICogQHR5cGUge2Jvb2xlYW59DQogICAgICogQG1lbWJlcm9mIE1haW5CYXNlDQogICAgICovCgogIH0sIHsKICAgIGtleTogInNhdmUiLAoKICAgIC8qKg0KICAgICAqIOS/neWtmA0KICAgICAqDQogICAgICogQHBhcmFtIHsqfSAkZXZlbnQNCiAgICAgKiBAcmV0dXJucyB7UHJvbWlzZTxhbnk+fQ0KICAgICAqIEBtZW1iZXJvZiBNYWluQmFzZQ0KICAgICAqLwogICAgdmFsdWU6IGZ1bmN0aW9uICgpIHsKICAgICAgdmFyIF9zYXZlID0gX2FzeW5jVG9HZW5lcmF0b3IoCiAgICAgIC8qI19fUFVSRV9fKi8KICAgICAgcmVnZW5lcmF0b3JSdW50aW1lLm1hcmsoZnVuY3Rpb24gX2NhbGxlZTUoYXJncywgcGFyYW1zLCAkZXZlbnQsIHhEYXRhKSB7CiAgICAgICAgdmFyIF90aGlzMTIgPSB0aGlzOwoKICAgICAgICB2YXIgX3RoaXMsIHN1Y2Nlc3NJdGVtcywgZXJyb3JJdGVtcywgZXJyb3JNZXNzYWdlLCBfaXRlcmF0b3JOb3JtYWxDb21wbGV0aW9uMiwgX2RpZEl0ZXJhdG9yRXJyb3IyLCBfaXRlcmF0b3JFcnJvcjIsIF9pdGVyYXRvcjIsIF9zdGVwMiwgaXRlbSwgcmVzcG9uc2UsIF9yZXNwb25zZTsKCiAgICAgICAgcmV0dXJuIHJlZ2VuZXJhdG9yUnVudGltZS53cmFwKGZ1bmN0aW9uIF9jYWxsZWU1JChfY29udGV4dDYpIHsKICAgICAgICAgIHdoaWxlICgxKSB7CiAgICAgICAgICAgIHN3aXRjaCAoX2NvbnRleHQ2LnByZXYgPSBfY29udGV4dDYubmV4dCkgewogICAgICAgICAgICAgIGNhc2UgMDoKICAgICAgICAgICAgICAgIF90aGlzID0gdGhpczsKICAgICAgICAgICAgICAgIF9jb250ZXh0Ni5uZXh0ID0gMzsKICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLnZhbGlkYXRlQWxsKCk7CgogICAgICAgICAgICAgIGNhc2UgMzoKICAgICAgICAgICAgICAgIGlmIChfY29udGV4dDYuc2VudCkgewogICAgICAgICAgICAgICAgICBfY29udGV4dDYubmV4dCA9IDY7CiAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIHRoaXMuJE5vdGljZS5lcnJvcih7CiAgICAgICAgICAgICAgICAgIHRpdGxlOiAn6ZSZ6K+vJywKICAgICAgICAgICAgICAgICAgZGVzYzogJ+WAvOinhOWImeagoemqjOW8guW4uCcKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0Ni5hYnJ1cHQoInJldHVybiIsIFtdKTsKCiAgICAgICAgICAgICAgY2FzZSA2OgogICAgICAgICAgICAgICAgc3VjY2Vzc0l0ZW1zID0gW107CiAgICAgICAgICAgICAgICBlcnJvckl0ZW1zID0gW107CiAgICAgICAgICAgICAgICBlcnJvck1lc3NhZ2UgPSBbXTsKICAgICAgICAgICAgICAgIF9pdGVyYXRvck5vcm1hbENvbXBsZXRpb24yID0gdHJ1ZTsKICAgICAgICAgICAgICAgIF9kaWRJdGVyYXRvckVycm9yMiA9IGZhbHNlOwogICAgICAgICAgICAgICAgX2l0ZXJhdG9yRXJyb3IyID0gdW5kZWZpbmVkOwogICAgICAgICAgICAgICAgX2NvbnRleHQ2LnByZXYgPSAxMjsKICAgICAgICAgICAgICAgIF9pdGVyYXRvcjIgPSBfdGhpcy5pdGVtc1tTeW1ib2wuaXRlcmF0b3JdKCk7CgogICAgICAgICAgICAgIGNhc2UgMTQ6CiAgICAgICAgICAgICAgICBpZiAoX2l0ZXJhdG9yTm9ybWFsQ29tcGxldGlvbjIgPSAoX3N0ZXAyID0gX2l0ZXJhdG9yMi5uZXh0KCkpLmRvbmUpIHsKICAgICAgICAgICAgICAgICAgX2NvbnRleHQ2Lm5leHQgPSA0OTsKICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgaXRlbSA9IF9zdGVwMi52YWx1ZTsKICAgICAgICAgICAgICAgIF9jb250ZXh0Ni5wcmV2ID0gMTY7CgogICAgICAgICAgICAgICAgaWYgKCFPYmplY3QuaXMoaXRlbS5yb3dEYXRhU3RhdGUsICdjcmVhdGUnKSkgewogICAgICAgICAgICAgICAgICBfY29udGV4dDYubmV4dCA9IDI5OwogICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBpZiAodGhpcy5jcmVhdGVBY3Rpb24pIHsKICAgICAgICAgICAgICAgICAgX2NvbnRleHQ2Lm5leHQgPSAyMjsKICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgdGhpcy4kTm90aWNlLmVycm9yKHsKICAgICAgICAgICAgICAgICAgdGl0bGU6ICfplJnor68nLAogICAgICAgICAgICAgICAgICBkZXNjOiAnUElNUEFURU5UUEFURU5UR3JpZFZpZXfop4blm77ooajmoLxjcmVhdGVBY3Rpb27lj4LmlbDmnKrphY3nva4nCiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIF9jb250ZXh0Ni5uZXh0ID0gMjc7CiAgICAgICAgICAgICAgICBicmVhazsKCiAgICAgICAgICAgICAgY2FzZSAyMjoKICAgICAgICAgICAgICAgIE9iamVjdC5hc3NpZ24oaXRlbSwgewogICAgICAgICAgICAgICAgICB2aWV3cGFyYW1zOiB0aGlzLnZpZXdwYXJhbXMKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgX2NvbnRleHQ2Lm5leHQgPSAyNTsKICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLnNlcnZpY2UuYWRkKHRoaXMuY3JlYXRlQWN0aW9uLCBKU09OLnBhcnNlKEpTT04uc3RyaW5naWZ5KHRoaXMuY29udGV4dCkpLCBpdGVtLCB0aGlzLnNob3dCdXN5SW5kaWNhdG9yKTsKCiAgICAgICAgICAgICAgY2FzZSAyNToKICAgICAgICAgICAgICAgIHJlc3BvbnNlID0gX2NvbnRleHQ2LnNlbnQ7CiAgICAgICAgICAgICAgICBzdWNjZXNzSXRlbXMucHVzaChKU09OLnBhcnNlKEpTT04uc3RyaW5naWZ5KHJlc3BvbnNlLmRhdGEpKSk7CgogICAgICAgICAgICAgIGNhc2UgMjc6CiAgICAgICAgICAgICAgICBfY29udGV4dDYubmV4dCA9IDQwOwogICAgICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgICAgIGNhc2UgMjk6CiAgICAgICAgICAgICAgICBpZiAoIU9iamVjdC5pcyhpdGVtLnJvd0RhdGFTdGF0ZSwgJ3VwZGF0ZScpKSB7CiAgICAgICAgICAgICAgICAgIF9jb250ZXh0Ni5uZXh0ID0gNDA7CiAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIGlmICh0aGlzLnVwZGF0ZUFjdGlvbikgewogICAgICAgICAgICAgICAgICBfY29udGV4dDYubmV4dCA9IDM0OwogICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICB0aGlzLiROb3RpY2UuZXJyb3IoewogICAgICAgICAgICAgICAgICB0aXRsZTogJ+mUmeivrycsCiAgICAgICAgICAgICAgICAgIGRlc2M6ICdQSU1QQVRFTlRQQVRFTlRHcmlkVmlld+inhuWbvuihqOagvHVwZGF0ZUFjdGlvbuWPguaVsOacqumFjee9ricKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgX2NvbnRleHQ2Lm5leHQgPSA0MDsKICAgICAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgICAgICBjYXNlIDM0OgogICAgICAgICAgICAgICAgT2JqZWN0LmFzc2lnbihpdGVtLCB7CiAgICAgICAgICAgICAgICAgIHZpZXdwYXJhbXM6IHRoaXMudmlld3BhcmFtcwogICAgICAgICAgICAgICAgfSk7CgogICAgICAgICAgICAgICAgaWYgKGl0ZW0ucGltcGF0ZW50KSB7CiAgICAgICAgICAgICAgICAgIE9iamVjdC5hc3NpZ24odGhpcy5jb250ZXh0LCB7CiAgICAgICAgICAgICAgICAgICAgcGltcGF0ZW50OiBpdGVtLnBpbXBhdGVudAogICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBfY29udGV4dDYubmV4dCA9IDM4OwogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuc2VydmljZS5hZGQodGhpcy51cGRhdGVBY3Rpb24sIEpTT04ucGFyc2UoSlNPTi5zdHJpbmdpZnkodGhpcy5jb250ZXh0KSksIGl0ZW0sIHRoaXMuc2hvd0J1c3lJbmRpY2F0b3IpOwoKICAgICAgICAgICAgICBjYXNlIDM4OgogICAgICAgICAgICAgICAgX3Jlc3BvbnNlID0gX2NvbnRleHQ2LnNlbnQ7CiAgICAgICAgICAgICAgICBzdWNjZXNzSXRlbXMucHVzaChKU09OLnBhcnNlKEpTT04uc3RyaW5naWZ5KF9yZXNwb25zZS5kYXRhKSkpOwoKICAgICAgICAgICAgICBjYXNlIDQwOgogICAgICAgICAgICAgICAgX2NvbnRleHQ2Lm5leHQgPSA0NjsKICAgICAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgICAgICBjYXNlIDQyOgogICAgICAgICAgICAgICAgX2NvbnRleHQ2LnByZXYgPSA0MjsKICAgICAgICAgICAgICAgIF9jb250ZXh0Ni50MCA9IF9jb250ZXh0NlsiY2F0Y2giXSgxNik7CiAgICAgICAgICAgICAgICBlcnJvckl0ZW1zLnB1c2goSlNPTi5wYXJzZShKU09OLnN0cmluZ2lmeShpdGVtKSkpOwogICAgICAgICAgICAgICAgZXJyb3JNZXNzYWdlLnB1c2goX2NvbnRleHQ2LnQwKTsKCiAgICAgICAgICAgICAgY2FzZSA0NjoKICAgICAgICAgICAgICAgIF9pdGVyYXRvck5vcm1hbENvbXBsZXRpb24yID0gdHJ1ZTsKICAgICAgICAgICAgICAgIF9jb250ZXh0Ni5uZXh0ID0gMTQ7CiAgICAgICAgICAgICAgICBicmVhazsKCiAgICAgICAgICAgICAgY2FzZSA0OToKICAgICAgICAgICAgICAgIF9jb250ZXh0Ni5uZXh0ID0gNTU7CiAgICAgICAgICAgICAgICBicmVhazsKCiAgICAgICAgICAgICAgY2FzZSA1MToKICAgICAgICAgICAgICAgIF9jb250ZXh0Ni5wcmV2ID0gNTE7CiAgICAgICAgICAgICAgICBfY29udGV4dDYudDEgPSBfY29udGV4dDZbImNhdGNoIl0oMTIpOwogICAgICAgICAgICAgICAgX2RpZEl0ZXJhdG9yRXJyb3IyID0gdHJ1ZTsKICAgICAgICAgICAgICAgIF9pdGVyYXRvckVycm9yMiA9IF9jb250ZXh0Ni50MTsKCiAgICAgICAgICAgICAgY2FzZSA1NToKICAgICAgICAgICAgICAgIF9jb250ZXh0Ni5wcmV2ID0gNTU7CiAgICAgICAgICAgICAgICBfY29udGV4dDYucHJldiA9IDU2OwoKICAgICAgICAgICAgICAgIGlmICghX2l0ZXJhdG9yTm9ybWFsQ29tcGxldGlvbjIgJiYgX2l0ZXJhdG9yMlsicmV0dXJuIl0gIT0gbnVsbCkgewogICAgICAgICAgICAgICAgICBfaXRlcmF0b3IyWyJyZXR1cm4iXSgpOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICBjYXNlIDU4OgogICAgICAgICAgICAgICAgX2NvbnRleHQ2LnByZXYgPSA1ODsKCiAgICAgICAgICAgICAgICBpZiAoIV9kaWRJdGVyYXRvckVycm9yMikgewogICAgICAgICAgICAgICAgICBfY29udGV4dDYubmV4dCA9IDYxOwogICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICB0aHJvdyBfaXRlcmF0b3JFcnJvcjI7CgogICAgICAgICAgICAgIGNhc2UgNjE6CiAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQ2LmZpbmlzaCg1OCk7CgogICAgICAgICAgICAgIGNhc2UgNjI6CiAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQ2LmZpbmlzaCg1NSk7CgogICAgICAgICAgICAgIGNhc2UgNjM6CiAgICAgICAgICAgICAgICB0aGlzLiRlbWl0KCdzYXZlJywgc3VjY2Vzc0l0ZW1zKTsKICAgICAgICAgICAgICAgIHRoaXMucmVmcmVzaChbXSk7CgogICAgICAgICAgICAgICAgaWYgKGVycm9ySXRlbXMubGVuZ3RoID09PSAwKSB7CiAgICAgICAgICAgICAgICAgIHRoaXMuJE5vdGljZS5zdWNjZXNzKHsKICAgICAgICAgICAgICAgICAgICB0aXRsZTogJycsCiAgICAgICAgICAgICAgICAgICAgZGVzYzogJ+S/neWtmOaIkOWKnyEnCiAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgZXJyb3JJdGVtcy5mb3JFYWNoKGZ1bmN0aW9uIChpdGVtLCBpbmRleCkgewogICAgICAgICAgICAgICAgICAgIF90aGlzMTIuJE5vdGljZS5lcnJvcih7CiAgICAgICAgICAgICAgICAgICAgICB0aXRsZTogJ+S/neWtmOWksei0pScsCiAgICAgICAgICAgICAgICAgICAgICBkZXNjOiBpdGVtLm1ham9yZW50aXR5bmFtZSArICfkv53lrZjlpLHotKXvvIEnCiAgICAgICAgICAgICAgICAgICAgfSk7CgogICAgICAgICAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoZXJyb3JNZXNzYWdlW2luZGV4XSk7CiAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDYuYWJydXB0KCJyZXR1cm4iLCBzdWNjZXNzSXRlbXMpOwoKICAgICAgICAgICAgICBjYXNlIDY3OgogICAgICAgICAgICAgIGNhc2UgImVuZCI6CiAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQ2LnN0b3AoKTsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0sIF9jYWxsZWU1LCB0aGlzLCBbWzEyLCA1MSwgNTUsIDYzXSwgWzE2LCA0Ml0sIFs1NiwsIDU4LCA2Ml1dKTsKICAgICAgfSkpOwoKICAgICAgZnVuY3Rpb24gc2F2ZShfeDUsIF94NiwgX3g3LCBfeDgpIHsKICAgICAgICByZXR1cm4gX3NhdmUuYXBwbHkodGhpcywgYXJndW1lbnRzKTsKICAgICAgfQoKICAgICAgcmV0dXJuIHNhdmU7CiAgICB9KCkKICAgIC8qKg0KICAgICAqIOaWsOW7uuihjA0KICAgICAqDQogICAgICogQHBhcmFtIHsqfSAkZXZlbnQNCiAgICAgKiBAcmV0dXJucyB7dm9pZH0NCiAgICAgKiBAbWVtYmVyb2YgTWFpbkJhc2UNCiAgICAgKi8KCiAgfSwgewogICAga2V5OiAibmV3Um93IiwKICAgIHZhbHVlOiBmdW5jdGlvbiBuZXdSb3coYXJncywgcGFyYW1zLCAkZXZlbnQsIHhEYXRhKSB7CiAgICAgIHZhciBfdGhpczEzID0gdGhpczsKCiAgICAgIGlmICghdGhpcy5sb2FkZHJhZnRBY3Rpb24pIHsKICAgICAgICB0aGlzLiROb3RpY2UuZXJyb3IoewogICAgICAgICAgdGl0bGU6ICfplJnor68nLAogICAgICAgICAgZGVzYzogJ1BJTVBBVEVOVFBBVEVOVEdyaWRWaWV36KeG5Zu+6KGo5qC8bG9hZGRyYWZ0QWN0aW9u5Y+C5pWw5pyq6YWN572uJwogICAgICAgIH0pOwogICAgICAgIHJldHVybjsKICAgICAgfQoKICAgICAgdmFyIF90aGlzID0gdGhpczsKCiAgICAgIE9iamVjdC5hc3NpZ24oYXJnc1swXSwgewogICAgICAgIHZpZXdwYXJhbXM6IHRoaXMudmlld3BhcmFtcwogICAgICB9KTsKICAgICAgdmFyIHBvc3QgPSB0aGlzLnNlcnZpY2UubG9hZERyYWZ0KHRoaXMubG9hZGRyYWZ0QWN0aW9uLCBKU09OLnBhcnNlKEpTT04uc3RyaW5naWZ5KHRoaXMuY29udGV4dCkpLCBhcmdzWzBdLCB0aGlzLnNob3dCdXN5SW5kaWNhdG9yKTsKICAgICAgcG9zdC50aGVuKGZ1bmN0aW9uIChyZXNwb25zZSkgewogICAgICAgIGlmICghcmVzcG9uc2Uuc3RhdHVzIHx8IHJlc3BvbnNlLnN0YXR1cyAhPT0gMjAwKSB7CiAgICAgICAgICBpZiAocmVzcG9uc2UuZXJyb3JNZXNzYWdlKSB7CiAgICAgICAgICAgIF90aGlzMTMuJE5vdGljZS5lcnJvcih7CiAgICAgICAgICAgICAgdGl0bGU6ICfplJnor68nLAogICAgICAgICAgICAgIGRlc2M6IHJlc3BvbnNlLmVycm9yTWVzc2FnZQogICAgICAgICAgICB9KTsKICAgICAgICAgIH0KCiAgICAgICAgICByZXR1cm47CiAgICAgICAgfQoKICAgICAgICB2YXIgZGF0YSA9IHJlc3BvbnNlLmRhdGE7CgogICAgICAgIF90aGlzMTMuY3JlYXRlRGVmYXVsdChkYXRhKTsKCiAgICAgICAgZGF0YS5yb3dEYXRhU3RhdGUgPSAiY3JlYXRlIjsKCiAgICAgICAgX3RoaXMuaXRlbXMucHVzaChkYXRhKTsKCiAgICAgICAgX3RoaXMuZ3JpZEl0ZW1zTW9kZWwucHVzaChfdGhpcy5nZXRHcmlkUm93TW9kZWwoKSk7CiAgICAgIH0pWyJjYXRjaCJdKGZ1bmN0aW9uIChyZXNwb25zZSkgewogICAgICAgIGlmIChyZXNwb25zZSAmJiByZXNwb25zZS5zdGF0dXMgPT09IDQwMSkgewogICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KCiAgICAgICAgaWYgKCFyZXNwb25zZSB8fCAhcmVzcG9uc2Uuc3RhdHVzIHx8ICFyZXNwb25zZS5kYXRhKSB7CiAgICAgICAgICBfdGhpczEzLiROb3RpY2UuZXJyb3IoewogICAgICAgICAgICB0aXRsZTogJ+mUmeivrycsCiAgICAgICAgICAgIGRlc2M6ICfns7vnu5/lvILluLgnCiAgICAgICAgICB9KTsKCiAgICAgICAgICByZXR1cm47CiAgICAgICAgfQogICAgICB9KTsKICAgIH0KICAgIC8qKg0KICAgICAqIOihqOagvOe8lui+kemhueWAvOWPmOabtA0KICAgICAqDQogICAgICogQHBhcmFtIHJvdyDooYzmlbDmja4NCiAgICAgKiBAcGFyYW0ge3sgbmFtZTogc3RyaW5nLCB2YWx1ZTogYW55IH19ICRldmVudA0KICAgICAqIEByZXR1cm5zIHt2b2lkfQ0KICAgICAqIEBtZW1iZXJvZiBNYWluQmFzZQ0KICAgICAqLwoKICB9LCB7CiAgICBrZXk6ICJvbkdyaWRJdGVtVmFsdWVDaGFuZ2UiLAogICAgdmFsdWU6IGZ1bmN0aW9uIG9uR3JpZEl0ZW1WYWx1ZUNoYW5nZShyb3csICRldmVudCwgcm93SW5kZXgpIHsKICAgICAgaWYgKCEkZXZlbnQpIHsKICAgICAgICByZXR1cm47CiAgICAgIH0KCiAgICAgIGlmICghJGV2ZW50Lm5hbWUgfHwgT2JqZWN0LmlzKCRldmVudC5uYW1lLCAnJykgfHwgIXJvdy5oYXNPd25Qcm9wZXJ0eSgkZXZlbnQubmFtZSkpIHsKICAgICAgICByZXR1cm47CiAgICAgIH0KCiAgICAgIHJvd1skZXZlbnQubmFtZV0gPSAkZXZlbnQudmFsdWU7CiAgICAgIHRoaXMuZ3JpZEVkaXRJdGVtQ2hhbmdlKHJvdywgJGV2ZW50Lm5hbWUsICRldmVudC52YWx1ZSwgcm93SW5kZXgpOwogICAgfQogICAgLyoqDQogICAgICog6KGo5qC857yW6L6R6aG55YC85Y+Y5YyWDQogICAgICoNCiAgICAgKiBAcHVibGljDQogICAgICogQHBhcmFtIHJvdyDooYzmlbDmja4NCiAgICAgKiBAcGFyYW0gcHJvcGVydHkg5YiX57yW6L6R6aG55ZCNDQogICAgICogQHBhcmFtIHJvdyDliJfnvJbovpHpobnlgLwNCiAgICAgKiBAcmV0dXJucyB7dm9pZH0NCiAgICAgKiBAbWVtYmVyb2YgTWFpbkJhc2UNCiAgICAgKi8KCiAgfSwgewogICAga2V5OiAiZ3JpZEVkaXRJdGVtQ2hhbmdlIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBncmlkRWRpdEl0ZW1DaGFuZ2Uocm93LCBwcm9wZXJ0eSwgdmFsdWUsIHJvd0luZGV4KSB7CiAgICAgIHJvdy5yb3dEYXRhU3RhdGUgPSByb3cucm93RGF0YVN0YXRlID8gcm93LnJvd0RhdGFTdGF0ZSA6ICJ1cGRhdGUiOwogICAgICB0aGlzLnZhbGlkYXRlKHByb3BlcnR5LCByb3csIHJvd0luZGV4KTsKICAgIH0KICAgIC8qKg0KICAgICAqIOihqOagvOe8lui+kemhueabtOaWsA0KICAgICAqDQogICAgICogQHBhcmFtIHtzdHJpbmd9IG1vZGUg55WM6Z2i6KGM5Li65ZCN56ewDQogICAgICogQHBhcmFtIHsqfSBbZGF0YT17fV0g6K+35rGC5pWw5o2uDQogICAgICogQHBhcmFtIHtzdHJpbmdbXX0gdXBkYXRlRGV0YWlscyDmm7TmlrDpobkNCiAgICAgKiBAcGFyYW0ge2Jvb2xlYW59IFtzaG93bG9hZGluZ10g5piv5ZCm5pi+56S65Yqg6L2954q25oCBDQogICAgICogQHJldHVybnMge3ZvaWR9DQogICAgICogQG1lbWJlcm9mIE1haW5CYXNlDQogICAgICovCgogIH0sIHsKICAgIGtleTogInVwZGF0ZUdyaWRFZGl0SXRlbSIsCiAgICB2YWx1ZTogZnVuY3Rpb24gdXBkYXRlR3JpZEVkaXRJdGVtKG1vZGUpIHsKICAgICAgdmFyIF90aGlzMTQgPSB0aGlzOwoKICAgICAgdmFyIGRhdGEgPSBhcmd1bWVudHMubGVuZ3RoID4gMSAmJiBhcmd1bWVudHNbMV0gIT09IHVuZGVmaW5lZCA/IGFyZ3VtZW50c1sxXSA6IHt9OwogICAgICB2YXIgdXBkYXRlRGV0YWlscyA9IGFyZ3VtZW50cy5sZW5ndGggPiAyID8gYXJndW1lbnRzWzJdIDogdW5kZWZpbmVkOwogICAgICB2YXIgc2hvd2xvYWRpbmcgPSBhcmd1bWVudHMubGVuZ3RoID4gMyA/IGFyZ3VtZW50c1szXSA6IHVuZGVmaW5lZDsKCiAgICAgIGlmICghbW9kZSB8fCBtb2RlICYmIE9iamVjdC5pcyhtb2RlLCAnJykpIHsKICAgICAgICByZXR1cm47CiAgICAgIH0KCiAgICAgIHZhciBhcmcgPSBKU09OLnBhcnNlKEpTT04uc3RyaW5naWZ5KGRhdGEpKTsKICAgICAgT2JqZWN0LmFzc2lnbihhcmcsIHsKICAgICAgICB2aWV3cGFyYW1zOiB0aGlzLnZpZXdwYXJhbXMKICAgICAgfSk7CiAgICAgIHZhciBwb3N0ID0gdGhpcy5zZXJ2aWNlLmZyb250TG9naWMobW9kZSwgSlNPTi5wYXJzZShKU09OLnN0cmluZ2lmeSh0aGlzLmNvbnRleHQpKSwgYXJnLCBzaG93bG9hZGluZyk7CiAgICAgIHBvc3QudGhlbihmdW5jdGlvbiAocmVzcG9uc2UpIHsKICAgICAgICBpZiAoIXJlc3BvbnNlIHx8IHJlc3BvbnNlLnN0YXR1cyAhPT0gMjAwKSB7CiAgICAgICAgICBfdGhpczE0LiROb3RpY2UuZXJyb3IoewogICAgICAgICAgICB0aXRsZTogJ+mUmeivrycsCiAgICAgICAgICAgIGRlc2M6ICfooajljZXpobnmm7TmlrDlpLHotKUnCiAgICAgICAgICB9KTsKCiAgICAgICAgICByZXR1cm47CiAgICAgICAgfQoKICAgICAgICB2YXIgX2RhdGEgPSByZXNwb25zZS5kYXRhOwoKICAgICAgICBpZiAoIV9kYXRhKSB7CiAgICAgICAgICByZXR1cm47CiAgICAgICAgfQoKICAgICAgICB1cGRhdGVEZXRhaWxzLmZvckVhY2goZnVuY3Rpb24gKG5hbWUpIHsKICAgICAgICAgIGlmICghX2RhdGEuaGFzT3duUHJvcGVydHkobmFtZSkpIHsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgfQoKICAgICAgICAgIGRhdGFbbmFtZV0gPSBfZGF0YVtuYW1lXTsKICAgICAgICB9KTsKICAgICAgfSlbImNhdGNoIl0oZnVuY3Rpb24gKHJlc3BvbnNlKSB7CiAgICAgICAgaWYgKHJlc3BvbnNlICYmIHJlc3BvbnNlLnN0YXR1cyA9PT0gNDAxKSB7CiAgICAgICAgICByZXR1cm47CiAgICAgICAgfQoKICAgICAgICBpZiAoIXJlc3BvbnNlIHx8ICFyZXNwb25zZS5zdGF0dXMgfHwgIXJlc3BvbnNlLmRhdGEpIHsKICAgICAgICAgIF90aGlzMTQuJE5vdGljZS5lcnJvcih7CiAgICAgICAgICAgIHRpdGxlOiAn6ZSZ6K+vJywKICAgICAgICAgICAgZGVzYzogJ+ezu+e7n+W8guW4uCcKICAgICAgICAgIH0pOwoKICAgICAgICAgIHJldHVybjsKICAgICAgICB9CiAgICAgIH0pOwogICAgfQogICAgLyoqDQogICAgICog6I635Y+W5a+55bqU6KGMY2xhc3MNCiAgICAgKg0KICAgICAqIEBwYXJhbSB7Kn0gJGFyZ3Mgcm93IOihjOaVsOaNru+8jHJvd0luZGV4IOihjOe0ouW8lQ0KICAgICAqIEByZXR1cm5zIHt2b2lkfQ0KICAgICAqIEBtZW1iZXJvZiBNYWluQmFzZQ0KICAgICAqLwoKICB9LCB7CiAgICBrZXk6ICJnZXRSb3dDbGFzc05hbWUiLAogICAgdmFsdWU6IGZ1bmN0aW9uIGdldFJvd0NsYXNzTmFtZShhcmdzKSB7CiAgICAgIHZhciBpc1NlbGVjdGVkID0gdGhpcy5zZWxlY3Rpb25zLnNvbWUoZnVuY3Rpb24gKGl0ZW0pIHsKICAgICAgICByZXR1cm4gT2JqZWN0LmlzKGl0ZW0ucGltcGF0ZW50LCBhcmdzLnJvdy5waW1wYXRlbnQpOwogICAgICB9KTsKICAgICAgcmV0dXJuIGlzU2VsZWN0ZWQgPyAiZ3JpZC1zZWxlY3RlZC1yb3ciIDogIiI7CiAgICB9CiAgICAvKioNCiAgICAgKiDojrflj5blr7nlupTliJdjbGFzcw0KICAgICAqDQogICAgICogQHBhcmFtIHsqfSAkYXJncyByb3cg6KGM5pWw5o2u77yMY29sdW1uIOWIl+aVsOaNru+8jHJvd0luZGV4IOihjOe0ouW8le+8jOWIl+e0ouW8lQ0KICAgICAqIEByZXR1cm5zIHt2b2lkfQ0KICAgICAqIEBtZW1iZXJvZiBNYWluQmFzZQ0KICAgICAqLwoKICB9LCB7CiAgICBrZXk6ICJnZXRDZWxsQ2xhc3NOYW1lIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBnZXRDZWxsQ2xhc3NOYW1lKGFyZ3MpIHsKICAgICAgdmFyIGhhc1Jvd0VkaXQgPSB7CiAgICAgICAgJ3psaCc6IHRydWUsCiAgICAgICAgJ3BpbXBhdGVudG5hbWUnOiB0cnVlLAogICAgICAgICd6bGhxc2onOiB0cnVlLAogICAgICAgICd6bHB6Z2InOiB0cnVlLAogICAgICAgICdlbmNsb2x1cmUnOiB0cnVlCiAgICAgIH07CiAgICAgIHJldHVybiBoYXNSb3dFZGl0W2FyZ3MuY29sdW1uLnByb3BlcnR5XSAmJiB0aGlzLmFjdHVhbElzT3BlbkVkaXQgPyAiZWRpdC1jZWxsIiA6ICJpbmZvLWNlbGwiOwogICAgfQogICAgLyoqDQogICAgICog5paw5bu66buY6K6k5YC8DQogICAgICogQHBhcmFtIHsqfSAgcm93IOihjOaVsOaNrg0KICAgICAqIEBtZW1iZXJvZiBNYWluQmFzZQ0KICAgICAqLwoKICB9LCB7CiAgICBrZXk6ICJjcmVhdGVEZWZhdWx0IiwKICAgIHZhbHVlOiBmdW5jdGlvbiBjcmVhdGVEZWZhdWx0KHJvdykgewogICAgICBpZiAocm93Lmhhc093blByb3BlcnR5KCdwaW1wZXJzb25pZCcpKSB7CiAgICAgICAgcm93WydwaW1wZXJzb25pZCddID0gdGhpcy52aWV3cGFyYW1zWydzcmZwYXJlbnRrZXknXTsKICAgICAgfQogICAgfQogIH0sIHsKICAgIGtleTogImFkYXB0aXZlU3RhdGUiLAogICAgZ2V0OiBmdW5jdGlvbiBnZXQoKSB7CiAgICAgIHJldHVybiAhdGhpcy5hbGxDb2x1bW5zLmZpbmQoZnVuY3Rpb24gKGNvbHVtbikgewogICAgICAgIHJldHVybiBjb2x1bW4uc2hvdyAmJiBPYmplY3QuaXMoY29sdW1uLnV0aWwsICdTVEFSJyk7CiAgICAgIH0pOwogICAgfQogIH1dKTsKCiAgcmV0dXJuIE1haW5CYXNlOwp9KFZ1ZSk7Cgp0c2xpYl8xLl9fZGVjb3JhdGUoW1Byb3AoKV0sIE1haW5CYXNlLnByb3RvdHlwZSwgIm5hbWUiLCB2b2lkIDApOwoKdHNsaWJfMS5fX2RlY29yYXRlKFtQcm9wKCldLCBNYWluQmFzZS5wcm90b3R5cGUsICJ2aWV3U3RhdGUiLCB2b2lkIDApOwoKdHNsaWJfMS5fX2RlY29yYXRlKFtQcm9wKCldLCBNYWluQmFzZS5wcm90b3R5cGUsICJjb250ZXh0Iiwgdm9pZCAwKTsKCnRzbGliXzEuX19kZWNvcmF0ZShbUHJvcCgpXSwgTWFpbkJhc2UucHJvdG90eXBlLCAidmlld3BhcmFtcyIsIHZvaWQgMCk7Cgp0c2xpYl8xLl9fZGVjb3JhdGUoW1Byb3AoKV0sIE1haW5CYXNlLnByb3RvdHlwZSwgIm5ld2RhdGEiLCB2b2lkIDApOwoKdHNsaWJfMS5fX2RlY29yYXRlKFtQcm9wKCldLCBNYWluQmFzZS5wcm90b3R5cGUsICJvcGVuZGF0YSIsIHZvaWQgMCk7Cgp0c2xpYl8xLl9fZGVjb3JhdGUoW1Byb3AoewogICJkZWZhdWx0IjogdHJ1ZQp9KV0sIE1haW5CYXNlLnByb3RvdHlwZSwgInNob3dCdXN5SW5kaWNhdG9yIiwgdm9pZCAwKTsKCnRzbGliXzEuX19kZWNvcmF0ZShbUHJvcCgpXSwgTWFpbkJhc2UucHJvdG90eXBlLCAidXBkYXRlQWN0aW9uIiwgdm9pZCAwKTsKCnRzbGliXzEuX19kZWNvcmF0ZShbUHJvcCgpXSwgTWFpbkJhc2UucHJvdG90eXBlLCAiZmV0Y2hBY3Rpb24iLCB2b2lkIDApOwoKdHNsaWJfMS5fX2RlY29yYXRlKFtQcm9wKCldLCBNYWluQmFzZS5wcm90b3R5cGUsICJyZW1vdmVBY3Rpb24iLCB2b2lkIDApOwoKdHNsaWJfMS5fX2RlY29yYXRlKFtQcm9wKCldLCBNYWluQmFzZS5wcm90b3R5cGUsICJsb2FkQWN0aW9uIiwgdm9pZCAwKTsKCnRzbGliXzEuX19kZWNvcmF0ZShbUHJvcCgpXSwgTWFpbkJhc2UucHJvdG90eXBlLCAibG9hZGRyYWZ0QWN0aW9uIiwgdm9pZCAwKTsKCnRzbGliXzEuX19kZWNvcmF0ZShbUHJvcCgpXSwgTWFpbkJhc2UucHJvdG90eXBlLCAiY3JlYXRlQWN0aW9uIiwgdm9pZCAwKTsKCnRzbGliXzEuX19kZWNvcmF0ZShbUHJvcCh7CiAgImRlZmF1bHQiOiBmYWxzZQp9KV0sIE1haW5CYXNlLnByb3RvdHlwZSwgImlzU2VsZWN0Rmlyc3REZWZhdWx0Iiwgdm9pZCAwKTsKCnRzbGliXzEuX19kZWNvcmF0ZShbUHJvcCgpXSwgTWFpbkJhc2UucHJvdG90eXBlLCAiaXNTaW5nbGVTZWxlY3QiLCB2b2lkIDApOwoKdHNsaWJfMS5fX2RlY29yYXRlKFtQcm9wKCldLCBNYWluQmFzZS5wcm90b3R5cGUsICJzZWxlY3RlZERhdGEiLCB2b2lkIDApOwoKdHNsaWJfMS5fX2RlY29yYXRlKFtXYXRjaCgnc2VsZWN0ZWREYXRhJyldLCBNYWluQmFzZS5wcm90b3R5cGUsICJvblZhbHVlQ2hhbmdlIiwgbnVsbCk7Cgp0c2xpYl8xLl9fZGVjb3JhdGUoW1Byb3AoewogICJkZWZhdWx0IjogMgp9KV0sIE1haW5CYXNlLnByb3RvdHlwZSwgImdyaWRSb3dBY3RpdmVNb2RlIiwgdm9pZCAwKTsKCnRzbGliXzEuX19kZWNvcmF0ZShbUHJvcCh7CiAgImRlZmF1bHQiOiBmYWxzZQp9KV0sIE1haW5CYXNlLnByb3RvdHlwZSwgImlzT3BlbkVkaXQiLCB2b2lkIDApOwoKTWFpbkJhc2UgPSB0c2xpYl8xLl9fZGVjb3JhdGUoW0NvbXBvbmVudCh7CiAgY29tcG9uZW50czoge30KfSldLCBNYWluQmFzZSk7CmV4cG9ydCBkZWZhdWx0IE1haW5CYXNlOw=="},null]}
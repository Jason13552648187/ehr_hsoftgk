{"remainingRequest":"F:\\crod项目\\人事管理系统2\\iBizEHR\\app_EHRPim\\node_modules\\thread-loader\\dist\\cjs.js!F:\\crod项目\\人事管理系统2\\iBizEHR\\app_EHRPim\\node_modules\\babel-loader\\lib\\index.js!F:\\crod项目\\人事管理系统2\\iBizEHR\\app_EHRPim\\node_modules\\ts-loader\\index.js??ref--14-3!F:\\crod项目\\人事管理系统2\\iBizEHR\\app_EHRPim\\node_modules\\cache-loader\\dist\\cjs.js??ref--0-0!F:\\crod项目\\人事管理系统2\\iBizEHR\\app_EHRPim\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!F:\\crod项目\\人事管理系统2\\iBizEHR\\app_EHRPim\\src\\widgets\\pim-person\\gzdq-grid\\gzdq-grid-base.vue?vue&type=script&lang=tsx&","dependencies":[{"path":"F:\\crod项目\\人事管理系统2\\iBizEHR\\app_EHRPim\\src\\widgets\\pim-person\\gzdq-grid\\gzdq-grid-base.vue","mtime":1630509411864},{"path":"F:\\crod项目\\人事管理系统2\\iBizEHR\\app_EHRPim\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1630511852775},{"path":"F:\\crod项目\\人事管理系统2\\iBizEHR\\app_EHRPim\\node_modules\\thread-loader\\dist\\cjs.js","mtime":1630511853252},{"path":"F:\\crod项目\\人事管理系统2\\iBizEHR\\app_EHRPim\\node_modules\\babel-loader\\lib\\index.js","mtime":1630511852747},{"path":"F:\\crod项目\\人事管理系统2\\iBizEHR\\app_EHRPim\\node_modules\\ts-loader\\index.js","mtime":1630511985412},{"path":"F:\\crod项目\\人事管理系统2\\iBizEHR\\app_EHRPim\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1630511852775},{"path":"F:\\crod项目\\人事管理系统2\\iBizEHR\\app_EHRPim\\node_modules\\vue-loader\\lib\\index.js","mtime":1630512070338}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:aW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuc3ltYm9sIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuc3ltYm9sLmRlc2NyaXB0aW9uIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuc3ltYm9sLml0ZXJhdG9yIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkuZmlsdGVyIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkuZmluZCI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLmFycmF5LmZpbmQtaW5kZXgiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5hcnJheS5mb3ItZWFjaCI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLmFycmF5LmpvaW4iOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5hcnJheS5tYXAiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5hcnJheS5zb21lIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkuc3BsaWNlIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuZnVuY3Rpb24ubmFtZSI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLm9iamVjdC5kZWZpbmUtcHJvcGVydGllcyI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLm9iamVjdC5kZWZpbmUtcHJvcGVydHkiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5vYmplY3QuZ2V0LW93bi1wcm9wZXJ0eS1kZXNjcmlwdG9yIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMub2JqZWN0LmdldC1vd24tcHJvcGVydHktZGVzY3JpcHRvcnMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5vYmplY3QuaXMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5vYmplY3Qua2V5cyI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLm9iamVjdC50by1zdHJpbmciOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5wYXJzZS1pbnQiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5yZWdleHAuZXhlYyI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLnN0cmluZy5pdGVyYXRvciI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLnN0cmluZy5yZXBsYWNlIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuc3RyaW5nLnNlYXJjaCI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLnN0cmluZy5zcGxpdCI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL3dlYi5kb20tY29sbGVjdGlvbnMuZm9yLWVhY2giOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy93ZWIuZG9tLWNvbGxlY3Rpb25zLml0ZXJhdG9yIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvd2ViLnRpbWVycyI7CmltcG9ydCBfdG9Db25zdW1hYmxlQXJyYXkgZnJvbSAiRjpcXGNyb2RcdTk4NzlcdTc2RUVcXFx1NEVCQVx1NEU4Qlx1N0JBMVx1NzQwNlx1N0NGQlx1N0VERjJcXGlCaXpFSFJcXGFwcF9FSFJQaW1cXG5vZGVfbW9kdWxlc1xcQGJhYmVsXFxydW50aW1lL2hlbHBlcnMvZXNtL3RvQ29uc3VtYWJsZUFycmF5IjsKaW1wb3J0IF9kZWZpbmVQcm9wZXJ0eSBmcm9tICJGOlxcY3JvZFx1OTg3OVx1NzZFRVxcXHU0RUJBXHU0RThCXHU3QkExXHU3NDA2XHU3Q0ZCXHU3RURGMlxcaUJpekVIUlxcYXBwX0VIUlBpbVxcbm9kZV9tb2R1bGVzXFxAYmFiZWxcXHJ1bnRpbWUvaGVscGVycy9lc20vZGVmaW5lUHJvcGVydHkiOwppbXBvcnQgInJlZ2VuZXJhdG9yLXJ1bnRpbWUvcnVudGltZSI7CmltcG9ydCBfYXN5bmNUb0dlbmVyYXRvciBmcm9tICJGOlxcY3JvZFx1OTg3OVx1NzZFRVxcXHU0RUJBXHU0RThCXHU3QkExXHU3NDA2XHU3Q0ZCXHU3RURGMlxcaUJpekVIUlxcYXBwX0VIUlBpbVxcbm9kZV9tb2R1bGVzXFxAYmFiZWxcXHJ1bnRpbWUvaGVscGVycy9lc20vYXN5bmNUb0dlbmVyYXRvciI7CmltcG9ydCBfY2xhc3NDYWxsQ2hlY2sgZnJvbSAiRjpcXGNyb2RcdTk4NzlcdTc2RUVcXFx1NEVCQVx1NEU4Qlx1N0JBMVx1NzQwNlx1N0NGQlx1N0VERjJcXGlCaXpFSFJcXGFwcF9FSFJQaW1cXG5vZGVfbW9kdWxlc1xcQGJhYmVsXFxydW50aW1lL2hlbHBlcnMvZXNtL2NsYXNzQ2FsbENoZWNrIjsKaW1wb3J0IF9jcmVhdGVDbGFzcyBmcm9tICJGOlxcY3JvZFx1OTg3OVx1NzZFRVxcXHU0RUJBXHU0RThCXHU3QkExXHU3NDA2XHU3Q0ZCXHU3RURGMlxcaUJpekVIUlxcYXBwX0VIUlBpbVxcbm9kZV9tb2R1bGVzXFxAYmFiZWxcXHJ1bnRpbWUvaGVscGVycy9lc20vY3JlYXRlQ2xhc3MiOwppbXBvcnQgX3Bvc3NpYmxlQ29uc3RydWN0b3JSZXR1cm4gZnJvbSAiRjpcXGNyb2RcdTk4NzlcdTc2RUVcXFx1NEVCQVx1NEU4Qlx1N0JBMVx1NzQwNlx1N0NGQlx1N0VERjJcXGlCaXpFSFJcXGFwcF9FSFJQaW1cXG5vZGVfbW9kdWxlc1xcQGJhYmVsXFxydW50aW1lL2hlbHBlcnMvZXNtL3Bvc3NpYmxlQ29uc3RydWN0b3JSZXR1cm4iOwppbXBvcnQgX2dldFByb3RvdHlwZU9mIGZyb20gIkY6XFxjcm9kXHU5ODc5XHU3NkVFXFxcdTRFQkFcdTRFOEJcdTdCQTFcdTc0MDZcdTdDRkJcdTdFREYyXFxpQml6RUhSXFxhcHBfRUhSUGltXFxub2RlX21vZHVsZXNcXEBiYWJlbFxccnVudGltZS9oZWxwZXJzL2VzbS9nZXRQcm90b3R5cGVPZiI7CmltcG9ydCBfaW5oZXJpdHMgZnJvbSAiRjpcXGNyb2RcdTk4NzlcdTc2RUVcXFx1NEVCQVx1NEU4Qlx1N0JBMVx1NzQwNlx1N0NGQlx1N0VERjJcXGlCaXpFSFJcXGFwcF9FSFJQaW1cXG5vZGVfbW9kdWxlc1xcQGJhYmVsXFxydW50aW1lL2hlbHBlcnMvZXNtL2luaGVyaXRzIjsKCmZ1bmN0aW9uIG93bktleXMob2JqZWN0LCBlbnVtZXJhYmxlT25seSkgeyB2YXIga2V5cyA9IE9iamVjdC5rZXlzKG9iamVjdCk7IGlmIChPYmplY3QuZ2V0T3duUHJvcGVydHlTeW1ib2xzKSB7IHZhciBzeW1ib2xzID0gT2JqZWN0LmdldE93blByb3BlcnR5U3ltYm9scyhvYmplY3QpOyBpZiAoZW51bWVyYWJsZU9ubHkpIHN5bWJvbHMgPSBzeW1ib2xzLmZpbHRlcihmdW5jdGlvbiAoc3ltKSB7IHJldHVybiBPYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yKG9iamVjdCwgc3ltKS5lbnVtZXJhYmxlOyB9KTsga2V5cy5wdXNoLmFwcGx5KGtleXMsIHN5bWJvbHMpOyB9IHJldHVybiBrZXlzOyB9CgpmdW5jdGlvbiBfb2JqZWN0U3ByZWFkKHRhcmdldCkgeyBmb3IgKHZhciBpID0gMTsgaSA8IGFyZ3VtZW50cy5sZW5ndGg7IGkrKykgeyB2YXIgc291cmNlID0gYXJndW1lbnRzW2ldICE9IG51bGwgPyBhcmd1bWVudHNbaV0gOiB7fTsgaWYgKGkgJSAyKSB7IG93bktleXMoT2JqZWN0KHNvdXJjZSksIHRydWUpLmZvckVhY2goZnVuY3Rpb24gKGtleSkgeyBfZGVmaW5lUHJvcGVydHkodGFyZ2V0LCBrZXksIHNvdXJjZVtrZXldKTsgfSk7IH0gZWxzZSBpZiAoT2JqZWN0LmdldE93blByb3BlcnR5RGVzY3JpcHRvcnMpIHsgT2JqZWN0LmRlZmluZVByb3BlcnRpZXModGFyZ2V0LCBPYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9ycyhzb3VyY2UpKTsgfSBlbHNlIHsgb3duS2V5cyhPYmplY3Qoc291cmNlKSkuZm9yRWFjaChmdW5jdGlvbiAoa2V5KSB7IE9iamVjdC5kZWZpbmVQcm9wZXJ0eSh0YXJnZXQsIGtleSwgT2JqZWN0LmdldE93blByb3BlcnR5RGVzY3JpcHRvcihzb3VyY2UsIGtleSkpOyB9KTsgfSB9IHJldHVybiB0YXJnZXQ7IH0KCmltcG9ydCAqIGFzIHRzbGliXzEgZnJvbSAidHNsaWIiOwppbXBvcnQgeyBWdWUsIENvbXBvbmVudCwgUHJvcCwgV2F0Y2ggfSBmcm9tICd2dWUtcHJvcGVydHktZGVjb3JhdG9yJzsKaW1wb3J0IFBpbVBlcnNvblNlcnZpY2UgZnJvbSAnQC9zZXJ2aWNlL3BpbS1wZXJzb24vcGltLXBlcnNvbi1zZXJ2aWNlJzsKaW1wb3J0IEdaRFFTZXJ2aWNlIGZyb20gJy4vZ3pkcS1ncmlkLXNlcnZpY2UnOwppbXBvcnQgQ29kZUxpc3RTZXJ2aWNlIGZyb20gIkBzZXJ2aWNlL2FwcC9jb2RlbGlzdC1zZXJ2aWNlIjsKaW1wb3J0IHsgRm9ybUl0ZW1Nb2RlbCB9IGZyb20gJ0AvbW9kZWwvZm9ybS1kZXRhaWwnOwoKdmFyIEdaRFFCYXNlID0KLyojX19QVVJFX18qLwpmdW5jdGlvbiAoX1Z1ZSkgewogIF9pbmhlcml0cyhHWkRRQmFzZSwgX1Z1ZSk7CgogIGZ1bmN0aW9uIEdaRFFCYXNlKCkgewogICAgdmFyIF90aGlzMjsKCiAgICBfY2xhc3NDYWxsQ2hlY2sodGhpcywgR1pEUUJhc2UpOwoKICAgIF90aGlzMiA9IF9wb3NzaWJsZUNvbnN0cnVjdG9yUmV0dXJuKHRoaXMsIF9nZXRQcm90b3R5cGVPZihHWkRRQmFzZSkuYXBwbHkodGhpcywgYXJndW1lbnRzKSk7CiAgICAvKioNCiAgICAgKiDorqHmlbDlmajmnI3liqHlr7nosaHpm4blkIgNCiAgICAgKg0KICAgICAqIEB0eXBlIHtBcnJheTwqPn0NCiAgICAgKiBAbWVtYmVyb2YgR1pEUUJhc2UNCiAgICAgKi8KCiAgICBfdGhpczIuY291bnRlclNlcnZpY2VBcnJheSA9IFtdOwogICAgLyoqDQogICAgICog5bu65p6E6YOo5Lu25pyN5Yqh5a+56LGhDQogICAgICoNCiAgICAgKiBAdHlwZSB7R1pEUVNlcnZpY2V9DQogICAgICogQG1lbWJlcm9mIEdaRFFCYXNlDQogICAgICovCgogICAgX3RoaXMyLnNlcnZpY2UgPSBuZXcgR1pEUVNlcnZpY2UoewogICAgICAkc3RvcmU6IF90aGlzMi4kc3RvcmUKICAgIH0pOwogICAgLyoqDQogICAgICog5a6e5L2T5pyN5Yqh5a+56LGhDQogICAgICoNCiAgICAgKiBAdHlwZSB7UGltUGVyc29uU2VydmljZX0NCiAgICAgKiBAbWVtYmVyb2YgR1pEUUJhc2UNCiAgICAgKi8KCiAgICBfdGhpczIuYXBwRW50aXR5U2VydmljZSA9IG5ldyBQaW1QZXJzb25TZXJ2aWNlKHsKICAgICAgJHN0b3JlOiBfdGhpczIuJHN0b3JlCiAgICB9KTsKICAgIC8qKg0KICAgICAqIOS7o+eggeihqOacjeWKoeWvueixoQ0KICAgICAqDQogICAgICogQHR5cGUge0NvZGVMaXN0U2VydmljZX0NCiAgICAgKiBAbWVtYmVyb2YgR1pEUUJhc2UNCiAgICAgKi8KCiAgICBfdGhpczIuY29kZUxpc3RTZXJ2aWNlID0gbmV3IENvZGVMaXN0U2VydmljZSh7CiAgICAgICRzdG9yZTogX3RoaXMyLiRzdG9yZQogICAgfSk7CiAgICAvKioNCiAgICAgKiDlvZPliY3pobUNCiAgICAgKg0KICAgICAqIEB0eXBlIHtudW1iZXJ9DQogICAgICogQG1lbWJlcm9mIEdaRFFCYXNlDQogICAgICovCgogICAgX3RoaXMyLmN1clBhZ2UgPSAxOwogICAgLyoqDQogICAgICog5pWw5o2uDQogICAgICoNCiAgICAgKiBAdHlwZSB7YW55W119DQogICAgICogQG1lbWJlcm9mIEdaRFFCYXNlDQogICAgICovCgogICAgX3RoaXMyLml0ZW1zID0gW107CiAgICAvKioNCiAgICAgKiDmmK/lkKbmlK/mjIHliIbpobUNCiAgICAgKg0KICAgICAqIEB0eXBlIHtib29sZWFufQ0KICAgICAqIEBtZW1iZXJvZiBHWkRRQmFzZQ0KICAgICAqLwoKICAgIF90aGlzMi5pc0VuYWJsZVBhZ2luZ0JhciA9IHRydWU7CiAgICAvKioNCiAgICAgKiDmmK/lkKbnpoHnlKjmjpLluo8NCiAgICAgKg0KICAgICAqIEB0eXBlIHtib29sZWFufQ0KICAgICAqIEBtZW1iZXJvZiBHWkRRQmFzZQ0KICAgICAqLwoKICAgIF90aGlzMi5pc05vU29ydCA9IGZhbHNlOwogICAgLyoqDQogICAgICog5o6S5bqP5pa55ZCRDQogICAgICoNCiAgICAgKiBAdHlwZSB7c3RyaW5nfQ0KICAgICAqIEBtZW1iZXJvZiBHWkRRQmFzZQ0KICAgICAqLwoKICAgIF90aGlzMi5taW5vclNvcnREaXIgPSAnREVTQyc7CiAgICAvKioNCiAgICAgKiDmjpLluo/lrZfmrrUNCiAgICAgKg0KICAgICAqIEB0eXBlIHtzdHJpbmd9DQogICAgICogQG1lbWJlcm9mIEdaRFFCYXNlDQogICAgICovCgogICAgX3RoaXMyLm1pbm9yU29ydFBTREVGID0gJ2d6anNzaic7CiAgICAvKioNCiAgICAgKiDliIbpobXmnaHmlbANCiAgICAgKg0KICAgICAqIEB0eXBlIHtudW1iZXJ9DQogICAgICogQG1lbWJlcm9mIEdaRFFCYXNlDQogICAgICovCgogICAgX3RoaXMyLmxpbWl0ID0gMTAwOwogICAgLyoqDQogICAgICog5piv5ZCm5pi+56S65qCH6aKYDQogICAgICoNCiAgICAgKiBAdHlwZSB7Ym9vbGVhbn0NCiAgICAgKiBAbWVtYmVyb2YgR1pEUUJhc2UNCiAgICAgKi8KCiAgICBfdGhpczIuaXNIaWRlSGVhZGVyID0gZmFsc2U7CiAgICAvKioNCiAgICAgKiDlrp7pmYXmmK/lkKblvIDlkK/ooYznvJbovpENCiAgICAgKg0KICAgICAqIEB0eXBlIHtib29sZWFufQ0KICAgICAqIEBtZW1iZXJvZiBHWkRRQmFzZQ0KICAgICAqLwoKICAgIF90aGlzMi5hY3R1YWxJc09wZW5FZGl0ID0gX3RoaXMyLmlzT3BlbkVkaXQ7CiAgICAvKioNCiAgICAgKiDmgLvmnaHmlbANCiAgICAgKg0KICAgICAqIEB0eXBlIHtudW1iZXJ9DQogICAgICogQG1lbWJlcm9mIEdaRFFCYXNlDQogICAgICovCgogICAgX3RoaXMyLnRvdGFscm93ID0gMDsKICAgIC8qKg0KICAgICAqIOmAieS4reihjOaVsOaNrg0KICAgICAqDQogICAgICogQHR5cGUge2FueVtdfQ0KICAgICAqIEBtZW1iZXJvZiBNYWluDQogICAgICovCgogICAgX3RoaXMyLnNlbGVjdGlvbnMgPSBbXTsKICAgIC8qKg0KICAgICAqIOaLpuaIquihjOmAieS4rQ0KICAgICAqDQogICAgICogQHR5cGUge2Jvb2xlYW59DQogICAgICogQG1lbWJlcm9mIE1haW4NCiAgICAgKi8KCiAgICBfdGhpczIuc3RvcFJvd0NsaWNrID0gZmFsc2U7CiAgICAvKioNCiAgICAgKiDooajmoLzmmK/lkKbmmL7npLoNCiAgICAgKg0KICAgICAqIEB0eXBlIHtib29sZWFufQ0KICAgICAqIEBtZW1iZXJvZiBHWkRRQmFzZQ0KICAgICAqLwoKICAgIF90aGlzMi5pc0Rpc3BsYXkgPSB0cnVlOwogICAgLyoqDQogICAgKiDpgInpobnmoYbliJflrr0NCiAgICAqDQogICAgKiBAdHlwZSB7bnVtYmVyfQ0KICAgICogQG1lbWJlcm9mIEFwcEluZGV4DQogICAgKi8KCiAgICBfdGhpczIuY2hlY2tib3hDb2xXaWR0aCA9IDM0OwogICAgLyoqDQogICAgICog5piv5ZCm5YWB6K645ouW5Yqo5YiX5a69DQogICAgICoNCiAgICAgKiBAdHlwZSB7Ym9vbGVhbn0NCiAgICAgKiBAbWVtYmVyb2YgQXBwRW1iZWRQaWNrZXINCiAgICAgKi8KCiAgICBfdGhpczIuaXNEcmFnZW5kQ29sID0gZmFsc2U7CiAgICAvKioNCiAgICAgKiDmiYDmnInliJfmiJDlkZgNCiAgICAgKg0KICAgICAqIEB0eXBlIHthbnlbXX0NCiAgICAgKiBAbWVtYmVyb2YgR1pEUUJhc2UNCiAgICAgKi8KCiAgICBfdGhpczIuYWxsQ29sdW1ucyA9IFt7CiAgICAgIG5hbWU6ICd5Z2JoJywKICAgICAgbGFiZWw6ICflkZjlt6XnvJblj7cnLAogICAgICBsYW5ndGFnOiAnZW50aXRpZXMucGltcGVyc29uLmd6ZHFfZ3JpZC5jb2x1bW5zLnlnYmgnLAogICAgICBzaG93OiB0cnVlLAogICAgICB1dGlsOiAnUFgnCiAgICB9LCB7CiAgICAgIG5hbWU6ICdwaW1wZXJzb25uYW1lJywKICAgICAgbGFiZWw6ICflkZjlt6Xlp5PlkI0nLAogICAgICBsYW5ndGFnOiAnZW50aXRpZXMucGltcGVyc29uLmd6ZHFfZ3JpZC5jb2x1bW5zLnBpbXBlcnNvbm5hbWUnLAogICAgICBzaG93OiB0cnVlLAogICAgICB1dGlsOiAnUFgnCiAgICB9LCB7CiAgICAgIG5hbWU6ICd5Z3p0JywKICAgICAgbGFiZWw6ICflkZjlt6XnirbmgIEnLAogICAgICBsYW5ndGFnOiAnZW50aXRpZXMucGltcGVyc29uLmd6ZHFfZ3JpZC5jb2x1bW5zLnlnenQnLAogICAgICBzaG93OiB0cnVlLAogICAgICB1dGlsOiAnUFgnCiAgICB9LCB7CiAgICAgIG5hbWU6ICdnenp0JywKICAgICAgbGFiZWw6ICfmjILogYznirbmgIEnLAogICAgICBsYW5ndGFnOiAnZW50aXRpZXMucGltcGVyc29uLmd6ZHFfZ3JpZC5jb2x1bW5zLmd6enQnLAogICAgICBzaG93OiB0cnVlLAogICAgICB1dGlsOiAnUFgnCiAgICB9LCB7CiAgICAgIG5hbWU6ICdnenp6JywKICAgICAgbGFiZWw6ICfmjILogYznu4Tnu4cnLAogICAgICBsYW5ndGFnOiAnZW50aXRpZXMucGltcGVyc29uLmd6ZHFfZ3JpZC5jb2x1bW5zLmd6enonLAogICAgICBzaG93OiB0cnVlLAogICAgICB1dGlsOiAnUFgnCiAgICB9LCB7CiAgICAgIG5hbWU6ICdnemJtJywKICAgICAgbGFiZWw6ICfmjILogYzpg6jpl6gnLAogICAgICBsYW5ndGFnOiAnZW50aXRpZXMucGltcGVyc29uLmd6ZHFfZ3JpZC5jb2x1bW5zLmd6Ym0nLAogICAgICBzaG93OiB0cnVlLAogICAgICB1dGlsOiAncHgnCiAgICB9LCB7CiAgICAgIG5hbWU6ICdnemtzc2onLAogICAgICBsYWJlbDogJ+aMguiBjOW8gOWni+aXtumXtCcsCiAgICAgIGxhbmd0YWc6ICdlbnRpdGllcy5waW1wZXJzb24uZ3pkcV9ncmlkLmNvbHVtbnMuZ3prc3NqJywKICAgICAgc2hvdzogdHJ1ZSwKICAgICAgdXRpbDogJ3B4JwogICAgfSwgewogICAgICBuYW1lOiAnZ3pqc3NqJywKICAgICAgbGFiZWw6ICfmjILogYznu5PmnZ/ml7bpl7QnLAogICAgICBsYW5ndGFnOiAnZW50aXRpZXMucGltcGVyc29uLmd6ZHFfZ3JpZC5jb2x1bW5zLmd6anNzaicsCiAgICAgIHNob3c6IHRydWUsCiAgICAgIHV0aWw6ICdQWCcKICAgIH1dOwogICAgLyoqDQogICAgICog6KGo5qC85qih5Z6L6ZuG5ZCIDQogICAgICoNCiAgICAgKiBAdHlwZSB7Kn0NCiAgICAgKiBAbWVtYmVyb2YgR1pEUUJhc2UNCiAgICAgKi8KCiAgICBfdGhpczIuZ3JpZEl0ZW1zTW9kZWwgPSBbXTsKICAgIC8qKg0KICAgICAqIOWxnuaAp+WAvOinhOWImQ0KICAgICAqDQogICAgICogQHR5cGUgeyp9DQogICAgICogQG1lbWJlcm9mIEdaRFFCYXNlDQogICAgICovCgogICAgX3RoaXMyLnJ1bGVzID0gewogICAgICBzcmZrZXk6IFt7CiAgICAgICAgcmVxdWlyZWQ6IGZhbHNlLAogICAgICAgIHZhbGlkYXRvcjogZnVuY3Rpb24gdmFsaWRhdG9yKHJ1bGUsIHZhbHVlLCBjYWxsYmFjaykgewogICAgICAgICAgcmV0dXJuIHJ1bGUucmVxdWlyZWQgJiYgKHZhbHVlID09PSBudWxsIHx8IHZhbHVlID09PSB1bmRlZmluZWQgfHwgdmFsdWUgPT09ICIiKSA/IGZhbHNlIDogdHJ1ZTsKICAgICAgICB9LAogICAgICAgIG1lc3NhZ2U6ICfkurrlkZjkv6Hmga/moIfor4Yg5YC85LiN6IO95Li656m6JywKICAgICAgICB0cmlnZ2VyOiAnY2hhbmdlJwogICAgICB9LCB7CiAgICAgICAgcmVxdWlyZWQ6IGZhbHNlLAogICAgICAgIHZhbGlkYXRvcjogZnVuY3Rpb24gdmFsaWRhdG9yKHJ1bGUsIHZhbHVlLCBjYWxsYmFjaykgewogICAgICAgICAgcmV0dXJuIHJ1bGUucmVxdWlyZWQgJiYgKHZhbHVlID09PSBudWxsIHx8IHZhbHVlID09PSB1bmRlZmluZWQgfHwgdmFsdWUgPT09ICIiKSA/IGZhbHNlIDogdHJ1ZTsKICAgICAgICB9LAogICAgICAgIG1lc3NhZ2U6ICfkurrlkZjkv6Hmga/moIfor4Yg5YC85LiN6IO95Li656m6JywKICAgICAgICB0cmlnZ2VyOiAnYmx1cicKICAgICAgfV0KICAgIH07CiAgICByZXR1cm4gX3RoaXMyOwogIH0KICAvKioNCiAgICog6I635Y+W6YOo5Lu257G75Z6LDQogICAqDQogICAqIEByZXR1cm5zIHtzdHJpbmd9DQogICAqIEBtZW1iZXJvZiBHWkRRQmFzZQ0KICAgKi8KCgogIF9jcmVhdGVDbGFzcyhHWkRRQmFzZSwgW3sKICAgIGtleTogImdldENvbnRyb2xUeXBlIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBnZXRDb250cm9sVHlwZSgpIHsKICAgICAgcmV0dXJuICdHUklEJzsKICAgIH0KICAgIC8qKg0KICAgICAqIOWFs+mXreinhuWbvg0KICAgICAqDQogICAgICogQHBhcmFtIHthbnl9IGFyZ3MNCiAgICAgKiBAbWVtYmVyb2YgR1pEUUJhc2UNCiAgICAgKi8KCiAgfSwgewogICAga2V5OiAiY2xvc2VWaWV3IiwKICAgIHZhbHVlOiBmdW5jdGlvbiBjbG9zZVZpZXcoYXJncykgewogICAgICB2YXIgX3RoaXMgPSB0aGlzOwoKICAgICAgX3RoaXMuJGVtaXQoJ2Nsb3NldmlldycsIFthcmdzXSk7CiAgICB9CiAgICAvKioNCiAgICAgKiAg6K6h5pWw5Zmo5Yi35pawDQogICAgICoNCiAgICAgKiBAbWVtYmVyb2YgR1pEUUJhc2UNCiAgICAgKi8KCiAgfSwgewogICAga2V5OiAiY291bnRlclJlZnJlc2giLAogICAgdmFsdWU6IGZ1bmN0aW9uIGNvdW50ZXJSZWZyZXNoKCkgewogICAgICB2YXIgX3RoaXMgPSB0aGlzOwoKICAgICAgaWYgKF90aGlzLmNvdW50ZXJTZXJ2aWNlQXJyYXkgJiYgX3RoaXMuY291bnRlclNlcnZpY2VBcnJheS5sZW5ndGggPiAwKSB7CiAgICAgICAgX3RoaXMuY291bnRlclNlcnZpY2VBcnJheS5mb3JFYWNoKGZ1bmN0aW9uIChpdGVtKSB7CiAgICAgICAgICBpZiAoaXRlbS5yZWZyZXNoRGF0YSAmJiBpdGVtLnJlZnJlc2hEYXRhIGluc3RhbmNlb2YgRnVuY3Rpb24pIHsKICAgICAgICAgICAgaXRlbS5yZWZyZXNoRGF0YSgpOwogICAgICAgICAgfQogICAgICAgIH0pOwogICAgICB9CiAgICB9CiAgICAvKioNCiAgICAgKiDojrflj5blpJrpobnmlbDmja4NCiAgICAgKg0KICAgICAqIEByZXR1cm5zIHthbnlbXX0NCiAgICAgKiBAbWVtYmVyb2YgR1pEUUJhc2UNCiAgICAgKi8KCiAgfSwgewogICAga2V5OiAiZ2V0RGF0YXMiLAogICAgdmFsdWU6IGZ1bmN0aW9uIGdldERhdGFzKCkgewogICAgICByZXR1cm4gdGhpcy5zZWxlY3Rpb25zOwogICAgfQogICAgLyoqDQogICAgICog6I635Y+W5Y2V6aG55qCRDQogICAgICoNCiAgICAgKiBAcmV0dXJucyB7Kn0NCiAgICAgKiBAbWVtYmVyb2YgR1pEUUJhc2UNCiAgICAgKi8KCiAgfSwgewogICAga2V5OiAiZ2V0RGF0YSIsCiAgICB2YWx1ZTogZnVuY3Rpb24gZ2V0RGF0YSgpIHsKICAgICAgcmV0dXJuIHRoaXMuc2VsZWN0aW9uc1swXTsKICAgIH0KICAgIC8qKg0KICAgICAqIOmAieS4reWAvOWPmOWMlg0KICAgICAqDQogICAgICogQHBhcmFtIHsqfSBuZXdWYWwNCiAgICAgKiBAcGFyYW0geyp9IG9sZFZhbA0KICAgICAqIEBtZW1iZXJvZiBHWkRRQmFzZQ0KICAgICAqLwoKICB9LCB7CiAgICBrZXk6ICJvblZhbHVlQ2hhbmdlIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBvblZhbHVlQ2hhbmdlKG5ld1ZhbCwgb2xkVmFsKSB7CiAgICAgIHZhciBfdGhpczMgPSB0aGlzOwoKICAgICAgdGhpcy5zZWxlY3Rpb25zID0gW107CgogICAgICBpZiAodGhpcy5zZWxlY3RlZERhdGEpIHsKICAgICAgICB2YXIgcmVmcyA9IHRoaXMuJHJlZnM7CgogICAgICAgIGlmIChyZWZzLm11bHRpcGxlVGFibGUpIHsKICAgICAgICAgIHJlZnMubXVsdGlwbGVUYWJsZS5jbGVhclNlbGVjdGlvbigpOwogICAgICAgICAgSlNPTi5wYXJzZSh0aGlzLnNlbGVjdGVkRGF0YSkuZm9yRWFjaChmdW5jdGlvbiAoc2VsZWN0aW9uKSB7CiAgICAgICAgICAgIHZhciBzZWxlY3RlZEl0ZW0gPSBfdGhpczMuaXRlbXMuZmluZChmdW5jdGlvbiAoaXRlbSkgewogICAgICAgICAgICAgIHJldHVybiBPYmplY3QuaXMoaXRlbS5zcmZrZXksIHNlbGVjdGlvbi5zcmZrZXkpOwogICAgICAgICAgICB9KTsKCiAgICAgICAgICAgIGlmIChzZWxlY3RlZEl0ZW0pIHsKICAgICAgICAgICAgICBfdGhpczMucm93Q2xpY2soc2VsZWN0ZWRJdGVtKTsKICAgICAgICAgICAgfQogICAgICAgICAgfSk7CiAgICAgICAgfQogICAgICB9CiAgICB9CiAgICAvKioNCiAgICAgKiDpg6jku7bliLfmlrANCiAgICAgKg0KICAgICAqIEBwYXJhbSB7YW55W119IGFyZ3MNCiAgICAgKiBAbWVtYmVyb2YgR1pEUUJhc2UNCiAgICAgKi8KCiAgfSwgewogICAga2V5OiAicmVmcmVzaCIsCiAgICB2YWx1ZTogZnVuY3Rpb24gcmVmcmVzaChhcmdzKSB7CiAgICAgIHRoaXMubG9hZCgpOwogICAgfQogICAgLyoqDQogICAgICog6I635Y+W6KGo5qC86KGM5qih5Z6LDQogICAgICoNCiAgICAgKiBAdHlwZSB7Kn0NCiAgICAgKiBAbWVtYmVyb2YgR1pEUUJhc2UNCiAgICAgKi8KCiAgfSwgewogICAga2V5OiAiZ2V0R3JpZFJvd01vZGVsIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBnZXRHcmlkUm93TW9kZWwoKSB7CiAgICAgIHJldHVybiB7CiAgICAgICAgc3Jma2V5OiBuZXcgRm9ybUl0ZW1Nb2RlbCgpCiAgICAgIH07CiAgICB9CiAgICAvKioNCiAgICAgKiDooajmoLzooYznvJbovpHpobnmoKHpqowNCiAgICAgKg0KICAgICAqIEBwYXJhbSB7c3RyaW5nfSBwcm9wZXJ0eSDlsZ7mgKflkI0NCiAgICAgKiBAcGFyYW0geyp9IGRhdGEg6KGM5pWw5o2uDQogICAgICogQHBhcmFtIHtudW1iZXJ9IHJvd0luZGV4IOihjOe0ouW8lQ0KICAgICAqIEByZXR1cm5zIFByb21pc2U8YW55Pg0KICAgICAqDQogICAgICogQG1lbWJlcm9mIEdaRFFCYXNlDQogICAgICovCgogIH0sIHsKICAgIGtleTogInZhbGlkYXRlIiwKICAgIHZhbHVlOiBmdW5jdGlvbiB2YWxpZGF0ZShwcm9wZXJ0eSwgZGF0YSwgcm93SW5kZXgpIHsKICAgICAgdmFyIF90aGlzNCA9IHRoaXM7CgogICAgICByZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24gKHJlc29sdmUsIHJlamVjdCkgewogICAgICAgIF90aGlzNC4kdXRpbC52YWxpZGF0ZUl0ZW0ocHJvcGVydHksIGRhdGEsIF90aGlzNC5ydWxlcykudGhlbihmdW5jdGlvbiAoKSB7CiAgICAgICAgICBfdGhpczQuZ3JpZEl0ZW1zTW9kZWxbcm93SW5kZXhdW3Byb3BlcnR5XS5zZXRFcnJvcihudWxsKTsKCiAgICAgICAgICByZXNvbHZlKHRydWUpOwogICAgICAgIH0pWyJjYXRjaCJdKGZ1bmN0aW9uIChfcmVmKSB7CiAgICAgICAgICB2YXIgZXJyb3JzID0gX3JlZi5lcnJvcnMsCiAgICAgICAgICAgICAgZmllbGRzID0gX3JlZi5maWVsZHM7CgogICAgICAgICAgX3RoaXM0LmdyaWRJdGVtc01vZGVsW3Jvd0luZGV4XVtwcm9wZXJ0eV0uc2V0RXJyb3IoZXJyb3JzWzBdLm1lc3NhZ2UpOwoKICAgICAgICAgIHJlc29sdmUoZmFsc2UpOwogICAgICAgIH0pOwogICAgICB9KTsKICAgIH0KICAgIC8qKg0KICAgICAqIOagoemqjOaJgOacieS/ruaUuei/h+eahOe8lui+kemhuQ0KICAgICAqDQogICAgICogQHJldHVybnMgUHJvbWlzZTxhbnk+DQogICAgICogQG1lbWJlcm9mIEdaRFFCYXNlDQogICAgICovCgogIH0sIHsKICAgIGtleTogInZhbGlkYXRlQWxsIiwKICAgIHZhbHVlOiBmdW5jdGlvbiAoKSB7CiAgICAgIHZhciBfdmFsaWRhdGVBbGwgPSBfYXN5bmNUb0dlbmVyYXRvcigKICAgICAgLyojX19QVVJFX18qLwogICAgICByZWdlbmVyYXRvclJ1bnRpbWUubWFyayhmdW5jdGlvbiBfY2FsbGVlKCkgewogICAgICAgIHZhciB2YWxpZGF0ZVN0YXRlLCBpbmRleCwgX2l0ZXJhdG9yTm9ybWFsQ29tcGxldGlvbiwgX2RpZEl0ZXJhdG9yRXJyb3IsIF9pdGVyYXRvckVycm9yLCBfaXRlcmF0b3IsIF9zdGVwLCBpdGVtLCBfaSwgX09iamVjdCRrZXlzLCBwcm9wZXJ0eTsKCiAgICAgICAgcmV0dXJuIHJlZ2VuZXJhdG9yUnVudGltZS53cmFwKGZ1bmN0aW9uIF9jYWxsZWUkKF9jb250ZXh0KSB7CiAgICAgICAgICB3aGlsZSAoMSkgewogICAgICAgICAgICBzd2l0Y2ggKF9jb250ZXh0LnByZXYgPSBfY29udGV4dC5uZXh0KSB7CiAgICAgICAgICAgICAgY2FzZSAwOgogICAgICAgICAgICAgICAgdmFsaWRhdGVTdGF0ZSA9IHRydWU7CiAgICAgICAgICAgICAgICBpbmRleCA9IC0xOwogICAgICAgICAgICAgICAgX2l0ZXJhdG9yTm9ybWFsQ29tcGxldGlvbiA9IHRydWU7CiAgICAgICAgICAgICAgICBfZGlkSXRlcmF0b3JFcnJvciA9IGZhbHNlOwogICAgICAgICAgICAgICAgX2l0ZXJhdG9yRXJyb3IgPSB1bmRlZmluZWQ7CiAgICAgICAgICAgICAgICBfY29udGV4dC5wcmV2ID0gNTsKICAgICAgICAgICAgICAgIF9pdGVyYXRvciA9IHRoaXMuaXRlbXNbU3ltYm9sLml0ZXJhdG9yXSgpOwoKICAgICAgICAgICAgICBjYXNlIDc6CiAgICAgICAgICAgICAgICBpZiAoX2l0ZXJhdG9yTm9ybWFsQ29tcGxldGlvbiA9IChfc3RlcCA9IF9pdGVyYXRvci5uZXh0KCkpLmRvbmUpIHsKICAgICAgICAgICAgICAgICAgX2NvbnRleHQubmV4dCA9IDI0OwogICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBpdGVtID0gX3N0ZXAudmFsdWU7CiAgICAgICAgICAgICAgICBpbmRleCsrOwoKICAgICAgICAgICAgICAgIGlmICghKGl0ZW0ucm93RGF0YVN0YXRlID09PSAiY3JlYXRlIiB8fCBpdGVtLnJvd0RhdGFTdGF0ZSA9PT0gInVwZGF0ZSIpKSB7CiAgICAgICAgICAgICAgICAgIF9jb250ZXh0Lm5leHQgPSAyMTsKICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgX2kgPSAwLCBfT2JqZWN0JGtleXMgPSBPYmplY3Qua2V5cyh0aGlzLnJ1bGVzKTsKCiAgICAgICAgICAgICAgY2FzZSAxMjoKICAgICAgICAgICAgICAgIGlmICghKF9pIDwgX09iamVjdCRrZXlzLmxlbmd0aCkpIHsKICAgICAgICAgICAgICAgICAgX2NvbnRleHQubmV4dCA9IDIxOwogICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBwcm9wZXJ0eSA9IF9PYmplY3Qka2V5c1tfaV07CiAgICAgICAgICAgICAgICBfY29udGV4dC5uZXh0ID0gMTY7CiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy52YWxpZGF0ZShwcm9wZXJ0eSwgaXRlbSwgaW5kZXgpOwoKICAgICAgICAgICAgICBjYXNlIDE2OgogICAgICAgICAgICAgICAgaWYgKF9jb250ZXh0LnNlbnQpIHsKICAgICAgICAgICAgICAgICAgX2NvbnRleHQubmV4dCA9IDE4OwogICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICB2YWxpZGF0ZVN0YXRlID0gZmFsc2U7CgogICAgICAgICAgICAgIGNhc2UgMTg6CiAgICAgICAgICAgICAgICBfaSsrOwogICAgICAgICAgICAgICAgX2NvbnRleHQubmV4dCA9IDEyOwogICAgICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgICAgIGNhc2UgMjE6CiAgICAgICAgICAgICAgICBfaXRlcmF0b3JOb3JtYWxDb21wbGV0aW9uID0gdHJ1ZTsKICAgICAgICAgICAgICAgIF9jb250ZXh0Lm5leHQgPSA3OwogICAgICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgICAgIGNhc2UgMjQ6CiAgICAgICAgICAgICAgICBfY29udGV4dC5uZXh0ID0gMzA7CiAgICAgICAgICAgICAgICBicmVhazsKCiAgICAgICAgICAgICAgY2FzZSAyNjoKICAgICAgICAgICAgICAgIF9jb250ZXh0LnByZXYgPSAyNjsKICAgICAgICAgICAgICAgIF9jb250ZXh0LnQwID0gX2NvbnRleHRbImNhdGNoIl0oNSk7CiAgICAgICAgICAgICAgICBfZGlkSXRlcmF0b3JFcnJvciA9IHRydWU7CiAgICAgICAgICAgICAgICBfaXRlcmF0b3JFcnJvciA9IF9jb250ZXh0LnQwOwoKICAgICAgICAgICAgICBjYXNlIDMwOgogICAgICAgICAgICAgICAgX2NvbnRleHQucHJldiA9IDMwOwogICAgICAgICAgICAgICAgX2NvbnRleHQucHJldiA9IDMxOwoKICAgICAgICAgICAgICAgIGlmICghX2l0ZXJhdG9yTm9ybWFsQ29tcGxldGlvbiAmJiBfaXRlcmF0b3JbInJldHVybiJdICE9IG51bGwpIHsKICAgICAgICAgICAgICAgICAgX2l0ZXJhdG9yWyJyZXR1cm4iXSgpOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICBjYXNlIDMzOgogICAgICAgICAgICAgICAgX2NvbnRleHQucHJldiA9IDMzOwoKICAgICAgICAgICAgICAgIGlmICghX2RpZEl0ZXJhdG9yRXJyb3IpIHsKICAgICAgICAgICAgICAgICAgX2NvbnRleHQubmV4dCA9IDM2OwogICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICB0aHJvdyBfaXRlcmF0b3JFcnJvcjsKCiAgICAgICAgICAgICAgY2FzZSAzNjoKICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dC5maW5pc2goMzMpOwoKICAgICAgICAgICAgICBjYXNlIDM3OgogICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0LmZpbmlzaCgzMCk7CgogICAgICAgICAgICAgIGNhc2UgMzg6CiAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQuYWJydXB0KCJyZXR1cm4iLCB2YWxpZGF0ZVN0YXRlKTsKCiAgICAgICAgICAgICAgY2FzZSAzOToKICAgICAgICAgICAgICBjYXNlICJlbmQiOgogICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0LnN0b3AoKTsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0sIF9jYWxsZWUsIHRoaXMsIFtbNSwgMjYsIDMwLCAzOF0sIFszMSwsIDMzLCAzN11dKTsKICAgICAgfSkpOwoKICAgICAgZnVuY3Rpb24gdmFsaWRhdGVBbGwoKSB7CiAgICAgICAgcmV0dXJuIF92YWxpZGF0ZUFsbC5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwogICAgICB9CgogICAgICByZXR1cm4gdmFsaWRhdGVBbGw7CiAgICB9KCkKICAgIC8qKg0KICAgICAqIOihqOagvOaVsOaNruWKoOi9vQ0KICAgICAqDQogICAgICogQHBhcmFtIHsqfSBbYXJnPXt9XQ0KICAgICAqIEBtZW1iZXJvZiBHWkRRQmFzZQ0KICAgICAqLwoKICB9LCB7CiAgICBrZXk6ICJsb2FkIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBsb2FkKCkgewogICAgICB2YXIgX3RoaXM1ID0gdGhpczsKCiAgICAgIHZhciBvcHQgPSBhcmd1bWVudHMubGVuZ3RoID4gMCAmJiBhcmd1bWVudHNbMF0gIT09IHVuZGVmaW5lZCA/IGFyZ3VtZW50c1swXSA6IHt9OwogICAgICB2YXIgcGFnZVJlc2V0ID0gYXJndW1lbnRzLmxlbmd0aCA+IDEgJiYgYXJndW1lbnRzWzFdICE9PSB1bmRlZmluZWQgPyBhcmd1bWVudHNbMV0gOiBmYWxzZTsKCiAgICAgIGlmICghdGhpcy5mZXRjaEFjdGlvbikgewogICAgICAgIHRoaXMuJE5vdGljZS5lcnJvcih7CiAgICAgICAgICB0aXRsZTogJ+mUmeivrycsCiAgICAgICAgICBkZXNjOiAnUElNUEVSU09OR1pSWUhNQ0dyaWRWaWV36KeG5Zu+6KGo5qC8ZmV0Y2hBY3Rpb27lj4LmlbDmnKrphY3nva4nCiAgICAgICAgfSk7CiAgICAgICAgcmV0dXJuOwogICAgICB9CgogICAgICBpZiAocGFnZVJlc2V0KSB7CiAgICAgICAgdGhpcy5jdXJQYWdlID0gMTsKICAgICAgfQoKICAgICAgdmFyIGFyZyA9IF9vYmplY3RTcHJlYWQoe30sIG9wdCk7CgogICAgICB2YXIgcGFnZSA9IHt9OwoKICAgICAgaWYgKHRoaXMuaXNFbmFibGVQYWdpbmdCYXIpIHsKICAgICAgICBPYmplY3QuYXNzaWduKHBhZ2UsIHsKICAgICAgICAgIHBhZ2U6IHRoaXMuY3VyUGFnZSAtIDEsCiAgICAgICAgICBzaXplOiB0aGlzLmxpbWl0CiAgICAgICAgfSk7CiAgICAgIH0gLy8g6K6+572u5o6S5bqPCgoKICAgICAgaWYgKCF0aGlzLmlzTm9Tb3J0ICYmICFPYmplY3QuaXModGhpcy5taW5vclNvcnREaXIsICcnKSAmJiAhT2JqZWN0LmlzKHRoaXMubWlub3JTb3J0UFNERUYsICcnKSkgewogICAgICAgIHZhciBzb3J0ID0gdGhpcy5taW5vclNvcnRQU0RFRiArICIsIiArIHRoaXMubWlub3JTb3J0RGlyOwogICAgICAgIE9iamVjdC5hc3NpZ24ocGFnZSwgewogICAgICAgICAgc29ydDogc29ydAogICAgICAgIH0pOwogICAgICB9CgogICAgICBPYmplY3QuYXNzaWduKGFyZywgcGFnZSk7CiAgICAgIHZhciBwYXJlbnRkYXRhID0ge307CiAgICAgIHRoaXMuJGVtaXQoJ2JlZm9yZWxvYWQnLCBwYXJlbnRkYXRhKTsKICAgICAgT2JqZWN0LmFzc2lnbihhcmcsIHBhcmVudGRhdGEpOwogICAgICB2YXIgdGVtcFZpZXdQYXJhbXMgPSBwYXJlbnRkYXRhLnZpZXdwYXJhbXMgPyBwYXJlbnRkYXRhLnZpZXdwYXJhbXMgOiB7fTsKICAgICAgT2JqZWN0LmFzc2lnbih0ZW1wVmlld1BhcmFtcywgSlNPTi5wYXJzZShKU09OLnN0cmluZ2lmeSh0aGlzLnZpZXdwYXJhbXMpKSk7CiAgICAgIE9iamVjdC5hc3NpZ24oYXJnLCB7CiAgICAgICAgdmlld3BhcmFtczogdGVtcFZpZXdQYXJhbXMKICAgICAgfSk7CiAgICAgIHZhciBwb3N0ID0gdGhpcy5zZXJ2aWNlLnNlYXJjaCh0aGlzLmZldGNoQWN0aW9uLCBKU09OLnBhcnNlKEpTT04uc3RyaW5naWZ5KHRoaXMuY29udGV4dCkpLCBhcmcsIHRoaXMuc2hvd0J1c3lJbmRpY2F0b3IpOwogICAgICBwb3N0LnRoZW4oZnVuY3Rpb24gKHJlc3BvbnNlKSB7CiAgICAgICAgaWYgKCFyZXNwb25zZS5zdGF0dXMgfHwgcmVzcG9uc2Uuc3RhdHVzICE9PSAyMDApIHsKICAgICAgICAgIGlmIChyZXNwb25zZS5lcnJvck1lc3NhZ2UpIHsKICAgICAgICAgICAgX3RoaXM1LiROb3RpY2UuZXJyb3IoewogICAgICAgICAgICAgIHRpdGxlOiAn6ZSZ6K+vJywKICAgICAgICAgICAgICBkZXNjOiByZXNwb25zZS5lcnJvck1lc3NhZ2UKICAgICAgICAgICAgfSk7CiAgICAgICAgICB9CgogICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KCiAgICAgICAgdmFyIGRhdGEgPSByZXNwb25zZS5kYXRhOwogICAgICAgIF90aGlzNS50b3RhbHJvdyA9IHJlc3BvbnNlLnRvdGFsOwogICAgICAgIF90aGlzNS5pdGVtcyA9IEpTT04ucGFyc2UoSlNPTi5zdHJpbmdpZnkoZGF0YSkpOyAvLyDmuIXnqbpzZWxlY3Rpb25zLGdyaWRJdGVtc01vZGVsCgogICAgICAgIF90aGlzNS5zZWxlY3Rpb25zID0gW107CiAgICAgICAgX3RoaXM1LmdyaWRJdGVtc01vZGVsID0gW107CgogICAgICAgIF90aGlzNS5pdGVtcy5mb3JFYWNoKGZ1bmN0aW9uICgpIHsKICAgICAgICAgIF90aGlzNS5ncmlkSXRlbXNNb2RlbC5wdXNoKF90aGlzNS5nZXRHcmlkUm93TW9kZWwoKSk7CiAgICAgICAgfSk7CgogICAgICAgIF90aGlzNS4kZW1pdCgnbG9hZCcsIF90aGlzNS5pdGVtcyk7IC8vIOiuvue9rum7mOiupOmAieS4rQoKCiAgICAgICAgdmFyIF90aGlzID0gX3RoaXM1OwogICAgICAgIHNldFRpbWVvdXQoZnVuY3Rpb24gKCkgewogICAgICAgICAgaWYgKF90aGlzLmlzU2VsZWN0Rmlyc3REZWZhdWx0KSB7CiAgICAgICAgICAgIF90aGlzLnJvd0NsaWNrKF90aGlzLml0ZW1zWzBdKTsKICAgICAgICAgIH0KCiAgICAgICAgICBpZiAoX3RoaXMuc2VsZWN0ZWREYXRhKSB7CiAgICAgICAgICAgIHZhciByZWZzID0gX3RoaXMuJHJlZnM7CgogICAgICAgICAgICBpZiAocmVmcy5tdWx0aXBsZVRhYmxlKSB7CiAgICAgICAgICAgICAgcmVmcy5tdWx0aXBsZVRhYmxlLmNsZWFyU2VsZWN0aW9uKCk7CiAgICAgICAgICAgICAgSlNPTi5wYXJzZShfdGhpcy5zZWxlY3RlZERhdGEpLmZvckVhY2goZnVuY3Rpb24gKHNlbGVjdGlvbikgewogICAgICAgICAgICAgICAgdmFyIHNlbGVjdGVkSXRlbSA9IF90aGlzLml0ZW1zLmZpbmQoZnVuY3Rpb24gKGl0ZW0pIHsKICAgICAgICAgICAgICAgICAgcmV0dXJuIE9iamVjdC5pcyhpdGVtLnNyZmtleSwgc2VsZWN0aW9uLnNyZmtleSk7CiAgICAgICAgICAgICAgICB9KTsKCiAgICAgICAgICAgICAgICBpZiAoc2VsZWN0ZWRJdGVtKSB7CiAgICAgICAgICAgICAgICAgIF90aGlzLnJvd0NsaWNrKHNlbGVjdGVkSXRlbSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9LCAzMDApOwogICAgICB9KVsiY2F0Y2giXShmdW5jdGlvbiAocmVzcG9uc2UpIHsKICAgICAgICBpZiAocmVzcG9uc2UgJiYgcmVzcG9uc2Uuc3RhdHVzID09PSA0MDEpIHsKICAgICAgICAgIHJldHVybjsKICAgICAgICB9CgogICAgICAgIF90aGlzNS4kTm90aWNlLmVycm9yKHsKICAgICAgICAgIHRpdGxlOiAn6ZSZ6K+vJywKICAgICAgICAgIGRlc2M6IHJlc3BvbnNlLmVycm9yTWVzc2FnZQogICAgICAgIH0pOwogICAgICB9KTsKICAgIH0KICAgIC8qKg0KICAgICAqIOWIoOmZpA0KICAgICAqDQogICAgICogQHBhcmFtIHthbnlbXX0gZGF0YXMNCiAgICAgKiBAcmV0dXJucyB7UHJvbWlzZTxhbnk+fQ0KICAgICAqIEBtZW1iZXJvZiBHWkRRQmFzZQ0KICAgICAqLwoKICB9LCB7CiAgICBrZXk6ICJyZW1vdmUiLAogICAgdmFsdWU6IGZ1bmN0aW9uICgpIHsKICAgICAgdmFyIF9yZW1vdmUgPSBfYXN5bmNUb0dlbmVyYXRvcigKICAgICAgLyojX19QVVJFX18qLwogICAgICByZWdlbmVyYXRvclJ1bnRpbWUubWFyayhmdW5jdGlvbiBfY2FsbGVlMihkYXRhcykgewogICAgICAgIHZhciBfdGhpczYgPSB0aGlzOwoKICAgICAgICB2YXIgX2RhdGFzLCBkYXRhSW5mbywgcmVtb3ZlRGF0YTsKCiAgICAgICAgcmV0dXJuIHJlZ2VuZXJhdG9yUnVudGltZS53cmFwKGZ1bmN0aW9uIF9jYWxsZWUyJChfY29udGV4dDIpIHsKICAgICAgICAgIHdoaWxlICgxKSB7CiAgICAgICAgICAgIHN3aXRjaCAoX2NvbnRleHQyLnByZXYgPSBfY29udGV4dDIubmV4dCkgewogICAgICAgICAgICAgIGNhc2UgMDoKICAgICAgICAgICAgICAgIGlmICh0aGlzLnJlbW92ZUFjdGlvbikgewogICAgICAgICAgICAgICAgICBfY29udGV4dDIubmV4dCA9IDM7CiAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIHRoaXMuJE5vdGljZS5lcnJvcih7CiAgICAgICAgICAgICAgICAgIHRpdGxlOiAn6ZSZ6K+vJywKICAgICAgICAgICAgICAgICAgZGVzYzogJ1BJTVBFUlNPTkdaUllITUNHcmlkVmlld+inhuWbvuihqOagvHJlbW92ZUFjdGlvbuWPguaVsOacqumFjee9ricKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0Mi5hYnJ1cHQoInJldHVybiIpOwoKICAgICAgICAgICAgICBjYXNlIDM6CiAgICAgICAgICAgICAgICBfZGF0YXMgPSBbXTsKICAgICAgICAgICAgICAgIGRhdGFzLmZvckVhY2goZnVuY3Rpb24gKHJlY29yZCwgaW5kZXgpIHsKICAgICAgICAgICAgICAgICAgaWYgKE9iamVjdC5pcyhyZWNvcmQuc3JmdWYsICIwIikpIHsKICAgICAgICAgICAgICAgICAgICBfdGhpczYuaXRlbXMuc29tZShmdW5jdGlvbiAodmFsLCBudW0pIHsKICAgICAgICAgICAgICAgICAgICAgIGlmIChKU09OLnN0cmluZ2lmeSh2YWwpID09IEpTT04uc3RyaW5naWZ5KHJlY29yZCkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgX3RoaXM2Lml0ZW1zLnNwbGljZShudW0sIDEpOwoKICAgICAgICAgICAgICAgICAgICAgICAgX3RoaXM2LmdyaWRJdGVtc01vZGVsLnNwbGljZShudW0sIDEpOwoKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgX2RhdGFzLnB1c2goZGF0YXNbaW5kZXhdKTsKICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSk7CgogICAgICAgICAgICAgICAgaWYgKCEoX2RhdGFzLmxlbmd0aCA9PT0gMCkpIHsKICAgICAgICAgICAgICAgICAgX2NvbnRleHQyLm5leHQgPSA3OwogICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQyLmFicnVwdCgicmV0dXJuIik7CgogICAgICAgICAgICAgIGNhc2UgNzoKICAgICAgICAgICAgICAgIGRhdGFJbmZvID0gJyc7CgogICAgICAgICAgICAgICAgX2RhdGFzLmZvckVhY2goZnVuY3Rpb24gKHJlY29yZCwgaW5kZXgpIHsKICAgICAgICAgICAgICAgICAgdmFyIHNyZm1ham9ydGV4dCA9IHJlY29yZC5waW1wZXJzb25uYW1lOwoKICAgICAgICAgICAgICAgICAgaWYgKGluZGV4IDwgNSkgewogICAgICAgICAgICAgICAgICAgIGlmICghT2JqZWN0LmlzKGRhdGFJbmZvLCAnJykpIHsKICAgICAgICAgICAgICAgICAgICAgIGRhdGFJbmZvICs9ICfjgIEnOwogICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgZGF0YUluZm8gKz0gc3JmbWFqb3J0ZXh0OwogICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSk7CgogICAgICAgICAgICAgICAgaWYgKF9kYXRhcy5sZW5ndGggPCA1KSB7CiAgICAgICAgICAgICAgICAgIGRhdGFJbmZvID0gZGF0YUluZm8gKyAnIOWFsScgKyBfZGF0YXMubGVuZ3RoICsgJ+adoeaVsOaNric7CiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICBkYXRhSW5mbyA9IGRhdGFJbmZvICsgJy4uLicgKyAnIOWFsScgKyBfZGF0YXMubGVuZ3RoICsgJ+adoeaVsOaNric7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgcmVtb3ZlRGF0YSA9IGZ1bmN0aW9uIHJlbW92ZURhdGEoKSB7CiAgICAgICAgICAgICAgICAgIHZhciBrZXlzID0gW107CgogICAgICAgICAgICAgICAgICBfZGF0YXMuZm9yRWFjaChmdW5jdGlvbiAoZGF0YSkgewogICAgICAgICAgICAgICAgICAgIGtleXMucHVzaChkYXRhLnNyZmtleSk7CiAgICAgICAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgICAgICAgdmFyIF9yZW1vdmVBY3Rpb24gPSBrZXlzLmxlbmd0aCA+IDEgPyAncmVtb3ZlQmF0Y2gnIDogX3RoaXM2LnJlbW92ZUFjdGlvbjsKCiAgICAgICAgICAgICAgICAgIHZhciBfa2V5cyA9IGtleXMubGVuZ3RoID4gMSA/IGtleXMgOiBrZXlzWzBdOwoKICAgICAgICAgICAgICAgICAgdmFyIGNvbnRleHQgPSBKU09OLnBhcnNlKEpTT04uc3RyaW5naWZ5KF90aGlzNi5jb250ZXh0KSk7CgogICAgICAgICAgICAgICAgICB2YXIgcG9zdCA9IF90aGlzNi5zZXJ2aWNlWyJkZWxldGUiXShfcmVtb3ZlQWN0aW9uLCBPYmplY3QuYXNzaWduKGNvbnRleHQsIHsKICAgICAgICAgICAgICAgICAgICBwaW1wZXJzb246IF9rZXlzCiAgICAgICAgICAgICAgICAgIH0pLCBPYmplY3QuYXNzaWduKHsKICAgICAgICAgICAgICAgICAgICBwaW1wZXJzb246IF9rZXlzCiAgICAgICAgICAgICAgICAgIH0sIHsKICAgICAgICAgICAgICAgICAgICB2aWV3cGFyYW1zOiBfdGhpczYudmlld3BhcmFtcwogICAgICAgICAgICAgICAgICB9KSwgX3RoaXM2LnNob3dCdXN5SW5kaWNhdG9yKTsKCiAgICAgICAgICAgICAgICAgIHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbiAocmVzb2x2ZSwgcmVqZWN0KSB7CiAgICAgICAgICAgICAgICAgICAgcG9zdC50aGVuKGZ1bmN0aW9uIChyZXNwb25zZSkgewogICAgICAgICAgICAgICAgICAgICAgaWYgKCFyZXNwb25zZSB8fCByZXNwb25zZS5zdGF0dXMgIT09IDIwMCkgewogICAgICAgICAgICAgICAgICAgICAgICBfdGhpczYuJE5vdGljZS5lcnJvcih7CiAgICAgICAgICAgICAgICAgICAgICAgICAgdGl0bGU6ICcnLAogICAgICAgICAgICAgICAgICAgICAgICAgIGRlc2M6ICfliKDpmaTmlbDmja7lpLHotKUsJyArIHJlc3BvbnNlLmluZm8KICAgICAgICAgICAgICAgICAgICAgICAgfSk7CgogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICBfdGhpczYuJE5vdGljZS5zdWNjZXNzKHsKICAgICAgICAgICAgICAgICAgICAgICAgICB0aXRsZTogJycsCiAgICAgICAgICAgICAgICAgICAgICAgICAgZGVzYzogJ+WIoOmZpOaIkOWKnyEnCiAgICAgICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgICAgfSAvL+WIoOmZpGl0ZW1z5Lit5bey5Yig6Zmk55qE6aG5CgoKICAgICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKF90aGlzNi5pdGVtcyk7CgogICAgICAgICAgICAgICAgICAgICAgX2RhdGFzLmZvckVhY2goZnVuY3Rpb24gKGRhdGEpIHsKICAgICAgICAgICAgICAgICAgICAgICAgX3RoaXM2Lml0ZW1zLnNvbWUoZnVuY3Rpb24gKGl0ZW0sIGluZGV4KSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKE9iamVjdC5pcyhpdGVtLnNyZmtleSwgZGF0YS5zcmZrZXkpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBfdGhpczYuaXRlbXMuc3BsaWNlKGluZGV4LCAxKTsKCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBfdGhpczYuZ3JpZEl0ZW1zTW9kZWwuc3BsaWNlKGluZGV4LCAxKTsKCiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgICAgfSk7CgogICAgICAgICAgICAgICAgICAgICAgX3RoaXM2LnRvdGFscm93IC09IF9kYXRhcy5sZW5ndGg7CgogICAgICAgICAgICAgICAgICAgICAgX3RoaXM2LiRlbWl0KCdyZW1vdmUnLCBudWxsKTsKCiAgICAgICAgICAgICAgICAgICAgICBfdGhpczYuc2VsZWN0aW9ucyA9IFtdOwogICAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZShyZXNwb25zZSk7CiAgICAgICAgICAgICAgICAgICAgfSlbImNhdGNoIl0oZnVuY3Rpb24gKHJlc3BvbnNlKSB7CiAgICAgICAgICAgICAgICAgICAgICBpZiAocmVzcG9uc2UgJiYgcmVzcG9uc2Uuc3RhdHVzID09PSA0MDEpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICAgIGlmICghcmVzcG9uc2UgfHwgIXJlc3BvbnNlLnN0YXR1cyB8fCAhcmVzcG9uc2UuZGF0YSkgewogICAgICAgICAgICAgICAgICAgICAgICBfdGhpczYuJE5vdGljZS5lcnJvcih7CiAgICAgICAgICAgICAgICAgICAgICAgICAgdGl0bGU6ICfplJnor68nLAogICAgICAgICAgICAgICAgICAgICAgICAgIGRlc2M6ICfns7vnu5/lvILluLgnCiAgICAgICAgICAgICAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgICAgICAgICAgICAgcmVqZWN0KHJlc3BvbnNlKTsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICAgIHJlamVjdChyZXNwb25zZSk7CiAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgfTsKCiAgICAgICAgICAgICAgICBkYXRhSW5mbyA9IGRhdGFJbmZvLnJlcGxhY2UoL1tudWxsXS9nLCAnJykucmVwbGFjZSgvW3VuZGVmaW5lZF0vZywgJycpOwogICAgICAgICAgICAgICAgdGhpcy4kTW9kYWwuY29uZmlybSh7CiAgICAgICAgICAgICAgICAgIHRpdGxlOiAn6K2m5ZGKJywKICAgICAgICAgICAgICAgICAgY29udGVudDogJ+ehruiupOimgeWIoOmZpCAnICsgZGF0YUluZm8gKyAn77yM5Yig6Zmk5pON5L2c5bCG5LiN5Y+v5oGi5aSN77yfJywKICAgICAgICAgICAgICAgICAgb25PazogZnVuY3Rpb24gb25PaygpIHsKICAgICAgICAgICAgICAgICAgICByZW1vdmVEYXRhKCk7CiAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgIG9uQ2FuY2VsOiBmdW5jdGlvbiBvbkNhbmNlbCgpIHt9CiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDIuYWJydXB0KCJyZXR1cm4iLCByZW1vdmVEYXRhKTsKCiAgICAgICAgICAgICAgY2FzZSAxNDoKICAgICAgICAgICAgICBjYXNlICJlbmQiOgogICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0Mi5zdG9wKCk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9LCBfY2FsbGVlMiwgdGhpcyk7CiAgICAgIH0pKTsKCiAgICAgIGZ1bmN0aW9uIHJlbW92ZShfeCkgewogICAgICAgIHJldHVybiBfcmVtb3ZlLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7CiAgICAgIH0KCiAgICAgIHJldHVybiByZW1vdmU7CiAgICB9KCkKICAgIC8qKg0KICAgICAqIOaJuemHj+a3u+WKoA0KICAgICAqDQogICAgICogQHBhcmFtIHsqfSBbYXJnPXt9XQ0KICAgICAqIEBtZW1iZXJvZiBHWkRRQmFzZQ0KICAgICAqLwoKICB9LCB7CiAgICBrZXk6ICJhZGRCYXRjaCIsCiAgICB2YWx1ZTogZnVuY3Rpb24gYWRkQmF0Y2goKSB7CiAgICAgIHZhciBhcmcgPSBhcmd1bWVudHMubGVuZ3RoID4gMCAmJiBhcmd1bWVudHNbMF0gIT09IHVuZGVmaW5lZCA/IGFyZ3VtZW50c1swXSA6IHt9OwoKICAgICAgaWYgKCF0aGlzLmZldGNoQWN0aW9uKSB7CiAgICAgICAgdGhpcy4kTm90aWNlLmVycm9yKHsKICAgICAgICAgIHRpdGxlOiAn6ZSZ6K+vJywKICAgICAgICAgIGRlc2M6ICdQSU1QRVJTT05HWlJZSE1DR3JpZFZpZXfop4blm77ooajmoLxmZXRjaEFjdGlvbuWPguaVsOacqumFjee9ricKICAgICAgICB9KTsKICAgICAgICByZXR1cm47CiAgICAgIH0KCiAgICAgIGlmICghYXJnKSB7CiAgICAgICAgYXJnID0ge307CiAgICAgIH0KCiAgICAgIGNvbnNvbGUuZXJyb3IoIuaJuemHj+a3u+WKoOacquWunueOsCIpOwogICAgfQogICAgLyoqDQogICAgICog5pWw5o2u5a+85YWlDQogICAgICoNCiAgICAgKiBAcGFyYW0geyp9IGRhdGENCiAgICAgKiBAbWVtYmVyb2YgR1pEUUJhc2UNCiAgICAgKi8KCiAgfSwgewogICAga2V5OiAiaW1wb3J0RXhjZWwiLAogICAgdmFsdWU6IGZ1bmN0aW9uIGltcG9ydEV4Y2VsKCkgewogICAgICB2YXIgX3RoaXM3ID0gdGhpczsKCiAgICAgIHZhciBkYXRhID0gYXJndW1lbnRzLmxlbmd0aCA+IDAgJiYgYXJndW1lbnRzWzBdICE9PSB1bmRlZmluZWQgPyBhcmd1bWVudHNbMF0gOiB7fTsKICAgICAgLy/lr7zlhaVleGNlbAogICAgICB2YXIgaW1wb3J0RGF0YU1vZGVsID0ge307CgogICAgICBpZiAoT2JqZWN0LmtleXMoaW1wb3J0RGF0YU1vZGVsKS5sZW5ndGggPT0gMCkgewogICAgICAgIHRoaXMuJE5vdGljZS53YXJuaW5nKHsKICAgICAgICAgICd0aXRsZSc6IHRoaXMuJHQoImFwcC51dGlsdmlldy53YXJuaW5nIiksCiAgICAgICAgICAnZGVzYyc6IHRoaXMuJHQoImFwcC51dGlsdmlldy5pbmZvIikKICAgICAgICB9KTsKICAgICAgICByZXR1cm47CiAgICAgIH0KCiAgICAgIHZhciB2aWV3ID0gewogICAgICAgIHZpZXduYW1lOiAnYXBwLWRhdGEtdXBsb2FkJywKICAgICAgICB0aXRsZTogdGhpcy4kdCgiYXBwLnV0aWx2aWV3LmltcG9ydHZpZXciKSwKICAgICAgICB3aWR0aDogOTAwLAogICAgICAgIGhlaWdodDogNzAwCiAgICAgIH07CiAgICAgIHZhciBjb250YWluZXIgPSB0aGlzLiRhcHBtb2RhbC5vcGVuTW9kYWwodmlldywgSlNPTi5wYXJzZShKU09OLnN0cmluZ2lmeSh0aGlzLmNvbnRleHQpKSwgaW1wb3J0RGF0YU1vZGVsKTsKICAgICAgY29udGFpbmVyLnN1YnNjcmliZShmdW5jdGlvbiAocmVzdWx0KSB7CiAgICAgICAgaWYgKE9iamVjdC5pcyhyZXN1bHQucmV0LCAnT0snKSkgewogICAgICAgICAgX3RoaXM3LnJlZnJlc2gocmVzdWx0LmRhdGFzKTsKICAgICAgICB9CiAgICAgIH0pOwogICAgfQogICAgLyoqDQogICAgICog5pWw5o2u5a+85Ye6DQogICAgICoNCiAgICAgKiBAcGFyYW0geyp9IGRhdGENCiAgICAgKiBAbWVtYmVyb2YgR1pEUUJhc2UNCiAgICAgKi8KCiAgfSwgewogICAga2V5OiAiZXhwb3J0RXhjZWwiLAogICAgdmFsdWU6IGZ1bmN0aW9uIGV4cG9ydEV4Y2VsKCkgewogICAgICB2YXIgX3RoaXM4ID0gdGhpczsKCiAgICAgIHZhciBkYXRhID0gYXJndW1lbnRzLmxlbmd0aCA+IDAgJiYgYXJndW1lbnRzWzBdICE9PSB1bmRlZmluZWQgPyBhcmd1bWVudHNbMF0gOiB7fTsKCiAgICAgIC8vIOWvvOWHukV4Y2VsCiAgICAgIHZhciBkb0V4cG9ydCA9CiAgICAgIC8qI19fUFVSRV9fKi8KICAgICAgZnVuY3Rpb24gKCkgewogICAgICAgIHZhciBfcmVmMiA9IF9hc3luY1RvR2VuZXJhdG9yKAogICAgICAgIC8qI19fUFVSRV9fKi8KICAgICAgICByZWdlbmVyYXRvclJ1bnRpbWUubWFyayhmdW5jdGlvbiBfY2FsbGVlMyhfZGF0YSkgewogICAgICAgICAgdmFyIHRIZWFkZXIsIGZpbHRlclZhbCwgZGF0YTsKICAgICAgICAgIHJldHVybiByZWdlbmVyYXRvclJ1bnRpbWUud3JhcChmdW5jdGlvbiBfY2FsbGVlMyQoX2NvbnRleHQzKSB7CiAgICAgICAgICAgIHdoaWxlICgxKSB7CiAgICAgICAgICAgICAgc3dpdGNoIChfY29udGV4dDMucHJldiA9IF9jb250ZXh0My5uZXh0KSB7CiAgICAgICAgICAgICAgICBjYXNlIDA6CiAgICAgICAgICAgICAgICAgIHRIZWFkZXIgPSBbXTsKICAgICAgICAgICAgICAgICAgZmlsdGVyVmFsID0gW107CgogICAgICAgICAgICAgICAgICBfdGhpczguYWxsQ29sdW1ucy5mb3JFYWNoKGZ1bmN0aW9uIChpdGVtKSB7CiAgICAgICAgICAgICAgICAgICAgaXRlbS5zaG93ICYmIGl0ZW0ubGFiZWwgPyB0SGVhZGVyLnB1c2goX3RoaXM4LiR0KGl0ZW0ubGFuZ3RhZykpIDogIiI7CiAgICAgICAgICAgICAgICAgICAgaXRlbS5zaG93ICYmIGl0ZW0ubmFtZSA/IGZpbHRlclZhbC5wdXNoKGl0ZW0ubmFtZSkgOiAiIjsKICAgICAgICAgICAgICAgICAgfSk7CgogICAgICAgICAgICAgICAgICBfY29udGV4dDMubmV4dCA9IDU7CiAgICAgICAgICAgICAgICAgIHJldHVybiBfdGhpczguZm9ybWF0RXhjZWxEYXRhKGZpbHRlclZhbCwgX2RhdGEpOwoKICAgICAgICAgICAgICAgIGNhc2UgNToKICAgICAgICAgICAgICAgICAgZGF0YSA9IF9jb250ZXh0My5zZW50OwoKICAgICAgICAgICAgICAgICAgX3RoaXM4LiRleHBvcnQuZXhwb3J0RXhjZWwoKS50aGVuKGZ1bmN0aW9uIChleGNlbCkgewogICAgICAgICAgICAgICAgICAgIGV4Y2VsLmV4cG9ydF9qc29uX3RvX2V4Y2VsKHsKICAgICAgICAgICAgICAgICAgICAgIGhlYWRlcjogdEhlYWRlciwKICAgICAgICAgICAgICAgICAgICAgIGRhdGE6IGRhdGEsCiAgICAgICAgICAgICAgICAgICAgICBmaWxlbmFtZTogIuS6uuWRmOS/oeaBr+ihqCIsCiAgICAgICAgICAgICAgICAgICAgICBhdXRvV2lkdGg6IHRydWUsCiAgICAgICAgICAgICAgICAgICAgICBib29rVHlwZTogInhsc3giIC8v6Z2e5b+F5aGrCgogICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICB9KTsKCiAgICAgICAgICAgICAgICBjYXNlIDc6CiAgICAgICAgICAgICAgICBjYXNlICJlbmQiOgogICAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQzLnN0b3AoKTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgIH0sIF9jYWxsZWUzKTsKICAgICAgICB9KSk7CgogICAgICAgIHJldHVybiBmdW5jdGlvbiBkb0V4cG9ydChfeDIpIHsKICAgICAgICAgIHJldHVybiBfcmVmMi5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwogICAgICAgIH07CiAgICAgIH0oKTsKCiAgICAgIHZhciBwYWdlID0ge307IC8vIOiuvue9rnBhZ2XvvIxzaXplCgogICAgICBpZiAoT2JqZWN0LmlzKGRhdGEudHlwZSwgJ21heFJvd0NvdW50JykpIHsKICAgICAgICBPYmplY3QuYXNzaWduKHBhZ2UsIHsKICAgICAgICAgIHBhZ2U6IDAsCiAgICAgICAgICBzaXplOiBkYXRhLm1heFJvd0NvdW50CiAgICAgICAgfSk7CiAgICAgIH0gZWxzZSBpZiAoT2JqZWN0LmlzKGRhdGEudHlwZSwgJ2FjdGl2YXRlZFBhZ2UnKSkgewogICAgICAgIHRyeSB7CiAgICAgICAgICBkb0V4cG9ydChKU09OLnBhcnNlKEpTT04uc3RyaW5naWZ5KHRoaXMuaXRlbXMpKSk7CiAgICAgICAgfSBjYXRjaCAoZXJyb3IpIHsKICAgICAgICAgIGNvbnNvbGUuZXJyb3IoZXJyb3IpOwogICAgICAgIH0KCiAgICAgICAgcmV0dXJuOwogICAgICB9IC8vIOiuvue9ruaOkuW6jwoKCiAgICAgIGlmICghdGhpcy5pc05vU29ydCAmJiAhT2JqZWN0LmlzKHRoaXMubWlub3JTb3J0RGlyLCAnJykgJiYgIU9iamVjdC5pcyh0aGlzLm1pbm9yU29ydFBTREVGLCAnJykpIHsKICAgICAgICB2YXIgc29ydCA9IHRoaXMubWlub3JTb3J0UFNERUYgKyAiLCIgKyB0aGlzLm1pbm9yU29ydERpcjsKICAgICAgICBPYmplY3QuYXNzaWduKHBhZ2UsIHsKICAgICAgICAgIHNvcnQ6IHNvcnQKICAgICAgICB9KTsKICAgICAgfQoKICAgICAgdmFyIGFyZyA9IHt9OwogICAgICBPYmplY3QuYXNzaWduKGFyZywgcGFnZSk7IC8vIOiOt+WPlnF1ZXJ5LOaQnOe0ouihqOWNle+8jHZpZXdwYXJhbXPnrYnniLbmlbDmja4KCiAgICAgIHZhciBwYXJlbnRkYXRhID0ge307CiAgICAgIHRoaXMuJGVtaXQoJ2JlZm9yZWxvYWQnLCBwYXJlbnRkYXRhKTsKICAgICAgT2JqZWN0LmFzc2lnbihhcmcsIHBhcmVudGRhdGEpOwogICAgICB2YXIgcG9zdCA9IHRoaXMuc2VydmljZS5zZWFyY2godGhpcy5mZXRjaEFjdGlvbiwgSlNPTi5wYXJzZShKU09OLnN0cmluZ2lmeSh0aGlzLmNvbnRleHQpKSwgYXJnLCB0aGlzLnNob3dCdXN5SW5kaWNhdG9yKTsKICAgICAgcG9zdC50aGVuKGZ1bmN0aW9uIChyZXNwb25zZSkgewogICAgICAgIGlmICghcmVzcG9uc2UgfHwgcmVzcG9uc2Uuc3RhdHVzICE9PSAyMDApIHsKICAgICAgICAgIF90aGlzOC4kTm90aWNlLmVycm9yKHsKICAgICAgICAgICAgdGl0bGU6ICcnLAogICAgICAgICAgICBkZXNjOiAn5pWw5o2u5a+85Ye65aSx6LSlLCcgKyByZXNwb25zZS5pbmZvCiAgICAgICAgICB9KTsKCiAgICAgICAgICByZXR1cm47CiAgICAgICAgfQoKICAgICAgICB0cnkgewogICAgICAgICAgZG9FeHBvcnQoSlNPTi5wYXJzZShKU09OLnN0cmluZ2lmeShyZXNwb25zZS5kYXRhKSkpOwogICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7CiAgICAgICAgICBjb25zb2xlLmVycm9yKGVycm9yKTsKICAgICAgICB9CiAgICAgIH0pWyJjYXRjaCJdKGZ1bmN0aW9uIChyZXNwb25zZSkgewogICAgICAgIGlmIChyZXNwb25zZSAmJiByZXNwb25zZS5zdGF0dXMgPT09IDQwMSkgewogICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KCiAgICAgICAgX3RoaXM4LiROb3RpY2UuZXJyb3IoewogICAgICAgICAgdGl0bGU6ICcnLAogICAgICAgICAgZGVzYzogJ+aVsOaNruWvvOWHuuWksei0pScKICAgICAgICB9KTsKICAgICAgfSk7CiAgICB9CiAgICAvKioNCiAgICAgKiDlr7zlh7rmlbDmja7moLzlvI/ljJYNCiAgICAgKg0KICAgICAqIEBwYXJhbSB7Kn0gZmlsdGVyVmFsDQogICAgICogQHBhcmFtIHsqfSBqc29uRGF0YQ0KICAgICAqIEByZXR1cm5zIHtbXX0NCiAgICAgKiBAbWVtYmVyb2YgR1pEUUJhc2UNCiAgICAgKi8KCiAgfSwgewogICAga2V5OiAiZm9ybWF0RXhjZWxEYXRhIiwKICAgIHZhbHVlOiBmdW5jdGlvbiAoKSB7CiAgICAgIHZhciBfZm9ybWF0RXhjZWxEYXRhID0gX2FzeW5jVG9HZW5lcmF0b3IoCiAgICAgIC8qI19fUFVSRV9fKi8KICAgICAgcmVnZW5lcmF0b3JSdW50aW1lLm1hcmsoZnVuY3Rpb24gX2NhbGxlZTQoZmlsdGVyVmFsLCBqc29uRGF0YSkgewogICAgICAgIHZhciBjb2RlbGlzdENvbHVtbnMsIF90aGlzLCBfbG9vcCwgX2kyLCBfY29kZWxpc3RDb2x1bW5zOwoKICAgICAgICByZXR1cm4gcmVnZW5lcmF0b3JSdW50aW1lLndyYXAoZnVuY3Rpb24gX2NhbGxlZTQkKF9jb250ZXh0NSkgewogICAgICAgICAgd2hpbGUgKDEpIHsKICAgICAgICAgICAgc3dpdGNoIChfY29udGV4dDUucHJldiA9IF9jb250ZXh0NS5uZXh0KSB7CiAgICAgICAgICAgICAgY2FzZSAwOgogICAgICAgICAgICAgICAgY29kZWxpc3RDb2x1bW5zID0gW3sKICAgICAgICAgICAgICAgICAgbmFtZTogJ3lnenQnLAogICAgICAgICAgICAgICAgICBzcmZrZXk6ICdFaHJDb2RlTGlzdDAwMTQnLAogICAgICAgICAgICAgICAgICBjb2RlbGlzdFR5cGU6ICdEWU5BTUlDJywKICAgICAgICAgICAgICAgICAgcmVuZGVyTW9kZTogJ290aGVyJywKICAgICAgICAgICAgICAgICAgdGV4dFNlcGFyYXRvcjogJ+OAgScsCiAgICAgICAgICAgICAgICAgIHZhbHVlU2VwYXJhdG9yOiAnLCcKICAgICAgICAgICAgICAgIH0sIHsKICAgICAgICAgICAgICAgICAgbmFtZTogJ2d6enQnLAogICAgICAgICAgICAgICAgICBzcmZrZXk6ICdFaHJDb2RlTGlzdDAyMjgnLAogICAgICAgICAgICAgICAgICBjb2RlbGlzdFR5cGU6ICdTVEFUSUMnLAogICAgICAgICAgICAgICAgICByZW5kZXJNb2RlOiAnb3RoZXInLAogICAgICAgICAgICAgICAgICB0ZXh0U2VwYXJhdG9yOiAn44CBJywKICAgICAgICAgICAgICAgICAgdmFsdWVTZXBhcmF0b3I6ICcsJwogICAgICAgICAgICAgICAgfV07CiAgICAgICAgICAgICAgICBfdGhpcyA9IHRoaXM7CiAgICAgICAgICAgICAgICBfbG9vcCA9CiAgICAgICAgICAgICAgICAvKiNfX1BVUkVfXyovCiAgICAgICAgICAgICAgICByZWdlbmVyYXRvclJ1bnRpbWUubWFyayhmdW5jdGlvbiBfbG9vcCgpIHsKICAgICAgICAgICAgICAgICAgdmFyIGNvZGVsaXN0LCBpdGVtcywgX2l0ZW1zOwoKICAgICAgICAgICAgICAgICAgcmV0dXJuIHJlZ2VuZXJhdG9yUnVudGltZS53cmFwKGZ1bmN0aW9uIF9sb29wJChfY29udGV4dDQpIHsKICAgICAgICAgICAgICAgICAgICB3aGlsZSAoMSkgewogICAgICAgICAgICAgICAgICAgICAgc3dpdGNoIChfY29udGV4dDQucHJldiA9IF9jb250ZXh0NC5uZXh0KSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgMDoKICAgICAgICAgICAgICAgICAgICAgICAgICBjb2RlbGlzdCA9IF9jb2RlbGlzdENvbHVtbnNbX2kyXTsKCiAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCFPYmplY3QuaXMoY29kZWxpc3QuY29kZWxpc3RUeXBlLCAiRFlOQU1JQyIpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBfY29udGV4dDQubmV4dCA9IDg7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgICAgICAgIF9jb250ZXh0NC5uZXh0ID0gNDsKICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gX3RoaXMuY29kZUxpc3RTZXJ2aWNlLmdldEl0ZW1zKGNvZGVsaXN0LnNyZmtleSk7CgogICAgICAgICAgICAgICAgICAgICAgICBjYXNlIDQ6CiAgICAgICAgICAgICAgICAgICAgICAgICAgaXRlbXMgPSBfY29udGV4dDQuc2VudDsKICAgICAgICAgICAgICAgICAgICAgICAgICBqc29uRGF0YS5mb3JFYWNoKGZ1bmN0aW9uIChyb3cpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJvd1tjb2RlbGlzdC5uYW1lXSA9IF90aGlzLmdldENvZGVsaXN0VmFsdWUoaXRlbXMsIHJvd1tjb2RlbGlzdC5uYW1lXSwgY29kZWxpc3QpOwogICAgICAgICAgICAgICAgICAgICAgICAgIH0pOyAvLyDpnZnmgIHlpITnkIYKCiAgICAgICAgICAgICAgICAgICAgICAgICAgX2NvbnRleHQ0Lm5leHQgPSAxMzsKICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKCiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgODoKICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoIU9iamVjdC5pcyhjb2RlbGlzdC5jb2RlbGlzdFR5cGUsICJTVEFUSUMiKSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgX2NvbnRleHQ0Lm5leHQgPSAxMzsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgICAgICAgX2NvbnRleHQ0Lm5leHQgPSAxMTsKICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gX3RoaXMuJHN0b3JlLmdldHRlcnMuZ2V0Q29kZUxpc3RJdGVtcyhjb2RlbGlzdC5zcmZrZXkpOwoKICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAxMToKICAgICAgICAgICAgICAgICAgICAgICAgICBfaXRlbXMgPSBfY29udGV4dDQuc2VudDsKICAgICAgICAgICAgICAgICAgICAgICAgICBqc29uRGF0YS5mb3JFYWNoKGZ1bmN0aW9uIChyb3cpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJvd1tjb2RlbGlzdC5uYW1lXSA9IF90aGlzLmdldENvZGVsaXN0VmFsdWUoX2l0ZW1zLCByb3dbY29kZWxpc3QubmFtZV0sIGNvZGVsaXN0KTsKICAgICAgICAgICAgICAgICAgICAgICAgICB9KTsKCiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgMTM6CiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgImVuZCI6CiAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0NC5zdG9wKCk7CiAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICB9LCBfbG9vcCk7CiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIF9pMiA9IDAsIF9jb2RlbGlzdENvbHVtbnMgPSBjb2RlbGlzdENvbHVtbnM7CgogICAgICAgICAgICAgIGNhc2UgNDoKICAgICAgICAgICAgICAgIGlmICghKF9pMiA8IF9jb2RlbGlzdENvbHVtbnMubGVuZ3RoKSkgewogICAgICAgICAgICAgICAgICBfY29udGV4dDUubmV4dCA9IDk7CiAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDUuZGVsZWdhdGVZaWVsZChfbG9vcCgpLCAidDAiLCA2KTsKCiAgICAgICAgICAgICAgY2FzZSA2OgogICAgICAgICAgICAgICAgX2kyKys7CiAgICAgICAgICAgICAgICBfY29udGV4dDUubmV4dCA9IDQ7CiAgICAgICAgICAgICAgICBicmVhazsKCiAgICAgICAgICAgICAgY2FzZSA5OgogICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0NS5hYnJ1cHQoInJldHVybiIsIGpzb25EYXRhLm1hcChmdW5jdGlvbiAodikgewogICAgICAgICAgICAgICAgICByZXR1cm4gZmlsdGVyVmFsLm1hcChmdW5jdGlvbiAoaikgewogICAgICAgICAgICAgICAgICAgIHJldHVybiB2W2pdOwogICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIH0pKTsKCiAgICAgICAgICAgICAgY2FzZSAxMDoKICAgICAgICAgICAgICBjYXNlICJlbmQiOgogICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0NS5zdG9wKCk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9LCBfY2FsbGVlNCwgdGhpcyk7CiAgICAgIH0pKTsKCiAgICAgIGZ1bmN0aW9uIGZvcm1hdEV4Y2VsRGF0YShfeDMsIF94NCkgewogICAgICAgIHJldHVybiBfZm9ybWF0RXhjZWxEYXRhLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7CiAgICAgIH0KCiAgICAgIHJldHVybiBmb3JtYXRFeGNlbERhdGE7CiAgICB9KCkKICAgIC8qKg0KICAgICAqIOino+aekOS7o+eggeihqOWSjHZsYXVl77yM6K6+572uaXRlbXMNCiAgICAgKg0KICAgICAqIEBwdWJsaWMNCiAgICAgKiBAcGFyYW0ge2FueVtdfSBpdGVtcyDku6PnoIHooajmlbDmja4NCiAgICAgKiBAcGFyYW0geyp9IHZhbHVlDQogICAgICogQHJldHVybnMgeyp9DQogICAgICogQG1lbWJlcm9mIEdaRFFCYXNlDQogICAgICovCgogIH0sIHsKICAgIGtleTogImdldENvZGVsaXN0VmFsdWUiLAogICAgdmFsdWU6IGZ1bmN0aW9uIGdldENvZGVsaXN0VmFsdWUoaXRlbXMsIHZhbHVlLCBjb2RlbGlzdCkgewogICAgICB2YXIgX3RoaXM5ID0gdGhpczsKCiAgICAgIGlmICghdmFsdWUpIHsKICAgICAgICByZXR1cm4gdGhpcy4kdCgnY29kZWxpc3QuJyArIGNvZGVsaXN0LnNyZmtleSArICcuZW1wdHknKTsKICAgICAgfQoKICAgICAgaWYgKGl0ZW1zKSB7CiAgICAgICAgdmFyIHJlc3VsdCA9IFtdOwoKICAgICAgICBpZiAoT2JqZWN0LmlzKGNvZGVsaXN0LnJlbmRlck1vZGUsICJudW1iZXIiKSkgewogICAgICAgICAgaXRlbXMubWFwKGZ1bmN0aW9uIChfaXRlbSwgaW5kZXgpIHsKICAgICAgICAgICAgdmFyIG5WYWx1ZSA9IHBhcnNlSW50KHZhbHVlLCAxMCk7CiAgICAgICAgICAgIHZhciBjb2RldmFsdWUgPSBfaXRlbS52YWx1ZTsKCiAgICAgICAgICAgIGlmICgocGFyc2VJbnQoY29kZXZhbHVlLCAxMCkgJiBuVmFsdWUpID4gMCkgewogICAgICAgICAgICAgIHJlc3VsdC5wdXNoKF9pdGVtKTsKICAgICAgICAgICAgfQogICAgICAgICAgfSk7CiAgICAgICAgfSBlbHNlIGlmIChPYmplY3QuaXMoY29kZWxpc3QucmVuZGVyTW9kZSwgInN0cmluZyIpKSB7CiAgICAgICAgICB2YXIgYXJyYXlWYWx1ZSA9IHZhbHVlLnNwbGl0KGNvZGVsaXN0LnZhbHVlU2VwYXJhdG9yKTsKICAgICAgICAgIGFycmF5VmFsdWUubWFwKGZ1bmN0aW9uICh2YWx1ZSwgaW5kZXgpIHsKICAgICAgICAgICAgcmVzdWx0LnB1c2goW10pOwogICAgICAgICAgICB2YXIgdmFsdWVzID0gT2JqZWN0LmlzKF90aGlzOS4kdXRpbC50eXBlT2YodmFsdWUpLCAnbnVtYmVyJykgPyBbdmFsdWVdIDogX3RvQ29uc3VtYWJsZUFycmF5KHZhbHVlLnNwbGl0KGNvZGVsaXN0LnZhbHVlU2VwYXJhdG9yKSk7CiAgICAgICAgICAgIHZhbHVlcy5tYXAoZnVuY3Rpb24gKHZhbCwgbnVtKSB7CiAgICAgICAgICAgICAgdmFyIGl0ZW0gPSBfdGhpczkuZ2V0SXRlbShpdGVtcywgdmFsLCBjb2RlbGlzdCk7CgogICAgICAgICAgICAgIGlmIChpdGVtKSB7CiAgICAgICAgICAgICAgICByZXN1bHRbaW5kZXhdLnB1c2goaXRlbSk7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9KTsKICAgICAgICAgIH0pOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICB2YXIgdmFsdWVzID0gT2JqZWN0LmlzKHRoaXMuJHV0aWwudHlwZU9mKHZhbHVlKSwgJ251bWJlcicpID8gW3ZhbHVlXSA6IF90b0NvbnN1bWFibGVBcnJheSh2YWx1ZS5zcGxpdChjb2RlbGlzdC52YWx1ZVNlcGFyYXRvcikpOwogICAgICAgICAgdmFsdWVzLm1hcChmdW5jdGlvbiAodmFsdWUsIGluZGV4KSB7CiAgICAgICAgICAgIHZhciBpdGVtID0gX3RoaXM5LmdldEl0ZW0oaXRlbXMsIHZhbHVlLCBjb2RlbGlzdCk7CgogICAgICAgICAgICBpZiAoaXRlbSkgewogICAgICAgICAgICAgIHJlc3VsdC5wdXNoKGl0ZW0pOwogICAgICAgICAgICB9CiAgICAgICAgICB9KTsKICAgICAgICB9IC8vIOiuvue9rml0ZW1zCgoKICAgICAgICBpZiAocmVzdWx0Lmxlbmd0aCAhPSAwKSB7CiAgICAgICAgICByZXR1cm4gcmVzdWx0LmpvaW4oY29kZWxpc3QudmFsdWVTZXBhcmF0b3IpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICByZXR1cm4gdmFsdWU7CiAgICAgICAgfQogICAgICB9CiAgICB9CiAgICAvKioNCiAgICAgKiDojrflj5bku6PnoIHpobkNCiAgICAgKg0KICAgICAqIEBwdWJsaWMNCiAgICAgKiBAcGFyYW0ge2FueVtdfSBpdGVtcw0KICAgICAqIEBwYXJhbSB7Kn0gdmFsdWUNCiAgICAgKiBAcmV0dXJucyB7Kn0NCiAgICAgKiBAbWVtYmVyb2YgR1pEUUJhc2UNCiAgICAgKi8KCiAgfSwgewogICAga2V5OiAiZ2V0SXRlbSIsCiAgICB2YWx1ZTogZnVuY3Rpb24gZ2V0SXRlbShpdGVtcywgdmFsdWUsIGNvZGVsaXN0KSB7CiAgICAgIHZhciBhcnIgPSBpdGVtcy5maWx0ZXIoZnVuY3Rpb24gKGl0ZW0pIHsKICAgICAgICByZXR1cm4gaXRlbS52YWx1ZSA9PSB2YWx1ZTsKICAgICAgfSk7CgogICAgICBpZiAoYXJyLmxlbmd0aCAhPT0gMSkgewogICAgICAgIHJldHVybiB1bmRlZmluZWQ7CiAgICAgIH0KCiAgICAgIGlmIChPYmplY3QuaXMoY29kZWxpc3QuY29kZWxpc3RUeXBlLCAnU1RBVElDJykpIHsKICAgICAgICByZXR1cm4gdGhpcy4kdCgnY29kZWxpc3QuJyArIGNvZGVsaXN0LnNyZmtleSArICcuJyArIGFyclswXS52YWx1ZSk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgcmV0dXJuIGFyclswXS50ZXh0OwogICAgICB9CiAgICB9CiAgICAvKioNCiAgICAgKiDnlJ/lkb3lkajmnJ8NCiAgICAgKg0KICAgICAqIEBtZW1iZXJvZiBHWkRRQmFzZQ0KICAgICAqLwoKICB9LCB7CiAgICBrZXk6ICJjcmVhdGVkIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBjcmVhdGVkKCkgewogICAgICB0aGlzLmFmdGVyQ3JlYXRlZCgpOwogICAgfQogICAgLyoqDQogICAgICog5omn6KGMY3JlYXRlZOWQjueahOmAu+i+kQ0KICAgICAqDQogICAgICogIEBtZW1iZXJvZiBHWkRRQmFzZQ0KICAgICAqLwoKICB9LCB7CiAgICBrZXk6ICJhZnRlckNyZWF0ZWQiLAogICAgdmFsdWU6IGZ1bmN0aW9uIGFmdGVyQ3JlYXRlZCgpIHsKICAgICAgdmFyIF90aGlzMTAgPSB0aGlzOwoKICAgICAgdGhpcy5zZXRDb2xTdGF0ZSgpOwoKICAgICAgaWYgKHRoaXMudmlld1N0YXRlKSB7CiAgICAgICAgdGhpcy52aWV3U3RhdGVFdmVudCA9IHRoaXMudmlld1N0YXRlLnN1YnNjcmliZShmdW5jdGlvbiAoX3JlZjMpIHsKICAgICAgICAgIHZhciB0YWcgPSBfcmVmMy50YWcsCiAgICAgICAgICAgICAgYWN0aW9uID0gX3JlZjMuYWN0aW9uLAogICAgICAgICAgICAgIGRhdGEgPSBfcmVmMy5kYXRhOwoKICAgICAgICAgIGlmICghT2JqZWN0LmlzKHRhZywgX3RoaXMxMC5uYW1lKSkgewogICAgICAgICAgICByZXR1cm47CiAgICAgICAgICB9CgogICAgICAgICAgaWYgKE9iamVjdC5pcygnbG9hZCcsIGFjdGlvbikpIHsKICAgICAgICAgICAgX3RoaXMxMC5sb2FkKGRhdGEpOwogICAgICAgICAgfQoKICAgICAgICAgIGlmIChPYmplY3QuaXMoJ3JlbW92ZScsIGFjdGlvbikpIHsKICAgICAgICAgICAgX3RoaXMxMC5yZW1vdmUoZGF0YSk7CiAgICAgICAgICB9CgogICAgICAgICAgaWYgKE9iamVjdC5pcygnc2F2ZScsIGFjdGlvbikpIHsKICAgICAgICAgICAgX3RoaXMxMC5zYXZlKGRhdGEpOwogICAgICAgICAgfQogICAgICAgIH0pOwogICAgICB9CiAgICB9CiAgICAvKioNCiAgICAgKiB2dWUg55Sf5ZG95ZGo5pyfDQogICAgICoNCiAgICAgKiBAbWVtYmVyb2YgR1pEUUJhc2UNCiAgICAgKi8KCiAgfSwgewogICAga2V5OiAiZGVzdHJveWVkIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBkZXN0cm95ZWQoKSB7CiAgICAgIHRoaXMuYWZ0ZXJEZXN0cm95KCk7CiAgICB9CiAgICAvKioNCiAgICAgKiDmiafooYxkZXN0cm95ZWTlkI7nmoTpgLvovpENCiAgICAgKg0KICAgICAqIEBtZW1iZXJvZiBHWkRRQmFzZQ0KICAgICAqLwoKICB9LCB7CiAgICBrZXk6ICJhZnRlckRlc3Ryb3kiLAogICAgdmFsdWU6IGZ1bmN0aW9uIGFmdGVyRGVzdHJveSgpIHsKICAgICAgaWYgKHRoaXMudmlld1N0YXRlRXZlbnQpIHsKICAgICAgICB0aGlzLnZpZXdTdGF0ZUV2ZW50LnVuc3Vic2NyaWJlKCk7CiAgICAgIH0KICAgIH0KICAgIC8qKg0KICAgICAqIOiOt+WPlumAieS4reihjOiDoeaVsOaNrg0KICAgICAqDQogICAgICogQHJldHVybnMge2FueVtdfQ0KICAgICAqIEBtZW1iZXJvZiBHWkRRQmFzZQ0KICAgICAqLwoKICB9LCB7CiAgICBrZXk6ICJnZXRTZWxlY3Rpb24iLAogICAgdmFsdWU6IGZ1bmN0aW9uIGdldFNlbGVjdGlvbigpIHsKICAgICAgcmV0dXJuIHRoaXMuc2VsZWN0aW9uczsKICAgIH0KICAgIC8qKg0KICAgICAqIOihjOWPjOWHu+S6i+S7tg0KICAgICAqDQogICAgICogQHBhcmFtIHsqfSAkZXZlbnQNCiAgICAgKiBAcmV0dXJucyB7dm9pZH0NCiAgICAgKiBAbWVtYmVyb2YgR1pEUUJhc2UNCiAgICAgKi8KCiAgfSwgewogICAga2V5OiAicm93REJMQ2xpY2siLAogICAgdmFsdWU6IGZ1bmN0aW9uIHJvd0RCTENsaWNrKCRldmVudCkgewogICAgICBpZiAoISRldmVudCB8fCB0aGlzLmFjdHVhbElzT3BlbkVkaXQgfHwgT2JqZWN0LmlzKHRoaXMuZ3JpZFJvd0FjdGl2ZU1vZGUsIDApKSB7CiAgICAgICAgcmV0dXJuOwogICAgICB9CgogICAgICB0aGlzLnNlbGVjdGlvbnMgPSBbXTsKICAgICAgdGhpcy5zZWxlY3Rpb25zLnB1c2goSlNPTi5wYXJzZShKU09OLnN0cmluZ2lmeSgkZXZlbnQpKSk7CiAgICAgIHZhciByZWZzID0gdGhpcy4kcmVmczsKCiAgICAgIGlmIChyZWZzLm11bHRpcGxlVGFibGUpIHsKICAgICAgICByZWZzLm11bHRpcGxlVGFibGUuY2xlYXJTZWxlY3Rpb24oKTsKICAgICAgICByZWZzLm11bHRpcGxlVGFibGUudG9nZ2xlUm93U2VsZWN0aW9uKCRldmVudCk7CiAgICAgIH0KCiAgICAgIHRoaXMuJGVtaXQoJ3Jvd2RibGNsaWNrJywgdGhpcy5zZWxlY3Rpb25zKTsKICAgICAgdGhpcy4kZW1pdCgnc2VsZWN0aW9uY2hhbmdlJywgdGhpcy5zZWxlY3Rpb25zKTsKICAgIH0KICAgIC8qKg0KICAgICAqIOWkjemAieahhuaVsOaNrumAieS4rQ0KICAgICAqDQogICAgICogQHBhcmFtIHsqfSAkZXZlbnQNCiAgICAgKiBAcmV0dXJucyB7dm9pZH0NCiAgICAgKiBAbWVtYmVyb2YgR1pEUUJhc2UNCiAgICAgKi8KCiAgfSwgewogICAga2V5OiAic2VsZWN0IiwKICAgIHZhbHVlOiBmdW5jdGlvbiBzZWxlY3QoJGV2ZW50KSB7CiAgICAgIGlmICghJGV2ZW50KSB7CiAgICAgICAgcmV0dXJuOwogICAgICB9CgogICAgICB0aGlzLnNlbGVjdGlvbnMgPSBbXTsKICAgICAgdGhpcy5zZWxlY3Rpb25zID0gX3RvQ29uc3VtYWJsZUFycmF5KEpTT04ucGFyc2UoSlNPTi5zdHJpbmdpZnkoJGV2ZW50KSkpOwogICAgICB0aGlzLiRlbWl0KCdzZWxlY3Rpb25jaGFuZ2UnLCB0aGlzLnNlbGVjdGlvbnMpOwogICAgfQogICAgLyoqDQogICAgICog5aSN6YCJ5qGG5pWw5o2u5YWo6YOo6YCJ5LitDQogICAgICoNCiAgICAgKiBAcGFyYW0geyp9ICRldmVudA0KICAgICAqIEBtZW1iZXJvZiBHWkRRQmFzZQ0KICAgICAqLwoKICB9LCB7CiAgICBrZXk6ICJzZWxlY3RBbGwiLAogICAgdmFsdWU6IGZ1bmN0aW9uIHNlbGVjdEFsbCgkZXZlbnQpIHsKICAgICAgaWYgKCEkZXZlbnQpIHsKICAgICAgICByZXR1cm47CiAgICAgIH0KCiAgICAgIHRoaXMuc2VsZWN0aW9ucyA9IFtdOwogICAgICB0aGlzLnNlbGVjdGlvbnMgPSBfdG9Db25zdW1hYmxlQXJyYXkoSlNPTi5wYXJzZShKU09OLnN0cmluZ2lmeSgkZXZlbnQpKSk7CiAgICAgIHRoaXMuJGVtaXQoJ3NlbGVjdGlvbmNoYW5nZScsIHRoaXMuc2VsZWN0aW9ucyk7CiAgICB9CiAgICAvKioNCiAgICAgKiDooYzljZXlh7vpgInkuK0NCiAgICAgKg0KICAgICAqIEBwYXJhbSB7Kn0gJGV2ZW50DQogICAgICogQHJldHVybnMge3ZvaWR9DQogICAgICogQG1lbWJlcm9mIEdaRFFCYXNlDQogICAgICovCgogIH0sIHsKICAgIGtleTogInJvd0NsaWNrIiwKICAgIHZhbHVlOiBmdW5jdGlvbiByb3dDbGljaygkZXZlbnQpIHsKICAgICAgdmFyIGlmQWx3YXlzID0gYXJndW1lbnRzLmxlbmd0aCA+IDEgJiYgYXJndW1lbnRzWzFdICE9PSB1bmRlZmluZWQgPyBhcmd1bWVudHNbMV0gOiBmYWxzZTsKCiAgICAgIGlmICghaWZBbHdheXMgJiYgKCEkZXZlbnQgfHwgdGhpcy5hY3R1YWxJc09wZW5FZGl0KSkgewogICAgICAgIHJldHVybjsKICAgICAgfQoKICAgICAgaWYgKHRoaXMuc3RvcFJvd0NsaWNrKSB7CiAgICAgICAgdGhpcy5zdG9wUm93Q2xpY2sgPSBmYWxzZTsKICAgICAgICByZXR1cm47CiAgICAgIH0KCiAgICAgIGlmICh0aGlzLmlzU2luZ2xlU2VsZWN0KSB7CiAgICAgICAgdGhpcy5zZWxlY3Rpb25zID0gW107CiAgICAgIH0gLy8g5bey6YCJ5Lit5YiZ5Yig6Zmk77yM5rKh6YCJ5Lit5YiZ5re75YqgCgoKICAgICAgdmFyIHNlbGVjdEluZGV4ID0gdGhpcy5zZWxlY3Rpb25zLmZpbmRJbmRleChmdW5jdGlvbiAoaXRlbSkgewogICAgICAgIHJldHVybiBPYmplY3QuaXMoaXRlbS5waW1wZXJzb24sICRldmVudC5waW1wZXJzb24pOwogICAgICB9KTsKCiAgICAgIGlmIChPYmplY3QuaXMoc2VsZWN0SW5kZXgsIC0xKSkgewogICAgICAgIHRoaXMuc2VsZWN0aW9ucy5wdXNoKEpTT04ucGFyc2UoSlNPTi5zdHJpbmdpZnkoJGV2ZW50KSkpOwogICAgICB9IGVsc2UgewogICAgICAgIHRoaXMuc2VsZWN0aW9ucy5zcGxpY2Uoc2VsZWN0SW5kZXgsIDEpOwogICAgICB9CgogICAgICB2YXIgcmVmcyA9IHRoaXMuJHJlZnM7CgogICAgICBpZiAocmVmcy5tdWx0aXBsZVRhYmxlKSB7CiAgICAgICAgaWYgKHRoaXMuaXNTaW5nbGVTZWxlY3QpIHsKICAgICAgICAgIHJlZnMubXVsdGlwbGVUYWJsZS5jbGVhclNlbGVjdGlvbigpOwogICAgICAgICAgcmVmcy5tdWx0aXBsZVRhYmxlLnNldEN1cnJlbnRSb3coJGV2ZW50KTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgcmVmcy5tdWx0aXBsZVRhYmxlLnRvZ2dsZVJvd1NlbGVjdGlvbigkZXZlbnQpOwogICAgICAgIH0KICAgICAgfQoKICAgICAgdGhpcy4kZW1pdCgnc2VsZWN0aW9uY2hhbmdlJywgdGhpcy5zZWxlY3Rpb25zKTsKICAgIH0KICAgIC8qKg0KICAgICAqIOmhtemdouWPmOWMlg0KICAgICAqDQogICAgICogQHBhcmFtIHsqfSAkZXZlbnQNCiAgICAgKiBAcmV0dXJucyB7dm9pZH0NCiAgICAgKiBAbWVtYmVyb2YgR1pEUUJhc2UNCiAgICAgKi8KCiAgfSwgewogICAga2V5OiAicGFnZU9uQ2hhbmdlIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBwYWdlT25DaGFuZ2UoJGV2ZW50KSB7CiAgICAgIGlmICghJGV2ZW50KSB7CiAgICAgICAgcmV0dXJuOwogICAgICB9CgogICAgICBpZiAoJGV2ZW50ID09PSB0aGlzLmN1clBhZ2UpIHsKICAgICAgICByZXR1cm47CiAgICAgIH0KCiAgICAgIHRoaXMuY3VyUGFnZSA9ICRldmVudDsKICAgICAgdGhpcy5sb2FkKHt9KTsKICAgIH0KICAgIC8qKg0KICAgICAqIOWIhumhteadoeaVsOWPmOWMlg0KICAgICAqDQogICAgICogQHBhcmFtIHsqfSAkZXZlbnQNCiAgICAgKiBAcmV0dXJucyB7dm9pZH0NCiAgICAgKiBAbWVtYmVyb2YgR1pEUUJhc2UNCiAgICAgKi8KCiAgfSwgewogICAga2V5OiAib25QYWdlU2l6ZUNoYW5nZSIsCiAgICB2YWx1ZTogZnVuY3Rpb24gb25QYWdlU2l6ZUNoYW5nZSgkZXZlbnQpIHsKICAgICAgaWYgKCEkZXZlbnQpIHsKICAgICAgICByZXR1cm47CiAgICAgIH0KCiAgICAgIGlmICgkZXZlbnQgPT09IHRoaXMubGltaXQpIHsKICAgICAgICByZXR1cm47CiAgICAgIH0KCiAgICAgIHRoaXMubGltaXQgPSAkZXZlbnQ7CgogICAgICBpZiAodGhpcy5jdXJQYWdlID09PSAxKSB7CiAgICAgICAgdGhpcy5sb2FkKHt9KTsKICAgICAgfQogICAgfQogICAgLyoqDQogICAgICog5YiG6aG15Yi35pawDQogICAgICoNCiAgICAgKiBAbWVtYmVyb2YgR1pEUUJhc2UNCiAgICAgKi8KCiAgfSwgewogICAga2V5OiAicGFnZVJlZnJlc2giLAogICAgdmFsdWU6IGZ1bmN0aW9uIHBhZ2VSZWZyZXNoKCkgewogICAgICB0aGlzLmxvYWQoe30pOwogICAgfQogICAgLyoqDQogICAgICog5o6S5bqP5Y+Y5YyWDQogICAgICoNCiAgICAgKiBAcGFyYW0ge3sgY29sdW1uOiBhbnksIHByb3A6IGFueSwgb3JkZXI6IGFueSB9fSB7IGNvbHVtbiwgcHJvcCwgb3JkZXIgfQ0KICAgICAqIEBtZW1iZXJvZiBHWkRRQmFzZQ0KICAgICAqLwoKICB9LCB7CiAgICBrZXk6ICJvblNvcnRDaGFuZ2UiLAogICAgdmFsdWU6IGZ1bmN0aW9uIG9uU29ydENoYW5nZShfcmVmNCkgewogICAgICB2YXIgY29sdW1uID0gX3JlZjQuY29sdW1uLAogICAgICAgICAgcHJvcCA9IF9yZWY0LnByb3AsCiAgICAgICAgICBvcmRlciA9IF9yZWY0Lm9yZGVyOwogICAgICB2YXIgZGlyID0gT2JqZWN0LmlzKG9yZGVyLCAnYXNjZW5kaW5nJykgPyAnYXNjJyA6IE9iamVjdC5pcyhvcmRlciwgJ2Rlc2NlbmRpbmcnKSA/ICdkZXNjJyA6ICcnOwoKICAgICAgaWYgKE9iamVjdC5pcyhkaXIsIHRoaXMubWlub3JTb3J0RGlyKSAmJiBPYmplY3QuaXModGhpcy5taW5vclNvcnRQU0RFRiwgcHJvcCkpIHsKICAgICAgICByZXR1cm47CiAgICAgIH0KCiAgICAgIHRoaXMubWlub3JTb3J0RGlyID0gZGlyOwogICAgICB0aGlzLm1pbm9yU29ydFBTREVGID0gcHJvcCA/IHByb3AgOiAnJzsKICAgICAgdGhpcy5sb2FkKHt9KTsKICAgIH0KICAgIC8qKg0KICAgICAqIOihqOagvOihjOmAieS4reagt+W8jw0KICAgICAqDQogICAgICogQHBhcmFtIHt7IHJvdzogYW55LCByb3dJbmRleDogYW55IH19IHsgcm93LCByb3dJbmRleCB9DQogICAgICogQHJldHVybnMge3N0cmluZ30NCiAgICAgKiBAbWVtYmVyb2YgR1pEUUJhc2UNCiAgICAgKi8KCiAgfSwgewogICAga2V5OiAib25Sb3dDbGFzc05hbWUiLAogICAgdmFsdWU6IGZ1bmN0aW9uIG9uUm93Q2xhc3NOYW1lKF9yZWY1KSB7CiAgICAgIHZhciByb3cgPSBfcmVmNS5yb3csCiAgICAgICAgICByb3dJbmRleCA9IF9yZWY1LnJvd0luZGV4OwogICAgICB2YXIgaW5kZXggPSB0aGlzLnNlbGVjdGlvbnMuZmluZEluZGV4KGZ1bmN0aW9uIChzZWxlY3QpIHsKICAgICAgICByZXR1cm4gT2JqZWN0LmlzKHNlbGVjdC5zcmZrZXksIHJvdy5zcmZrZXkpOwogICAgICB9KTsKICAgICAgcmV0dXJuIGluZGV4ICE9PSAtMSA/ICdncmlkLXJvdy1zZWxlY3QnIDogJyc7CiAgICB9CiAgICAvKioNCiAgICAgKiDnlYzpnaLooYzkuLoNCiAgICAgKg0KICAgICAqIEBwYXJhbSB7Kn0gcm93DQogICAgICogQHBhcmFtIHsqfSB0YWcNCiAgICAgKiBAcGFyYW0geyp9ICRldmVudA0KICAgICAqIEBtZW1iZXJvZiBHWkRRQmFzZQ0KICAgICAqLwoKICB9LCB7CiAgICBrZXk6ICJ1aUFjdGlvbiIsCiAgICB2YWx1ZTogZnVuY3Rpb24gdWlBY3Rpb24ocm93LCB0YWcsICRldmVudCkgewogICAgICAvLyB0aGlzLnJvd0NsaWNrKHJvdywgdHJ1ZSk7CiAgICAgICRldmVudC5zdG9wUHJvcGFnYXRpb24oKTsKICAgIH0KICAgIC8qKg0KICAgICAqIOiuvue9ruWIl+eKtuaAgQ0KICAgICAqDQogICAgICogQG1lbWJlcm9mIEdaRFFCYXNlDQogICAgICovCgogIH0sIHsKICAgIGtleTogInNldENvbFN0YXRlIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBzZXRDb2xTdGF0ZSgpIHsKICAgICAgdmFyIF90aGlzMTEgPSB0aGlzOwoKICAgICAgdmFyIF9kYXRhID0gbG9jYWxTdG9yYWdlLmdldEl0ZW0oJ3BpbXBlcnNvbl9nemRxX2dyaWQnKTsKCiAgICAgIGlmIChfZGF0YSkgewogICAgICAgIHZhciBjb2x1bW5zID0gSlNPTi5wYXJzZShfZGF0YSk7CiAgICAgICAgY29sdW1ucy5mb3JFYWNoKGZ1bmN0aW9uIChjb2wpIHsKICAgICAgICAgIHZhciBjb2x1bW4gPSBfdGhpczExLmFsbENvbHVtbnMuZmluZChmdW5jdGlvbiAoaXRlbSkgewogICAgICAgICAgICByZXR1cm4gT2JqZWN0LmlzKGNvbC5uYW1lLCBpdGVtLm5hbWUpOwogICAgICAgICAgfSk7CgogICAgICAgICAgaWYgKGNvbHVtbikgewogICAgICAgICAgICBPYmplY3QuYXNzaWduKGNvbHVtbiwgY29sKTsKICAgICAgICAgIH0KICAgICAgICB9KTsKICAgICAgfQogICAgfQogICAgLyoqDQogICAgICog5YiX5Y+Y5YyWDQogICAgICoNCiAgICAgKiBAbWVtYmVyb2YgR1pEUUJhc2UNCiAgICAgKi8KCiAgfSwgewogICAga2V5OiAib25Db2xDaGFuZ2UiLAogICAgdmFsdWU6IGZ1bmN0aW9uIG9uQ29sQ2hhbmdlKCkgewogICAgICBsb2NhbFN0b3JhZ2Uuc2V0SXRlbSgncGltcGVyc29uX2d6ZHFfZ3JpZCcsIEpTT04uc3RyaW5naWZ5KHRoaXMuYWxsQ29sdW1ucykpOwogICAgfQogICAgLyoqDQogICAgICog6I635Y+W5YiX54q25oCBDQogICAgICoNCiAgICAgKiBAcGFyYW0ge3N0cmluZ30gbmFtZQ0KICAgICAqIEByZXR1cm5zIHtib29sZWFufQ0KICAgICAqIEBtZW1iZXJvZiBHWkRRQmFzZQ0KICAgICAqLwoKICB9LCB7CiAgICBrZXk6ICJnZXRDb2x1bW5TdGF0ZSIsCiAgICB2YWx1ZTogZnVuY3Rpb24gZ2V0Q29sdW1uU3RhdGUobmFtZSkgewogICAgICB2YXIgY29sdW1uID0gdGhpcy5hbGxDb2x1bW5zLmZpbmQoZnVuY3Rpb24gKGNvbCkgewogICAgICAgIHJldHVybiBPYmplY3QuaXMobmFtZSwgY29sLm5hbWUpOwogICAgICB9KTsKICAgICAgcmV0dXJuIGNvbHVtbi5zaG93ID8gdHJ1ZSA6IGZhbHNlOwogICAgfQogICAgLyoqDQogICAgICog6KGo5qC85YiX5piv5ZCm6Ieq6YCC5bqU5biD5bGADQogICAgICoNCiAgICAgKiBAcmVhZG9ubHkNCiAgICAgKiBAdHlwZSB7Ym9vbGVhbn0NCiAgICAgKiBAbWVtYmVyb2YgR1pEUUJhc2UNCiAgICAgKi8KCiAgfSwgewogICAga2V5OiAic2F2ZSIsCgogICAgLyoqDQogICAgICog5L+d5a2YDQogICAgICoNCiAgICAgKiBAcGFyYW0geyp9ICRldmVudA0KICAgICAqIEByZXR1cm5zIHtQcm9taXNlPGFueT59DQogICAgICogQG1lbWJlcm9mIEdaRFFCYXNlDQogICAgICovCiAgICB2YWx1ZTogZnVuY3Rpb24gKCkgewogICAgICB2YXIgX3NhdmUgPSBfYXN5bmNUb0dlbmVyYXRvcigKICAgICAgLyojX19QVVJFX18qLwogICAgICByZWdlbmVyYXRvclJ1bnRpbWUubWFyayhmdW5jdGlvbiBfY2FsbGVlNShhcmdzLCBwYXJhbXMsICRldmVudCwgeERhdGEpIHsKICAgICAgICB2YXIgX3RoaXMxMiA9IHRoaXM7CgogICAgICAgIHZhciBfdGhpcywgc3VjY2Vzc0l0ZW1zLCBlcnJvckl0ZW1zLCBlcnJvck1lc3NhZ2UsIF9pdGVyYXRvck5vcm1hbENvbXBsZXRpb24yLCBfZGlkSXRlcmF0b3JFcnJvcjIsIF9pdGVyYXRvckVycm9yMiwgX2l0ZXJhdG9yMiwgX3N0ZXAyLCBpdGVtLCByZXNwb25zZSwgX3Jlc3BvbnNlOwoKICAgICAgICByZXR1cm4gcmVnZW5lcmF0b3JSdW50aW1lLndyYXAoZnVuY3Rpb24gX2NhbGxlZTUkKF9jb250ZXh0NikgewogICAgICAgICAgd2hpbGUgKDEpIHsKICAgICAgICAgICAgc3dpdGNoIChfY29udGV4dDYucHJldiA9IF9jb250ZXh0Ni5uZXh0KSB7CiAgICAgICAgICAgICAgY2FzZSAwOgogICAgICAgICAgICAgICAgX3RoaXMgPSB0aGlzOwogICAgICAgICAgICAgICAgX2NvbnRleHQ2Lm5leHQgPSAzOwogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMudmFsaWRhdGVBbGwoKTsKCiAgICAgICAgICAgICAgY2FzZSAzOgogICAgICAgICAgICAgICAgaWYgKF9jb250ZXh0Ni5zZW50KSB7CiAgICAgICAgICAgICAgICAgIF9jb250ZXh0Ni5uZXh0ID0gNjsKICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgdGhpcy4kTm90aWNlLmVycm9yKHsKICAgICAgICAgICAgICAgICAgdGl0bGU6ICfplJnor68nLAogICAgICAgICAgICAgICAgICBkZXNjOiAn5YC86KeE5YiZ5qCh6aqM5byC5bi4JwogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQ2LmFicnVwdCgicmV0dXJuIiwgW10pOwoKICAgICAgICAgICAgICBjYXNlIDY6CiAgICAgICAgICAgICAgICBzdWNjZXNzSXRlbXMgPSBbXTsKICAgICAgICAgICAgICAgIGVycm9ySXRlbXMgPSBbXTsKICAgICAgICAgICAgICAgIGVycm9yTWVzc2FnZSA9IFtdOwogICAgICAgICAgICAgICAgX2l0ZXJhdG9yTm9ybWFsQ29tcGxldGlvbjIgPSB0cnVlOwogICAgICAgICAgICAgICAgX2RpZEl0ZXJhdG9yRXJyb3IyID0gZmFsc2U7CiAgICAgICAgICAgICAgICBfaXRlcmF0b3JFcnJvcjIgPSB1bmRlZmluZWQ7CiAgICAgICAgICAgICAgICBfY29udGV4dDYucHJldiA9IDEyOwogICAgICAgICAgICAgICAgX2l0ZXJhdG9yMiA9IF90aGlzLml0ZW1zW1N5bWJvbC5pdGVyYXRvcl0oKTsKCiAgICAgICAgICAgICAgY2FzZSAxNDoKICAgICAgICAgICAgICAgIGlmIChfaXRlcmF0b3JOb3JtYWxDb21wbGV0aW9uMiA9IChfc3RlcDIgPSBfaXRlcmF0b3IyLm5leHQoKSkuZG9uZSkgewogICAgICAgICAgICAgICAgICBfY29udGV4dDYubmV4dCA9IDQ5OwogICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBpdGVtID0gX3N0ZXAyLnZhbHVlOwogICAgICAgICAgICAgICAgX2NvbnRleHQ2LnByZXYgPSAxNjsKCiAgICAgICAgICAgICAgICBpZiAoIU9iamVjdC5pcyhpdGVtLnJvd0RhdGFTdGF0ZSwgJ2NyZWF0ZScpKSB7CiAgICAgICAgICAgICAgICAgIF9jb250ZXh0Ni5uZXh0ID0gMjk7CiAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIGlmICh0aGlzLmNyZWF0ZUFjdGlvbikgewogICAgICAgICAgICAgICAgICBfY29udGV4dDYubmV4dCA9IDIyOwogICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICB0aGlzLiROb3RpY2UuZXJyb3IoewogICAgICAgICAgICAgICAgICB0aXRsZTogJ+mUmeivrycsCiAgICAgICAgICAgICAgICAgIGRlc2M6ICdQSU1QRVJTT05HWlJZSE1DR3JpZFZpZXfop4blm77ooajmoLxjcmVhdGVBY3Rpb27lj4LmlbDmnKrphY3nva4nCiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIF9jb250ZXh0Ni5uZXh0ID0gMjc7CiAgICAgICAgICAgICAgICBicmVhazsKCiAgICAgICAgICAgICAgY2FzZSAyMjoKICAgICAgICAgICAgICAgIE9iamVjdC5hc3NpZ24oaXRlbSwgewogICAgICAgICAgICAgICAgICB2aWV3cGFyYW1zOiB0aGlzLnZpZXdwYXJhbXMKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgX2NvbnRleHQ2Lm5leHQgPSAyNTsKICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLnNlcnZpY2UuYWRkKHRoaXMuY3JlYXRlQWN0aW9uLCBKU09OLnBhcnNlKEpTT04uc3RyaW5naWZ5KHRoaXMuY29udGV4dCkpLCBpdGVtLCB0aGlzLnNob3dCdXN5SW5kaWNhdG9yKTsKCiAgICAgICAgICAgICAgY2FzZSAyNToKICAgICAgICAgICAgICAgIHJlc3BvbnNlID0gX2NvbnRleHQ2LnNlbnQ7CiAgICAgICAgICAgICAgICBzdWNjZXNzSXRlbXMucHVzaChKU09OLnBhcnNlKEpTT04uc3RyaW5naWZ5KHJlc3BvbnNlLmRhdGEpKSk7CgogICAgICAgICAgICAgIGNhc2UgMjc6CiAgICAgICAgICAgICAgICBfY29udGV4dDYubmV4dCA9IDQwOwogICAgICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgICAgIGNhc2UgMjk6CiAgICAgICAgICAgICAgICBpZiAoIU9iamVjdC5pcyhpdGVtLnJvd0RhdGFTdGF0ZSwgJ3VwZGF0ZScpKSB7CiAgICAgICAgICAgICAgICAgIF9jb250ZXh0Ni5uZXh0ID0gNDA7CiAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIGlmICh0aGlzLnVwZGF0ZUFjdGlvbikgewogICAgICAgICAgICAgICAgICBfY29udGV4dDYubmV4dCA9IDM0OwogICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICB0aGlzLiROb3RpY2UuZXJyb3IoewogICAgICAgICAgICAgICAgICB0aXRsZTogJ+mUmeivrycsCiAgICAgICAgICAgICAgICAgIGRlc2M6ICdQSU1QRVJTT05HWlJZSE1DR3JpZFZpZXfop4blm77ooajmoLx1cGRhdGVBY3Rpb27lj4LmlbDmnKrphY3nva4nCiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIF9jb250ZXh0Ni5uZXh0ID0gNDA7CiAgICAgICAgICAgICAgICBicmVhazsKCiAgICAgICAgICAgICAgY2FzZSAzNDoKICAgICAgICAgICAgICAgIE9iamVjdC5hc3NpZ24oaXRlbSwgewogICAgICAgICAgICAgICAgICB2aWV3cGFyYW1zOiB0aGlzLnZpZXdwYXJhbXMKICAgICAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgICAgIGlmIChpdGVtLnBpbXBlcnNvbikgewogICAgICAgICAgICAgICAgICBPYmplY3QuYXNzaWduKHRoaXMuY29udGV4dCwgewogICAgICAgICAgICAgICAgICAgIHBpbXBlcnNvbjogaXRlbS5waW1wZXJzb24KICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgX2NvbnRleHQ2Lm5leHQgPSAzODsKICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLnNlcnZpY2UuYWRkKHRoaXMudXBkYXRlQWN0aW9uLCBKU09OLnBhcnNlKEpTT04uc3RyaW5naWZ5KHRoaXMuY29udGV4dCkpLCBpdGVtLCB0aGlzLnNob3dCdXN5SW5kaWNhdG9yKTsKCiAgICAgICAgICAgICAgY2FzZSAzODoKICAgICAgICAgICAgICAgIF9yZXNwb25zZSA9IF9jb250ZXh0Ni5zZW50OwogICAgICAgICAgICAgICAgc3VjY2Vzc0l0ZW1zLnB1c2goSlNPTi5wYXJzZShKU09OLnN0cmluZ2lmeShfcmVzcG9uc2UuZGF0YSkpKTsKCiAgICAgICAgICAgICAgY2FzZSA0MDoKICAgICAgICAgICAgICAgIF9jb250ZXh0Ni5uZXh0ID0gNDY7CiAgICAgICAgICAgICAgICBicmVhazsKCiAgICAgICAgICAgICAgY2FzZSA0MjoKICAgICAgICAgICAgICAgIF9jb250ZXh0Ni5wcmV2ID0gNDI7CiAgICAgICAgICAgICAgICBfY29udGV4dDYudDAgPSBfY29udGV4dDZbImNhdGNoIl0oMTYpOwogICAgICAgICAgICAgICAgZXJyb3JJdGVtcy5wdXNoKEpTT04ucGFyc2UoSlNPTi5zdHJpbmdpZnkoaXRlbSkpKTsKICAgICAgICAgICAgICAgIGVycm9yTWVzc2FnZS5wdXNoKF9jb250ZXh0Ni50MCk7CgogICAgICAgICAgICAgIGNhc2UgNDY6CiAgICAgICAgICAgICAgICBfaXRlcmF0b3JOb3JtYWxDb21wbGV0aW9uMiA9IHRydWU7CiAgICAgICAgICAgICAgICBfY29udGV4dDYubmV4dCA9IDE0OwogICAgICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgICAgIGNhc2UgNDk6CiAgICAgICAgICAgICAgICBfY29udGV4dDYubmV4dCA9IDU1OwogICAgICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgICAgIGNhc2UgNTE6CiAgICAgICAgICAgICAgICBfY29udGV4dDYucHJldiA9IDUxOwogICAgICAgICAgICAgICAgX2NvbnRleHQ2LnQxID0gX2NvbnRleHQ2WyJjYXRjaCJdKDEyKTsKICAgICAgICAgICAgICAgIF9kaWRJdGVyYXRvckVycm9yMiA9IHRydWU7CiAgICAgICAgICAgICAgICBfaXRlcmF0b3JFcnJvcjIgPSBfY29udGV4dDYudDE7CgogICAgICAgICAgICAgIGNhc2UgNTU6CiAgICAgICAgICAgICAgICBfY29udGV4dDYucHJldiA9IDU1OwogICAgICAgICAgICAgICAgX2NvbnRleHQ2LnByZXYgPSA1NjsKCiAgICAgICAgICAgICAgICBpZiAoIV9pdGVyYXRvck5vcm1hbENvbXBsZXRpb24yICYmIF9pdGVyYXRvcjJbInJldHVybiJdICE9IG51bGwpIHsKICAgICAgICAgICAgICAgICAgX2l0ZXJhdG9yMlsicmV0dXJuIl0oKTsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgY2FzZSA1ODoKICAgICAgICAgICAgICAgIF9jb250ZXh0Ni5wcmV2ID0gNTg7CgogICAgICAgICAgICAgICAgaWYgKCFfZGlkSXRlcmF0b3JFcnJvcjIpIHsKICAgICAgICAgICAgICAgICAgX2NvbnRleHQ2Lm5leHQgPSA2MTsKICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgdGhyb3cgX2l0ZXJhdG9yRXJyb3IyOwoKICAgICAgICAgICAgICBjYXNlIDYxOgogICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0Ni5maW5pc2goNTgpOwoKICAgICAgICAgICAgICBjYXNlIDYyOgogICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0Ni5maW5pc2goNTUpOwoKICAgICAgICAgICAgICBjYXNlIDYzOgogICAgICAgICAgICAgICAgdGhpcy4kZW1pdCgnc2F2ZScsIHN1Y2Nlc3NJdGVtcyk7CiAgICAgICAgICAgICAgICB0aGlzLnJlZnJlc2goW10pOwoKICAgICAgICAgICAgICAgIGlmIChlcnJvckl0ZW1zLmxlbmd0aCA9PT0gMCkgewogICAgICAgICAgICAgICAgICB0aGlzLiROb3RpY2Uuc3VjY2Vzcyh7CiAgICAgICAgICAgICAgICAgICAgdGl0bGU6ICcnLAogICAgICAgICAgICAgICAgICAgIGRlc2M6ICfkv53lrZjmiJDlip8hJwogICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgIGVycm9ySXRlbXMuZm9yRWFjaChmdW5jdGlvbiAoaXRlbSwgaW5kZXgpIHsKICAgICAgICAgICAgICAgICAgICBfdGhpczEyLiROb3RpY2UuZXJyb3IoewogICAgICAgICAgICAgICAgICAgICAgdGl0bGU6ICfkv53lrZjlpLHotKUnLAogICAgICAgICAgICAgICAgICAgICAgZGVzYzogaXRlbS5tYWpvcmVudGl0eW5hbWUgKyAn5L+d5a2Y5aSx6LSl77yBJwogICAgICAgICAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmVycm9yKGVycm9yTWVzc2FnZVtpbmRleF0pOwogICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQ2LmFicnVwdCgicmV0dXJuIiwgc3VjY2Vzc0l0ZW1zKTsKCiAgICAgICAgICAgICAgY2FzZSA2NzoKICAgICAgICAgICAgICBjYXNlICJlbmQiOgogICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0Ni5zdG9wKCk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9LCBfY2FsbGVlNSwgdGhpcywgW1sxMiwgNTEsIDU1LCA2M10sIFsxNiwgNDJdLCBbNTYsLCA1OCwgNjJdXSk7CiAgICAgIH0pKTsKCiAgICAgIGZ1bmN0aW9uIHNhdmUoX3g1LCBfeDYsIF94NywgX3g4KSB7CiAgICAgICAgcmV0dXJuIF9zYXZlLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7CiAgICAgIH0KCiAgICAgIHJldHVybiBzYXZlOwogICAgfSgpCiAgICAvKioNCiAgICAgKiDmlrDlu7rooYwNCiAgICAgKg0KICAgICAqIEBwYXJhbSB7Kn0gJGV2ZW50DQogICAgICogQHJldHVybnMge3ZvaWR9DQogICAgICogQG1lbWJlcm9mIEdaRFFCYXNlDQogICAgICovCgogIH0sIHsKICAgIGtleTogIm5ld1JvdyIsCiAgICB2YWx1ZTogZnVuY3Rpb24gbmV3Um93KGFyZ3MsIHBhcmFtcywgJGV2ZW50LCB4RGF0YSkgewogICAgICB2YXIgX3RoaXMxMyA9IHRoaXM7CgogICAgICBpZiAoIXRoaXMubG9hZGRyYWZ0QWN0aW9uKSB7CiAgICAgICAgdGhpcy4kTm90aWNlLmVycm9yKHsKICAgICAgICAgIHRpdGxlOiAn6ZSZ6K+vJywKICAgICAgICAgIGRlc2M6ICdQSU1QRVJTT05HWlJZSE1DR3JpZFZpZXfop4blm77ooajmoLxsb2FkZHJhZnRBY3Rpb27lj4LmlbDmnKrphY3nva4nCiAgICAgICAgfSk7CiAgICAgICAgcmV0dXJuOwogICAgICB9CgogICAgICB2YXIgX3RoaXMgPSB0aGlzOwoKICAgICAgT2JqZWN0LmFzc2lnbihhcmdzWzBdLCB7CiAgICAgICAgdmlld3BhcmFtczogdGhpcy52aWV3cGFyYW1zCiAgICAgIH0pOwogICAgICB2YXIgcG9zdCA9IHRoaXMuc2VydmljZS5sb2FkRHJhZnQodGhpcy5sb2FkZHJhZnRBY3Rpb24sIEpTT04ucGFyc2UoSlNPTi5zdHJpbmdpZnkodGhpcy5jb250ZXh0KSksIGFyZ3NbMF0sIHRoaXMuc2hvd0J1c3lJbmRpY2F0b3IpOwogICAgICBwb3N0LnRoZW4oZnVuY3Rpb24gKHJlc3BvbnNlKSB7CiAgICAgICAgaWYgKCFyZXNwb25zZS5zdGF0dXMgfHwgcmVzcG9uc2Uuc3RhdHVzICE9PSAyMDApIHsKICAgICAgICAgIGlmIChyZXNwb25zZS5lcnJvck1lc3NhZ2UpIHsKICAgICAgICAgICAgX3RoaXMxMy4kTm90aWNlLmVycm9yKHsKICAgICAgICAgICAgICB0aXRsZTogJ+mUmeivrycsCiAgICAgICAgICAgICAgZGVzYzogcmVzcG9uc2UuZXJyb3JNZXNzYWdlCiAgICAgICAgICAgIH0pOwogICAgICAgICAgfQoKICAgICAgICAgIHJldHVybjsKICAgICAgICB9CgogICAgICAgIHZhciBkYXRhID0gcmVzcG9uc2UuZGF0YTsKCiAgICAgICAgX3RoaXMxMy5jcmVhdGVEZWZhdWx0KGRhdGEpOwoKICAgICAgICBkYXRhLnJvd0RhdGFTdGF0ZSA9ICJjcmVhdGUiOwoKICAgICAgICBfdGhpcy5pdGVtcy5wdXNoKGRhdGEpOwoKICAgICAgICBfdGhpcy5ncmlkSXRlbXNNb2RlbC5wdXNoKF90aGlzLmdldEdyaWRSb3dNb2RlbCgpKTsKICAgICAgfSlbImNhdGNoIl0oZnVuY3Rpb24gKHJlc3BvbnNlKSB7CiAgICAgICAgaWYgKHJlc3BvbnNlICYmIHJlc3BvbnNlLnN0YXR1cyA9PT0gNDAxKSB7CiAgICAgICAgICByZXR1cm47CiAgICAgICAgfQoKICAgICAgICBpZiAoIXJlc3BvbnNlIHx8ICFyZXNwb25zZS5zdGF0dXMgfHwgIXJlc3BvbnNlLmRhdGEpIHsKICAgICAgICAgIF90aGlzMTMuJE5vdGljZS5lcnJvcih7CiAgICAgICAgICAgIHRpdGxlOiAn6ZSZ6K+vJywKICAgICAgICAgICAgZGVzYzogJ+ezu+e7n+W8guW4uCcKICAgICAgICAgIH0pOwoKICAgICAgICAgIHJldHVybjsKICAgICAgICB9CiAgICAgIH0pOwogICAgfQogICAgLyoqDQogICAgICog6KGo5qC857yW6L6R6aG55YC85Y+Y5pu0DQogICAgICoNCiAgICAgKiBAcGFyYW0gcm93IOihjOaVsOaNrg0KICAgICAqIEBwYXJhbSB7eyBuYW1lOiBzdHJpbmcsIHZhbHVlOiBhbnkgfX0gJGV2ZW50DQogICAgICogQHJldHVybnMge3ZvaWR9DQogICAgICogQG1lbWJlcm9mIEdaRFFCYXNlDQogICAgICovCgogIH0sIHsKICAgIGtleTogIm9uR3JpZEl0ZW1WYWx1ZUNoYW5nZSIsCiAgICB2YWx1ZTogZnVuY3Rpb24gb25HcmlkSXRlbVZhbHVlQ2hhbmdlKHJvdywgJGV2ZW50LCByb3dJbmRleCkgewogICAgICBpZiAoISRldmVudCkgewogICAgICAgIHJldHVybjsKICAgICAgfQoKICAgICAgaWYgKCEkZXZlbnQubmFtZSB8fCBPYmplY3QuaXMoJGV2ZW50Lm5hbWUsICcnKSB8fCAhcm93Lmhhc093blByb3BlcnR5KCRldmVudC5uYW1lKSkgewogICAgICAgIHJldHVybjsKICAgICAgfQoKICAgICAgcm93WyRldmVudC5uYW1lXSA9ICRldmVudC52YWx1ZTsKICAgICAgdGhpcy5ncmlkRWRpdEl0ZW1DaGFuZ2Uocm93LCAkZXZlbnQubmFtZSwgJGV2ZW50LnZhbHVlLCByb3dJbmRleCk7CiAgICB9CiAgICAvKioNCiAgICAgKiDooajmoLznvJbovpHpobnlgLzlj5jljJYNCiAgICAgKg0KICAgICAqIEBwdWJsaWMNCiAgICAgKiBAcGFyYW0gcm93IOihjOaVsOaNrg0KICAgICAqIEBwYXJhbSBwcm9wZXJ0eSDliJfnvJbovpHpobnlkI0NCiAgICAgKiBAcGFyYW0gcm93IOWIl+e8lui+kemhueWAvA0KICAgICAqIEByZXR1cm5zIHt2b2lkfQ0KICAgICAqIEBtZW1iZXJvZiBHWkRRQmFzZQ0KICAgICAqLwoKICB9LCB7CiAgICBrZXk6ICJncmlkRWRpdEl0ZW1DaGFuZ2UiLAogICAgdmFsdWU6IGZ1bmN0aW9uIGdyaWRFZGl0SXRlbUNoYW5nZShyb3csIHByb3BlcnR5LCB2YWx1ZSwgcm93SW5kZXgpIHsKICAgICAgcm93LnJvd0RhdGFTdGF0ZSA9IHJvdy5yb3dEYXRhU3RhdGUgPyByb3cucm93RGF0YVN0YXRlIDogInVwZGF0ZSI7CiAgICAgIHRoaXMudmFsaWRhdGUocHJvcGVydHksIHJvdywgcm93SW5kZXgpOwogICAgfQogICAgLyoqDQogICAgICog6KGo5qC857yW6L6R6aG55pu05pawDQogICAgICoNCiAgICAgKiBAcGFyYW0ge3N0cmluZ30gbW9kZSDnlYzpnaLooYzkuLrlkI3np7ANCiAgICAgKiBAcGFyYW0geyp9IFtkYXRhPXt9XSDor7fmsYLmlbDmja4NCiAgICAgKiBAcGFyYW0ge3N0cmluZ1tdfSB1cGRhdGVEZXRhaWxzIOabtOaWsOmhuQ0KICAgICAqIEBwYXJhbSB7Ym9vbGVhbn0gW3Nob3dsb2FkaW5nXSDmmK/lkKbmmL7npLrliqDovb3nirbmgIENCiAgICAgKiBAcmV0dXJucyB7dm9pZH0NCiAgICAgKiBAbWVtYmVyb2YgR1pEUUJhc2UNCiAgICAgKi8KCiAgfSwgewogICAga2V5OiAidXBkYXRlR3JpZEVkaXRJdGVtIiwKICAgIHZhbHVlOiBmdW5jdGlvbiB1cGRhdGVHcmlkRWRpdEl0ZW0obW9kZSkgewogICAgICB2YXIgX3RoaXMxNCA9IHRoaXM7CgogICAgICB2YXIgZGF0YSA9IGFyZ3VtZW50cy5sZW5ndGggPiAxICYmIGFyZ3VtZW50c1sxXSAhPT0gdW5kZWZpbmVkID8gYXJndW1lbnRzWzFdIDoge307CiAgICAgIHZhciB1cGRhdGVEZXRhaWxzID0gYXJndW1lbnRzLmxlbmd0aCA+IDIgPyBhcmd1bWVudHNbMl0gOiB1bmRlZmluZWQ7CiAgICAgIHZhciBzaG93bG9hZGluZyA9IGFyZ3VtZW50cy5sZW5ndGggPiAzID8gYXJndW1lbnRzWzNdIDogdW5kZWZpbmVkOwoKICAgICAgaWYgKCFtb2RlIHx8IG1vZGUgJiYgT2JqZWN0LmlzKG1vZGUsICcnKSkgewogICAgICAgIHJldHVybjsKICAgICAgfQoKICAgICAgdmFyIGFyZyA9IEpTT04ucGFyc2UoSlNPTi5zdHJpbmdpZnkoZGF0YSkpOwogICAgICBPYmplY3QuYXNzaWduKGFyZywgewogICAgICAgIHZpZXdwYXJhbXM6IHRoaXMudmlld3BhcmFtcwogICAgICB9KTsKICAgICAgdmFyIHBvc3QgPSB0aGlzLnNlcnZpY2UuZnJvbnRMb2dpYyhtb2RlLCBKU09OLnBhcnNlKEpTT04uc3RyaW5naWZ5KHRoaXMuY29udGV4dCkpLCBhcmcsIHNob3dsb2FkaW5nKTsKICAgICAgcG9zdC50aGVuKGZ1bmN0aW9uIChyZXNwb25zZSkgewogICAgICAgIGlmICghcmVzcG9uc2UgfHwgcmVzcG9uc2Uuc3RhdHVzICE9PSAyMDApIHsKICAgICAgICAgIF90aGlzMTQuJE5vdGljZS5lcnJvcih7CiAgICAgICAgICAgIHRpdGxlOiAn6ZSZ6K+vJywKICAgICAgICAgICAgZGVzYzogJ+ihqOWNlemhueabtOaWsOWksei0pScKICAgICAgICAgIH0pOwoKICAgICAgICAgIHJldHVybjsKICAgICAgICB9CgogICAgICAgIHZhciBfZGF0YSA9IHJlc3BvbnNlLmRhdGE7CgogICAgICAgIGlmICghX2RhdGEpIHsKICAgICAgICAgIHJldHVybjsKICAgICAgICB9CgogICAgICAgIHVwZGF0ZURldGFpbHMuZm9yRWFjaChmdW5jdGlvbiAobmFtZSkgewogICAgICAgICAgaWYgKCFfZGF0YS5oYXNPd25Qcm9wZXJ0eShuYW1lKSkgewogICAgICAgICAgICByZXR1cm47CiAgICAgICAgICB9CgogICAgICAgICAgZGF0YVtuYW1lXSA9IF9kYXRhW25hbWVdOwogICAgICAgIH0pOwogICAgICB9KVsiY2F0Y2giXShmdW5jdGlvbiAocmVzcG9uc2UpIHsKICAgICAgICBpZiAocmVzcG9uc2UgJiYgcmVzcG9uc2Uuc3RhdHVzID09PSA0MDEpIHsKICAgICAgICAgIHJldHVybjsKICAgICAgICB9CgogICAgICAgIGlmICghcmVzcG9uc2UgfHwgIXJlc3BvbnNlLnN0YXR1cyB8fCAhcmVzcG9uc2UuZGF0YSkgewogICAgICAgICAgX3RoaXMxNC4kTm90aWNlLmVycm9yKHsKICAgICAgICAgICAgdGl0bGU6ICfplJnor68nLAogICAgICAgICAgICBkZXNjOiAn57O757uf5byC5bi4JwogICAgICAgICAgfSk7CgogICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KICAgICAgfSk7CiAgICB9CiAgICAvKioNCiAgICAgKiDojrflj5blr7nlupTooYxjbGFzcw0KICAgICAqDQogICAgICogQHBhcmFtIHsqfSAkYXJncyByb3cg6KGM5pWw5o2u77yMcm93SW5kZXgg6KGM57Si5byVDQogICAgICogQHJldHVybnMge3ZvaWR9DQogICAgICogQG1lbWJlcm9mIEdaRFFCYXNlDQogICAgICovCgogIH0sIHsKICAgIGtleTogImdldFJvd0NsYXNzTmFtZSIsCiAgICB2YWx1ZTogZnVuY3Rpb24gZ2V0Um93Q2xhc3NOYW1lKGFyZ3MpIHsKICAgICAgdmFyIGlzU2VsZWN0ZWQgPSB0aGlzLnNlbGVjdGlvbnMuc29tZShmdW5jdGlvbiAoaXRlbSkgewogICAgICAgIHJldHVybiBPYmplY3QuaXMoaXRlbS5waW1wZXJzb24sIGFyZ3Mucm93LnBpbXBlcnNvbik7CiAgICAgIH0pOwogICAgICByZXR1cm4gaXNTZWxlY3RlZCA/ICJncmlkLXNlbGVjdGVkLXJvdyIgOiAiIjsKICAgIH0KICAgIC8qKg0KICAgICAqIOiOt+WPluWvueW6lOWIl2NsYXNzDQogICAgICoNCiAgICAgKiBAcGFyYW0geyp9ICRhcmdzIHJvdyDooYzmlbDmja7vvIxjb2x1bW4g5YiX5pWw5o2u77yMcm93SW5kZXgg6KGM57Si5byV77yM5YiX57Si5byVDQogICAgICogQHJldHVybnMge3ZvaWR9DQogICAgICogQG1lbWJlcm9mIEdaRFFCYXNlDQogICAgICovCgogIH0sIHsKICAgIGtleTogImdldENlbGxDbGFzc05hbWUiLAogICAgdmFsdWU6IGZ1bmN0aW9uIGdldENlbGxDbGFzc05hbWUoYXJncykgewogICAgICB2YXIgaGFzUm93RWRpdCA9IHsKICAgICAgICAneWdiaCc6IGZhbHNlLAogICAgICAgICdwaW1wZXJzb25uYW1lJzogZmFsc2UsCiAgICAgICAgJ3lnenQnOiBmYWxzZSwKICAgICAgICAnZ3p6dCc6IGZhbHNlLAogICAgICAgICdnenp6JzogZmFsc2UsCiAgICAgICAgJ2d6Ym0nOiBmYWxzZSwKICAgICAgICAnZ3prc3NqJzogZmFsc2UsCiAgICAgICAgJ2d6anNzaic6IGZhbHNlCiAgICAgIH07CiAgICAgIHJldHVybiBoYXNSb3dFZGl0W2FyZ3MuY29sdW1uLnByb3BlcnR5XSAmJiB0aGlzLmFjdHVhbElzT3BlbkVkaXQgPyAiZWRpdC1jZWxsIiA6ICJpbmZvLWNlbGwiOwogICAgfQogICAgLyoqDQogICAgICog5paw5bu66buY6K6k5YC8DQogICAgICogQHBhcmFtIHsqfSAgcm93IOihjOaVsOaNrg0KICAgICAqIEBtZW1iZXJvZiBHWkRRQmFzZQ0KICAgICAqLwoKICB9LCB7CiAgICBrZXk6ICJjcmVhdGVEZWZhdWx0IiwKICAgIHZhbHVlOiBmdW5jdGlvbiBjcmVhdGVEZWZhdWx0KHJvdykge30KICB9LCB7CiAgICBrZXk6ICJhZGFwdGl2ZVN0YXRlIiwKICAgIGdldDogZnVuY3Rpb24gZ2V0KCkgewogICAgICByZXR1cm4gIXRoaXMuYWxsQ29sdW1ucy5maW5kKGZ1bmN0aW9uIChjb2x1bW4pIHsKICAgICAgICByZXR1cm4gY29sdW1uLnNob3cgJiYgT2JqZWN0LmlzKGNvbHVtbi51dGlsLCAnU1RBUicpOwogICAgICB9KTsKICAgIH0KICB9XSk7CgogIHJldHVybiBHWkRRQmFzZTsKfShWdWUpOwoKdHNsaWJfMS5fX2RlY29yYXRlKFtQcm9wKCldLCBHWkRRQmFzZS5wcm90b3R5cGUsICJuYW1lIiwgdm9pZCAwKTsKCnRzbGliXzEuX19kZWNvcmF0ZShbUHJvcCgpXSwgR1pEUUJhc2UucHJvdG90eXBlLCAidmlld1N0YXRlIiwgdm9pZCAwKTsKCnRzbGliXzEuX19kZWNvcmF0ZShbUHJvcCgpXSwgR1pEUUJhc2UucHJvdG90eXBlLCAiY29udGV4dCIsIHZvaWQgMCk7Cgp0c2xpYl8xLl9fZGVjb3JhdGUoW1Byb3AoKV0sIEdaRFFCYXNlLnByb3RvdHlwZSwgInZpZXdwYXJhbXMiLCB2b2lkIDApOwoKdHNsaWJfMS5fX2RlY29yYXRlKFtQcm9wKCldLCBHWkRRQmFzZS5wcm90b3R5cGUsICJuZXdkYXRhIiwgdm9pZCAwKTsKCnRzbGliXzEuX19kZWNvcmF0ZShbUHJvcCgpXSwgR1pEUUJhc2UucHJvdG90eXBlLCAib3BlbmRhdGEiLCB2b2lkIDApOwoKdHNsaWJfMS5fX2RlY29yYXRlKFtQcm9wKHsKICAiZGVmYXVsdCI6IHRydWUKfSldLCBHWkRRQmFzZS5wcm90b3R5cGUsICJzaG93QnVzeUluZGljYXRvciIsIHZvaWQgMCk7Cgp0c2xpYl8xLl9fZGVjb3JhdGUoW1Byb3AoKV0sIEdaRFFCYXNlLnByb3RvdHlwZSwgInVwZGF0ZUFjdGlvbiIsIHZvaWQgMCk7Cgp0c2xpYl8xLl9fZGVjb3JhdGUoW1Byb3AoKV0sIEdaRFFCYXNlLnByb3RvdHlwZSwgImZldGNoQWN0aW9uIiwgdm9pZCAwKTsKCnRzbGliXzEuX19kZWNvcmF0ZShbUHJvcCgpXSwgR1pEUUJhc2UucHJvdG90eXBlLCAicmVtb3ZlQWN0aW9uIiwgdm9pZCAwKTsKCnRzbGliXzEuX19kZWNvcmF0ZShbUHJvcCgpXSwgR1pEUUJhc2UucHJvdG90eXBlLCAibG9hZEFjdGlvbiIsIHZvaWQgMCk7Cgp0c2xpYl8xLl9fZGVjb3JhdGUoW1Byb3AoKV0sIEdaRFFCYXNlLnByb3RvdHlwZSwgImxvYWRkcmFmdEFjdGlvbiIsIHZvaWQgMCk7Cgp0c2xpYl8xLl9fZGVjb3JhdGUoW1Byb3AoKV0sIEdaRFFCYXNlLnByb3RvdHlwZSwgImNyZWF0ZUFjdGlvbiIsIHZvaWQgMCk7Cgp0c2xpYl8xLl9fZGVjb3JhdGUoW1Byb3AoewogICJkZWZhdWx0IjogZmFsc2UKfSldLCBHWkRRQmFzZS5wcm90b3R5cGUsICJpc1NlbGVjdEZpcnN0RGVmYXVsdCIsIHZvaWQgMCk7Cgp0c2xpYl8xLl9fZGVjb3JhdGUoW1Byb3AoKV0sIEdaRFFCYXNlLnByb3RvdHlwZSwgImlzU2luZ2xlU2VsZWN0Iiwgdm9pZCAwKTsKCnRzbGliXzEuX19kZWNvcmF0ZShbUHJvcCgpXSwgR1pEUUJhc2UucHJvdG90eXBlLCAic2VsZWN0ZWREYXRhIiwgdm9pZCAwKTsKCnRzbGliXzEuX19kZWNvcmF0ZShbV2F0Y2goJ3NlbGVjdGVkRGF0YScpXSwgR1pEUUJhc2UucHJvdG90eXBlLCAib25WYWx1ZUNoYW5nZSIsIG51bGwpOwoKdHNsaWJfMS5fX2RlY29yYXRlKFtQcm9wKHsKICAiZGVmYXVsdCI6IDIKfSldLCBHWkRRQmFzZS5wcm90b3R5cGUsICJncmlkUm93QWN0aXZlTW9kZSIsIHZvaWQgMCk7Cgp0c2xpYl8xLl9fZGVjb3JhdGUoW1Byb3AoewogICJkZWZhdWx0IjogZmFsc2UKfSldLCBHWkRRQmFzZS5wcm90b3R5cGUsICJpc09wZW5FZGl0Iiwgdm9pZCAwKTsKCkdaRFFCYXNlID0gdHNsaWJfMS5fX2RlY29yYXRlKFtDb21wb25lbnQoewogIGNvbXBvbmVudHM6IHt9Cn0pXSwgR1pEUUJhc2UpOwpleHBvcnQgZGVmYXVsdCBHWkRRQmFzZTs="},null]}
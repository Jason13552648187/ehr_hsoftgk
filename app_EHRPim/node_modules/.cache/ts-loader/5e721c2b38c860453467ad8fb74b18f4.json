{"remainingRequest":"F:\\crod项目\\人事管理系统2\\iBizEHR\\app_EHRPim\\node_modules\\thread-loader\\dist\\cjs.js!F:\\crod项目\\人事管理系统2\\iBizEHR\\app_EHRPim\\node_modules\\babel-loader\\lib\\index.js!F:\\crod项目\\人事管理系统2\\iBizEHR\\app_EHRPim\\node_modules\\ts-loader\\index.js??ref--14-3!F:\\crod项目\\人事管理系统2\\iBizEHR\\app_EHRPim\\node_modules\\cache-loader\\dist\\cjs.js??ref--0-0!F:\\crod项目\\人事管理系统2\\iBizEHR\\app_EHRPim\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!F:\\crod项目\\人事管理系统2\\iBizEHR\\app_EHRPim\\src\\widgets\\pim-title\\org-title-bar-chart\\org-title-bar-chart-base.vue?vue&type=script&lang=tsx&","dependencies":[{"path":"F:\\crod项目\\人事管理系统2\\iBizEHR\\app_EHRPim\\src\\widgets\\pim-title\\org-title-bar-chart\\org-title-bar-chart-base.vue","mtime":1630509413677},{"path":"F:\\crod项目\\人事管理系统2\\iBizEHR\\app_EHRPim\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1630511852775},{"path":"F:\\crod项目\\人事管理系统2\\iBizEHR\\app_EHRPim\\node_modules\\thread-loader\\dist\\cjs.js","mtime":1630511853252},{"path":"F:\\crod项目\\人事管理系统2\\iBizEHR\\app_EHRPim\\node_modules\\babel-loader\\lib\\index.js","mtime":1630511852747},{"path":"F:\\crod项目\\人事管理系统2\\iBizEHR\\app_EHRPim\\node_modules\\ts-loader\\index.js","mtime":1630511985412},{"path":"F:\\crod项目\\人事管理系统2\\iBizEHR\\app_EHRPim\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1630511852775},{"path":"F:\\crod项目\\人事管理系统2\\iBizEHR\\app_EHRPim\\node_modules\\vue-loader\\lib\\index.js","mtime":1630512070338}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:aW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuc3ltYm9sIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkuZmlsdGVyIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkuZmluZCI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLmFycmF5LmZpbmQtaW5kZXgiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5hcnJheS5mb3ItZWFjaCI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLmFycmF5LmlzLWFycmF5IjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkubWFwIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkuc29ydCI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLmFycmF5LnNwbGljZSI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLmRhdGUudG8tc3RyaW5nIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuZnVuY3Rpb24ubmFtZSI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLm1hcCI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLm51bWJlci5jb25zdHJ1Y3RvciI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLm9iamVjdC5kZWZpbmUtcHJvcGVydGllcyI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLm9iamVjdC5kZWZpbmUtcHJvcGVydHkiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5vYmplY3QuZ2V0LW93bi1wcm9wZXJ0eS1kZXNjcmlwdG9yIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMub2JqZWN0LmdldC1vd24tcHJvcGVydHktZGVzY3JpcHRvcnMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5vYmplY3QuaXMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5vYmplY3Qua2V5cyI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLm9iamVjdC50by1zdHJpbmciOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5vYmplY3QudmFsdWVzIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMucmVnZXhwLmV4ZWMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5yZWdleHAudG8tc3RyaW5nIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuc3RyaW5nLml0ZXJhdG9yIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuc3RyaW5nLnNlYXJjaCI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLnN0cmluZy5zcGxpdCI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL3dlYi5kb20tY29sbGVjdGlvbnMuZm9yLWVhY2giOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy93ZWIuZG9tLWNvbGxlY3Rpb25zLml0ZXJhdG9yIjsKaW1wb3J0IF90b0NvbnN1bWFibGVBcnJheSBmcm9tICJGOlxcY3JvZFx1OTg3OVx1NzZFRVxcXHU0RUJBXHU0RThCXHU3QkExXHU3NDA2XHU3Q0ZCXHU3RURGMlxcaUJpekVIUlxcYXBwX0VIUlBpbVxcbm9kZV9tb2R1bGVzXFxAYmFiZWxcXHJ1bnRpbWUvaGVscGVycy9lc20vdG9Db25zdW1hYmxlQXJyYXkiOwppbXBvcnQgInJlZ2VuZXJhdG9yLXJ1bnRpbWUvcnVudGltZSI7CmltcG9ydCBfYXN5bmNUb0dlbmVyYXRvciBmcm9tICJGOlxcY3JvZFx1OTg3OVx1NzZFRVxcXHU0RUJBXHU0RThCXHU3QkExXHU3NDA2XHU3Q0ZCXHU3RURGMlxcaUJpekVIUlxcYXBwX0VIUlBpbVxcbm9kZV9tb2R1bGVzXFxAYmFiZWxcXHJ1bnRpbWUvaGVscGVycy9lc20vYXN5bmNUb0dlbmVyYXRvciI7CmltcG9ydCBfZGVmaW5lUHJvcGVydHkgZnJvbSAiRjpcXGNyb2RcdTk4NzlcdTc2RUVcXFx1NEVCQVx1NEU4Qlx1N0JBMVx1NzQwNlx1N0NGQlx1N0VERjJcXGlCaXpFSFJcXGFwcF9FSFJQaW1cXG5vZGVfbW9kdWxlc1xcQGJhYmVsXFxydW50aW1lL2hlbHBlcnMvZXNtL2RlZmluZVByb3BlcnR5IjsKaW1wb3J0IF9jbGFzc0NhbGxDaGVjayBmcm9tICJGOlxcY3JvZFx1OTg3OVx1NzZFRVxcXHU0RUJBXHU0RThCXHU3QkExXHU3NDA2XHU3Q0ZCXHU3RURGMlxcaUJpekVIUlxcYXBwX0VIUlBpbVxcbm9kZV9tb2R1bGVzXFxAYmFiZWxcXHJ1bnRpbWUvaGVscGVycy9lc20vY2xhc3NDYWxsQ2hlY2siOwppbXBvcnQgX2NyZWF0ZUNsYXNzIGZyb20gIkY6XFxjcm9kXHU5ODc5XHU3NkVFXFxcdTRFQkFcdTRFOEJcdTdCQTFcdTc0MDZcdTdDRkJcdTdFREYyXFxpQml6RUhSXFxhcHBfRUhSUGltXFxub2RlX21vZHVsZXNcXEBiYWJlbFxccnVudGltZS9oZWxwZXJzL2VzbS9jcmVhdGVDbGFzcyI7CmltcG9ydCBfcG9zc2libGVDb25zdHJ1Y3RvclJldHVybiBmcm9tICJGOlxcY3JvZFx1OTg3OVx1NzZFRVxcXHU0RUJBXHU0RThCXHU3QkExXHU3NDA2XHU3Q0ZCXHU3RURGMlxcaUJpekVIUlxcYXBwX0VIUlBpbVxcbm9kZV9tb2R1bGVzXFxAYmFiZWxcXHJ1bnRpbWUvaGVscGVycy9lc20vcG9zc2libGVDb25zdHJ1Y3RvclJldHVybiI7CmltcG9ydCBfZ2V0UHJvdG90eXBlT2YgZnJvbSAiRjpcXGNyb2RcdTk4NzlcdTc2RUVcXFx1NEVCQVx1NEU4Qlx1N0JBMVx1NzQwNlx1N0NGQlx1N0VERjJcXGlCaXpFSFJcXGFwcF9FSFJQaW1cXG5vZGVfbW9kdWxlc1xcQGJhYmVsXFxydW50aW1lL2hlbHBlcnMvZXNtL2dldFByb3RvdHlwZU9mIjsKaW1wb3J0IF9pbmhlcml0cyBmcm9tICJGOlxcY3JvZFx1OTg3OVx1NzZFRVxcXHU0RUJBXHU0RThCXHU3QkExXHU3NDA2XHU3Q0ZCXHU3RURGMlxcaUJpekVIUlxcYXBwX0VIUlBpbVxcbm9kZV9tb2R1bGVzXFxAYmFiZWxcXHJ1bnRpbWUvaGVscGVycy9lc20vaW5oZXJpdHMiOwoKZnVuY3Rpb24gb3duS2V5cyhvYmplY3QsIGVudW1lcmFibGVPbmx5KSB7IHZhciBrZXlzID0gT2JqZWN0LmtleXMob2JqZWN0KTsgaWYgKE9iamVjdC5nZXRPd25Qcm9wZXJ0eVN5bWJvbHMpIHsgdmFyIHN5bWJvbHMgPSBPYmplY3QuZ2V0T3duUHJvcGVydHlTeW1ib2xzKG9iamVjdCk7IGlmIChlbnVtZXJhYmxlT25seSkgc3ltYm9scyA9IHN5bWJvbHMuZmlsdGVyKGZ1bmN0aW9uIChzeW0pIHsgcmV0dXJuIE9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3Iob2JqZWN0LCBzeW0pLmVudW1lcmFibGU7IH0pOyBrZXlzLnB1c2guYXBwbHkoa2V5cywgc3ltYm9scyk7IH0gcmV0dXJuIGtleXM7IH0KCmZ1bmN0aW9uIF9vYmplY3RTcHJlYWQodGFyZ2V0KSB7IGZvciAodmFyIGkgPSAxOyBpIDwgYXJndW1lbnRzLmxlbmd0aDsgaSsrKSB7IHZhciBzb3VyY2UgPSBhcmd1bWVudHNbaV0gIT0gbnVsbCA/IGFyZ3VtZW50c1tpXSA6IHt9OyBpZiAoaSAlIDIpIHsgb3duS2V5cyhPYmplY3Qoc291cmNlKSwgdHJ1ZSkuZm9yRWFjaChmdW5jdGlvbiAoa2V5KSB7IF9kZWZpbmVQcm9wZXJ0eSh0YXJnZXQsIGtleSwgc291cmNlW2tleV0pOyB9KTsgfSBlbHNlIGlmIChPYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9ycykgeyBPYmplY3QuZGVmaW5lUHJvcGVydGllcyh0YXJnZXQsIE9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3JzKHNvdXJjZSkpOyB9IGVsc2UgeyBvd25LZXlzKE9iamVjdChzb3VyY2UpKS5mb3JFYWNoKGZ1bmN0aW9uIChrZXkpIHsgT2JqZWN0LmRlZmluZVByb3BlcnR5KHRhcmdldCwga2V5LCBPYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yKHNvdXJjZSwga2V5KSk7IH0pOyB9IH0gcmV0dXJuIHRhcmdldDsgfQoKaW1wb3J0ICogYXMgdHNsaWJfMSBmcm9tICJ0c2xpYiI7CmltcG9ydCB7IFZ1ZSwgQ29tcG9uZW50LCBQcm9wIH0gZnJvbSAndnVlLXByb3BlcnR5LWRlY29yYXRvcic7CmltcG9ydCB7IFV0aWwgfSBmcm9tICdAL3V0aWxzJzsKaW1wb3J0IFBpbVRpdGxlU2VydmljZSBmcm9tICdAL3NlcnZpY2UvcGltLXRpdGxlL3BpbS10aXRsZS1zZXJ2aWNlJzsKaW1wb3J0IE9yZ1RpdGxlQmFyU2VydmljZSBmcm9tICcuL29yZy10aXRsZS1iYXItY2hhcnQtc2VydmljZSc7CmltcG9ydCBlY2hhcnRzIGZyb20gJ2VjaGFydHMnOwppbXBvcnQgbW9tZW50IGZyb20gIm1vbWVudCI7CmltcG9ydCBDb2RlTGlzdFNlcnZpY2UgZnJvbSAiQHNlcnZpY2UvYXBwL2NvZGVsaXN0LXNlcnZpY2UiOwppbXBvcnQgeyBDaGFydEJhclNlcmllcyB9IGZyb20gJ0AvbW9kZWwvY2hhcnQtZGV0YWlsJzsKCnZhciBPcmdUaXRsZUJhckJhc2UgPQovKiNfX1BVUkVfXyovCmZ1bmN0aW9uIChfVnVlKSB7CiAgX2luaGVyaXRzKE9yZ1RpdGxlQmFyQmFzZSwgX1Z1ZSk7CgogIGZ1bmN0aW9uIE9yZ1RpdGxlQmFyQmFzZSgpIHsKICAgIHZhciBfdGhpczI7CgogICAgX2NsYXNzQ2FsbENoZWNrKHRoaXMsIE9yZ1RpdGxlQmFyQmFzZSk7CgogICAgX3RoaXMyID0gX3Bvc3NpYmxlQ29uc3RydWN0b3JSZXR1cm4odGhpcywgX2dldFByb3RvdHlwZU9mKE9yZ1RpdGxlQmFyQmFzZSkuYXBwbHkodGhpcywgYXJndW1lbnRzKSk7CiAgICAvKioNCiAgICAgKiDlu7rmnoTpg6jku7bmnI3liqHlr7nosaENCiAgICAgKg0KICAgICAqIEB0eXBlIHtPcmdUaXRsZUJhclNlcnZpY2V9DQogICAgICogQG1lbWJlcm9mIE9yZ1RpdGxlQmFyQmFzZQ0KICAgICAqLwoKICAgIF90aGlzMi5zZXJ2aWNlID0gbmV3IE9yZ1RpdGxlQmFyU2VydmljZSh7CiAgICAgICRzdG9yZTogX3RoaXMyLiRzdG9yZQogICAgfSk7CiAgICAvKioNCiAgICAgKiDlrp7kvZPmnI3liqHlr7nosaENCiAgICAgKg0KICAgICAqIEB0eXBlIHtQaW1UaXRsZVNlcnZpY2V9DQogICAgICogQG1lbWJlcm9mIE9yZ1RpdGxlQmFyQmFzZQ0KICAgICAqLwoKICAgIF90aGlzMi5hcHBFbnRpdHlTZXJ2aWNlID0gbmV3IFBpbVRpdGxlU2VydmljZSh7CiAgICAgICRzdG9yZTogX3RoaXMyLiRzdG9yZQogICAgfSk7CiAgICAvKioNCiAgICAgKiDmmK/lkKbml6DmlbDmja4NCiAgICAgKg0KICAgICAqIEBwdWJsaWMNCiAgICAgKiBAdHlwZSB7Ym9vbGVhbn0NCiAgICAgKiBAbWVtYmVyb2YgRGJfc3lzcG9ydGxldDVfY2hhcnRCYXNlDQogICAgICovCgogICAgX3RoaXMyLmlzTm9EYXRhID0gZmFsc2U7CiAgICAvKioNCiAgICAgKiDlm77ooahkaXbnu5HlrprnmoRpZA0KICAgICAqDQogICAgICogQHR5cGUge30NCiAgICAgKiBAbWVtYmVyb2YgRGJfc3lzcG9ydGxldDVfY2hhcnRCYXNlDQogICAgICovCgogICAgX3RoaXMyLmNoYXJ0SWQgPSBfdGhpczIuJHV0aWwuY3JlYXRlVVVJRCgpOwogICAgLyoqDQogICAgICog5Luj56CB6KGo5pyN5Yqh5a+56LGhDQogICAgICoNCiAgICAgKiBAdHlwZSB7Q29kZUxpc3RTZXJ2aWNlfQ0KICAgICAqIEBtZW1iZXJvZiBEYl9zeXNwb3J0bGV0NV9jaGFydEJhc2UNCiAgICAgKi8KCiAgICBfdGhpczIuY29kZUxpc3RTZXJ2aWNlID0gbmV3IENvZGVMaXN0U2VydmljZSh7CiAgICAgICRzdG9yZTogX3RoaXMyLiRzdG9yZQogICAgfSk7CiAgICAvKioNCiAgICAgKiDluo/liJfmqKHlnosNCiAgICAgKg0KICAgICAqIEB0eXBlIHt9DQogICAgICogQG1lbWJlcm9mIERiX3N5c3BvcnRsZXQ1X2NoYXJ0QmFzZQ0KICAgICAqLwoKICAgIF90aGlzMi5zZXJpZXNNb2RlbCA9IHsKICAgICAgb3JndGl0bGViYXI6IG5ldyBDaGFydEJhclNlcmllcyh7CiAgICAgICAgbmFtZTogJ29yZ3RpdGxlYmFyJywKICAgICAgICBjYXRlZ29yRmllbGQ6ICdwcm9mZXNzb3JfdHlwZScsCiAgICAgICAgY2F0ZWdvckNvZGVMaXN0OiB7CiAgICAgICAgICB0eXBlOiAnRFlOQU1JQycsCiAgICAgICAgICB0YWc6ICdFaHJDb2RlTGlzdDAwMjQnLAogICAgICAgICAgZW1wdHljb2RlOiAnZW1wdHknLAogICAgICAgICAgZW1wdHl0ZXh0OiAn5pyq5a6a5LmJJwogICAgICAgIH0sCiAgICAgICAgdmFsdWVGaWVsZDogJ2NvdW50bnVtJywKICAgICAgICBzZXJpZXNWYWx1ZXM6IFtdLAogICAgICAgIHNlcmllc0luZGV4OiAwLAogICAgICAgIGRhdGE6IFtdLAogICAgICAgIHNlcmllc01hcDoge30sCiAgICAgICAgZGF0YVNldEZpZWxkczogW3sKICAgICAgICAgIG5hbWU6ICJwcm9mZXNzb3JfdHlwZSIsCiAgICAgICAgICBjb2RlbGlzdDogewogICAgICAgICAgICB0eXBlOiAiRFlOQU1JQyIsCiAgICAgICAgICAgIHRhZzogIkVockNvZGVMaXN0MDAyNCIsCiAgICAgICAgICAgIGVtcHR5Y29kZTogJ2VtcHR5JywKICAgICAgICAgICAgZW1wdHl0ZXh0OiAn5pyq5a6a5LmJJwogICAgICAgICAgfSwKICAgICAgICAgIGlzR3JvdXBGaWVsZDogdHJ1ZSwKICAgICAgICAgIGdyb3VwTW9kZTogIkNPREVMSVNUIgogICAgICAgIH0sIHsKICAgICAgICAgIG5hbWU6ICJjb3VudG51bSIsCiAgICAgICAgICBjb2RlbGlzdDogbnVsbCwKICAgICAgICAgIGlzR3JvdXBGaWVsZDogZmFsc2UsCiAgICAgICAgICBncm91cE1vZGU6ICIiCiAgICAgICAgfV0sCiAgICAgICAgZWN4T2JqZWN0OiB7CiAgICAgICAgICBsYWJlbDogewogICAgICAgICAgICBzaG93OiB0cnVlLAogICAgICAgICAgICBwb3NpdGlvbjogJ2luc2lkZScKICAgICAgICAgIH0sCiAgICAgICAgICBsYWJlbExpbmU6IHsKICAgICAgICAgICAgbGVuZ3RoOiAxMCwKICAgICAgICAgICAgbGluZVN0eWxlOiB7CiAgICAgICAgICAgICAgd2lkdGg6IDEsCiAgICAgICAgICAgICAgdHlwZTogJ3NvbGlkJwogICAgICAgICAgICB9CiAgICAgICAgICB9LAogICAgICAgICAgaXRlbVN0eWxlOiB7CiAgICAgICAgICAgIGJvcmRlckNvbG9yOiAnI2ZmZicsCiAgICAgICAgICAgIGJvcmRlcldpZHRoOiAxCiAgICAgICAgICB9LAogICAgICAgICAgZW1waGFzaXM6IHsKICAgICAgICAgICAgbGFiZWw6IHsKICAgICAgICAgICAgICBmb250U2l6ZTogMjAKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0sCiAgICAgICAgZWNPYmplY3Q6IHsKICAgICAgICAgIGxhYmVsOiB7CiAgICAgICAgICAgIHNob3c6IHRydWUsCiAgICAgICAgICAgIHBvc2l0aW9uOiAidG9wIiwKICAgICAgICAgICAgZm9ybWF0dGVyOiAne2J9OiB7QGNvdW50bnVtfeS6uicKICAgICAgICAgIH0sCiAgICAgICAgICBpdGVtU3R5bGU6IHsKICAgICAgICAgICAgbm9ybWFsOiB7CiAgICAgICAgICAgICAgY29sb3I6IGZ1bmN0aW9uIGNvbG9yKHBhcmFtcykgewogICAgICAgICAgICAgICAgdmFyIGNvbG9yTGlzdCA9IFsiIzY3NDFmZiIsICIjMDBmZmE0IiwgIiM0M2IyZmYiLCAiI2ZlYTY3NSJdOwogICAgICAgICAgICAgICAgcmV0dXJuIGNvbG9yTGlzdFtwYXJhbXMuZGF0YUluZGV4XTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9LAogICAgICAgIHNlcmllc1RlbXA6IHsKICAgICAgICAgIHR5cGU6ICdiYXInCiAgICAgICAgfSwKICAgICAgICBiYXNlT3B0aW9uOiB7fSwKICAgICAgICBzZXJpZXNMYXlvdXRCeTogImNvbHVtbiIKICAgICAgfSkKICAgIH07CiAgICAvKioNCiAgICAgKiDlm77ooajoh6rlrprkuYnlj4LmlbDpm4blkIgNCiAgICAgKg0KICAgICAqIEBtZW1iZXJvZiBEYl9zeXNwb3J0bGV0NV9jaGFydEJhc2UNCiAgICAgKi8KCiAgICBfdGhpczIuY2hhcnRVc2VyUGFyYW1zID0gewogICAgICB4QXhpczogW3sKICAgICAgICBncmlkSW5kZXg6IDAsCiAgICAgICAgcG9zaXRpb246ICJib3R0b20iLAogICAgICAgIHR5cGU6ICJjYXRlZ29yeSIsCiAgICAgICAgbmFtZTogIiIsCiAgICAgICAgYXhpc1RpY2s6IHsKICAgICAgICAgIHNob3c6IGZhbHNlCiAgICAgICAgfSwKICAgICAgICBheGlzTGFiZWw6IHsKICAgICAgICAgIHNob3c6IGZhbHNlCiAgICAgICAgfQogICAgICB9XSwKICAgICAgY29sb3I6IFsnIzg4NmZlYycsICcjMDQwNGY2JywgJyM4QkMzNEEnLCAnIzI1ZmFkMycsICcjOTFjN2FlJywgJyM3NDlmODMnLCAnI2NhODYyMicsICcjYmRhMjlhJywgJyM2ZTcwNzQnLCAnIzU0NjU3MCcsICcjYzRjY2QzJ10sCiAgICAgIHlBeGlzOiB7CiAgICAgICAgc2hvdzogZmFsc2UKICAgICAgfQogICAgfTsKICAgIC8qKg0KICAgICAqIOWbvuihqOWfuuehgOWKqOaAgeaooeWeiw0KICAgICAqDQogICAgICogQG1lbWJlcm9mIERiX3N5c3BvcnRsZXQ1X2NoYXJ0QmFzZQ0KICAgICAqLwoKICAgIF90aGlzMi5jaGFydEJhc2VPUHRpb24gPSB7fTsKICAgIC8qKg0KICAgICAqIOWIneWni+WMluWbvuihqOaJgOmcgOWPguaVsA0KICAgICAqDQogICAgICogQHR5cGUge30NCiAgICAgKiBAbWVtYmVyb2YgRGJfc3lzcG9ydGxldDVfY2hhcnRCYXNlDQogICAgICovCgogICAgX3RoaXMyLmNoYXJ0T3B0aW9uID0gewogICAgICB0aXRsZTogewogICAgICAgIHNob3c6IHRydWUsCiAgICAgICAgdGV4dDogJ+iBjOensOWIhuW4gycsCiAgICAgICAgc3VidGV4dDogJycKICAgICAgfSwKICAgICAgbGVnZW5kOiB7CiAgICAgICAgc2hvdzogZmFsc2UKICAgICAgfSwKICAgICAgZ3JpZDogW3t9XSwKICAgICAgeEF4aXM6IFt7CiAgICAgICAgZ3JpZEluZGV4OiAwLAogICAgICAgIHBvc2l0aW9uOiAiYm90dG9tIiwKICAgICAgICB0eXBlOiAnY2F0ZWdvcnknLAogICAgICAgIG5hbWU6ICfnrYnnuqcnCiAgICAgIH1dLAogICAgICB5QXhpczogW3sKICAgICAgICBncmlkSW5kZXg6IDAsCiAgICAgICAgcG9zaXRpb246ICJ0b3AiLAogICAgICAgIHR5cGU6ICd2YWx1ZScsCiAgICAgICAgbmFtZTogJ+aVsOmHjycKICAgICAgfV0sCiAgICAgIHRvb2x0aXA6IHsKICAgICAgICBzaG93OiB0cnVlCiAgICAgIH0sCiAgICAgIGRhdGFzZXQ6IFtdLAogICAgICBzZXJpZXM6IFt7CiAgICAgICAgaWQ6ICdvcmd0aXRsZWJhcicsCiAgICAgICAgbmFtZTogJ+iBjOensOWIhuW4gycsCiAgICAgICAgdHlwZTogJ2JhcicsCiAgICAgICAgeEF4aXNJbmRleDogMCwKICAgICAgICB5QXhpc0luZGV4OiAwLAogICAgICAgIGRhdGFzZXRJbmRleDogMCwKICAgICAgICBlbmNvZGU6IHsKICAgICAgICAgIHg6IFsncHJvZmVzc29yX3R5cGUnXSwKICAgICAgICAgIHk6IFsnY291bnRudW0nXQogICAgICAgIH0KICAgICAgfV0KICAgIH07CiAgICByZXR1cm4gX3RoaXMyOwogIH0KICAvKioNCiAgICog6I635Y+W6YOo5Lu257G75Z6LDQogICAqDQogICAqIEByZXR1cm5zIHtzdHJpbmd9DQogICAqIEBtZW1iZXJvZiBPcmdUaXRsZUJhckJhc2UNCiAgICovCgoKICBfY3JlYXRlQ2xhc3MoT3JnVGl0bGVCYXJCYXNlLCBbewogICAga2V5OiAiZ2V0Q29udHJvbFR5cGUiLAogICAgdmFsdWU6IGZ1bmN0aW9uIGdldENvbnRyb2xUeXBlKCkgewogICAgICByZXR1cm4gJ0NIQVJUJzsKICAgIH0KICAgIC8qKg0KICAgICAqIOWFs+mXreinhuWbvg0KICAgICAqDQogICAgICogQHBhcmFtIHthbnl9IGFyZ3MNCiAgICAgKiBAbWVtYmVyb2YgT3JnVGl0bGVCYXJCYXNlDQogICAgICovCgogIH0sIHsKICAgIGtleTogImNsb3NlVmlldyIsCiAgICB2YWx1ZTogZnVuY3Rpb24gY2xvc2VWaWV3KGFyZ3MpIHsKICAgICAgdmFyIF90aGlzID0gdGhpczsKCiAgICAgIF90aGlzLiRlbWl0KCdjbG9zZXZpZXcnLCBbYXJnc10pOwogICAgfQogICAgLyoqDQogICAgICogIOiuoeaVsOWZqOWIt+aWsA0KICAgICAqDQogICAgICogQG1lbWJlcm9mIE9yZ1RpdGxlQmFyQmFzZQ0KICAgICAqLwoKICB9LCB7CiAgICBrZXk6ICJjb3VudGVyUmVmcmVzaCIsCiAgICB2YWx1ZTogZnVuY3Rpb24gY291bnRlclJlZnJlc2goKSB7CiAgICAgIHZhciBfdGhpcyA9IHRoaXM7CgogICAgICBpZiAoX3RoaXMuY291bnRlclNlcnZpY2VBcnJheSAmJiBfdGhpcy5jb3VudGVyU2VydmljZUFycmF5Lmxlbmd0aCA+IDApIHsKICAgICAgICBfdGhpcy5jb3VudGVyU2VydmljZUFycmF5LmZvckVhY2goZnVuY3Rpb24gKGl0ZW0pIHsKICAgICAgICAgIGlmIChpdGVtLnJlZnJlc2hEYXRhICYmIGl0ZW0ucmVmcmVzaERhdGEgaW5zdGFuY2VvZiBGdW5jdGlvbikgewogICAgICAgICAgICBpdGVtLnJlZnJlc2hEYXRhKCk7CiAgICAgICAgICB9CiAgICAgICAgfSk7CiAgICAgIH0KICAgIH0KICAgIC8qKg0KICAgICAqIOiOt+WPluWkmumhueaVsOaNrg0KICAgICAqDQogICAgICogQHJldHVybnMge2FueVtdfQ0KICAgICAqIEBtZW1iZXJvZiBPcmdUaXRsZUJhckJhc2UNCiAgICAgKi8KCiAgfSwgewogICAga2V5OiAiZ2V0RGF0YXMiLAogICAgdmFsdWU6IGZ1bmN0aW9uIGdldERhdGFzKCkgewogICAgICByZXR1cm4gW107CiAgICB9CiAgICAvKioNCiAgICAgKiDojrflj5bljZXpobnmoJENCiAgICAgKg0KICAgICAqIEByZXR1cm5zIHsqfQ0KICAgICAqIEBtZW1iZXJvZiBPcmdUaXRsZUJhckJhc2UNCiAgICAgKi8KCiAgfSwgewogICAga2V5OiAiZ2V0RGF0YSIsCiAgICB2YWx1ZTogZnVuY3Rpb24gZ2V0RGF0YSgpIHsKICAgICAgcmV0dXJuIG51bGw7CiAgICB9CiAgICAvKioNCiAgICAqIFZ1ZeWjsOaYjuWRqOacnyjnu4Tku7bliJ3lp4vljJblrozmr5UpDQogICAgKg0KICAgICogQG1lbWJlcm9mIE9yZ1RpdGxlQmFyQmFzZQ0KICAgICovCgogIH0sIHsKICAgIGtleTogImNyZWF0ZWQiLAogICAgdmFsdWU6IGZ1bmN0aW9uIGNyZWF0ZWQoKSB7CiAgICAgIHRoaXMuYWZ0ZXJDcmVhdGVkKCk7CiAgICB9CiAgICAvKioNCiAgICAqIOaJp+ihjGNyZWF0ZWTlkI7nmoTpgLvovpENCiAgICAqDQogICAgKiBAbWVtYmVyb2YgT3JnVGl0bGVCYXJCYXNlDQogICAgKi8KCiAgfSwgewogICAga2V5OiAiYWZ0ZXJDcmVhdGVkIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBhZnRlckNyZWF0ZWQoKSB7CiAgICAgIHZhciBfdGhpczMgPSB0aGlzOwoKICAgICAgaWYgKHRoaXMudmlld1N0YXRlKSB7CiAgICAgICAgdGhpcy52aWV3U3RhdGVFdmVudCA9IHRoaXMudmlld1N0YXRlLnN1YnNjcmliZShmdW5jdGlvbiAoX3JlZikgewogICAgICAgICAgdmFyIHRhZyA9IF9yZWYudGFnLAogICAgICAgICAgICAgIGFjdGlvbiA9IF9yZWYuYWN0aW9uLAogICAgICAgICAgICAgIGRhdGEgPSBfcmVmLmRhdGE7CgogICAgICAgICAgaWYgKCFPYmplY3QuaXModGFnLCBfdGhpczMubmFtZSkpIHsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgfQoKICAgICAgICAgIGlmIChPYmplY3QuaXMoJ2xvYWQnLCBhY3Rpb24pKSB7CiAgICAgICAgICAgIF90aGlzMy5sb2FkKGRhdGEpOwogICAgICAgICAgfQogICAgICAgIH0pOwogICAgICB9CiAgICB9CiAgICAvKioNCiAgICAgKiB2dWUg55Sf5ZG95ZGo5pyfDQogICAgICoNCiAgICAgKiBAbWVtYmVyb2YgT3JnVGl0bGVCYXJCYXNlDQogICAgICovCgogIH0sIHsKICAgIGtleTogImRlc3Ryb3llZCIsCiAgICB2YWx1ZTogZnVuY3Rpb24gZGVzdHJveWVkKCkgewogICAgICB0aGlzLmFmdGVyRGVzdHJveSgpOwogICAgfQogICAgLyoqDQogICAgICog5omn6KGMZGVzdHJveWVk5ZCO55qE6YC76L6RDQogICAgICoNCiAgICAgKiBAbWVtYmVyb2YgT3JnVGl0bGVCYXJCYXNlDQogICAgICovCgogIH0sIHsKICAgIGtleTogImFmdGVyRGVzdHJveSIsCiAgICB2YWx1ZTogZnVuY3Rpb24gYWZ0ZXJEZXN0cm95KCkgewogICAgICBpZiAodGhpcy52aWV3U3RhdGVFdmVudCkgewogICAgICAgIHRoaXMudmlld1N0YXRlRXZlbnQudW5zdWJzY3JpYmUoKTsKICAgICAgfQogICAgfQogICAgLyoqDQogICAgICog5Yi35pawDQogICAgICoNCiAgICAgKiBAcGFyYW0geyp9IFtvcHQ9e31dDQogICAgICogQG1lbWJlcm9mIERiX3N5c3BvcnRsZXQ1X2NoYXJ0QmFzZQ0KICAgICAqLwoKICB9LCB7CiAgICBrZXk6ICJyZWZyZXNoIiwKICAgIHZhbHVlOiBmdW5jdGlvbiByZWZyZXNoKCkgewogICAgICB2YXIgb3B0ID0gYXJndW1lbnRzLmxlbmd0aCA+IDAgJiYgYXJndW1lbnRzWzBdICE9PSB1bmRlZmluZWQgPyBhcmd1bWVudHNbMF0gOiB7fTsKICAgICAgdGhpcy5sb2FkKG9wdCk7CiAgICB9CiAgICAvKioNCiAgICAgKiDojrflj5blm77ooajmlbDmja4NCiAgICAgKg0KICAgICAqIEByZXR1cm5zIHsqfQ0KICAgICAqIEBtZW1iZXJvZiBEYl9zeXNwb3J0bGV0NV9jaGFydEJhc2UNCiAgICAgKi8KCiAgfSwgewogICAga2V5OiAibG9hZCIsCiAgICB2YWx1ZTogZnVuY3Rpb24gbG9hZChvcHQpIHsKICAgICAgdmFyIF90aGlzNCA9IHRoaXM7CgogICAgICB2YXIgX3RoaXMgPSB0aGlzOwoKICAgICAgdmFyIGFyZyA9IF9vYmplY3RTcHJlYWQoe30sIG9wdCk7CgogICAgICB2YXIgcGFyZW50ZGF0YSA9IHt9OwogICAgICB0aGlzLiRlbWl0KCdiZWZvcmVsb2FkJywgcGFyZW50ZGF0YSk7CiAgICAgIE9iamVjdC5hc3NpZ24oYXJnLCBwYXJlbnRkYXRhKTsKICAgICAgT2JqZWN0LmFzc2lnbihhcmcsIHsKICAgICAgICB2aWV3cGFyYW1zOiB0aGlzLnZpZXdwYXJhbXMsCiAgICAgICAgcGFnZTogMCwKICAgICAgICBzaXplOiAxMDAwCiAgICAgIH0pOwogICAgICB0aGlzLnNlcnZpY2Uuc2VhcmNoKHRoaXMuZmV0Y2hBY3Rpb24sIEpTT04ucGFyc2UoSlNPTi5zdHJpbmdpZnkodGhpcy5jb250ZXh0KSksIGFyZywgdGhpcy5zaG93QnVzeUluZGljYXRvcikudGhlbihmdW5jdGlvbiAocmVzKSB7CiAgICAgICAgaWYgKHJlcykgewogICAgICAgICAgX3RoaXM0LnRyYW5zZm9ybVRvQmFzaWNDaGFydFNldERhdGEocmVzLmRhdGEsIGZ1bmN0aW9uIChjb2RlbGlzdCkgewogICAgICAgICAgICBfdGhpcy5kcmF3Q2hhcnRzKGNvZGVsaXN0KTsKICAgICAgICAgIH0pOwogICAgICAgIH0KICAgICAgfSlbImNhdGNoIl0oZnVuY3Rpb24gKGVycm9yKSB7CiAgICAgICAgY29uc29sZS5lcnJvcihlcnJvcik7CiAgICAgIH0pOwogICAgfQogICAgLyoqDQogICAgICog57uY5Yi25Zu+6KGoDQogICAgICoNCiAgICAgKiBAcmV0dXJucyB7Kn0NCiAgICAgKiBAbWVtYmVyb2YgRGJfc3lzcG9ydGxldDVfY2hhcnRCYXNlDQogICAgICovCgogIH0sIHsKICAgIGtleTogImRyYXdDaGFydHMiLAogICAgdmFsdWU6IGZ1bmN0aW9uIGRyYXdDaGFydHMoY29kZWxpc3QpIHsKICAgICAgaWYgKCF0aGlzLm15Q2hhcnQpIHsKICAgICAgICB2YXIgZWxlbWVudCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKHRoaXMuY2hhcnRJZCk7CiAgICAgICAgdGhpcy5teUNoYXJ0ID0gZWNoYXJ0cy5pbml0KGVsZW1lbnQpOwogICAgICB9CgogICAgICB2YXIgX2NoYXJ0T3B0aW9uID0gdGhpcy5oYW5kbGVDaGFydE9QdGlvbihjb2RlbGlzdCk7CgogICAgICBjb25zb2xlLmxvZyhfY2hhcnRPcHRpb24pOwogICAgICB0aGlzLm15Q2hhcnQuc2V0T3B0aW9uKF9jaGFydE9wdGlvbik7CiAgICAgIHRoaXMubXlDaGFydC5yZXNpemUoKTsKICAgIH0KICAgIC8qKg0KICAgICAqIOWkhOeQhuWbvuihqOWPguaVsA0KICAgICAqDQogICAgICogQG1lbWJlcm9mIERiX3N5c3BvcnRsZXQ1X2NoYXJ0QmFzZQ0KICAgICAqLwoKICB9LCB7CiAgICBrZXk6ICJoYW5kbGVDaGFydE9QdGlvbiIsCiAgICB2YWx1ZTogZnVuY3Rpb24gaGFuZGxlQ2hhcnRPUHRpb24oYWxsY29kZWxpc3QpIHsKICAgICAgdmFyIF90aGlzNSA9IHRoaXM7CgogICAgICB2YXIgX2NoYXJ0T3B0aW9uID0gSlNPTi5wYXJzZShKU09OLnN0cmluZ2lmeSh0aGlzLmNoYXJ0T3B0aW9uKSk7CgogICAgICBpZiAoT2JqZWN0LmtleXModGhpcy5zZXJpZXNNb2RlbCkubGVuZ3RoID4gMCkgewogICAgICAgIChmdW5jdGlvbiAoKSB7CiAgICAgICAgICB2YXIgdGVtcERhdGFTb3VyY2VNYXAgPSBuZXcgTWFwKCk7CgogICAgICAgICAgdmFyIF9sb29wID0gZnVuY3Rpb24gX2xvb3AoaSkgewogICAgICAgICAgICBPYmplY3QudmFsdWVzKF90aGlzNS5zZXJpZXNNb2RlbCkuZm9yRWFjaChmdW5jdGlvbiAoc2VyaWVzdmFsdWUpIHsKICAgICAgICAgICAgICBpZiAoc2VyaWVzdmFsdWUuc2VyaWVzSW5kZXggPT09IGkpIHsKICAgICAgICAgICAgICAgIHRlbXBEYXRhU291cmNlTWFwLnNldChzZXJpZXN2YWx1ZS5uYW1lLCBzZXJpZXN2YWx1ZS5kYXRhKTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0pOwogICAgICAgICAgfTsKCiAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IE9iamVjdC5rZXlzKF90aGlzNS5zZXJpZXNNb2RlbCkubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgX2xvb3AoaSk7CiAgICAgICAgICB9CgogICAgICAgICAgaWYgKHRlbXBEYXRhU291cmNlTWFwLnNpemUgPiAwKSB7CiAgICAgICAgICAgIHRlbXBEYXRhU291cmNlTWFwLmZvckVhY2goZnVuY3Rpb24gKGl0ZW0pIHsKICAgICAgICAgICAgICBfY2hhcnRPcHRpb24uZGF0YXNldC5wdXNoKHsKICAgICAgICAgICAgICAgICdzb3VyY2UnOiBpdGVtCiAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH0pOwogICAgICAgICAgfQoKICAgICAgICAgIE9iamVjdC5rZXlzKF90aGlzNS5zZXJpZXNNb2RlbCkuZm9yRWFjaChmdW5jdGlvbiAoc2VyaWVzTmFtZSkgewogICAgICAgICAgICBpZiAoX2NoYXJ0T3B0aW9uICYmIF9jaGFydE9wdGlvbi5zZXJpZXMubGVuZ3RoID4gMCkgewogICAgICAgICAgICAgIF9jaGFydE9wdGlvbi5zZXJpZXMuZm9yRWFjaChmdW5jdGlvbiAoaXRlbSkgewogICAgICAgICAgICAgICAgaWYgKF90aGlzNS5zZXJpZXNNb2RlbFtzZXJpZXNOYW1lXS5lY3hPYmplY3QgJiYgT2JqZWN0LmlzKHNlcmllc05hbWUsIGl0ZW0uaWQpKSB7CiAgICAgICAgICAgICAgICAgIGl0ZW0gPSBVdGlsLmRlZXBPYmplY3RNZXJnZShpdGVtLCBfdGhpczUuc2VyaWVzTW9kZWxbc2VyaWVzTmFtZV0uZWN4T2JqZWN0KTsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBpZiAoX3RoaXM1LnNlcmllc01vZGVsW3Nlcmllc05hbWVdLmJhc2VPcHRpb24gJiYgT2JqZWN0LmtleXMoX3RoaXM1LnNlcmllc01vZGVsW3Nlcmllc05hbWVdLmJhc2VPcHRpb24pLmxlbmd0aCA+IDAgJiYgT2JqZWN0LmlzKHNlcmllc05hbWUsIGl0ZW0uaWQpKSB7CiAgICAgICAgICAgICAgICAgIGl0ZW0gPSBVdGlsLmRlZXBPYmplY3RNZXJnZShpdGVtLCBfdGhpczUuc2VyaWVzTW9kZWxbc2VyaWVzTmFtZV0uYmFzZU9wdGlvbik7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgaWYgKF90aGlzNS5zZXJpZXNNb2RlbFtzZXJpZXNOYW1lXS5lY09iamVjdCAmJiBPYmplY3QuaXMoc2VyaWVzTmFtZSwgaXRlbS5pZCkpIHsKICAgICAgICAgICAgICAgICAgaXRlbSA9IFV0aWwuZGVlcE9iamVjdE1lcmdlKGl0ZW0sIF90aGlzNS5zZXJpZXNNb2RlbFtzZXJpZXNOYW1lXS5lY09iamVjdCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH0gLy/orr7nva7lpJrluo/liJcKCgogICAgICAgICAgICB2YXIgdGVtcFNlcmllcyA9IF90aGlzNS5zZXJpZXNNb2RlbFtzZXJpZXNOYW1lXTsgLy8g6Z2e6Zu36L6+5Zu+CgogICAgICAgICAgICBpZiAodGVtcFNlcmllcyAmJiB0ZW1wU2VyaWVzLnNlcmllc0lkRmllbGQgJiYgdGVtcFNlcmllcy5zZXJpZXNWYWx1ZXMubGVuZ3RoID4gMCAmJiAhT2JqZWN0LmlzKHRlbXBTZXJpZXMudHlwZSwgJ3JhZGFyJykpIHsKICAgICAgICAgICAgICB2YXIgcmV0dXJuSW5kZXggPSBfY2hhcnRPcHRpb24uc2VyaWVzLmZpbmRJbmRleChmdW5jdGlvbiAoaXRlbSkgewogICAgICAgICAgICAgICAgcmV0dXJuIE9iamVjdC5pcyhpdGVtLmlkLCBzZXJpZXNOYW1lKTsKICAgICAgICAgICAgICB9KTsKCiAgICAgICAgICAgICAgX2NoYXJ0T3B0aW9uLnNlcmllcy5zcGxpY2UocmV0dXJuSW5kZXgsIDEpOwoKICAgICAgICAgICAgICB2YXIgdGVtcFNlcmllc0FycmF5ID0gW107CiAgICAgICAgICAgICAgdGVtcFNlcmllcy5zZXJpZXNWYWx1ZXMuZm9yRWFjaChmdW5jdGlvbiAoc2VyaWVzdmFsdWVJdGVtKSB7CiAgICAgICAgICAgICAgICB2YXIgdGVtcFNlcmllc1RlbXAgPSBKU09OLnBhcnNlKEpTT04uc3RyaW5naWZ5KHRlbXBTZXJpZXMuc2VyaWVzVGVtcCkpOwogICAgICAgICAgICAgICAgT2JqZWN0LmFzc2lnbih0ZW1wU2VyaWVzVGVtcCwgewogICAgICAgICAgICAgICAgICBuYW1lOiB0ZW1wU2VyaWVzLnNlcmllc01hcFtzZXJpZXN2YWx1ZUl0ZW1dLAogICAgICAgICAgICAgICAgICBkYXRhc2V0SW5kZXg6IHRlbXBTZXJpZXMuc2VyaWVzSW5kZXgsCiAgICAgICAgICAgICAgICAgIGVuY29kZTogewogICAgICAgICAgICAgICAgICAgIHg6IHRlbXBTZXJpZXMuY2F0ZWdvckZpZWxkLAogICAgICAgICAgICAgICAgICAgIHk6ICIiLmNvbmNhdChzZXJpZXN2YWx1ZUl0ZW0pCiAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgICAgIF9jaGFydE9wdGlvbi5zZXJpZXMucHVzaCh0ZW1wU2VyaWVzVGVtcCk7CiAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0pOwogICAgICAgIH0pKCk7CiAgICAgIH0KCiAgICAgIGlmIChPYmplY3Qua2V5cyh0aGlzLmNoYXJ0QmFzZU9QdGlvbikubGVuZ3RoID4gMCkgewogICAgICAgIE9iamVjdC5hc3NpZ24oX2NoYXJ0T3B0aW9uLCB0aGlzLmNoYXJ0QmFzZU9QdGlvbik7CiAgICAgIH0KCiAgICAgIGlmIChPYmplY3Qua2V5cyh0aGlzLmNoYXJ0VXNlclBhcmFtcykubGVuZ3RoID4gMCkgewogICAgICAgIE9iamVjdC5hc3NpZ24oX2NoYXJ0T3B0aW9uLCB0aGlzLmNoYXJ0VXNlclBhcmFtcyk7CiAgICAgIH0KCiAgICAgIHJldHVybiBfY2hhcnRPcHRpb247CiAgICB9CiAgICAvKioNCiAgICAgKiDlrp7kvZPmlbDmja7pm4bovazljJbkuLrlm77ooajmlbDmja7pm4YNCiAgICAgKg0KICAgICAqIDEu6I635Y+W5Zu+6KGo5omA5pyJ5Luj56CB6KGo5YC8DQogICAgICogMi7mn6Xor6Lpm4blkIjmmKDlsITlm77ooajmlbDmja7pm4YNCiAgICAgKiAzLuihpeWFqOWbvuihqOaVsOaNrumbhg0KICAgICAqIDQu5Zu+6KGo5pWw5o2u6ZuG5YiG57uE5rGC5ZKMDQogICAgICogNS7mjpLluo/lm77ooajmlbDmja7pm4YNCiAgICAgKg0KICAgICAqIEBwYXJhbSB7Kn0gZGF0YSDlrp7kvZPmlbDmja7pm4YNCiAgICAgKiBAcGFyYW0ge0Z1bmN0aW9ufSBjYWxsYmFjayDlm57osIMNCiAgICAgKiBAbWVtYmVyb2YgRGJfc3lzcG9ydGxldDVfY2hhcnRCYXNlDQogICAgICovCgogIH0sIHsKICAgIGtleTogInRyYW5zZm9ybVRvQmFzaWNDaGFydFNldERhdGEiLAogICAgdmFsdWU6IGZ1bmN0aW9uICgpIHsKICAgICAgdmFyIF90cmFuc2Zvcm1Ub0Jhc2ljQ2hhcnRTZXREYXRhID0gX2FzeW5jVG9HZW5lcmF0b3IoCiAgICAgIC8qI19fUFVSRV9fKi8KICAgICAgcmVnZW5lcmF0b3JSdW50aW1lLm1hcmsoZnVuY3Rpb24gX2NhbGxlZShkYXRhLCBjYWxsYmFjaykgewogICAgICAgIHZhciBfdGhpczYgPSB0aGlzOwoKICAgICAgICB2YXIgYWxsQ29kZUxpc3Q7CiAgICAgICAgcmV0dXJuIHJlZ2VuZXJhdG9yUnVudGltZS53cmFwKGZ1bmN0aW9uIF9jYWxsZWUkKF9jb250ZXh0KSB7CiAgICAgICAgICB3aGlsZSAoMSkgewogICAgICAgICAgICBzd2l0Y2ggKF9jb250ZXh0LnByZXYgPSBfY29udGV4dC5uZXh0KSB7CiAgICAgICAgICAgICAgY2FzZSAwOgogICAgICAgICAgICAgICAgaWYgKCEoIWRhdGEgfHwgIUFycmF5LmlzQXJyYXkoZGF0YSkgfHwgZGF0YS5sZW5ndGggPT09IDApKSB7CiAgICAgICAgICAgICAgICAgIF9jb250ZXh0Lm5leHQgPSAzOwogICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICB0aGlzLmlzTm9EYXRhID0gdHJ1ZTsKICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dC5hYnJ1cHQoInJldHVybiIpOwoKICAgICAgICAgICAgICBjYXNlIDM6CiAgICAgICAgICAgICAgICB0aGlzLmlzTm9EYXRhID0gZmFsc2U7IC8v6I635Y+W5Luj56CB6KGo5YC8CgogICAgICAgICAgICAgICAgX2NvbnRleHQubmV4dCA9IDY7CiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5nZXRDaGFydEFsbENvZGVMaXN0KCk7CgogICAgICAgICAgICAgIGNhc2UgNjoKICAgICAgICAgICAgICAgIGFsbENvZGVMaXN0ID0gX2NvbnRleHQuc2VudDsKCiAgICAgICAgICAgICAgICBpZiAoT2JqZWN0LnZhbHVlcyh0aGlzLnNlcmllc01vZGVsKS5sZW5ndGggPiAwKSB7CiAgICAgICAgICAgICAgICAgIE9iamVjdC52YWx1ZXModGhpcy5zZXJpZXNNb2RlbCkuZm9yRWFjaChmdW5jdGlvbiAoc2luZ2xlU2VyaWVzLCBpbmRleCkgewogICAgICAgICAgICAgICAgICAgIC8vIOWAvOWxnuaAp+S4unNyZmNvdW506K6+572ue3NyZmNvdW50OjF95YiwZGF0YQogICAgICAgICAgICAgICAgICAgIHZhciB2YWx1ZUZpZWxkID0gc2luZ2xlU2VyaWVzLmRhdGFTZXRGaWVsZHMuZmluZChmdW5jdGlvbiAoZGF0YXNldEZpZWxkKSB7CiAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gZGF0YXNldEZpZWxkLm5hbWUgPT09IHNpbmdsZVNlcmllcy52YWx1ZUZpZWxkOwogICAgICAgICAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgICAgICAgICBpZiAodmFsdWVGaWVsZCAmJiB2YWx1ZUZpZWxkLm5hbWUgJiYgT2JqZWN0LmlzKHZhbHVlRmllbGQubmFtZSwgInNyZmNvdW50IikpIHsKICAgICAgICAgICAgICAgICAgICAgIGRhdGEuZm9yRWFjaChmdW5jdGlvbiAoc2luZ2xlRGF0YSkgewogICAgICAgICAgICAgICAgICAgICAgICBPYmplY3QuYXNzaWduKHNpbmdsZURhdGEsIHsKICAgICAgICAgICAgICAgICAgICAgICAgICBzcmZjb3VudDogMQogICAgICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgIH0gLy8g5YiG57uE5bGe5oCnCgoKICAgICAgICAgICAgICAgICAgICB2YXIgZ3JvdXBGaWVsZCA9IHNpbmdsZVNlcmllcy5kYXRhU2V0RmllbGRzLmZpbmQoZnVuY3Rpb24gKGRhdGFzZXRGaWVsZCkgewogICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGRhdGFzZXRGaWVsZC5uYW1lID09PSBzaW5nbGVTZXJpZXMuY2F0ZWdvckZpZWxkOwogICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgIHZhciB0ZW1wQ2hhcnRTZXREYXRhID0gW107CiAgICAgICAgICAgICAgICAgICAgdmFyIHRlbXBTZXJpZXNWYWx1ZXMgPSBuZXcgTWFwKCk7CiAgICAgICAgICAgICAgICAgICAgZGF0YS5mb3JFYWNoKGZ1bmN0aW9uIChpdGVtKSB7CiAgICAgICAgICAgICAgICAgICAgICB2YXIgdGVtcENoYXJ0U2V0RGF0YUl0ZW0gPSB7fTsgLy8g5bqP5YiX5bGe5oCn5LiN5a2Y5ZyoCgogICAgICAgICAgICAgICAgICAgICAgaWYgKCFzaW5nbGVTZXJpZXMuc2VyaWVzSWRGaWVsZCkgewogICAgICAgICAgICAgICAgICAgICAgICBPYmplY3QuYXNzaWduKHRlbXBDaGFydFNldERhdGFJdGVtLCB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgbmFtZTogc2luZ2xlU2VyaWVzLm5hbWUKICAgICAgICAgICAgICAgICAgICAgICAgfSk7CgogICAgICAgICAgICAgICAgICAgICAgICBpZiAoc2luZ2xlU2VyaWVzLmRhdGFTZXRGaWVsZHMgJiYgc2luZ2xlU2VyaWVzLmRhdGFTZXRGaWVsZHMubGVuZ3RoID4gMCkgewogICAgICAgICAgICAgICAgICAgICAgICAgIHNpbmdsZVNlcmllcy5kYXRhU2V0RmllbGRzLmZvckVhY2goZnVuY3Rpb24gKHNpbmdsZURhdGFTZXRGaWVsZCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgX3RoaXM2LmhhbmRsZVNpbmdsZURhdGFTZXRGaWVsZChpdGVtLCBzaW5nbGVEYXRhU2V0RmllbGQsIGFsbENvZGVMaXN0LCB0ZW1wQ2hhcnRTZXREYXRhSXRlbSwgZ3JvdXBGaWVsZCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgIC8vIOW6j+WIl+WxnuaAp+WtmOWcqOaXtgogICAgICAgICAgICAgICAgICAgICAgICAvLyDluo/liJfku6PnoIHooajlrZjlnKjml7Ys57+76K+RdGVtcFNlcmllc1ZhbHVlc+eahOmUruWAvOWvuQogICAgICAgICAgICAgICAgICAgICAgICBpZiAoc2luZ2xlU2VyaWVzLnNlcmllc0NvZGVMaXN0KSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHNlcmllc0NvZGVMaXN0ID0gYWxsQ29kZUxpc3QuZ2V0KHNpbmdsZVNlcmllcy5zZXJpZXNDb2RlTGlzdC50YWcpOwogICAgICAgICAgICAgICAgICAgICAgICAgIHZhciB0ZW1wU2VyaWVzVmFsdWVJdGVtID0gdGVtcFNlcmllc1ZhbHVlcy5nZXQoc2VyaWVzQ29kZUxpc3QuZ2V0KGl0ZW1bc2luZ2xlU2VyaWVzLnNlcmllc0lkRmllbGRdKSk7CgogICAgICAgICAgICAgICAgICAgICAgICAgIGlmICghdGVtcFNlcmllc1ZhbHVlSXRlbSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgdGVtcFNlcmllc1ZhbHVlcy5zZXQoc2VyaWVzQ29kZUxpc3QuZ2V0KGl0ZW1bc2luZ2xlU2VyaWVzLnNlcmllc0lkRmllbGRdKSwgc2VyaWVzQ29kZUxpc3QuZ2V0KGl0ZW1bc2luZ2xlU2VyaWVzLnNlcmllc0lkRmllbGRdKSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBfdGVtcFNlcmllc1ZhbHVlSXRlbSA9IHRlbXBTZXJpZXNWYWx1ZXMuZ2V0KGl0ZW1bc2luZ2xlU2VyaWVzLnNlcmllc0lkRmllbGRdKTsKCiAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCFfdGVtcFNlcmllc1ZhbHVlSXRlbSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgdGVtcFNlcmllc1ZhbHVlcy5zZXQoaXRlbVtzaW5nbGVTZXJpZXMuc2VyaWVzSWRGaWVsZF0sIGl0ZW1bc2luZ2xlU2VyaWVzLnNlcmllc05hbWVGaWVsZF0pOwogICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICAgICAgT2JqZWN0LmFzc2lnbih0ZW1wQ2hhcnRTZXREYXRhSXRlbSwgewogICAgICAgICAgICAgICAgICAgICAgICAgIG5hbWU6IGl0ZW1bc2luZ2xlU2VyaWVzLnNlcmllc0lkRmllbGRdCiAgICAgICAgICAgICAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHNpbmdsZVNlcmllcy5kYXRhU2V0RmllbGRzICYmIHNpbmdsZVNlcmllcy5kYXRhU2V0RmllbGRzLmxlbmd0aCA+IDApIHsKICAgICAgICAgICAgICAgICAgICAgICAgICBzaW5nbGVTZXJpZXMuZGF0YVNldEZpZWxkcy5mb3JFYWNoKGZ1bmN0aW9uIChzaW5nbGVEYXRhU2V0RmllbGQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIF90aGlzNi5oYW5kbGVTaW5nbGVEYXRhU2V0RmllbGQoaXRlbSwgc2luZ2xlRGF0YVNldEZpZWxkLCBhbGxDb2RlTGlzdCwgdGVtcENoYXJ0U2V0RGF0YUl0ZW0sIGdyb3VwRmllbGQpOwogICAgICAgICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgICAgdGVtcENoYXJ0U2V0RGF0YS5wdXNoKHRlbXBDaGFydFNldERhdGFJdGVtKTsKICAgICAgICAgICAgICAgICAgICB9KTsgLy8g6KGl5YWo5pWw5o2u6ZuG5ZCICgogICAgICAgICAgICAgICAgICAgIF90aGlzNi5jb21wbGV0ZURhdGFTZXQodGVtcENoYXJ0U2V0RGF0YSwgc2luZ2xlU2VyaWVzLCBhbGxDb2RlTGlzdCk7IC8vIOW6j+WIl+S7o+eggeihqOWtmOWcqOaXtizooaXlhajluo/liJcKCgogICAgICAgICAgICAgICAgICAgIGlmIChzaW5nbGVTZXJpZXMuc2VyaWVzQ29kZUxpc3QpIHsKICAgICAgICAgICAgICAgICAgICAgIHZhciBzZXJpZXNDb2RlTGlzdCA9IGFsbENvZGVMaXN0LmdldChzaW5nbGVTZXJpZXMuc2VyaWVzQ29kZUxpc3QudGFnKTsKICAgICAgICAgICAgICAgICAgICAgIHRlbXBTZXJpZXNWYWx1ZXMgPSBuZXcgTWFwKCk7CiAgICAgICAgICAgICAgICAgICAgICBzZXJpZXNDb2RlTGlzdC5mb3JFYWNoKGZ1bmN0aW9uIChpdGVtKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHRlbXBTZXJpZXNWYWx1ZXMuc2V0KGl0ZW0sIGl0ZW0pOwogICAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICBzaW5nbGVTZXJpZXMuc2VyaWVzVmFsdWVzID0gX3RvQ29uc3VtYWJsZUFycmF5KHRlbXBTZXJpZXNWYWx1ZXMua2V5cygpKTsKICAgICAgICAgICAgICAgICAgICB2YXIgdGVtcFNlcmllc01hcE9iaiA9IHt9OwogICAgICAgICAgICAgICAgICAgIHRlbXBTZXJpZXNWYWx1ZXMuZm9yRWFjaChmdW5jdGlvbiAodmFsdWUsIGtleSkgewogICAgICAgICAgICAgICAgICAgICAgdGVtcFNlcmllc01hcE9ialtrZXldID0gdmFsdWU7CiAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgc2luZ2xlU2VyaWVzLnNlcmllc01hcCA9IHRlbXBTZXJpZXNNYXBPYmo7CiAgICAgICAgICAgICAgICAgICAgdmFyIGNhbGxiYWNrRnVuY3Rpb24gPSBpbmRleCA9PT0gT2JqZWN0LnZhbHVlcyhfdGhpczYuc2VyaWVzTW9kZWwpLmxlbmd0aCAtIDEgPyBjYWxsYmFjayA6IG51bGw7CgogICAgICAgICAgICAgICAgICAgIF90aGlzNi50cmFuc2Zvcm1Ub0NoYXJ0U2VyaWVzRGF0YVNldCh0ZW1wQ2hhcnRTZXREYXRhLCBzaW5nbGVTZXJpZXMsIGNhbGxiYWNrRnVuY3Rpb24sIGFsbENvZGVMaXN0KTsKICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgIGNhc2UgODoKICAgICAgICAgICAgICBjYXNlICJlbmQiOgogICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0LnN0b3AoKTsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0sIF9jYWxsZWUsIHRoaXMpOwogICAgICB9KSk7CgogICAgICBmdW5jdGlvbiB0cmFuc2Zvcm1Ub0Jhc2ljQ2hhcnRTZXREYXRhKF94LCBfeDIpIHsKICAgICAgICByZXR1cm4gX3RyYW5zZm9ybVRvQmFzaWNDaGFydFNldERhdGEuYXBwbHkodGhpcywgYXJndW1lbnRzKTsKICAgICAgfQoKICAgICAgcmV0dXJuIHRyYW5zZm9ybVRvQmFzaWNDaGFydFNldERhdGE7CiAgICB9KCkKICAgIC8qKg0KICAgICAqIOaehOW7uuWbvuihqOW6j+WIl+aVsOaNrumbhuWQiA0KICAgICAqDQogICAgICogMS7liIbnu4TmsYLlkowNCiAgICAgKiAyLuaOkuW6j+axguWSjOaVsOe7hA0KICAgICAqDQogICAgICogQHBhcmFtIHtBcnJheTxhbnk+fSBkYXRhIOS8oOWFpeaVsOaNrg0KICAgICAqIEBwYXJhbSB7QXJyYXk8YW55Pn0gaXRlbSDljZXkuKrluo/liJcNCiAgICAgKiBAcGFyYW0ge0FycmF5PGFueT59IGNhbGxiYWNrIOWbnuiwgw0KICAgICAqIEBwYXJhbSB7Kn0gYWxsQ29kZUxpc3Qg5omA5pyJ5Luj56CB6KGoDQogICAgICoNCiAgICAgKiBAbWVtYmVyb2YgRGJfc3lzcG9ydGxldDVfY2hhcnRCYXNlDQogICAgICovCgogIH0sIHsKICAgIGtleTogInRyYW5zZm9ybVRvQ2hhcnRTZXJpZXNEYXRhU2V0IiwKICAgIHZhbHVlOiBmdW5jdGlvbiB0cmFuc2Zvcm1Ub0NoYXJ0U2VyaWVzRGF0YVNldChkYXRhLCBpdGVtLCBjYWxsYmFjaywgYWxsQ29kZUxpc3QpIHsKICAgICAgaWYgKGl0ZW0uc2VyaWVzSWRGaWVsZCkgewogICAgICAgIC8vIOWkmuW6j+WIlwogICAgICAgIHZhciBncm91cEZpZWxkID0gaXRlbS5kYXRhU2V0RmllbGRzLmZpbHRlcihmdW5jdGlvbiAoZGF0YXNldEZpZWxkKSB7CiAgICAgICAgICByZXR1cm4gZGF0YXNldEZpZWxkLm5hbWUgPT09IGl0ZW0uY2F0ZWdvckZpZWxkOwogICAgICAgIH0pOwogICAgICAgIHZhciB0ZW1wR3JvdXBGaWVsZCA9IGdyb3VwRmllbGQubWFwKGZ1bmN0aW9uIChpdGVtKSB7CiAgICAgICAgICByZXR1cm4gaXRlbS5uYW1lOwogICAgICAgIH0pOwogICAgICAgIHZhciBzZXJpZXNGaWVsZCA9IGl0ZW0uZGF0YVNldEZpZWxkcy5maWx0ZXIoZnVuY3Rpb24gKGRhdGFzZXRGaWVsZCkgewogICAgICAgICAgcmV0dXJuIGRhdGFzZXRGaWVsZC5uYW1lID09PSBpdGVtLnNlcmllc0lkRmllbGQ7CiAgICAgICAgfSk7CiAgICAgICAgdmFyIHRlbXBTZXJpZXNGaWVsZCA9IHNlcmllc0ZpZWxkLm1hcChmdW5jdGlvbiAoaXRlbSkgewogICAgICAgICAgcmV0dXJuIGl0ZW0ubmFtZTsKICAgICAgICB9KTsKICAgICAgICB2YXIgdmFsdWVGaWVsZCA9IGl0ZW0uZGF0YVNldEZpZWxkcy5maWx0ZXIoZnVuY3Rpb24gKGRhdGFzZXRGaWVsZCkgewogICAgICAgICAgcmV0dXJuIGRhdGFzZXRGaWVsZC5uYW1lID09PSBpdGVtLnZhbHVlRmllbGQ7CiAgICAgICAgfSk7CiAgICAgICAgdmFyIHRlbXBWYWx1ZUZpZWxkID0gdmFsdWVGaWVsZC5tYXAoZnVuY3Rpb24gKGl0ZW0pIHsKICAgICAgICAgIHJldHVybiBpdGVtLm5hbWU7CiAgICAgICAgfSk7CiAgICAgICAgaXRlbS5kYXRhID0gdGhpcy5ncm91cEFuZEFkZCh0ZW1wR3JvdXBGaWVsZCwgdGVtcFNlcmllc0ZpZWxkLCB0ZW1wVmFsdWVGaWVsZCwgZGF0YSwgaXRlbSwgZ3JvdXBGaWVsZCwgYWxsQ29kZUxpc3QpOwogICAgICB9IGVsc2UgewogICAgICAgIC8v5Y2V5bqP5YiXCiAgICAgICAgdmFyIF9ncm91cEZpZWxkID0gaXRlbS5kYXRhU2V0RmllbGRzLmZpbHRlcihmdW5jdGlvbiAoZGF0YXNldEZpZWxkKSB7CiAgICAgICAgICByZXR1cm4gZGF0YXNldEZpZWxkLm5hbWUgPT09IGl0ZW0uY2F0ZWdvckZpZWxkOwogICAgICAgIH0pOwoKICAgICAgICB2YXIgX3RlbXBHcm91cEZpZWxkID0gX2dyb3VwRmllbGQubWFwKGZ1bmN0aW9uIChpdGVtKSB7CiAgICAgICAgICByZXR1cm4gaXRlbS5uYW1lOwogICAgICAgIH0pOwoKICAgICAgICB2YXIgX3ZhbHVlRmllbGQgPSBpdGVtLmRhdGFTZXRGaWVsZHMuZmlsdGVyKGZ1bmN0aW9uIChkYXRhc2V0RmllbGQpIHsKICAgICAgICAgIHJldHVybiBkYXRhc2V0RmllbGQubmFtZSA9PT0gaXRlbS52YWx1ZUZpZWxkOwogICAgICAgIH0pOwoKICAgICAgICB2YXIgX3RlbXBWYWx1ZUZpZWxkID0gX3ZhbHVlRmllbGQubWFwKGZ1bmN0aW9uIChpdGVtKSB7CiAgICAgICAgICByZXR1cm4gaXRlbS5uYW1lOwogICAgICAgIH0pOwoKICAgICAgICBpdGVtLmRhdGEgPSB0aGlzLmdyb3VwQW5kQWRkKF90ZW1wR3JvdXBGaWVsZCwgW10sIF90ZW1wVmFsdWVGaWVsZCwgZGF0YSwgaXRlbSwgX2dyb3VwRmllbGQsIGFsbENvZGVMaXN0KTsKICAgICAgfQoKICAgICAgaWYgKGNhbGxiYWNrICYmIGNhbGxiYWNrIGluc3RhbmNlb2YgRnVuY3Rpb24pIHsKICAgICAgICBjYWxsYmFjayhhbGxDb2RlTGlzdCk7CiAgICAgIH0KICAgIH0KICAgIC8qKg0KICAgICAqIOWIhue7hOWSjOaxguWSjA0KICAgICAqIEBwYXJhbSB7QXJyYXk8YW55Pn0gZ3JvdXBGaWVsZCDliIbnu4TlsZ7mgKcNCiAgICAgKiBAcGFyYW0ge0FycmF5PGFueT59IGdyb3VwRmllbGQg5YC85bGe5oCnDQogICAgICogQHBhcmFtIHtBcnJheTxhbnk+fSBkYXRhIOS8oOWFpeaVsOaNrg0KICAgICAqIEBwYXJhbSB7Kn0gZ3JvdXBGaWVsZE1vZGVsIOWIhue7hOWxnuaAp+aooeWeiw0KICAgICAqIEBwYXJhbSB7Kn0gYWxsQ29kZUxpc3Qg5omA5pyJ5Luj56CB6KGoDQogICAgICoNCiAgICAgKiBAbWVtYmVyb2YgRGJfc3lzcG9ydGxldDVfY2hhcnRCYXNlDQogICAgICovCgogIH0sIHsKICAgIGtleTogImdyb3VwQW5kQWRkIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBncm91cEFuZEFkZChncm91cEZpZWxkLCBzZXJpZXNGaWVsZCwgdmFsdWVGaWVsZCwgZGF0YSwgaXRlbSwgZ3JvdXBGaWVsZE1vZGVsLCBhbGxDb2RlTGlzdCkgewogICAgICB2YXIgdGVtcE1hcCA9IG5ldyBNYXAoKTsKICAgICAgdmFyIGdyb3VwTW9kZSA9IGdyb3VwRmllbGRNb2RlbFswXS5ncm91cE1vZGU7CiAgICAgIHZhciBncm91cEtleVN0ciA9ICIiOwogICAgICBkYXRhLmZvckVhY2goZnVuY3Rpb24gKGl0ZW0pIHsKICAgICAgICB2YXIgdGVtcEdyb3VwRmllbGQgPSBncm91cEZpZWxkWzBdOwogICAgICAgIGdyb3VwS2V5U3RyID0gaXRlbVt0ZW1wR3JvdXBGaWVsZF07CiAgICAgICAgdmFyIHRlbXBNYXBJdGVtID0gdGVtcE1hcC5nZXQoZ3JvdXBLZXlTdHIpOwoKICAgICAgICBpZiAodGVtcE1hcEl0ZW0pIHsKICAgICAgICAgIHRlbXBNYXBJdGVtLnB1c2goaXRlbSk7CiAgICAgICAgICB0ZW1wTWFwLnNldChncm91cEtleVN0ciwgdGVtcE1hcEl0ZW0pOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICB0ZW1wTWFwLnNldChncm91cEtleVN0ciwgW2l0ZW1dKTsKICAgICAgICB9CiAgICAgIH0pOyAvLyDlpITnkIblpJrluo/liJcKCiAgICAgIGlmIChzZXJpZXNGaWVsZC5sZW5ndGggPiAwICYmIHRlbXBNYXAuc2l6ZSA+IDApIHsKICAgICAgICB2YXIgdGVtcFNlcmllc0ZpZWxkID0gc2VyaWVzRmllbGRbMF07CiAgICAgICAgdGVtcE1hcC5mb3JFYWNoKGZ1bmN0aW9uIChpdGVtLCBrZXkpIHsKICAgICAgICAgIHZhciB0ZW1wSXRlbU1hcCA9IG5ldyBNYXAoKTsKICAgICAgICAgIGl0ZW0uZm9yRWFjaChmdW5jdGlvbiAoc2luZ2xlSXRlbSkgewogICAgICAgICAgICB2YXIgc2VyaWVzVmFsdWVBcnJheSA9IHRlbXBJdGVtTWFwLmdldChzaW5nbGVJdGVtW3RlbXBTZXJpZXNGaWVsZF0pOwoKICAgICAgICAgICAgaWYgKHNlcmllc1ZhbHVlQXJyYXkpIHsKICAgICAgICAgICAgICBzZXJpZXNWYWx1ZUFycmF5LnB1c2goc2luZ2xlSXRlbSk7CiAgICAgICAgICAgICAgdGVtcEl0ZW1NYXAuc2V0KHNpbmdsZUl0ZW1bdGVtcFNlcmllc0ZpZWxkXSwgc2VyaWVzVmFsdWVBcnJheSk7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgdGVtcEl0ZW1NYXAuc2V0KHNpbmdsZUl0ZW1bdGVtcFNlcmllc0ZpZWxkXSwgW3NpbmdsZUl0ZW1dKTsKICAgICAgICAgICAgfQogICAgICAgICAgfSk7CiAgICAgICAgICB0ZW1wTWFwLnNldChrZXksIHRlbXBJdGVtTWFwKTsKICAgICAgICB9KTsKICAgICAgfQoKICAgICAgdmFyIHJldHVybkFycmF5ID0gW107CgogICAgICBpZiAoc2VyaWVzRmllbGQubGVuZ3RoID09IDApIHsKICAgICAgICAvL+WNleW6j+WIlwogICAgICAgIHRlbXBNYXAuZm9yRWFjaChmdW5jdGlvbiAodGVtcEl0ZW0pIHsKICAgICAgICAgIGlmICh0ZW1wSXRlbS5sZW5ndGggPiAwKSB7CiAgICAgICAgICAgIHZhciBjdXJPYmplY3QgPSB7fTsKICAgICAgICAgICAgdmFyIHZhbHVlUmVzdWx0ID0gMDsKICAgICAgICAgICAgdmFyIGNhdGVnb3JSZXN1bHQ7CiAgICAgICAgICAgIHRlbXBJdGVtLmZvckVhY2goZnVuY3Rpb24gKHNpbmdsZUl0ZW0pIHsKICAgICAgICAgICAgICBjYXRlZ29yUmVzdWx0ID0gc2luZ2xlSXRlbVtncm91cEZpZWxkWzBdXTsKICAgICAgICAgICAgICB2YWx1ZVJlc3VsdCArPSBzaW5nbGVJdGVtW3ZhbHVlRmllbGRbMF1dOwogICAgICAgICAgICB9KTsKICAgICAgICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KGN1ck9iamVjdCwgZ3JvdXBGaWVsZFswXSwgewogICAgICAgICAgICAgIHZhbHVlOiBjYXRlZ29yUmVzdWx0LAogICAgICAgICAgICAgIHdyaXRhYmxlOiB0cnVlLAogICAgICAgICAgICAgIGVudW1lcmFibGU6IHRydWUsCiAgICAgICAgICAgICAgY29uZmlndXJhYmxlOiB0cnVlCiAgICAgICAgICAgIH0pOwogICAgICAgICAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkoY3VyT2JqZWN0LCB2YWx1ZUZpZWxkWzBdLCB7CiAgICAgICAgICAgICAgdmFsdWU6IHZhbHVlUmVzdWx0LAogICAgICAgICAgICAgIHdyaXRhYmxlOiB0cnVlLAogICAgICAgICAgICAgIGVudW1lcmFibGU6IHRydWUsCiAgICAgICAgICAgICAgY29uZmlndXJhYmxlOiB0cnVlCiAgICAgICAgICAgIH0pOwogICAgICAgICAgICByZXR1cm5BcnJheS5wdXNoKGN1ck9iamVjdCk7CiAgICAgICAgICB9CiAgICAgICAgfSk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgLy8g5aSa5bqP5YiXCiAgICAgICAgdmFyIHNlcmllc1ZhbHVlc0FycmF5ID0gaXRlbS5zZXJpZXNWYWx1ZXM7CiAgICAgICAgdGVtcE1hcC5mb3JFYWNoKGZ1bmN0aW9uIChncm91cEl0ZW0sIGdyb3VwS2V5KSB7CiAgICAgICAgICAvL+axguWSjAogICAgICAgICAgdmFyIGN1ck9iamVjdCA9IHt9OwogICAgICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KGN1ck9iamVjdCwgZ3JvdXBGaWVsZFswXSwgewogICAgICAgICAgICB2YWx1ZTogZ3JvdXBLZXksCiAgICAgICAgICAgIHdyaXRhYmxlOiB0cnVlLAogICAgICAgICAgICBlbnVtZXJhYmxlOiB0cnVlLAogICAgICAgICAgICBjb25maWd1cmFibGU6IHRydWUKICAgICAgICAgIH0pOwogICAgICAgICAgc2VyaWVzVmFsdWVzQXJyYXkuZm9yRWFjaChmdW5jdGlvbiAoc2VyaWVzVmFsdWVJdGVtKSB7CiAgICAgICAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShjdXJPYmplY3QsIHNlcmllc1ZhbHVlSXRlbSwgewogICAgICAgICAgICAgIHZhbHVlOiAwLAogICAgICAgICAgICAgIHdyaXRhYmxlOiB0cnVlLAogICAgICAgICAgICAgIGVudW1lcmFibGU6IHRydWUsCiAgICAgICAgICAgICAgY29uZmlndXJhYmxlOiB0cnVlCiAgICAgICAgICAgIH0pOwogICAgICAgICAgfSk7CiAgICAgICAgICBncm91cEl0ZW0uZm9yRWFjaChmdW5jdGlvbiAoc2VyaWVzSXRlbSwgc2VyaWVzS2V5KSB7CiAgICAgICAgICAgIHZhciBzZXJpZXNOdW0gPSAwOwogICAgICAgICAgICBzZXJpZXNJdGVtLmZvckVhY2goZnVuY3Rpb24gKGRhdGFJdGVtKSB7CiAgICAgICAgICAgICAgc2VyaWVzTnVtICs9IGRhdGFJdGVtW3ZhbHVlRmllbGRbMF1dOwogICAgICAgICAgICB9KTsKICAgICAgICAgICAgY3VyT2JqZWN0W3Nlcmllc0tleV0gPSBzZXJpZXNOdW07CiAgICAgICAgICB9KTsKICAgICAgICAgIHJldHVybkFycmF5LnB1c2goY3VyT2JqZWN0KTsKICAgICAgICB9KTsKICAgICAgfSAvLyDooaXlhajnqbrnmb3liIbnsbsKCgogICAgICBpZiAocmV0dXJuQXJyYXkubGVuZ3RoID4gMCkgewogICAgICAgIHZhciBlbXB0eVRleHQgPSBncm91cEZpZWxkTW9kZWxbMF0gJiYgZ3JvdXBGaWVsZE1vZGVsWzBdLmNvZGVMaXN0ID8gZ3JvdXBGaWVsZE1vZGVsWzBdLmNvZGVMaXN0LmVtcHR5dGV4dCA6ICLmnKrlrprkuYkiOwogICAgICAgIHJldHVybkFycmF5LmZvckVhY2goZnVuY3Rpb24gKGl0ZW0pIHsKICAgICAgICAgIGlmICghaXRlbVtncm91cEZpZWxkWzBdXSkgewogICAgICAgICAgICBpdGVtW2dyb3VwRmllbGRbMF1dID0gZW1wdHlUZXh0OwogICAgICAgICAgfQogICAgICAgIH0pOwogICAgICB9CgogICAgICByZXR1cm5BcnJheSA9IHRoaXMuc29ydFJldHVybkFycmF5KHJldHVybkFycmF5LCBncm91cEZpZWxkTW9kZWwsIGFsbENvZGVMaXN0KTsgLy8g6Zu36L6+5Zu+5pWw5o2u5qC85byP5aSE55CGCgogICAgICBpZiAoT2JqZWN0LmlzKGl0ZW0udHlwZSwgJ3JhZGFyJykgJiYgcmV0dXJuQXJyYXkubGVuZ3RoID4gMCkgewogICAgICAgIHZhciB0ZW1wUmV0dXJuQXJyYXkgPSBbXTsKICAgICAgICB2YXIgc2VyaWVzVmFsdWVzID0gaXRlbS5zZXJpZXNWYWx1ZXM7CgogICAgICAgIGlmIChzZXJpZXNWYWx1ZXMgJiYgc2VyaWVzVmFsdWVzLmxlbmd0aCA+IDApIHsKICAgICAgICAgIHNlcmllc1ZhbHVlcy5mb3JFYWNoKGZ1bmN0aW9uIChzaW5nbGVTZXJpZXNOYW1lKSB7CiAgICAgICAgICAgIHZhciBzaW5nbGVTZXJpZXNPYmogPSB7fTsKICAgICAgICAgICAgcmV0dXJuQXJyYXkuZm9yRWFjaChmdW5jdGlvbiAoaXRlbSkgewogICAgICAgICAgICAgIE9iamVjdC5hc3NpZ24oc2luZ2xlU2VyaWVzT2JqLCBfZGVmaW5lUHJvcGVydHkoe30sIGl0ZW1bZ3JvdXBGaWVsZFswXV0sIGl0ZW1bc2luZ2xlU2VyaWVzTmFtZV0pKTsKICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIE9iamVjdC5hc3NpZ24oc2luZ2xlU2VyaWVzT2JqLCB7CiAgICAgICAgICAgICAgdHlwZTogc2luZ2xlU2VyaWVzTmFtZQogICAgICAgICAgICB9KTsKICAgICAgICAgICAgdGVtcFJldHVybkFycmF5LnB1c2goc2luZ2xlU2VyaWVzT2JqKTsKICAgICAgICAgIH0pOwogICAgICAgIH0KCiAgICAgICAgcmV0dXJuQXJyYXkgPSB0ZW1wUmV0dXJuQXJyYXk7CiAgICAgIH0KCiAgICAgIGNvbnNvbGUubG9nKEpTT04uc3RyaW5naWZ5KHJldHVybkFycmF5KSk7CiAgICAgIHJldHVybiByZXR1cm5BcnJheTsKICAgIH0KICAgIC8qKg0KICAgICAqIOaOkuW6j+aVsOe7hA0KICAgICAqDQogICAgICogQHBhcmFtIHtBcnJheTxhbnk+fSBhcnIg5Lyg5YWl5pWw57uEDQogICAgICogQHBhcmFtIHsqfSBncm91cEZpZWxkIOWIhue7hOWxnuaApw0KICAgICAqIEBwYXJhbSB7Kn0gYWxsQ29kZUxpc3Qg5omA5pyJ5Luj56CB6KGoDQogICAgICoNCiAgICAgKiBAbWVtYmVyb2YgRGJfc3lzcG9ydGxldDVfY2hhcnRCYXNlDQogICAgICovCgogIH0sIHsKICAgIGtleTogInNvcnRSZXR1cm5BcnJheSIsCiAgICB2YWx1ZTogZnVuY3Rpb24gc29ydFJldHVybkFycmF5KGFyciwgZ3JvdXBGaWVsZCwgYWxsQ29kZUxpc3QpIHsKICAgICAgdmFyIHJldHVybkFycmF5ID0gW107IC8vIHRvZG8KICAgICAgLy8g5YiG57uE5bGe5oCn5pyJ5Luj56CB6KGo55qE5oOF5Ya1KOacgOWQjuaJp+ihjCkKCiAgICAgIGlmIChncm91cEZpZWxkWzBdLmNvZGVsaXN0KSB7CiAgICAgICAgdmFyIGN1ckNvZGVMaXN0ID0gYWxsQ29kZUxpc3QuZ2V0KGdyb3VwRmllbGRbMF0uY29kZWxpc3QudGFnKTsKICAgICAgICBjdXJDb2RlTGlzdC5mb3JFYWNoKGZ1bmN0aW9uIChjb2RlbGlzdCkgewogICAgICAgICAgYXJyLmZvckVhY2goZnVuY3Rpb24gKGl0ZW0pIHsKICAgICAgICAgICAgaWYgKE9iamVjdC5pcyhpdGVtW2dyb3VwRmllbGRbMF0ubmFtZV0sIGNvZGVsaXN0KSkgewogICAgICAgICAgICAgIHJldHVybkFycmF5LnB1c2goaXRlbSk7CiAgICAgICAgICAgICAgaXRlbS5oYXN1c2VkID0gdHJ1ZTsKICAgICAgICAgICAgfQogICAgICAgICAgfSk7CiAgICAgICAgfSk7CiAgICAgICAgYXJyLmZvckVhY2goZnVuY3Rpb24gKGl0ZW0sIGluZGV4KSB7CiAgICAgICAgICBpZiAoIWl0ZW0uaGFzdXNlZCkgewogICAgICAgICAgICByZXR1cm5BcnJheS5wdXNoKGl0ZW0pOwogICAgICAgICAgfQogICAgICAgIH0pOwogICAgICAgIHJldHVybkFycmF5LmZvckVhY2goZnVuY3Rpb24gKGl0ZW0pIHsKICAgICAgICAgIGRlbGV0ZSBpdGVtLmhhc3VzZWQ7CiAgICAgICAgfSk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgLy8g5YiG57uE5Li65bm05Lu9CiAgICAgICAgaWYgKE9iamVjdC5pcyhncm91cEZpZWxkWzBdLmdyb3VwTW9kZSwgIllFQVIiKSkgewogICAgICAgICAgcmV0dXJuQXJyYXkgPSBhcnIuc29ydChmdW5jdGlvbiAoYSwgYikgewogICAgICAgICAgICByZXR1cm4gTnVtYmVyKGFbZ3JvdXBGaWVsZFswXS5uYW1lXSkgLSBOdW1iZXIoYltncm91cEZpZWxkWzBdLm5hbWVdKTsKICAgICAgICAgIH0pOwogICAgICAgIH0gZWxzZSBpZiAoT2JqZWN0LmlzKGdyb3VwRmllbGRbMF0uZ3JvdXBNb2RlLCAiUVVBUlRFUiIpKSB7CiAgICAgICAgICByZXR1cm5BcnJheSA9IHRoaXMuaGFuZGxlU29ydEdyb3VwRGF0YShhcnIsIGdyb3VwRmllbGQsICLlraPluqYiKTsKICAgICAgICB9IGVsc2UgaWYgKE9iamVjdC5pcyhncm91cEZpZWxkWzBdLmdyb3VwTW9kZSwgIk1PTlRIIikpIHsKICAgICAgICAgIHJldHVybkFycmF5ID0gdGhpcy5oYW5kbGVTb3J0R3JvdXBEYXRhKGFyciwgZ3JvdXBGaWVsZCwgIuaciCIpOwogICAgICAgIH0gZWxzZSBpZiAoT2JqZWN0LmlzKGdyb3VwRmllbGRbMF0uZ3JvdXBNb2RlLCAiWUVBUldFRUsiKSkgewogICAgICAgICAgcmV0dXJuQXJyYXkgPSB0aGlzLmhhbmRsZVNvcnRHcm91cERhdGEoYXJyLCBncm91cEZpZWxkLCAi5ZGoIik7CiAgICAgICAgfSBlbHNlIGlmIChPYmplY3QuaXMoZ3JvdXBGaWVsZFswXS5ncm91cE1vZGUsICJEQVkiKSkgewogICAgICAgICAgcmV0dXJuQXJyYXkgPSBhcnIuc29ydChmdW5jdGlvbiAoYSwgYikgewogICAgICAgICAgICByZXR1cm4gbW9tZW50KGFbZ3JvdXBGaWVsZFswXS5uYW1lXSkudW5peCgpIC0gbW9tZW50KGJbZ3JvdXBGaWVsZFswXS5uYW1lXSkudW5peCgpOwogICAgICAgICAgfSk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIHZhciBncm91cEZpZWxkTmFtZSA9IGdyb3VwRmllbGRbMF0ubmFtZTsKICAgICAgICAgIHZhciBpc0NvbnZlcnQgPSB0cnVlOwogICAgICAgICAgYXJyLmZvckVhY2goZnVuY3Rpb24gKGl0ZW0pIHsKICAgICAgICAgICAgaWYgKGlzTmFOKGl0ZW1bZ3JvdXBGaWVsZE5hbWVdKSkgewogICAgICAgICAgICAgIGlzQ29udmVydCA9IGZhbHNlOwogICAgICAgICAgICB9CiAgICAgICAgICB9KTsKCiAgICAgICAgICBpZiAoaXNDb252ZXJ0KSB7CiAgICAgICAgICAgIHJldHVybkFycmF5ID0gYXJyLnNvcnQoZnVuY3Rpb24gKGEsIGIpIHsKICAgICAgICAgICAgICByZXR1cm4gYVtncm91cEZpZWxkTmFtZV0gLSBiW2dyb3VwRmllbGROYW1lXTsKICAgICAgICAgICAgfSk7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICByZXR1cm5BcnJheSA9IGFycjsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KCiAgICAgIHJldHVybiByZXR1cm5BcnJheTsKICAgIH0KICAgIC8qKg0KICAgICAqIOaOkuW6j+WIhue7hOaooeW8j+S4i+eahOaVsOaNrg0KICAgICAqDQogICAgICogQHBhcmFtIHtBcnJheTxhbnk+fSBhcnIg5Lyg5YWl5pWw5o2uDQogICAgICogQHBhcmFtIHtBcnJheTxhbnk+fSBncm91cEZpZWxkIOWIhue7hOWxnuaApw0KICAgICAqIEBwYXJhbSB7QXJyYXk8YW55Pn0gbGFiZWwgbGFiZWzmoIfnrb4NCiAgICAgKg0KICAgICAqIEBtZW1iZXJvZiBEYl9zeXNwb3J0bGV0NV9jaGFydEJhc2UNCiAgICAgKi8KCiAgfSwgewogICAga2V5OiAiaGFuZGxlU29ydEdyb3VwRGF0YSIsCiAgICB2YWx1ZTogZnVuY3Rpb24gaGFuZGxlU29ydEdyb3VwRGF0YShhcnIsIGdyb3VwRmllbGQsIGxhYmVsKSB7CiAgICAgIGFyci5mb3JFYWNoKGZ1bmN0aW9uIChpdGVtKSB7CiAgICAgICAgdmFyIHNvcnRGaWVsZFZhbHVlID0gaXRlbVtncm91cEZpZWxkWzBdLm5hbWVdLnNwbGl0KCItIik7CiAgICAgICAgT2JqZWN0LmFzc2lnbihpdGVtLCB7CiAgICAgICAgICBzb3J0RmllbGQ6IE51bWJlcihzb3J0RmllbGRWYWx1ZVswXSkgKiAxMDAwMCArIE51bWJlcihzb3J0RmllbGRWYWx1ZVsxXSkKICAgICAgICB9KTsKICAgICAgICBpdGVtW2dyb3VwRmllbGRbMF0ubmFtZV0gPSBzb3J0RmllbGRWYWx1ZVswXSArICLlubQiICsgc29ydEZpZWxkVmFsdWVbMV0gKyBsYWJlbDsKICAgICAgfSk7CiAgICAgIGFyci5zb3J0KGZ1bmN0aW9uIChhLCBiKSB7CiAgICAgICAgcmV0dXJuIE51bWJlcihhLnNvcnRGaWVsZCkgLSBOdW1iZXIoYi5zb3J0RmllbGQpOwogICAgICB9KTsKICAgICAgYXJyLmZvckVhY2goZnVuY3Rpb24gKGl0ZW0pIHsKICAgICAgICBkZWxldGUgaXRlbS5zb3J0RmllbGQ7CiAgICAgIH0pOwogICAgICByZXR1cm4gYXJyOwogICAgfQogICAgLyoqDQogICAgICog6KGl5YWo5pWw5o2u6ZuGDQogICAgICoNCiAgICAgKiBAcGFyYW0ge0FycmF5PGFueT59IGRhdGEg5Lyg5YWl5pWw5o2uDQogICAgICogQHBhcmFtIHtBcnJheTxhbnk+fSBpdGVtIOWNleS4quW6j+WIlw0KICAgICAqIEBwYXJhbSB7QXJyYXk8YW55Pn0gYWxsQ29kZUxpc3Qg5omA5pyJ55qE5Luj56CB6KGoDQogICAgICoNCiAgICAgKiBAbWVtYmVyb2YgRGJfc3lzcG9ydGxldDVfY2hhcnRCYXNlDQogICAgICovCgogIH0sIHsKICAgIGtleTogImNvbXBsZXRlRGF0YVNldCIsCiAgICB2YWx1ZTogZnVuY3Rpb24gY29tcGxldGVEYXRhU2V0KGRhdGEsIGl0ZW0sIGFsbENvZGVMaXN0KSB7CiAgICAgIC8vIOWIhue7hOWxnuaApwogICAgICB2YXIgZ3JvdXBGaWVsZCA9IGl0ZW0uZGF0YVNldEZpZWxkcy5maW5kKGZ1bmN0aW9uIChkYXRhc2V0RmllbGQpIHsKICAgICAgICByZXR1cm4gZGF0YXNldEZpZWxkLm5hbWUgPT09IGl0ZW0uY2F0ZWdvckZpZWxkOwogICAgICB9KTsKCiAgICAgIGlmIChPYmplY3QuaXMoZ3JvdXBGaWVsZC5ncm91cE1vZGUsICIiKSkgewogICAgICAgIHJldHVybjsKICAgICAgfSAvL+WIhue7hOaooeW8j+S4uuS7o+eggeihqO+8iOihpeWAvO+8iQoKCiAgICAgIGlmIChPYmplY3QuaXMoZ3JvdXBGaWVsZC5ncm91cE1vZGUsICdDT0RFTElTVCcpKSB7CiAgICAgICAgdGhpcy5jb21wbGV0ZUNvZGVMaXN0KGRhdGEsIGl0ZW0sIGFsbENvZGVMaXN0KTsKICAgICAgfSAvL+WIhue7hOaooeW8j+S4uuW5tC/lraPluqYv5pyI5Lu977yI5pyA5aSn5YC877yM5pyA5bCP5YC877yM5YiG57uE77yM6KGl5YC877yJCgoKICAgICAgaWYgKE9iamVjdC5pcyhncm91cEZpZWxkLmdyb3VwTW9kZSwgIllFQVIiKSB8fCBPYmplY3QuaXMoZ3JvdXBGaWVsZC5ncm91cE1vZGUsICJRVUFSVEVSIikgfHwgT2JqZWN0LmlzKGdyb3VwRmllbGQuZ3JvdXBNb2RlLCAiTU9OVEgiKSB8fCBPYmplY3QuaXMoZ3JvdXBGaWVsZC5ncm91cE1vZGUsICJZRUFSV0VFSyIpIHx8IE9iamVjdC5pcyhncm91cEZpZWxkLmdyb3VwTW9kZSwgIkRBWSIpKSB7CiAgICAgICAgdGhpcy5oYW5kbGVUaW1lRGF0YShkYXRhLCBpdGVtLCBhbGxDb2RlTGlzdCwgZ3JvdXBGaWVsZCk7CiAgICAgIH0KICAgIH0KICAgIC8qKg0KICAgICAqIOiOt+WPluacgOWkp+WAvOacgOWwj+WAvA0KICAgICAqDQogICAgICogQHBhcmFtIHtBcnJheTxhbnk+fSB0ZW1wVGltZUFycmF5IOS8oOWFpeaVsOaNrg0KICAgICAqDQogICAgICogQG1lbWJlcm9mIERiX3N5c3BvcnRsZXQ1X2NoYXJ0QmFzZQ0KICAgICAqLwoKICB9LCB7CiAgICBrZXk6ICJnZXRSYW5nZURhdGEiLAogICAgdmFsdWU6IGZ1bmN0aW9uIGdldFJhbmdlRGF0YSh0ZW1wVGltZUFycmF5KSB7CiAgICAgIHRlbXBUaW1lQXJyYXkuZm9yRWFjaChmdW5jdGlvbiAoaXRlbSkgewogICAgICAgIHZhciB0ZW1wUGFyYW1zID0gaXRlbS5faS5zcGxpdCgiLSIpOwoKICAgICAgICBpdGVtLnNvcnRGaWVsZCA9IE51bWJlcih0ZW1wUGFyYW1zWzBdICsgdGVtcFBhcmFtc1sxXSk7CiAgICAgIH0pOwogICAgICB0ZW1wVGltZUFycmF5LnNvcnQoZnVuY3Rpb24gKGEsIGIpIHsKICAgICAgICByZXR1cm4gTnVtYmVyKGEuc29ydEZpZWxkKSAtIE51bWJlcihiLnNvcnRGaWVsZCk7CiAgICAgIH0pOwogICAgICB0ZW1wVGltZUFycmF5LmZvckVhY2goZnVuY3Rpb24gKGl0ZW0pIHsKICAgICAgICBkZWxldGUgaXRlbS5zb3J0RmllbGQ7CiAgICAgIH0pOwogICAgICByZXR1cm4gdGVtcFRpbWVBcnJheTsKICAgIH0KICAgIC8qKg0KICAgICAgKiDooaXlhajml7bpl7TnsbvlnovmlbDmja7pm4YNCiAgICAgICoNCiAgICAgICogQHBhcmFtIHtBcnJheTxhbnk+fSBkYXRhIOS8oOWFpeaVsOaNrg0KICAgICAgKiBAcGFyYW0ge0FycmF5PGFueT59IGl0ZW0g5Y2V5Liq5bqP5YiXDQogICAgICAqIEBwYXJhbSB7QXJyYXk8YW55Pn0gYWxsQ29kZUxpc3Qg5omA5pyJ55qE5Luj56CB6KGoDQogICAgICAqIEBwYXJhbSB7QXJyYXk8YW55Pn0gZ3JvdXBGaWVsZCDliIbnu4TlsZ7mgKcNCiAgICAgICoNCiAgICAgICogQG1lbWJlcm9mIERiX3N5c3BvcnRsZXQ1X2NoYXJ0QmFzZQ0KICAgICAgKi8KCiAgfSwgewogICAga2V5OiAiaGFuZGxlVGltZURhdGEiLAogICAgdmFsdWU6IGZ1bmN0aW9uIGhhbmRsZVRpbWVEYXRhKGRhdGEsIGl0ZW0sIGFsbENvZGVMaXN0LCBncm91cEZpZWxkKSB7CiAgICAgIHZhciB2YWx1ZUZpZWxkID0gaXRlbS5kYXRhU2V0RmllbGRzLmZpbmQoZnVuY3Rpb24gKGRhdGFzZXRGaWVsZCkgewogICAgICAgIHJldHVybiBkYXRhc2V0RmllbGQubmFtZSA9PT0gaXRlbS52YWx1ZUZpZWxkOwogICAgICB9KTsKICAgICAgdmFyIGdyb3VwTW9kZSA9IGdyb3VwRmllbGQuZ3JvdXBNb2RlOyAvLyDmjpLluo/mlbDmja7vvIzmib7liLDmnIDlpKflgLzjgIHmnIDlsI/lgLwKCiAgICAgIHZhciB0ZW1wVGltZUFycmF5ID0gW107CgogICAgICBpZiAoZGF0YSAmJiBkYXRhLmxlbmd0aCA+IDApIHsKICAgICAgICBkYXRhLmZvckVhY2goZnVuY3Rpb24gKGRhdGFJdGVtKSB7CiAgICAgICAgICAvLyDliKTmlq3ml7bpl7TnsbvlnovmmK/lkKbkuLrnqbrvvIzkuLrnqbrkuI3lpITnkIYKICAgICAgICAgIGlmIChkYXRhSXRlbVtncm91cEZpZWxkLm5hbWVdKSB7CiAgICAgICAgICAgIHRlbXBUaW1lQXJyYXkucHVzaChtb21lbnQoZGF0YUl0ZW1bZ3JvdXBGaWVsZC5uYW1lXSkpOwogICAgICAgICAgfQogICAgICAgIH0pOwogICAgICB9CgogICAgICB2YXIgbWF4VGltZTsKICAgICAgdmFyIG1pblRpbWU7CgogICAgICBpZiAoT2JqZWN0LmlzKGdyb3VwTW9kZSwgIllFQVIiKSB8fCBPYmplY3QuaXMoZ3JvdXBNb2RlLCAiREFZIikpIHsKICAgICAgICBtYXhUaW1lID0gbW9tZW50Lm1heCh0ZW1wVGltZUFycmF5KTsKICAgICAgICBtaW5UaW1lID0gbW9tZW50Lm1pbih0ZW1wVGltZUFycmF5KTsKICAgICAgfQoKICAgICAgaWYgKE9iamVjdC5pcyhncm91cE1vZGUsICJRVUFSVEVSIikpIHsKICAgICAgICB0ZW1wVGltZUFycmF5ID0gdGhpcy5nZXRSYW5nZURhdGEodGVtcFRpbWVBcnJheSk7CiAgICAgICAgbWluVGltZSA9IG1vbWVudCgpLnllYXIodGVtcFRpbWVBcnJheVswXS5faS5zcGxpdCgiLSIpWzBdKS5xdWFydGVycyh0ZW1wVGltZUFycmF5WzBdLl9pLnNwbGl0KCItIilbMV0pOwogICAgICAgIG1heFRpbWUgPSBtb21lbnQoKS55ZWFyKHRlbXBUaW1lQXJyYXlbdGVtcFRpbWVBcnJheS5sZW5ndGggLSAxXS5faS5zcGxpdCgiLSIpWzBdKS5xdWFydGVycyh0ZW1wVGltZUFycmF5W3RlbXBUaW1lQXJyYXkubGVuZ3RoIC0gMV0uX2kuc3BsaXQoIi0iKVsxXSk7CiAgICAgIH0KCiAgICAgIGlmIChPYmplY3QuaXMoZ3JvdXBNb2RlLCAiTU9OVEgiKSkgewogICAgICAgIHRlbXBUaW1lQXJyYXkgPSB0aGlzLmdldFJhbmdlRGF0YSh0ZW1wVGltZUFycmF5KTsKICAgICAgICBtaW5UaW1lID0gbW9tZW50KCkueWVhcih0ZW1wVGltZUFycmF5WzBdLl9pLnNwbGl0KCItIilbMF0pLm1vbnRoKHRlbXBUaW1lQXJyYXlbMF0uX2kuc3BsaXQoIi0iKVsxXSk7CiAgICAgICAgbWF4VGltZSA9IG1vbWVudCgpLnllYXIodGVtcFRpbWVBcnJheVt0ZW1wVGltZUFycmF5Lmxlbmd0aCAtIDFdLl9pLnNwbGl0KCItIilbMF0pLm1vbnRoKHRlbXBUaW1lQXJyYXlbdGVtcFRpbWVBcnJheS5sZW5ndGggLSAxXS5faS5zcGxpdCgiLSIpWzFdKTsKICAgICAgfQoKICAgICAgaWYgKE9iamVjdC5pcyhncm91cE1vZGUsICJZRUFSV0VFSyIpKSB7CiAgICAgICAgdGVtcFRpbWVBcnJheSA9IHRoaXMuZ2V0UmFuZ2VEYXRhKHRlbXBUaW1lQXJyYXkpOwogICAgICAgIG1pblRpbWUgPSBtb21lbnQoKS55ZWFyKHRlbXBUaW1lQXJyYXlbMF0uX2kuc3BsaXQoIi0iKVswXSkud2Vlayh0ZW1wVGltZUFycmF5WzBdLl9pLnNwbGl0KCItIilbMV0pOwogICAgICAgIG1heFRpbWUgPSBtb21lbnQoKS55ZWFyKHRlbXBUaW1lQXJyYXlbdGVtcFRpbWVBcnJheS5sZW5ndGggLSAxXS5faS5zcGxpdCgiLSIpWzBdKS53ZWVrKHRlbXBUaW1lQXJyYXlbdGVtcFRpbWVBcnJheS5sZW5ndGggLSAxXS5faS5zcGxpdCgiLSIpWzFdKTsKICAgICAgfQoKICAgICAgdmFyIHRpbWVGcmFnbWVudEFycmF5ID0gW107CiAgICAgIHZhciB0ZW1wR3JvdW5wRGF0YSA9IG5ldyBNYXAoKTsgLy8g5pe26Ze05YiG5q61CiAgICAgIC8vZ3JvdXBNb2Rl5Li6IllFQVIiCgogICAgICBpZiAoT2JqZWN0LmlzKGdyb3VwTW9kZSwgIllFQVIiKSkgewogICAgICAgIHZhciBjdXJUaW1lID0gbWluVGltZTsKCiAgICAgICAgd2hpbGUgKGN1clRpbWUpIHsKICAgICAgICAgIGlmIChjdXJUaW1lLmlzU2FtZU9yQmVmb3JlKG1heFRpbWUpKSB7CiAgICAgICAgICAgIHZhciB0ZW1wY3VyVGltZSA9IGN1clRpbWUuY2xvbmUoKTsKICAgICAgICAgICAgdGltZUZyYWdtZW50QXJyYXkucHVzaCh0ZW1wY3VyVGltZS55ZWFyKCkudG9TdHJpbmcoKSk7CiAgICAgICAgICAgIGN1clRpbWUgPSB0ZW1wY3VyVGltZS5jbG9uZSgpLmFkZCgxLCAneWVhcnMnKTsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIGN1clRpbWUgPSBudWxsOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfSAvL2dyb3VwTW9kZeS4uiJRVUFSVEVSIgoKCiAgICAgIGlmIChPYmplY3QuaXMoZ3JvdXBNb2RlLCAiUVVBUlRFUiIpKSB7CiAgICAgICAgdmFyIF9jdXJUaW1lID0gbWluVGltZTsKCiAgICAgICAgd2hpbGUgKF9jdXJUaW1lKSB7CiAgICAgICAgICBpZiAoX2N1clRpbWUuaXNTYW1lT3JCZWZvcmUobWF4VGltZSkpIHsKICAgICAgICAgICAgdmFyIF90ZW1wY3VyVGltZSA9IF9jdXJUaW1lLmNsb25lKCk7CgogICAgICAgICAgICB0aW1lRnJhZ21lbnRBcnJheS5wdXNoKF90ZW1wY3VyVGltZS55ZWFyKCkudG9TdHJpbmcoKSArICItIiArIF90ZW1wY3VyVGltZS5xdWFydGVyKCkudG9TdHJpbmcoKSk7CiAgICAgICAgICAgIF9jdXJUaW1lID0gX3RlbXBjdXJUaW1lLmNsb25lKCkuYWRkKDEsICdxdWFydGVycycpOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgX2N1clRpbWUgPSBudWxsOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfSAvL2dyb3VwTW9kZeS4uiJNT05USCIKCgogICAgICBpZiAoT2JqZWN0LmlzKGdyb3VwTW9kZSwgIk1PTlRIIikpIHsKICAgICAgICB2YXIgX2N1clRpbWUyID0gbWluVGltZTsKCiAgICAgICAgd2hpbGUgKF9jdXJUaW1lMikgewogICAgICAgICAgaWYgKF9jdXJUaW1lMi5pc1NhbWVPckJlZm9yZShtYXhUaW1lKSkgewogICAgICAgICAgICB2YXIgX3RlbXBjdXJUaW1lMiA9IF9jdXJUaW1lMi5jbG9uZSgpOwoKICAgICAgICAgICAgdGltZUZyYWdtZW50QXJyYXkucHVzaChfdGVtcGN1clRpbWUyLnllYXIoKS50b1N0cmluZygpICsgIi0iICsgX3RlbXBjdXJUaW1lMi5tb250aCgpLnRvU3RyaW5nKCkpOwogICAgICAgICAgICBfY3VyVGltZTIgPSBfdGVtcGN1clRpbWUyLmNsb25lKCkuYWRkKDEsICdtb250aHMnKTsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIF9jdXJUaW1lMiA9IG51bGw7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9IC8vZ3JvdXBNb2Rl5Li6IllFQVJXRUVLIgoKCiAgICAgIGlmIChPYmplY3QuaXMoZ3JvdXBNb2RlLCAiWUVBUldFRUsiKSkgewogICAgICAgIHZhciBfY3VyVGltZTMgPSBtaW5UaW1lOwoKICAgICAgICB3aGlsZSAoX2N1clRpbWUzKSB7CiAgICAgICAgICBpZiAoX2N1clRpbWUzLmlzU2FtZU9yQmVmb3JlKG1heFRpbWUpKSB7CiAgICAgICAgICAgIHZhciBfdGVtcGN1clRpbWUzID0gX2N1clRpbWUzLmNsb25lKCk7CgogICAgICAgICAgICB0aW1lRnJhZ21lbnRBcnJheS5wdXNoKF90ZW1wY3VyVGltZTMueWVhcigpLnRvU3RyaW5nKCkgKyAiLSIgKyBfdGVtcGN1clRpbWUzLndlZWsoKS50b1N0cmluZygpKTsKICAgICAgICAgICAgX2N1clRpbWUzID0gX3RlbXBjdXJUaW1lMy5jbG9uZSgpLmFkZCgxLCAnd2Vla3MnKTsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIF9jdXJUaW1lMyA9IG51bGw7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9IC8vZ3JvdXBNb2Rl5Li6IkRBWSIKCgogICAgICBpZiAoT2JqZWN0LmlzKGdyb3VwTW9kZSwgIkRBWSIpKSB7CiAgICAgICAgdmFyIF9jdXJUaW1lNCA9IG1pblRpbWU7CgogICAgICAgIHdoaWxlIChfY3VyVGltZTQpIHsKICAgICAgICAgIGlmIChfY3VyVGltZTQuaXNTYW1lT3JCZWZvcmUobWF4VGltZSkpIHsKICAgICAgICAgICAgdmFyIF90ZW1wY3VyVGltZTQgPSBfY3VyVGltZTQuY2xvbmUoKTsKCiAgICAgICAgICAgIHRpbWVGcmFnbWVudEFycmF5LnB1c2goX3RlbXBjdXJUaW1lNC5mb3JtYXQoJ1lZWVktTU0tREQnKSk7CiAgICAgICAgICAgIF9jdXJUaW1lNCA9IF90ZW1wY3VyVGltZTQuY2xvbmUoKS5hZGQoMSwgJ2RheXMnKTsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIF9jdXJUaW1lNCA9IG51bGw7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9CgogICAgICBkYXRhLmZvckVhY2goZnVuY3Rpb24gKGl0ZW0pIHsKICAgICAgICB2YXIgdGVtcEtleVN0ciA9IGl0ZW1bZ3JvdXBGaWVsZC5uYW1lXTsKICAgICAgICB2YXIgdGVtcEdyb3VucEl0ZW0gPSB0ZW1wR3JvdW5wRGF0YS5nZXQodGVtcEtleVN0cik7CgogICAgICAgIGlmICghdGVtcEdyb3VucEl0ZW0pIHsKICAgICAgICAgIHRlbXBHcm91bnBEYXRhLnNldCh0ZW1wS2V5U3RyLCBpdGVtKTsKICAgICAgICB9CiAgICAgIH0pOwogICAgICB0aW1lRnJhZ21lbnRBcnJheS5mb3JFYWNoKGZ1bmN0aW9uICh0aW1lRnJhZ21lbnQpIHsKICAgICAgICBpZiAoIXRlbXBHcm91bnBEYXRhLmdldCh0aW1lRnJhZ21lbnQpKSB7CiAgICAgICAgICB2YXIgY29weVRlbXAgPSBKU09OLnBhcnNlKEpTT04uc3RyaW5naWZ5KGRhdGFbMF0pKTsKICAgICAgICAgIHZhciBjdXJPYmogPSB7fTsKICAgICAgICAgIGN1ck9ialtncm91cEZpZWxkLm5hbWVdID0gdGltZUZyYWdtZW50OwogICAgICAgICAgY3VyT2JqW3ZhbHVlRmllbGQubmFtZV0gPSAwOwogICAgICAgICAgT2JqZWN0LmFzc2lnbihjb3B5VGVtcCwgY3VyT2JqKTsKICAgICAgICAgIGRhdGEucHVzaChjb3B5VGVtcCk7CiAgICAgICAgfQogICAgICB9KTsKICAgIH0KICAgIC8qKg0KICAgICAqIOihpeWFqOS7o+eggeihqA0KICAgICAqDQogICAgICogQHBhcmFtIHtBcnJheTxhbnk+fSBkYXRhIOS8oOWFpeaVsOaNrg0KICAgICAqIEBwYXJhbSB7QXJyYXk8YW55Pn0gaXRlbSDljZXkuKrluo/liJcNCiAgICAgKiBAcGFyYW0ge0FycmF5PGFueT59IGFsbENvZGVMaXN0IOaJgOacieeahOS7o+eggeihqA0KICAgICAqDQogICAgICogQG1lbWJlcm9mIERiX3N5c3BvcnRsZXQ1X2NoYXJ0QmFzZQ0KICAgICAqLwoKICB9LCB7CiAgICBrZXk6ICJjb21wbGV0ZUNvZGVMaXN0IiwKICAgIHZhbHVlOiBmdW5jdGlvbiBjb21wbGV0ZUNvZGVMaXN0KGRhdGEsIGl0ZW0sIGFsbENvZGVMaXN0KSB7CiAgICAgIHZhciBncm91cEZpZWxkID0gaXRlbS5kYXRhU2V0RmllbGRzLmZpbmQoZnVuY3Rpb24gKGRhdGFzZXRGaWVsZCkgewogICAgICAgIHJldHVybiBkYXRhc2V0RmllbGQubmFtZSA9PT0gaXRlbS5jYXRlZ29yRmllbGQ7CiAgICAgIH0pOwoKICAgICAgaWYgKCFncm91cEZpZWxkLmNvZGVsaXN0KSB7CiAgICAgICAgcmV0dXJuOwogICAgICB9CgogICAgICB2YXIgdmFsdWVGaWVsZCA9IGl0ZW0uZGF0YVNldEZpZWxkcy5maW5kKGZ1bmN0aW9uIChkYXRhc2V0RmllbGQpIHsKICAgICAgICByZXR1cm4gZGF0YXNldEZpZWxkLm5hbWUgPT09IGl0ZW0udmFsdWVGaWVsZDsKICAgICAgfSk7CiAgICAgIHZhciBjdXJDb2RlTGlzdCA9IGFsbENvZGVMaXN0LmdldChncm91cEZpZWxkLmNvZGVsaXN0LnRhZyk7IC8vIOWvueWIhuexu+WunueOsOWIhue7hAoKICAgICAgdmFyIHRlbXBHcm91bnBEYXRhID0gbmV3IE1hcCgpOwogICAgICBkYXRhLmZvckVhY2goZnVuY3Rpb24gKGl0ZW0pIHsKICAgICAgICB2YXIgdGVtcEdyb3VucEl0ZW0gPSB0ZW1wR3JvdW5wRGF0YS5nZXQoaXRlbVtncm91cEZpZWxkLm5hbWUgKyAnX3NyZnZhbHVlJ10pOwoKICAgICAgICBpZiAoIXRlbXBHcm91bnBJdGVtKSB7CiAgICAgICAgICB0ZW1wR3JvdW5wRGF0YS5zZXQoaXRlbVtncm91cEZpZWxkLm5hbWUgKyAnX3NyZnZhbHVlJ10sIGl0ZW0pOwogICAgICAgIH0KICAgICAgfSk7CgogICAgICBpZiAoY3VyQ29kZUxpc3Quc2l6ZSAhPT0gdGVtcEdyb3VucERhdGEuc2l6ZSkgewogICAgICAgIGN1ckNvZGVMaXN0LmZvckVhY2goZnVuY3Rpb24gKHRleHQsIHZhbHVlKSB7CiAgICAgICAgICBpZiAoIXRlbXBHcm91bnBEYXRhLmdldCh2YWx1ZSkpIHsKICAgICAgICAgICAgdmFyIGNvcHlUZW1wID0gSlNPTi5wYXJzZShKU09OLnN0cmluZ2lmeShkYXRhWzBdKSk7CiAgICAgICAgICAgIHZhciBjdXJPYmogPSB7fTsKICAgICAgICAgICAgY3VyT2JqW2dyb3VwRmllbGQubmFtZSArICdfc3JmdmFsdWUnXSA9IHZhbHVlOwogICAgICAgICAgICBjdXJPYmpbZ3JvdXBGaWVsZC5uYW1lXSA9IHRleHQ7CiAgICAgICAgICAgIGN1ck9ialt2YWx1ZUZpZWxkLm5hbWVdID0gMDsKICAgICAgICAgICAgT2JqZWN0LmFzc2lnbihjb3B5VGVtcCwgY3VyT2JqKTsKICAgICAgICAgICAgZGF0YS5wdXNoKGNvcHlUZW1wKTsKICAgICAgICAgIH0KICAgICAgICB9KTsKICAgICAgfQogICAgfQogICAgLyoqDQogICAgICog5aSE55CG5Y2V5Liq5bGe5oCnDQogICAgICoNCiAgICAgKiBAcGFyYW0geyp9IGlucHV0IOi+k+WFpeWAvA0KICAgICAqIEBwYXJhbSB7Kn0gZmllbGQg5bGe5oCn5YC8DQogICAgICogQHBhcmFtIHsqfSBhbGxDb2RlTGlzdCDmiYDmnInku6PnoIHooagNCiAgICAgKiBAcGFyYW0geyp9IHJlc3VsdCDnu5PmnpzlgLwNCiAgICAgKg0KICAgICAqIEBtZW1iZXJvZiBEYl9zeXNwb3J0bGV0NV9jaGFydEJhc2UNCiAgICAgKi8KCiAgfSwgewogICAga2V5OiAiaGFuZGxlU2luZ2xlRGF0YVNldEZpZWxkIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBoYW5kbGVTaW5nbGVEYXRhU2V0RmllbGQoaW5wdXQsIGZpZWxkLCBhbGxDb2RlTGlzdCwgcmVzdWx0LCBncm91cEZpZWxkKSB7CiAgICAgIHZhciB0ZW1wRmllbGRPYmogPSB7fTsgLy/lrZjlnKjku6PnoIHooajnmoTmg4XlhrUo6Ieq5Yqo6L2s5YyW5YC8KQoKICAgICAgaWYgKGZpZWxkLmNvZGVsaXN0KSB7CiAgICAgICAgLy/ojrflj5bku6PnoIHooagKICAgICAgICB2YXIgY3VyQ29kZUxpc3QgPSBhbGxDb2RlTGlzdC5nZXQoZmllbGQuY29kZWxpc3QudGFnKTsKICAgICAgICB0ZW1wRmllbGRPYmpbZmllbGQubmFtZV0gPSBjdXJDb2RlTGlzdC5nZXQoaW5wdXRbZmllbGQubmFtZV0pOwogICAgICAgIHRlbXBGaWVsZE9ialtmaWVsZC5uYW1lICsgJ19zcmZ2YWx1ZSddID0gaW5wdXRbZmllbGQubmFtZV07CiAgICAgIH0gZWxzZSB7CiAgICAgICAgLy8g5LiN5a2Y5Zyo5Luj56CB6KGo55qE5oOF5Ya1CiAgICAgICAgaWYgKGdyb3VwRmllbGQgJiYgT2JqZWN0LmlzKGdyb3VwRmllbGQubmFtZSwgZmllbGQubmFtZSkpIHsKICAgICAgICAgIGlmIChPYmplY3QuaXMoZ3JvdXBGaWVsZC5ncm91cE1vZGUsICJZRUFSIikpIHsKICAgICAgICAgICAgdGVtcEZpZWxkT2JqW2ZpZWxkLm5hbWVdID0gbW9tZW50KGlucHV0W2ZpZWxkLm5hbWVdKS55ZWFyKCkudG9TdHJpbmcoKTsKICAgICAgICAgIH0gZWxzZSBpZiAoT2JqZWN0LmlzKGdyb3VwRmllbGQuZ3JvdXBNb2RlLCAiUVVBUlRFUiIpKSB7CiAgICAgICAgICAgIHRlbXBGaWVsZE9ialtmaWVsZC5uYW1lXSA9IG1vbWVudChpbnB1dFtmaWVsZC5uYW1lXSkueWVhcigpLnRvU3RyaW5nKCkgKyAiLSIgKyBtb21lbnQoaW5wdXRbZmllbGQubmFtZV0pLnF1YXJ0ZXJzKCkudG9TdHJpbmcoKTsKICAgICAgICAgIH0gZWxzZSBpZiAoT2JqZWN0LmlzKGdyb3VwRmllbGQuZ3JvdXBNb2RlLCAiTU9OVEgiKSkgewogICAgICAgICAgICB0ZW1wRmllbGRPYmpbZmllbGQubmFtZV0gPSBtb21lbnQoaW5wdXRbZmllbGQubmFtZV0pLnllYXIoKS50b1N0cmluZygpICsgIi0iICsgbW9tZW50KGlucHV0W2ZpZWxkLm5hbWVdKS5tb250aCgpLnRvU3RyaW5nKCk7CiAgICAgICAgICB9IGVsc2UgaWYgKE9iamVjdC5pcyhncm91cEZpZWxkLmdyb3VwTW9kZSwgIllFQVJXRUVLIikpIHsKICAgICAgICAgICAgdGVtcEZpZWxkT2JqW2ZpZWxkLm5hbWVdID0gbW9tZW50KGlucHV0W2ZpZWxkLm5hbWVdKS55ZWFyKCkudG9TdHJpbmcoKSArICItIiArIG1vbWVudChpbnB1dFtmaWVsZC5uYW1lXSkud2VlaygpLnRvU3RyaW5nKCk7CiAgICAgICAgICB9IGVsc2UgaWYgKE9iamVjdC5pcyhncm91cEZpZWxkLmdyb3VwTW9kZSwgIkRBWSIpKSB7CiAgICAgICAgICAgIHRlbXBGaWVsZE9ialtmaWVsZC5uYW1lXSA9IG1vbWVudChpbnB1dFtmaWVsZC5uYW1lXSkuZm9ybWF0KCJZWVlZLU1NLUREIik7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICB0ZW1wRmllbGRPYmpbZmllbGQubmFtZV0gPSBpbnB1dFtmaWVsZC5uYW1lXTsKICAgICAgICAgIH0KICAgICAgICB9IGVsc2UgewogICAgICAgICAgdGVtcEZpZWxkT2JqW2ZpZWxkLm5hbWVdID0gaW5wdXRbZmllbGQubmFtZV07CiAgICAgICAgfQogICAgICB9CgogICAgICBPYmplY3QuYXNzaWduKHJlc3VsdCwgdGVtcEZpZWxkT2JqKTsKICAgIH0KICAgIC8qKg0KICAgICAqIOiOt+WPluWbvuihqOaJgOmcgOS7o+eggeihqA0KICAgICAqDQogICAgICogQG1lbWJlcm9mIERiX3N5c3BvcnRsZXQ1X2NoYXJ0QmFzZQ0KICAgICAqLwoKICB9LCB7CiAgICBrZXk6ICJnZXRDaGFydEFsbENvZGVMaXN0IiwKICAgIHZhbHVlOiBmdW5jdGlvbiBnZXRDaGFydEFsbENvZGVMaXN0KCkgewogICAgICB2YXIgX3RoaXM3ID0gdGhpczsKCiAgICAgIHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbiAocmVzb2x2ZSwgcmVqZWN0KSB7CiAgICAgICAgdmFyIGNvZGVMaXN0TWFwID0gbmV3IE1hcCgpOwoKICAgICAgICBpZiAoT2JqZWN0LnZhbHVlcyhfdGhpczcuc2VyaWVzTW9kZWwpLmxlbmd0aCA+IDApIHsKICAgICAgICAgIHZhciB0ZW1wRmxhZyA9IHRydWU7CiAgICAgICAgICBPYmplY3QudmFsdWVzKF90aGlzNy5zZXJpZXNNb2RlbCkuZm9yRWFjaChmdW5jdGlvbiAoc2luZ2xlU2VyaWVzKSB7CiAgICAgICAgICAgIGlmIChzaW5nbGVTZXJpZXMuZGF0YVNldEZpZWxkcyAmJiBzaW5nbGVTZXJpZXMuZGF0YVNldEZpZWxkcy5sZW5ndGggPiAwKSB7CiAgICAgICAgICAgICAgdmFyIHByb21pc2VBcnJheSA9IFtdOwogICAgICAgICAgICAgIHZhciBwcm9taXNlS2V5QXJyYXkgPSBbXTsKICAgICAgICAgICAgICBzaW5nbGVTZXJpZXMuZGF0YVNldEZpZWxkcy5mb3JFYWNoKGZ1bmN0aW9uIChzaW5nbGVEYXRhU2V0RmllbGQsIGluZGV4KSB7CiAgICAgICAgICAgICAgICBpZiAoc2luZ2xlRGF0YVNldEZpZWxkLmNvZGVsaXN0KSB7CiAgICAgICAgICAgICAgICAgIHRlbXBGbGFnID0gZmFsc2U7CgogICAgICAgICAgICAgICAgICBpZiAoIWNvZGVMaXN0TWFwLmdldChzaW5nbGVEYXRhU2V0RmllbGQuY29kZWxpc3QudGFnKSkgewogICAgICAgICAgICAgICAgICAgIHByb21pc2VBcnJheS5wdXNoKF90aGlzNy5nZXRDb2RlTGlzdChzaW5nbGVEYXRhU2V0RmllbGQuY29kZWxpc3QpKTsKICAgICAgICAgICAgICAgICAgICBwcm9taXNlS2V5QXJyYXkucHVzaChzaW5nbGVEYXRhU2V0RmllbGQuY29kZWxpc3QudGFnKTsKICAgICAgICAgICAgICAgICAgICBQcm9taXNlLmFsbChwcm9taXNlQXJyYXkpLnRoZW4oZnVuY3Rpb24gKHJlc3VsdCkgewogICAgICAgICAgICAgICAgICAgICAgaWYgKHJlc3VsdCAmJiByZXN1bHQubGVuZ3RoID4gMCkgewogICAgICAgICAgICAgICAgICAgICAgICByZXN1bHQuZm9yRWFjaChmdW5jdGlvbiAoY29kZUxpc3QpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgdGVtcENvZGVMaXN0TWFwID0gbmV3IE1hcCgpOwoKICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoY29kZUxpc3QubGVuZ3RoID4gMCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgY29kZUxpc3QuZm9yRWFjaChmdW5jdGlvbiAoY29kZUxpc3RJdGVtKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRlbXBDb2RlTGlzdE1hcC5zZXQoY29kZUxpc3RJdGVtLnZhbHVlLCBjb2RlTGlzdEl0ZW0udGV4dCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgICAgICAgIGNvZGVMaXN0TWFwLnNldChzaW5nbGVEYXRhU2V0RmllbGQuY29kZWxpc3QudGFnLCB0ZW1wQ29kZUxpc3RNYXApOwogICAgICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZShjb2RlTGlzdE1hcCk7CiAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfQogICAgICAgICAgfSk7CgogICAgICAgICAgaWYgKHRlbXBGbGFnKSB7CiAgICAgICAgICAgIHJlc29sdmUoY29kZUxpc3RNYXApOwogICAgICAgICAgfQogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICByZXNvbHZlKGNvZGVMaXN0TWFwKTsKICAgICAgICB9CiAgICAgIH0pOwogICAgfQogICAgLyoqDQogICAgICog6I635Y+W5Luj56CB6KGoDQogICAgICoNCiAgICAgKiBAcmV0dXJucyB7UHJvbWlzZTxhbnk+fQ0KICAgICAqIEBtZW1iZXJvZiBEYl9zeXNwb3J0bGV0NV9jaGFydEJhc2UNCiAgICAgKi8KCiAgfSwgewogICAga2V5OiAiZ2V0Q29kZUxpc3QiLAogICAgdmFsdWU6IGZ1bmN0aW9uIGdldENvZGVMaXN0KGNvZGVMaXN0T2JqZWN0KSB7CiAgICAgIHZhciBfdGhpczggPSB0aGlzOwoKICAgICAgcmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uIChyZXNvbHZlLCByZWplY3QpIHsKICAgICAgICBpZiAoY29kZUxpc3RPYmplY3QudGFnICYmIE9iamVjdC5pcyhjb2RlTGlzdE9iamVjdC50eXBlLCAiU1RBVElDIikpIHsKICAgICAgICAgIHZhciBjb2RlbGlzdCA9IF90aGlzOC4kc3RvcmUuZ2V0dGVycy5nZXRDb2RlTGlzdChjb2RlTGlzdE9iamVjdC50YWcpOwoKICAgICAgICAgIGlmIChjb2RlbGlzdCkgewogICAgICAgICAgICByZXNvbHZlKF90b0NvbnN1bWFibGVBcnJheShKU09OLnBhcnNlKEpTT04uc3RyaW5naWZ5KGNvZGVsaXN0Lml0ZW1zKSkpKTsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIGNvbnNvbGUubG9nKCItLS0tIi5jb25jYXQoY29kZUxpc3RPYmplY3QudGFnLCAiLS0tLVx1NEVFM1x1NzgwMVx1ODg2OFx1NEUwRFx1NUI1OFx1NTcyOCIpKTsKICAgICAgICAgIH0KICAgICAgICB9IGVsc2UgaWYgKGNvZGVMaXN0T2JqZWN0LnRhZyAmJiBPYmplY3QuaXMoY29kZUxpc3RPYmplY3QudHlwZSwgIkRZTkFNSUMiKSkgewogICAgICAgICAgX3RoaXM4LmNvZGVMaXN0U2VydmljZS5nZXRJdGVtcyhjb2RlTGlzdE9iamVjdC50YWcpLnRoZW4oZnVuY3Rpb24gKHJlcykgewogICAgICAgICAgICByZXNvbHZlKHJlcyk7CiAgICAgICAgICB9KVsiY2F0Y2giXShmdW5jdGlvbiAoZXJyb3IpIHsKICAgICAgICAgICAgY29uc29sZS5sb2coIi0tLS0iLmNvbmNhdChjb2RlTGlzdE9iamVjdC50YWcsICItLS0tXHU0RUUzXHU3ODAxXHU4ODY4XHU0RTBEXHU1QjU4XHU1NzI4IikpOwogICAgICAgICAgfSk7CiAgICAgICAgfQogICAgICB9KTsKICAgIH0KICB9XSk7CgogIHJldHVybiBPcmdUaXRsZUJhckJhc2U7Cn0oVnVlKTsKCnRzbGliXzEuX19kZWNvcmF0ZShbUHJvcCgpXSwgT3JnVGl0bGVCYXJCYXNlLnByb3RvdHlwZSwgIm5hbWUiLCB2b2lkIDApOwoKdHNsaWJfMS5fX2RlY29yYXRlKFtQcm9wKCldLCBPcmdUaXRsZUJhckJhc2UucHJvdG90eXBlLCAidmlld1N0YXRlIiwgdm9pZCAwKTsKCnRzbGliXzEuX19kZWNvcmF0ZShbUHJvcCgpXSwgT3JnVGl0bGVCYXJCYXNlLnByb3RvdHlwZSwgImNvbnRleHQiLCB2b2lkIDApOwoKdHNsaWJfMS5fX2RlY29yYXRlKFtQcm9wKCldLCBPcmdUaXRsZUJhckJhc2UucHJvdG90eXBlLCAidmlld3BhcmFtcyIsIHZvaWQgMCk7Cgp0c2xpYl8xLl9fZGVjb3JhdGUoW1Byb3AoewogICJkZWZhdWx0IjogdHJ1ZQp9KV0sIE9yZ1RpdGxlQmFyQmFzZS5wcm90b3R5cGUsICJzaG93QnVzeUluZGljYXRvciIsIHZvaWQgMCk7Cgp0c2xpYl8xLl9fZGVjb3JhdGUoW1Byb3AoKV0sIE9yZ1RpdGxlQmFyQmFzZS5wcm90b3R5cGUsICJmZXRjaEFjdGlvbiIsIHZvaWQgMCk7CgpPcmdUaXRsZUJhckJhc2UgPSB0c2xpYl8xLl9fZGVjb3JhdGUoW0NvbXBvbmVudCh7CiAgY29tcG9uZW50czoge30KfSldLCBPcmdUaXRsZUJhckJhc2UpOwpleHBvcnQgZGVmYXVsdCBPcmdUaXRsZUJhckJhc2U7"},null]}
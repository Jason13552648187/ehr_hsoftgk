{"remainingRequest":"F:\\crod项目\\人事管理系统2\\iBizEHR\\app_EHRPim\\node_modules\\thread-loader\\dist\\cjs.js!F:\\crod项目\\人事管理系统2\\iBizEHR\\app_EHRPim\\node_modules\\babel-loader\\lib\\index.js!F:\\crod项目\\人事管理系统2\\iBizEHR\\app_EHRPim\\node_modules\\ts-loader\\index.js??ref--14-3!F:\\crod项目\\人事管理系统2\\iBizEHR\\app_EHRPim\\node_modules\\cache-loader\\dist\\cjs.js??ref--0-0!F:\\crod项目\\人事管理系统2\\iBizEHR\\app_EHRPim\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!F:\\crod项目\\人事管理系统2\\iBizEHR\\app_EHRPim\\src\\widgets\\pim-archives-change\\main-grid\\main-grid-base.vue?vue&type=script&lang=tsx&","dependencies":[{"path":"F:\\crod项目\\人事管理系统2\\iBizEHR\\app_EHRPim\\src\\widgets\\pim-archives-change\\main-grid\\main-grid-base.vue","mtime":1630509411289},{"path":"F:\\crod项目\\人事管理系统2\\iBizEHR\\app_EHRPim\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1630511852775},{"path":"F:\\crod项目\\人事管理系统2\\iBizEHR\\app_EHRPim\\node_modules\\thread-loader\\dist\\cjs.js","mtime":1630511853252},{"path":"F:\\crod项目\\人事管理系统2\\iBizEHR\\app_EHRPim\\node_modules\\babel-loader\\lib\\index.js","mtime":1630511852747},{"path":"F:\\crod项目\\人事管理系统2\\iBizEHR\\app_EHRPim\\node_modules\\ts-loader\\index.js","mtime":1630511985412},{"path":"F:\\crod项目\\人事管理系统2\\iBizEHR\\app_EHRPim\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1630511852775},{"path":"F:\\crod项目\\人事管理系统2\\iBizEHR\\app_EHRPim\\node_modules\\vue-loader\\lib\\index.js","mtime":1630512070338}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:aW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuc3ltYm9sIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuc3ltYm9sLmRlc2NyaXB0aW9uIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuc3ltYm9sLml0ZXJhdG9yIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkuZmlsdGVyIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkuZmluZCI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLmFycmF5LmZpbmQtaW5kZXgiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5hcnJheS5mb3ItZWFjaCI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLmFycmF5LmpvaW4iOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5hcnJheS5tYXAiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5hcnJheS5zb21lIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkuc3BsaWNlIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuZnVuY3Rpb24ubmFtZSI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLm9iamVjdC5kZWZpbmUtcHJvcGVydGllcyI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLm9iamVjdC5kZWZpbmUtcHJvcGVydHkiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5vYmplY3QuZ2V0LW93bi1wcm9wZXJ0eS1kZXNjcmlwdG9yIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMub2JqZWN0LmdldC1vd24tcHJvcGVydHktZGVzY3JpcHRvcnMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5vYmplY3QuaXMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5vYmplY3Qua2V5cyI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLm9iamVjdC50by1zdHJpbmciOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5wYXJzZS1pbnQiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5yZWdleHAuZXhlYyI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLnN0cmluZy5pdGVyYXRvciI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLnN0cmluZy5yZXBsYWNlIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuc3RyaW5nLnNlYXJjaCI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLnN0cmluZy5zcGxpdCI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL3dlYi5kb20tY29sbGVjdGlvbnMuZm9yLWVhY2giOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy93ZWIuZG9tLWNvbGxlY3Rpb25zLml0ZXJhdG9yIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvd2ViLnRpbWVycyI7CmltcG9ydCBfdG9Db25zdW1hYmxlQXJyYXkgZnJvbSAiRjpcXGNyb2RcdTk4NzlcdTc2RUVcXFx1NEVCQVx1NEU4Qlx1N0JBMVx1NzQwNlx1N0NGQlx1N0VERjJcXGlCaXpFSFJcXGFwcF9FSFJQaW1cXG5vZGVfbW9kdWxlc1xcQGJhYmVsXFxydW50aW1lL2hlbHBlcnMvZXNtL3RvQ29uc3VtYWJsZUFycmF5IjsKaW1wb3J0IF9kZWZpbmVQcm9wZXJ0eSBmcm9tICJGOlxcY3JvZFx1OTg3OVx1NzZFRVxcXHU0RUJBXHU0RThCXHU3QkExXHU3NDA2XHU3Q0ZCXHU3RURGMlxcaUJpekVIUlxcYXBwX0VIUlBpbVxcbm9kZV9tb2R1bGVzXFxAYmFiZWxcXHJ1bnRpbWUvaGVscGVycy9lc20vZGVmaW5lUHJvcGVydHkiOwppbXBvcnQgInJlZ2VuZXJhdG9yLXJ1bnRpbWUvcnVudGltZSI7CmltcG9ydCBfYXN5bmNUb0dlbmVyYXRvciBmcm9tICJGOlxcY3JvZFx1OTg3OVx1NzZFRVxcXHU0RUJBXHU0RThCXHU3QkExXHU3NDA2XHU3Q0ZCXHU3RURGMlxcaUJpekVIUlxcYXBwX0VIUlBpbVxcbm9kZV9tb2R1bGVzXFxAYmFiZWxcXHJ1bnRpbWUvaGVscGVycy9lc20vYXN5bmNUb0dlbmVyYXRvciI7CmltcG9ydCBfY2xhc3NDYWxsQ2hlY2sgZnJvbSAiRjpcXGNyb2RcdTk4NzlcdTc2RUVcXFx1NEVCQVx1NEU4Qlx1N0JBMVx1NzQwNlx1N0NGQlx1N0VERjJcXGlCaXpFSFJcXGFwcF9FSFJQaW1cXG5vZGVfbW9kdWxlc1xcQGJhYmVsXFxydW50aW1lL2hlbHBlcnMvZXNtL2NsYXNzQ2FsbENoZWNrIjsKaW1wb3J0IF9jcmVhdGVDbGFzcyBmcm9tICJGOlxcY3JvZFx1OTg3OVx1NzZFRVxcXHU0RUJBXHU0RThCXHU3QkExXHU3NDA2XHU3Q0ZCXHU3RURGMlxcaUJpekVIUlxcYXBwX0VIUlBpbVxcbm9kZV9tb2R1bGVzXFxAYmFiZWxcXHJ1bnRpbWUvaGVscGVycy9lc20vY3JlYXRlQ2xhc3MiOwppbXBvcnQgX3Bvc3NpYmxlQ29uc3RydWN0b3JSZXR1cm4gZnJvbSAiRjpcXGNyb2RcdTk4NzlcdTc2RUVcXFx1NEVCQVx1NEU4Qlx1N0JBMVx1NzQwNlx1N0NGQlx1N0VERjJcXGlCaXpFSFJcXGFwcF9FSFJQaW1cXG5vZGVfbW9kdWxlc1xcQGJhYmVsXFxydW50aW1lL2hlbHBlcnMvZXNtL3Bvc3NpYmxlQ29uc3RydWN0b3JSZXR1cm4iOwppbXBvcnQgX2dldFByb3RvdHlwZU9mIGZyb20gIkY6XFxjcm9kXHU5ODc5XHU3NkVFXFxcdTRFQkFcdTRFOEJcdTdCQTFcdTc0MDZcdTdDRkJcdTdFREYyXFxpQml6RUhSXFxhcHBfRUhSUGltXFxub2RlX21vZHVsZXNcXEBiYWJlbFxccnVudGltZS9oZWxwZXJzL2VzbS9nZXRQcm90b3R5cGVPZiI7CmltcG9ydCBfaW5oZXJpdHMgZnJvbSAiRjpcXGNyb2RcdTk4NzlcdTc2RUVcXFx1NEVCQVx1NEU4Qlx1N0JBMVx1NzQwNlx1N0NGQlx1N0VERjJcXGlCaXpFSFJcXGFwcF9FSFJQaW1cXG5vZGVfbW9kdWxlc1xcQGJhYmVsXFxydW50aW1lL2hlbHBlcnMvZXNtL2luaGVyaXRzIjsKCmZ1bmN0aW9uIG93bktleXMob2JqZWN0LCBlbnVtZXJhYmxlT25seSkgeyB2YXIga2V5cyA9IE9iamVjdC5rZXlzKG9iamVjdCk7IGlmIChPYmplY3QuZ2V0T3duUHJvcGVydHlTeW1ib2xzKSB7IHZhciBzeW1ib2xzID0gT2JqZWN0LmdldE93blByb3BlcnR5U3ltYm9scyhvYmplY3QpOyBpZiAoZW51bWVyYWJsZU9ubHkpIHN5bWJvbHMgPSBzeW1ib2xzLmZpbHRlcihmdW5jdGlvbiAoc3ltKSB7IHJldHVybiBPYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yKG9iamVjdCwgc3ltKS5lbnVtZXJhYmxlOyB9KTsga2V5cy5wdXNoLmFwcGx5KGtleXMsIHN5bWJvbHMpOyB9IHJldHVybiBrZXlzOyB9CgpmdW5jdGlvbiBfb2JqZWN0U3ByZWFkKHRhcmdldCkgeyBmb3IgKHZhciBpID0gMTsgaSA8IGFyZ3VtZW50cy5sZW5ndGg7IGkrKykgeyB2YXIgc291cmNlID0gYXJndW1lbnRzW2ldICE9IG51bGwgPyBhcmd1bWVudHNbaV0gOiB7fTsgaWYgKGkgJSAyKSB7IG93bktleXMoT2JqZWN0KHNvdXJjZSksIHRydWUpLmZvckVhY2goZnVuY3Rpb24gKGtleSkgeyBfZGVmaW5lUHJvcGVydHkodGFyZ2V0LCBrZXksIHNvdXJjZVtrZXldKTsgfSk7IH0gZWxzZSBpZiAoT2JqZWN0LmdldE93blByb3BlcnR5RGVzY3JpcHRvcnMpIHsgT2JqZWN0LmRlZmluZVByb3BlcnRpZXModGFyZ2V0LCBPYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9ycyhzb3VyY2UpKTsgfSBlbHNlIHsgb3duS2V5cyhPYmplY3Qoc291cmNlKSkuZm9yRWFjaChmdW5jdGlvbiAoa2V5KSB7IE9iamVjdC5kZWZpbmVQcm9wZXJ0eSh0YXJnZXQsIGtleSwgT2JqZWN0LmdldE93blByb3BlcnR5RGVzY3JpcHRvcihzb3VyY2UsIGtleSkpOyB9KTsgfSB9IHJldHVybiB0YXJnZXQ7IH0KCmltcG9ydCAqIGFzIHRzbGliXzEgZnJvbSAidHNsaWIiOwppbXBvcnQgeyBWdWUsIENvbXBvbmVudCwgUHJvcCwgV2F0Y2ggfSBmcm9tICd2dWUtcHJvcGVydHktZGVjb3JhdG9yJzsKaW1wb3J0IFBpbUFyY2hpdmVzQ2hhbmdlU2VydmljZSBmcm9tICdAL3NlcnZpY2UvcGltLWFyY2hpdmVzLWNoYW5nZS9waW0tYXJjaGl2ZXMtY2hhbmdlLXNlcnZpY2UnOwppbXBvcnQgTWFpblNlcnZpY2UgZnJvbSAnLi9tYWluLWdyaWQtc2VydmljZSc7CmltcG9ydCBDb2RlTGlzdFNlcnZpY2UgZnJvbSAiQHNlcnZpY2UvYXBwL2NvZGVsaXN0LXNlcnZpY2UiOwppbXBvcnQgeyBGb3JtSXRlbU1vZGVsIH0gZnJvbSAnQC9tb2RlbC9mb3JtLWRldGFpbCc7Cgp2YXIgTWFpbkJhc2UgPQovKiNfX1BVUkVfXyovCmZ1bmN0aW9uIChfVnVlKSB7CiAgX2luaGVyaXRzKE1haW5CYXNlLCBfVnVlKTsKCiAgZnVuY3Rpb24gTWFpbkJhc2UoKSB7CiAgICB2YXIgX3RoaXMyOwoKICAgIF9jbGFzc0NhbGxDaGVjayh0aGlzLCBNYWluQmFzZSk7CgogICAgX3RoaXMyID0gX3Bvc3NpYmxlQ29uc3RydWN0b3JSZXR1cm4odGhpcywgX2dldFByb3RvdHlwZU9mKE1haW5CYXNlKS5hcHBseSh0aGlzLCBhcmd1bWVudHMpKTsKICAgIC8qKg0KICAgICAqIOiuoeaVsOWZqOacjeWKoeWvueixoembhuWQiA0KICAgICAqDQogICAgICogQHR5cGUge0FycmF5PCo+fQ0KICAgICAqIEBtZW1iZXJvZiBNYWluQmFzZQ0KICAgICAqLwoKICAgIF90aGlzMi5jb3VudGVyU2VydmljZUFycmF5ID0gW107CiAgICAvKioNCiAgICAgKiDlu7rmnoTpg6jku7bmnI3liqHlr7nosaENCiAgICAgKg0KICAgICAqIEB0eXBlIHtNYWluU2VydmljZX0NCiAgICAgKiBAbWVtYmVyb2YgTWFpbkJhc2UNCiAgICAgKi8KCiAgICBfdGhpczIuc2VydmljZSA9IG5ldyBNYWluU2VydmljZSh7CiAgICAgICRzdG9yZTogX3RoaXMyLiRzdG9yZQogICAgfSk7CiAgICAvKioNCiAgICAgKiDlrp7kvZPmnI3liqHlr7nosaENCiAgICAgKg0KICAgICAqIEB0eXBlIHtQaW1BcmNoaXZlc0NoYW5nZVNlcnZpY2V9DQogICAgICogQG1lbWJlcm9mIE1haW5CYXNlDQogICAgICovCgogICAgX3RoaXMyLmFwcEVudGl0eVNlcnZpY2UgPSBuZXcgUGltQXJjaGl2ZXNDaGFuZ2VTZXJ2aWNlKHsKICAgICAgJHN0b3JlOiBfdGhpczIuJHN0b3JlCiAgICB9KTsKICAgIC8qKg0KICAgICAqIOS7o+eggeihqOacjeWKoeWvueixoQ0KICAgICAqDQogICAgICogQHR5cGUge0NvZGVMaXN0U2VydmljZX0NCiAgICAgKiBAbWVtYmVyb2YgTWFpbkJhc2UNCiAgICAgKi8KCiAgICBfdGhpczIuY29kZUxpc3RTZXJ2aWNlID0gbmV3IENvZGVMaXN0U2VydmljZSh7CiAgICAgICRzdG9yZTogX3RoaXMyLiRzdG9yZQogICAgfSk7CiAgICAvKioNCiAgICAgKiDlvZPliY3pobUNCiAgICAgKg0KICAgICAqIEB0eXBlIHtudW1iZXJ9DQogICAgICogQG1lbWJlcm9mIE1haW5CYXNlDQogICAgICovCgogICAgX3RoaXMyLmN1clBhZ2UgPSAxOwogICAgLyoqDQogICAgICog5pWw5o2uDQogICAgICoNCiAgICAgKiBAdHlwZSB7YW55W119DQogICAgICogQG1lbWJlcm9mIE1haW5CYXNlDQogICAgICovCgogICAgX3RoaXMyLml0ZW1zID0gW107CiAgICAvKioNCiAgICAgKiDmmK/lkKbmlK/mjIHliIbpobUNCiAgICAgKg0KICAgICAqIEB0eXBlIHtib29sZWFufQ0KICAgICAqIEBtZW1iZXJvZiBNYWluQmFzZQ0KICAgICAqLwoKICAgIF90aGlzMi5pc0VuYWJsZVBhZ2luZ0JhciA9IGZhbHNlOwogICAgLyoqDQogICAgICog5piv5ZCm56aB55So5o6S5bqPDQogICAgICoNCiAgICAgKiBAdHlwZSB7Ym9vbGVhbn0NCiAgICAgKiBAbWVtYmVyb2YgTWFpbkJhc2UNCiAgICAgKi8KCiAgICBfdGhpczIuaXNOb1NvcnQgPSBmYWxzZTsKICAgIC8qKg0KICAgICAqIOaOkuW6j+aWueWQkQ0KICAgICAqDQogICAgICogQHR5cGUge3N0cmluZ30NCiAgICAgKiBAbWVtYmVyb2YgTWFpbkJhc2UNCiAgICAgKi8KCiAgICBfdGhpczIubWlub3JTb3J0RGlyID0gJ0RFU0MnOwogICAgLyoqDQogICAgICog5o6S5bqP5a2X5q61DQogICAgICoNCiAgICAgKiBAdHlwZSB7c3RyaW5nfQ0KICAgICAqIEBtZW1iZXJvZiBNYWluQmFzZQ0KICAgICAqLwoKICAgIF90aGlzMi5taW5vclNvcnRQU0RFRiA9ICdkYWRkcnEnOwogICAgLyoqDQogICAgICog5YiG6aG15p2h5pWwDQogICAgICoNCiAgICAgKiBAdHlwZSB7bnVtYmVyfQ0KICAgICAqIEBtZW1iZXJvZiBNYWluQmFzZQ0KICAgICAqLwoKICAgIF90aGlzMi5saW1pdCA9IDIwOwogICAgLyoqDQogICAgICog5piv5ZCm5pi+56S65qCH6aKYDQogICAgICoNCiAgICAgKiBAdHlwZSB7Ym9vbGVhbn0NCiAgICAgKiBAbWVtYmVyb2YgTWFpbkJhc2UNCiAgICAgKi8KCiAgICBfdGhpczIuaXNIaWRlSGVhZGVyID0gZmFsc2U7CiAgICAvKioNCiAgICAgKiDlrp7pmYXmmK/lkKblvIDlkK/ooYznvJbovpENCiAgICAgKg0KICAgICAqIEB0eXBlIHtib29sZWFufQ0KICAgICAqIEBtZW1iZXJvZiBNYWluQmFzZQ0KICAgICAqLwoKICAgIF90aGlzMi5hY3R1YWxJc09wZW5FZGl0ID0gX3RoaXMyLmlzT3BlbkVkaXQ7CiAgICAvKioNCiAgICAgKiDmgLvmnaHmlbANCiAgICAgKg0KICAgICAqIEB0eXBlIHtudW1iZXJ9DQogICAgICogQG1lbWJlcm9mIE1haW5CYXNlDQogICAgICovCgogICAgX3RoaXMyLnRvdGFscm93ID0gMDsKICAgIC8qKg0KICAgICAqIOmAieS4reihjOaVsOaNrg0KICAgICAqDQogICAgICogQHR5cGUge2FueVtdfQ0KICAgICAqIEBtZW1iZXJvZiBNYWluDQogICAgICovCgogICAgX3RoaXMyLnNlbGVjdGlvbnMgPSBbXTsKICAgIC8qKg0KICAgICAqIOaLpuaIquihjOmAieS4rQ0KICAgICAqDQogICAgICogQHR5cGUge2Jvb2xlYW59DQogICAgICogQG1lbWJlcm9mIE1haW4NCiAgICAgKi8KCiAgICBfdGhpczIuc3RvcFJvd0NsaWNrID0gZmFsc2U7CiAgICAvKioNCiAgICAgKiDooajmoLzmmK/lkKbmmL7npLoNCiAgICAgKg0KICAgICAqIEB0eXBlIHtib29sZWFufQ0KICAgICAqIEBtZW1iZXJvZiBNYWluQmFzZQ0KICAgICAqLwoKICAgIF90aGlzMi5pc0Rpc3BsYXkgPSB0cnVlOwogICAgLyoqDQogICAgKiDpgInpobnmoYbliJflrr0NCiAgICAqDQogICAgKiBAdHlwZSB7bnVtYmVyfQ0KICAgICogQG1lbWJlcm9mIEFwcEluZGV4DQogICAgKi8KCiAgICBfdGhpczIuY2hlY2tib3hDb2xXaWR0aCA9IDM0OwogICAgLyoqDQogICAgICog5piv5ZCm5YWB6K645ouW5Yqo5YiX5a69DQogICAgICoNCiAgICAgKiBAdHlwZSB7Ym9vbGVhbn0NCiAgICAgKiBAbWVtYmVyb2YgQXBwRW1iZWRQaWNrZXINCiAgICAgKi8KCiAgICBfdGhpczIuaXNEcmFnZW5kQ29sID0gZmFsc2U7CiAgICAvKioNCiAgICAgKiDmiYDmnInliJfmiJDlkZgNCiAgICAgKg0KICAgICAqIEB0eXBlIHthbnlbXX0NCiAgICAgKiBAbWVtYmVyb2YgTWFpbkJhc2UNCiAgICAgKi8KCiAgICBfdGhpczIuYWxsQ29sdW1ucyA9IFt7CiAgICAgIG5hbWU6ICdkZGpsdHlwZScsCiAgICAgIGxhYmVsOiAn6LCD5qGj6K6w5b2V57G75Z6LJywKICAgICAgbGFuZ3RhZzogJ2VudGl0aWVzLnBpbWFyY2hpdmVzY2hhbmdlLm1haW5fZ3JpZC5jb2x1bW5zLmRkamx0eXBlJywKICAgICAgc2hvdzogdHJ1ZSwKICAgICAgdXRpbDogJ3B4JwogICAgfSwgewogICAgICBuYW1lOiAnb3Jtb3JnbmFtZScsCiAgICAgIGxhYmVsOiAn6LCD5Ye65Y2V5L2NJywKICAgICAgbGFuZ3RhZzogJ2VudGl0aWVzLnBpbWFyY2hpdmVzY2hhbmdlLm1haW5fZ3JpZC5jb2x1bW5zLm9ybW9yZ25hbWUnLAogICAgICBzaG93OiB0cnVlLAogICAgICB1dGlsOiAnUFgnCiAgICB9LCB7CiAgICAgIG5hbWU6ICdvcm1vcmduYW1lMicsCiAgICAgIGxhYmVsOiAn6LCD5YWl5Y2V5L2NJywKICAgICAgbGFuZ3RhZzogJ2VudGl0aWVzLnBpbWFyY2hpdmVzY2hhbmdlLm1haW5fZ3JpZC5jb2x1bW5zLm9ybW9yZ25hbWUyJywKICAgICAgc2hvdzogdHJ1ZSwKICAgICAgdXRpbDogJ1BYJwogICAgfSwgewogICAgICBuYW1lOiAnamxjc3NqJywKICAgICAgbGFiZWw6ICfosIPliqjml7bpl7QnLAogICAgICBsYW5ndGFnOiAnZW50aXRpZXMucGltYXJjaGl2ZXNjaGFuZ2UubWFpbl9ncmlkLmNvbHVtbnMuamxjc3NqJywKICAgICAgc2hvdzogdHJ1ZSwKICAgICAgdXRpbDogJ1BYJwogICAgfSwgewogICAgICBuYW1lOiAnYnonLAogICAgICBsYWJlbDogJ+Wkh+azqCcsCiAgICAgIGxhbmd0YWc6ICdlbnRpdGllcy5waW1hcmNoaXZlc2NoYW5nZS5tYWluX2dyaWQuY29sdW1ucy5ieicsCiAgICAgIHNob3c6IHRydWUsCiAgICAgIHV0aWw6ICdTVEFSJwogICAgfV07CiAgICAvKioNCiAgICAgKiDooajmoLzmqKHlnovpm4blkIgNCiAgICAgKg0KICAgICAqIEB0eXBlIHsqfQ0KICAgICAqIEBtZW1iZXJvZiBNYWluQmFzZQ0KICAgICAqLwoKICAgIF90aGlzMi5ncmlkSXRlbXNNb2RlbCA9IFtdOwogICAgLyoqDQogICAgICog5bGe5oCn5YC86KeE5YiZDQogICAgICoNCiAgICAgKiBAdHlwZSB7Kn0NCiAgICAgKiBAbWVtYmVyb2YgTWFpbkJhc2UNCiAgICAgKi8KCiAgICBfdGhpczIucnVsZXMgPSB7CiAgICAgIHBpbWFyY2hpdmVzaWQ6IFt7CiAgICAgICAgcmVxdWlyZWQ6IGZhbHNlLAogICAgICAgIHZhbGlkYXRvcjogZnVuY3Rpb24gdmFsaWRhdG9yKHJ1bGUsIHZhbHVlLCBjYWxsYmFjaykgewogICAgICAgICAgcmV0dXJuIHJ1bGUucmVxdWlyZWQgJiYgKHZhbHVlID09PSBudWxsIHx8IHZhbHVlID09PSB1bmRlZmluZWQgfHwgdmFsdWUgPT09ICIiKSA/IGZhbHNlIDogdHJ1ZTsKICAgICAgICB9LAogICAgICAgIG1lc3NhZ2U6ICfmoaPmoYjkv6Hmga/moIfor4Yg5YC85LiN6IO95Li656m6JywKICAgICAgICB0cmlnZ2VyOiAnY2hhbmdlJwogICAgICB9LCB7CiAgICAgICAgcmVxdWlyZWQ6IGZhbHNlLAogICAgICAgIHZhbGlkYXRvcjogZnVuY3Rpb24gdmFsaWRhdG9yKHJ1bGUsIHZhbHVlLCBjYWxsYmFjaykgewogICAgICAgICAgcmV0dXJuIHJ1bGUucmVxdWlyZWQgJiYgKHZhbHVlID09PSBudWxsIHx8IHZhbHVlID09PSB1bmRlZmluZWQgfHwgdmFsdWUgPT09ICIiKSA/IGZhbHNlIDogdHJ1ZTsKICAgICAgICB9LAogICAgICAgIG1lc3NhZ2U6ICfmoaPmoYjkv6Hmga/moIfor4Yg5YC85LiN6IO95Li656m6JywKICAgICAgICB0cmlnZ2VyOiAnYmx1cicKICAgICAgfV0sCiAgICAgIHNyZmtleTogW3sKICAgICAgICByZXF1aXJlZDogZmFsc2UsCiAgICAgICAgdmFsaWRhdG9yOiBmdW5jdGlvbiB2YWxpZGF0b3IocnVsZSwgdmFsdWUsIGNhbGxiYWNrKSB7CiAgICAgICAgICByZXR1cm4gcnVsZS5yZXF1aXJlZCAmJiAodmFsdWUgPT09IG51bGwgfHwgdmFsdWUgPT09IHVuZGVmaW5lZCB8fCB2YWx1ZSA9PT0gIiIpID8gZmFsc2UgOiB0cnVlOwogICAgICAgIH0sCiAgICAgICAgbWVzc2FnZTogJ+aho+ahiOW9kuaho+WcsOWPmOabtOiusOW9leagh+ivhiDlgLzkuI3og73kuLrnqbonLAogICAgICAgIHRyaWdnZXI6ICdjaGFuZ2UnCiAgICAgIH0sIHsKICAgICAgICByZXF1aXJlZDogZmFsc2UsCiAgICAgICAgdmFsaWRhdG9yOiBmdW5jdGlvbiB2YWxpZGF0b3IocnVsZSwgdmFsdWUsIGNhbGxiYWNrKSB7CiAgICAgICAgICByZXR1cm4gcnVsZS5yZXF1aXJlZCAmJiAodmFsdWUgPT09IG51bGwgfHwgdmFsdWUgPT09IHVuZGVmaW5lZCB8fCB2YWx1ZSA9PT0gIiIpID8gZmFsc2UgOiB0cnVlOwogICAgICAgIH0sCiAgICAgICAgbWVzc2FnZTogJ+aho+ahiOW9kuaho+WcsOWPmOabtOiusOW9leagh+ivhiDlgLzkuI3og73kuLrnqbonLAogICAgICAgIHRyaWdnZXI6ICdibHVyJwogICAgICB9XQogICAgfTsKICAgIHJldHVybiBfdGhpczI7CiAgfQogIC8qKg0KICAgKiDojrflj5bpg6jku7bnsbvlnosNCiAgICoNCiAgICogQHJldHVybnMge3N0cmluZ30NCiAgICogQG1lbWJlcm9mIE1haW5CYXNlDQogICAqLwoKCiAgX2NyZWF0ZUNsYXNzKE1haW5CYXNlLCBbewogICAga2V5OiAiZ2V0Q29udHJvbFR5cGUiLAogICAgdmFsdWU6IGZ1bmN0aW9uIGdldENvbnRyb2xUeXBlKCkgewogICAgICByZXR1cm4gJ0dSSUQnOwogICAgfQogICAgLyoqDQogICAgICog5YWz6Zet6KeG5Zu+DQogICAgICoNCiAgICAgKiBAcGFyYW0ge2FueX0gYXJncw0KICAgICAqIEBtZW1iZXJvZiBNYWluQmFzZQ0KICAgICAqLwoKICB9LCB7CiAgICBrZXk6ICJjbG9zZVZpZXciLAogICAgdmFsdWU6IGZ1bmN0aW9uIGNsb3NlVmlldyhhcmdzKSB7CiAgICAgIHZhciBfdGhpcyA9IHRoaXM7CgogICAgICBfdGhpcy4kZW1pdCgnY2xvc2V2aWV3JywgW2FyZ3NdKTsKICAgIH0KICAgIC8qKg0KICAgICAqICDorqHmlbDlmajliLfmlrANCiAgICAgKg0KICAgICAqIEBtZW1iZXJvZiBNYWluQmFzZQ0KICAgICAqLwoKICB9LCB7CiAgICBrZXk6ICJjb3VudGVyUmVmcmVzaCIsCiAgICB2YWx1ZTogZnVuY3Rpb24gY291bnRlclJlZnJlc2goKSB7CiAgICAgIHZhciBfdGhpcyA9IHRoaXM7CgogICAgICBpZiAoX3RoaXMuY291bnRlclNlcnZpY2VBcnJheSAmJiBfdGhpcy5jb3VudGVyU2VydmljZUFycmF5Lmxlbmd0aCA+IDApIHsKICAgICAgICBfdGhpcy5jb3VudGVyU2VydmljZUFycmF5LmZvckVhY2goZnVuY3Rpb24gKGl0ZW0pIHsKICAgICAgICAgIGlmIChpdGVtLnJlZnJlc2hEYXRhICYmIGl0ZW0ucmVmcmVzaERhdGEgaW5zdGFuY2VvZiBGdW5jdGlvbikgewogICAgICAgICAgICBpdGVtLnJlZnJlc2hEYXRhKCk7CiAgICAgICAgICB9CiAgICAgICAgfSk7CiAgICAgIH0KICAgIH0KICAgIC8qKg0KICAgICAqIOiOt+WPluWkmumhueaVsOaNrg0KICAgICAqDQogICAgICogQHJldHVybnMge2FueVtdfQ0KICAgICAqIEBtZW1iZXJvZiBNYWluQmFzZQ0KICAgICAqLwoKICB9LCB7CiAgICBrZXk6ICJnZXREYXRhcyIsCiAgICB2YWx1ZTogZnVuY3Rpb24gZ2V0RGF0YXMoKSB7CiAgICAgIHJldHVybiB0aGlzLnNlbGVjdGlvbnM7CiAgICB9CiAgICAvKioNCiAgICAgKiDojrflj5bljZXpobnmoJENCiAgICAgKg0KICAgICAqIEByZXR1cm5zIHsqfQ0KICAgICAqIEBtZW1iZXJvZiBNYWluQmFzZQ0KICAgICAqLwoKICB9LCB7CiAgICBrZXk6ICJnZXREYXRhIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBnZXREYXRhKCkgewogICAgICByZXR1cm4gdGhpcy5zZWxlY3Rpb25zWzBdOwogICAgfQogICAgLyoqDQogICAgICog6YCJ5Lit5YC85Y+Y5YyWDQogICAgICoNCiAgICAgKiBAcGFyYW0geyp9IG5ld1ZhbA0KICAgICAqIEBwYXJhbSB7Kn0gb2xkVmFsDQogICAgICogQG1lbWJlcm9mIE1haW5CYXNlDQogICAgICovCgogIH0sIHsKICAgIGtleTogIm9uVmFsdWVDaGFuZ2UiLAogICAgdmFsdWU6IGZ1bmN0aW9uIG9uVmFsdWVDaGFuZ2UobmV3VmFsLCBvbGRWYWwpIHsKICAgICAgdmFyIF90aGlzMyA9IHRoaXM7CgogICAgICB0aGlzLnNlbGVjdGlvbnMgPSBbXTsKCiAgICAgIGlmICh0aGlzLnNlbGVjdGVkRGF0YSkgewogICAgICAgIHZhciByZWZzID0gdGhpcy4kcmVmczsKCiAgICAgICAgaWYgKHJlZnMubXVsdGlwbGVUYWJsZSkgewogICAgICAgICAgcmVmcy5tdWx0aXBsZVRhYmxlLmNsZWFyU2VsZWN0aW9uKCk7CiAgICAgICAgICBKU09OLnBhcnNlKHRoaXMuc2VsZWN0ZWREYXRhKS5mb3JFYWNoKGZ1bmN0aW9uIChzZWxlY3Rpb24pIHsKICAgICAgICAgICAgdmFyIHNlbGVjdGVkSXRlbSA9IF90aGlzMy5pdGVtcy5maW5kKGZ1bmN0aW9uIChpdGVtKSB7CiAgICAgICAgICAgICAgcmV0dXJuIE9iamVjdC5pcyhpdGVtLnNyZmtleSwgc2VsZWN0aW9uLnNyZmtleSk7CiAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgaWYgKHNlbGVjdGVkSXRlbSkgewogICAgICAgICAgICAgIF90aGlzMy5yb3dDbGljayhzZWxlY3RlZEl0ZW0pOwogICAgICAgICAgICB9CiAgICAgICAgICB9KTsKICAgICAgICB9CiAgICAgIH0KICAgIH0KICAgIC8qKg0KICAgICAqIOmDqOS7tuWIt+aWsA0KICAgICAqDQogICAgICogQHBhcmFtIHthbnlbXX0gYXJncw0KICAgICAqIEBtZW1iZXJvZiBNYWluQmFzZQ0KICAgICAqLwoKICB9LCB7CiAgICBrZXk6ICJyZWZyZXNoIiwKICAgIHZhbHVlOiBmdW5jdGlvbiByZWZyZXNoKGFyZ3MpIHsKICAgICAgdGhpcy5sb2FkKCk7CiAgICB9CiAgICAvKioNCiAgICAgKiDojrflj5booajmoLzooYzmqKHlnosNCiAgICAgKg0KICAgICAqIEB0eXBlIHsqfQ0KICAgICAqIEBtZW1iZXJvZiBNYWluQmFzZQ0KICAgICAqLwoKICB9LCB7CiAgICBrZXk6ICJnZXRHcmlkUm93TW9kZWwiLAogICAgdmFsdWU6IGZ1bmN0aW9uIGdldEdyaWRSb3dNb2RlbCgpIHsKICAgICAgcmV0dXJuIHsKICAgICAgICBwaW1hcmNoaXZlc2lkOiBuZXcgRm9ybUl0ZW1Nb2RlbCgpLAogICAgICAgIHNyZmtleTogbmV3IEZvcm1JdGVtTW9kZWwoKQogICAgICB9OwogICAgfQogICAgLyoqDQogICAgICog6KGo5qC86KGM57yW6L6R6aG55qCh6aqMDQogICAgICoNCiAgICAgKiBAcGFyYW0ge3N0cmluZ30gcHJvcGVydHkg5bGe5oCn5ZCNDQogICAgICogQHBhcmFtIHsqfSBkYXRhIOihjOaVsOaNrg0KICAgICAqIEBwYXJhbSB7bnVtYmVyfSByb3dJbmRleCDooYzntKLlvJUNCiAgICAgKiBAcmV0dXJucyBQcm9taXNlPGFueT4NCiAgICAgKg0KICAgICAqIEBtZW1iZXJvZiBNYWluQmFzZQ0KICAgICAqLwoKICB9LCB7CiAgICBrZXk6ICJ2YWxpZGF0ZSIsCiAgICB2YWx1ZTogZnVuY3Rpb24gdmFsaWRhdGUocHJvcGVydHksIGRhdGEsIHJvd0luZGV4KSB7CiAgICAgIHZhciBfdGhpczQgPSB0aGlzOwoKICAgICAgcmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uIChyZXNvbHZlLCByZWplY3QpIHsKICAgICAgICBfdGhpczQuJHV0aWwudmFsaWRhdGVJdGVtKHByb3BlcnR5LCBkYXRhLCBfdGhpczQucnVsZXMpLnRoZW4oZnVuY3Rpb24gKCkgewogICAgICAgICAgX3RoaXM0LmdyaWRJdGVtc01vZGVsW3Jvd0luZGV4XVtwcm9wZXJ0eV0uc2V0RXJyb3IobnVsbCk7CgogICAgICAgICAgcmVzb2x2ZSh0cnVlKTsKICAgICAgICB9KVsiY2F0Y2giXShmdW5jdGlvbiAoX3JlZikgewogICAgICAgICAgdmFyIGVycm9ycyA9IF9yZWYuZXJyb3JzLAogICAgICAgICAgICAgIGZpZWxkcyA9IF9yZWYuZmllbGRzOwoKICAgICAgICAgIF90aGlzNC5ncmlkSXRlbXNNb2RlbFtyb3dJbmRleF1bcHJvcGVydHldLnNldEVycm9yKGVycm9yc1swXS5tZXNzYWdlKTsKCiAgICAgICAgICByZXNvbHZlKGZhbHNlKTsKICAgICAgICB9KTsKICAgICAgfSk7CiAgICB9CiAgICAvKioNCiAgICAgKiDmoKHpqozmiYDmnInkv67mlLnov4fnmoTnvJbovpHpobkNCiAgICAgKg0KICAgICAqIEByZXR1cm5zIFByb21pc2U8YW55Pg0KICAgICAqIEBtZW1iZXJvZiBNYWluQmFzZQ0KICAgICAqLwoKICB9LCB7CiAgICBrZXk6ICJ2YWxpZGF0ZUFsbCIsCiAgICB2YWx1ZTogZnVuY3Rpb24gKCkgewogICAgICB2YXIgX3ZhbGlkYXRlQWxsID0gX2FzeW5jVG9HZW5lcmF0b3IoCiAgICAgIC8qI19fUFVSRV9fKi8KICAgICAgcmVnZW5lcmF0b3JSdW50aW1lLm1hcmsoZnVuY3Rpb24gX2NhbGxlZSgpIHsKICAgICAgICB2YXIgdmFsaWRhdGVTdGF0ZSwgaW5kZXgsIF9pdGVyYXRvck5vcm1hbENvbXBsZXRpb24sIF9kaWRJdGVyYXRvckVycm9yLCBfaXRlcmF0b3JFcnJvciwgX2l0ZXJhdG9yLCBfc3RlcCwgaXRlbSwgX2ksIF9PYmplY3Qka2V5cywgcHJvcGVydHk7CgogICAgICAgIHJldHVybiByZWdlbmVyYXRvclJ1bnRpbWUud3JhcChmdW5jdGlvbiBfY2FsbGVlJChfY29udGV4dCkgewogICAgICAgICAgd2hpbGUgKDEpIHsKICAgICAgICAgICAgc3dpdGNoIChfY29udGV4dC5wcmV2ID0gX2NvbnRleHQubmV4dCkgewogICAgICAgICAgICAgIGNhc2UgMDoKICAgICAgICAgICAgICAgIHZhbGlkYXRlU3RhdGUgPSB0cnVlOwogICAgICAgICAgICAgICAgaW5kZXggPSAtMTsKICAgICAgICAgICAgICAgIF9pdGVyYXRvck5vcm1hbENvbXBsZXRpb24gPSB0cnVlOwogICAgICAgICAgICAgICAgX2RpZEl0ZXJhdG9yRXJyb3IgPSBmYWxzZTsKICAgICAgICAgICAgICAgIF9pdGVyYXRvckVycm9yID0gdW5kZWZpbmVkOwogICAgICAgICAgICAgICAgX2NvbnRleHQucHJldiA9IDU7CiAgICAgICAgICAgICAgICBfaXRlcmF0b3IgPSB0aGlzLml0ZW1zW1N5bWJvbC5pdGVyYXRvcl0oKTsKCiAgICAgICAgICAgICAgY2FzZSA3OgogICAgICAgICAgICAgICAgaWYgKF9pdGVyYXRvck5vcm1hbENvbXBsZXRpb24gPSAoX3N0ZXAgPSBfaXRlcmF0b3IubmV4dCgpKS5kb25lKSB7CiAgICAgICAgICAgICAgICAgIF9jb250ZXh0Lm5leHQgPSAyNDsKICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgaXRlbSA9IF9zdGVwLnZhbHVlOwogICAgICAgICAgICAgICAgaW5kZXgrKzsKCiAgICAgICAgICAgICAgICBpZiAoIShpdGVtLnJvd0RhdGFTdGF0ZSA9PT0gImNyZWF0ZSIgfHwgaXRlbS5yb3dEYXRhU3RhdGUgPT09ICJ1cGRhdGUiKSkgewogICAgICAgICAgICAgICAgICBfY29udGV4dC5uZXh0ID0gMjE7CiAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIF9pID0gMCwgX09iamVjdCRrZXlzID0gT2JqZWN0LmtleXModGhpcy5ydWxlcyk7CgogICAgICAgICAgICAgIGNhc2UgMTI6CiAgICAgICAgICAgICAgICBpZiAoIShfaSA8IF9PYmplY3Qka2V5cy5sZW5ndGgpKSB7CiAgICAgICAgICAgICAgICAgIF9jb250ZXh0Lm5leHQgPSAyMTsKICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgcHJvcGVydHkgPSBfT2JqZWN0JGtleXNbX2ldOwogICAgICAgICAgICAgICAgX2NvbnRleHQubmV4dCA9IDE2OwogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMudmFsaWRhdGUocHJvcGVydHksIGl0ZW0sIGluZGV4KTsKCiAgICAgICAgICAgICAgY2FzZSAxNjoKICAgICAgICAgICAgICAgIGlmIChfY29udGV4dC5zZW50KSB7CiAgICAgICAgICAgICAgICAgIF9jb250ZXh0Lm5leHQgPSAxODsKICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgdmFsaWRhdGVTdGF0ZSA9IGZhbHNlOwoKICAgICAgICAgICAgICBjYXNlIDE4OgogICAgICAgICAgICAgICAgX2krKzsKICAgICAgICAgICAgICAgIF9jb250ZXh0Lm5leHQgPSAxMjsKICAgICAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgICAgICBjYXNlIDIxOgogICAgICAgICAgICAgICAgX2l0ZXJhdG9yTm9ybWFsQ29tcGxldGlvbiA9IHRydWU7CiAgICAgICAgICAgICAgICBfY29udGV4dC5uZXh0ID0gNzsKICAgICAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgICAgICBjYXNlIDI0OgogICAgICAgICAgICAgICAgX2NvbnRleHQubmV4dCA9IDMwOwogICAgICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgICAgIGNhc2UgMjY6CiAgICAgICAgICAgICAgICBfY29udGV4dC5wcmV2ID0gMjY7CiAgICAgICAgICAgICAgICBfY29udGV4dC50MCA9IF9jb250ZXh0WyJjYXRjaCJdKDUpOwogICAgICAgICAgICAgICAgX2RpZEl0ZXJhdG9yRXJyb3IgPSB0cnVlOwogICAgICAgICAgICAgICAgX2l0ZXJhdG9yRXJyb3IgPSBfY29udGV4dC50MDsKCiAgICAgICAgICAgICAgY2FzZSAzMDoKICAgICAgICAgICAgICAgIF9jb250ZXh0LnByZXYgPSAzMDsKICAgICAgICAgICAgICAgIF9jb250ZXh0LnByZXYgPSAzMTsKCiAgICAgICAgICAgICAgICBpZiAoIV9pdGVyYXRvck5vcm1hbENvbXBsZXRpb24gJiYgX2l0ZXJhdG9yWyJyZXR1cm4iXSAhPSBudWxsKSB7CiAgICAgICAgICAgICAgICAgIF9pdGVyYXRvclsicmV0dXJuIl0oKTsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgY2FzZSAzMzoKICAgICAgICAgICAgICAgIF9jb250ZXh0LnByZXYgPSAzMzsKCiAgICAgICAgICAgICAgICBpZiAoIV9kaWRJdGVyYXRvckVycm9yKSB7CiAgICAgICAgICAgICAgICAgIF9jb250ZXh0Lm5leHQgPSAzNjsKICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgdGhyb3cgX2l0ZXJhdG9yRXJyb3I7CgogICAgICAgICAgICAgIGNhc2UgMzY6CiAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQuZmluaXNoKDMzKTsKCiAgICAgICAgICAgICAgY2FzZSAzNzoKICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dC5maW5pc2goMzApOwoKICAgICAgICAgICAgICBjYXNlIDM4OgogICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0LmFicnVwdCgicmV0dXJuIiwgdmFsaWRhdGVTdGF0ZSk7CgogICAgICAgICAgICAgIGNhc2UgMzk6CiAgICAgICAgICAgICAgY2FzZSAiZW5kIjoKICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dC5zdG9wKCk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9LCBfY2FsbGVlLCB0aGlzLCBbWzUsIDI2LCAzMCwgMzhdLCBbMzEsLCAzMywgMzddXSk7CiAgICAgIH0pKTsKCiAgICAgIGZ1bmN0aW9uIHZhbGlkYXRlQWxsKCkgewogICAgICAgIHJldHVybiBfdmFsaWRhdGVBbGwuYXBwbHkodGhpcywgYXJndW1lbnRzKTsKICAgICAgfQoKICAgICAgcmV0dXJuIHZhbGlkYXRlQWxsOwogICAgfSgpCiAgICAvKioNCiAgICAgKiDooajmoLzmlbDmja7liqDovb0NCiAgICAgKg0KICAgICAqIEBwYXJhbSB7Kn0gW2FyZz17fV0NCiAgICAgKiBAbWVtYmVyb2YgTWFpbkJhc2UNCiAgICAgKi8KCiAgfSwgewogICAga2V5OiAibG9hZCIsCiAgICB2YWx1ZTogZnVuY3Rpb24gbG9hZCgpIHsKICAgICAgdmFyIF90aGlzNSA9IHRoaXM7CgogICAgICB2YXIgb3B0ID0gYXJndW1lbnRzLmxlbmd0aCA+IDAgJiYgYXJndW1lbnRzWzBdICE9PSB1bmRlZmluZWQgPyBhcmd1bWVudHNbMF0gOiB7fTsKICAgICAgdmFyIHBhZ2VSZXNldCA9IGFyZ3VtZW50cy5sZW5ndGggPiAxICYmIGFyZ3VtZW50c1sxXSAhPT0gdW5kZWZpbmVkID8gYXJndW1lbnRzWzFdIDogZmFsc2U7CgogICAgICBpZiAoIXRoaXMuZmV0Y2hBY3Rpb24pIHsKICAgICAgICB0aGlzLiROb3RpY2UuZXJyb3IoewogICAgICAgICAgdGl0bGU6ICfplJnor68nLAogICAgICAgICAgZGVzYzogJ1BJTUFSQ0hJVkVTQ0hBTkdFR3JpZFZpZXfop4blm77ooajmoLxmZXRjaEFjdGlvbuWPguaVsOacqumFjee9ricKICAgICAgICB9KTsKICAgICAgICByZXR1cm47CiAgICAgIH0KCiAgICAgIGlmIChwYWdlUmVzZXQpIHsKICAgICAgICB0aGlzLmN1clBhZ2UgPSAxOwogICAgICB9CgogICAgICB2YXIgYXJnID0gX29iamVjdFNwcmVhZCh7fSwgb3B0KTsKCiAgICAgIHZhciBwYWdlID0ge307CgogICAgICBpZiAodGhpcy5pc0VuYWJsZVBhZ2luZ0JhcikgewogICAgICAgIE9iamVjdC5hc3NpZ24ocGFnZSwgewogICAgICAgICAgcGFnZTogdGhpcy5jdXJQYWdlIC0gMSwKICAgICAgICAgIHNpemU6IHRoaXMubGltaXQKICAgICAgICB9KTsKICAgICAgfSAvLyDorr7nva7mjpLluo8KCgogICAgICBpZiAoIXRoaXMuaXNOb1NvcnQgJiYgIU9iamVjdC5pcyh0aGlzLm1pbm9yU29ydERpciwgJycpICYmICFPYmplY3QuaXModGhpcy5taW5vclNvcnRQU0RFRiwgJycpKSB7CiAgICAgICAgdmFyIHNvcnQgPSB0aGlzLm1pbm9yU29ydFBTREVGICsgIiwiICsgdGhpcy5taW5vclNvcnREaXI7CiAgICAgICAgT2JqZWN0LmFzc2lnbihwYWdlLCB7CiAgICAgICAgICBzb3J0OiBzb3J0CiAgICAgICAgfSk7CiAgICAgIH0KCiAgICAgIE9iamVjdC5hc3NpZ24oYXJnLCBwYWdlKTsKICAgICAgdmFyIHBhcmVudGRhdGEgPSB7fTsKICAgICAgdGhpcy4kZW1pdCgnYmVmb3JlbG9hZCcsIHBhcmVudGRhdGEpOwogICAgICBPYmplY3QuYXNzaWduKGFyZywgcGFyZW50ZGF0YSk7CiAgICAgIHZhciB0ZW1wVmlld1BhcmFtcyA9IHBhcmVudGRhdGEudmlld3BhcmFtcyA/IHBhcmVudGRhdGEudmlld3BhcmFtcyA6IHt9OwogICAgICBPYmplY3QuYXNzaWduKHRlbXBWaWV3UGFyYW1zLCBKU09OLnBhcnNlKEpTT04uc3RyaW5naWZ5KHRoaXMudmlld3BhcmFtcykpKTsKICAgICAgT2JqZWN0LmFzc2lnbihhcmcsIHsKICAgICAgICB2aWV3cGFyYW1zOiB0ZW1wVmlld1BhcmFtcwogICAgICB9KTsKICAgICAgdmFyIHBvc3QgPSB0aGlzLnNlcnZpY2Uuc2VhcmNoKHRoaXMuZmV0Y2hBY3Rpb24sIEpTT04ucGFyc2UoSlNPTi5zdHJpbmdpZnkodGhpcy5jb250ZXh0KSksIGFyZywgdGhpcy5zaG93QnVzeUluZGljYXRvcik7CiAgICAgIHBvc3QudGhlbihmdW5jdGlvbiAocmVzcG9uc2UpIHsKICAgICAgICBpZiAoIXJlc3BvbnNlLnN0YXR1cyB8fCByZXNwb25zZS5zdGF0dXMgIT09IDIwMCkgewogICAgICAgICAgaWYgKHJlc3BvbnNlLmVycm9yTWVzc2FnZSkgewogICAgICAgICAgICBfdGhpczUuJE5vdGljZS5lcnJvcih7CiAgICAgICAgICAgICAgdGl0bGU6ICfplJnor68nLAogICAgICAgICAgICAgIGRlc2M6IHJlc3BvbnNlLmVycm9yTWVzc2FnZQogICAgICAgICAgICB9KTsKICAgICAgICAgIH0KCiAgICAgICAgICByZXR1cm47CiAgICAgICAgfQoKICAgICAgICB2YXIgZGF0YSA9IHJlc3BvbnNlLmRhdGE7CiAgICAgICAgX3RoaXM1LnRvdGFscm93ID0gcmVzcG9uc2UudG90YWw7CiAgICAgICAgX3RoaXM1Lml0ZW1zID0gSlNPTi5wYXJzZShKU09OLnN0cmluZ2lmeShkYXRhKSk7IC8vIOa4heepunNlbGVjdGlvbnMsZ3JpZEl0ZW1zTW9kZWwKCiAgICAgICAgX3RoaXM1LnNlbGVjdGlvbnMgPSBbXTsKICAgICAgICBfdGhpczUuZ3JpZEl0ZW1zTW9kZWwgPSBbXTsKCiAgICAgICAgX3RoaXM1Lml0ZW1zLmZvckVhY2goZnVuY3Rpb24gKCkgewogICAgICAgICAgX3RoaXM1LmdyaWRJdGVtc01vZGVsLnB1c2goX3RoaXM1LmdldEdyaWRSb3dNb2RlbCgpKTsKICAgICAgICB9KTsKCiAgICAgICAgX3RoaXM1LiRlbWl0KCdsb2FkJywgX3RoaXM1Lml0ZW1zKTsgLy8g6K6+572u6buY6K6k6YCJ5LitCgoKICAgICAgICB2YXIgX3RoaXMgPSBfdGhpczU7CiAgICAgICAgc2V0VGltZW91dChmdW5jdGlvbiAoKSB7CiAgICAgICAgICBpZiAoX3RoaXMuaXNTZWxlY3RGaXJzdERlZmF1bHQpIHsKICAgICAgICAgICAgX3RoaXMucm93Q2xpY2soX3RoaXMuaXRlbXNbMF0pOwogICAgICAgICAgfQoKICAgICAgICAgIGlmIChfdGhpcy5zZWxlY3RlZERhdGEpIHsKICAgICAgICAgICAgdmFyIHJlZnMgPSBfdGhpcy4kcmVmczsKCiAgICAgICAgICAgIGlmIChyZWZzLm11bHRpcGxlVGFibGUpIHsKICAgICAgICAgICAgICByZWZzLm11bHRpcGxlVGFibGUuY2xlYXJTZWxlY3Rpb24oKTsKICAgICAgICAgICAgICBKU09OLnBhcnNlKF90aGlzLnNlbGVjdGVkRGF0YSkuZm9yRWFjaChmdW5jdGlvbiAoc2VsZWN0aW9uKSB7CiAgICAgICAgICAgICAgICB2YXIgc2VsZWN0ZWRJdGVtID0gX3RoaXMuaXRlbXMuZmluZChmdW5jdGlvbiAoaXRlbSkgewogICAgICAgICAgICAgICAgICByZXR1cm4gT2JqZWN0LmlzKGl0ZW0uc3Jma2V5LCBzZWxlY3Rpb24uc3Jma2V5KTsKICAgICAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgICAgIGlmIChzZWxlY3RlZEl0ZW0pIHsKICAgICAgICAgICAgICAgICAgX3RoaXMucm93Q2xpY2soc2VsZWN0ZWRJdGVtKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0sIDMwMCk7CiAgICAgIH0pWyJjYXRjaCJdKGZ1bmN0aW9uIChyZXNwb25zZSkgewogICAgICAgIGlmIChyZXNwb25zZSAmJiByZXNwb25zZS5zdGF0dXMgPT09IDQwMSkgewogICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KCiAgICAgICAgX3RoaXM1LiROb3RpY2UuZXJyb3IoewogICAgICAgICAgdGl0bGU6ICfplJnor68nLAogICAgICAgICAgZGVzYzogcmVzcG9uc2UuZXJyb3JNZXNzYWdlCiAgICAgICAgfSk7CiAgICAgIH0pOwogICAgfQogICAgLyoqDQogICAgICog5Yig6ZmkDQogICAgICoNCiAgICAgKiBAcGFyYW0ge2FueVtdfSBkYXRhcw0KICAgICAqIEByZXR1cm5zIHtQcm9taXNlPGFueT59DQogICAgICogQG1lbWJlcm9mIE1haW5CYXNlDQogICAgICovCgogIH0sIHsKICAgIGtleTogInJlbW92ZSIsCiAgICB2YWx1ZTogZnVuY3Rpb24gKCkgewogICAgICB2YXIgX3JlbW92ZSA9IF9hc3luY1RvR2VuZXJhdG9yKAogICAgICAvKiNfX1BVUkVfXyovCiAgICAgIHJlZ2VuZXJhdG9yUnVudGltZS5tYXJrKGZ1bmN0aW9uIF9jYWxsZWUyKGRhdGFzKSB7CiAgICAgICAgdmFyIF90aGlzNiA9IHRoaXM7CgogICAgICAgIHZhciBfZGF0YXMsIGRhdGFJbmZvLCByZW1vdmVEYXRhOwoKICAgICAgICByZXR1cm4gcmVnZW5lcmF0b3JSdW50aW1lLndyYXAoZnVuY3Rpb24gX2NhbGxlZTIkKF9jb250ZXh0MikgewogICAgICAgICAgd2hpbGUgKDEpIHsKICAgICAgICAgICAgc3dpdGNoIChfY29udGV4dDIucHJldiA9IF9jb250ZXh0Mi5uZXh0KSB7CiAgICAgICAgICAgICAgY2FzZSAwOgogICAgICAgICAgICAgICAgaWYgKHRoaXMucmVtb3ZlQWN0aW9uKSB7CiAgICAgICAgICAgICAgICAgIF9jb250ZXh0Mi5uZXh0ID0gMzsKICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgdGhpcy4kTm90aWNlLmVycm9yKHsKICAgICAgICAgICAgICAgICAgdGl0bGU6ICfplJnor68nLAogICAgICAgICAgICAgICAgICBkZXNjOiAnUElNQVJDSElWRVNDSEFOR0VHcmlkVmlld+inhuWbvuihqOagvHJlbW92ZUFjdGlvbuWPguaVsOacqumFjee9ricKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0Mi5hYnJ1cHQoInJldHVybiIpOwoKICAgICAgICAgICAgICBjYXNlIDM6CiAgICAgICAgICAgICAgICBfZGF0YXMgPSBbXTsKICAgICAgICAgICAgICAgIGRhdGFzLmZvckVhY2goZnVuY3Rpb24gKHJlY29yZCwgaW5kZXgpIHsKICAgICAgICAgICAgICAgICAgaWYgKE9iamVjdC5pcyhyZWNvcmQuc3JmdWYsICIwIikpIHsKICAgICAgICAgICAgICAgICAgICBfdGhpczYuaXRlbXMuc29tZShmdW5jdGlvbiAodmFsLCBudW0pIHsKICAgICAgICAgICAgICAgICAgICAgIGlmIChKU09OLnN0cmluZ2lmeSh2YWwpID09IEpTT04uc3RyaW5naWZ5KHJlY29yZCkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgX3RoaXM2Lml0ZW1zLnNwbGljZShudW0sIDEpOwoKICAgICAgICAgICAgICAgICAgICAgICAgX3RoaXM2LmdyaWRJdGVtc01vZGVsLnNwbGljZShudW0sIDEpOwoKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgX2RhdGFzLnB1c2goZGF0YXNbaW5kZXhdKTsKICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSk7CgogICAgICAgICAgICAgICAgaWYgKCEoX2RhdGFzLmxlbmd0aCA9PT0gMCkpIHsKICAgICAgICAgICAgICAgICAgX2NvbnRleHQyLm5leHQgPSA3OwogICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQyLmFicnVwdCgicmV0dXJuIik7CgogICAgICAgICAgICAgIGNhc2UgNzoKICAgICAgICAgICAgICAgIGRhdGFJbmZvID0gJyc7CgogICAgICAgICAgICAgICAgX2RhdGFzLmZvckVhY2goZnVuY3Rpb24gKHJlY29yZCwgaW5kZXgpIHsKICAgICAgICAgICAgICAgICAgdmFyIHNyZm1ham9ydGV4dCA9IHJlY29yZC5waW1hcmNoaXZlc2NoYW5nZW5hbWU7CgogICAgICAgICAgICAgICAgICBpZiAoaW5kZXggPCA1KSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKCFPYmplY3QuaXMoZGF0YUluZm8sICcnKSkgewogICAgICAgICAgICAgICAgICAgICAgZGF0YUluZm8gKz0gJ+OAgSc7CiAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICBkYXRhSW5mbyArPSBzcmZtYWpvcnRleHQ7CiAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9KTsKCiAgICAgICAgICAgICAgICBpZiAoX2RhdGFzLmxlbmd0aCA8IDUpIHsKICAgICAgICAgICAgICAgICAgZGF0YUluZm8gPSBkYXRhSW5mbyArICcg5YWxJyArIF9kYXRhcy5sZW5ndGggKyAn5p2h5pWw5o2uJzsKICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgIGRhdGFJbmZvID0gZGF0YUluZm8gKyAnLi4uJyArICcg5YWxJyArIF9kYXRhcy5sZW5ndGggKyAn5p2h5pWw5o2uJzsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICByZW1vdmVEYXRhID0gZnVuY3Rpb24gcmVtb3ZlRGF0YSgpIHsKICAgICAgICAgICAgICAgICAgdmFyIGtleXMgPSBbXTsKCiAgICAgICAgICAgICAgICAgIF9kYXRhcy5mb3JFYWNoKGZ1bmN0aW9uIChkYXRhKSB7CiAgICAgICAgICAgICAgICAgICAga2V5cy5wdXNoKGRhdGEuc3Jma2V5KTsKICAgICAgICAgICAgICAgICAgfSk7CgogICAgICAgICAgICAgICAgICB2YXIgX3JlbW92ZUFjdGlvbiA9IGtleXMubGVuZ3RoID4gMSA/ICdyZW1vdmVCYXRjaCcgOiBfdGhpczYucmVtb3ZlQWN0aW9uOwoKICAgICAgICAgICAgICAgICAgdmFyIF9rZXlzID0ga2V5cy5sZW5ndGggPiAxID8ga2V5cyA6IGtleXNbMF07CgogICAgICAgICAgICAgICAgICB2YXIgY29udGV4dCA9IEpTT04ucGFyc2UoSlNPTi5zdHJpbmdpZnkoX3RoaXM2LmNvbnRleHQpKTsKCiAgICAgICAgICAgICAgICAgIHZhciBwb3N0ID0gX3RoaXM2LnNlcnZpY2VbImRlbGV0ZSJdKF9yZW1vdmVBY3Rpb24sIE9iamVjdC5hc3NpZ24oY29udGV4dCwgewogICAgICAgICAgICAgICAgICAgIHBpbWFyY2hpdmVzY2hhbmdlOiBfa2V5cwogICAgICAgICAgICAgICAgICB9KSwgT2JqZWN0LmFzc2lnbih7CiAgICAgICAgICAgICAgICAgICAgcGltYXJjaGl2ZXNjaGFuZ2U6IF9rZXlzCiAgICAgICAgICAgICAgICAgIH0sIHsKICAgICAgICAgICAgICAgICAgICB2aWV3cGFyYW1zOiBfdGhpczYudmlld3BhcmFtcwogICAgICAgICAgICAgICAgICB9KSwgX3RoaXM2LnNob3dCdXN5SW5kaWNhdG9yKTsKCiAgICAgICAgICAgICAgICAgIHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbiAocmVzb2x2ZSwgcmVqZWN0KSB7CiAgICAgICAgICAgICAgICAgICAgcG9zdC50aGVuKGZ1bmN0aW9uIChyZXNwb25zZSkgewogICAgICAgICAgICAgICAgICAgICAgaWYgKCFyZXNwb25zZSB8fCByZXNwb25zZS5zdGF0dXMgIT09IDIwMCkgewogICAgICAgICAgICAgICAgICAgICAgICBfdGhpczYuJE5vdGljZS5lcnJvcih7CiAgICAgICAgICAgICAgICAgICAgICAgICAgdGl0bGU6ICcnLAogICAgICAgICAgICAgICAgICAgICAgICAgIGRlc2M6ICfliKDpmaTmlbDmja7lpLHotKUsJyArIHJlc3BvbnNlLmluZm8KICAgICAgICAgICAgICAgICAgICAgICAgfSk7CgogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICBfdGhpczYuJE5vdGljZS5zdWNjZXNzKHsKICAgICAgICAgICAgICAgICAgICAgICAgICB0aXRsZTogJycsCiAgICAgICAgICAgICAgICAgICAgICAgICAgZGVzYzogJ+WIoOmZpOaIkOWKnyEnCiAgICAgICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgICAgfSAvL+WIoOmZpGl0ZW1z5Lit5bey5Yig6Zmk55qE6aG5CgoKICAgICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKF90aGlzNi5pdGVtcyk7CgogICAgICAgICAgICAgICAgICAgICAgX2RhdGFzLmZvckVhY2goZnVuY3Rpb24gKGRhdGEpIHsKICAgICAgICAgICAgICAgICAgICAgICAgX3RoaXM2Lml0ZW1zLnNvbWUoZnVuY3Rpb24gKGl0ZW0sIGluZGV4KSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKE9iamVjdC5pcyhpdGVtLnNyZmtleSwgZGF0YS5zcmZrZXkpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBfdGhpczYuaXRlbXMuc3BsaWNlKGluZGV4LCAxKTsKCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBfdGhpczYuZ3JpZEl0ZW1zTW9kZWwuc3BsaWNlKGluZGV4LCAxKTsKCiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgICAgfSk7CgogICAgICAgICAgICAgICAgICAgICAgX3RoaXM2LnRvdGFscm93IC09IF9kYXRhcy5sZW5ndGg7CgogICAgICAgICAgICAgICAgICAgICAgX3RoaXM2LiRlbWl0KCdyZW1vdmUnLCBudWxsKTsKCiAgICAgICAgICAgICAgICAgICAgICBfdGhpczYuc2VsZWN0aW9ucyA9IFtdOwogICAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZShyZXNwb25zZSk7CiAgICAgICAgICAgICAgICAgICAgfSlbImNhdGNoIl0oZnVuY3Rpb24gKHJlc3BvbnNlKSB7CiAgICAgICAgICAgICAgICAgICAgICBpZiAocmVzcG9uc2UgJiYgcmVzcG9uc2Uuc3RhdHVzID09PSA0MDEpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICAgIGlmICghcmVzcG9uc2UgfHwgIXJlc3BvbnNlLnN0YXR1cyB8fCAhcmVzcG9uc2UuZGF0YSkgewogICAgICAgICAgICAgICAgICAgICAgICBfdGhpczYuJE5vdGljZS5lcnJvcih7CiAgICAgICAgICAgICAgICAgICAgICAgICAgdGl0bGU6ICfplJnor68nLAogICAgICAgICAgICAgICAgICAgICAgICAgIGRlc2M6ICfns7vnu5/lvILluLgnCiAgICAgICAgICAgICAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgICAgICAgICAgICAgcmVqZWN0KHJlc3BvbnNlKTsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICAgIHJlamVjdChyZXNwb25zZSk7CiAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgfTsKCiAgICAgICAgICAgICAgICBkYXRhSW5mbyA9IGRhdGFJbmZvLnJlcGxhY2UoL1tudWxsXS9nLCAnJykucmVwbGFjZSgvW3VuZGVmaW5lZF0vZywgJycpOwogICAgICAgICAgICAgICAgdGhpcy4kTW9kYWwuY29uZmlybSh7CiAgICAgICAgICAgICAgICAgIHRpdGxlOiAn6K2m5ZGKJywKICAgICAgICAgICAgICAgICAgY29udGVudDogJ+ehruiupOimgeWIoOmZpCAnICsgZGF0YUluZm8gKyAn77yM5Yig6Zmk5pON5L2c5bCG5LiN5Y+v5oGi5aSN77yfJywKICAgICAgICAgICAgICAgICAgb25PazogZnVuY3Rpb24gb25PaygpIHsKICAgICAgICAgICAgICAgICAgICByZW1vdmVEYXRhKCk7CiAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgIG9uQ2FuY2VsOiBmdW5jdGlvbiBvbkNhbmNlbCgpIHt9CiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDIuYWJydXB0KCJyZXR1cm4iLCByZW1vdmVEYXRhKTsKCiAgICAgICAgICAgICAgY2FzZSAxNDoKICAgICAgICAgICAgICBjYXNlICJlbmQiOgogICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0Mi5zdG9wKCk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9LCBfY2FsbGVlMiwgdGhpcyk7CiAgICAgIH0pKTsKCiAgICAgIGZ1bmN0aW9uIHJlbW92ZShfeCkgewogICAgICAgIHJldHVybiBfcmVtb3ZlLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7CiAgICAgIH0KCiAgICAgIHJldHVybiByZW1vdmU7CiAgICB9KCkKICAgIC8qKg0KICAgICAqIOaJuemHj+a3u+WKoA0KICAgICAqDQogICAgICogQHBhcmFtIHsqfSBbYXJnPXt9XQ0KICAgICAqIEBtZW1iZXJvZiBNYWluQmFzZQ0KICAgICAqLwoKICB9LCB7CiAgICBrZXk6ICJhZGRCYXRjaCIsCiAgICB2YWx1ZTogZnVuY3Rpb24gYWRkQmF0Y2goKSB7CiAgICAgIHZhciBhcmcgPSBhcmd1bWVudHMubGVuZ3RoID4gMCAmJiBhcmd1bWVudHNbMF0gIT09IHVuZGVmaW5lZCA/IGFyZ3VtZW50c1swXSA6IHt9OwoKICAgICAgaWYgKCF0aGlzLmZldGNoQWN0aW9uKSB7CiAgICAgICAgdGhpcy4kTm90aWNlLmVycm9yKHsKICAgICAgICAgIHRpdGxlOiAn6ZSZ6K+vJywKICAgICAgICAgIGRlc2M6ICdQSU1BUkNISVZFU0NIQU5HRUdyaWRWaWV36KeG5Zu+6KGo5qC8ZmV0Y2hBY3Rpb27lj4LmlbDmnKrphY3nva4nCiAgICAgICAgfSk7CiAgICAgICAgcmV0dXJuOwogICAgICB9CgogICAgICBpZiAoIWFyZykgewogICAgICAgIGFyZyA9IHt9OwogICAgICB9CgogICAgICBjb25zb2xlLmVycm9yKCLmibnph4/mt7vliqDmnKrlrp7njrAiKTsKICAgIH0KICAgIC8qKg0KICAgICAqIOaVsOaNruWvvOWFpQ0KICAgICAqDQogICAgICogQHBhcmFtIHsqfSBkYXRhDQogICAgICogQG1lbWJlcm9mIE1haW5CYXNlDQogICAgICovCgogIH0sIHsKICAgIGtleTogImltcG9ydEV4Y2VsIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBpbXBvcnRFeGNlbCgpIHsKICAgICAgdmFyIF90aGlzNyA9IHRoaXM7CgogICAgICB2YXIgZGF0YSA9IGFyZ3VtZW50cy5sZW5ndGggPiAwICYmIGFyZ3VtZW50c1swXSAhPT0gdW5kZWZpbmVkID8gYXJndW1lbnRzWzBdIDoge307CiAgICAgIC8v5a+85YWlZXhjZWwKICAgICAgdmFyIGltcG9ydERhdGFNb2RlbCA9IHt9OwoKICAgICAgaWYgKE9iamVjdC5rZXlzKGltcG9ydERhdGFNb2RlbCkubGVuZ3RoID09IDApIHsKICAgICAgICB0aGlzLiROb3RpY2Uud2FybmluZyh7CiAgICAgICAgICAndGl0bGUnOiB0aGlzLiR0KCJhcHAudXRpbHZpZXcud2FybmluZyIpLAogICAgICAgICAgJ2Rlc2MnOiB0aGlzLiR0KCJhcHAudXRpbHZpZXcuaW5mbyIpCiAgICAgICAgfSk7CiAgICAgICAgcmV0dXJuOwogICAgICB9CgogICAgICB2YXIgdmlldyA9IHsKICAgICAgICB2aWV3bmFtZTogJ2FwcC1kYXRhLXVwbG9hZCcsCiAgICAgICAgdGl0bGU6IHRoaXMuJHQoImFwcC51dGlsdmlldy5pbXBvcnR2aWV3IiksCiAgICAgICAgd2lkdGg6IDkwMCwKICAgICAgICBoZWlnaHQ6IDcwMAogICAgICB9OwogICAgICB2YXIgY29udGFpbmVyID0gdGhpcy4kYXBwbW9kYWwub3Blbk1vZGFsKHZpZXcsIEpTT04ucGFyc2UoSlNPTi5zdHJpbmdpZnkodGhpcy5jb250ZXh0KSksIGltcG9ydERhdGFNb2RlbCk7CiAgICAgIGNvbnRhaW5lci5zdWJzY3JpYmUoZnVuY3Rpb24gKHJlc3VsdCkgewogICAgICAgIGlmIChPYmplY3QuaXMocmVzdWx0LnJldCwgJ09LJykpIHsKICAgICAgICAgIF90aGlzNy5yZWZyZXNoKHJlc3VsdC5kYXRhcyk7CiAgICAgICAgfQogICAgICB9KTsKICAgIH0KICAgIC8qKg0KICAgICAqIOaVsOaNruWvvOWHug0KICAgICAqDQogICAgICogQHBhcmFtIHsqfSBkYXRhDQogICAgICogQG1lbWJlcm9mIE1haW5CYXNlDQogICAgICovCgogIH0sIHsKICAgIGtleTogImV4cG9ydEV4Y2VsIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBleHBvcnRFeGNlbCgpIHsKICAgICAgdmFyIF90aGlzOCA9IHRoaXM7CgogICAgICB2YXIgZGF0YSA9IGFyZ3VtZW50cy5sZW5ndGggPiAwICYmIGFyZ3VtZW50c1swXSAhPT0gdW5kZWZpbmVkID8gYXJndW1lbnRzWzBdIDoge307CgogICAgICAvLyDlr7zlh7pFeGNlbAogICAgICB2YXIgZG9FeHBvcnQgPQogICAgICAvKiNfX1BVUkVfXyovCiAgICAgIGZ1bmN0aW9uICgpIHsKICAgICAgICB2YXIgX3JlZjIgPSBfYXN5bmNUb0dlbmVyYXRvcigKICAgICAgICAvKiNfX1BVUkVfXyovCiAgICAgICAgcmVnZW5lcmF0b3JSdW50aW1lLm1hcmsoZnVuY3Rpb24gX2NhbGxlZTMoX2RhdGEpIHsKICAgICAgICAgIHZhciB0SGVhZGVyLCBmaWx0ZXJWYWwsIGRhdGE7CiAgICAgICAgICByZXR1cm4gcmVnZW5lcmF0b3JSdW50aW1lLndyYXAoZnVuY3Rpb24gX2NhbGxlZTMkKF9jb250ZXh0MykgewogICAgICAgICAgICB3aGlsZSAoMSkgewogICAgICAgICAgICAgIHN3aXRjaCAoX2NvbnRleHQzLnByZXYgPSBfY29udGV4dDMubmV4dCkgewogICAgICAgICAgICAgICAgY2FzZSAwOgogICAgICAgICAgICAgICAgICB0SGVhZGVyID0gW107CiAgICAgICAgICAgICAgICAgIGZpbHRlclZhbCA9IFtdOwoKICAgICAgICAgICAgICAgICAgX3RoaXM4LmFsbENvbHVtbnMuZm9yRWFjaChmdW5jdGlvbiAoaXRlbSkgewogICAgICAgICAgICAgICAgICAgIGl0ZW0uc2hvdyAmJiBpdGVtLmxhYmVsID8gdEhlYWRlci5wdXNoKF90aGlzOC4kdChpdGVtLmxhbmd0YWcpKSA6ICIiOwogICAgICAgICAgICAgICAgICAgIGl0ZW0uc2hvdyAmJiBpdGVtLm5hbWUgPyBmaWx0ZXJWYWwucHVzaChpdGVtLm5hbWUpIDogIiI7CiAgICAgICAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgICAgICAgX2NvbnRleHQzLm5leHQgPSA1OwogICAgICAgICAgICAgICAgICByZXR1cm4gX3RoaXM4LmZvcm1hdEV4Y2VsRGF0YShmaWx0ZXJWYWwsIF9kYXRhKTsKCiAgICAgICAgICAgICAgICBjYXNlIDU6CiAgICAgICAgICAgICAgICAgIGRhdGEgPSBfY29udGV4dDMuc2VudDsKCiAgICAgICAgICAgICAgICAgIF90aGlzOC4kZXhwb3J0LmV4cG9ydEV4Y2VsKCkudGhlbihmdW5jdGlvbiAoZXhjZWwpIHsKICAgICAgICAgICAgICAgICAgICBleGNlbC5leHBvcnRfanNvbl90b19leGNlbCh7CiAgICAgICAgICAgICAgICAgICAgICBoZWFkZXI6IHRIZWFkZXIsCiAgICAgICAgICAgICAgICAgICAgICBkYXRhOiBkYXRhLAogICAgICAgICAgICAgICAgICAgICAgZmlsZW5hbWU6ICLmoaPmoYjlvZLmoaPlnLDlj5jmm7TorrDlvZXooagiLAogICAgICAgICAgICAgICAgICAgICAgYXV0b1dpZHRoOiB0cnVlLAogICAgICAgICAgICAgICAgICAgICAgYm9va1R5cGU6ICJ4bHN4IiAvL+mdnuW/heWhqwoKICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgfSk7CgogICAgICAgICAgICAgICAgY2FzZSA3OgogICAgICAgICAgICAgICAgY2FzZSAiZW5kIjoKICAgICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0My5zdG9wKCk7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICB9LCBfY2FsbGVlMyk7CiAgICAgICAgfSkpOwoKICAgICAgICByZXR1cm4gZnVuY3Rpb24gZG9FeHBvcnQoX3gyKSB7CiAgICAgICAgICByZXR1cm4gX3JlZjIuYXBwbHkodGhpcywgYXJndW1lbnRzKTsKICAgICAgICB9OwogICAgICB9KCk7CgogICAgICB2YXIgcGFnZSA9IHt9OyAvLyDorr7nva5wYWdl77yMc2l6ZQoKICAgICAgaWYgKE9iamVjdC5pcyhkYXRhLnR5cGUsICdtYXhSb3dDb3VudCcpKSB7CiAgICAgICAgT2JqZWN0LmFzc2lnbihwYWdlLCB7CiAgICAgICAgICBwYWdlOiAwLAogICAgICAgICAgc2l6ZTogZGF0YS5tYXhSb3dDb3VudAogICAgICAgIH0pOwogICAgICB9IGVsc2UgaWYgKE9iamVjdC5pcyhkYXRhLnR5cGUsICdhY3RpdmF0ZWRQYWdlJykpIHsKICAgICAgICB0cnkgewogICAgICAgICAgZG9FeHBvcnQoSlNPTi5wYXJzZShKU09OLnN0cmluZ2lmeSh0aGlzLml0ZW1zKSkpOwogICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7CiAgICAgICAgICBjb25zb2xlLmVycm9yKGVycm9yKTsKICAgICAgICB9CgogICAgICAgIHJldHVybjsKICAgICAgfSAvLyDorr7nva7mjpLluo8KCgogICAgICBpZiAoIXRoaXMuaXNOb1NvcnQgJiYgIU9iamVjdC5pcyh0aGlzLm1pbm9yU29ydERpciwgJycpICYmICFPYmplY3QuaXModGhpcy5taW5vclNvcnRQU0RFRiwgJycpKSB7CiAgICAgICAgdmFyIHNvcnQgPSB0aGlzLm1pbm9yU29ydFBTREVGICsgIiwiICsgdGhpcy5taW5vclNvcnREaXI7CiAgICAgICAgT2JqZWN0LmFzc2lnbihwYWdlLCB7CiAgICAgICAgICBzb3J0OiBzb3J0CiAgICAgICAgfSk7CiAgICAgIH0KCiAgICAgIHZhciBhcmcgPSB7fTsKICAgICAgT2JqZWN0LmFzc2lnbihhcmcsIHBhZ2UpOyAvLyDojrflj5ZxdWVyeSzmkJzntKLooajljZXvvIx2aWV3cGFyYW1z562J54i25pWw5o2uCgogICAgICB2YXIgcGFyZW50ZGF0YSA9IHt9OwogICAgICB0aGlzLiRlbWl0KCdiZWZvcmVsb2FkJywgcGFyZW50ZGF0YSk7CiAgICAgIE9iamVjdC5hc3NpZ24oYXJnLCBwYXJlbnRkYXRhKTsKICAgICAgdmFyIHBvc3QgPSB0aGlzLnNlcnZpY2Uuc2VhcmNoKHRoaXMuZmV0Y2hBY3Rpb24sIEpTT04ucGFyc2UoSlNPTi5zdHJpbmdpZnkodGhpcy5jb250ZXh0KSksIGFyZywgdGhpcy5zaG93QnVzeUluZGljYXRvcik7CiAgICAgIHBvc3QudGhlbihmdW5jdGlvbiAocmVzcG9uc2UpIHsKICAgICAgICBpZiAoIXJlc3BvbnNlIHx8IHJlc3BvbnNlLnN0YXR1cyAhPT0gMjAwKSB7CiAgICAgICAgICBfdGhpczguJE5vdGljZS5lcnJvcih7CiAgICAgICAgICAgIHRpdGxlOiAnJywKICAgICAgICAgICAgZGVzYzogJ+aVsOaNruWvvOWHuuWksei0pSwnICsgcmVzcG9uc2UuaW5mbwogICAgICAgICAgfSk7CgogICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KCiAgICAgICAgdHJ5IHsKICAgICAgICAgIGRvRXhwb3J0KEpTT04ucGFyc2UoSlNPTi5zdHJpbmdpZnkocmVzcG9uc2UuZGF0YSkpKTsKICAgICAgICB9IGNhdGNoIChlcnJvcikgewogICAgICAgICAgY29uc29sZS5lcnJvcihlcnJvcik7CiAgICAgICAgfQogICAgICB9KVsiY2F0Y2giXShmdW5jdGlvbiAocmVzcG9uc2UpIHsKICAgICAgICBpZiAocmVzcG9uc2UgJiYgcmVzcG9uc2Uuc3RhdHVzID09PSA0MDEpIHsKICAgICAgICAgIHJldHVybjsKICAgICAgICB9CgogICAgICAgIF90aGlzOC4kTm90aWNlLmVycm9yKHsKICAgICAgICAgIHRpdGxlOiAnJywKICAgICAgICAgIGRlc2M6ICfmlbDmja7lr7zlh7rlpLHotKUnCiAgICAgICAgfSk7CiAgICAgIH0pOwogICAgfQogICAgLyoqDQogICAgICog5a+85Ye65pWw5o2u5qC85byP5YyWDQogICAgICoNCiAgICAgKiBAcGFyYW0geyp9IGZpbHRlclZhbA0KICAgICAqIEBwYXJhbSB7Kn0ganNvbkRhdGENCiAgICAgKiBAcmV0dXJucyB7W119DQogICAgICogQG1lbWJlcm9mIE1haW5CYXNlDQogICAgICovCgogIH0sIHsKICAgIGtleTogImZvcm1hdEV4Y2VsRGF0YSIsCiAgICB2YWx1ZTogZnVuY3Rpb24gKCkgewogICAgICB2YXIgX2Zvcm1hdEV4Y2VsRGF0YSA9IF9hc3luY1RvR2VuZXJhdG9yKAogICAgICAvKiNfX1BVUkVfXyovCiAgICAgIHJlZ2VuZXJhdG9yUnVudGltZS5tYXJrKGZ1bmN0aW9uIF9jYWxsZWU0KGZpbHRlclZhbCwganNvbkRhdGEpIHsKICAgICAgICB2YXIgY29kZWxpc3RDb2x1bW5zLCBfdGhpcywgX2xvb3AsIF9pMiwgX2NvZGVsaXN0Q29sdW1uczsKCiAgICAgICAgcmV0dXJuIHJlZ2VuZXJhdG9yUnVudGltZS53cmFwKGZ1bmN0aW9uIF9jYWxsZWU0JChfY29udGV4dDUpIHsKICAgICAgICAgIHdoaWxlICgxKSB7CiAgICAgICAgICAgIHN3aXRjaCAoX2NvbnRleHQ1LnByZXYgPSBfY29udGV4dDUubmV4dCkgewogICAgICAgICAgICAgIGNhc2UgMDoKICAgICAgICAgICAgICAgIGNvZGVsaXN0Q29sdW1ucyA9IFt7CiAgICAgICAgICAgICAgICAgIG5hbWU6ICdkZGpsdHlwZScsCiAgICAgICAgICAgICAgICAgIHNyZmtleTogJ0VockNvZGVMaXN0MDIyNycsCiAgICAgICAgICAgICAgICAgIGNvZGVsaXN0VHlwZTogJ1NUQVRJQycsCiAgICAgICAgICAgICAgICAgIHRleHRTZXBhcmF0b3I6ICfjgIEnLAogICAgICAgICAgICAgICAgICByZW5kZXJNb2RlOiAnc3RyaW5nJywKICAgICAgICAgICAgICAgICAgdmFsdWVTZXBhcmF0b3I6ICI7IgogICAgICAgICAgICAgICAgfV07CiAgICAgICAgICAgICAgICBfdGhpcyA9IHRoaXM7CiAgICAgICAgICAgICAgICBfbG9vcCA9CiAgICAgICAgICAgICAgICAvKiNfX1BVUkVfXyovCiAgICAgICAgICAgICAgICByZWdlbmVyYXRvclJ1bnRpbWUubWFyayhmdW5jdGlvbiBfbG9vcCgpIHsKICAgICAgICAgICAgICAgICAgdmFyIGNvZGVsaXN0LCBpdGVtcywgX2l0ZW1zOwoKICAgICAgICAgICAgICAgICAgcmV0dXJuIHJlZ2VuZXJhdG9yUnVudGltZS53cmFwKGZ1bmN0aW9uIF9sb29wJChfY29udGV4dDQpIHsKICAgICAgICAgICAgICAgICAgICB3aGlsZSAoMSkgewogICAgICAgICAgICAgICAgICAgICAgc3dpdGNoIChfY29udGV4dDQucHJldiA9IF9jb250ZXh0NC5uZXh0KSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgMDoKICAgICAgICAgICAgICAgICAgICAgICAgICBjb2RlbGlzdCA9IF9jb2RlbGlzdENvbHVtbnNbX2kyXTsKCiAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCFPYmplY3QuaXMoY29kZWxpc3QuY29kZWxpc3RUeXBlLCAiRFlOQU1JQyIpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBfY29udGV4dDQubmV4dCA9IDg7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgICAgICAgIF9jb250ZXh0NC5uZXh0ID0gNDsKICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gX3RoaXMuY29kZUxpc3RTZXJ2aWNlLmdldEl0ZW1zKGNvZGVsaXN0LnNyZmtleSk7CgogICAgICAgICAgICAgICAgICAgICAgICBjYXNlIDQ6CiAgICAgICAgICAgICAgICAgICAgICAgICAgaXRlbXMgPSBfY29udGV4dDQuc2VudDsKICAgICAgICAgICAgICAgICAgICAgICAgICBqc29uRGF0YS5mb3JFYWNoKGZ1bmN0aW9uIChyb3cpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJvd1tjb2RlbGlzdC5uYW1lXSA9IF90aGlzLmdldENvZGVsaXN0VmFsdWUoaXRlbXMsIHJvd1tjb2RlbGlzdC5uYW1lXSwgY29kZWxpc3QpOwogICAgICAgICAgICAgICAgICAgICAgICAgIH0pOyAvLyDpnZnmgIHlpITnkIYKCiAgICAgICAgICAgICAgICAgICAgICAgICAgX2NvbnRleHQ0Lm5leHQgPSAxMzsKICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKCiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgODoKICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoIU9iamVjdC5pcyhjb2RlbGlzdC5jb2RlbGlzdFR5cGUsICJTVEFUSUMiKSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgX2NvbnRleHQ0Lm5leHQgPSAxMzsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgICAgICAgX2NvbnRleHQ0Lm5leHQgPSAxMTsKICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gX3RoaXMuJHN0b3JlLmdldHRlcnMuZ2V0Q29kZUxpc3RJdGVtcyhjb2RlbGlzdC5zcmZrZXkpOwoKICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAxMToKICAgICAgICAgICAgICAgICAgICAgICAgICBfaXRlbXMgPSBfY29udGV4dDQuc2VudDsKICAgICAgICAgICAgICAgICAgICAgICAgICBqc29uRGF0YS5mb3JFYWNoKGZ1bmN0aW9uIChyb3cpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJvd1tjb2RlbGlzdC5uYW1lXSA9IF90aGlzLmdldENvZGVsaXN0VmFsdWUoX2l0ZW1zLCByb3dbY29kZWxpc3QubmFtZV0sIGNvZGVsaXN0KTsKICAgICAgICAgICAgICAgICAgICAgICAgICB9KTsKCiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgMTM6CiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgImVuZCI6CiAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0NC5zdG9wKCk7CiAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICB9LCBfbG9vcCk7CiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIF9pMiA9IDAsIF9jb2RlbGlzdENvbHVtbnMgPSBjb2RlbGlzdENvbHVtbnM7CgogICAgICAgICAgICAgIGNhc2UgNDoKICAgICAgICAgICAgICAgIGlmICghKF9pMiA8IF9jb2RlbGlzdENvbHVtbnMubGVuZ3RoKSkgewogICAgICAgICAgICAgICAgICBfY29udGV4dDUubmV4dCA9IDk7CiAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDUuZGVsZWdhdGVZaWVsZChfbG9vcCgpLCAidDAiLCA2KTsKCiAgICAgICAgICAgICAgY2FzZSA2OgogICAgICAgICAgICAgICAgX2kyKys7CiAgICAgICAgICAgICAgICBfY29udGV4dDUubmV4dCA9IDQ7CiAgICAgICAgICAgICAgICBicmVhazsKCiAgICAgICAgICAgICAgY2FzZSA5OgogICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0NS5hYnJ1cHQoInJldHVybiIsIGpzb25EYXRhLm1hcChmdW5jdGlvbiAodikgewogICAgICAgICAgICAgICAgICByZXR1cm4gZmlsdGVyVmFsLm1hcChmdW5jdGlvbiAoaikgewogICAgICAgICAgICAgICAgICAgIHJldHVybiB2W2pdOwogICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIH0pKTsKCiAgICAgICAgICAgICAgY2FzZSAxMDoKICAgICAgICAgICAgICBjYXNlICJlbmQiOgogICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0NS5zdG9wKCk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9LCBfY2FsbGVlNCwgdGhpcyk7CiAgICAgIH0pKTsKCiAgICAgIGZ1bmN0aW9uIGZvcm1hdEV4Y2VsRGF0YShfeDMsIF94NCkgewogICAgICAgIHJldHVybiBfZm9ybWF0RXhjZWxEYXRhLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7CiAgICAgIH0KCiAgICAgIHJldHVybiBmb3JtYXRFeGNlbERhdGE7CiAgICB9KCkKICAgIC8qKg0KICAgICAqIOino+aekOS7o+eggeihqOWSjHZsYXVl77yM6K6+572uaXRlbXMNCiAgICAgKg0KICAgICAqIEBwdWJsaWMNCiAgICAgKiBAcGFyYW0ge2FueVtdfSBpdGVtcyDku6PnoIHooajmlbDmja4NCiAgICAgKiBAcGFyYW0geyp9IHZhbHVlDQogICAgICogQHJldHVybnMgeyp9DQogICAgICogQG1lbWJlcm9mIE1haW5CYXNlDQogICAgICovCgogIH0sIHsKICAgIGtleTogImdldENvZGVsaXN0VmFsdWUiLAogICAgdmFsdWU6IGZ1bmN0aW9uIGdldENvZGVsaXN0VmFsdWUoaXRlbXMsIHZhbHVlLCBjb2RlbGlzdCkgewogICAgICB2YXIgX3RoaXM5ID0gdGhpczsKCiAgICAgIGlmICghdmFsdWUpIHsKICAgICAgICByZXR1cm4gdGhpcy4kdCgnY29kZWxpc3QuJyArIGNvZGVsaXN0LnNyZmtleSArICcuZW1wdHknKTsKICAgICAgfQoKICAgICAgaWYgKGl0ZW1zKSB7CiAgICAgICAgdmFyIHJlc3VsdCA9IFtdOwoKICAgICAgICBpZiAoT2JqZWN0LmlzKGNvZGVsaXN0LnJlbmRlck1vZGUsICJudW1iZXIiKSkgewogICAgICAgICAgaXRlbXMubWFwKGZ1bmN0aW9uIChfaXRlbSwgaW5kZXgpIHsKICAgICAgICAgICAgdmFyIG5WYWx1ZSA9IHBhcnNlSW50KHZhbHVlLCAxMCk7CiAgICAgICAgICAgIHZhciBjb2RldmFsdWUgPSBfaXRlbS52YWx1ZTsKCiAgICAgICAgICAgIGlmICgocGFyc2VJbnQoY29kZXZhbHVlLCAxMCkgJiBuVmFsdWUpID4gMCkgewogICAgICAgICAgICAgIHJlc3VsdC5wdXNoKF9pdGVtKTsKICAgICAgICAgICAgfQogICAgICAgICAgfSk7CiAgICAgICAgfSBlbHNlIGlmIChPYmplY3QuaXMoY29kZWxpc3QucmVuZGVyTW9kZSwgInN0cmluZyIpKSB7CiAgICAgICAgICB2YXIgYXJyYXlWYWx1ZSA9IHZhbHVlLnNwbGl0KGNvZGVsaXN0LnZhbHVlU2VwYXJhdG9yKTsKICAgICAgICAgIGFycmF5VmFsdWUubWFwKGZ1bmN0aW9uICh2YWx1ZSwgaW5kZXgpIHsKICAgICAgICAgICAgcmVzdWx0LnB1c2goW10pOwogICAgICAgICAgICB2YXIgdmFsdWVzID0gT2JqZWN0LmlzKF90aGlzOS4kdXRpbC50eXBlT2YodmFsdWUpLCAnbnVtYmVyJykgPyBbdmFsdWVdIDogX3RvQ29uc3VtYWJsZUFycmF5KHZhbHVlLnNwbGl0KGNvZGVsaXN0LnZhbHVlU2VwYXJhdG9yKSk7CiAgICAgICAgICAgIHZhbHVlcy5tYXAoZnVuY3Rpb24gKHZhbCwgbnVtKSB7CiAgICAgICAgICAgICAgdmFyIGl0ZW0gPSBfdGhpczkuZ2V0SXRlbShpdGVtcywgdmFsLCBjb2RlbGlzdCk7CgogICAgICAgICAgICAgIGlmIChpdGVtKSB7CiAgICAgICAgICAgICAgICByZXN1bHRbaW5kZXhdLnB1c2goaXRlbSk7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9KTsKICAgICAgICAgIH0pOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICB2YXIgdmFsdWVzID0gT2JqZWN0LmlzKHRoaXMuJHV0aWwudHlwZU9mKHZhbHVlKSwgJ251bWJlcicpID8gW3ZhbHVlXSA6IF90b0NvbnN1bWFibGVBcnJheSh2YWx1ZS5zcGxpdChjb2RlbGlzdC52YWx1ZVNlcGFyYXRvcikpOwogICAgICAgICAgdmFsdWVzLm1hcChmdW5jdGlvbiAodmFsdWUsIGluZGV4KSB7CiAgICAgICAgICAgIHZhciBpdGVtID0gX3RoaXM5LmdldEl0ZW0oaXRlbXMsIHZhbHVlLCBjb2RlbGlzdCk7CgogICAgICAgICAgICBpZiAoaXRlbSkgewogICAgICAgICAgICAgIHJlc3VsdC5wdXNoKGl0ZW0pOwogICAgICAgICAgICB9CiAgICAgICAgICB9KTsKICAgICAgICB9IC8vIOiuvue9rml0ZW1zCgoKICAgICAgICBpZiAocmVzdWx0Lmxlbmd0aCAhPSAwKSB7CiAgICAgICAgICByZXR1cm4gcmVzdWx0LmpvaW4oY29kZWxpc3QudmFsdWVTZXBhcmF0b3IpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICByZXR1cm4gdmFsdWU7CiAgICAgICAgfQogICAgICB9CiAgICB9CiAgICAvKioNCiAgICAgKiDojrflj5bku6PnoIHpobkNCiAgICAgKg0KICAgICAqIEBwdWJsaWMNCiAgICAgKiBAcGFyYW0ge2FueVtdfSBpdGVtcw0KICAgICAqIEBwYXJhbSB7Kn0gdmFsdWUNCiAgICAgKiBAcmV0dXJucyB7Kn0NCiAgICAgKiBAbWVtYmVyb2YgTWFpbkJhc2UNCiAgICAgKi8KCiAgfSwgewogICAga2V5OiAiZ2V0SXRlbSIsCiAgICB2YWx1ZTogZnVuY3Rpb24gZ2V0SXRlbShpdGVtcywgdmFsdWUsIGNvZGVsaXN0KSB7CiAgICAgIHZhciBhcnIgPSBpdGVtcy5maWx0ZXIoZnVuY3Rpb24gKGl0ZW0pIHsKICAgICAgICByZXR1cm4gaXRlbS52YWx1ZSA9PSB2YWx1ZTsKICAgICAgfSk7CgogICAgICBpZiAoYXJyLmxlbmd0aCAhPT0gMSkgewogICAgICAgIHJldHVybiB1bmRlZmluZWQ7CiAgICAgIH0KCiAgICAgIGlmIChPYmplY3QuaXMoY29kZWxpc3QuY29kZWxpc3RUeXBlLCAnU1RBVElDJykpIHsKICAgICAgICByZXR1cm4gdGhpcy4kdCgnY29kZWxpc3QuJyArIGNvZGVsaXN0LnNyZmtleSArICcuJyArIGFyclswXS52YWx1ZSk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgcmV0dXJuIGFyclswXS50ZXh0OwogICAgICB9CiAgICB9CiAgICAvKioNCiAgICAgKiDnlJ/lkb3lkajmnJ8NCiAgICAgKg0KICAgICAqIEBtZW1iZXJvZiBNYWluQmFzZQ0KICAgICAqLwoKICB9LCB7CiAgICBrZXk6ICJjcmVhdGVkIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBjcmVhdGVkKCkgewogICAgICB0aGlzLmFmdGVyQ3JlYXRlZCgpOwogICAgfQogICAgLyoqDQogICAgICog5omn6KGMY3JlYXRlZOWQjueahOmAu+i+kQ0KICAgICAqDQogICAgICogIEBtZW1iZXJvZiBNYWluQmFzZQ0KICAgICAqLwoKICB9LCB7CiAgICBrZXk6ICJhZnRlckNyZWF0ZWQiLAogICAgdmFsdWU6IGZ1bmN0aW9uIGFmdGVyQ3JlYXRlZCgpIHsKICAgICAgdmFyIF90aGlzMTAgPSB0aGlzOwoKICAgICAgdGhpcy5zZXRDb2xTdGF0ZSgpOwoKICAgICAgaWYgKHRoaXMudmlld1N0YXRlKSB7CiAgICAgICAgdGhpcy52aWV3U3RhdGVFdmVudCA9IHRoaXMudmlld1N0YXRlLnN1YnNjcmliZShmdW5jdGlvbiAoX3JlZjMpIHsKICAgICAgICAgIHZhciB0YWcgPSBfcmVmMy50YWcsCiAgICAgICAgICAgICAgYWN0aW9uID0gX3JlZjMuYWN0aW9uLAogICAgICAgICAgICAgIGRhdGEgPSBfcmVmMy5kYXRhOwoKICAgICAgICAgIGlmICghT2JqZWN0LmlzKHRhZywgX3RoaXMxMC5uYW1lKSkgewogICAgICAgICAgICByZXR1cm47CiAgICAgICAgICB9CgogICAgICAgICAgaWYgKE9iamVjdC5pcygnbG9hZCcsIGFjdGlvbikpIHsKICAgICAgICAgICAgX3RoaXMxMC5sb2FkKGRhdGEpOwogICAgICAgICAgfQoKICAgICAgICAgIGlmIChPYmplY3QuaXMoJ3JlbW92ZScsIGFjdGlvbikpIHsKICAgICAgICAgICAgX3RoaXMxMC5yZW1vdmUoZGF0YSk7CiAgICAgICAgICB9CgogICAgICAgICAgaWYgKE9iamVjdC5pcygnc2F2ZScsIGFjdGlvbikpIHsKICAgICAgICAgICAgX3RoaXMxMC5zYXZlKGRhdGEpOwogICAgICAgICAgfQogICAgICAgIH0pOwogICAgICB9CiAgICB9CiAgICAvKioNCiAgICAgKiB2dWUg55Sf5ZG95ZGo5pyfDQogICAgICoNCiAgICAgKiBAbWVtYmVyb2YgTWFpbkJhc2UNCiAgICAgKi8KCiAgfSwgewogICAga2V5OiAiZGVzdHJveWVkIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBkZXN0cm95ZWQoKSB7CiAgICAgIHRoaXMuYWZ0ZXJEZXN0cm95KCk7CiAgICB9CiAgICAvKioNCiAgICAgKiDmiafooYxkZXN0cm95ZWTlkI7nmoTpgLvovpENCiAgICAgKg0KICAgICAqIEBtZW1iZXJvZiBNYWluQmFzZQ0KICAgICAqLwoKICB9LCB7CiAgICBrZXk6ICJhZnRlckRlc3Ryb3kiLAogICAgdmFsdWU6IGZ1bmN0aW9uIGFmdGVyRGVzdHJveSgpIHsKICAgICAgaWYgKHRoaXMudmlld1N0YXRlRXZlbnQpIHsKICAgICAgICB0aGlzLnZpZXdTdGF0ZUV2ZW50LnVuc3Vic2NyaWJlKCk7CiAgICAgIH0KICAgIH0KICAgIC8qKg0KICAgICAqIOiOt+WPlumAieS4reihjOiDoeaVsOaNrg0KICAgICAqDQogICAgICogQHJldHVybnMge2FueVtdfQ0KICAgICAqIEBtZW1iZXJvZiBNYWluQmFzZQ0KICAgICAqLwoKICB9LCB7CiAgICBrZXk6ICJnZXRTZWxlY3Rpb24iLAogICAgdmFsdWU6IGZ1bmN0aW9uIGdldFNlbGVjdGlvbigpIHsKICAgICAgcmV0dXJuIHRoaXMuc2VsZWN0aW9uczsKICAgIH0KICAgIC8qKg0KICAgICAqIOihjOWPjOWHu+S6i+S7tg0KICAgICAqDQogICAgICogQHBhcmFtIHsqfSAkZXZlbnQNCiAgICAgKiBAcmV0dXJucyB7dm9pZH0NCiAgICAgKiBAbWVtYmVyb2YgTWFpbkJhc2UNCiAgICAgKi8KCiAgfSwgewogICAga2V5OiAicm93REJMQ2xpY2siLAogICAgdmFsdWU6IGZ1bmN0aW9uIHJvd0RCTENsaWNrKCRldmVudCkgewogICAgICBpZiAoISRldmVudCB8fCB0aGlzLmFjdHVhbElzT3BlbkVkaXQgfHwgT2JqZWN0LmlzKHRoaXMuZ3JpZFJvd0FjdGl2ZU1vZGUsIDApKSB7CiAgICAgICAgcmV0dXJuOwogICAgICB9CgogICAgICB0aGlzLnNlbGVjdGlvbnMgPSBbXTsKICAgICAgdGhpcy5zZWxlY3Rpb25zLnB1c2goSlNPTi5wYXJzZShKU09OLnN0cmluZ2lmeSgkZXZlbnQpKSk7CiAgICAgIHZhciByZWZzID0gdGhpcy4kcmVmczsKCiAgICAgIGlmIChyZWZzLm11bHRpcGxlVGFibGUpIHsKICAgICAgICByZWZzLm11bHRpcGxlVGFibGUuY2xlYXJTZWxlY3Rpb24oKTsKICAgICAgICByZWZzLm11bHRpcGxlVGFibGUudG9nZ2xlUm93U2VsZWN0aW9uKCRldmVudCk7CiAgICAgIH0KCiAgICAgIHRoaXMuJGVtaXQoJ3Jvd2RibGNsaWNrJywgdGhpcy5zZWxlY3Rpb25zKTsKICAgICAgdGhpcy4kZW1pdCgnc2VsZWN0aW9uY2hhbmdlJywgdGhpcy5zZWxlY3Rpb25zKTsKICAgIH0KICAgIC8qKg0KICAgICAqIOWkjemAieahhuaVsOaNrumAieS4rQ0KICAgICAqDQogICAgICogQHBhcmFtIHsqfSAkZXZlbnQNCiAgICAgKiBAcmV0dXJucyB7dm9pZH0NCiAgICAgKiBAbWVtYmVyb2YgTWFpbkJhc2UNCiAgICAgKi8KCiAgfSwgewogICAga2V5OiAic2VsZWN0IiwKICAgIHZhbHVlOiBmdW5jdGlvbiBzZWxlY3QoJGV2ZW50KSB7CiAgICAgIGlmICghJGV2ZW50KSB7CiAgICAgICAgcmV0dXJuOwogICAgICB9CgogICAgICB0aGlzLnNlbGVjdGlvbnMgPSBbXTsKICAgICAgdGhpcy5zZWxlY3Rpb25zID0gX3RvQ29uc3VtYWJsZUFycmF5KEpTT04ucGFyc2UoSlNPTi5zdHJpbmdpZnkoJGV2ZW50KSkpOwogICAgICB0aGlzLiRlbWl0KCdzZWxlY3Rpb25jaGFuZ2UnLCB0aGlzLnNlbGVjdGlvbnMpOwogICAgfQogICAgLyoqDQogICAgICog5aSN6YCJ5qGG5pWw5o2u5YWo6YOo6YCJ5LitDQogICAgICoNCiAgICAgKiBAcGFyYW0geyp9ICRldmVudA0KICAgICAqIEBtZW1iZXJvZiBNYWluQmFzZQ0KICAgICAqLwoKICB9LCB7CiAgICBrZXk6ICJzZWxlY3RBbGwiLAogICAgdmFsdWU6IGZ1bmN0aW9uIHNlbGVjdEFsbCgkZXZlbnQpIHsKICAgICAgaWYgKCEkZXZlbnQpIHsKICAgICAgICByZXR1cm47CiAgICAgIH0KCiAgICAgIHRoaXMuc2VsZWN0aW9ucyA9IFtdOwogICAgICB0aGlzLnNlbGVjdGlvbnMgPSBfdG9Db25zdW1hYmxlQXJyYXkoSlNPTi5wYXJzZShKU09OLnN0cmluZ2lmeSgkZXZlbnQpKSk7CiAgICAgIHRoaXMuJGVtaXQoJ3NlbGVjdGlvbmNoYW5nZScsIHRoaXMuc2VsZWN0aW9ucyk7CiAgICB9CiAgICAvKioNCiAgICAgKiDooYzljZXlh7vpgInkuK0NCiAgICAgKg0KICAgICAqIEBwYXJhbSB7Kn0gJGV2ZW50DQogICAgICogQHJldHVybnMge3ZvaWR9DQogICAgICogQG1lbWJlcm9mIE1haW5CYXNlDQogICAgICovCgogIH0sIHsKICAgIGtleTogInJvd0NsaWNrIiwKICAgIHZhbHVlOiBmdW5jdGlvbiByb3dDbGljaygkZXZlbnQpIHsKICAgICAgdmFyIGlmQWx3YXlzID0gYXJndW1lbnRzLmxlbmd0aCA+IDEgJiYgYXJndW1lbnRzWzFdICE9PSB1bmRlZmluZWQgPyBhcmd1bWVudHNbMV0gOiBmYWxzZTsKCiAgICAgIGlmICghaWZBbHdheXMgJiYgKCEkZXZlbnQgfHwgdGhpcy5hY3R1YWxJc09wZW5FZGl0KSkgewogICAgICAgIHJldHVybjsKICAgICAgfQoKICAgICAgaWYgKHRoaXMuc3RvcFJvd0NsaWNrKSB7CiAgICAgICAgdGhpcy5zdG9wUm93Q2xpY2sgPSBmYWxzZTsKICAgICAgICByZXR1cm47CiAgICAgIH0KCiAgICAgIGlmICh0aGlzLmlzU2luZ2xlU2VsZWN0KSB7CiAgICAgICAgdGhpcy5zZWxlY3Rpb25zID0gW107CiAgICAgIH0gLy8g5bey6YCJ5Lit5YiZ5Yig6Zmk77yM5rKh6YCJ5Lit5YiZ5re75YqgCgoKICAgICAgdmFyIHNlbGVjdEluZGV4ID0gdGhpcy5zZWxlY3Rpb25zLmZpbmRJbmRleChmdW5jdGlvbiAoaXRlbSkgewogICAgICAgIHJldHVybiBPYmplY3QuaXMoaXRlbS5waW1hcmNoaXZlc2NoYW5nZSwgJGV2ZW50LnBpbWFyY2hpdmVzY2hhbmdlKTsKICAgICAgfSk7CgogICAgICBpZiAoT2JqZWN0LmlzKHNlbGVjdEluZGV4LCAtMSkpIHsKICAgICAgICB0aGlzLnNlbGVjdGlvbnMucHVzaChKU09OLnBhcnNlKEpTT04uc3RyaW5naWZ5KCRldmVudCkpKTsKICAgICAgfSBlbHNlIHsKICAgICAgICB0aGlzLnNlbGVjdGlvbnMuc3BsaWNlKHNlbGVjdEluZGV4LCAxKTsKICAgICAgfQoKICAgICAgdmFyIHJlZnMgPSB0aGlzLiRyZWZzOwoKICAgICAgaWYgKHJlZnMubXVsdGlwbGVUYWJsZSkgewogICAgICAgIGlmICh0aGlzLmlzU2luZ2xlU2VsZWN0KSB7CiAgICAgICAgICByZWZzLm11bHRpcGxlVGFibGUuY2xlYXJTZWxlY3Rpb24oKTsKICAgICAgICAgIHJlZnMubXVsdGlwbGVUYWJsZS5zZXRDdXJyZW50Um93KCRldmVudCk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIHJlZnMubXVsdGlwbGVUYWJsZS50b2dnbGVSb3dTZWxlY3Rpb24oJGV2ZW50KTsKICAgICAgICB9CiAgICAgIH0KCiAgICAgIHRoaXMuJGVtaXQoJ3NlbGVjdGlvbmNoYW5nZScsIHRoaXMuc2VsZWN0aW9ucyk7CiAgICB9CiAgICAvKioNCiAgICAgKiDpobXpnaLlj5jljJYNCiAgICAgKg0KICAgICAqIEBwYXJhbSB7Kn0gJGV2ZW50DQogICAgICogQHJldHVybnMge3ZvaWR9DQogICAgICogQG1lbWJlcm9mIE1haW5CYXNlDQogICAgICovCgogIH0sIHsKICAgIGtleTogInBhZ2VPbkNoYW5nZSIsCiAgICB2YWx1ZTogZnVuY3Rpb24gcGFnZU9uQ2hhbmdlKCRldmVudCkgewogICAgICBpZiAoISRldmVudCkgewogICAgICAgIHJldHVybjsKICAgICAgfQoKICAgICAgaWYgKCRldmVudCA9PT0gdGhpcy5jdXJQYWdlKSB7CiAgICAgICAgcmV0dXJuOwogICAgICB9CgogICAgICB0aGlzLmN1clBhZ2UgPSAkZXZlbnQ7CiAgICAgIHRoaXMubG9hZCh7fSk7CiAgICB9CiAgICAvKioNCiAgICAgKiDliIbpobXmnaHmlbDlj5jljJYNCiAgICAgKg0KICAgICAqIEBwYXJhbSB7Kn0gJGV2ZW50DQogICAgICogQHJldHVybnMge3ZvaWR9DQogICAgICogQG1lbWJlcm9mIE1haW5CYXNlDQogICAgICovCgogIH0sIHsKICAgIGtleTogIm9uUGFnZVNpemVDaGFuZ2UiLAogICAgdmFsdWU6IGZ1bmN0aW9uIG9uUGFnZVNpemVDaGFuZ2UoJGV2ZW50KSB7CiAgICAgIGlmICghJGV2ZW50KSB7CiAgICAgICAgcmV0dXJuOwogICAgICB9CgogICAgICBpZiAoJGV2ZW50ID09PSB0aGlzLmxpbWl0KSB7CiAgICAgICAgcmV0dXJuOwogICAgICB9CgogICAgICB0aGlzLmxpbWl0ID0gJGV2ZW50OwoKICAgICAgaWYgKHRoaXMuY3VyUGFnZSA9PT0gMSkgewogICAgICAgIHRoaXMubG9hZCh7fSk7CiAgICAgIH0KICAgIH0KICAgIC8qKg0KICAgICAqIOWIhumhteWIt+aWsA0KICAgICAqDQogICAgICogQG1lbWJlcm9mIE1haW5CYXNlDQogICAgICovCgogIH0sIHsKICAgIGtleTogInBhZ2VSZWZyZXNoIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBwYWdlUmVmcmVzaCgpIHsKICAgICAgdGhpcy5sb2FkKHt9KTsKICAgIH0KICAgIC8qKg0KICAgICAqIOaOkuW6j+WPmOWMlg0KICAgICAqDQogICAgICogQHBhcmFtIHt7IGNvbHVtbjogYW55LCBwcm9wOiBhbnksIG9yZGVyOiBhbnkgfX0geyBjb2x1bW4sIHByb3AsIG9yZGVyIH0NCiAgICAgKiBAbWVtYmVyb2YgTWFpbkJhc2UNCiAgICAgKi8KCiAgfSwgewogICAga2V5OiAib25Tb3J0Q2hhbmdlIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBvblNvcnRDaGFuZ2UoX3JlZjQpIHsKICAgICAgdmFyIGNvbHVtbiA9IF9yZWY0LmNvbHVtbiwKICAgICAgICAgIHByb3AgPSBfcmVmNC5wcm9wLAogICAgICAgICAgb3JkZXIgPSBfcmVmNC5vcmRlcjsKICAgICAgdmFyIGRpciA9IE9iamVjdC5pcyhvcmRlciwgJ2FzY2VuZGluZycpID8gJ2FzYycgOiBPYmplY3QuaXMob3JkZXIsICdkZXNjZW5kaW5nJykgPyAnZGVzYycgOiAnJzsKCiAgICAgIGlmIChPYmplY3QuaXMoZGlyLCB0aGlzLm1pbm9yU29ydERpcikgJiYgT2JqZWN0LmlzKHRoaXMubWlub3JTb3J0UFNERUYsIHByb3ApKSB7CiAgICAgICAgcmV0dXJuOwogICAgICB9CgogICAgICB0aGlzLm1pbm9yU29ydERpciA9IGRpcjsKICAgICAgdGhpcy5taW5vclNvcnRQU0RFRiA9IHByb3AgPyBwcm9wIDogJyc7CiAgICAgIHRoaXMubG9hZCh7fSk7CiAgICB9CiAgICAvKioNCiAgICAgKiDooajmoLzooYzpgInkuK3moLflvI8NCiAgICAgKg0KICAgICAqIEBwYXJhbSB7eyByb3c6IGFueSwgcm93SW5kZXg6IGFueSB9fSB7IHJvdywgcm93SW5kZXggfQ0KICAgICAqIEByZXR1cm5zIHtzdHJpbmd9DQogICAgICogQG1lbWJlcm9mIE1haW5CYXNlDQogICAgICovCgogIH0sIHsKICAgIGtleTogIm9uUm93Q2xhc3NOYW1lIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBvblJvd0NsYXNzTmFtZShfcmVmNSkgewogICAgICB2YXIgcm93ID0gX3JlZjUucm93LAogICAgICAgICAgcm93SW5kZXggPSBfcmVmNS5yb3dJbmRleDsKICAgICAgdmFyIGluZGV4ID0gdGhpcy5zZWxlY3Rpb25zLmZpbmRJbmRleChmdW5jdGlvbiAoc2VsZWN0KSB7CiAgICAgICAgcmV0dXJuIE9iamVjdC5pcyhzZWxlY3Quc3Jma2V5LCByb3cuc3Jma2V5KTsKICAgICAgfSk7CiAgICAgIHJldHVybiBpbmRleCAhPT0gLTEgPyAnZ3JpZC1yb3ctc2VsZWN0JyA6ICcnOwogICAgfQogICAgLyoqDQogICAgICog55WM6Z2i6KGM5Li6DQogICAgICoNCiAgICAgKiBAcGFyYW0geyp9IHJvdw0KICAgICAqIEBwYXJhbSB7Kn0gdGFnDQogICAgICogQHBhcmFtIHsqfSAkZXZlbnQNCiAgICAgKiBAbWVtYmVyb2YgTWFpbkJhc2UNCiAgICAgKi8KCiAgfSwgewogICAga2V5OiAidWlBY3Rpb24iLAogICAgdmFsdWU6IGZ1bmN0aW9uIHVpQWN0aW9uKHJvdywgdGFnLCAkZXZlbnQpIHsKICAgICAgLy8gdGhpcy5yb3dDbGljayhyb3csIHRydWUpOwogICAgICAkZXZlbnQuc3RvcFByb3BhZ2F0aW9uKCk7CiAgICB9CiAgICAvKioNCiAgICAgKiDorr7nva7liJfnirbmgIENCiAgICAgKg0KICAgICAqIEBtZW1iZXJvZiBNYWluQmFzZQ0KICAgICAqLwoKICB9LCB7CiAgICBrZXk6ICJzZXRDb2xTdGF0ZSIsCiAgICB2YWx1ZTogZnVuY3Rpb24gc2V0Q29sU3RhdGUoKSB7CiAgICAgIHZhciBfdGhpczExID0gdGhpczsKCiAgICAgIHZhciBfZGF0YSA9IGxvY2FsU3RvcmFnZS5nZXRJdGVtKCdwaW1hcmNoaXZlc2NoYW5nZV9tYWluX2dyaWQnKTsKCiAgICAgIGlmIChfZGF0YSkgewogICAgICAgIHZhciBjb2x1bW5zID0gSlNPTi5wYXJzZShfZGF0YSk7CiAgICAgICAgY29sdW1ucy5mb3JFYWNoKGZ1bmN0aW9uIChjb2wpIHsKICAgICAgICAgIHZhciBjb2x1bW4gPSBfdGhpczExLmFsbENvbHVtbnMuZmluZChmdW5jdGlvbiAoaXRlbSkgewogICAgICAgICAgICByZXR1cm4gT2JqZWN0LmlzKGNvbC5uYW1lLCBpdGVtLm5hbWUpOwogICAgICAgICAgfSk7CgogICAgICAgICAgaWYgKGNvbHVtbikgewogICAgICAgICAgICBPYmplY3QuYXNzaWduKGNvbHVtbiwgY29sKTsKICAgICAgICAgIH0KICAgICAgICB9KTsKICAgICAgfQogICAgfQogICAgLyoqDQogICAgICog5YiX5Y+Y5YyWDQogICAgICoNCiAgICAgKiBAbWVtYmVyb2YgTWFpbkJhc2UNCiAgICAgKi8KCiAgfSwgewogICAga2V5OiAib25Db2xDaGFuZ2UiLAogICAgdmFsdWU6IGZ1bmN0aW9uIG9uQ29sQ2hhbmdlKCkgewogICAgICBsb2NhbFN0b3JhZ2Uuc2V0SXRlbSgncGltYXJjaGl2ZXNjaGFuZ2VfbWFpbl9ncmlkJywgSlNPTi5zdHJpbmdpZnkodGhpcy5hbGxDb2x1bW5zKSk7CiAgICB9CiAgICAvKioNCiAgICAgKiDojrflj5bliJfnirbmgIENCiAgICAgKg0KICAgICAqIEBwYXJhbSB7c3RyaW5nfSBuYW1lDQogICAgICogQHJldHVybnMge2Jvb2xlYW59DQogICAgICogQG1lbWJlcm9mIE1haW5CYXNlDQogICAgICovCgogIH0sIHsKICAgIGtleTogImdldENvbHVtblN0YXRlIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBnZXRDb2x1bW5TdGF0ZShuYW1lKSB7CiAgICAgIHZhciBjb2x1bW4gPSB0aGlzLmFsbENvbHVtbnMuZmluZChmdW5jdGlvbiAoY29sKSB7CiAgICAgICAgcmV0dXJuIE9iamVjdC5pcyhuYW1lLCBjb2wubmFtZSk7CiAgICAgIH0pOwogICAgICByZXR1cm4gY29sdW1uLnNob3cgPyB0cnVlIDogZmFsc2U7CiAgICB9CiAgICAvKioNCiAgICAgKiDooajmoLzliJfmmK/lkKboh6rpgILlupTluIPlsYANCiAgICAgKg0KICAgICAqIEByZWFkb25seQ0KICAgICAqIEB0eXBlIHtib29sZWFufQ0KICAgICAqIEBtZW1iZXJvZiBNYWluQmFzZQ0KICAgICAqLwoKICB9LCB7CiAgICBrZXk6ICJzYXZlIiwKCiAgICAvKioNCiAgICAgKiDkv53lrZgNCiAgICAgKg0KICAgICAqIEBwYXJhbSB7Kn0gJGV2ZW50DQogICAgICogQHJldHVybnMge1Byb21pc2U8YW55Pn0NCiAgICAgKiBAbWVtYmVyb2YgTWFpbkJhc2UNCiAgICAgKi8KICAgIHZhbHVlOiBmdW5jdGlvbiAoKSB7CiAgICAgIHZhciBfc2F2ZSA9IF9hc3luY1RvR2VuZXJhdG9yKAogICAgICAvKiNfX1BVUkVfXyovCiAgICAgIHJlZ2VuZXJhdG9yUnVudGltZS5tYXJrKGZ1bmN0aW9uIF9jYWxsZWU1KGFyZ3MsIHBhcmFtcywgJGV2ZW50LCB4RGF0YSkgewogICAgICAgIHZhciBfdGhpczEyID0gdGhpczsKCiAgICAgICAgdmFyIF90aGlzLCBzdWNjZXNzSXRlbXMsIGVycm9ySXRlbXMsIGVycm9yTWVzc2FnZSwgX2l0ZXJhdG9yTm9ybWFsQ29tcGxldGlvbjIsIF9kaWRJdGVyYXRvckVycm9yMiwgX2l0ZXJhdG9yRXJyb3IyLCBfaXRlcmF0b3IyLCBfc3RlcDIsIGl0ZW0sIHJlc3BvbnNlLCBfcmVzcG9uc2U7CgogICAgICAgIHJldHVybiByZWdlbmVyYXRvclJ1bnRpbWUud3JhcChmdW5jdGlvbiBfY2FsbGVlNSQoX2NvbnRleHQ2KSB7CiAgICAgICAgICB3aGlsZSAoMSkgewogICAgICAgICAgICBzd2l0Y2ggKF9jb250ZXh0Ni5wcmV2ID0gX2NvbnRleHQ2Lm5leHQpIHsKICAgICAgICAgICAgICBjYXNlIDA6CiAgICAgICAgICAgICAgICBfdGhpcyA9IHRoaXM7CiAgICAgICAgICAgICAgICBfY29udGV4dDYubmV4dCA9IDM7CiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy52YWxpZGF0ZUFsbCgpOwoKICAgICAgICAgICAgICBjYXNlIDM6CiAgICAgICAgICAgICAgICBpZiAoX2NvbnRleHQ2LnNlbnQpIHsKICAgICAgICAgICAgICAgICAgX2NvbnRleHQ2Lm5leHQgPSA2OwogICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICB0aGlzLiROb3RpY2UuZXJyb3IoewogICAgICAgICAgICAgICAgICB0aXRsZTogJ+mUmeivrycsCiAgICAgICAgICAgICAgICAgIGRlc2M6ICflgLzop4TliJnmoKHpqozlvILluLgnCiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDYuYWJydXB0KCJyZXR1cm4iLCBbXSk7CgogICAgICAgICAgICAgIGNhc2UgNjoKICAgICAgICAgICAgICAgIHN1Y2Nlc3NJdGVtcyA9IFtdOwogICAgICAgICAgICAgICAgZXJyb3JJdGVtcyA9IFtdOwogICAgICAgICAgICAgICAgZXJyb3JNZXNzYWdlID0gW107CiAgICAgICAgICAgICAgICBfaXRlcmF0b3JOb3JtYWxDb21wbGV0aW9uMiA9IHRydWU7CiAgICAgICAgICAgICAgICBfZGlkSXRlcmF0b3JFcnJvcjIgPSBmYWxzZTsKICAgICAgICAgICAgICAgIF9pdGVyYXRvckVycm9yMiA9IHVuZGVmaW5lZDsKICAgICAgICAgICAgICAgIF9jb250ZXh0Ni5wcmV2ID0gMTI7CiAgICAgICAgICAgICAgICBfaXRlcmF0b3IyID0gX3RoaXMuaXRlbXNbU3ltYm9sLml0ZXJhdG9yXSgpOwoKICAgICAgICAgICAgICBjYXNlIDE0OgogICAgICAgICAgICAgICAgaWYgKF9pdGVyYXRvck5vcm1hbENvbXBsZXRpb24yID0gKF9zdGVwMiA9IF9pdGVyYXRvcjIubmV4dCgpKS5kb25lKSB7CiAgICAgICAgICAgICAgICAgIF9jb250ZXh0Ni5uZXh0ID0gNDk7CiAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIGl0ZW0gPSBfc3RlcDIudmFsdWU7CiAgICAgICAgICAgICAgICBfY29udGV4dDYucHJldiA9IDE2OwoKICAgICAgICAgICAgICAgIGlmICghT2JqZWN0LmlzKGl0ZW0ucm93RGF0YVN0YXRlLCAnY3JlYXRlJykpIHsKICAgICAgICAgICAgICAgICAgX2NvbnRleHQ2Lm5leHQgPSAyOTsKICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgaWYgKHRoaXMuY3JlYXRlQWN0aW9uKSB7CiAgICAgICAgICAgICAgICAgIF9jb250ZXh0Ni5uZXh0ID0gMjI7CiAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIHRoaXMuJE5vdGljZS5lcnJvcih7CiAgICAgICAgICAgICAgICAgIHRpdGxlOiAn6ZSZ6K+vJywKICAgICAgICAgICAgICAgICAgZGVzYzogJ1BJTUFSQ0hJVkVTQ0hBTkdFR3JpZFZpZXfop4blm77ooajmoLxjcmVhdGVBY3Rpb27lj4LmlbDmnKrphY3nva4nCiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIF9jb250ZXh0Ni5uZXh0ID0gMjc7CiAgICAgICAgICAgICAgICBicmVhazsKCiAgICAgICAgICAgICAgY2FzZSAyMjoKICAgICAgICAgICAgICAgIE9iamVjdC5hc3NpZ24oaXRlbSwgewogICAgICAgICAgICAgICAgICB2aWV3cGFyYW1zOiB0aGlzLnZpZXdwYXJhbXMKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgX2NvbnRleHQ2Lm5leHQgPSAyNTsKICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLnNlcnZpY2UuYWRkKHRoaXMuY3JlYXRlQWN0aW9uLCBKU09OLnBhcnNlKEpTT04uc3RyaW5naWZ5KHRoaXMuY29udGV4dCkpLCBpdGVtLCB0aGlzLnNob3dCdXN5SW5kaWNhdG9yKTsKCiAgICAgICAgICAgICAgY2FzZSAyNToKICAgICAgICAgICAgICAgIHJlc3BvbnNlID0gX2NvbnRleHQ2LnNlbnQ7CiAgICAgICAgICAgICAgICBzdWNjZXNzSXRlbXMucHVzaChKU09OLnBhcnNlKEpTT04uc3RyaW5naWZ5KHJlc3BvbnNlLmRhdGEpKSk7CgogICAgICAgICAgICAgIGNhc2UgMjc6CiAgICAgICAgICAgICAgICBfY29udGV4dDYubmV4dCA9IDQwOwogICAgICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgICAgIGNhc2UgMjk6CiAgICAgICAgICAgICAgICBpZiAoIU9iamVjdC5pcyhpdGVtLnJvd0RhdGFTdGF0ZSwgJ3VwZGF0ZScpKSB7CiAgICAgICAgICAgICAgICAgIF9jb250ZXh0Ni5uZXh0ID0gNDA7CiAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIGlmICh0aGlzLnVwZGF0ZUFjdGlvbikgewogICAgICAgICAgICAgICAgICBfY29udGV4dDYubmV4dCA9IDM0OwogICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICB0aGlzLiROb3RpY2UuZXJyb3IoewogICAgICAgICAgICAgICAgICB0aXRsZTogJ+mUmeivrycsCiAgICAgICAgICAgICAgICAgIGRlc2M6ICdQSU1BUkNISVZFU0NIQU5HRUdyaWRWaWV36KeG5Zu+6KGo5qC8dXBkYXRlQWN0aW9u5Y+C5pWw5pyq6YWN572uJwogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICBfY29udGV4dDYubmV4dCA9IDQwOwogICAgICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgICAgIGNhc2UgMzQ6CiAgICAgICAgICAgICAgICBPYmplY3QuYXNzaWduKGl0ZW0sIHsKICAgICAgICAgICAgICAgICAgdmlld3BhcmFtczogdGhpcy52aWV3cGFyYW1zCiAgICAgICAgICAgICAgICB9KTsKCiAgICAgICAgICAgICAgICBpZiAoaXRlbS5waW1hcmNoaXZlc2NoYW5nZSkgewogICAgICAgICAgICAgICAgICBPYmplY3QuYXNzaWduKHRoaXMuY29udGV4dCwgewogICAgICAgICAgICAgICAgICAgIHBpbWFyY2hpdmVzY2hhbmdlOiBpdGVtLnBpbWFyY2hpdmVzY2hhbmdlCiAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIF9jb250ZXh0Ni5uZXh0ID0gMzg7CiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5zZXJ2aWNlLmFkZCh0aGlzLnVwZGF0ZUFjdGlvbiwgSlNPTi5wYXJzZShKU09OLnN0cmluZ2lmeSh0aGlzLmNvbnRleHQpKSwgaXRlbSwgdGhpcy5zaG93QnVzeUluZGljYXRvcik7CgogICAgICAgICAgICAgIGNhc2UgMzg6CiAgICAgICAgICAgICAgICBfcmVzcG9uc2UgPSBfY29udGV4dDYuc2VudDsKICAgICAgICAgICAgICAgIHN1Y2Nlc3NJdGVtcy5wdXNoKEpTT04ucGFyc2UoSlNPTi5zdHJpbmdpZnkoX3Jlc3BvbnNlLmRhdGEpKSk7CgogICAgICAgICAgICAgIGNhc2UgNDA6CiAgICAgICAgICAgICAgICBfY29udGV4dDYubmV4dCA9IDQ2OwogICAgICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgICAgIGNhc2UgNDI6CiAgICAgICAgICAgICAgICBfY29udGV4dDYucHJldiA9IDQyOwogICAgICAgICAgICAgICAgX2NvbnRleHQ2LnQwID0gX2NvbnRleHQ2WyJjYXRjaCJdKDE2KTsKICAgICAgICAgICAgICAgIGVycm9ySXRlbXMucHVzaChKU09OLnBhcnNlKEpTT04uc3RyaW5naWZ5KGl0ZW0pKSk7CiAgICAgICAgICAgICAgICBlcnJvck1lc3NhZ2UucHVzaChfY29udGV4dDYudDApOwoKICAgICAgICAgICAgICBjYXNlIDQ2OgogICAgICAgICAgICAgICAgX2l0ZXJhdG9yTm9ybWFsQ29tcGxldGlvbjIgPSB0cnVlOwogICAgICAgICAgICAgICAgX2NvbnRleHQ2Lm5leHQgPSAxNDsKICAgICAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgICAgICBjYXNlIDQ5OgogICAgICAgICAgICAgICAgX2NvbnRleHQ2Lm5leHQgPSA1NTsKICAgICAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgICAgICBjYXNlIDUxOgogICAgICAgICAgICAgICAgX2NvbnRleHQ2LnByZXYgPSA1MTsKICAgICAgICAgICAgICAgIF9jb250ZXh0Ni50MSA9IF9jb250ZXh0NlsiY2F0Y2giXSgxMik7CiAgICAgICAgICAgICAgICBfZGlkSXRlcmF0b3JFcnJvcjIgPSB0cnVlOwogICAgICAgICAgICAgICAgX2l0ZXJhdG9yRXJyb3IyID0gX2NvbnRleHQ2LnQxOwoKICAgICAgICAgICAgICBjYXNlIDU1OgogICAgICAgICAgICAgICAgX2NvbnRleHQ2LnByZXYgPSA1NTsKICAgICAgICAgICAgICAgIF9jb250ZXh0Ni5wcmV2ID0gNTY7CgogICAgICAgICAgICAgICAgaWYgKCFfaXRlcmF0b3JOb3JtYWxDb21wbGV0aW9uMiAmJiBfaXRlcmF0b3IyWyJyZXR1cm4iXSAhPSBudWxsKSB7CiAgICAgICAgICAgICAgICAgIF9pdGVyYXRvcjJbInJldHVybiJdKCk7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgIGNhc2UgNTg6CiAgICAgICAgICAgICAgICBfY29udGV4dDYucHJldiA9IDU4OwoKICAgICAgICAgICAgICAgIGlmICghX2RpZEl0ZXJhdG9yRXJyb3IyKSB7CiAgICAgICAgICAgICAgICAgIF9jb250ZXh0Ni5uZXh0ID0gNjE7CiAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIHRocm93IF9pdGVyYXRvckVycm9yMjsKCiAgICAgICAgICAgICAgY2FzZSA2MToKICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDYuZmluaXNoKDU4KTsKCiAgICAgICAgICAgICAgY2FzZSA2MjoKICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDYuZmluaXNoKDU1KTsKCiAgICAgICAgICAgICAgY2FzZSA2MzoKICAgICAgICAgICAgICAgIHRoaXMuJGVtaXQoJ3NhdmUnLCBzdWNjZXNzSXRlbXMpOwogICAgICAgICAgICAgICAgdGhpcy5yZWZyZXNoKFtdKTsKCiAgICAgICAgICAgICAgICBpZiAoZXJyb3JJdGVtcy5sZW5ndGggPT09IDApIHsKICAgICAgICAgICAgICAgICAgdGhpcy4kTm90aWNlLnN1Y2Nlc3MoewogICAgICAgICAgICAgICAgICAgIHRpdGxlOiAnJywKICAgICAgICAgICAgICAgICAgICBkZXNjOiAn5L+d5a2Y5oiQ5YqfIScKICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICBlcnJvckl0ZW1zLmZvckVhY2goZnVuY3Rpb24gKGl0ZW0sIGluZGV4KSB7CiAgICAgICAgICAgICAgICAgICAgX3RoaXMxMi4kTm90aWNlLmVycm9yKHsKICAgICAgICAgICAgICAgICAgICAgIHRpdGxlOiAn5L+d5a2Y5aSx6LSlJywKICAgICAgICAgICAgICAgICAgICAgIGRlc2M6IGl0ZW0ubWFqb3JlbnRpdHluYW1lICsgJ+S/neWtmOWksei0pe+8gScKICAgICAgICAgICAgICAgICAgICB9KTsKCiAgICAgICAgICAgICAgICAgICAgY29uc29sZS5lcnJvcihlcnJvck1lc3NhZ2VbaW5kZXhdKTsKICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0Ni5hYnJ1cHQoInJldHVybiIsIHN1Y2Nlc3NJdGVtcyk7CgogICAgICAgICAgICAgIGNhc2UgNjc6CiAgICAgICAgICAgICAgY2FzZSAiZW5kIjoKICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDYuc3RvcCgpOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSwgX2NhbGxlZTUsIHRoaXMsIFtbMTIsIDUxLCA1NSwgNjNdLCBbMTYsIDQyXSwgWzU2LCwgNTgsIDYyXV0pOwogICAgICB9KSk7CgogICAgICBmdW5jdGlvbiBzYXZlKF94NSwgX3g2LCBfeDcsIF94OCkgewogICAgICAgIHJldHVybiBfc2F2ZS5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwogICAgICB9CgogICAgICByZXR1cm4gc2F2ZTsKICAgIH0oKQogICAgLyoqDQogICAgICog5paw5bu66KGMDQogICAgICoNCiAgICAgKiBAcGFyYW0geyp9ICRldmVudA0KICAgICAqIEByZXR1cm5zIHt2b2lkfQ0KICAgICAqIEBtZW1iZXJvZiBNYWluQmFzZQ0KICAgICAqLwoKICB9LCB7CiAgICBrZXk6ICJuZXdSb3ciLAogICAgdmFsdWU6IGZ1bmN0aW9uIG5ld1JvdyhhcmdzLCBwYXJhbXMsICRldmVudCwgeERhdGEpIHsKICAgICAgdmFyIF90aGlzMTMgPSB0aGlzOwoKICAgICAgaWYgKCF0aGlzLmxvYWRkcmFmdEFjdGlvbikgewogICAgICAgIHRoaXMuJE5vdGljZS5lcnJvcih7CiAgICAgICAgICB0aXRsZTogJ+mUmeivrycsCiAgICAgICAgICBkZXNjOiAnUElNQVJDSElWRVNDSEFOR0VHcmlkVmlld+inhuWbvuihqOagvGxvYWRkcmFmdEFjdGlvbuWPguaVsOacqumFjee9ricKICAgICAgICB9KTsKICAgICAgICByZXR1cm47CiAgICAgIH0KCiAgICAgIHZhciBfdGhpcyA9IHRoaXM7CgogICAgICBPYmplY3QuYXNzaWduKGFyZ3NbMF0sIHsKICAgICAgICB2aWV3cGFyYW1zOiB0aGlzLnZpZXdwYXJhbXMKICAgICAgfSk7CiAgICAgIHZhciBwb3N0ID0gdGhpcy5zZXJ2aWNlLmxvYWREcmFmdCh0aGlzLmxvYWRkcmFmdEFjdGlvbiwgSlNPTi5wYXJzZShKU09OLnN0cmluZ2lmeSh0aGlzLmNvbnRleHQpKSwgYXJnc1swXSwgdGhpcy5zaG93QnVzeUluZGljYXRvcik7CiAgICAgIHBvc3QudGhlbihmdW5jdGlvbiAocmVzcG9uc2UpIHsKICAgICAgICBpZiAoIXJlc3BvbnNlLnN0YXR1cyB8fCByZXNwb25zZS5zdGF0dXMgIT09IDIwMCkgewogICAgICAgICAgaWYgKHJlc3BvbnNlLmVycm9yTWVzc2FnZSkgewogICAgICAgICAgICBfdGhpczEzLiROb3RpY2UuZXJyb3IoewogICAgICAgICAgICAgIHRpdGxlOiAn6ZSZ6K+vJywKICAgICAgICAgICAgICBkZXNjOiByZXNwb25zZS5lcnJvck1lc3NhZ2UKICAgICAgICAgICAgfSk7CiAgICAgICAgICB9CgogICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KCiAgICAgICAgdmFyIGRhdGEgPSByZXNwb25zZS5kYXRhOwoKICAgICAgICBfdGhpczEzLmNyZWF0ZURlZmF1bHQoZGF0YSk7CgogICAgICAgIGRhdGEucm93RGF0YVN0YXRlID0gImNyZWF0ZSI7CgogICAgICAgIF90aGlzLml0ZW1zLnB1c2goZGF0YSk7CgogICAgICAgIF90aGlzLmdyaWRJdGVtc01vZGVsLnB1c2goX3RoaXMuZ2V0R3JpZFJvd01vZGVsKCkpOwogICAgICB9KVsiY2F0Y2giXShmdW5jdGlvbiAocmVzcG9uc2UpIHsKICAgICAgICBpZiAocmVzcG9uc2UgJiYgcmVzcG9uc2Uuc3RhdHVzID09PSA0MDEpIHsKICAgICAgICAgIHJldHVybjsKICAgICAgICB9CgogICAgICAgIGlmICghcmVzcG9uc2UgfHwgIXJlc3BvbnNlLnN0YXR1cyB8fCAhcmVzcG9uc2UuZGF0YSkgewogICAgICAgICAgX3RoaXMxMy4kTm90aWNlLmVycm9yKHsKICAgICAgICAgICAgdGl0bGU6ICfplJnor68nLAogICAgICAgICAgICBkZXNjOiAn57O757uf5byC5bi4JwogICAgICAgICAgfSk7CgogICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KICAgICAgfSk7CiAgICB9CiAgICAvKioNCiAgICAgKiDooajmoLznvJbovpHpobnlgLzlj5jmm7QNCiAgICAgKg0KICAgICAqIEBwYXJhbSByb3cg6KGM5pWw5o2uDQogICAgICogQHBhcmFtIHt7IG5hbWU6IHN0cmluZywgdmFsdWU6IGFueSB9fSAkZXZlbnQNCiAgICAgKiBAcmV0dXJucyB7dm9pZH0NCiAgICAgKiBAbWVtYmVyb2YgTWFpbkJhc2UNCiAgICAgKi8KCiAgfSwgewogICAga2V5OiAib25HcmlkSXRlbVZhbHVlQ2hhbmdlIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBvbkdyaWRJdGVtVmFsdWVDaGFuZ2Uocm93LCAkZXZlbnQsIHJvd0luZGV4KSB7CiAgICAgIGlmICghJGV2ZW50KSB7CiAgICAgICAgcmV0dXJuOwogICAgICB9CgogICAgICBpZiAoISRldmVudC5uYW1lIHx8IE9iamVjdC5pcygkZXZlbnQubmFtZSwgJycpIHx8ICFyb3cuaGFzT3duUHJvcGVydHkoJGV2ZW50Lm5hbWUpKSB7CiAgICAgICAgcmV0dXJuOwogICAgICB9CgogICAgICByb3dbJGV2ZW50Lm5hbWVdID0gJGV2ZW50LnZhbHVlOwogICAgICB0aGlzLmdyaWRFZGl0SXRlbUNoYW5nZShyb3csICRldmVudC5uYW1lLCAkZXZlbnQudmFsdWUsIHJvd0luZGV4KTsKICAgIH0KICAgIC8qKg0KICAgICAqIOihqOagvOe8lui+kemhueWAvOWPmOWMlg0KICAgICAqDQogICAgICogQHB1YmxpYw0KICAgICAqIEBwYXJhbSByb3cg6KGM5pWw5o2uDQogICAgICogQHBhcmFtIHByb3BlcnR5IOWIl+e8lui+kemhueWQjQ0KICAgICAqIEBwYXJhbSByb3cg5YiX57yW6L6R6aG55YC8DQogICAgICogQHJldHVybnMge3ZvaWR9DQogICAgICogQG1lbWJlcm9mIE1haW5CYXNlDQogICAgICovCgogIH0sIHsKICAgIGtleTogImdyaWRFZGl0SXRlbUNoYW5nZSIsCiAgICB2YWx1ZTogZnVuY3Rpb24gZ3JpZEVkaXRJdGVtQ2hhbmdlKHJvdywgcHJvcGVydHksIHZhbHVlLCByb3dJbmRleCkgewogICAgICByb3cucm93RGF0YVN0YXRlID0gcm93LnJvd0RhdGFTdGF0ZSA/IHJvdy5yb3dEYXRhU3RhdGUgOiAidXBkYXRlIjsKICAgICAgdGhpcy52YWxpZGF0ZShwcm9wZXJ0eSwgcm93LCByb3dJbmRleCk7CiAgICB9CiAgICAvKioNCiAgICAgKiDooajmoLznvJbovpHpobnmm7TmlrANCiAgICAgKg0KICAgICAqIEBwYXJhbSB7c3RyaW5nfSBtb2RlIOeVjOmdouihjOS4uuWQjeensA0KICAgICAqIEBwYXJhbSB7Kn0gW2RhdGE9e31dIOivt+axguaVsOaNrg0KICAgICAqIEBwYXJhbSB7c3RyaW5nW119IHVwZGF0ZURldGFpbHMg5pu05paw6aG5DQogICAgICogQHBhcmFtIHtib29sZWFufSBbc2hvd2xvYWRpbmddIOaYr+WQpuaYvuekuuWKoOi9veeKtuaAgQ0KICAgICAqIEByZXR1cm5zIHt2b2lkfQ0KICAgICAqIEBtZW1iZXJvZiBNYWluQmFzZQ0KICAgICAqLwoKICB9LCB7CiAgICBrZXk6ICJ1cGRhdGVHcmlkRWRpdEl0ZW0iLAogICAgdmFsdWU6IGZ1bmN0aW9uIHVwZGF0ZUdyaWRFZGl0SXRlbShtb2RlKSB7CiAgICAgIHZhciBfdGhpczE0ID0gdGhpczsKCiAgICAgIHZhciBkYXRhID0gYXJndW1lbnRzLmxlbmd0aCA+IDEgJiYgYXJndW1lbnRzWzFdICE9PSB1bmRlZmluZWQgPyBhcmd1bWVudHNbMV0gOiB7fTsKICAgICAgdmFyIHVwZGF0ZURldGFpbHMgPSBhcmd1bWVudHMubGVuZ3RoID4gMiA/IGFyZ3VtZW50c1syXSA6IHVuZGVmaW5lZDsKICAgICAgdmFyIHNob3dsb2FkaW5nID0gYXJndW1lbnRzLmxlbmd0aCA+IDMgPyBhcmd1bWVudHNbM10gOiB1bmRlZmluZWQ7CgogICAgICBpZiAoIW1vZGUgfHwgbW9kZSAmJiBPYmplY3QuaXMobW9kZSwgJycpKSB7CiAgICAgICAgcmV0dXJuOwogICAgICB9CgogICAgICB2YXIgYXJnID0gSlNPTi5wYXJzZShKU09OLnN0cmluZ2lmeShkYXRhKSk7CiAgICAgIE9iamVjdC5hc3NpZ24oYXJnLCB7CiAgICAgICAgdmlld3BhcmFtczogdGhpcy52aWV3cGFyYW1zCiAgICAgIH0pOwogICAgICB2YXIgcG9zdCA9IHRoaXMuc2VydmljZS5mcm9udExvZ2ljKG1vZGUsIEpTT04ucGFyc2UoSlNPTi5zdHJpbmdpZnkodGhpcy5jb250ZXh0KSksIGFyZywgc2hvd2xvYWRpbmcpOwogICAgICBwb3N0LnRoZW4oZnVuY3Rpb24gKHJlc3BvbnNlKSB7CiAgICAgICAgaWYgKCFyZXNwb25zZSB8fCByZXNwb25zZS5zdGF0dXMgIT09IDIwMCkgewogICAgICAgICAgX3RoaXMxNC4kTm90aWNlLmVycm9yKHsKICAgICAgICAgICAgdGl0bGU6ICfplJnor68nLAogICAgICAgICAgICBkZXNjOiAn6KGo5Y2V6aG55pu05paw5aSx6LSlJwogICAgICAgICAgfSk7CgogICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KCiAgICAgICAgdmFyIF9kYXRhID0gcmVzcG9uc2UuZGF0YTsKCiAgICAgICAgaWYgKCFfZGF0YSkgewogICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KCiAgICAgICAgdXBkYXRlRGV0YWlscy5mb3JFYWNoKGZ1bmN0aW9uIChuYW1lKSB7CiAgICAgICAgICBpZiAoIV9kYXRhLmhhc093blByb3BlcnR5KG5hbWUpKSB7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgIH0KCiAgICAgICAgICBkYXRhW25hbWVdID0gX2RhdGFbbmFtZV07CiAgICAgICAgfSk7CiAgICAgIH0pWyJjYXRjaCJdKGZ1bmN0aW9uIChyZXNwb25zZSkgewogICAgICAgIGlmIChyZXNwb25zZSAmJiByZXNwb25zZS5zdGF0dXMgPT09IDQwMSkgewogICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KCiAgICAgICAgaWYgKCFyZXNwb25zZSB8fCAhcmVzcG9uc2Uuc3RhdHVzIHx8ICFyZXNwb25zZS5kYXRhKSB7CiAgICAgICAgICBfdGhpczE0LiROb3RpY2UuZXJyb3IoewogICAgICAgICAgICB0aXRsZTogJ+mUmeivrycsCiAgICAgICAgICAgIGRlc2M6ICfns7vnu5/lvILluLgnCiAgICAgICAgICB9KTsKCiAgICAgICAgICByZXR1cm47CiAgICAgICAgfQogICAgICB9KTsKICAgIH0KICAgIC8qKg0KICAgICAqIOiOt+WPluWvueW6lOihjGNsYXNzDQogICAgICoNCiAgICAgKiBAcGFyYW0geyp9ICRhcmdzIHJvdyDooYzmlbDmja7vvIxyb3dJbmRleCDooYzntKLlvJUNCiAgICAgKiBAcmV0dXJucyB7dm9pZH0NCiAgICAgKiBAbWVtYmVyb2YgTWFpbkJhc2UNCiAgICAgKi8KCiAgfSwgewogICAga2V5OiAiZ2V0Um93Q2xhc3NOYW1lIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBnZXRSb3dDbGFzc05hbWUoYXJncykgewogICAgICB2YXIgaXNTZWxlY3RlZCA9IHRoaXMuc2VsZWN0aW9ucy5zb21lKGZ1bmN0aW9uIChpdGVtKSB7CiAgICAgICAgcmV0dXJuIE9iamVjdC5pcyhpdGVtLnBpbWFyY2hpdmVzY2hhbmdlLCBhcmdzLnJvdy5waW1hcmNoaXZlc2NoYW5nZSk7CiAgICAgIH0pOwogICAgICByZXR1cm4gaXNTZWxlY3RlZCA/ICJncmlkLXNlbGVjdGVkLXJvdyIgOiAiIjsKICAgIH0KICAgIC8qKg0KICAgICAqIOiOt+WPluWvueW6lOWIl2NsYXNzDQogICAgICoNCiAgICAgKiBAcGFyYW0geyp9ICRhcmdzIHJvdyDooYzmlbDmja7vvIxjb2x1bW4g5YiX5pWw5o2u77yMcm93SW5kZXgg6KGM57Si5byV77yM5YiX57Si5byVDQogICAgICogQHJldHVybnMge3ZvaWR9DQogICAgICogQG1lbWJlcm9mIE1haW5CYXNlDQogICAgICovCgogIH0sIHsKICAgIGtleTogImdldENlbGxDbGFzc05hbWUiLAogICAgdmFsdWU6IGZ1bmN0aW9uIGdldENlbGxDbGFzc05hbWUoYXJncykgewogICAgICB2YXIgaGFzUm93RWRpdCA9IHsKICAgICAgICAnZGRqbHR5cGUnOiBmYWxzZSwKICAgICAgICAnb3Jtb3JnbmFtZSc6IGZhbHNlLAogICAgICAgICdvcm1vcmduYW1lMic6IGZhbHNlLAogICAgICAgICdqbGNzc2onOiBmYWxzZSwKICAgICAgICAnYnonOiBmYWxzZQogICAgICB9OwogICAgICByZXR1cm4gaGFzUm93RWRpdFthcmdzLmNvbHVtbi5wcm9wZXJ0eV0gJiYgdGhpcy5hY3R1YWxJc09wZW5FZGl0ID8gImVkaXQtY2VsbCIgOiAiaW5mby1jZWxsIjsKICAgIH0KICAgIC8qKg0KICAgICAqIOaWsOW7uum7mOiupOWAvA0KICAgICAqIEBwYXJhbSB7Kn0gIHJvdyDooYzmlbDmja4NCiAgICAgKiBAbWVtYmVyb2YgTWFpbkJhc2UNCiAgICAgKi8KCiAgfSwgewogICAga2V5OiAiY3JlYXRlRGVmYXVsdCIsCiAgICB2YWx1ZTogZnVuY3Rpb24gY3JlYXRlRGVmYXVsdChyb3cpIHsKICAgICAgaWYgKHJvdy5oYXNPd25Qcm9wZXJ0eSgncGltYXJjaGl2ZXNpZCcpKSB7CiAgICAgICAgcm93WydwaW1hcmNoaXZlc2lkJ10gPSB0aGlzLnZpZXdwYXJhbXNbJ3NyZnBhcmVudGtleSddOwogICAgICB9CiAgICB9CiAgfSwgewogICAga2V5OiAiYWRhcHRpdmVTdGF0ZSIsCiAgICBnZXQ6IGZ1bmN0aW9uIGdldCgpIHsKICAgICAgcmV0dXJuICF0aGlzLmFsbENvbHVtbnMuZmluZChmdW5jdGlvbiAoY29sdW1uKSB7CiAgICAgICAgcmV0dXJuIGNvbHVtbi5zaG93ICYmIE9iamVjdC5pcyhjb2x1bW4udXRpbCwgJ1NUQVInKTsKICAgICAgfSk7CiAgICB9CiAgfV0pOwoKICByZXR1cm4gTWFpbkJhc2U7Cn0oVnVlKTsKCnRzbGliXzEuX19kZWNvcmF0ZShbUHJvcCgpXSwgTWFpbkJhc2UucHJvdG90eXBlLCAibmFtZSIsIHZvaWQgMCk7Cgp0c2xpYl8xLl9fZGVjb3JhdGUoW1Byb3AoKV0sIE1haW5CYXNlLnByb3RvdHlwZSwgInZpZXdTdGF0ZSIsIHZvaWQgMCk7Cgp0c2xpYl8xLl9fZGVjb3JhdGUoW1Byb3AoKV0sIE1haW5CYXNlLnByb3RvdHlwZSwgImNvbnRleHQiLCB2b2lkIDApOwoKdHNsaWJfMS5fX2RlY29yYXRlKFtQcm9wKCldLCBNYWluQmFzZS5wcm90b3R5cGUsICJ2aWV3cGFyYW1zIiwgdm9pZCAwKTsKCnRzbGliXzEuX19kZWNvcmF0ZShbUHJvcCgpXSwgTWFpbkJhc2UucHJvdG90eXBlLCAibmV3ZGF0YSIsIHZvaWQgMCk7Cgp0c2xpYl8xLl9fZGVjb3JhdGUoW1Byb3AoKV0sIE1haW5CYXNlLnByb3RvdHlwZSwgIm9wZW5kYXRhIiwgdm9pZCAwKTsKCnRzbGliXzEuX19kZWNvcmF0ZShbUHJvcCh7CiAgImRlZmF1bHQiOiB0cnVlCn0pXSwgTWFpbkJhc2UucHJvdG90eXBlLCAic2hvd0J1c3lJbmRpY2F0b3IiLCB2b2lkIDApOwoKdHNsaWJfMS5fX2RlY29yYXRlKFtQcm9wKCldLCBNYWluQmFzZS5wcm90b3R5cGUsICJ1cGRhdGVBY3Rpb24iLCB2b2lkIDApOwoKdHNsaWJfMS5fX2RlY29yYXRlKFtQcm9wKCldLCBNYWluQmFzZS5wcm90b3R5cGUsICJmZXRjaEFjdGlvbiIsIHZvaWQgMCk7Cgp0c2xpYl8xLl9fZGVjb3JhdGUoW1Byb3AoKV0sIE1haW5CYXNlLnByb3RvdHlwZSwgInJlbW92ZUFjdGlvbiIsIHZvaWQgMCk7Cgp0c2xpYl8xLl9fZGVjb3JhdGUoW1Byb3AoKV0sIE1haW5CYXNlLnByb3RvdHlwZSwgImxvYWRBY3Rpb24iLCB2b2lkIDApOwoKdHNsaWJfMS5fX2RlY29yYXRlKFtQcm9wKCldLCBNYWluQmFzZS5wcm90b3R5cGUsICJsb2FkZHJhZnRBY3Rpb24iLCB2b2lkIDApOwoKdHNsaWJfMS5fX2RlY29yYXRlKFtQcm9wKCldLCBNYWluQmFzZS5wcm90b3R5cGUsICJjcmVhdGVBY3Rpb24iLCB2b2lkIDApOwoKdHNsaWJfMS5fX2RlY29yYXRlKFtQcm9wKHsKICAiZGVmYXVsdCI6IGZhbHNlCn0pXSwgTWFpbkJhc2UucHJvdG90eXBlLCAiaXNTZWxlY3RGaXJzdERlZmF1bHQiLCB2b2lkIDApOwoKdHNsaWJfMS5fX2RlY29yYXRlKFtQcm9wKCldLCBNYWluQmFzZS5wcm90b3R5cGUsICJpc1NpbmdsZVNlbGVjdCIsIHZvaWQgMCk7Cgp0c2xpYl8xLl9fZGVjb3JhdGUoW1Byb3AoKV0sIE1haW5CYXNlLnByb3RvdHlwZSwgInNlbGVjdGVkRGF0YSIsIHZvaWQgMCk7Cgp0c2xpYl8xLl9fZGVjb3JhdGUoW1dhdGNoKCdzZWxlY3RlZERhdGEnKV0sIE1haW5CYXNlLnByb3RvdHlwZSwgIm9uVmFsdWVDaGFuZ2UiLCBudWxsKTsKCnRzbGliXzEuX19kZWNvcmF0ZShbUHJvcCh7CiAgImRlZmF1bHQiOiAyCn0pXSwgTWFpbkJhc2UucHJvdG90eXBlLCAiZ3JpZFJvd0FjdGl2ZU1vZGUiLCB2b2lkIDApOwoKdHNsaWJfMS5fX2RlY29yYXRlKFtQcm9wKHsKICAiZGVmYXVsdCI6IGZhbHNlCn0pXSwgTWFpbkJhc2UucHJvdG90eXBlLCAiaXNPcGVuRWRpdCIsIHZvaWQgMCk7CgpNYWluQmFzZSA9IHRzbGliXzEuX19kZWNvcmF0ZShbQ29tcG9uZW50KHsKICBjb21wb25lbnRzOiB7fQp9KV0sIE1haW5CYXNlKTsKZXhwb3J0IGRlZmF1bHQgTWFpbkJhc2U7"},null]}
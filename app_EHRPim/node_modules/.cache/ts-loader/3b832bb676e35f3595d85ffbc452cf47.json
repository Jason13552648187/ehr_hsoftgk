{"remainingRequest":"F:\\crod项目\\人事管理系统2\\iBizEHR\\app_EHRPim\\node_modules\\thread-loader\\dist\\cjs.js!F:\\crod项目\\人事管理系统2\\iBizEHR\\app_EHRPim\\node_modules\\babel-loader\\lib\\index.js!F:\\crod项目\\人事管理系统2\\iBizEHR\\app_EHRPim\\node_modules\\ts-loader\\index.js??ref--13-3!F:\\crod项目\\人事管理系统2\\iBizEHR\\app_EHRPim\\src\\service\\pim-archives\\pim-archives-service-base.ts","dependencies":[{"path":"F:\\crod项目\\人事管理系统2\\iBizEHR\\app_EHRPim\\src\\service\\pim-archives\\pim-archives-service-base.ts","mtime":1630509410488},{"path":"F:\\crod项目\\人事管理系统2\\iBizEHR\\app_EHRPim\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1630511852775},{"path":"F:\\crod项目\\人事管理系统2\\iBizEHR\\app_EHRPim\\node_modules\\thread-loader\\dist\\cjs.js","mtime":1630511853252},{"path":"F:\\crod项目\\人事管理系统2\\iBizEHR\\app_EHRPim\\node_modules\\babel-loader\\lib\\index.js","mtime":1630511852747},{"path":"F:\\crod项目\\人事管理系统2\\iBizEHR\\app_EHRPim\\node_modules\\ts-loader\\index.js","mtime":1630511985412}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:aW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkuY29uY2F0IjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkuZm9yLWVhY2giOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5vYmplY3QuaXMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy93ZWIuZG9tLWNvbGxlY3Rpb25zLmZvci1lYWNoIjsKaW1wb3J0ICJyZWdlbmVyYXRvci1ydW50aW1lL3J1bnRpbWUiOwppbXBvcnQgX2FzeW5jVG9HZW5lcmF0b3IgZnJvbSAiRjpcXGNyb2RcdTk4NzlcdTc2RUVcXFx1NEVCQVx1NEU4Qlx1N0JBMVx1NzQwNlx1N0NGQlx1N0VERjJcXGlCaXpFSFJcXGFwcF9FSFJQaW1cXG5vZGVfbW9kdWxlc1xcQGJhYmVsXFxydW50aW1lL2hlbHBlcnMvZXNtL2FzeW5jVG9HZW5lcmF0b3IiOwppbXBvcnQgX2NsYXNzQ2FsbENoZWNrIGZyb20gIkY6XFxjcm9kXHU5ODc5XHU3NkVFXFxcdTRFQkFcdTRFOEJcdTdCQTFcdTc0MDZcdTdDRkJcdTdFREYyXFxpQml6RUhSXFxhcHBfRUhSUGltXFxub2RlX21vZHVsZXNcXEBiYWJlbFxccnVudGltZS9oZWxwZXJzL2VzbS9jbGFzc0NhbGxDaGVjayI7CmltcG9ydCBfY3JlYXRlQ2xhc3MgZnJvbSAiRjpcXGNyb2RcdTk4NzlcdTc2RUVcXFx1NEVCQVx1NEU4Qlx1N0JBMVx1NzQwNlx1N0NGQlx1N0VERjJcXGlCaXpFSFJcXGFwcF9FSFJQaW1cXG5vZGVfbW9kdWxlc1xcQGJhYmVsXFxydW50aW1lL2hlbHBlcnMvZXNtL2NyZWF0ZUNsYXNzIjsKaW1wb3J0IF9wb3NzaWJsZUNvbnN0cnVjdG9yUmV0dXJuIGZyb20gIkY6XFxjcm9kXHU5ODc5XHU3NkVFXFxcdTRFQkFcdTRFOEJcdTdCQTFcdTc0MDZcdTdDRkJcdTdFREYyXFxpQml6RUhSXFxhcHBfRUhSUGltXFxub2RlX21vZHVsZXNcXEBiYWJlbFxccnVudGltZS9oZWxwZXJzL2VzbS9wb3NzaWJsZUNvbnN0cnVjdG9yUmV0dXJuIjsKaW1wb3J0IF9nZXRQcm90b3R5cGVPZiBmcm9tICJGOlxcY3JvZFx1OTg3OVx1NzZFRVxcXHU0RUJBXHU0RThCXHU3QkExXHU3NDA2XHU3Q0ZCXHU3RURGMlxcaUJpekVIUlxcYXBwX0VIUlBpbVxcbm9kZV9tb2R1bGVzXFxAYmFiZWxcXHJ1bnRpbWUvaGVscGVycy9lc20vZ2V0UHJvdG90eXBlT2YiOwppbXBvcnQgX2luaGVyaXRzIGZyb20gIkY6XFxjcm9kXHU5ODc5XHU3NkVFXFxcdTRFQkFcdTRFOEJcdTdCQTFcdTc0MDZcdTdDRkJcdTdFREYyXFxpQml6RUhSXFxhcHBfRUhSUGltXFxub2RlX21vZHVsZXNcXEBiYWJlbFxccnVudGltZS9oZWxwZXJzL2VzbS9pbmhlcml0cyI7CmltcG9ydCB7IEh0dHAgfSBmcm9tICdAL3V0aWxzJzsKaW1wb3J0IEVudGl0eVNlcnZpY2UgZnJvbSAnLi4vZW50aXR5LXNlcnZpY2UnOwppbXBvcnQgR2V0UGVyc29uT3JnTG9naWMgZnJvbSAnQC9zZXJ2aWNlL3BpbS1hcmNoaXZlcy9nZXQtcGVyc29uLW9yZy1sb2dpYyc7Ci8qKg0KICog5qGj5qGI5L+h5oGv5pyN5Yqh5a+56LGh5Z+657G7DQogKg0KICogQGV4cG9ydA0KICogQGNsYXNzIFBpbUFyY2hpdmVzU2VydmljZUJhc2UNCiAqIEBleHRlbmRzIHtFbnRpdHlTZXJ2aWV9DQogKi8KCnZhciBQaW1BcmNoaXZlc1NlcnZpY2VCYXNlID0KLyojX19QVVJFX18qLwpmdW5jdGlvbiAoX0VudGl0eVNlcnZpY2UpIHsKICBfaW5oZXJpdHMoUGltQXJjaGl2ZXNTZXJ2aWNlQmFzZSwgX0VudGl0eVNlcnZpY2UpOwoKICAvKioNCiAgICogQ3JlYXRlcyBhbiBpbnN0YW5jZSBvZiAgUGltQXJjaGl2ZXNTZXJ2aWNlQmFzZS4NCiAgICoNCiAgICogQHBhcmFtIHsqfSBbb3B0cz17fV0NCiAgICogQG1lbWJlcm9mICBQaW1BcmNoaXZlc1NlcnZpY2VCYXNlDQogICAqLwogIGZ1bmN0aW9uIFBpbUFyY2hpdmVzU2VydmljZUJhc2UoKSB7CiAgICB2YXIgb3B0cyA9IGFyZ3VtZW50cy5sZW5ndGggPiAwICYmIGFyZ3VtZW50c1swXSAhPT0gdW5kZWZpbmVkID8gYXJndW1lbnRzWzBdIDoge307CgogICAgX2NsYXNzQ2FsbENoZWNrKHRoaXMsIFBpbUFyY2hpdmVzU2VydmljZUJhc2UpOwoKICAgIHJldHVybiBfcG9zc2libGVDb25zdHJ1Y3RvclJldHVybih0aGlzLCBfZ2V0UHJvdG90eXBlT2YoUGltQXJjaGl2ZXNTZXJ2aWNlQmFzZSkuY2FsbCh0aGlzLCBvcHRzKSk7CiAgfQogIC8qKg0KICAgKiDliJ3lp4vljJbln7rnoYDmlbDmja4NCiAgICoNCiAgICogQG1lbWJlcm9mIFBpbUFyY2hpdmVzU2VydmljZUJhc2UNCiAgICovCgoKICBfY3JlYXRlQ2xhc3MoUGltQXJjaGl2ZXNTZXJ2aWNlQmFzZSwgW3sKICAgIGtleTogImluaXRCYXNpY0RhdGEiLAogICAgdmFsdWU6IGZ1bmN0aW9uIGluaXRCYXNpY0RhdGEoKSB7CiAgICAgIHRoaXMuQVBQTFlERUtFWSA9ICdwaW1hcmNoaXZlcyc7CiAgICAgIHRoaXMuQVBQREVLRVkgPSAncGltYXJjaGl2ZXNpZCc7CiAgICAgIHRoaXMuQVBQREVOQU1FID0gJ3BpbWFyY2hpdmVzJzsKICAgICAgdGhpcy5BUFBERVRFWFQgPSAncGltcGVyc29ubmFtZSc7CiAgICAgIHRoaXMuQVBQTkFNRSA9ICdlaHJwaW0nOwogICAgICB0aGlzLlNZU1RFTU5BTUUgPSAnZWhyJzsKICAgIH0gLy8g5a6e5L2T5o6l5Y+jCgogICAgLyoqDQogICAgICogU2VsZWN05o6l5Y+j5pa55rOVDQogICAgICoNCiAgICAgKiBAcGFyYW0geyp9IFtjb250ZXh0PXt9XQ0KICAgICAqIEBwYXJhbSB7Kn0gW2RhdGE9e31dDQogICAgICogQHBhcmFtIHtib29sZWFufSBbaXNsb2FkaW5nXQ0KICAgICAqIEByZXR1cm5zIHtQcm9taXNlPGFueT59DQogICAgICogQG1lbWJlcm9mIFBpbUFyY2hpdmVzU2VydmljZUJhc2UNCiAgICAgKi8KCiAgfSwgewogICAga2V5OiAiU2VsZWN0IiwKICAgIHZhbHVlOiBmdW5jdGlvbiAoKSB7CiAgICAgIHZhciBfU2VsZWN0ID0gX2FzeW5jVG9HZW5lcmF0b3IoCiAgICAgIC8qI19fUFVSRV9fKi8KICAgICAgcmVnZW5lcmF0b3JSdW50aW1lLm1hcmsoZnVuY3Rpb24gX2NhbGxlZSgpIHsKICAgICAgICB2YXIgY29udGV4dCwKICAgICAgICAgICAgZGF0YSwKICAgICAgICAgICAgaXNsb2FkaW5nLAogICAgICAgICAgICBfYXJncyA9IGFyZ3VtZW50czsKICAgICAgICByZXR1cm4gcmVnZW5lcmF0b3JSdW50aW1lLndyYXAoZnVuY3Rpb24gX2NhbGxlZSQoX2NvbnRleHQpIHsKICAgICAgICAgIHdoaWxlICgxKSB7CiAgICAgICAgICAgIHN3aXRjaCAoX2NvbnRleHQucHJldiA9IF9jb250ZXh0Lm5leHQpIHsKICAgICAgICAgICAgICBjYXNlIDA6CiAgICAgICAgICAgICAgICBjb250ZXh0ID0gX2FyZ3MubGVuZ3RoID4gMCAmJiBfYXJnc1swXSAhPT0gdW5kZWZpbmVkID8gX2FyZ3NbMF0gOiB7fTsKICAgICAgICAgICAgICAgIGRhdGEgPSBfYXJncy5sZW5ndGggPiAxICYmIF9hcmdzWzFdICE9PSB1bmRlZmluZWQgPyBfYXJnc1sxXSA6IHt9OwogICAgICAgICAgICAgICAgaXNsb2FkaW5nID0gX2FyZ3MubGVuZ3RoID4gMiA/IF9hcmdzWzJdIDogdW5kZWZpbmVkOwoKICAgICAgICAgICAgICAgIGlmICghKGNvbnRleHQucGltcGVyc29uICYmIGNvbnRleHQucGltYXJjaGl2ZXMpKSB7CiAgICAgICAgICAgICAgICAgIF9jb250ZXh0Lm5leHQgPSA1OwogICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQuYWJydXB0KCJyZXR1cm4iLCBIdHRwLmdldEluc3RhbmNlKCkuZ2V0KCIvcGltcGVvcGxlLyIuY29uY2F0KGNvbnRleHQucGltcGVyc29uLCAiL3BpbWFyY2hpdmVzLyIpLmNvbmNhdChjb250ZXh0LnBpbWFyY2hpdmVzLCAiL3NlbGVjdCIpLCBpc2xvYWRpbmcpKTsKCiAgICAgICAgICAgICAgY2FzZSA1OgogICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0LmFicnVwdCgicmV0dXJuIiwgSHR0cC5nZXRJbnN0YW5jZSgpLmdldCgiL3BpbWFyY2hpdmVzLyIuY29uY2F0KGNvbnRleHQucGltYXJjaGl2ZXMsICIvc2VsZWN0IiksIGlzbG9hZGluZykpOwoKICAgICAgICAgICAgICBjYXNlIDY6CiAgICAgICAgICAgICAgY2FzZSAiZW5kIjoKICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dC5zdG9wKCk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9LCBfY2FsbGVlKTsKICAgICAgfSkpOwoKICAgICAgZnVuY3Rpb24gU2VsZWN0KCkgewogICAgICAgIHJldHVybiBfU2VsZWN0LmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7CiAgICAgIH0KCiAgICAgIHJldHVybiBTZWxlY3Q7CiAgICB9KCkKICAgIC8qKg0KICAgICAqIEdldFBlcnNvbk9yZ+aOpeWPo+aWueazlQ0KICAgICAqDQogICAgICogQHBhcmFtIHsqfSBbY29udGV4dD17fV0NCiAgICAgKiBAcGFyYW0geyp9IFtkYXRhPXt9XQ0KICAgICAqIEBwYXJhbSB7Ym9vbGVhbn0gW2lzbG9hZGluZ10NCiAgICAgKiBAcmV0dXJucyB7UHJvbWlzZTxhbnk+fQ0KICAgICAqIEBtZW1iZXJvZiBQaW1BcmNoaXZlc1NlcnZpY2VCYXNlDQogICAgICovCgogIH0sIHsKICAgIGtleTogIkdldFBlcnNvbk9yZyIsCiAgICB2YWx1ZTogZnVuY3Rpb24gKCkgewogICAgICB2YXIgX0dldFBlcnNvbk9yZyA9IF9hc3luY1RvR2VuZXJhdG9yKAogICAgICAvKiNfX1BVUkVfXyovCiAgICAgIHJlZ2VuZXJhdG9yUnVudGltZS5tYXJrKGZ1bmN0aW9uIF9jYWxsZWUyKCkgewogICAgICAgIHZhciBjb250ZXh0LAogICAgICAgICAgICBkYXRhLAogICAgICAgICAgICBpc2xvYWRpbmcsCiAgICAgICAgICAgIGFwcExvZ2ljLAogICAgICAgICAgICByZXN1bHQsCiAgICAgICAgICAgIF9hcmdzMiA9IGFyZ3VtZW50czsKICAgICAgICByZXR1cm4gcmVnZW5lcmF0b3JSdW50aW1lLndyYXAoZnVuY3Rpb24gX2NhbGxlZTIkKF9jb250ZXh0MikgewogICAgICAgICAgd2hpbGUgKDEpIHsKICAgICAgICAgICAgc3dpdGNoIChfY29udGV4dDIucHJldiA9IF9jb250ZXh0Mi5uZXh0KSB7CiAgICAgICAgICAgICAgY2FzZSAwOgogICAgICAgICAgICAgICAgY29udGV4dCA9IF9hcmdzMi5sZW5ndGggPiAwICYmIF9hcmdzMlswXSAhPT0gdW5kZWZpbmVkID8gX2FyZ3MyWzBdIDoge307CiAgICAgICAgICAgICAgICBkYXRhID0gX2FyZ3MyLmxlbmd0aCA+IDEgJiYgX2FyZ3MyWzFdICE9PSB1bmRlZmluZWQgPyBfYXJnczJbMV0gOiB7fTsKICAgICAgICAgICAgICAgIGlzbG9hZGluZyA9IF9hcmdzMi5sZW5ndGggPiAyID8gX2FyZ3MyWzJdIDogdW5kZWZpbmVkOwogICAgICAgICAgICAgICAgYXBwTG9naWMgPSBuZXcgR2V0UGVyc29uT3JnTG9naWMoewogICAgICAgICAgICAgICAgICBjb250ZXh0OiBKU09OLnBhcnNlKEpTT04uc3RyaW5naWZ5KGNvbnRleHQpKSwKICAgICAgICAgICAgICAgICAgZGF0YTogSlNPTi5wYXJzZShKU09OLnN0cmluZ2lmeShkYXRhKSkKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgX2NvbnRleHQyLm5leHQgPSA2OwogICAgICAgICAgICAgICAgcmV0dXJuIGFwcExvZ2ljLm9uRXhlY3V0ZShjb250ZXh0LCBkYXRhLCBpc2xvYWRpbmcgPyB0cnVlIDogZmFsc2UpOwoKICAgICAgICAgICAgICBjYXNlIDY6CiAgICAgICAgICAgICAgICByZXN1bHQgPSBfY29udGV4dDIuc2VudDsKICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDIuYWJydXB0KCJyZXR1cm4iLCB7CiAgICAgICAgICAgICAgICAgIHN0YXR1czogMjAwLAogICAgICAgICAgICAgICAgICBkYXRhOiByZXN1bHQKICAgICAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgICBjYXNlIDg6CiAgICAgICAgICAgICAgY2FzZSAiZW5kIjoKICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDIuc3RvcCgpOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSwgX2NhbGxlZTIpOwogICAgICB9KSk7CgogICAgICBmdW5jdGlvbiBHZXRQZXJzb25PcmcoKSB7CiAgICAgICAgcmV0dXJuIF9HZXRQZXJzb25PcmcuYXBwbHkodGhpcywgYXJndW1lbnRzKTsKICAgICAgfQoKICAgICAgcmV0dXJuIEdldFBlcnNvbk9yZzsKICAgIH0oKQogICAgLyoqDQogICAgICogR2V0RHJhZnTmjqXlj6Pmlrnms5UNCiAgICAgKg0KICAgICAqIEBwYXJhbSB7Kn0gW2NvbnRleHQ9e31dDQogICAgICogQHBhcmFtIHsqfSBbZGF0YT17fV0NCiAgICAgKiBAcGFyYW0ge2Jvb2xlYW59IFtpc2xvYWRpbmddDQogICAgICogQHJldHVybnMge1Byb21pc2U8YW55Pn0NCiAgICAgKiBAbWVtYmVyb2YgUGltQXJjaGl2ZXNTZXJ2aWNlQmFzZQ0KICAgICAqLwoKICB9LCB7CiAgICBrZXk6ICJHZXREcmFmdCIsCiAgICB2YWx1ZTogZnVuY3Rpb24gKCkgewogICAgICB2YXIgX0dldERyYWZ0ID0gX2FzeW5jVG9HZW5lcmF0b3IoCiAgICAgIC8qI19fUFVSRV9fKi8KICAgICAgcmVnZW5lcmF0b3JSdW50aW1lLm1hcmsoZnVuY3Rpb24gX2NhbGxlZTMoKSB7CiAgICAgICAgdmFyIGNvbnRleHQsCiAgICAgICAgICAgIGRhdGEsCiAgICAgICAgICAgIGlzbG9hZGluZywKICAgICAgICAgICAgcmVzLAogICAgICAgICAgICBfYXJnczMgPSBhcmd1bWVudHM7CiAgICAgICAgcmV0dXJuIHJlZ2VuZXJhdG9yUnVudGltZS53cmFwKGZ1bmN0aW9uIF9jYWxsZWUzJChfY29udGV4dDMpIHsKICAgICAgICAgIHdoaWxlICgxKSB7CiAgICAgICAgICAgIHN3aXRjaCAoX2NvbnRleHQzLnByZXYgPSBfY29udGV4dDMubmV4dCkgewogICAgICAgICAgICAgIGNhc2UgMDoKICAgICAgICAgICAgICAgIGNvbnRleHQgPSBfYXJnczMubGVuZ3RoID4gMCAmJiBfYXJnczNbMF0gIT09IHVuZGVmaW5lZCA/IF9hcmdzM1swXSA6IHt9OwogICAgICAgICAgICAgICAgZGF0YSA9IF9hcmdzMy5sZW5ndGggPiAxICYmIF9hcmdzM1sxXSAhPT0gdW5kZWZpbmVkID8gX2FyZ3MzWzFdIDoge307CiAgICAgICAgICAgICAgICBpc2xvYWRpbmcgPSBfYXJnczMubGVuZ3RoID4gMiA/IF9hcmdzM1syXSA6IHVuZGVmaW5lZDsKCiAgICAgICAgICAgICAgICBpZiAoIShjb250ZXh0LnBpbXBlcnNvbiAmJiB0cnVlKSkgewogICAgICAgICAgICAgICAgICBfY29udGV4dDMubmV4dCA9IDU7CiAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDMuYWJydXB0KCJyZXR1cm4iLCBIdHRwLmdldEluc3RhbmNlKCkuZ2V0KCIvcGltcGVvcGxlLyIuY29uY2F0KGNvbnRleHQucGltcGVyc29uLCAiL3BpbWFyY2hpdmVzL2dldGRyYWZ0IiksIGlzbG9hZGluZykpOwoKICAgICAgICAgICAgICBjYXNlIDU6CiAgICAgICAgICAgICAgICBfY29udGV4dDMubmV4dCA9IDc7CiAgICAgICAgICAgICAgICByZXR1cm4gSHR0cC5nZXRJbnN0YW5jZSgpLmdldCgiL3BpbWFyY2hpdmVzL2dldGRyYWZ0IiwgaXNsb2FkaW5nKTsKCiAgICAgICAgICAgICAgY2FzZSA3OgogICAgICAgICAgICAgICAgcmVzID0gX2NvbnRleHQzLnNlbnQ7CiAgICAgICAgICAgICAgICByZXMuZGF0YS5waW1hcmNoaXZlcyA9IGRhdGEucGltYXJjaGl2ZXM7CiAgICAgICAgICAgICAgICB0aGlzLnRlbXBTdG9yYWdlLnNldEl0ZW0oY29udGV4dC5zcmZzZXNzaW9ua2V5ICsgJ19waW1hcmNoaXZlc2xvYW5hbmRyZXR1cm5zJywgSlNPTi5zdHJpbmdpZnkocmVzLmRhdGEucGltYXJjaGl2ZXNsb2FuYW5kcmV0dXJucykpOwogICAgICAgICAgICAgICAgdGhpcy50ZW1wU3RvcmFnZS5zZXRJdGVtKGNvbnRleHQuc3Jmc2Vzc2lvbmtleSArICdfcGltYXJjaGl2ZXNjaGFuZ2VzJywgSlNPTi5zdHJpbmdpZnkocmVzLmRhdGEucGltYXJjaGl2ZXNjaGFuZ2VzKSk7CiAgICAgICAgICAgICAgICB0aGlzLnRlbXBTdG9yYWdlLnNldEl0ZW0oY29udGV4dC5zcmZzZXNzaW9ua2V5ICsgJ19waW1hcmNoaXZlc3JlY29yZHMnLCBKU09OLnN0cmluZ2lmeShyZXMuZGF0YS5waW1hcmNoaXZlc3JlY29yZHMpKTsKICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDMuYWJydXB0KCJyZXR1cm4iLCByZXMpOwoKICAgICAgICAgICAgICBjYXNlIDEzOgogICAgICAgICAgICAgIGNhc2UgImVuZCI6CiAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQzLnN0b3AoKTsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0sIF9jYWxsZWUzLCB0aGlzKTsKICAgICAgfSkpOwoKICAgICAgZnVuY3Rpb24gR2V0RHJhZnQoKSB7CiAgICAgICAgcmV0dXJuIF9HZXREcmFmdC5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwogICAgICB9CgogICAgICByZXR1cm4gR2V0RHJhZnQ7CiAgICB9KCkKICAgIC8qKg0KICAgICAqIFNhdmXmjqXlj6Pmlrnms5UNCiAgICAgKg0KICAgICAqIEBwYXJhbSB7Kn0gW2NvbnRleHQ9e31dDQogICAgICogQHBhcmFtIHsqfSBbZGF0YT17fV0NCiAgICAgKiBAcGFyYW0ge2Jvb2xlYW59IFtpc2xvYWRpbmddDQogICAgICogQHJldHVybnMge1Byb21pc2U8YW55Pn0NCiAgICAgKiBAbWVtYmVyb2YgUGltQXJjaGl2ZXNTZXJ2aWNlQmFzZQ0KICAgICAqLwoKICB9LCB7CiAgICBrZXk6ICJTYXZlIiwKICAgIHZhbHVlOiBmdW5jdGlvbiAoKSB7CiAgICAgIHZhciBfU2F2ZSA9IF9hc3luY1RvR2VuZXJhdG9yKAogICAgICAvKiNfX1BVUkVfXyovCiAgICAgIHJlZ2VuZXJhdG9yUnVudGltZS5tYXJrKGZ1bmN0aW9uIF9jYWxsZWU0KCkgewogICAgICAgIHZhciBjb250ZXh0LAogICAgICAgICAgICBkYXRhLAogICAgICAgICAgICBpc2xvYWRpbmcsCiAgICAgICAgICAgIG1hc3RlckRhdGEsCiAgICAgICAgICAgIHBpbWFyY2hpdmVzbG9hbmFuZHJldHVybnNEYXRhLAogICAgICAgICAgICBwaW1hcmNoaXZlc2NoYW5nZXNEYXRhLAogICAgICAgICAgICBwaW1hcmNoaXZlc3JlY29yZHNEYXRhLAogICAgICAgICAgICByZXMsCiAgICAgICAgICAgIF9hcmdzNCA9IGFyZ3VtZW50czsKICAgICAgICByZXR1cm4gcmVnZW5lcmF0b3JSdW50aW1lLndyYXAoZnVuY3Rpb24gX2NhbGxlZTQkKF9jb250ZXh0NCkgewogICAgICAgICAgd2hpbGUgKDEpIHsKICAgICAgICAgICAgc3dpdGNoIChfY29udGV4dDQucHJldiA9IF9jb250ZXh0NC5uZXh0KSB7CiAgICAgICAgICAgICAgY2FzZSAwOgogICAgICAgICAgICAgICAgY29udGV4dCA9IF9hcmdzNC5sZW5ndGggPiAwICYmIF9hcmdzNFswXSAhPT0gdW5kZWZpbmVkID8gX2FyZ3M0WzBdIDoge307CiAgICAgICAgICAgICAgICBkYXRhID0gX2FyZ3M0Lmxlbmd0aCA+IDEgJiYgX2FyZ3M0WzFdICE9PSB1bmRlZmluZWQgPyBfYXJnczRbMV0gOiB7fTsKICAgICAgICAgICAgICAgIGlzbG9hZGluZyA9IF9hcmdzNC5sZW5ndGggPiAyID8gX2FyZ3M0WzJdIDogdW5kZWZpbmVkOwoKICAgICAgICAgICAgICAgIGlmICghKGNvbnRleHQucGltcGVyc29uICYmIGNvbnRleHQucGltYXJjaGl2ZXMpKSB7CiAgICAgICAgICAgICAgICAgIF9jb250ZXh0NC5uZXh0ID0gNTsKICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0NC5hYnJ1cHQoInJldHVybiIsIEh0dHAuZ2V0SW5zdGFuY2UoKS5wb3N0KCIvcGltcGVvcGxlLyIuY29uY2F0KGNvbnRleHQucGltcGVyc29uLCAiL3BpbWFyY2hpdmVzLyIpLmNvbmNhdChjb250ZXh0LnBpbWFyY2hpdmVzLCAiL3NhdmUiKSwgZGF0YSwgaXNsb2FkaW5nKSk7CgogICAgICAgICAgICAgIGNhc2UgNToKICAgICAgICAgICAgICAgIG1hc3RlckRhdGEgPSB7fTsKICAgICAgICAgICAgICAgIHBpbWFyY2hpdmVzbG9hbmFuZHJldHVybnNEYXRhID0gW107CgogICAgICAgICAgICAgICAgaWYgKCFPYmplY3QuaXModGhpcy50ZW1wU3RvcmFnZS5nZXRJdGVtKGNvbnRleHQuc3Jmc2Vzc2lvbmtleSArICdfcGltYXJjaGl2ZXNsb2FuYW5kcmV0dXJucycpLCAndW5kZWZpbmVkJykpIHsKICAgICAgICAgICAgICAgICAgcGltYXJjaGl2ZXNsb2FuYW5kcmV0dXJuc0RhdGEgPSBKU09OLnBhcnNlKHRoaXMudGVtcFN0b3JhZ2UuZ2V0SXRlbShjb250ZXh0LnNyZnNlc3Npb25rZXkgKyAnX3BpbWFyY2hpdmVzbG9hbmFuZHJldHVybnMnKSk7CgogICAgICAgICAgICAgICAgICBpZiAocGltYXJjaGl2ZXNsb2FuYW5kcmV0dXJuc0RhdGEgJiYgcGltYXJjaGl2ZXNsb2FuYW5kcmV0dXJuc0RhdGEubGVuZ3RoICYmIHBpbWFyY2hpdmVzbG9hbmFuZHJldHVybnNEYXRhLmxlbmd0aCA+IDApIHsKICAgICAgICAgICAgICAgICAgICBwaW1hcmNoaXZlc2xvYW5hbmRyZXR1cm5zRGF0YS5mb3JFYWNoKGZ1bmN0aW9uIChpdGVtKSB7CiAgICAgICAgICAgICAgICAgICAgICBpZiAoaXRlbS5zcmZmcm9udHVmKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChPYmplY3QuaXMoaXRlbS5zcmZmcm9udHVmLCAiMCIpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgaXRlbS5waW1hcmNoaXZlc2xvYW5hbmRyZXR1cm5pZCA9IG51bGw7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgICAgIGRlbGV0ZSBpdGVtLnNyZmZyb250dWY7CiAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBtYXN0ZXJEYXRhLnBpbWFyY2hpdmVzbG9hbmFuZHJldHVybnMgPSBwaW1hcmNoaXZlc2xvYW5hbmRyZXR1cm5zRGF0YTsKICAgICAgICAgICAgICAgIHBpbWFyY2hpdmVzY2hhbmdlc0RhdGEgPSBbXTsKCiAgICAgICAgICAgICAgICBpZiAoIU9iamVjdC5pcyh0aGlzLnRlbXBTdG9yYWdlLmdldEl0ZW0oY29udGV4dC5zcmZzZXNzaW9ua2V5ICsgJ19waW1hcmNoaXZlc2NoYW5nZXMnKSwgJ3VuZGVmaW5lZCcpKSB7CiAgICAgICAgICAgICAgICAgIHBpbWFyY2hpdmVzY2hhbmdlc0RhdGEgPSBKU09OLnBhcnNlKHRoaXMudGVtcFN0b3JhZ2UuZ2V0SXRlbShjb250ZXh0LnNyZnNlc3Npb25rZXkgKyAnX3BpbWFyY2hpdmVzY2hhbmdlcycpKTsKCiAgICAgICAgICAgICAgICAgIGlmIChwaW1hcmNoaXZlc2NoYW5nZXNEYXRhICYmIHBpbWFyY2hpdmVzY2hhbmdlc0RhdGEubGVuZ3RoICYmIHBpbWFyY2hpdmVzY2hhbmdlc0RhdGEubGVuZ3RoID4gMCkgewogICAgICAgICAgICAgICAgICAgIHBpbWFyY2hpdmVzY2hhbmdlc0RhdGEuZm9yRWFjaChmdW5jdGlvbiAoaXRlbSkgewogICAgICAgICAgICAgICAgICAgICAgaWYgKGl0ZW0uc3JmZnJvbnR1ZikgewogICAgICAgICAgICAgICAgICAgICAgICBpZiAoT2JqZWN0LmlzKGl0ZW0uc3JmZnJvbnR1ZiwgIjAiKSkgewogICAgICAgICAgICAgICAgICAgICAgICAgIGl0ZW0ucGltYXJjaGl2ZXNjaGFuZ2VpZCA9IG51bGw7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgICAgIGRlbGV0ZSBpdGVtLnNyZmZyb250dWY7CiAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBtYXN0ZXJEYXRhLnBpbWFyY2hpdmVzY2hhbmdlcyA9IHBpbWFyY2hpdmVzY2hhbmdlc0RhdGE7CiAgICAgICAgICAgICAgICBwaW1hcmNoaXZlc3JlY29yZHNEYXRhID0gW107CgogICAgICAgICAgICAgICAgaWYgKCFPYmplY3QuaXModGhpcy50ZW1wU3RvcmFnZS5nZXRJdGVtKGNvbnRleHQuc3Jmc2Vzc2lvbmtleSArICdfcGltYXJjaGl2ZXNyZWNvcmRzJyksICd1bmRlZmluZWQnKSkgewogICAgICAgICAgICAgICAgICBwaW1hcmNoaXZlc3JlY29yZHNEYXRhID0gSlNPTi5wYXJzZSh0aGlzLnRlbXBTdG9yYWdlLmdldEl0ZW0oY29udGV4dC5zcmZzZXNzaW9ua2V5ICsgJ19waW1hcmNoaXZlc3JlY29yZHMnKSk7CgogICAgICAgICAgICAgICAgICBpZiAocGltYXJjaGl2ZXNyZWNvcmRzRGF0YSAmJiBwaW1hcmNoaXZlc3JlY29yZHNEYXRhLmxlbmd0aCAmJiBwaW1hcmNoaXZlc3JlY29yZHNEYXRhLmxlbmd0aCA+IDApIHsKICAgICAgICAgICAgICAgICAgICBwaW1hcmNoaXZlc3JlY29yZHNEYXRhLmZvckVhY2goZnVuY3Rpb24gKGl0ZW0pIHsKICAgICAgICAgICAgICAgICAgICAgIGlmIChpdGVtLnNyZmZyb250dWYpIHsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKE9iamVjdC5pcyhpdGVtLnNyZmZyb250dWYsICIwIikpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICBpdGVtLnBpbWFyY2hpdmVzcmVjb3JkaWQgPSBudWxsOwogICAgICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgICAgICBkZWxldGUgaXRlbS5zcmZmcm9udHVmOwogICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgbWFzdGVyRGF0YS5waW1hcmNoaXZlc3JlY29yZHMgPSBwaW1hcmNoaXZlc3JlY29yZHNEYXRhOwogICAgICAgICAgICAgICAgT2JqZWN0LmFzc2lnbihkYXRhLCBtYXN0ZXJEYXRhKTsKICAgICAgICAgICAgICAgIF9jb250ZXh0NC5uZXh0ID0gMTg7CiAgICAgICAgICAgICAgICByZXR1cm4gSHR0cC5nZXRJbnN0YW5jZSgpLnBvc3QoIi9waW1hcmNoaXZlcy8iLmNvbmNhdChjb250ZXh0LnBpbWFyY2hpdmVzLCAiL3NhdmUiKSwgZGF0YSwgaXNsb2FkaW5nKTsKCiAgICAgICAgICAgICAgY2FzZSAxODoKICAgICAgICAgICAgICAgIHJlcyA9IF9jb250ZXh0NC5zZW50OwogICAgICAgICAgICAgICAgdGhpcy50ZW1wU3RvcmFnZS5zZXRJdGVtKGNvbnRleHQuc3Jmc2Vzc2lvbmtleSArICdfcGltYXJjaGl2ZXNsb2FuYW5kcmV0dXJucycsIEpTT04uc3RyaW5naWZ5KHJlcy5kYXRhLnBpbWFyY2hpdmVzbG9hbmFuZHJldHVybnMpKTsKICAgICAgICAgICAgICAgIHRoaXMudGVtcFN0b3JhZ2Uuc2V0SXRlbShjb250ZXh0LnNyZnNlc3Npb25rZXkgKyAnX3BpbWFyY2hpdmVzY2hhbmdlcycsIEpTT04uc3RyaW5naWZ5KHJlcy5kYXRhLnBpbWFyY2hpdmVzY2hhbmdlcykpOwogICAgICAgICAgICAgICAgdGhpcy50ZW1wU3RvcmFnZS5zZXRJdGVtKGNvbnRleHQuc3Jmc2Vzc2lvbmtleSArICdfcGltYXJjaGl2ZXNyZWNvcmRzJywgSlNPTi5zdHJpbmdpZnkocmVzLmRhdGEucGltYXJjaGl2ZXNyZWNvcmRzKSk7CiAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQ0LmFicnVwdCgicmV0dXJuIiwgcmVzKTsKCiAgICAgICAgICAgICAgY2FzZSAyMzoKICAgICAgICAgICAgICBjYXNlICJlbmQiOgogICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0NC5zdG9wKCk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9LCBfY2FsbGVlNCwgdGhpcyk7CiAgICAgIH0pKTsKCiAgICAgIGZ1bmN0aW9uIFNhdmUoKSB7CiAgICAgICAgcmV0dXJuIF9TYXZlLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7CiAgICAgIH0KCiAgICAgIHJldHVybiBTYXZlOwogICAgfSgpCiAgICAvKioNCiAgICAgKiBHZXTmjqXlj6Pmlrnms5UNCiAgICAgKg0KICAgICAqIEBwYXJhbSB7Kn0gW2NvbnRleHQ9e31dDQogICAgICogQHBhcmFtIHsqfSBbZGF0YT17fV0NCiAgICAgKiBAcGFyYW0ge2Jvb2xlYW59IFtpc2xvYWRpbmddDQogICAgICogQHJldHVybnMge1Byb21pc2U8YW55Pn0NCiAgICAgKiBAbWVtYmVyb2YgUGltQXJjaGl2ZXNTZXJ2aWNlQmFzZQ0KICAgICAqLwoKICB9LCB7CiAgICBrZXk6ICJHZXQiLAogICAgdmFsdWU6IGZ1bmN0aW9uICgpIHsKICAgICAgdmFyIF9HZXQgPSBfYXN5bmNUb0dlbmVyYXRvcigKICAgICAgLyojX19QVVJFX18qLwogICAgICByZWdlbmVyYXRvclJ1bnRpbWUubWFyayhmdW5jdGlvbiBfY2FsbGVlNSgpIHsKICAgICAgICB2YXIgY29udGV4dCwKICAgICAgICAgICAgZGF0YSwKICAgICAgICAgICAgaXNsb2FkaW5nLAogICAgICAgICAgICByZXMsCiAgICAgICAgICAgIF9hcmdzNSA9IGFyZ3VtZW50czsKICAgICAgICByZXR1cm4gcmVnZW5lcmF0b3JSdW50aW1lLndyYXAoZnVuY3Rpb24gX2NhbGxlZTUkKF9jb250ZXh0NSkgewogICAgICAgICAgd2hpbGUgKDEpIHsKICAgICAgICAgICAgc3dpdGNoIChfY29udGV4dDUucHJldiA9IF9jb250ZXh0NS5uZXh0KSB7CiAgICAgICAgICAgICAgY2FzZSAwOgogICAgICAgICAgICAgICAgY29udGV4dCA9IF9hcmdzNS5sZW5ndGggPiAwICYmIF9hcmdzNVswXSAhPT0gdW5kZWZpbmVkID8gX2FyZ3M1WzBdIDoge307CiAgICAgICAgICAgICAgICBkYXRhID0gX2FyZ3M1Lmxlbmd0aCA+IDEgJiYgX2FyZ3M1WzFdICE9PSB1bmRlZmluZWQgPyBfYXJnczVbMV0gOiB7fTsKICAgICAgICAgICAgICAgIGlzbG9hZGluZyA9IF9hcmdzNS5sZW5ndGggPiAyID8gX2FyZ3M1WzJdIDogdW5kZWZpbmVkOwoKICAgICAgICAgICAgICAgIGlmICghKGNvbnRleHQucGltcGVyc29uICYmIGNvbnRleHQucGltYXJjaGl2ZXMpKSB7CiAgICAgICAgICAgICAgICAgIF9jb250ZXh0NS5uZXh0ID0gNTsKICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0NS5hYnJ1cHQoInJldHVybiIsIEh0dHAuZ2V0SW5zdGFuY2UoKS5nZXQoIi9waW1wZW9wbGUvIi5jb25jYXQoY29udGV4dC5waW1wZXJzb24sICIvcGltYXJjaGl2ZXMvIikuY29uY2F0KGNvbnRleHQucGltYXJjaGl2ZXMpLCBpc2xvYWRpbmcpKTsKCiAgICAgICAgICAgICAgY2FzZSA1OgogICAgICAgICAgICAgICAgX2NvbnRleHQ1Lm5leHQgPSA3OwogICAgICAgICAgICAgICAgcmV0dXJuIEh0dHAuZ2V0SW5zdGFuY2UoKS5nZXQoIi9waW1hcmNoaXZlcy8iLmNvbmNhdChjb250ZXh0LnBpbWFyY2hpdmVzKSwgaXNsb2FkaW5nKTsKCiAgICAgICAgICAgICAgY2FzZSA3OgogICAgICAgICAgICAgICAgcmVzID0gX2NvbnRleHQ1LnNlbnQ7CiAgICAgICAgICAgICAgICB0aGlzLnRlbXBTdG9yYWdlLnNldEl0ZW0oY29udGV4dC5zcmZzZXNzaW9ua2V5ICsgJ19waW1hcmNoaXZlc2xvYW5hbmRyZXR1cm5zJywgSlNPTi5zdHJpbmdpZnkocmVzLmRhdGEucGltYXJjaGl2ZXNsb2FuYW5kcmV0dXJucykpOwogICAgICAgICAgICAgICAgdGhpcy50ZW1wU3RvcmFnZS5zZXRJdGVtKGNvbnRleHQuc3Jmc2Vzc2lvbmtleSArICdfcGltYXJjaGl2ZXNjaGFuZ2VzJywgSlNPTi5zdHJpbmdpZnkocmVzLmRhdGEucGltYXJjaGl2ZXNjaGFuZ2VzKSk7CiAgICAgICAgICAgICAgICB0aGlzLnRlbXBTdG9yYWdlLnNldEl0ZW0oY29udGV4dC5zcmZzZXNzaW9ua2V5ICsgJ19waW1hcmNoaXZlc3JlY29yZHMnLCBKU09OLnN0cmluZ2lmeShyZXMuZGF0YS5waW1hcmNoaXZlc3JlY29yZHMpKTsKICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDUuYWJydXB0KCJyZXR1cm4iLCByZXMpOwoKICAgICAgICAgICAgICBjYXNlIDEyOgogICAgICAgICAgICAgIGNhc2UgImVuZCI6CiAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQ1LnN0b3AoKTsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0sIF9jYWxsZWU1LCB0aGlzKTsKICAgICAgfSkpOwoKICAgICAgZnVuY3Rpb24gR2V0KCkgewogICAgICAgIHJldHVybiBfR2V0LmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7CiAgICAgIH0KCiAgICAgIHJldHVybiBHZXQ7CiAgICB9KCkKICAgIC8qKg0KICAgICAqIFVwZGF0ZeaOpeWPo+aWueazlQ0KICAgICAqDQogICAgICogQHBhcmFtIHsqfSBbY29udGV4dD17fV0NCiAgICAgKiBAcGFyYW0geyp9IFtkYXRhPXt9XQ0KICAgICAqIEBwYXJhbSB7Ym9vbGVhbn0gW2lzbG9hZGluZ10NCiAgICAgKiBAcmV0dXJucyB7UHJvbWlzZTxhbnk+fQ0KICAgICAqIEBtZW1iZXJvZiBQaW1BcmNoaXZlc1NlcnZpY2VCYXNlDQogICAgICovCgogIH0sIHsKICAgIGtleTogIlVwZGF0ZSIsCiAgICB2YWx1ZTogZnVuY3Rpb24gKCkgewogICAgICB2YXIgX1VwZGF0ZSA9IF9hc3luY1RvR2VuZXJhdG9yKAogICAgICAvKiNfX1BVUkVfXyovCiAgICAgIHJlZ2VuZXJhdG9yUnVudGltZS5tYXJrKGZ1bmN0aW9uIF9jYWxsZWU2KCkgewogICAgICAgIHZhciBjb250ZXh0LAogICAgICAgICAgICBkYXRhLAogICAgICAgICAgICBpc2xvYWRpbmcsCiAgICAgICAgICAgIG1hc3RlckRhdGEsCiAgICAgICAgICAgIHBpbWFyY2hpdmVzbG9hbmFuZHJldHVybnNEYXRhLAogICAgICAgICAgICBwaW1hcmNoaXZlc2NoYW5nZXNEYXRhLAogICAgICAgICAgICBwaW1hcmNoaXZlc3JlY29yZHNEYXRhLAogICAgICAgICAgICByZXMsCiAgICAgICAgICAgIF9hcmdzNiA9IGFyZ3VtZW50czsKICAgICAgICByZXR1cm4gcmVnZW5lcmF0b3JSdW50aW1lLndyYXAoZnVuY3Rpb24gX2NhbGxlZTYkKF9jb250ZXh0NikgewogICAgICAgICAgd2hpbGUgKDEpIHsKICAgICAgICAgICAgc3dpdGNoIChfY29udGV4dDYucHJldiA9IF9jb250ZXh0Ni5uZXh0KSB7CiAgICAgICAgICAgICAgY2FzZSAwOgogICAgICAgICAgICAgICAgY29udGV4dCA9IF9hcmdzNi5sZW5ndGggPiAwICYmIF9hcmdzNlswXSAhPT0gdW5kZWZpbmVkID8gX2FyZ3M2WzBdIDoge307CiAgICAgICAgICAgICAgICBkYXRhID0gX2FyZ3M2Lmxlbmd0aCA+IDEgJiYgX2FyZ3M2WzFdICE9PSB1bmRlZmluZWQgPyBfYXJnczZbMV0gOiB7fTsKICAgICAgICAgICAgICAgIGlzbG9hZGluZyA9IF9hcmdzNi5sZW5ndGggPiAyID8gX2FyZ3M2WzJdIDogdW5kZWZpbmVkOwoKICAgICAgICAgICAgICAgIGlmICghKGNvbnRleHQucGltcGVyc29uICYmIGNvbnRleHQucGltYXJjaGl2ZXMpKSB7CiAgICAgICAgICAgICAgICAgIF9jb250ZXh0Ni5uZXh0ID0gNTsKICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0Ni5hYnJ1cHQoInJldHVybiIsIEh0dHAuZ2V0SW5zdGFuY2UoKS5wdXQoIi9waW1wZW9wbGUvIi5jb25jYXQoY29udGV4dC5waW1wZXJzb24sICIvcGltYXJjaGl2ZXMvIikuY29uY2F0KGNvbnRleHQucGltYXJjaGl2ZXMpLCBkYXRhLCBpc2xvYWRpbmcpKTsKCiAgICAgICAgICAgICAgY2FzZSA1OgogICAgICAgICAgICAgICAgbWFzdGVyRGF0YSA9IHt9OwogICAgICAgICAgICAgICAgcGltYXJjaGl2ZXNsb2FuYW5kcmV0dXJuc0RhdGEgPSBbXTsKCiAgICAgICAgICAgICAgICBpZiAoIU9iamVjdC5pcyh0aGlzLnRlbXBTdG9yYWdlLmdldEl0ZW0oY29udGV4dC5zcmZzZXNzaW9ua2V5ICsgJ19waW1hcmNoaXZlc2xvYW5hbmRyZXR1cm5zJyksICd1bmRlZmluZWQnKSkgewogICAgICAgICAgICAgICAgICBwaW1hcmNoaXZlc2xvYW5hbmRyZXR1cm5zRGF0YSA9IEpTT04ucGFyc2UodGhpcy50ZW1wU3RvcmFnZS5nZXRJdGVtKGNvbnRleHQuc3Jmc2Vzc2lvbmtleSArICdfcGltYXJjaGl2ZXNsb2FuYW5kcmV0dXJucycpKTsKCiAgICAgICAgICAgICAgICAgIGlmIChwaW1hcmNoaXZlc2xvYW5hbmRyZXR1cm5zRGF0YSAmJiBwaW1hcmNoaXZlc2xvYW5hbmRyZXR1cm5zRGF0YS5sZW5ndGggJiYgcGltYXJjaGl2ZXNsb2FuYW5kcmV0dXJuc0RhdGEubGVuZ3RoID4gMCkgewogICAgICAgICAgICAgICAgICAgIHBpbWFyY2hpdmVzbG9hbmFuZHJldHVybnNEYXRhLmZvckVhY2goZnVuY3Rpb24gKGl0ZW0pIHsKICAgICAgICAgICAgICAgICAgICAgIGlmIChpdGVtLnNyZmZyb250dWYpIHsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKE9iamVjdC5pcyhpdGVtLnNyZmZyb250dWYsICIwIikpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICBpdGVtLnBpbWFyY2hpdmVzbG9hbmFuZHJldHVybmlkID0gbnVsbDsKICAgICAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICAgICAgZGVsZXRlIGl0ZW0uc3JmZnJvbnR1ZjsKICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIG1hc3RlckRhdGEucGltYXJjaGl2ZXNsb2FuYW5kcmV0dXJucyA9IHBpbWFyY2hpdmVzbG9hbmFuZHJldHVybnNEYXRhOwogICAgICAgICAgICAgICAgcGltYXJjaGl2ZXNjaGFuZ2VzRGF0YSA9IFtdOwoKICAgICAgICAgICAgICAgIGlmICghT2JqZWN0LmlzKHRoaXMudGVtcFN0b3JhZ2UuZ2V0SXRlbShjb250ZXh0LnNyZnNlc3Npb25rZXkgKyAnX3BpbWFyY2hpdmVzY2hhbmdlcycpLCAndW5kZWZpbmVkJykpIHsKICAgICAgICAgICAgICAgICAgcGltYXJjaGl2ZXNjaGFuZ2VzRGF0YSA9IEpTT04ucGFyc2UodGhpcy50ZW1wU3RvcmFnZS5nZXRJdGVtKGNvbnRleHQuc3Jmc2Vzc2lvbmtleSArICdfcGltYXJjaGl2ZXNjaGFuZ2VzJykpOwoKICAgICAgICAgICAgICAgICAgaWYgKHBpbWFyY2hpdmVzY2hhbmdlc0RhdGEgJiYgcGltYXJjaGl2ZXNjaGFuZ2VzRGF0YS5sZW5ndGggJiYgcGltYXJjaGl2ZXNjaGFuZ2VzRGF0YS5sZW5ndGggPiAwKSB7CiAgICAgICAgICAgICAgICAgICAgcGltYXJjaGl2ZXNjaGFuZ2VzRGF0YS5mb3JFYWNoKGZ1bmN0aW9uIChpdGVtKSB7CiAgICAgICAgICAgICAgICAgICAgICBpZiAoaXRlbS5zcmZmcm9udHVmKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChPYmplY3QuaXMoaXRlbS5zcmZmcm9udHVmLCAiMCIpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgaXRlbS5waW1hcmNoaXZlc2NoYW5nZWlkID0gbnVsbDsKICAgICAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICAgICAgZGVsZXRlIGl0ZW0uc3JmZnJvbnR1ZjsKICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIG1hc3RlckRhdGEucGltYXJjaGl2ZXNjaGFuZ2VzID0gcGltYXJjaGl2ZXNjaGFuZ2VzRGF0YTsKICAgICAgICAgICAgICAgIHBpbWFyY2hpdmVzcmVjb3Jkc0RhdGEgPSBbXTsKCiAgICAgICAgICAgICAgICBpZiAoIU9iamVjdC5pcyh0aGlzLnRlbXBTdG9yYWdlLmdldEl0ZW0oY29udGV4dC5zcmZzZXNzaW9ua2V5ICsgJ19waW1hcmNoaXZlc3JlY29yZHMnKSwgJ3VuZGVmaW5lZCcpKSB7CiAgICAgICAgICAgICAgICAgIHBpbWFyY2hpdmVzcmVjb3Jkc0RhdGEgPSBKU09OLnBhcnNlKHRoaXMudGVtcFN0b3JhZ2UuZ2V0SXRlbShjb250ZXh0LnNyZnNlc3Npb25rZXkgKyAnX3BpbWFyY2hpdmVzcmVjb3JkcycpKTsKCiAgICAgICAgICAgICAgICAgIGlmIChwaW1hcmNoaXZlc3JlY29yZHNEYXRhICYmIHBpbWFyY2hpdmVzcmVjb3Jkc0RhdGEubGVuZ3RoICYmIHBpbWFyY2hpdmVzcmVjb3Jkc0RhdGEubGVuZ3RoID4gMCkgewogICAgICAgICAgICAgICAgICAgIHBpbWFyY2hpdmVzcmVjb3Jkc0RhdGEuZm9yRWFjaChmdW5jdGlvbiAoaXRlbSkgewogICAgICAgICAgICAgICAgICAgICAgaWYgKGl0ZW0uc3JmZnJvbnR1ZikgewogICAgICAgICAgICAgICAgICAgICAgICBpZiAoT2JqZWN0LmlzKGl0ZW0uc3JmZnJvbnR1ZiwgIjAiKSkgewogICAgICAgICAgICAgICAgICAgICAgICAgIGl0ZW0ucGltYXJjaGl2ZXNyZWNvcmRpZCA9IG51bGw7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgICAgIGRlbGV0ZSBpdGVtLnNyZmZyb250dWY7CiAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBtYXN0ZXJEYXRhLnBpbWFyY2hpdmVzcmVjb3JkcyA9IHBpbWFyY2hpdmVzcmVjb3Jkc0RhdGE7CiAgICAgICAgICAgICAgICBPYmplY3QuYXNzaWduKGRhdGEsIG1hc3RlckRhdGEpOwogICAgICAgICAgICAgICAgX2NvbnRleHQ2Lm5leHQgPSAxODsKICAgICAgICAgICAgICAgIHJldHVybiBIdHRwLmdldEluc3RhbmNlKCkucHV0KCIvcGltYXJjaGl2ZXMvIi5jb25jYXQoY29udGV4dC5waW1hcmNoaXZlcyksIGRhdGEsIGlzbG9hZGluZyk7CgogICAgICAgICAgICAgIGNhc2UgMTg6CiAgICAgICAgICAgICAgICByZXMgPSBfY29udGV4dDYuc2VudDsKICAgICAgICAgICAgICAgIHRoaXMudGVtcFN0b3JhZ2Uuc2V0SXRlbShjb250ZXh0LnNyZnNlc3Npb25rZXkgKyAnX3BpbWFyY2hpdmVzbG9hbmFuZHJldHVybnMnLCBKU09OLnN0cmluZ2lmeShyZXMuZGF0YS5waW1hcmNoaXZlc2xvYW5hbmRyZXR1cm5zKSk7CiAgICAgICAgICAgICAgICB0aGlzLnRlbXBTdG9yYWdlLnNldEl0ZW0oY29udGV4dC5zcmZzZXNzaW9ua2V5ICsgJ19waW1hcmNoaXZlc2NoYW5nZXMnLCBKU09OLnN0cmluZ2lmeShyZXMuZGF0YS5waW1hcmNoaXZlc2NoYW5nZXMpKTsKICAgICAgICAgICAgICAgIHRoaXMudGVtcFN0b3JhZ2Uuc2V0SXRlbShjb250ZXh0LnNyZnNlc3Npb25rZXkgKyAnX3BpbWFyY2hpdmVzcmVjb3JkcycsIEpTT04uc3RyaW5naWZ5KHJlcy5kYXRhLnBpbWFyY2hpdmVzcmVjb3JkcykpOwogICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0Ni5hYnJ1cHQoInJldHVybiIsIHJlcyk7CgogICAgICAgICAgICAgIGNhc2UgMjM6CiAgICAgICAgICAgICAgY2FzZSAiZW5kIjoKICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDYuc3RvcCgpOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSwgX2NhbGxlZTYsIHRoaXMpOwogICAgICB9KSk7CgogICAgICBmdW5jdGlvbiBVcGRhdGUoKSB7CiAgICAgICAgcmV0dXJuIF9VcGRhdGUuYXBwbHkodGhpcywgYXJndW1lbnRzKTsKICAgICAgfQoKICAgICAgcmV0dXJuIFVwZGF0ZTsKICAgIH0oKQogICAgLyoqDQogICAgICogQ2hlY2tLZXnmjqXlj6Pmlrnms5UNCiAgICAgKg0KICAgICAqIEBwYXJhbSB7Kn0gW2NvbnRleHQ9e31dDQogICAgICogQHBhcmFtIHsqfSBbZGF0YT17fV0NCiAgICAgKiBAcGFyYW0ge2Jvb2xlYW59IFtpc2xvYWRpbmddDQogICAgICogQHJldHVybnMge1Byb21pc2U8YW55Pn0NCiAgICAgKiBAbWVtYmVyb2YgUGltQXJjaGl2ZXNTZXJ2aWNlQmFzZQ0KICAgICAqLwoKICB9LCB7CiAgICBrZXk6ICJDaGVja0tleSIsCiAgICB2YWx1ZTogZnVuY3Rpb24gKCkgewogICAgICB2YXIgX0NoZWNrS2V5ID0gX2FzeW5jVG9HZW5lcmF0b3IoCiAgICAgIC8qI19fUFVSRV9fKi8KICAgICAgcmVnZW5lcmF0b3JSdW50aW1lLm1hcmsoZnVuY3Rpb24gX2NhbGxlZTcoKSB7CiAgICAgICAgdmFyIGNvbnRleHQsCiAgICAgICAgICAgIGRhdGEsCiAgICAgICAgICAgIGlzbG9hZGluZywKICAgICAgICAgICAgX2FyZ3M3ID0gYXJndW1lbnRzOwogICAgICAgIHJldHVybiByZWdlbmVyYXRvclJ1bnRpbWUud3JhcChmdW5jdGlvbiBfY2FsbGVlNyQoX2NvbnRleHQ3KSB7CiAgICAgICAgICB3aGlsZSAoMSkgewogICAgICAgICAgICBzd2l0Y2ggKF9jb250ZXh0Ny5wcmV2ID0gX2NvbnRleHQ3Lm5leHQpIHsKICAgICAgICAgICAgICBjYXNlIDA6CiAgICAgICAgICAgICAgICBjb250ZXh0ID0gX2FyZ3M3Lmxlbmd0aCA+IDAgJiYgX2FyZ3M3WzBdICE9PSB1bmRlZmluZWQgPyBfYXJnczdbMF0gOiB7fTsKICAgICAgICAgICAgICAgIGRhdGEgPSBfYXJnczcubGVuZ3RoID4gMSAmJiBfYXJnczdbMV0gIT09IHVuZGVmaW5lZCA/IF9hcmdzN1sxXSA6IHt9OwogICAgICAgICAgICAgICAgaXNsb2FkaW5nID0gX2FyZ3M3Lmxlbmd0aCA+IDIgPyBfYXJnczdbMl0gOiB1bmRlZmluZWQ7CgogICAgICAgICAgICAgICAgaWYgKCEoY29udGV4dC5waW1wZXJzb24gJiYgY29udGV4dC5waW1hcmNoaXZlcykpIHsKICAgICAgICAgICAgICAgICAgX2NvbnRleHQ3Lm5leHQgPSA1OwogICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQ3LmFicnVwdCgicmV0dXJuIiwgSHR0cC5nZXRJbnN0YW5jZSgpLnBvc3QoIi9waW1wZW9wbGUvIi5jb25jYXQoY29udGV4dC5waW1wZXJzb24sICIvcGltYXJjaGl2ZXMvIikuY29uY2F0KGNvbnRleHQucGltYXJjaGl2ZXMsICIvY2hlY2trZXkiKSwgZGF0YSwgaXNsb2FkaW5nKSk7CgogICAgICAgICAgICAgIGNhc2UgNToKICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDcuYWJydXB0KCJyZXR1cm4iLCBIdHRwLmdldEluc3RhbmNlKCkucG9zdCgiL3BpbWFyY2hpdmVzLyIuY29uY2F0KGNvbnRleHQucGltYXJjaGl2ZXMsICIvY2hlY2trZXkiKSwgZGF0YSwgaXNsb2FkaW5nKSk7CgogICAgICAgICAgICAgIGNhc2UgNjoKICAgICAgICAgICAgICBjYXNlICJlbmQiOgogICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0Ny5zdG9wKCk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9LCBfY2FsbGVlNyk7CiAgICAgIH0pKTsKCiAgICAgIGZ1bmN0aW9uIENoZWNrS2V5KCkgewogICAgICAgIHJldHVybiBfQ2hlY2tLZXkuYXBwbHkodGhpcywgYXJndW1lbnRzKTsKICAgICAgfQoKICAgICAgcmV0dXJuIENoZWNrS2V5OwogICAgfSgpCiAgICAvKioNCiAgICAgKiBDcmVhdGXmjqXlj6Pmlrnms5UNCiAgICAgKg0KICAgICAqIEBwYXJhbSB7Kn0gW2NvbnRleHQ9e31dDQogICAgICogQHBhcmFtIHsqfSBbZGF0YT17fV0NCiAgICAgKiBAcGFyYW0ge2Jvb2xlYW59IFtpc2xvYWRpbmddDQogICAgICogQHJldHVybnMge1Byb21pc2U8YW55Pn0NCiAgICAgKiBAbWVtYmVyb2YgUGltQXJjaGl2ZXNTZXJ2aWNlQmFzZQ0KICAgICAqLwoKICB9LCB7CiAgICBrZXk6ICJDcmVhdGUiLAogICAgdmFsdWU6IGZ1bmN0aW9uICgpIHsKICAgICAgdmFyIF9DcmVhdGUgPSBfYXN5bmNUb0dlbmVyYXRvcigKICAgICAgLyojX19QVVJFX18qLwogICAgICByZWdlbmVyYXRvclJ1bnRpbWUubWFyayhmdW5jdGlvbiBfY2FsbGVlOCgpIHsKICAgICAgICB2YXIgY29udGV4dCwKICAgICAgICAgICAgZGF0YSwKICAgICAgICAgICAgaXNsb2FkaW5nLAogICAgICAgICAgICBtYXN0ZXJEYXRhLAogICAgICAgICAgICBwaW1hcmNoaXZlc2xvYW5hbmRyZXR1cm5zRGF0YSwKICAgICAgICAgICAgcGltYXJjaGl2ZXNjaGFuZ2VzRGF0YSwKICAgICAgICAgICAgcGltYXJjaGl2ZXNyZWNvcmRzRGF0YSwKICAgICAgICAgICAgdGVtcENvbnRleHQsCiAgICAgICAgICAgIHJlcywKICAgICAgICAgICAgX2FyZ3M4ID0gYXJndW1lbnRzOwogICAgICAgIHJldHVybiByZWdlbmVyYXRvclJ1bnRpbWUud3JhcChmdW5jdGlvbiBfY2FsbGVlOCQoX2NvbnRleHQ4KSB7CiAgICAgICAgICB3aGlsZSAoMSkgewogICAgICAgICAgICBzd2l0Y2ggKF9jb250ZXh0OC5wcmV2ID0gX2NvbnRleHQ4Lm5leHQpIHsKICAgICAgICAgICAgICBjYXNlIDA6CiAgICAgICAgICAgICAgICBjb250ZXh0ID0gX2FyZ3M4Lmxlbmd0aCA+IDAgJiYgX2FyZ3M4WzBdICE9PSB1bmRlZmluZWQgPyBfYXJnczhbMF0gOiB7fTsKICAgICAgICAgICAgICAgIGRhdGEgPSBfYXJnczgubGVuZ3RoID4gMSAmJiBfYXJnczhbMV0gIT09IHVuZGVmaW5lZCA/IF9hcmdzOFsxXSA6IHt9OwogICAgICAgICAgICAgICAgaXNsb2FkaW5nID0gX2FyZ3M4Lmxlbmd0aCA+IDIgPyBfYXJnczhbMl0gOiB1bmRlZmluZWQ7CgogICAgICAgICAgICAgICAgaWYgKCEoY29udGV4dC5waW1wZXJzb24gJiYgdHJ1ZSkpIHsKICAgICAgICAgICAgICAgICAgX2NvbnRleHQ4Lm5leHQgPSA3OwogICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBpZiAoIWRhdGEuc3JmZnJvbnR1ZiB8fCBkYXRhLnNyZmZyb250dWYgIT09ICIxIikgewogICAgICAgICAgICAgICAgICBkYXRhW3RoaXMuQVBQREVLRVldID0gbnVsbDsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBpZiAoZGF0YS5zcmZmcm9udHVmKSB7CiAgICAgICAgICAgICAgICAgIGRlbGV0ZSBkYXRhLnNyZmZyb250dWY7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0OC5hYnJ1cHQoInJldHVybiIsIEh0dHAuZ2V0SW5zdGFuY2UoKS5wb3N0KCIvcGltcGVvcGxlLyIuY29uY2F0KGNvbnRleHQucGltcGVyc29uLCAiL3BpbWFyY2hpdmVzIiksIGRhdGEsIGlzbG9hZGluZykpOwoKICAgICAgICAgICAgICBjYXNlIDc6CiAgICAgICAgICAgICAgICBtYXN0ZXJEYXRhID0ge307CiAgICAgICAgICAgICAgICBwaW1hcmNoaXZlc2xvYW5hbmRyZXR1cm5zRGF0YSA9IFtdOwoKICAgICAgICAgICAgICAgIGlmICghT2JqZWN0LmlzKHRoaXMudGVtcFN0b3JhZ2UuZ2V0SXRlbShjb250ZXh0LnNyZnNlc3Npb25rZXkgKyAnX3BpbWFyY2hpdmVzbG9hbmFuZHJldHVybnMnKSwgJ3VuZGVmaW5lZCcpKSB7CiAgICAgICAgICAgICAgICAgIHBpbWFyY2hpdmVzbG9hbmFuZHJldHVybnNEYXRhID0gSlNPTi5wYXJzZSh0aGlzLnRlbXBTdG9yYWdlLmdldEl0ZW0oY29udGV4dC5zcmZzZXNzaW9ua2V5ICsgJ19waW1hcmNoaXZlc2xvYW5hbmRyZXR1cm5zJykpOwoKICAgICAgICAgICAgICAgICAgaWYgKHBpbWFyY2hpdmVzbG9hbmFuZHJldHVybnNEYXRhICYmIHBpbWFyY2hpdmVzbG9hbmFuZHJldHVybnNEYXRhLmxlbmd0aCAmJiBwaW1hcmNoaXZlc2xvYW5hbmRyZXR1cm5zRGF0YS5sZW5ndGggPiAwKSB7CiAgICAgICAgICAgICAgICAgICAgcGltYXJjaGl2ZXNsb2FuYW5kcmV0dXJuc0RhdGEuZm9yRWFjaChmdW5jdGlvbiAoaXRlbSkgewogICAgICAgICAgICAgICAgICAgICAgaWYgKGl0ZW0uc3JmZnJvbnR1ZikgewogICAgICAgICAgICAgICAgICAgICAgICBpZiAoT2JqZWN0LmlzKGl0ZW0uc3JmZnJvbnR1ZiwgIjAiKSkgewogICAgICAgICAgICAgICAgICAgICAgICAgIGl0ZW0ucGltYXJjaGl2ZXNsb2FuYW5kcmV0dXJuaWQgPSBudWxsOwogICAgICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgICAgICBkZWxldGUgaXRlbS5zcmZmcm9udHVmOwogICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgbWFzdGVyRGF0YS5waW1hcmNoaXZlc2xvYW5hbmRyZXR1cm5zID0gcGltYXJjaGl2ZXNsb2FuYW5kcmV0dXJuc0RhdGE7CiAgICAgICAgICAgICAgICBwaW1hcmNoaXZlc2NoYW5nZXNEYXRhID0gW107CgogICAgICAgICAgICAgICAgaWYgKCFPYmplY3QuaXModGhpcy50ZW1wU3RvcmFnZS5nZXRJdGVtKGNvbnRleHQuc3Jmc2Vzc2lvbmtleSArICdfcGltYXJjaGl2ZXNjaGFuZ2VzJyksICd1bmRlZmluZWQnKSkgewogICAgICAgICAgICAgICAgICBwaW1hcmNoaXZlc2NoYW5nZXNEYXRhID0gSlNPTi5wYXJzZSh0aGlzLnRlbXBTdG9yYWdlLmdldEl0ZW0oY29udGV4dC5zcmZzZXNzaW9ua2V5ICsgJ19waW1hcmNoaXZlc2NoYW5nZXMnKSk7CgogICAgICAgICAgICAgICAgICBpZiAocGltYXJjaGl2ZXNjaGFuZ2VzRGF0YSAmJiBwaW1hcmNoaXZlc2NoYW5nZXNEYXRhLmxlbmd0aCAmJiBwaW1hcmNoaXZlc2NoYW5nZXNEYXRhLmxlbmd0aCA+IDApIHsKICAgICAgICAgICAgICAgICAgICBwaW1hcmNoaXZlc2NoYW5nZXNEYXRhLmZvckVhY2goZnVuY3Rpb24gKGl0ZW0pIHsKICAgICAgICAgICAgICAgICAgICAgIGlmIChpdGVtLnNyZmZyb250dWYpIHsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKE9iamVjdC5pcyhpdGVtLnNyZmZyb250dWYsICIwIikpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICBpdGVtLnBpbWFyY2hpdmVzY2hhbmdlaWQgPSBudWxsOwogICAgICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgICAgICBkZWxldGUgaXRlbS5zcmZmcm9udHVmOwogICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgbWFzdGVyRGF0YS5waW1hcmNoaXZlc2NoYW5nZXMgPSBwaW1hcmNoaXZlc2NoYW5nZXNEYXRhOwogICAgICAgICAgICAgICAgcGltYXJjaGl2ZXNyZWNvcmRzRGF0YSA9IFtdOwoKICAgICAgICAgICAgICAgIGlmICghT2JqZWN0LmlzKHRoaXMudGVtcFN0b3JhZ2UuZ2V0SXRlbShjb250ZXh0LnNyZnNlc3Npb25rZXkgKyAnX3BpbWFyY2hpdmVzcmVjb3JkcycpLCAndW5kZWZpbmVkJykpIHsKICAgICAgICAgICAgICAgICAgcGltYXJjaGl2ZXNyZWNvcmRzRGF0YSA9IEpTT04ucGFyc2UodGhpcy50ZW1wU3RvcmFnZS5nZXRJdGVtKGNvbnRleHQuc3Jmc2Vzc2lvbmtleSArICdfcGltYXJjaGl2ZXNyZWNvcmRzJykpOwoKICAgICAgICAgICAgICAgICAgaWYgKHBpbWFyY2hpdmVzcmVjb3Jkc0RhdGEgJiYgcGltYXJjaGl2ZXNyZWNvcmRzRGF0YS5sZW5ndGggJiYgcGltYXJjaGl2ZXNyZWNvcmRzRGF0YS5sZW5ndGggPiAwKSB7CiAgICAgICAgICAgICAgICAgICAgcGltYXJjaGl2ZXNyZWNvcmRzRGF0YS5mb3JFYWNoKGZ1bmN0aW9uIChpdGVtKSB7CiAgICAgICAgICAgICAgICAgICAgICBpZiAoaXRlbS5zcmZmcm9udHVmKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChPYmplY3QuaXMoaXRlbS5zcmZmcm9udHVmLCAiMCIpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgaXRlbS5waW1hcmNoaXZlc3JlY29yZGlkID0gbnVsbDsKICAgICAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICAgICAgZGVsZXRlIGl0ZW0uc3JmZnJvbnR1ZjsKICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIG1hc3RlckRhdGEucGltYXJjaGl2ZXNyZWNvcmRzID0gcGltYXJjaGl2ZXNyZWNvcmRzRGF0YTsKICAgICAgICAgICAgICAgIE9iamVjdC5hc3NpZ24oZGF0YSwgbWFzdGVyRGF0YSk7CgogICAgICAgICAgICAgICAgaWYgKCFkYXRhLnNyZmZyb250dWYgfHwgZGF0YS5zcmZmcm9udHVmICE9PSAiMSIpIHsKICAgICAgICAgICAgICAgICAgZGF0YVt0aGlzLkFQUERFS0VZXSA9IG51bGw7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgaWYgKGRhdGEuc3JmZnJvbnR1ZikgewogICAgICAgICAgICAgICAgICBkZWxldGUgZGF0YS5zcmZmcm9udHVmOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIHRlbXBDb250ZXh0ID0gSlNPTi5wYXJzZShKU09OLnN0cmluZ2lmeShjb250ZXh0KSk7CiAgICAgICAgICAgICAgICBfY29udGV4dDgubmV4dCA9IDIzOwogICAgICAgICAgICAgICAgcmV0dXJuIEh0dHAuZ2V0SW5zdGFuY2UoKS5wb3N0KCIvcGltYXJjaGl2ZXMiLCBkYXRhLCBpc2xvYWRpbmcpOwoKICAgICAgICAgICAgICBjYXNlIDIzOgogICAgICAgICAgICAgICAgcmVzID0gX2NvbnRleHQ4LnNlbnQ7CiAgICAgICAgICAgICAgICB0aGlzLnRlbXBTdG9yYWdlLnNldEl0ZW0odGVtcENvbnRleHQuc3Jmc2Vzc2lvbmtleSArICdfcGltYXJjaGl2ZXNsb2FuYW5kcmV0dXJucycsIEpTT04uc3RyaW5naWZ5KHJlcy5kYXRhLnBpbWFyY2hpdmVzbG9hbmFuZHJldHVybnMpKTsKICAgICAgICAgICAgICAgIHRoaXMudGVtcFN0b3JhZ2Uuc2V0SXRlbSh0ZW1wQ29udGV4dC5zcmZzZXNzaW9ua2V5ICsgJ19waW1hcmNoaXZlc2NoYW5nZXMnLCBKU09OLnN0cmluZ2lmeShyZXMuZGF0YS5waW1hcmNoaXZlc2NoYW5nZXMpKTsKICAgICAgICAgICAgICAgIHRoaXMudGVtcFN0b3JhZ2Uuc2V0SXRlbSh0ZW1wQ29udGV4dC5zcmZzZXNzaW9ua2V5ICsgJ19waW1hcmNoaXZlc3JlY29yZHMnLCBKU09OLnN0cmluZ2lmeShyZXMuZGF0YS5waW1hcmNoaXZlc3JlY29yZHMpKTsKICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDguYWJydXB0KCJyZXR1cm4iLCByZXMpOwoKICAgICAgICAgICAgICBjYXNlIDI4OgogICAgICAgICAgICAgIGNhc2UgImVuZCI6CiAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQ4LnN0b3AoKTsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0sIF9jYWxsZWU4LCB0aGlzKTsKICAgICAgfSkpOwoKICAgICAgZnVuY3Rpb24gQ3JlYXRlKCkgewogICAgICAgIHJldHVybiBfQ3JlYXRlLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7CiAgICAgIH0KCiAgICAgIHJldHVybiBDcmVhdGU7CiAgICB9KCkKICAgIC8qKg0KICAgICAqIFJlbW92ZeaOpeWPo+aWueazlQ0KICAgICAqDQogICAgICogQHBhcmFtIHsqfSBbY29udGV4dD17fV0NCiAgICAgKiBAcGFyYW0geyp9IFtkYXRhPXt9XQ0KICAgICAqIEBwYXJhbSB7Ym9vbGVhbn0gW2lzbG9hZGluZ10NCiAgICAgKiBAcmV0dXJucyB7UHJvbWlzZTxhbnk+fQ0KICAgICAqIEBtZW1iZXJvZiBQaW1BcmNoaXZlc1NlcnZpY2VCYXNlDQogICAgICovCgogIH0sIHsKICAgIGtleTogIlJlbW92ZSIsCiAgICB2YWx1ZTogZnVuY3Rpb24gKCkgewogICAgICB2YXIgX1JlbW92ZSA9IF9hc3luY1RvR2VuZXJhdG9yKAogICAgICAvKiNfX1BVUkVfXyovCiAgICAgIHJlZ2VuZXJhdG9yUnVudGltZS5tYXJrKGZ1bmN0aW9uIF9jYWxsZWU5KCkgewogICAgICAgIHZhciBjb250ZXh0LAogICAgICAgICAgICBkYXRhLAogICAgICAgICAgICBpc2xvYWRpbmcsCiAgICAgICAgICAgIF9hcmdzOSA9IGFyZ3VtZW50czsKICAgICAgICByZXR1cm4gcmVnZW5lcmF0b3JSdW50aW1lLndyYXAoZnVuY3Rpb24gX2NhbGxlZTkkKF9jb250ZXh0OSkgewogICAgICAgICAgd2hpbGUgKDEpIHsKICAgICAgICAgICAgc3dpdGNoIChfY29udGV4dDkucHJldiA9IF9jb250ZXh0OS5uZXh0KSB7CiAgICAgICAgICAgICAgY2FzZSAwOgogICAgICAgICAgICAgICAgY29udGV4dCA9IF9hcmdzOS5sZW5ndGggPiAwICYmIF9hcmdzOVswXSAhPT0gdW5kZWZpbmVkID8gX2FyZ3M5WzBdIDoge307CiAgICAgICAgICAgICAgICBkYXRhID0gX2FyZ3M5Lmxlbmd0aCA+IDEgJiYgX2FyZ3M5WzFdICE9PSB1bmRlZmluZWQgPyBfYXJnczlbMV0gOiB7fTsKICAgICAgICAgICAgICAgIGlzbG9hZGluZyA9IF9hcmdzOS5sZW5ndGggPiAyID8gX2FyZ3M5WzJdIDogdW5kZWZpbmVkOwoKICAgICAgICAgICAgICAgIGlmICghKGNvbnRleHQucGltcGVyc29uICYmIGNvbnRleHQucGltYXJjaGl2ZXMpKSB7CiAgICAgICAgICAgICAgICAgIF9jb250ZXh0OS5uZXh0ID0gNTsKICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0OS5hYnJ1cHQoInJldHVybiIsIEh0dHAuZ2V0SW5zdGFuY2UoKVsiZGVsZXRlIl0oIi9waW1wZW9wbGUvIi5jb25jYXQoY29udGV4dC5waW1wZXJzb24sICIvcGltYXJjaGl2ZXMvIikuY29uY2F0KGNvbnRleHQucGltYXJjaGl2ZXMpLCBpc2xvYWRpbmcpKTsKCiAgICAgICAgICAgICAgY2FzZSA1OgogICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0OS5hYnJ1cHQoInJldHVybiIsIEh0dHAuZ2V0SW5zdGFuY2UoKVsiZGVsZXRlIl0oIi9waW1hcmNoaXZlcy8iLmNvbmNhdChjb250ZXh0LnBpbWFyY2hpdmVzKSwgaXNsb2FkaW5nKSk7CgogICAgICAgICAgICAgIGNhc2UgNjoKICAgICAgICAgICAgICBjYXNlICJlbmQiOgogICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0OS5zdG9wKCk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9LCBfY2FsbGVlOSk7CiAgICAgIH0pKTsKCiAgICAgIGZ1bmN0aW9uIFJlbW92ZSgpIHsKICAgICAgICByZXR1cm4gX1JlbW92ZS5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwogICAgICB9CgogICAgICByZXR1cm4gUmVtb3ZlOwogICAgfSgpCiAgICAvKioNCiAgICAgKiBGZXRjaEVNTE9ZRUVOT0ZJTEXmjqXlj6Pmlrnms5UNCiAgICAgKg0KICAgICAqIEBwYXJhbSB7Kn0gW2NvbnRleHQ9e31dDQogICAgICogQHBhcmFtIHsqfSBbZGF0YT17fV0NCiAgICAgKiBAcGFyYW0ge2Jvb2xlYW59IFtpc2xvYWRpbmddDQogICAgICogQHJldHVybnMge1Byb21pc2U8YW55Pn0NCiAgICAgKiBAbWVtYmVyb2YgUGltQXJjaGl2ZXNTZXJ2aWNlQmFzZQ0KICAgICAqLwoKICB9LCB7CiAgICBrZXk6ICJGZXRjaEVNTE9ZRUVOT0ZJTEUiLAogICAgdmFsdWU6IGZ1bmN0aW9uICgpIHsKICAgICAgdmFyIF9GZXRjaEVNTE9ZRUVOT0ZJTEUgPSBfYXN5bmNUb0dlbmVyYXRvcigKICAgICAgLyojX19QVVJFX18qLwogICAgICByZWdlbmVyYXRvclJ1bnRpbWUubWFyayhmdW5jdGlvbiBfY2FsbGVlMTAoKSB7CiAgICAgICAgdmFyIGNvbnRleHQsCiAgICAgICAgICAgIGRhdGEsCiAgICAgICAgICAgIGlzbG9hZGluZywKICAgICAgICAgICAgX3RlbXBEYXRhLAogICAgICAgICAgICB0ZW1wRGF0YSwKICAgICAgICAgICAgX2FyZ3MxMCA9IGFyZ3VtZW50czsKCiAgICAgICAgcmV0dXJuIHJlZ2VuZXJhdG9yUnVudGltZS53cmFwKGZ1bmN0aW9uIF9jYWxsZWUxMCQoX2NvbnRleHQxMCkgewogICAgICAgICAgd2hpbGUgKDEpIHsKICAgICAgICAgICAgc3dpdGNoIChfY29udGV4dDEwLnByZXYgPSBfY29udGV4dDEwLm5leHQpIHsKICAgICAgICAgICAgICBjYXNlIDA6CiAgICAgICAgICAgICAgICBjb250ZXh0ID0gX2FyZ3MxMC5sZW5ndGggPiAwICYmIF9hcmdzMTBbMF0gIT09IHVuZGVmaW5lZCA/IF9hcmdzMTBbMF0gOiB7fTsKICAgICAgICAgICAgICAgIGRhdGEgPSBfYXJnczEwLmxlbmd0aCA+IDEgJiYgX2FyZ3MxMFsxXSAhPT0gdW5kZWZpbmVkID8gX2FyZ3MxMFsxXSA6IHt9OwogICAgICAgICAgICAgICAgaXNsb2FkaW5nID0gX2FyZ3MxMC5sZW5ndGggPiAyID8gX2FyZ3MxMFsyXSA6IHVuZGVmaW5lZDsKCiAgICAgICAgICAgICAgICBpZiAoIShjb250ZXh0LnBpbXBlcnNvbiAmJiB0cnVlKSkgewogICAgICAgICAgICAgICAgICBfY29udGV4dDEwLm5leHQgPSA2OwogICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBfdGVtcERhdGEgPSBKU09OLnBhcnNlKEpTT04uc3RyaW5naWZ5KGRhdGEpKTsKICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDEwLmFicnVwdCgicmV0dXJuIiwgSHR0cC5nZXRJbnN0YW5jZSgpLmdldCgiL3BpbXBlb3BsZS8iLmNvbmNhdChjb250ZXh0LnBpbXBlcnNvbiwgIi9waW1hcmNoaXZlcy9mZXRjaGVtbG95ZWVub2ZpbGUiKSwgX3RlbXBEYXRhLCBpc2xvYWRpbmcpKTsKCiAgICAgICAgICAgICAgY2FzZSA2OgogICAgICAgICAgICAgICAgdGVtcERhdGEgPSBKU09OLnBhcnNlKEpTT04uc3RyaW5naWZ5KGRhdGEpKTsKICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDEwLmFicnVwdCgicmV0dXJuIiwgSHR0cC5nZXRJbnN0YW5jZSgpLmdldCgiL3BpbWFyY2hpdmVzL2ZldGNoZW1sb3llZW5vZmlsZSIsIHRlbXBEYXRhLCBpc2xvYWRpbmcpKTsKCiAgICAgICAgICAgICAgY2FzZSA4OgogICAgICAgICAgICAgIGNhc2UgImVuZCI6CiAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQxMC5zdG9wKCk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9LCBfY2FsbGVlMTApOwogICAgICB9KSk7CgogICAgICBmdW5jdGlvbiBGZXRjaEVNTE9ZRUVOT0ZJTEUoKSB7CiAgICAgICAgcmV0dXJuIF9GZXRjaEVNTE9ZRUVOT0ZJTEUuYXBwbHkodGhpcywgYXJndW1lbnRzKTsKICAgICAgfQoKICAgICAgcmV0dXJuIEZldGNoRU1MT1lFRU5PRklMRTsKICAgIH0oKQogICAgLyoqDQogICAgICogRmV0Y2hTeXNPcmdJc1NyZk9yZ+aOpeWPo+aWueazlQ0KICAgICAqDQogICAgICogQHBhcmFtIHsqfSBbY29udGV4dD17fV0NCiAgICAgKiBAcGFyYW0geyp9IFtkYXRhPXt9XQ0KICAgICAqIEBwYXJhbSB7Ym9vbGVhbn0gW2lzbG9hZGluZ10NCiAgICAgKiBAcmV0dXJucyB7UHJvbWlzZTxhbnk+fQ0KICAgICAqIEBtZW1iZXJvZiBQaW1BcmNoaXZlc1NlcnZpY2VCYXNlDQogICAgICovCgogIH0sIHsKICAgIGtleTogIkZldGNoU3lzT3JnSXNTcmZPcmciLAogICAgdmFsdWU6IGZ1bmN0aW9uICgpIHsKICAgICAgdmFyIF9GZXRjaFN5c09yZ0lzU3JmT3JnID0gX2FzeW5jVG9HZW5lcmF0b3IoCiAgICAgIC8qI19fUFVSRV9fKi8KICAgICAgcmVnZW5lcmF0b3JSdW50aW1lLm1hcmsoZnVuY3Rpb24gX2NhbGxlZTExKCkgewogICAgICAgIHZhciBjb250ZXh0LAogICAgICAgICAgICBkYXRhLAogICAgICAgICAgICBpc2xvYWRpbmcsCiAgICAgICAgICAgIF90ZW1wRGF0YTIsCiAgICAgICAgICAgIHRlbXBEYXRhLAogICAgICAgICAgICBfYXJnczExID0gYXJndW1lbnRzOwoKICAgICAgICByZXR1cm4gcmVnZW5lcmF0b3JSdW50aW1lLndyYXAoZnVuY3Rpb24gX2NhbGxlZTExJChfY29udGV4dDExKSB7CiAgICAgICAgICB3aGlsZSAoMSkgewogICAgICAgICAgICBzd2l0Y2ggKF9jb250ZXh0MTEucHJldiA9IF9jb250ZXh0MTEubmV4dCkgewogICAgICAgICAgICAgIGNhc2UgMDoKICAgICAgICAgICAgICAgIGNvbnRleHQgPSBfYXJnczExLmxlbmd0aCA+IDAgJiYgX2FyZ3MxMVswXSAhPT0gdW5kZWZpbmVkID8gX2FyZ3MxMVswXSA6IHt9OwogICAgICAgICAgICAgICAgZGF0YSA9IF9hcmdzMTEubGVuZ3RoID4gMSAmJiBfYXJnczExWzFdICE9PSB1bmRlZmluZWQgPyBfYXJnczExWzFdIDoge307CiAgICAgICAgICAgICAgICBpc2xvYWRpbmcgPSBfYXJnczExLmxlbmd0aCA+IDIgPyBfYXJnczExWzJdIDogdW5kZWZpbmVkOwoKICAgICAgICAgICAgICAgIGlmICghKGNvbnRleHQucGltcGVyc29uICYmIHRydWUpKSB7CiAgICAgICAgICAgICAgICAgIF9jb250ZXh0MTEubmV4dCA9IDY7CiAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIF90ZW1wRGF0YTIgPSBKU09OLnBhcnNlKEpTT04uc3RyaW5naWZ5KGRhdGEpKTsKICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDExLmFicnVwdCgicmV0dXJuIiwgSHR0cC5nZXRJbnN0YW5jZSgpLmdldCgiL3BpbXBlb3BsZS8iLmNvbmNhdChjb250ZXh0LnBpbXBlcnNvbiwgIi9waW1hcmNoaXZlcy9mZXRjaHN5c29yZ2lzc3Jmb3JnIiksIF90ZW1wRGF0YTIsIGlzbG9hZGluZykpOwoKICAgICAgICAgICAgICBjYXNlIDY6CiAgICAgICAgICAgICAgICB0ZW1wRGF0YSA9IEpTT04ucGFyc2UoSlNPTi5zdHJpbmdpZnkoZGF0YSkpOwogICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0MTEuYWJydXB0KCJyZXR1cm4iLCBIdHRwLmdldEluc3RhbmNlKCkuZ2V0KCIvcGltYXJjaGl2ZXMvZmV0Y2hzeXNvcmdpc3NyZm9yZyIsIHRlbXBEYXRhLCBpc2xvYWRpbmcpKTsKCiAgICAgICAgICAgICAgY2FzZSA4OgogICAgICAgICAgICAgIGNhc2UgImVuZCI6CiAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQxMS5zdG9wKCk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9LCBfY2FsbGVlMTEpOwogICAgICB9KSk7CgogICAgICBmdW5jdGlvbiBGZXRjaFN5c09yZ0lzU3JmT3JnKCkgewogICAgICAgIHJldHVybiBfRmV0Y2hTeXNPcmdJc1NyZk9yZy5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwogICAgICB9CgogICAgICByZXR1cm4gRmV0Y2hTeXNPcmdJc1NyZk9yZzsKICAgIH0oKQogICAgLyoqDQogICAgICogRmV0Y2hEZWZhdWx05o6l5Y+j5pa55rOVDQogICAgICoNCiAgICAgKiBAcGFyYW0geyp9IFtjb250ZXh0PXt9XQ0KICAgICAqIEBwYXJhbSB7Kn0gW2RhdGE9e31dDQogICAgICogQHBhcmFtIHtib29sZWFufSBbaXNsb2FkaW5nXQ0KICAgICAqIEByZXR1cm5zIHtQcm9taXNlPGFueT59DQogICAgICogQG1lbWJlcm9mIFBpbUFyY2hpdmVzU2VydmljZUJhc2UNCiAgICAgKi8KCiAgfSwgewogICAga2V5OiAiRmV0Y2hEZWZhdWx0IiwKICAgIHZhbHVlOiBmdW5jdGlvbiAoKSB7CiAgICAgIHZhciBfRmV0Y2hEZWZhdWx0ID0gX2FzeW5jVG9HZW5lcmF0b3IoCiAgICAgIC8qI19fUFVSRV9fKi8KICAgICAgcmVnZW5lcmF0b3JSdW50aW1lLm1hcmsoZnVuY3Rpb24gX2NhbGxlZTEyKCkgewogICAgICAgIHZhciBjb250ZXh0LAogICAgICAgICAgICBkYXRhLAogICAgICAgICAgICBpc2xvYWRpbmcsCiAgICAgICAgICAgIF90ZW1wRGF0YTMsCiAgICAgICAgICAgIHRlbXBEYXRhLAogICAgICAgICAgICBfYXJnczEyID0gYXJndW1lbnRzOwoKICAgICAgICByZXR1cm4gcmVnZW5lcmF0b3JSdW50aW1lLndyYXAoZnVuY3Rpb24gX2NhbGxlZTEyJChfY29udGV4dDEyKSB7CiAgICAgICAgICB3aGlsZSAoMSkgewogICAgICAgICAgICBzd2l0Y2ggKF9jb250ZXh0MTIucHJldiA9IF9jb250ZXh0MTIubmV4dCkgewogICAgICAgICAgICAgIGNhc2UgMDoKICAgICAgICAgICAgICAgIGNvbnRleHQgPSBfYXJnczEyLmxlbmd0aCA+IDAgJiYgX2FyZ3MxMlswXSAhPT0gdW5kZWZpbmVkID8gX2FyZ3MxMlswXSA6IHt9OwogICAgICAgICAgICAgICAgZGF0YSA9IF9hcmdzMTIubGVuZ3RoID4gMSAmJiBfYXJnczEyWzFdICE9PSB1bmRlZmluZWQgPyBfYXJnczEyWzFdIDoge307CiAgICAgICAgICAgICAgICBpc2xvYWRpbmcgPSBfYXJnczEyLmxlbmd0aCA+IDIgPyBfYXJnczEyWzJdIDogdW5kZWZpbmVkOwoKICAgICAgICAgICAgICAgIGlmICghKGNvbnRleHQucGltcGVyc29uICYmIHRydWUpKSB7CiAgICAgICAgICAgICAgICAgIF9jb250ZXh0MTIubmV4dCA9IDY7CiAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIF90ZW1wRGF0YTMgPSBKU09OLnBhcnNlKEpTT04uc3RyaW5naWZ5KGRhdGEpKTsKICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDEyLmFicnVwdCgicmV0dXJuIiwgSHR0cC5nZXRJbnN0YW5jZSgpLmdldCgiL3BpbXBlb3BsZS8iLmNvbmNhdChjb250ZXh0LnBpbXBlcnNvbiwgIi9waW1hcmNoaXZlcy9mZXRjaGRlZmF1bHQiKSwgX3RlbXBEYXRhMywgaXNsb2FkaW5nKSk7CgogICAgICAgICAgICAgIGNhc2UgNjoKICAgICAgICAgICAgICAgIHRlbXBEYXRhID0gSlNPTi5wYXJzZShKU09OLnN0cmluZ2lmeShkYXRhKSk7CiAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQxMi5hYnJ1cHQoInJldHVybiIsIEh0dHAuZ2V0SW5zdGFuY2UoKS5nZXQoIi9waW1hcmNoaXZlcy9mZXRjaGRlZmF1bHQiLCB0ZW1wRGF0YSwgaXNsb2FkaW5nKSk7CgogICAgICAgICAgICAgIGNhc2UgODoKICAgICAgICAgICAgICBjYXNlICJlbmQiOgogICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0MTIuc3RvcCgpOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSwgX2NhbGxlZTEyKTsKICAgICAgfSkpOwoKICAgICAgZnVuY3Rpb24gRmV0Y2hEZWZhdWx0KCkgewogICAgICAgIHJldHVybiBfRmV0Y2hEZWZhdWx0LmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7CiAgICAgIH0KCiAgICAgIHJldHVybiBGZXRjaERlZmF1bHQ7CiAgICB9KCkKICAgIC8qKg0KICAgICAqIEZldGNoSkxTU+aOpeWPo+aWueazlQ0KICAgICAqDQogICAgICogQHBhcmFtIHsqfSBbY29udGV4dD17fV0NCiAgICAgKiBAcGFyYW0geyp9IFtkYXRhPXt9XQ0KICAgICAqIEBwYXJhbSB7Ym9vbGVhbn0gW2lzbG9hZGluZ10NCiAgICAgKiBAcmV0dXJucyB7UHJvbWlzZTxhbnk+fQ0KICAgICAqIEBtZW1iZXJvZiBQaW1BcmNoaXZlc1NlcnZpY2VCYXNlDQogICAgICovCgogIH0sIHsKICAgIGtleTogIkZldGNoSkxTUyIsCiAgICB2YWx1ZTogZnVuY3Rpb24gKCkgewogICAgICB2YXIgX0ZldGNoSkxTUyA9IF9hc3luY1RvR2VuZXJhdG9yKAogICAgICAvKiNfX1BVUkVfXyovCiAgICAgIHJlZ2VuZXJhdG9yUnVudGltZS5tYXJrKGZ1bmN0aW9uIF9jYWxsZWUxMygpIHsKICAgICAgICB2YXIgY29udGV4dCwKICAgICAgICAgICAgZGF0YSwKICAgICAgICAgICAgaXNsb2FkaW5nLAogICAgICAgICAgICBfdGVtcERhdGE0LAogICAgICAgICAgICB0ZW1wRGF0YSwKICAgICAgICAgICAgX2FyZ3MxMyA9IGFyZ3VtZW50czsKCiAgICAgICAgcmV0dXJuIHJlZ2VuZXJhdG9yUnVudGltZS53cmFwKGZ1bmN0aW9uIF9jYWxsZWUxMyQoX2NvbnRleHQxMykgewogICAgICAgICAgd2hpbGUgKDEpIHsKICAgICAgICAgICAgc3dpdGNoIChfY29udGV4dDEzLnByZXYgPSBfY29udGV4dDEzLm5leHQpIHsKICAgICAgICAgICAgICBjYXNlIDA6CiAgICAgICAgICAgICAgICBjb250ZXh0ID0gX2FyZ3MxMy5sZW5ndGggPiAwICYmIF9hcmdzMTNbMF0gIT09IHVuZGVmaW5lZCA/IF9hcmdzMTNbMF0gOiB7fTsKICAgICAgICAgICAgICAgIGRhdGEgPSBfYXJnczEzLmxlbmd0aCA+IDEgJiYgX2FyZ3MxM1sxXSAhPT0gdW5kZWZpbmVkID8gX2FyZ3MxM1sxXSA6IHt9OwogICAgICAgICAgICAgICAgaXNsb2FkaW5nID0gX2FyZ3MxMy5sZW5ndGggPiAyID8gX2FyZ3MxM1syXSA6IHVuZGVmaW5lZDsKCiAgICAgICAgICAgICAgICBpZiAoIShjb250ZXh0LnBpbXBlcnNvbiAmJiB0cnVlKSkgewogICAgICAgICAgICAgICAgICBfY29udGV4dDEzLm5leHQgPSA2OwogICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBfdGVtcERhdGE0ID0gSlNPTi5wYXJzZShKU09OLnN0cmluZ2lmeShkYXRhKSk7CiAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQxMy5hYnJ1cHQoInJldHVybiIsIEh0dHAuZ2V0SW5zdGFuY2UoKS5nZXQoIi9waW1wZW9wbGUvIi5jb25jYXQoY29udGV4dC5waW1wZXJzb24sICIvcGltYXJjaGl2ZXMvZmV0Y2hqbHNzIiksIF90ZW1wRGF0YTQsIGlzbG9hZGluZykpOwoKICAgICAgICAgICAgICBjYXNlIDY6CiAgICAgICAgICAgICAgICB0ZW1wRGF0YSA9IEpTT04ucGFyc2UoSlNPTi5zdHJpbmdpZnkoZGF0YSkpOwogICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0MTMuYWJydXB0KCJyZXR1cm4iLCBIdHRwLmdldEluc3RhbmNlKCkuZ2V0KCIvcGltYXJjaGl2ZXMvZmV0Y2hqbHNzIiwgdGVtcERhdGEsIGlzbG9hZGluZykpOwoKICAgICAgICAgICAgICBjYXNlIDg6CiAgICAgICAgICAgICAgY2FzZSAiZW5kIjoKICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDEzLnN0b3AoKTsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0sIF9jYWxsZWUxMyk7CiAgICAgIH0pKTsKCiAgICAgIGZ1bmN0aW9uIEZldGNoSkxTUygpIHsKICAgICAgICByZXR1cm4gX0ZldGNoSkxTUy5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwogICAgICB9CgogICAgICByZXR1cm4gRmV0Y2hKTFNTOwogICAgfSgpCiAgICAvKioNCiAgICAgKiBGZXRjaFpJWkhV5o6l5Y+j5pa55rOVDQogICAgICoNCiAgICAgKiBAcGFyYW0geyp9IFtjb250ZXh0PXt9XQ0KICAgICAqIEBwYXJhbSB7Kn0gW2RhdGE9e31dDQogICAgICogQHBhcmFtIHtib29sZWFufSBbaXNsb2FkaW5nXQ0KICAgICAqIEByZXR1cm5zIHtQcm9taXNlPGFueT59DQogICAgICogQG1lbWJlcm9mIFBpbUFyY2hpdmVzU2VydmljZUJhc2UNCiAgICAgKi8KCiAgfSwgewogICAga2V5OiAiRmV0Y2haSVpIVSIsCiAgICB2YWx1ZTogZnVuY3Rpb24gKCkgewogICAgICB2YXIgX0ZldGNoWklaSFUgPSBfYXN5bmNUb0dlbmVyYXRvcigKICAgICAgLyojX19QVVJFX18qLwogICAgICByZWdlbmVyYXRvclJ1bnRpbWUubWFyayhmdW5jdGlvbiBfY2FsbGVlMTQoKSB7CiAgICAgICAgdmFyIGNvbnRleHQsCiAgICAgICAgICAgIGRhdGEsCiAgICAgICAgICAgIGlzbG9hZGluZywKICAgICAgICAgICAgX3RlbXBEYXRhNSwKICAgICAgICAgICAgdGVtcERhdGEsCiAgICAgICAgICAgIF9hcmdzMTQgPSBhcmd1bWVudHM7CgogICAgICAgIHJldHVybiByZWdlbmVyYXRvclJ1bnRpbWUud3JhcChmdW5jdGlvbiBfY2FsbGVlMTQkKF9jb250ZXh0MTQpIHsKICAgICAgICAgIHdoaWxlICgxKSB7CiAgICAgICAgICAgIHN3aXRjaCAoX2NvbnRleHQxNC5wcmV2ID0gX2NvbnRleHQxNC5uZXh0KSB7CiAgICAgICAgICAgICAgY2FzZSAwOgogICAgICAgICAgICAgICAgY29udGV4dCA9IF9hcmdzMTQubGVuZ3RoID4gMCAmJiBfYXJnczE0WzBdICE9PSB1bmRlZmluZWQgPyBfYXJnczE0WzBdIDoge307CiAgICAgICAgICAgICAgICBkYXRhID0gX2FyZ3MxNC5sZW5ndGggPiAxICYmIF9hcmdzMTRbMV0gIT09IHVuZGVmaW5lZCA/IF9hcmdzMTRbMV0gOiB7fTsKICAgICAgICAgICAgICAgIGlzbG9hZGluZyA9IF9hcmdzMTQubGVuZ3RoID4gMiA/IF9hcmdzMTRbMl0gOiB1bmRlZmluZWQ7CgogICAgICAgICAgICAgICAgaWYgKCEoY29udGV4dC5waW1wZXJzb24gJiYgdHJ1ZSkpIHsKICAgICAgICAgICAgICAgICAgX2NvbnRleHQxNC5uZXh0ID0gNjsKICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgX3RlbXBEYXRhNSA9IEpTT04ucGFyc2UoSlNPTi5zdHJpbmdpZnkoZGF0YSkpOwogICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0MTQuYWJydXB0KCJyZXR1cm4iLCBIdHRwLmdldEluc3RhbmNlKCkuZ2V0KCIvcGltcGVvcGxlLyIuY29uY2F0KGNvbnRleHQucGltcGVyc29uLCAiL3BpbWFyY2hpdmVzL2ZldGNoeml6aHUiKSwgX3RlbXBEYXRhNSwgaXNsb2FkaW5nKSk7CgogICAgICAgICAgICAgIGNhc2UgNjoKICAgICAgICAgICAgICAgIHRlbXBEYXRhID0gSlNPTi5wYXJzZShKU09OLnN0cmluZ2lmeShkYXRhKSk7CiAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQxNC5hYnJ1cHQoInJldHVybiIsIEh0dHAuZ2V0SW5zdGFuY2UoKS5nZXQoIi9waW1hcmNoaXZlcy9mZXRjaHppemh1IiwgdGVtcERhdGEsIGlzbG9hZGluZykpOwoKICAgICAgICAgICAgICBjYXNlIDg6CiAgICAgICAgICAgICAgY2FzZSAiZW5kIjoKICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDE0LnN0b3AoKTsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0sIF9jYWxsZWUxNCk7CiAgICAgIH0pKTsKCiAgICAgIGZ1bmN0aW9uIEZldGNoWklaSFUoKSB7CiAgICAgICAgcmV0dXJuIF9GZXRjaFpJWkhVLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7CiAgICAgIH0KCiAgICAgIHJldHVybiBGZXRjaFpJWkhVOwogICAgfSgpCiAgICAvKioNCiAgICAgKiBGZXRjaE5PRU1MT1lFRU5PRklMReaOpeWPo+aWueazlQ0KICAgICAqDQogICAgICogQHBhcmFtIHsqfSBbY29udGV4dD17fV0NCiAgICAgKiBAcGFyYW0geyp9IFtkYXRhPXt9XQ0KICAgICAqIEBwYXJhbSB7Ym9vbGVhbn0gW2lzbG9hZGluZ10NCiAgICAgKiBAcmV0dXJucyB7UHJvbWlzZTxhbnk+fQ0KICAgICAqIEBtZW1iZXJvZiBQaW1BcmNoaXZlc1NlcnZpY2VCYXNlDQogICAgICovCgogIH0sIHsKICAgIGtleTogIkZldGNoTk9FTUxPWUVFTk9GSUxFIiwKICAgIHZhbHVlOiBmdW5jdGlvbiAoKSB7CiAgICAgIHZhciBfRmV0Y2hOT0VNTE9ZRUVOT0ZJTEUgPSBfYXN5bmNUb0dlbmVyYXRvcigKICAgICAgLyojX19QVVJFX18qLwogICAgICByZWdlbmVyYXRvclJ1bnRpbWUubWFyayhmdW5jdGlvbiBfY2FsbGVlMTUoKSB7CiAgICAgICAgdmFyIGNvbnRleHQsCiAgICAgICAgICAgIGRhdGEsCiAgICAgICAgICAgIGlzbG9hZGluZywKICAgICAgICAgICAgX3RlbXBEYXRhNiwKICAgICAgICAgICAgdGVtcERhdGEsCiAgICAgICAgICAgIF9hcmdzMTUgPSBhcmd1bWVudHM7CgogICAgICAgIHJldHVybiByZWdlbmVyYXRvclJ1bnRpbWUud3JhcChmdW5jdGlvbiBfY2FsbGVlMTUkKF9jb250ZXh0MTUpIHsKICAgICAgICAgIHdoaWxlICgxKSB7CiAgICAgICAgICAgIHN3aXRjaCAoX2NvbnRleHQxNS5wcmV2ID0gX2NvbnRleHQxNS5uZXh0KSB7CiAgICAgICAgICAgICAgY2FzZSAwOgogICAgICAgICAgICAgICAgY29udGV4dCA9IF9hcmdzMTUubGVuZ3RoID4gMCAmJiBfYXJnczE1WzBdICE9PSB1bmRlZmluZWQgPyBfYXJnczE1WzBdIDoge307CiAgICAgICAgICAgICAgICBkYXRhID0gX2FyZ3MxNS5sZW5ndGggPiAxICYmIF9hcmdzMTVbMV0gIT09IHVuZGVmaW5lZCA/IF9hcmdzMTVbMV0gOiB7fTsKICAgICAgICAgICAgICAgIGlzbG9hZGluZyA9IF9hcmdzMTUubGVuZ3RoID4gMiA/IF9hcmdzMTVbMl0gOiB1bmRlZmluZWQ7CgogICAgICAgICAgICAgICAgaWYgKCEoY29udGV4dC5waW1wZXJzb24gJiYgdHJ1ZSkpIHsKICAgICAgICAgICAgICAgICAgX2NvbnRleHQxNS5uZXh0ID0gNjsKICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgX3RlbXBEYXRhNiA9IEpTT04ucGFyc2UoSlNPTi5zdHJpbmdpZnkoZGF0YSkpOwogICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0MTUuYWJydXB0KCJyZXR1cm4iLCBIdHRwLmdldEluc3RhbmNlKCkuZ2V0KCIvcGltcGVvcGxlLyIuY29uY2F0KGNvbnRleHQucGltcGVyc29uLCAiL3BpbWFyY2hpdmVzL2ZldGNobm9lbWxveWVlbm9maWxlIiksIF90ZW1wRGF0YTYsIGlzbG9hZGluZykpOwoKICAgICAgICAgICAgICBjYXNlIDY6CiAgICAgICAgICAgICAgICB0ZW1wRGF0YSA9IEpTT04ucGFyc2UoSlNPTi5zdHJpbmdpZnkoZGF0YSkpOwogICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0MTUuYWJydXB0KCJyZXR1cm4iLCBIdHRwLmdldEluc3RhbmNlKCkuZ2V0KCIvcGltYXJjaGl2ZXMvZmV0Y2hub2VtbG95ZWVub2ZpbGUiLCB0ZW1wRGF0YSwgaXNsb2FkaW5nKSk7CgogICAgICAgICAgICAgIGNhc2UgODoKICAgICAgICAgICAgICBjYXNlICJlbmQiOgogICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0MTUuc3RvcCgpOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSwgX2NhbGxlZTE1KTsKICAgICAgfSkpOwoKICAgICAgZnVuY3Rpb24gRmV0Y2hOT0VNTE9ZRUVOT0ZJTEUoKSB7CiAgICAgICAgcmV0dXJuIF9GZXRjaE5PRU1MT1lFRU5PRklMRS5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwogICAgICB9CgogICAgICByZXR1cm4gRmV0Y2hOT0VNTE9ZRUVOT0ZJTEU7CiAgICB9KCkKICAgIC8qKg0KICAgICAqIEZldGNoUElNUkVBREdKROaOpeWPo+aWueazlQ0KICAgICAqDQogICAgICogQHBhcmFtIHsqfSBbY29udGV4dD17fV0NCiAgICAgKiBAcGFyYW0geyp9IFtkYXRhPXt9XQ0KICAgICAqIEBwYXJhbSB7Ym9vbGVhbn0gW2lzbG9hZGluZ10NCiAgICAgKiBAcmV0dXJucyB7UHJvbWlzZTxhbnk+fQ0KICAgICAqIEBtZW1iZXJvZiBQaW1BcmNoaXZlc1NlcnZpY2VCYXNlDQogICAgICovCgogIH0sIHsKICAgIGtleTogIkZldGNoUElNUkVBREdKRCIsCiAgICB2YWx1ZTogZnVuY3Rpb24gKCkgewogICAgICB2YXIgX0ZldGNoUElNUkVBREdKRCA9IF9hc3luY1RvR2VuZXJhdG9yKAogICAgICAvKiNfX1BVUkVfXyovCiAgICAgIHJlZ2VuZXJhdG9yUnVudGltZS5tYXJrKGZ1bmN0aW9uIF9jYWxsZWUxNigpIHsKICAgICAgICB2YXIgY29udGV4dCwKICAgICAgICAgICAgZGF0YSwKICAgICAgICAgICAgaXNsb2FkaW5nLAogICAgICAgICAgICBfdGVtcERhdGE3LAogICAgICAgICAgICB0ZW1wRGF0YSwKICAgICAgICAgICAgX2FyZ3MxNiA9IGFyZ3VtZW50czsKCiAgICAgICAgcmV0dXJuIHJlZ2VuZXJhdG9yUnVudGltZS53cmFwKGZ1bmN0aW9uIF9jYWxsZWUxNiQoX2NvbnRleHQxNikgewogICAgICAgICAgd2hpbGUgKDEpIHsKICAgICAgICAgICAgc3dpdGNoIChfY29udGV4dDE2LnByZXYgPSBfY29udGV4dDE2Lm5leHQpIHsKICAgICAgICAgICAgICBjYXNlIDA6CiAgICAgICAgICAgICAgICBjb250ZXh0ID0gX2FyZ3MxNi5sZW5ndGggPiAwICYmIF9hcmdzMTZbMF0gIT09IHVuZGVmaW5lZCA/IF9hcmdzMTZbMF0gOiB7fTsKICAgICAgICAgICAgICAgIGRhdGEgPSBfYXJnczE2Lmxlbmd0aCA+IDEgJiYgX2FyZ3MxNlsxXSAhPT0gdW5kZWZpbmVkID8gX2FyZ3MxNlsxXSA6IHt9OwogICAgICAgICAgICAgICAgaXNsb2FkaW5nID0gX2FyZ3MxNi5sZW5ndGggPiAyID8gX2FyZ3MxNlsyXSA6IHVuZGVmaW5lZDsKCiAgICAgICAgICAgICAgICBpZiAoIShjb250ZXh0LnBpbXBlcnNvbiAmJiB0cnVlKSkgewogICAgICAgICAgICAgICAgICBfY29udGV4dDE2Lm5leHQgPSA2OwogICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBfdGVtcERhdGE3ID0gSlNPTi5wYXJzZShKU09OLnN0cmluZ2lmeShkYXRhKSk7CiAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQxNi5hYnJ1cHQoInJldHVybiIsIEh0dHAuZ2V0SW5zdGFuY2UoKS5nZXQoIi9waW1wZW9wbGUvIi5jb25jYXQoY29udGV4dC5waW1wZXJzb24sICIvcGltYXJjaGl2ZXMvZmV0Y2hwaW1yZWFkZ2pkIiksIF90ZW1wRGF0YTcsIGlzbG9hZGluZykpOwoKICAgICAgICAgICAgICBjYXNlIDY6CiAgICAgICAgICAgICAgICB0ZW1wRGF0YSA9IEpTT04ucGFyc2UoSlNPTi5zdHJpbmdpZnkoZGF0YSkpOwogICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0MTYuYWJydXB0KCJyZXR1cm4iLCBIdHRwLmdldEluc3RhbmNlKCkuZ2V0KCIvcGltYXJjaGl2ZXMvZmV0Y2hwaW1yZWFkZ2pkIiwgdGVtcERhdGEsIGlzbG9hZGluZykpOwoKICAgICAgICAgICAgICBjYXNlIDg6CiAgICAgICAgICAgICAgY2FzZSAiZW5kIjoKICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDE2LnN0b3AoKTsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0sIF9jYWxsZWUxNik7CiAgICAgIH0pKTsKCiAgICAgIGZ1bmN0aW9uIEZldGNoUElNUkVBREdKRCgpIHsKICAgICAgICByZXR1cm4gX0ZldGNoUElNUkVBREdKRC5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwogICAgICB9CgogICAgICByZXR1cm4gRmV0Y2hQSU1SRUFER0pEOwogICAgfSgpCiAgfV0pOwoKICByZXR1cm4gUGltQXJjaGl2ZXNTZXJ2aWNlQmFzZTsKfShFbnRpdHlTZXJ2aWNlKTsKCmV4cG9ydCB7IFBpbUFyY2hpdmVzU2VydmljZUJhc2UgYXMgZGVmYXVsdCB9Ow=="},null]}
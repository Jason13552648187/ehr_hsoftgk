{"remainingRequest":"F:\\crod项目\\人事管理系统2\\iBizEHR\\app_EHRPim\\node_modules\\thread-loader\\dist\\cjs.js!F:\\crod项目\\人事管理系统2\\iBizEHR\\app_EHRPim\\node_modules\\babel-loader\\lib\\index.js!F:\\crod项目\\人事管理系统2\\iBizEHR\\app_EHRPim\\node_modules\\ts-loader\\index.js??ref--13-3!F:\\crod项目\\人事管理系统2\\iBizEHR\\app_EHRPim\\src\\widgets\\pim-archives\\pimrecord-treeview\\pimrecord-treeview-service.ts","dependencies":[{"path":"F:\\crod项目\\人事管理系统2\\iBizEHR\\app_EHRPim\\src\\widgets\\pim-archives\\pimrecord-treeview\\pimrecord-treeview-service.ts","mtime":1630509411371},{"path":"F:\\crod项目\\人事管理系统2\\iBizEHR\\app_EHRPim\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1630511852775},{"path":"F:\\crod项目\\人事管理系统2\\iBizEHR\\app_EHRPim\\node_modules\\thread-loader\\dist\\cjs.js","mtime":1630511853252},{"path":"F:\\crod项目\\人事管理系统2\\iBizEHR\\app_EHRPim\\node_modules\\babel-loader\\lib\\index.js","mtime":1630511852747},{"path":"F:\\crod项目\\人事管理系统2\\iBizEHR\\app_EHRPim\\node_modules\\ts-loader\\index.js","mtime":1630511985412}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:aW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkuZm9yLWVhY2giOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5hcnJheS5pbmRleC1vZiI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLm9iamVjdC5kZWZpbmUtcHJvcGVydHkiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5vYmplY3QuaXMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5vYmplY3Qua2V5cyI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLm9iamVjdC50by1zdHJpbmciOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5yZWdleHAuZXhlYyI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLnN0cmluZy5zcGxpdCI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL3dlYi5kb20tY29sbGVjdGlvbnMuZm9yLWVhY2giOwppbXBvcnQgInJlZ2VuZXJhdG9yLXJ1bnRpbWUvcnVudGltZSI7CmltcG9ydCBfYXN5bmNUb0dlbmVyYXRvciBmcm9tICJGOlxcY3JvZFx1OTg3OVx1NzZFRVxcXHU0RUJBXHU0RThCXHU3QkExXHU3NDA2XHU3Q0ZCXHU3RURGMlxcaUJpekVIUlxcYXBwX0VIUlBpbVxcbm9kZV9tb2R1bGVzXFxAYmFiZWxcXHJ1bnRpbWUvaGVscGVycy9lc20vYXN5bmNUb0dlbmVyYXRvciI7CmltcG9ydCBfY2xhc3NDYWxsQ2hlY2sgZnJvbSAiRjpcXGNyb2RcdTk4NzlcdTc2RUVcXFx1NEVCQVx1NEU4Qlx1N0JBMVx1NzQwNlx1N0NGQlx1N0VERjJcXGlCaXpFSFJcXGFwcF9FSFJQaW1cXG5vZGVfbW9kdWxlc1xcQGJhYmVsXFxydW50aW1lL2hlbHBlcnMvZXNtL2NsYXNzQ2FsbENoZWNrIjsKaW1wb3J0IF9jcmVhdGVDbGFzcyBmcm9tICJGOlxcY3JvZFx1OTg3OVx1NzZFRVxcXHU0RUJBXHU0RThCXHU3QkExXHU3NDA2XHU3Q0ZCXHU3RURGMlxcaUJpekVIUlxcYXBwX0VIUlBpbVxcbm9kZV9tb2R1bGVzXFxAYmFiZWxcXHJ1bnRpbWUvaGVscGVycy9lc20vY3JlYXRlQ2xhc3MiOwppbXBvcnQgX3Bvc3NpYmxlQ29uc3RydWN0b3JSZXR1cm4gZnJvbSAiRjpcXGNyb2RcdTk4NzlcdTc2RUVcXFx1NEVCQVx1NEU4Qlx1N0JBMVx1NzQwNlx1N0NGQlx1N0VERjJcXGlCaXpFSFJcXGFwcF9FSFJQaW1cXG5vZGVfbW9kdWxlc1xcQGJhYmVsXFxydW50aW1lL2hlbHBlcnMvZXNtL3Bvc3NpYmxlQ29uc3RydWN0b3JSZXR1cm4iOwppbXBvcnQgX2dldFByb3RvdHlwZU9mIGZyb20gIkY6XFxjcm9kXHU5ODc5XHU3NkVFXFxcdTRFQkFcdTRFOEJcdTdCQTFcdTc0MDZcdTdDRkJcdTdFREYyXFxpQml6RUhSXFxhcHBfRUhSUGltXFxub2RlX21vZHVsZXNcXEBiYWJlbFxccnVudGltZS9oZWxwZXJzL2VzbS9nZXRQcm90b3R5cGVPZiI7CmltcG9ydCBfaW5oZXJpdHMgZnJvbSAiRjpcXGNyb2RcdTk4NzlcdTc2RUVcXFx1NEVCQVx1NEU4Qlx1N0JBMVx1NzQwNlx1N0NGQlx1N0VERjJcXGlCaXpFSFJcXGFwcF9FSFJQaW1cXG5vZGVfbW9kdWxlc1xcQGJhYmVsXFxydW50aW1lL2hlbHBlcnMvZXNtL2luaGVyaXRzIjsKaW1wb3J0ICogYXMgdHNsaWJfMSBmcm9tICJ0c2xpYiI7CmltcG9ydCB7IEVycm9ybG9nIH0gZnJvbSAnQC91dGlscyc7CmltcG9ydCBDb250cm9sU2VydmljZSBmcm9tICdAL3dpZGdldHMvY29udHJvbC1zZXJ2aWNlJzsKaW1wb3J0IFBpbUFyY2hpdmVzU2VydmljZSBmcm9tICdAL3NlcnZpY2UvcGltLWFyY2hpdmVzL3BpbS1hcmNoaXZlcy1zZXJ2aWNlJzsKaW1wb3J0IFBJTVJlY29yZE1vZGVsIGZyb20gJy4vcGltcmVjb3JkLXRyZWV2aWV3LW1vZGVsJzsKaW1wb3J0IENvZGVMaXN0U2VydmljZSBmcm9tICdAc2VydmljZS9hcHAvY29kZWxpc3Qtc2VydmljZSc7CmltcG9ydCBPcm1PcmdTZXJ2aWNlIGZyb20gJ0BzZXJ2aWNlL29ybS1vcmcvb3JtLW9yZy1zZXJ2aWNlJzsKLyoqDQogKiBQSU1SZWNvcmQg6YOo5Lu25pyN5Yqh5a+56LGhDQogKg0KICogQGV4cG9ydA0KICogQGNsYXNzIFBJTVJlY29yZFNlcnZpY2UNCiAqLwoKdmFyIFBJTVJlY29yZFNlcnZpY2UgPQovKiNfX1BVUkVfXyovCmZ1bmN0aW9uIChfQ29udHJvbFNlcnZpY2UpIHsKICBfaW5oZXJpdHMoUElNUmVjb3JkU2VydmljZSwgX0NvbnRyb2xTZXJ2aWNlKTsKCiAgLyoqDQogICAqIENyZWF0ZXMgYW4gaW5zdGFuY2Ugb2YgUElNUmVjb3JkU2VydmljZS4NCiAgICoNCiAgICogQHBhcmFtIHsqfSBbb3B0cz17fV0NCiAgICogQG1lbWJlcm9mIFBJTVJlY29yZFNlcnZpY2UNCiAgICovCiAgZnVuY3Rpb24gUElNUmVjb3JkU2VydmljZSgpIHsKICAgIHZhciBfdGhpczsKCiAgICB2YXIgb3B0cyA9IGFyZ3VtZW50cy5sZW5ndGggPiAwICYmIGFyZ3VtZW50c1swXSAhPT0gdW5kZWZpbmVkID8gYXJndW1lbnRzWzBdIDoge307CgogICAgX2NsYXNzQ2FsbENoZWNrKHRoaXMsIFBJTVJlY29yZFNlcnZpY2UpOwoKICAgIF90aGlzID0gX3Bvc3NpYmxlQ29uc3RydWN0b3JSZXR1cm4odGhpcywgX2dldFByb3RvdHlwZU9mKFBJTVJlY29yZFNlcnZpY2UpLmNhbGwodGhpcywgb3B0cykpOwogICAgLyoqDQogICAgICog5qGj5qGI5L+h5oGv5pyN5Yqh5a+56LGhDQogICAgICoNCiAgICAgKiBAdHlwZSB7UGltQXJjaGl2ZXNTZXJ2aWNlfQ0KICAgICAqIEBtZW1iZXJvZiBQSU1SZWNvcmRTZXJ2aWNlDQogICAgICovCgogICAgX3RoaXMuYXBwRW50aXR5U2VydmljZSA9IG5ldyBQaW1BcmNoaXZlc1NlcnZpY2UoewogICAgICAkc3RvcmU6IF90aGlzLmdldFN0b3JlKCkKICAgIH0pOwogICAgLyoqDQogICAgICog5Luj56CB6KGo5pyN5Yqh5a+56LGhDQogICAgICoNCiAgICAgKiBAdHlwZSB7Q29kZUxpc3RTZXJ2aWNlfQ0KICAgICAqIEBtZW1iZXJvZiBQSU1SZWNvcmRTZXJ2aWNlDQogICAgICovCgogICAgX3RoaXMuY29kZUxpc3RTZXJ2aWNlID0gbmV3IENvZGVMaXN0U2VydmljZSh7CiAgICAgICRzdG9yZTogX3RoaXMuZ2V0U3RvcmUoKQogICAgfSk7CiAgICAvKioNCiAgICAgKiDnu4Tnu4fnrqHnkIbmnI3liqHlr7nosaENCiAgICAgKg0KICAgICAqIEB0eXBlIHtPcm1PcmdTZXJ2aWNlfQ0KICAgICAqIEBtZW1iZXJvZiBQSU1SZWNvcmRTZXJ2aWNlDQogICAgICovCgogICAgX3RoaXMub3Jtb3JnU2VydmljZSA9IG5ldyBPcm1PcmdTZXJ2aWNlKHsKICAgICAgJHN0b3JlOiBfdGhpcy5nZXRTdG9yZSgpCiAgICB9KTsKICAgIC8qKg0KICAgICAqIOiKgueCueWIhumalOespuWPtw0KICAgICAqDQogICAgICogQHB1YmxpYw0KICAgICAqIEB0eXBlIHtzdHJpbmd9DQogICAgICogQG1lbWJlcm9mIFBJTVJlY29yZFNlcnZpY2UNCiAgICAgKi8KCiAgICBfdGhpcy5UUkVFTk9ERV9TRVBBUkFUT1IgPSAnOyc7CiAgICAvKioNCiAgICAgKiDpu5jorqTmoLnoioLngrnoioLngrnliIbpmpTnrKblj7cNCiAgICAgKg0KICAgICAqIEBwdWJsaWMNCiAgICAgKiBAdHlwZSB7c3RyaW5nfQ0KICAgICAqIEBtZW1iZXJvZiBQSU1SZWNvcmRTZXJ2aWNlDQogICAgICovCgogICAgX3RoaXMuVFJFRU5PREVfUk9PVCA9ICdST09UJzsKICAgIC8qKg0KICAgICAqIOWtkOe7hOe7h+iKgueCueiKgueCueWIhumalOespuWPtw0KICAgICAqDQogICAgICogQHB1YmxpYw0KICAgICAqIEB0eXBlIHtzdHJpbmd9DQogICAgICogQG1lbWJlcm9mIFBJTVJlY29yZFNlcnZpY2UNCiAgICAgKi8KCiAgICBfdGhpcy5UUkVFTk9ERV9TVUJPUkcgPSAnU3ViT1JHJzsKICAgIC8qKg0KICAgICAqIOagueiKgueCuee7hOe7h+iKgueCueWIhumalOespuWPtw0KICAgICAqDQogICAgICogQHB1YmxpYw0KICAgICAqIEB0eXBlIHtzdHJpbmd9DQogICAgICogQG1lbWJlcm9mIFBJTVJlY29yZFNlcnZpY2UNCiAgICAgKi8KCiAgICBfdGhpcy5UUkVFTk9ERV9PUk1PUkcgPSAnT1JNT1JHJzsKICAgIF90aGlzLm1vZGVsID0gbmV3IFBJTVJlY29yZE1vZGVsKCk7CiAgICByZXR1cm4gX3RoaXM7CiAgfQogIC8qKg0KICAgKiDorr7nva7ku47mlbDmja7mqKHlvI8NCiAgICoNCiAgICogQHR5cGUge2Jvb2xlYW59DQogICAqIEBtZW1iZXJvZiBQSU1SZWNvcmRTZXJ2aWNlDQogICAqLwoKCiAgX2NyZWF0ZUNsYXNzKFBJTVJlY29yZFNlcnZpY2UsIFt7CiAgICBrZXk6ICJzZXRUZW1wTW9kZSIsCiAgICB2YWx1ZTogZnVuY3Rpb24gc2V0VGVtcE1vZGUoKSB7CiAgICAgIHRoaXMuaXNUZW1wTW9kZSA9IGZhbHNlOwogICAgfQogICAgLyoqDQogICAgICog6I635Y+W6IqC54K55pWw5o2uDQogICAgICoNCiAgICAgKiBAcGFyYW0ge3N0cmluZ30gYWN0aW9uDQogICAgICogQHBhcmFtIHsqfSBbZGF0YT17fV0NCiAgICAgKiBAcGFyYW0ge2Jvb2xlYW59IFtpc2xvYWRpbmddDQogICAgICogQHJldHVybnMge1Byb21pc2U8YW55Pn0NCiAgICAgKiBAbWVtYmVyb2YgUElNUmVjb3JkU2VydmljZQ0KICAgICAqLwoKICB9LCB7CiAgICBrZXk6ICJnZXROb2RlcyIsCiAgICB2YWx1ZTogZnVuY3Rpb24gKCkgewogICAgICB2YXIgX2dldE5vZGVzID0gX2FzeW5jVG9HZW5lcmF0b3IoCiAgICAgIC8qI19fUFVSRV9fKi8KICAgICAgcmVnZW5lcmF0b3JSdW50aW1lLm1hcmsoZnVuY3Rpb24gX2NhbGxlZSgpIHsKICAgICAgICB2YXIgY29udGV4dCwKICAgICAgICAgICAgZGF0YSwKICAgICAgICAgICAgaXNsb2FkaW5nLAogICAgICAgICAgICBzcmZwYXJlbnRrZXksCiAgICAgICAgICAgIHNyZmNhdCwKICAgICAgICAgICAgc3Jmbm9kZWlkLAogICAgICAgICAgICBzcmZub2RlZmlsdGVyLAogICAgICAgICAgICBxdWVyeSwKICAgICAgICAgICAgbGlzdCwKICAgICAgICAgICAgZmlsdGVyLAogICAgICAgICAgICBzdHJUcmVlTm9kZUlkLAogICAgICAgICAgICBzdHJSZWFsTm9kZUlkLAogICAgICAgICAgICBiUm9vdFNlbGVjdCwKICAgICAgICAgICAgc3RyTm9kZVR5cGUsCiAgICAgICAgICAgIHN0clJvb3RTZWxlY3ROb2RlLAogICAgICAgICAgICBuUG9zLAogICAgICAgICAgICBub2RlaWQsCiAgICAgICAgICAgIGksCiAgICAgICAgICAgIF9hcmdzID0gYXJndW1lbnRzOwogICAgICAgIHJldHVybiByZWdlbmVyYXRvclJ1bnRpbWUud3JhcChmdW5jdGlvbiBfY2FsbGVlJChfY29udGV4dCkgewogICAgICAgICAgd2hpbGUgKDEpIHsKICAgICAgICAgICAgc3dpdGNoIChfY29udGV4dC5wcmV2ID0gX2NvbnRleHQubmV4dCkgewogICAgICAgICAgICAgIGNhc2UgMDoKICAgICAgICAgICAgICAgIGNvbnRleHQgPSBfYXJncy5sZW5ndGggPiAwICYmIF9hcmdzWzBdICE9PSB1bmRlZmluZWQgPyBfYXJnc1swXSA6IHt9OwogICAgICAgICAgICAgICAgZGF0YSA9IF9hcmdzLmxlbmd0aCA+IDEgJiYgX2FyZ3NbMV0gIT09IHVuZGVmaW5lZCA/IF9hcmdzWzFdIDoge307CiAgICAgICAgICAgICAgICBpc2xvYWRpbmcgPSBfYXJncy5sZW5ndGggPiAyID8gX2FyZ3NbMl0gOiB1bmRlZmluZWQ7CiAgICAgICAgICAgICAgICBzcmZwYXJlbnRrZXkgPSBkYXRhLnNyZnBhcmVudGtleSwgc3JmY2F0ID0gZGF0YS5zcmZjYXQsIHNyZm5vZGVpZCA9IGRhdGEuc3Jmbm9kZWlkLCBzcmZub2RlZmlsdGVyID0gZGF0YS5zcmZub2RlZmlsdGVyLCBxdWVyeSA9IGRhdGEucXVlcnk7CiAgICAgICAgICAgICAgICBzcmZub2RlZmlsdGVyID0gcXVlcnkgPyBxdWVyeSA6IHNyZm5vZGVmaWx0ZXI7CiAgICAgICAgICAgICAgICBsaXN0ID0gW107CiAgICAgICAgICAgICAgICBmaWx0ZXIgPSB7fTsKCiAgICAgICAgICAgICAgICBpZiAoIXNyZm5vZGVpZCB8fCBPYmplY3QuaXMoc3Jmbm9kZWlkLCAnIycpKSB7CiAgICAgICAgICAgICAgICAgIHNyZm5vZGVpZCA9IHRoaXMuVFJFRU5PREVfUk9PVDsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBzdHJUcmVlTm9kZUlkID0gc3Jmbm9kZWlkOwogICAgICAgICAgICAgICAgc3RyUmVhbE5vZGVJZCA9ICcnOwogICAgICAgICAgICAgICAgYlJvb3RTZWxlY3QgPSBmYWxzZTsKICAgICAgICAgICAgICAgIHN0ck5vZGVUeXBlID0gbnVsbDsKICAgICAgICAgICAgICAgIHN0clJvb3RTZWxlY3ROb2RlID0gJyc7CgogICAgICAgICAgICAgICAgaWYgKCFPYmplY3QuaXMoc3RyVHJlZU5vZGVJZCwgdGhpcy5UUkVFTk9ERV9ST09UKSkgewogICAgICAgICAgICAgICAgICBfY29udGV4dC5uZXh0ID0gMTg7CiAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIHN0ck5vZGVUeXBlID0gdGhpcy5UUkVFTk9ERV9ST09UOwoKICAgICAgICAgICAgICAgIGlmIChzcmZwYXJlbnRrZXkpIHsKICAgICAgICAgICAgICAgICAgc3RyUmVhbE5vZGVJZCA9IHNyZnBhcmVudGtleTsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBfY29udGV4dC5uZXh0ID0gMjM7CiAgICAgICAgICAgICAgICBicmVhazsKCiAgICAgICAgICAgICAgY2FzZSAxODoKICAgICAgICAgICAgICAgIG5Qb3MgPSBzdHJUcmVlTm9kZUlkLmluZGV4T2YodGhpcy5UUkVFTk9ERV9TRVBBUkFUT1IpOwoKICAgICAgICAgICAgICAgIGlmICghKG5Qb3MgPT09IC0xKSkgewogICAgICAgICAgICAgICAgICBfY29udGV4dC5uZXh0ID0gMjE7CiAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dC5hYnJ1cHQoInJldHVybiIsIFByb21pc2UucmVqZWN0KHsKICAgICAgICAgICAgICAgICAgc3RhdHVzOiA1MDAsCiAgICAgICAgICAgICAgICAgIGRhdGE6IHsKICAgICAgICAgICAgICAgICAgICB0aXRsZTogJ+Wksei0pScsCiAgICAgICAgICAgICAgICAgICAgbWVzc2FnZTogIlx1NjgxMVx1ODI4Mlx1NzBCOSIuY29uY2F0KHN0clRyZWVOb2RlSWQsICJcdTY4MDdcdThCQzZcdTY1RTBcdTY1NDgiKQogICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9KSk7CgogICAgICAgICAgICAgIGNhc2UgMjE6CiAgICAgICAgICAgICAgICBzdHJOb2RlVHlwZSA9IHN0clRyZWVOb2RlSWQuc3Vic3RyaW5nKDAsIG5Qb3MpOwogICAgICAgICAgICAgICAgc3RyUmVhbE5vZGVJZCA9IHN0clRyZWVOb2RlSWQuc3Vic3RyaW5nKG5Qb3MgKyAxKTsKCiAgICAgICAgICAgICAgY2FzZSAyMzoKICAgICAgICAgICAgICAgIE9iamVjdC5hc3NpZ24oZmlsdGVyLCB7CiAgICAgICAgICAgICAgICAgIHNyZnBhcmVudGtleTogc3JmcGFyZW50a2V5LAogICAgICAgICAgICAgICAgICBzcmZjYXQ6IHNyZmNhdCwKICAgICAgICAgICAgICAgICAgc3Jmbm9kZWZpbHRlcjogc3Jmbm9kZWZpbHRlciwKICAgICAgICAgICAgICAgICAgc3RyUmVhbE5vZGVJZDogc3RyUmVhbE5vZGVJZCwKICAgICAgICAgICAgICAgICAgc3Jmbm9kZWlkOiBzcmZub2RlaWQsCiAgICAgICAgICAgICAgICAgIHN0ck5vZGVUeXBlOiBzdHJOb2RlVHlwZSwKICAgICAgICAgICAgICAgICAgdmlld3BhcmFtczogSlNPTi5wYXJzZShKU09OLnN0cmluZ2lmeShkYXRhKSkudmlld3BhcmFtcwogICAgICAgICAgICAgICAgfSk7IC8vIOWIhuino+iKgueCueagh+ivhgoKICAgICAgICAgICAgICAgIG5vZGVpZCA9IHN0clJlYWxOb2RlSWQuc3BsaXQodGhpcy5UUkVFTk9ERV9TRVBBUkFUT1IpOwogICAgICAgICAgICAgICAgaSA9IDA7CgogICAgICAgICAgICAgIGNhc2UgMjY6CiAgICAgICAgICAgICAgICBpZiAoIShpIDwgbm9kZWlkLmxlbmd0aCkpIHsKICAgICAgICAgICAgICAgICAgX2NvbnRleHQubmV4dCA9IDQyOwogICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBfY29udGV4dC50MCA9IGk7CiAgICAgICAgICAgICAgICBfY29udGV4dC5uZXh0ID0gX2NvbnRleHQudDAgPT09IDAgPyAzMCA6IF9jb250ZXh0LnQwID09PSAxID8gMzIgOiBfY29udGV4dC50MCA9PT0gMiA/IDM0IDogX2NvbnRleHQudDAgPT09IDMgPyAzNiA6IDM4OwogICAgICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgICAgIGNhc2UgMzA6CiAgICAgICAgICAgICAgICBPYmplY3QuYXNzaWduKGZpbHRlciwgewogICAgICAgICAgICAgICAgICBub2RlaWQ6IG5vZGVpZFswXQogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQuYWJydXB0KCJicmVhayIsIDM5KTsKCiAgICAgICAgICAgICAgY2FzZSAzMjoKICAgICAgICAgICAgICAgIE9iamVjdC5hc3NpZ24oZmlsdGVyLCB7CiAgICAgICAgICAgICAgICAgIG5vZGVpZDI6IG5vZGVpZFsxXQogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQuYWJydXB0KCJicmVhayIsIDM5KTsKCiAgICAgICAgICAgICAgY2FzZSAzNDoKICAgICAgICAgICAgICAgIE9iamVjdC5hc3NpZ24oZmlsdGVyLCB7CiAgICAgICAgICAgICAgICAgIG5vZGVpZDM6IG5vZGVpZFsyXQogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQuYWJydXB0KCJicmVhayIsIDM5KTsKCiAgICAgICAgICAgICAgY2FzZSAzNjoKICAgICAgICAgICAgICAgIE9iamVjdC5hc3NpZ24oZmlsdGVyLCB7CiAgICAgICAgICAgICAgICAgIG5vZGVpZDQ6IG5vZGVpZFszXQogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQuYWJydXB0KCJicmVhayIsIDM5KTsKCiAgICAgICAgICAgICAgY2FzZSAzODoKICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dC5hYnJ1cHQoImJyZWFrIiwgMzkpOwoKICAgICAgICAgICAgICBjYXNlIDM5OgogICAgICAgICAgICAgICAgaSsrOwogICAgICAgICAgICAgICAgX2NvbnRleHQubmV4dCA9IDI2OwogICAgICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgICAgIGNhc2UgNDI6CiAgICAgICAgICAgICAgICBpZiAoIU9iamVjdC5pcyhzdHJOb2RlVHlwZSwgdGhpcy5UUkVFTk9ERV9ST09UKSkgewogICAgICAgICAgICAgICAgICBfY29udGV4dC5uZXh0ID0gNDY7CiAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIF9jb250ZXh0Lm5leHQgPSA0NTsKICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLmZpbGxSb290Tm9kZUNoaWxkcyhjb250ZXh0LCBmaWx0ZXIsIGxpc3QpOwoKICAgICAgICAgICAgICBjYXNlIDQ1OgogICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0LmFicnVwdCgicmV0dXJuIiwgUHJvbWlzZS5yZXNvbHZlKHsKICAgICAgICAgICAgICAgICAgc3RhdHVzOiAyMDAsCiAgICAgICAgICAgICAgICAgIGRhdGE6IGxpc3QKICAgICAgICAgICAgICAgIH0pKTsKCiAgICAgICAgICAgICAgY2FzZSA0NjoKICAgICAgICAgICAgICAgIGlmICghT2JqZWN0LmlzKHN0ck5vZGVUeXBlLCB0aGlzLlRSRUVOT0RFX1NVQk9SRykpIHsKICAgICAgICAgICAgICAgICAgX2NvbnRleHQubmV4dCA9IDUwOwogICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBfY29udGV4dC5uZXh0ID0gNDk7CiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5maWxsU3Vib3JnTm9kZUNoaWxkcyhjb250ZXh0LCBmaWx0ZXIsIGxpc3QpOwoKICAgICAgICAgICAgICBjYXNlIDQ5OgogICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0LmFicnVwdCgicmV0dXJuIiwgUHJvbWlzZS5yZXNvbHZlKHsKICAgICAgICAgICAgICAgICAgc3RhdHVzOiAyMDAsCiAgICAgICAgICAgICAgICAgIGRhdGE6IGxpc3QKICAgICAgICAgICAgICAgIH0pKTsKCiAgICAgICAgICAgICAgY2FzZSA1MDoKICAgICAgICAgICAgICAgIGlmICghT2JqZWN0LmlzKHN0ck5vZGVUeXBlLCB0aGlzLlRSRUVOT0RFX09STU9SRykpIHsKICAgICAgICAgICAgICAgICAgX2NvbnRleHQubmV4dCA9IDU0OwogICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBfY29udGV4dC5uZXh0ID0gNTM7CiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5maWxsT3Jtb3JnTm9kZUNoaWxkcyhjb250ZXh0LCBmaWx0ZXIsIGxpc3QpOwoKICAgICAgICAgICAgICBjYXNlIDUzOgogICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0LmFicnVwdCgicmV0dXJuIiwgUHJvbWlzZS5yZXNvbHZlKHsKICAgICAgICAgICAgICAgICAgc3RhdHVzOiAyMDAsCiAgICAgICAgICAgICAgICAgIGRhdGE6IGxpc3QKICAgICAgICAgICAgICAgIH0pKTsKCiAgICAgICAgICAgICAgY2FzZSA1NDoKICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dC5hYnJ1cHQoInJldHVybiIsIFByb21pc2UucmVzb2x2ZSh7CiAgICAgICAgICAgICAgICAgIHN0YXR1czogNTAwLAogICAgICAgICAgICAgICAgICBkYXRhOiB7CiAgICAgICAgICAgICAgICAgICAgdGl0bGU6ICflpLHotKUnLAogICAgICAgICAgICAgICAgICAgIG1lc3NhZ2U6ICJcdTY4MTFcdTgyODJcdTcwQjkiLmNvbmNhdChzdHJUcmVlTm9kZUlkLCAiXHU2ODA3XHU4QkM2XHU2NUUwXHU2NTQ4IikKICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSkpOwoKICAgICAgICAgICAgICBjYXNlIDU1OgogICAgICAgICAgICAgIGNhc2UgImVuZCI6CiAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQuc3RvcCgpOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSwgX2NhbGxlZSwgdGhpcyk7CiAgICAgIH0pKTsKCiAgICAgIGZ1bmN0aW9uIGdldE5vZGVzKCkgewogICAgICAgIHJldHVybiBfZ2V0Tm9kZXMuYXBwbHkodGhpcywgYXJndW1lbnRzKTsKICAgICAgfQoKICAgICAgcmV0dXJuIGdldE5vZGVzOwogICAgfSgpCiAgICAvKioNCiAgICAgKiDloavlhYUg5qCR6KeG5Zu+6IqC54K5W+m7mOiupOagueiKgueCuV0NCiAgICAgKg0KICAgICAqIEBwdWJsaWMNCiAgICAgKiBAcGFyYW0ge2FueXt9fSBjb250ZXh0DQogICAgICogQHBhcmFtIHsqfSBmaWx0ZXINCiAgICAgKiBAcGFyYW0ge2FueVtdfSBsaXN0DQogICAgICogQHBhcmFtIHsqfSByc05hdkNvbnRleHQNCiAgICAgKiBAcGFyYW0geyp9IHJzTmF2UGFyYW1zDQogICAgICogQHBhcmFtIHsqfSByc1BhcmFtcw0KICAgICAqIEByZXR1cm5zIHtQcm9taXNlPGFueT59DQogICAgICogQG1lbWJlcm9mIFBJTVJlY29yZFNlcnZpY2UNCiAgICAgKi8KCiAgfSwgewogICAga2V5OiAiZmlsbFJvb3ROb2RlcyIsCiAgICB2YWx1ZTogZnVuY3Rpb24gZmlsbFJvb3ROb2RlcygpIHsKICAgICAgdmFyIF90aGlzMiA9IHRoaXM7CgogICAgICB2YXIgY29udGV4dCA9IGFyZ3VtZW50cy5sZW5ndGggPiAwICYmIGFyZ3VtZW50c1swXSAhPT0gdW5kZWZpbmVkID8gYXJndW1lbnRzWzBdIDoge307CiAgICAgIHZhciBmaWx0ZXIgPSBhcmd1bWVudHMubGVuZ3RoID4gMSA/IGFyZ3VtZW50c1sxXSA6IHVuZGVmaW5lZDsKICAgICAgdmFyIGxpc3QgPSBhcmd1bWVudHMubGVuZ3RoID4gMiA/IGFyZ3VtZW50c1syXSA6IHVuZGVmaW5lZDsKICAgICAgdmFyIHJzTmF2Q29udGV4dCA9IGFyZ3VtZW50cy5sZW5ndGggPiAzID8gYXJndW1lbnRzWzNdIDogdW5kZWZpbmVkOwogICAgICB2YXIgcnNOYXZQYXJhbXMgPSBhcmd1bWVudHMubGVuZ3RoID4gNCA/IGFyZ3VtZW50c1s0XSA6IHVuZGVmaW5lZDsKICAgICAgdmFyIHJzUGFyYW1zID0gYXJndW1lbnRzLmxlbmd0aCA+IDUgPyBhcmd1bWVudHNbNV0gOiB1bmRlZmluZWQ7CiAgICAgIGNvbnRleHQgPSB0aGlzLmhhbmRsZVJlc05hdkNvbnRleHQoY29udGV4dCwgZmlsdGVyLCByc05hdkNvbnRleHQpOwogICAgICBmaWx0ZXIgPSB0aGlzLmhhbmRsZVJlc05hdlBhcmFtcyhjb250ZXh0LCBmaWx0ZXIsIHJzTmF2UGFyYW1zLCByc1BhcmFtcyk7CiAgICAgIHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbiAocmVzb2x2ZSwgcmVqZWN0KSB7CiAgICAgICAgdmFyIHRyZWVOb2RlID0ge307CiAgICAgICAgT2JqZWN0LmFzc2lnbih0cmVlTm9kZSwgewogICAgICAgICAgdGV4dDogJ2VudGl0aWVzLnBpbWFyY2hpdmVzLnBpbXJlY29yZF90cmVldmlldy5ub2Rlcy5yb290JwogICAgICAgIH0pOwogICAgICAgIE9iamVjdC5hc3NpZ24odHJlZU5vZGUsIHsKICAgICAgICAgIGlzVXNlTGFuZ1JlczogdHJ1ZQogICAgICAgIH0pOwogICAgICAgIE9iamVjdC5hc3NpZ24odHJlZU5vZGUsIHsKICAgICAgICAgIHNyZmFwcGN0eDogY29udGV4dAogICAgICAgIH0pOwogICAgICAgIE9iamVjdC5hc3NpZ24odHJlZU5vZGUsIHsKICAgICAgICAgIHNyZm1ham9ydGV4dDogdHJlZU5vZGUudGV4dAogICAgICAgIH0pOwogICAgICAgIHZhciBzdHJOb2RlSWQgPSAnUk9PVCc7CiAgICAgICAgT2JqZWN0LmFzc2lnbih0cmVlTm9kZSwgewogICAgICAgICAgc3Jma2V5OiAncm9vdCcKICAgICAgICB9KTsKICAgICAgICBzdHJOb2RlSWQgKz0gX3RoaXMyLlRSRUVOT0RFX1NFUEFSQVRPUjsKICAgICAgICBzdHJOb2RlSWQgKz0gJ3Jvb3QnOwogICAgICAgIE9iamVjdC5hc3NpZ24odHJlZU5vZGUsIHsKICAgICAgICAgIGlkOiBzdHJOb2RlSWQKICAgICAgICB9KTsKICAgICAgICBPYmplY3QuYXNzaWduKHRyZWVOb2RlLCB7CiAgICAgICAgICBleHBhbmRlZDogdHJ1ZQogICAgICAgIH0pOwogICAgICAgIE9iamVjdC5hc3NpZ24odHJlZU5vZGUsIHsKICAgICAgICAgIGxlYWY6IGZhbHNlCiAgICAgICAgfSk7CiAgICAgICAgT2JqZWN0LmFzc2lnbih0cmVlTm9kZSwgewogICAgICAgICAgbm9kZWlkOiB0cmVlTm9kZS5zcmZrZXkKICAgICAgICB9KTsKICAgICAgICBPYmplY3QuYXNzaWduKHRyZWVOb2RlLCB7CiAgICAgICAgICBub2RlaWQyOiBmaWx0ZXIuc3RyUmVhbE5vZGVJZAogICAgICAgIH0pOwogICAgICAgIGxpc3QucHVzaCh0cmVlTm9kZSk7CiAgICAgICAgcmVzb2x2ZShsaXN0KTsKICAgICAgfSk7CiAgICB9CiAgICAvKioNCiAgICAgKiDloavlhYUg5qCR6KeG5Zu+6IqC54K5W+m7mOiupOagueiKgueCuV3lrZDoioLngrkNCiAgICAgKg0KICAgICAqIEBwdWJsaWMNCiAgICAgKiBAcGFyYW0ge2FueXt9fSBjb250ZXh0DQogICAgICogQHBhcmFtIHsqfSBmaWx0ZXINCiAgICAgKiBAcGFyYW0ge2FueVtdfSBsaXN0DQogICAgICogQHJldHVybnMge1Byb21pc2U8YW55Pn0NCiAgICAgKiBAbWVtYmVyb2YgUElNUmVjb3JkU2VydmljZQ0KICAgICAqLwoKICB9LCB7CiAgICBrZXk6ICJmaWxsUm9vdE5vZGVDaGlsZHMiLAogICAgdmFsdWU6IGZ1bmN0aW9uICgpIHsKICAgICAgdmFyIF9maWxsUm9vdE5vZGVDaGlsZHMgPSBfYXN5bmNUb0dlbmVyYXRvcigKICAgICAgLyojX19QVVJFX18qLwogICAgICByZWdlbmVyYXRvclJ1bnRpbWUubWFyayhmdW5jdGlvbiBfY2FsbGVlMigpIHsKICAgICAgICB2YXIgY29udGV4dCwKICAgICAgICAgICAgZmlsdGVyLAogICAgICAgICAgICBsaXN0LAogICAgICAgICAgICBPcm1vcmdSc05hdkNvbnRleHQsCiAgICAgICAgICAgIE9ybW9yZ1JzTmF2UGFyYW1zLAogICAgICAgICAgICBPcm1vcmdSc1BhcmFtcywKICAgICAgICAgICAgX09ybW9yZ1JzTmF2Q29udGV4dCwKICAgICAgICAgICAgX09ybW9yZ1JzTmF2UGFyYW1zLAogICAgICAgICAgICBfT3Jtb3JnUnNQYXJhbXMsCiAgICAgICAgICAgIF9hcmdzMiA9IGFyZ3VtZW50czsKCiAgICAgICAgcmV0dXJuIHJlZ2VuZXJhdG9yUnVudGltZS53cmFwKGZ1bmN0aW9uIF9jYWxsZWUyJChfY29udGV4dDIpIHsKICAgICAgICAgIHdoaWxlICgxKSB7CiAgICAgICAgICAgIHN3aXRjaCAoX2NvbnRleHQyLnByZXYgPSBfY29udGV4dDIubmV4dCkgewogICAgICAgICAgICAgIGNhc2UgMDoKICAgICAgICAgICAgICAgIGNvbnRleHQgPSBfYXJnczIubGVuZ3RoID4gMCAmJiBfYXJnczJbMF0gIT09IHVuZGVmaW5lZCA/IF9hcmdzMlswXSA6IHt9OwogICAgICAgICAgICAgICAgZmlsdGVyID0gX2FyZ3MyLmxlbmd0aCA+IDEgPyBfYXJnczJbMV0gOiB1bmRlZmluZWQ7CiAgICAgICAgICAgICAgICBsaXN0ID0gX2FyZ3MyLmxlbmd0aCA+IDIgPyBfYXJnczJbMl0gOiB1bmRlZmluZWQ7CgogICAgICAgICAgICAgICAgaWYgKCEoZmlsdGVyLnNyZm5vZGVmaWx0ZXIgJiYgIU9iamVjdC5pcyhmaWx0ZXIuc3Jmbm9kZWZpbHRlciwgIiIpKSkgewogICAgICAgICAgICAgICAgICBfY29udGV4dDIubmV4dCA9IDExOwogICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAvLyDloavlhYXmoLnoioLngrnnu4Tnu4cKICAgICAgICAgICAgICAgIE9ybW9yZ1JzTmF2Q29udGV4dCA9IHt9OwogICAgICAgICAgICAgICAgT3Jtb3JnUnNOYXZQYXJhbXMgPSB7fTsKICAgICAgICAgICAgICAgIE9ybW9yZ1JzUGFyYW1zID0ge307CiAgICAgICAgICAgICAgICBfY29udGV4dDIubmV4dCA9IDk7CiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5maWxsT3Jtb3JnTm9kZXMoY29udGV4dCwgZmlsdGVyLCBsaXN0LCBPcm1vcmdSc05hdkNvbnRleHQsIE9ybW9yZ1JzTmF2UGFyYW1zLCBPcm1vcmdSc1BhcmFtcyk7CgogICAgICAgICAgICAgIGNhc2UgOToKICAgICAgICAgICAgICAgIF9jb250ZXh0Mi5uZXh0ID0gMTY7CiAgICAgICAgICAgICAgICBicmVhazsKCiAgICAgICAgICAgICAgY2FzZSAxMToKICAgICAgICAgICAgICAgIC8vIOWhq+WFheagueiKgueCuee7hOe7hwogICAgICAgICAgICAgICAgX09ybW9yZ1JzTmF2Q29udGV4dCA9IHt9OwogICAgICAgICAgICAgICAgX09ybW9yZ1JzTmF2UGFyYW1zID0ge307CiAgICAgICAgICAgICAgICBfT3Jtb3JnUnNQYXJhbXMgPSB7fTsKICAgICAgICAgICAgICAgIF9jb250ZXh0Mi5uZXh0ID0gMTY7CiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5maWxsT3Jtb3JnTm9kZXMoY29udGV4dCwgZmlsdGVyLCBsaXN0LCBfT3Jtb3JnUnNOYXZDb250ZXh0LCBfT3Jtb3JnUnNOYXZQYXJhbXMsIF9Pcm1vcmdSc1BhcmFtcyk7CgogICAgICAgICAgICAgIGNhc2UgMTY6CiAgICAgICAgICAgICAgY2FzZSAiZW5kIjoKICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDIuc3RvcCgpOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSwgX2NhbGxlZTIsIHRoaXMpOwogICAgICB9KSk7CgogICAgICBmdW5jdGlvbiBmaWxsUm9vdE5vZGVDaGlsZHMoKSB7CiAgICAgICAgcmV0dXJuIF9maWxsUm9vdE5vZGVDaGlsZHMuYXBwbHkodGhpcywgYXJndW1lbnRzKTsKICAgICAgfQoKICAgICAgcmV0dXJuIGZpbGxSb290Tm9kZUNoaWxkczsKICAgIH0oKQogICAgLyoqDQogICAgICog5aGr5YWFIOagkeinhuWbvuiKgueCuVvlrZDnu4Tnu4foioLngrldDQogICAgICoNCiAgICAgKiBAcHVibGljDQogICAgICogQHBhcmFtIHthbnl7fX0gY29udGV4dA0KICAgICAqIEBwYXJhbSB7Kn0gZmlsdGVyDQogICAgICogQHBhcmFtIHthbnlbXX0gbGlzdA0KICAgICAqIEBwYXJhbSB7Kn0gcnNOYXZDb250ZXh0DQogICAgICogQHBhcmFtIHsqfSByc05hdlBhcmFtcw0KICAgICAqIEBwYXJhbSB7Kn0gcnNQYXJhbXMNCiAgICAgKiBAcmV0dXJucyB7UHJvbWlzZTxhbnk+fQ0KICAgICAqIEBtZW1iZXJvZiBQSU1SZWNvcmRTZXJ2aWNlDQogICAgICovCgogIH0sIHsKICAgIGtleTogImZpbGxTdWJvcmdOb2RlcyIsCiAgICB2YWx1ZTogZnVuY3Rpb24gZmlsbFN1Ym9yZ05vZGVzKCkgewogICAgICB2YXIgX3RoaXMzID0gdGhpczsKCiAgICAgIHZhciBjb250ZXh0ID0gYXJndW1lbnRzLmxlbmd0aCA+IDAgJiYgYXJndW1lbnRzWzBdICE9PSB1bmRlZmluZWQgPyBhcmd1bWVudHNbMF0gOiB7fTsKICAgICAgdmFyIGZpbHRlciA9IGFyZ3VtZW50cy5sZW5ndGggPiAxID8gYXJndW1lbnRzWzFdIDogdW5kZWZpbmVkOwogICAgICB2YXIgbGlzdCA9IGFyZ3VtZW50cy5sZW5ndGggPiAyID8gYXJndW1lbnRzWzJdIDogdW5kZWZpbmVkOwogICAgICB2YXIgcnNOYXZDb250ZXh0ID0gYXJndW1lbnRzLmxlbmd0aCA+IDMgPyBhcmd1bWVudHNbM10gOiB1bmRlZmluZWQ7CiAgICAgIHZhciByc05hdlBhcmFtcyA9IGFyZ3VtZW50cy5sZW5ndGggPiA0ID8gYXJndW1lbnRzWzRdIDogdW5kZWZpbmVkOwogICAgICB2YXIgcnNQYXJhbXMgPSBhcmd1bWVudHMubGVuZ3RoID4gNSA/IGFyZ3VtZW50c1s1XSA6IHVuZGVmaW5lZDsKICAgICAgY29udGV4dCA9IHRoaXMuaGFuZGxlUmVzTmF2Q29udGV4dChjb250ZXh0LCBmaWx0ZXIsIHJzTmF2Q29udGV4dCk7CiAgICAgIGZpbHRlciA9IHRoaXMuaGFuZGxlUmVzTmF2UGFyYW1zKGNvbnRleHQsIGZpbHRlciwgcnNOYXZQYXJhbXMsIHJzUGFyYW1zKTsKICAgICAgcmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uIChyZXNvbHZlLCByZWplY3QpIHsKICAgICAgICB2YXIgc2VhcmNoRmlsdGVyID0ge307CgogICAgICAgIGlmIChPYmplY3QuaXMoZmlsdGVyLnN0ck5vZGVUeXBlLCBfdGhpczMuVFJFRU5PREVfT1JNT1JHKSkgewogICAgICAgICAgT2JqZWN0LmFzc2lnbihzZWFyY2hGaWx0ZXIsIHsKICAgICAgICAgICAgbl9wb3JnaWRfZXE6IGZpbHRlci5ub2RlaWQKICAgICAgICAgIH0pOwogICAgICAgIH0KCiAgICAgICAgaWYgKE9iamVjdC5pcyhmaWx0ZXIuc3RyTm9kZVR5cGUsIF90aGlzMy5UUkVFTk9ERV9TVUJPUkcpKSB7CiAgICAgICAgICBPYmplY3QuYXNzaWduKHNlYXJjaEZpbHRlciwgewogICAgICAgICAgICBuX3BvcmdpZF9lcTogZmlsdGVyLm5vZGVpZAogICAgICAgICAgfSk7CiAgICAgICAgfQoKICAgICAgICBPYmplY3QuYXNzaWduKHNlYXJjaEZpbHRlciwgewogICAgICAgICAgdG90YWw6IGZhbHNlCiAgICAgICAgfSk7CiAgICAgICAgT2JqZWN0LmFzc2lnbihzZWFyY2hGaWx0ZXIsIHsKICAgICAgICAgIHF1ZXJ5OiBmaWx0ZXIuc3Jmbm9kZWZpbHRlcgogICAgICAgIH0pOwogICAgICAgIHZhciBiRmlyc3QgPSB0cnVlOwogICAgICAgIHZhciByZWNvcmRzID0gW107CgogICAgICAgIHRyeSB7CiAgICAgICAgICBfdGhpczMuc2VhcmNoU3Vib3JnKGNvbnRleHQsIHNlYXJjaEZpbHRlciwgZmlsdGVyKS50aGVuKGZ1bmN0aW9uIChyZWNvcmRzKSB7CiAgICAgICAgICAgIGlmIChyZWNvcmRzICYmIHJlY29yZHMubGVuZ3RoID4gMCkgewogICAgICAgICAgICAgIHJlY29yZHMuZm9yRWFjaChmdW5jdGlvbiAoZW50aXR5KSB7CiAgICAgICAgICAgICAgICB2YXIgdHJlZU5vZGUgPSB7fTsgLy8g5pW055CGY29udGV4dAoKICAgICAgICAgICAgICAgIHZhciBzdHJJZCA9IGVudGl0eS5vcmdpZDsKICAgICAgICAgICAgICAgIHZhciBzdHJUZXh0ID0gZW50aXR5LnNob3J0bmFtZTsKICAgICAgICAgICAgICAgIE9iamVjdC5hc3NpZ24odHJlZU5vZGUsIHsKICAgICAgICAgICAgICAgICAgc3JmcGFyZW50ZGVuYW1lOiAnT3JtT3JnJywKICAgICAgICAgICAgICAgICAgc3JmcGFyZW50a2V5OiBlbnRpdHkub3JnaWQKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgdmFyIHRlbXBDb250ZXh0ID0gSlNPTi5wYXJzZShKU09OLnN0cmluZ2lmeShjb250ZXh0KSk7CiAgICAgICAgICAgICAgICBPYmplY3QuYXNzaWduKHRlbXBDb250ZXh0LCB7CiAgICAgICAgICAgICAgICAgIHNyZnBhcmVudGRlbmFtZTogJ09ybU9yZycsCiAgICAgICAgICAgICAgICAgIHNyZnBhcmVudGtleTogZW50aXR5Lm9yZ2lkLAogICAgICAgICAgICAgICAgICBvcm1vcmc6IHN0cklkCiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIE9iamVjdC5hc3NpZ24odHJlZU5vZGUsIHsKICAgICAgICAgICAgICAgICAgc3JmYXBwY3R4OiB0ZW1wQ29udGV4dAogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICBPYmplY3QuYXNzaWduKHRyZWVOb2RlLCB7CiAgICAgICAgICAgICAgICAgICdvcm1vcmcnOiBzdHJJZAogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICBPYmplY3QuYXNzaWduKHRyZWVOb2RlLCB7CiAgICAgICAgICAgICAgICAgIHNyZmtleTogc3RySWQKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgT2JqZWN0LmFzc2lnbih0cmVlTm9kZSwgewogICAgICAgICAgICAgICAgICB0ZXh0OiBzdHJUZXh0LAogICAgICAgICAgICAgICAgICBzcmZtYWpvcnRleHQ6IHN0clRleHQKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgdmFyIHN0ck5vZGVJZCA9ICdTdWJPUkcnOwogICAgICAgICAgICAgICAgc3RyTm9kZUlkICs9IF90aGlzMy5UUkVFTk9ERV9TRVBBUkFUT1I7CiAgICAgICAgICAgICAgICBzdHJOb2RlSWQgKz0gc3RySWQ7CiAgICAgICAgICAgICAgICBPYmplY3QuYXNzaWduKHRyZWVOb2RlLCB7CiAgICAgICAgICAgICAgICAgIGlkOiBzdHJOb2RlSWQKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgT2JqZWN0LmFzc2lnbih0cmVlTm9kZSwgewogICAgICAgICAgICAgICAgICBleHBhbmRlZDogZmlsdGVyLmlzYXV0b2V4cGFuZAogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICBPYmplY3QuYXNzaWduKHRyZWVOb2RlLCB7CiAgICAgICAgICAgICAgICAgIGxlYWY6IGZhbHNlCiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIE9iamVjdC5hc3NpZ24odHJlZU5vZGUsIHsKICAgICAgICAgICAgICAgICAgbmF2ZmlsdGVyOiAibl9vcm1vcmdpZF9lcSIKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgT2JqZWN0LmFzc2lnbih0cmVlTm9kZSwgewogICAgICAgICAgICAgICAgICBjdXJEYXRhOiBlbnRpdHkKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgT2JqZWN0LmFzc2lnbih0cmVlTm9kZSwgewogICAgICAgICAgICAgICAgICBub2RlaWQ6IHRyZWVOb2RlLnNyZmtleQogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICBPYmplY3QuYXNzaWduKHRyZWVOb2RlLCB7CiAgICAgICAgICAgICAgICAgIG5vZGVpZDI6IGZpbHRlci5zdHJSZWFsTm9kZUlkCiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIGxpc3QucHVzaCh0cmVlTm9kZSk7CiAgICAgICAgICAgICAgICByZXNvbHZlKGxpc3QpOwogICAgICAgICAgICAgICAgYkZpcnN0ID0gZmFsc2U7CiAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgcmVzb2x2ZShsaXN0KTsKICAgICAgICAgICAgfQogICAgICAgICAgfSk7CiAgICAgICAgfSBjYXRjaCAoZXJyb3IpIHsKICAgICAgICAgIGNvbnNvbGUuZXJyb3IoZXJyb3IpOwogICAgICAgIH0KICAgICAgfSk7CiAgICB9CiAgICAvKioNCiAgICAgKiDojrflj5bmn6Xor6Lpm4blkIgNCiAgICAgKg0KICAgICAqIEBwdWJsaWMNCiAgICAgKiBAcGFyYW0ge2FueXt9fSBjb250ZXh0DQogICAgICogQHBhcmFtIHsqfSBzZWFyY2hGaWx0ZXINCiAgICAgKiBAcGFyYW0geyp9IGZpbHRlcg0KICAgICAqIEByZXR1cm5zIHthbnlbXX0NCiAgICAgKiBAbWVtYmVyb2YgVGVzdEVuZXRpdHlEYXRhc1NlcnZpY2UNCiAgICAgKi8KCiAgfSwgewogICAga2V5OiAic2VhcmNoU3Vib3JnIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBzZWFyY2hTdWJvcmcoKSB7CiAgICAgIHZhciBfdGhpczQgPSB0aGlzOwoKICAgICAgdmFyIGNvbnRleHQgPSBhcmd1bWVudHMubGVuZ3RoID4gMCAmJiBhcmd1bWVudHNbMF0gIT09IHVuZGVmaW5lZCA/IGFyZ3VtZW50c1swXSA6IHt9OwogICAgICB2YXIgc2VhcmNoRmlsdGVyID0gYXJndW1lbnRzLmxlbmd0aCA+IDEgPyBhcmd1bWVudHNbMV0gOiB1bmRlZmluZWQ7CiAgICAgIHZhciBmaWx0ZXIgPSBhcmd1bWVudHMubGVuZ3RoID4gMiA/IGFyZ3VtZW50c1syXSA6IHVuZGVmaW5lZDsKICAgICAgcmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uIChyZXNvbHZlLCByZWplY3QpIHsKICAgICAgICBpZiAoZmlsdGVyLnZpZXdwYXJhbXMpIHsKICAgICAgICAgIE9iamVjdC5hc3NpZ24oc2VhcmNoRmlsdGVyLCBmaWx0ZXIudmlld3BhcmFtcyk7CiAgICAgICAgfQoKICAgICAgICBpZiAoIXNlYXJjaEZpbHRlci5wYWdlKSB7CiAgICAgICAgICBPYmplY3QuYXNzaWduKHNlYXJjaEZpbHRlciwgewogICAgICAgICAgICBwYWdlOiAwCiAgICAgICAgICB9KTsKICAgICAgICB9CgogICAgICAgIGlmICghc2VhcmNoRmlsdGVyLnNpemUpIHsKICAgICAgICAgIE9iamVjdC5hc3NpZ24oc2VhcmNoRmlsdGVyLCB7CiAgICAgICAgICAgIHNpemU6IDEwMDAKICAgICAgICAgIH0pOwogICAgICAgIH0KCiAgICAgICAgaWYgKGNvbnRleHQgJiYgY29udGV4dC5zcmZwYXJlbnRkZW5hbWUpIHsKICAgICAgICAgIE9iamVjdC5hc3NpZ24oc2VhcmNoRmlsdGVyLCB7CiAgICAgICAgICAgIHNyZnBhcmVudGRlbmFtZTogSlNPTi5wYXJzZShKU09OLnN0cmluZ2lmeShjb250ZXh0KSkuc3JmcGFyZW50ZGVuYW1lCiAgICAgICAgICB9KTsKICAgICAgICB9CgogICAgICAgIGlmIChjb250ZXh0ICYmIGNvbnRleHQuc3JmcGFyZW50a2V5KSB7CiAgICAgICAgICBPYmplY3QuYXNzaWduKHNlYXJjaEZpbHRlciwgewogICAgICAgICAgICBzcmZwYXJlbnRrZXk6IEpTT04ucGFyc2UoSlNPTi5zdHJpbmdpZnkoY29udGV4dCkpLnNyZnBhcmVudGtleQogICAgICAgICAgfSk7CiAgICAgICAgfQoKICAgICAgICBPYmplY3QuYXNzaWduKHNlYXJjaEZpbHRlciwgewogICAgICAgICAgc29ydDogJ3B4LGFzYycKICAgICAgICB9KTsKICAgICAgICB2YXIgX2FwcEVudGl0eVNlcnZpY2UgPSBfdGhpczQub3Jtb3JnU2VydmljZTsKICAgICAgICB2YXIgbGlzdCA9IFtdOwoKICAgICAgICBpZiAoX2FwcEVudGl0eVNlcnZpY2VbJ0ZldGNoQ3VyQ2hpbGQnXSAmJiBfYXBwRW50aXR5U2VydmljZVsnRmV0Y2hDdXJDaGlsZCddIGluc3RhbmNlb2YgRnVuY3Rpb24pIHsKICAgICAgICAgIHZhciByZXNwb25zZSA9IF9hcHBFbnRpdHlTZXJ2aWNlWydGZXRjaEN1ckNoaWxkJ10oY29udGV4dCwgc2VhcmNoRmlsdGVyLCBmYWxzZSk7CgogICAgICAgICAgcmVzcG9uc2UudGhlbihmdW5jdGlvbiAocmVzcG9uc2UpIHsKICAgICAgICAgICAgaWYgKCFyZXNwb25zZS5zdGF0dXMgfHwgcmVzcG9uc2Uuc3RhdHVzICE9PSAyMDApIHsKICAgICAgICAgICAgICByZXNvbHZlKFtdKTsKICAgICAgICAgICAgICBjb25zb2xlLmxvZyhKU09OLnN0cmluZ2lmeShjb250ZXh0KSk7CiAgICAgICAgICAgICAgY29uc29sZS5lcnJvcign5p+l6K+iRmV0Y2hDdXJDaGlsZOaVsOaNrumbhuW8guW4uCEnKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgdmFyIGRhdGEgPSByZXNwb25zZS5kYXRhOwoKICAgICAgICAgICAgaWYgKE9iamVjdC5rZXlzKGRhdGEpLmxlbmd0aCA+IDApIHsKICAgICAgICAgICAgICBsaXN0ID0gSlNPTi5wYXJzZShKU09OLnN0cmluZ2lmeShkYXRhKSk7CiAgICAgICAgICAgICAgcmVzb2x2ZShsaXN0KTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICByZXNvbHZlKFtdKTsKICAgICAgICAgICAgfQogICAgICAgICAgfSlbImNhdGNoIl0oZnVuY3Rpb24gKHJlc3BvbnNlKSB7CiAgICAgICAgICAgIHJlc29sdmUoW10pOwogICAgICAgICAgICBjb25zb2xlLmxvZyhKU09OLnN0cmluZ2lmeShjb250ZXh0KSk7CiAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoJ+afpeivokZldGNoQ3VyQ2hpbGTmlbDmja7pm4blvILluLghJyk7CiAgICAgICAgICB9KTsKICAgICAgICB9CiAgICAgIH0pOwogICAgfQogICAgLyoqDQogICAgICog5aGr5YWFIOagkeinhuWbvuiKgueCuVvlrZDnu4Tnu4foioLngrld5a2Q6IqC54K5DQogICAgICoNCiAgICAgKiBAcHVibGljDQogICAgICogQHBhcmFtIHthbnl7fX0gY29udGV4dA0KICAgICAqIEBwYXJhbSB7Kn0gZmlsdGVyDQogICAgICogQHBhcmFtIHthbnlbXX0gbGlzdA0KICAgICAqIEByZXR1cm5zIHtQcm9taXNlPGFueT59DQogICAgICogQG1lbWJlcm9mIFBJTVJlY29yZFNlcnZpY2UNCiAgICAgKi8KCiAgfSwgewogICAga2V5OiAiZmlsbFN1Ym9yZ05vZGVDaGlsZHMiLAogICAgdmFsdWU6IGZ1bmN0aW9uICgpIHsKICAgICAgdmFyIF9maWxsU3Vib3JnTm9kZUNoaWxkcyA9IF9hc3luY1RvR2VuZXJhdG9yKAogICAgICAvKiNfX1BVUkVfXyovCiAgICAgIHJlZ2VuZXJhdG9yUnVudGltZS5tYXJrKGZ1bmN0aW9uIF9jYWxsZWUzKCkgewogICAgICAgIHZhciBjb250ZXh0LAogICAgICAgICAgICBmaWx0ZXIsCiAgICAgICAgICAgIGxpc3QsCiAgICAgICAgICAgIFN1Ym9yZ1JzTmF2Q29udGV4dCwKICAgICAgICAgICAgU3Vib3JnUnNOYXZQYXJhbXMsCiAgICAgICAgICAgIFN1Ym9yZ1JzUGFyYW1zLAogICAgICAgICAgICBfU3Vib3JnUnNOYXZDb250ZXh0LAogICAgICAgICAgICBfU3Vib3JnUnNOYXZQYXJhbXMsCiAgICAgICAgICAgIF9TdWJvcmdSc1BhcmFtcywKICAgICAgICAgICAgX2FyZ3MzID0gYXJndW1lbnRzOwoKICAgICAgICByZXR1cm4gcmVnZW5lcmF0b3JSdW50aW1lLndyYXAoZnVuY3Rpb24gX2NhbGxlZTMkKF9jb250ZXh0MykgewogICAgICAgICAgd2hpbGUgKDEpIHsKICAgICAgICAgICAgc3dpdGNoIChfY29udGV4dDMucHJldiA9IF9jb250ZXh0My5uZXh0KSB7CiAgICAgICAgICAgICAgY2FzZSAwOgogICAgICAgICAgICAgICAgY29udGV4dCA9IF9hcmdzMy5sZW5ndGggPiAwICYmIF9hcmdzM1swXSAhPT0gdW5kZWZpbmVkID8gX2FyZ3MzWzBdIDoge307CiAgICAgICAgICAgICAgICBmaWx0ZXIgPSBfYXJnczMubGVuZ3RoID4gMSA/IF9hcmdzM1sxXSA6IHVuZGVmaW5lZDsKICAgICAgICAgICAgICAgIGxpc3QgPSBfYXJnczMubGVuZ3RoID4gMiA/IF9hcmdzM1syXSA6IHVuZGVmaW5lZDsKCiAgICAgICAgICAgICAgICBpZiAoIShmaWx0ZXIuc3Jmbm9kZWZpbHRlciAmJiAhT2JqZWN0LmlzKGZpbHRlci5zcmZub2RlZmlsdGVyLCAiIikpKSB7CiAgICAgICAgICAgICAgICAgIF9jb250ZXh0My5uZXh0ID0gMTE7CiAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIC8vIOWhq+WFheWtkOe7hOe7h+iKgueCuQogICAgICAgICAgICAgICAgU3Vib3JnUnNOYXZDb250ZXh0ID0ge307CiAgICAgICAgICAgICAgICBTdWJvcmdSc05hdlBhcmFtcyA9IHt9OwogICAgICAgICAgICAgICAgU3Vib3JnUnNQYXJhbXMgPSB7fTsKICAgICAgICAgICAgICAgIF9jb250ZXh0My5uZXh0ID0gOTsKICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLmZpbGxTdWJvcmdOb2Rlcyhjb250ZXh0LCBmaWx0ZXIsIGxpc3QsIFN1Ym9yZ1JzTmF2Q29udGV4dCwgU3Vib3JnUnNOYXZQYXJhbXMsIFN1Ym9yZ1JzUGFyYW1zKTsKCiAgICAgICAgICAgICAgY2FzZSA5OgogICAgICAgICAgICAgICAgX2NvbnRleHQzLm5leHQgPSAxNjsKICAgICAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgICAgICBjYXNlIDExOgogICAgICAgICAgICAgICAgLy8g5aGr5YWF5a2Q57uE57uH6IqC54K5CiAgICAgICAgICAgICAgICBfU3Vib3JnUnNOYXZDb250ZXh0ID0ge307CiAgICAgICAgICAgICAgICBfU3Vib3JnUnNOYXZQYXJhbXMgPSB7fTsKICAgICAgICAgICAgICAgIF9TdWJvcmdSc1BhcmFtcyA9IHt9OwogICAgICAgICAgICAgICAgX2NvbnRleHQzLm5leHQgPSAxNjsKICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLmZpbGxTdWJvcmdOb2Rlcyhjb250ZXh0LCBmaWx0ZXIsIGxpc3QsIF9TdWJvcmdSc05hdkNvbnRleHQsIF9TdWJvcmdSc05hdlBhcmFtcywgX1N1Ym9yZ1JzUGFyYW1zKTsKCiAgICAgICAgICAgICAgY2FzZSAxNjoKICAgICAgICAgICAgICBjYXNlICJlbmQiOgogICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0My5zdG9wKCk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9LCBfY2FsbGVlMywgdGhpcyk7CiAgICAgIH0pKTsKCiAgICAgIGZ1bmN0aW9uIGZpbGxTdWJvcmdOb2RlQ2hpbGRzKCkgewogICAgICAgIHJldHVybiBfZmlsbFN1Ym9yZ05vZGVDaGlsZHMuYXBwbHkodGhpcywgYXJndW1lbnRzKTsKICAgICAgfQoKICAgICAgcmV0dXJuIGZpbGxTdWJvcmdOb2RlQ2hpbGRzOwogICAgfSgpCiAgICAvKioNCiAgICAgKiDloavlhYUg5qCR6KeG5Zu+6IqC54K5W+agueiKgueCuee7hOe7h10NCiAgICAgKg0KICAgICAqIEBwdWJsaWMNCiAgICAgKiBAcGFyYW0ge2FueXt9fSBjb250ZXh0DQogICAgICogQHBhcmFtIHsqfSBmaWx0ZXINCiAgICAgKiBAcGFyYW0ge2FueVtdfSBsaXN0DQogICAgICogQHBhcmFtIHsqfSByc05hdkNvbnRleHQNCiAgICAgKiBAcGFyYW0geyp9IHJzTmF2UGFyYW1zDQogICAgICogQHBhcmFtIHsqfSByc1BhcmFtcw0KICAgICAqIEByZXR1cm5zIHtQcm9taXNlPGFueT59DQogICAgICogQG1lbWJlcm9mIFBJTVJlY29yZFNlcnZpY2UNCiAgICAgKi8KCiAgfSwgewogICAga2V5OiAiZmlsbE9ybW9yZ05vZGVzIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBmaWxsT3Jtb3JnTm9kZXMoKSB7CiAgICAgIHZhciBfdGhpczUgPSB0aGlzOwoKICAgICAgdmFyIGNvbnRleHQgPSBhcmd1bWVudHMubGVuZ3RoID4gMCAmJiBhcmd1bWVudHNbMF0gIT09IHVuZGVmaW5lZCA/IGFyZ3VtZW50c1swXSA6IHt9OwogICAgICB2YXIgZmlsdGVyID0gYXJndW1lbnRzLmxlbmd0aCA+IDEgPyBhcmd1bWVudHNbMV0gOiB1bmRlZmluZWQ7CiAgICAgIHZhciBsaXN0ID0gYXJndW1lbnRzLmxlbmd0aCA+IDIgPyBhcmd1bWVudHNbMl0gOiB1bmRlZmluZWQ7CiAgICAgIHZhciByc05hdkNvbnRleHQgPSBhcmd1bWVudHMubGVuZ3RoID4gMyA/IGFyZ3VtZW50c1szXSA6IHVuZGVmaW5lZDsKICAgICAgdmFyIHJzTmF2UGFyYW1zID0gYXJndW1lbnRzLmxlbmd0aCA+IDQgPyBhcmd1bWVudHNbNF0gOiB1bmRlZmluZWQ7CiAgICAgIHZhciByc1BhcmFtcyA9IGFyZ3VtZW50cy5sZW5ndGggPiA1ID8gYXJndW1lbnRzWzVdIDogdW5kZWZpbmVkOwogICAgICBjb250ZXh0ID0gdGhpcy5oYW5kbGVSZXNOYXZDb250ZXh0KGNvbnRleHQsIGZpbHRlciwgcnNOYXZDb250ZXh0KTsKICAgICAgZmlsdGVyID0gdGhpcy5oYW5kbGVSZXNOYXZQYXJhbXMoY29udGV4dCwgZmlsdGVyLCByc05hdlBhcmFtcywgcnNQYXJhbXMpOwogICAgICByZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24gKHJlc29sdmUsIHJlamVjdCkgewogICAgICAgIHZhciBzZWFyY2hGaWx0ZXIgPSB7fTsKICAgICAgICBPYmplY3QuYXNzaWduKHNlYXJjaEZpbHRlciwgewogICAgICAgICAgdG90YWw6IGZhbHNlCiAgICAgICAgfSk7CiAgICAgICAgT2JqZWN0LmFzc2lnbihzZWFyY2hGaWx0ZXIsIHsKICAgICAgICAgIHF1ZXJ5OiBmaWx0ZXIuc3Jmbm9kZWZpbHRlcgogICAgICAgIH0pOwogICAgICAgIHZhciBiRmlyc3QgPSB0cnVlOwogICAgICAgIHZhciByZWNvcmRzID0gW107CgogICAgICAgIHRyeSB7CiAgICAgICAgICBfdGhpczUuc2VhcmNoT3Jtb3JnKGNvbnRleHQsIHNlYXJjaEZpbHRlciwgZmlsdGVyKS50aGVuKGZ1bmN0aW9uIChyZWNvcmRzKSB7CiAgICAgICAgICAgIGlmIChyZWNvcmRzICYmIHJlY29yZHMubGVuZ3RoID4gMCkgewogICAgICAgICAgICAgIHJlY29yZHMuZm9yRWFjaChmdW5jdGlvbiAoZW50aXR5KSB7CiAgICAgICAgICAgICAgICB2YXIgdHJlZU5vZGUgPSB7fTsgLy8g5pW055CGY29udGV4dAoKICAgICAgICAgICAgICAgIHZhciBzdHJJZCA9IGVudGl0eS5vcmdpZDsKICAgICAgICAgICAgICAgIHZhciBzdHJUZXh0ID0gZW50aXR5LnNob3J0bmFtZTsKICAgICAgICAgICAgICAgIE9iamVjdC5hc3NpZ24odHJlZU5vZGUsIHsKICAgICAgICAgICAgICAgICAgc3JmcGFyZW50ZGVuYW1lOiAnT3JtT3JnJywKICAgICAgICAgICAgICAgICAgc3JmcGFyZW50a2V5OiBlbnRpdHkub3JnaWQKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgdmFyIHRlbXBDb250ZXh0ID0gSlNPTi5wYXJzZShKU09OLnN0cmluZ2lmeShjb250ZXh0KSk7CiAgICAgICAgICAgICAgICBPYmplY3QuYXNzaWduKHRlbXBDb250ZXh0LCB7CiAgICAgICAgICAgICAgICAgIHNyZnBhcmVudGRlbmFtZTogJ09ybU9yZycsCiAgICAgICAgICAgICAgICAgIHNyZnBhcmVudGtleTogZW50aXR5Lm9yZ2lkLAogICAgICAgICAgICAgICAgICBvcm1vcmc6IHN0cklkCiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIE9iamVjdC5hc3NpZ24odHJlZU5vZGUsIHsKICAgICAgICAgICAgICAgICAgc3JmYXBwY3R4OiB0ZW1wQ29udGV4dAogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICBPYmplY3QuYXNzaWduKHRyZWVOb2RlLCB7CiAgICAgICAgICAgICAgICAgICdvcm1vcmcnOiBzdHJJZAogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICBPYmplY3QuYXNzaWduKHRyZWVOb2RlLCB7CiAgICAgICAgICAgICAgICAgIHNyZmtleTogc3RySWQKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgT2JqZWN0LmFzc2lnbih0cmVlTm9kZSwgewogICAgICAgICAgICAgICAgICB0ZXh0OiBzdHJUZXh0LAogICAgICAgICAgICAgICAgICBzcmZtYWpvcnRleHQ6IHN0clRleHQKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgdmFyIHN0ck5vZGVJZCA9ICdPUk1PUkcnOwogICAgICAgICAgICAgICAgc3RyTm9kZUlkICs9IF90aGlzNS5UUkVFTk9ERV9TRVBBUkFUT1I7CiAgICAgICAgICAgICAgICBzdHJOb2RlSWQgKz0gc3RySWQ7CiAgICAgICAgICAgICAgICBPYmplY3QuYXNzaWduKHRyZWVOb2RlLCB7CiAgICAgICAgICAgICAgICAgIGlkOiBzdHJOb2RlSWQKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgT2JqZWN0LmFzc2lnbih0cmVlTm9kZSwgewogICAgICAgICAgICAgICAgICBleHBhbmRlZDogdHJ1ZQogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICBPYmplY3QuYXNzaWduKHRyZWVOb2RlLCB7CiAgICAgICAgICAgICAgICAgIGxlYWY6IGZhbHNlCiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIE9iamVjdC5hc3NpZ24odHJlZU5vZGUsIHsKICAgICAgICAgICAgICAgICAgbmF2ZmlsdGVyOiAibl9vcm1vcmdpZF9lcSIKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgT2JqZWN0LmFzc2lnbih0cmVlTm9kZSwgewogICAgICAgICAgICAgICAgICBjdXJEYXRhOiBlbnRpdHkKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgT2JqZWN0LmFzc2lnbih0cmVlTm9kZSwgewogICAgICAgICAgICAgICAgICBub2RlaWQ6IHRyZWVOb2RlLnNyZmtleQogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICBPYmplY3QuYXNzaWduKHRyZWVOb2RlLCB7CiAgICAgICAgICAgICAgICAgIG5vZGVpZDI6IGZpbHRlci5zdHJSZWFsTm9kZUlkCiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIGxpc3QucHVzaCh0cmVlTm9kZSk7CiAgICAgICAgICAgICAgICByZXNvbHZlKGxpc3QpOwogICAgICAgICAgICAgICAgYkZpcnN0ID0gZmFsc2U7CiAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgcmVzb2x2ZShsaXN0KTsKICAgICAgICAgICAgfQogICAgICAgICAgfSk7CiAgICAgICAgfSBjYXRjaCAoZXJyb3IpIHsKICAgICAgICAgIGNvbnNvbGUuZXJyb3IoZXJyb3IpOwogICAgICAgIH0KICAgICAgfSk7CiAgICB9CiAgICAvKioNCiAgICAgKiDojrflj5bmn6Xor6Lpm4blkIgNCiAgICAgKg0KICAgICAqIEBwdWJsaWMNCiAgICAgKiBAcGFyYW0ge2FueXt9fSBjb250ZXh0DQogICAgICogQHBhcmFtIHsqfSBzZWFyY2hGaWx0ZXINCiAgICAgKiBAcGFyYW0geyp9IGZpbHRlcg0KICAgICAqIEByZXR1cm5zIHthbnlbXX0NCiAgICAgKiBAbWVtYmVyb2YgVGVzdEVuZXRpdHlEYXRhc1NlcnZpY2UNCiAgICAgKi8KCiAgfSwgewogICAga2V5OiAic2VhcmNoT3Jtb3JnIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBzZWFyY2hPcm1vcmcoKSB7CiAgICAgIHZhciBfdGhpczYgPSB0aGlzOwoKICAgICAgdmFyIGNvbnRleHQgPSBhcmd1bWVudHMubGVuZ3RoID4gMCAmJiBhcmd1bWVudHNbMF0gIT09IHVuZGVmaW5lZCA/IGFyZ3VtZW50c1swXSA6IHt9OwogICAgICB2YXIgc2VhcmNoRmlsdGVyID0gYXJndW1lbnRzLmxlbmd0aCA+IDEgPyBhcmd1bWVudHNbMV0gOiB1bmRlZmluZWQ7CiAgICAgIHZhciBmaWx0ZXIgPSBhcmd1bWVudHMubGVuZ3RoID4gMiA/IGFyZ3VtZW50c1syXSA6IHVuZGVmaW5lZDsKICAgICAgcmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uIChyZXNvbHZlLCByZWplY3QpIHsKICAgICAgICBpZiAoZmlsdGVyLnZpZXdwYXJhbXMpIHsKICAgICAgICAgIE9iamVjdC5hc3NpZ24oc2VhcmNoRmlsdGVyLCBmaWx0ZXIudmlld3BhcmFtcyk7CiAgICAgICAgfQoKICAgICAgICBpZiAoIXNlYXJjaEZpbHRlci5wYWdlKSB7CiAgICAgICAgICBPYmplY3QuYXNzaWduKHNlYXJjaEZpbHRlciwgewogICAgICAgICAgICBwYWdlOiAwCiAgICAgICAgICB9KTsKICAgICAgICB9CgogICAgICAgIGlmICghc2VhcmNoRmlsdGVyLnNpemUpIHsKICAgICAgICAgIE9iamVjdC5hc3NpZ24oc2VhcmNoRmlsdGVyLCB7CiAgICAgICAgICAgIHNpemU6IDEwMDAKICAgICAgICAgIH0pOwogICAgICAgIH0KCiAgICAgICAgaWYgKGNvbnRleHQgJiYgY29udGV4dC5zcmZwYXJlbnRkZW5hbWUpIHsKICAgICAgICAgIE9iamVjdC5hc3NpZ24oc2VhcmNoRmlsdGVyLCB7CiAgICAgICAgICAgIHNyZnBhcmVudGRlbmFtZTogSlNPTi5wYXJzZShKU09OLnN0cmluZ2lmeShjb250ZXh0KSkuc3JmcGFyZW50ZGVuYW1lCiAgICAgICAgICB9KTsKICAgICAgICB9CgogICAgICAgIGlmIChjb250ZXh0ICYmIGNvbnRleHQuc3JmcGFyZW50a2V5KSB7CiAgICAgICAgICBPYmplY3QuYXNzaWduKHNlYXJjaEZpbHRlciwgewogICAgICAgICAgICBzcmZwYXJlbnRrZXk6IEpTT04ucGFyc2UoSlNPTi5zdHJpbmdpZnkoY29udGV4dCkpLnNyZnBhcmVudGtleQogICAgICAgICAgfSk7CiAgICAgICAgfQoKICAgICAgICBPYmplY3QuYXNzaWduKHNlYXJjaEZpbHRlciwgewogICAgICAgICAgc29ydDogJ3B4LGFzYycKICAgICAgICB9KTsKICAgICAgICB2YXIgX2FwcEVudGl0eVNlcnZpY2UgPSBfdGhpczYub3Jtb3JnU2VydmljZTsKICAgICAgICB2YXIgbGlzdCA9IFtdOwoKICAgICAgICBpZiAoX2FwcEVudGl0eVNlcnZpY2VbJ0ZldGNoQ3VyUG9yZyddICYmIF9hcHBFbnRpdHlTZXJ2aWNlWydGZXRjaEN1clBvcmcnXSBpbnN0YW5jZW9mIEZ1bmN0aW9uKSB7CiAgICAgICAgICB2YXIgcmVzcG9uc2UgPSBfYXBwRW50aXR5U2VydmljZVsnRmV0Y2hDdXJQb3JnJ10oY29udGV4dCwgc2VhcmNoRmlsdGVyLCBmYWxzZSk7CgogICAgICAgICAgcmVzcG9uc2UudGhlbihmdW5jdGlvbiAocmVzcG9uc2UpIHsKICAgICAgICAgICAgaWYgKCFyZXNwb25zZS5zdGF0dXMgfHwgcmVzcG9uc2Uuc3RhdHVzICE9PSAyMDApIHsKICAgICAgICAgICAgICByZXNvbHZlKFtdKTsKICAgICAgICAgICAgICBjb25zb2xlLmxvZyhKU09OLnN0cmluZ2lmeShjb250ZXh0KSk7CiAgICAgICAgICAgICAgY29uc29sZS5lcnJvcign5p+l6K+iRmV0Y2hDdXJQb3Jn5pWw5o2u6ZuG5byC5bi4IScpOwogICAgICAgICAgICB9CgogICAgICAgICAgICB2YXIgZGF0YSA9IHJlc3BvbnNlLmRhdGE7CgogICAgICAgICAgICBpZiAoT2JqZWN0LmtleXMoZGF0YSkubGVuZ3RoID4gMCkgewogICAgICAgICAgICAgIGxpc3QgPSBKU09OLnBhcnNlKEpTT04uc3RyaW5naWZ5KGRhdGEpKTsKICAgICAgICAgICAgICByZXNvbHZlKGxpc3QpOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgIHJlc29sdmUoW10pOwogICAgICAgICAgICB9CiAgICAgICAgICB9KVsiY2F0Y2giXShmdW5jdGlvbiAocmVzcG9uc2UpIHsKICAgICAgICAgICAgcmVzb2x2ZShbXSk7CiAgICAgICAgICAgIGNvbnNvbGUubG9nKEpTT04uc3RyaW5naWZ5KGNvbnRleHQpKTsKICAgICAgICAgICAgY29uc29sZS5lcnJvcign5p+l6K+iRmV0Y2hDdXJQb3Jn5pWw5o2u6ZuG5byC5bi4IScpOwogICAgICAgICAgfSk7CiAgICAgICAgfQogICAgICB9KTsKICAgIH0KICAgIC8qKg0KICAgICAqIOWhq+WFhSDmoJHop4blm77oioLngrlb5qC56IqC54K557uE57uHXeWtkOiKgueCuQ0KICAgICAqDQogICAgICogQHB1YmxpYw0KICAgICAqIEBwYXJhbSB7YW55e319IGNvbnRleHQNCiAgICAgKiBAcGFyYW0geyp9IGZpbHRlcg0KICAgICAqIEBwYXJhbSB7YW55W119IGxpc3QNCiAgICAgKiBAcmV0dXJucyB7UHJvbWlzZTxhbnk+fQ0KICAgICAqIEBtZW1iZXJvZiBQSU1SZWNvcmRTZXJ2aWNlDQogICAgICovCgogIH0sIHsKICAgIGtleTogImZpbGxPcm1vcmdOb2RlQ2hpbGRzIiwKICAgIHZhbHVlOiBmdW5jdGlvbiAoKSB7CiAgICAgIHZhciBfZmlsbE9ybW9yZ05vZGVDaGlsZHMgPSBfYXN5bmNUb0dlbmVyYXRvcigKICAgICAgLyojX19QVVJFX18qLwogICAgICByZWdlbmVyYXRvclJ1bnRpbWUubWFyayhmdW5jdGlvbiBfY2FsbGVlNCgpIHsKICAgICAgICB2YXIgY29udGV4dCwKICAgICAgICAgICAgZmlsdGVyLAogICAgICAgICAgICBsaXN0LAogICAgICAgICAgICBTdWJvcmdSc05hdkNvbnRleHQsCiAgICAgICAgICAgIFN1Ym9yZ1JzTmF2UGFyYW1zLAogICAgICAgICAgICBTdWJvcmdSc1BhcmFtcywKICAgICAgICAgICAgX1N1Ym9yZ1JzTmF2Q29udGV4dDIsCiAgICAgICAgICAgIF9TdWJvcmdSc05hdlBhcmFtczIsCiAgICAgICAgICAgIF9TdWJvcmdSc1BhcmFtczIsCiAgICAgICAgICAgIF9hcmdzNCA9IGFyZ3VtZW50czsKCiAgICAgICAgcmV0dXJuIHJlZ2VuZXJhdG9yUnVudGltZS53cmFwKGZ1bmN0aW9uIF9jYWxsZWU0JChfY29udGV4dDQpIHsKICAgICAgICAgIHdoaWxlICgxKSB7CiAgICAgICAgICAgIHN3aXRjaCAoX2NvbnRleHQ0LnByZXYgPSBfY29udGV4dDQubmV4dCkgewogICAgICAgICAgICAgIGNhc2UgMDoKICAgICAgICAgICAgICAgIGNvbnRleHQgPSBfYXJnczQubGVuZ3RoID4gMCAmJiBfYXJnczRbMF0gIT09IHVuZGVmaW5lZCA/IF9hcmdzNFswXSA6IHt9OwogICAgICAgICAgICAgICAgZmlsdGVyID0gX2FyZ3M0Lmxlbmd0aCA+IDEgPyBfYXJnczRbMV0gOiB1bmRlZmluZWQ7CiAgICAgICAgICAgICAgICBsaXN0ID0gX2FyZ3M0Lmxlbmd0aCA+IDIgPyBfYXJnczRbMl0gOiB1bmRlZmluZWQ7CgogICAgICAgICAgICAgICAgaWYgKCEoZmlsdGVyLnNyZm5vZGVmaWx0ZXIgJiYgIU9iamVjdC5pcyhmaWx0ZXIuc3Jmbm9kZWZpbHRlciwgIiIpKSkgewogICAgICAgICAgICAgICAgICBfY29udGV4dDQubmV4dCA9IDExOwogICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAvLyDloavlhYXlrZDnu4Tnu4foioLngrkKICAgICAgICAgICAgICAgIFN1Ym9yZ1JzTmF2Q29udGV4dCA9IHt9OwogICAgICAgICAgICAgICAgU3Vib3JnUnNOYXZQYXJhbXMgPSB7fTsKICAgICAgICAgICAgICAgIFN1Ym9yZ1JzUGFyYW1zID0ge307CiAgICAgICAgICAgICAgICBfY29udGV4dDQubmV4dCA9IDk7CiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5maWxsU3Vib3JnTm9kZXMoY29udGV4dCwgZmlsdGVyLCBsaXN0LCBTdWJvcmdSc05hdkNvbnRleHQsIFN1Ym9yZ1JzTmF2UGFyYW1zLCBTdWJvcmdSc1BhcmFtcyk7CgogICAgICAgICAgICAgIGNhc2UgOToKICAgICAgICAgICAgICAgIF9jb250ZXh0NC5uZXh0ID0gMTY7CiAgICAgICAgICAgICAgICBicmVhazsKCiAgICAgICAgICAgICAgY2FzZSAxMToKICAgICAgICAgICAgICAgIC8vIOWhq+WFheWtkOe7hOe7h+iKgueCuQogICAgICAgICAgICAgICAgX1N1Ym9yZ1JzTmF2Q29udGV4dDIgPSB7fTsKICAgICAgICAgICAgICAgIF9TdWJvcmdSc05hdlBhcmFtczIgPSB7fTsKICAgICAgICAgICAgICAgIF9TdWJvcmdSc1BhcmFtczIgPSB7fTsKICAgICAgICAgICAgICAgIF9jb250ZXh0NC5uZXh0ID0gMTY7CiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5maWxsU3Vib3JnTm9kZXMoY29udGV4dCwgZmlsdGVyLCBsaXN0LCBfU3Vib3JnUnNOYXZDb250ZXh0MiwgX1N1Ym9yZ1JzTmF2UGFyYW1zMiwgX1N1Ym9yZ1JzUGFyYW1zMik7CgogICAgICAgICAgICAgIGNhc2UgMTY6CiAgICAgICAgICAgICAgY2FzZSAiZW5kIjoKICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDQuc3RvcCgpOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSwgX2NhbGxlZTQsIHRoaXMpOwogICAgICB9KSk7CgogICAgICBmdW5jdGlvbiBmaWxsT3Jtb3JnTm9kZUNoaWxkcygpIHsKICAgICAgICByZXR1cm4gX2ZpbGxPcm1vcmdOb2RlQ2hpbGRzLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7CiAgICAgIH0KCiAgICAgIHJldHVybiBmaWxsT3Jtb3JnTm9kZUNoaWxkczsKICAgIH0oKQogICAgLyoqDQogICAgICog5aSE55CG5Luj56CB6KGo6L+U5Zue5pWw5o2uKOagkeeKtue7k+aehCkNCiAgICAgKg0KICAgICAqIEBwYXJhbSByZXN1bHQg6L+U5Zue5pWw57uEDQogICAgICogQHBhcmFtIGNvbnRleHQg5bqU55So5LiK5LiL5paHDQogICAgICogQHBhcmFtIGNhbGxCYWNrIOWbnuiwgw0KICAgICAqIEBtZW1iZXJvZiBQSU1SZWNvcmRTZXJ2aWNlDQogICAgICovCgogIH0sIHsKICAgIGtleTogImhhbmRsZURhdGFTZXQiLAogICAgdmFsdWU6IGZ1bmN0aW9uIGhhbmRsZURhdGFTZXQocmVzdWx0LCBjb250ZXh0LCBjYWxsQmFjaykgewogICAgICB2YXIgX3RoaXM3ID0gdGhpczsKCiAgICAgIHZhciBsaXN0ID0gW107CgogICAgICBpZiAocmVzdWx0Lmxlbmd0aCA9PT0gMCkgewogICAgICAgIHJldHVybiBsaXN0OwogICAgICB9CgogICAgICByZXN1bHQuZm9yRWFjaChmdW5jdGlvbiAoY29kZUl0ZW0pIHsKICAgICAgICBpZiAoIWNvZGVJdGVtLnB2YWx1ZSkgewogICAgICAgICAgdmFyIHZhbHVlRmllbGQgPSBjb2RlSXRlbS52YWx1ZTsKCiAgICAgICAgICBfdGhpczcuc2V0Q2hpbGRDb2RlSXRlbXModmFsdWVGaWVsZCwgcmVzdWx0LCBjb2RlSXRlbSk7CgogICAgICAgICAgbGlzdC5wdXNoKGNvZGVJdGVtKTsKICAgICAgICB9CiAgICAgIH0pOwogICAgICB0aGlzLnNldE5vZGVEYXRhKGxpc3QsIGNvbnRleHQsIGNhbGxCYWNrKTsKICAgICAgcmV0dXJuIGxpc3Q7CiAgICB9CiAgICAvKioNCiAgICAgKiDlpITnkIbpnZ7moLnoioLngrnmlbDmja4NCiAgICAgKg0KICAgICAqIEBwYXJhbSByZXN1bHQg6L+U5Zue5pWw57uEDQogICAgICogQHBhcmFtIGNvbnRleHQg5bqU55So5LiK5LiL5paHDQogICAgICogQHBhcmFtIGNhbGxCYWNrIOWbnuiwgw0KICAgICAqIEBtZW1iZXJvZiBQSU1SZWNvcmRTZXJ2aWNlDQogICAgICovCgogIH0sIHsKICAgIGtleTogInNldENoaWxkQ29kZUl0ZW1zIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBzZXRDaGlsZENvZGVJdGVtcyhwVmFsdWUsIHJlc3VsdCwgY29kZUl0ZW0pIHsKICAgICAgdmFyIF90aGlzOCA9IHRoaXM7CgogICAgICByZXN1bHQuZm9yRWFjaChmdW5jdGlvbiAoaXRlbSkgewogICAgICAgIGlmIChpdGVtLnB2YWx1ZSA9PSBwVmFsdWUpIHsKICAgICAgICAgIHZhciB2YWx1ZUZpZWxkID0gaXRlbS52YWx1ZTsKCiAgICAgICAgICBfdGhpczguc2V0Q2hpbGRDb2RlSXRlbXModmFsdWVGaWVsZCwgcmVzdWx0LCBpdGVtKTsKCiAgICAgICAgICBpZiAoIWNvZGVJdGVtLmNoaWxkcmVuKSB7CiAgICAgICAgICAgIGNvZGVJdGVtLmNoaWxkcmVuID0gW107CiAgICAgICAgICB9CgogICAgICAgICAgY29kZUl0ZW0uY2hpbGRyZW4ucHVzaChpdGVtKTsKICAgICAgICB9CiAgICAgIH0pOwogICAgfQogICAgLyoqDQogICAgICog6K6+572u6IqC54K5VUnmlbDmja4NCiAgICAgKg0KICAgICAqIEBwYXJhbSByZXN1bHQg6L+U5Zue5pWw57uEDQogICAgICogQHBhcmFtIGNvbnRleHQg5bqU55So5LiK5LiL5paHDQogICAgICogQHBhcmFtIGNhbGxCYWNrIOWbnuiwgw0KICAgICAqIEBtZW1iZXJvZiBQSU1SZWNvcmRTZXJ2aWNlDQogICAgICovCgogIH0sIHsKICAgIGtleTogInNldE5vZGVEYXRhIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBzZXROb2RlRGF0YShyZXN1bHQsIGNvbnRleHQsIGNhbGxCYWNrKSB7CiAgICAgIHZhciBfdGhpczkgPSB0aGlzOwoKICAgICAgcmVzdWx0LmZvckVhY2goZnVuY3Rpb24gKGl0ZW0pIHsKICAgICAgICBpZiAoaXRlbS5jaGlsZHJlbikgewogICAgICAgICAgaXRlbS5sZWFmID0gZmFsc2U7CgogICAgICAgICAgX3RoaXM5LnNldE5vZGVEYXRhKGl0ZW0uY2hpbGRyZW4sIGNvbnRleHQsIGNhbGxCYWNrKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgaXRlbS5sZWFmID0gdHJ1ZTsKICAgICAgICB9CgogICAgICAgIGNhbGxCYWNrKGNvbnRleHQsIGl0ZW0pOwogICAgICB9KTsKICAgIH0KICAgIC8qKg0KICAgICAqIOWkhOeQhuiKgueCueWFs+ezu+WvvOiIquS4iuS4i+aWhw0KICAgICAqDQogICAgICogQHBhcmFtIGNvbnRleHQg5bqU55So5LiK5LiL5paHDQogICAgICogQHBhcmFtIGZpbHRlciDlj4LmlbANCiAgICAgKiBAcGFyYW0gcmVzTmF2Q29udGV4dCDoioLngrnlhbPns7vlr7zoiKrkuIrkuIvmlocNCiAgICAgKg0KICAgICAqIEBtZW1iZXJvZiBQSU1SZWNvcmRTZXJ2aWNlDQogICAgICovCgogIH0sIHsKICAgIGtleTogImhhbmRsZVJlc05hdkNvbnRleHQiLAogICAgdmFsdWU6IGZ1bmN0aW9uIGhhbmRsZVJlc05hdkNvbnRleHQoY29udGV4dCwgZmlsdGVyLCByZXNOYXZDb250ZXh0KSB7CiAgICAgIHZhciBfdGhpczEwID0gdGhpczsKCiAgICAgIGlmIChyZXNOYXZDb250ZXh0ICYmIE9iamVjdC5rZXlzKHJlc05hdkNvbnRleHQpLmxlbmd0aCA+IDApIHsKICAgICAgICB2YXIgdGVtcENvbnRleHREYXRhID0gSlNPTi5wYXJzZShKU09OLnN0cmluZ2lmeShjb250ZXh0KSk7CiAgICAgICAgdmFyIHRlbXBWaWV3UGFyYW1zID0ge307CgogICAgICAgIGlmIChmaWx0ZXIgJiYgZmlsdGVyLnZpZXdwYXJhbXMpIHsKICAgICAgICAgIHRlbXBWaWV3UGFyYW1zID0gZmlsdGVyLnZpZXdwYXJhbXM7CiAgICAgICAgfQoKICAgICAgICBPYmplY3Qua2V5cyhyZXNOYXZDb250ZXh0KS5mb3JFYWNoKGZ1bmN0aW9uIChpdGVtKSB7CiAgICAgICAgICB2YXIgY3VyRGF0YU9iaiA9IHJlc05hdkNvbnRleHRbaXRlbV07CgogICAgICAgICAgX3RoaXMxMC5oYW5kbGVDdXN0b21EYXRhTG9naWMoY29udGV4dCwgdGVtcFZpZXdQYXJhbXMsIGN1ckRhdGFPYmosIHRlbXBDb250ZXh0RGF0YSwgaXRlbSk7CiAgICAgICAgfSk7CiAgICAgICAgcmV0dXJuIHRlbXBDb250ZXh0RGF0YTsKICAgICAgfSBlbHNlIHsKICAgICAgICByZXR1cm4gY29udGV4dDsKICAgICAgfQogICAgfQogICAgLyoqDQogICAgICog5aSE55CG5YWz57O75a+86Iiq5Y+C5pWwDQogICAgICoNCiAgICAgKiBAcGFyYW0gY29udGV4dCDlupTnlKjkuIrkuIvmlocNCiAgICAgKiBAcGFyYW0gZmlsdGVyIOWPguaVsA0KICAgICAqIEBwYXJhbSByZXNOYXZQYXJhbXMg6IqC54K55YWz57O75a+86Iiq5Y+C5pWwDQogICAgICogQHBhcmFtIHJlc1BhcmFtcyDoioLngrnlhbPns7vlj4LmlbANCiAgICAgKg0KICAgICAqIEBtZW1iZXJvZiBQSU1SZWNvcmRTZXJ2aWNlDQogICAgICovCgogIH0sIHsKICAgIGtleTogImhhbmRsZVJlc05hdlBhcmFtcyIsCiAgICB2YWx1ZTogZnVuY3Rpb24gaGFuZGxlUmVzTmF2UGFyYW1zKGNvbnRleHQsIGZpbHRlciwgcmVzTmF2UGFyYW1zLCByZXNQYXJhbXMpIHsKICAgICAgdmFyIF90aGlzMTEgPSB0aGlzOwoKICAgICAgaWYgKHJlc05hdlBhcmFtcyAmJiBPYmplY3Qua2V5cyhyZXNOYXZQYXJhbXMpLmxlbmd0aCA+IDAgfHwgcmVzUGFyYW1zICYmIE9iamVjdC5rZXlzKHJlc1BhcmFtcykubGVuZ3RoID4gMCkgewogICAgICAgIHZhciB0ZW1wVmlld1BhcmFtRGF0YSA9IHt9OwogICAgICAgIHZhciB0ZW1wVmlld1BhcmFtcyA9IHt9OwoKICAgICAgICBpZiAoZmlsdGVyICYmIGZpbHRlci52aWV3cGFyYW1zKSB7CiAgICAgICAgICB0ZW1wVmlld1BhcmFtcyA9IGZpbHRlci52aWV3cGFyYW1zOwogICAgICAgICAgdGVtcFZpZXdQYXJhbURhdGEgPSBKU09OLnBhcnNlKEpTT04uc3RyaW5naWZ5KGZpbHRlci52aWV3cGFyYW1zKSk7CiAgICAgICAgfQoKICAgICAgICBpZiAoT2JqZWN0LmtleXMocmVzTmF2UGFyYW1zKS5sZW5ndGggPiAwKSB7CiAgICAgICAgICBPYmplY3Qua2V5cyhyZXNOYXZQYXJhbXMpLmZvckVhY2goZnVuY3Rpb24gKGl0ZW0pIHsKICAgICAgICAgICAgdmFyIGN1ckRhdGFPYmogPSByZXNOYXZQYXJhbXNbaXRlbV07CgogICAgICAgICAgICBfdGhpczExLmhhbmRsZUN1c3RvbURhdGFMb2dpYyhjb250ZXh0LCB0ZW1wVmlld1BhcmFtcywgY3VyRGF0YU9iaiwgdGVtcFZpZXdQYXJhbURhdGEsIGl0ZW0pOwogICAgICAgICAgfSk7CiAgICAgICAgfQoKICAgICAgICBpZiAoT2JqZWN0LmtleXMocmVzUGFyYW1zKS5sZW5ndGggPiAwKSB7CiAgICAgICAgICBPYmplY3Qua2V5cyhyZXNQYXJhbXMpLmZvckVhY2goZnVuY3Rpb24gKGl0ZW0pIHsKICAgICAgICAgICAgdmFyIGN1ckRhdGFPYmogPSByZXNQYXJhbXNbaXRlbV07CiAgICAgICAgICAgIHRlbXBWaWV3UGFyYW1EYXRhW2l0ZW0udG9Mb3dlckNhc2UoKV0gPSBjdXJEYXRhT2JqLnZhbHVlOwogICAgICAgICAgfSk7CiAgICAgICAgfQoKICAgICAgICBPYmplY3QuYXNzaWduKGZpbHRlciwgewogICAgICAgICAgdmlld3BhcmFtczogdGVtcFZpZXdQYXJhbURhdGEKICAgICAgICB9KTsKICAgICAgICByZXR1cm4gZmlsdGVyOwogICAgICB9IGVsc2UgewogICAgICAgIHJldHVybiBmaWx0ZXI7CiAgICAgIH0KICAgIH0KICAgIC8qKg0KICAgICAqIOWkhOeQhuiHquWumuS5ieiKgueCueWFs+ezu+WvvOiIquaVsOaNrg0KICAgICAqDQogICAgICogQHBhcmFtIGNvbnRleHQg5bqU55So5LiK5LiL5paHDQogICAgICogQHBhcmFtIHZpZXdwYXJhbXMg5Y+C5pWwDQogICAgICogQHBhcmFtIGN1ck5hdkRhdGEg6IqC54K55YWz57O75a+86Iiq5Y+C5pWw5a+56LGhDQogICAgICogQHBhcmFtIHRlbXBEYXRhIOi/lOWbnuaVsOaNrg0KICAgICAqIEBwYXJhbSBpdGVtIOiKgueCueWFs+ezu+WvvOiIquWPguaVsOmUruWAvA0KICAgICAqDQogICAgICogQG1lbWJlcm9mIFBJTVJlY29yZFNlcnZpY2UNCiAgICAgKi8KCiAgfSwgewogICAga2V5OiAiaGFuZGxlQ3VzdG9tRGF0YUxvZ2ljIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBoYW5kbGVDdXN0b21EYXRhTG9naWMoY29udGV4dCwgdmlld3BhcmFtcywgY3VyTmF2RGF0YSwgdGVtcERhdGEsIGl0ZW0pIHsKICAgICAgLy8g55u05o6l5YC855u05o6l6LWL5YC8CiAgICAgIGlmIChjdXJOYXZEYXRhLmlzUmF3VmFsdWUpIHsKICAgICAgICBpZiAoT2JqZWN0LmlzKGN1ck5hdkRhdGEudmFsdWUsICJudWxsIikgfHwgT2JqZWN0LmlzKGN1ck5hdkRhdGEudmFsdWUsICIiKSkgewogICAgICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KHRlbXBEYXRhLCBpdGVtLnRvTG93ZXJDYXNlKCksIHsKICAgICAgICAgICAgdmFsdWU6IG51bGwsCiAgICAgICAgICAgIHdyaXRhYmxlOiB0cnVlLAogICAgICAgICAgICBlbnVtZXJhYmxlOiB0cnVlLAogICAgICAgICAgICBjb25maWd1cmFibGU6IHRydWUKICAgICAgICAgIH0pOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkodGVtcERhdGEsIGl0ZW0udG9Mb3dlckNhc2UoKSwgewogICAgICAgICAgICB2YWx1ZTogY3VyTmF2RGF0YS52YWx1ZSwKICAgICAgICAgICAgd3JpdGFibGU6IHRydWUsCiAgICAgICAgICAgIGVudW1lcmFibGU6IHRydWUsCiAgICAgICAgICAgIGNvbmZpZ3VyYWJsZTogdHJ1ZQogICAgICAgICAgfSk7CiAgICAgICAgfQogICAgICB9IGVsc2UgewogICAgICAgIC8vIOWFiOS7juWvvOiIquS4iuS4i+aWh+WPluaVsO+8jOayoeacieWGjeS7juWvvOiIquWPguaVsO+8iFVSTO+8ieWPluaVsO+8jOWmguaenOWvvOiIquS4iuS4i+aWh+WSjOWvvOiIquWPguaVsOmDveayoeacieWImeS4um51bGwKICAgICAgICBpZiAoY29udGV4dFtjdXJOYXZEYXRhLnZhbHVlLnRvTG93ZXJDYXNlKCldKSB7CiAgICAgICAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkodGVtcERhdGEsIGl0ZW0udG9Mb3dlckNhc2UoKSwgewogICAgICAgICAgICB2YWx1ZTogY29udGV4dFtjdXJOYXZEYXRhLnZhbHVlLnRvTG93ZXJDYXNlKCldLAogICAgICAgICAgICB3cml0YWJsZTogdHJ1ZSwKICAgICAgICAgICAgZW51bWVyYWJsZTogdHJ1ZSwKICAgICAgICAgICAgY29uZmlndXJhYmxlOiB0cnVlCiAgICAgICAgICB9KTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgaWYgKHZpZXdwYXJhbXNbY3VyTmF2RGF0YS52YWx1ZS50b0xvd2VyQ2FzZSgpXSkgewogICAgICAgICAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkodGVtcERhdGEsIGl0ZW0udG9Mb3dlckNhc2UoKSwgewogICAgICAgICAgICAgIHZhbHVlOiB2aWV3cGFyYW1zW2N1ck5hdkRhdGEudmFsdWUudG9Mb3dlckNhc2UoKV0sCiAgICAgICAgICAgICAgd3JpdGFibGU6IHRydWUsCiAgICAgICAgICAgICAgZW51bWVyYWJsZTogdHJ1ZSwKICAgICAgICAgICAgICBjb25maWd1cmFibGU6IHRydWUKICAgICAgICAgICAgfSk7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkodGVtcERhdGEsIGl0ZW0udG9Mb3dlckNhc2UoKSwgewogICAgICAgICAgICAgIHZhbHVlOiBudWxsLAogICAgICAgICAgICAgIHdyaXRhYmxlOiB0cnVlLAogICAgICAgICAgICAgIGVudW1lcmFibGU6IHRydWUsCiAgICAgICAgICAgICAgY29uZmlndXJhYmxlOiB0cnVlCiAgICAgICAgICAgIH0pOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfQogICAgfQogIH1dKTsKCiAgcmV0dXJuIFBJTVJlY29yZFNlcnZpY2U7Cn0oQ29udHJvbFNlcnZpY2UpOwoKZXhwb3J0IHsgUElNUmVjb3JkU2VydmljZSBhcyBkZWZhdWx0IH07Cgp0c2xpYl8xLl9fZGVjb3JhdGUoW0Vycm9ybG9nXSwgUElNUmVjb3JkU2VydmljZS5wcm90b3R5cGUsICJnZXROb2RlcyIsIG51bGwpOwoKdHNsaWJfMS5fX2RlY29yYXRlKFtFcnJvcmxvZ10sIFBJTVJlY29yZFNlcnZpY2UucHJvdG90eXBlLCAiZmlsbFJvb3ROb2RlcyIsIG51bGwpOwoKdHNsaWJfMS5fX2RlY29yYXRlKFtFcnJvcmxvZ10sIFBJTVJlY29yZFNlcnZpY2UucHJvdG90eXBlLCAiZmlsbFJvb3ROb2RlQ2hpbGRzIiwgbnVsbCk7Cgp0c2xpYl8xLl9fZGVjb3JhdGUoW0Vycm9ybG9nXSwgUElNUmVjb3JkU2VydmljZS5wcm90b3R5cGUsICJmaWxsU3Vib3JnTm9kZXMiLCBudWxsKTsKCnRzbGliXzEuX19kZWNvcmF0ZShbRXJyb3Jsb2ddLCBQSU1SZWNvcmRTZXJ2aWNlLnByb3RvdHlwZSwgInNlYXJjaFN1Ym9yZyIsIG51bGwpOwoKdHNsaWJfMS5fX2RlY29yYXRlKFtFcnJvcmxvZ10sIFBJTVJlY29yZFNlcnZpY2UucHJvdG90eXBlLCAiZmlsbFN1Ym9yZ05vZGVDaGlsZHMiLCBudWxsKTsKCnRzbGliXzEuX19kZWNvcmF0ZShbRXJyb3Jsb2ddLCBQSU1SZWNvcmRTZXJ2aWNlLnByb3RvdHlwZSwgImZpbGxPcm1vcmdOb2RlcyIsIG51bGwpOwoKdHNsaWJfMS5fX2RlY29yYXRlKFtFcnJvcmxvZ10sIFBJTVJlY29yZFNlcnZpY2UucHJvdG90eXBlLCAic2VhcmNoT3Jtb3JnIiwgbnVsbCk7Cgp0c2xpYl8xLl9fZGVjb3JhdGUoW0Vycm9ybG9nXSwgUElNUmVjb3JkU2VydmljZS5wcm90b3R5cGUsICJmaWxsT3Jtb3JnTm9kZUNoaWxkcyIsIG51bGwpOw=="},null]}
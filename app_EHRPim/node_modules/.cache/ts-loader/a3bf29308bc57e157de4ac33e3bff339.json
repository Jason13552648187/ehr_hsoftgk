{"remainingRequest":"F:\\crod项目\\人事管理系统2\\iBizEHR\\app_EHRPim\\node_modules\\thread-loader\\dist\\cjs.js!F:\\crod项目\\人事管理系统2\\iBizEHR\\app_EHRPim\\node_modules\\babel-loader\\lib\\index.js!F:\\crod项目\\人事管理系统2\\iBizEHR\\app_EHRPim\\node_modules\\ts-loader\\index.js??ref--14-3!F:\\crod项目\\人事管理系统2\\iBizEHR\\app_EHRPim\\node_modules\\cache-loader\\dist\\cjs.js??ref--0-0!F:\\crod项目\\人事管理系统2\\iBizEHR\\app_EHRPim\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!F:\\crod项目\\人事管理系统2\\iBizEHR\\app_EHRPim\\src\\widgets\\pim-reward-punishment\\main-grid\\main-grid-base.vue?vue&type=script&lang=tsx&","dependencies":[{"path":"F:\\crod项目\\人事管理系统2\\iBizEHR\\app_EHRPim\\src\\widgets\\pim-reward-punishment\\main-grid\\main-grid-base.vue","mtime":1630509413560},{"path":"F:\\crod项目\\人事管理系统2\\iBizEHR\\app_EHRPim\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1630511852775},{"path":"F:\\crod项目\\人事管理系统2\\iBizEHR\\app_EHRPim\\node_modules\\thread-loader\\dist\\cjs.js","mtime":1630511853252},{"path":"F:\\crod项目\\人事管理系统2\\iBizEHR\\app_EHRPim\\node_modules\\babel-loader\\lib\\index.js","mtime":1630511852747},{"path":"F:\\crod项目\\人事管理系统2\\iBizEHR\\app_EHRPim\\node_modules\\ts-loader\\index.js","mtime":1630511985412},{"path":"F:\\crod项目\\人事管理系统2\\iBizEHR\\app_EHRPim\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1630511852775},{"path":"F:\\crod项目\\人事管理系统2\\iBizEHR\\app_EHRPim\\node_modules\\vue-loader\\lib\\index.js","mtime":1630512070338}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:aW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuc3ltYm9sIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuc3ltYm9sLmRlc2NyaXB0aW9uIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuc3ltYm9sLml0ZXJhdG9yIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkuZmlsdGVyIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkuZmluZCI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLmFycmF5LmZpbmQtaW5kZXgiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5hcnJheS5mb3ItZWFjaCI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLmFycmF5LmpvaW4iOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5hcnJheS5tYXAiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5hcnJheS5zb21lIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkuc3BsaWNlIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuZnVuY3Rpb24ubmFtZSI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLm9iamVjdC5kZWZpbmUtcHJvcGVydGllcyI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLm9iamVjdC5kZWZpbmUtcHJvcGVydHkiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5vYmplY3QuZ2V0LW93bi1wcm9wZXJ0eS1kZXNjcmlwdG9yIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMub2JqZWN0LmdldC1vd24tcHJvcGVydHktZGVzY3JpcHRvcnMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5vYmplY3QuaXMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5vYmplY3Qua2V5cyI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLm9iamVjdC50by1zdHJpbmciOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5wYXJzZS1pbnQiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5yZWdleHAuZXhlYyI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLnN0cmluZy5pdGVyYXRvciI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLnN0cmluZy5yZXBsYWNlIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuc3RyaW5nLnNlYXJjaCI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLnN0cmluZy5zcGxpdCI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL3dlYi5kb20tY29sbGVjdGlvbnMuZm9yLWVhY2giOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy93ZWIuZG9tLWNvbGxlY3Rpb25zLml0ZXJhdG9yIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvd2ViLnRpbWVycyI7CmltcG9ydCBfdG9Db25zdW1hYmxlQXJyYXkgZnJvbSAiRjpcXGNyb2RcdTk4NzlcdTc2RUVcXFx1NEVCQVx1NEU4Qlx1N0JBMVx1NzQwNlx1N0NGQlx1N0VERjJcXGlCaXpFSFJcXGFwcF9FSFJQaW1cXG5vZGVfbW9kdWxlc1xcQGJhYmVsXFxydW50aW1lL2hlbHBlcnMvZXNtL3RvQ29uc3VtYWJsZUFycmF5IjsKaW1wb3J0IF9kZWZpbmVQcm9wZXJ0eSBmcm9tICJGOlxcY3JvZFx1OTg3OVx1NzZFRVxcXHU0RUJBXHU0RThCXHU3QkExXHU3NDA2XHU3Q0ZCXHU3RURGMlxcaUJpekVIUlxcYXBwX0VIUlBpbVxcbm9kZV9tb2R1bGVzXFxAYmFiZWxcXHJ1bnRpbWUvaGVscGVycy9lc20vZGVmaW5lUHJvcGVydHkiOwppbXBvcnQgInJlZ2VuZXJhdG9yLXJ1bnRpbWUvcnVudGltZSI7CmltcG9ydCBfYXN5bmNUb0dlbmVyYXRvciBmcm9tICJGOlxcY3JvZFx1OTg3OVx1NzZFRVxcXHU0RUJBXHU0RThCXHU3QkExXHU3NDA2XHU3Q0ZCXHU3RURGMlxcaUJpekVIUlxcYXBwX0VIUlBpbVxcbm9kZV9tb2R1bGVzXFxAYmFiZWxcXHJ1bnRpbWUvaGVscGVycy9lc20vYXN5bmNUb0dlbmVyYXRvciI7CmltcG9ydCBfY2xhc3NDYWxsQ2hlY2sgZnJvbSAiRjpcXGNyb2RcdTk4NzlcdTc2RUVcXFx1NEVCQVx1NEU4Qlx1N0JBMVx1NzQwNlx1N0NGQlx1N0VERjJcXGlCaXpFSFJcXGFwcF9FSFJQaW1cXG5vZGVfbW9kdWxlc1xcQGJhYmVsXFxydW50aW1lL2hlbHBlcnMvZXNtL2NsYXNzQ2FsbENoZWNrIjsKaW1wb3J0IF9jcmVhdGVDbGFzcyBmcm9tICJGOlxcY3JvZFx1OTg3OVx1NzZFRVxcXHU0RUJBXHU0RThCXHU3QkExXHU3NDA2XHU3Q0ZCXHU3RURGMlxcaUJpekVIUlxcYXBwX0VIUlBpbVxcbm9kZV9tb2R1bGVzXFxAYmFiZWxcXHJ1bnRpbWUvaGVscGVycy9lc20vY3JlYXRlQ2xhc3MiOwppbXBvcnQgX3Bvc3NpYmxlQ29uc3RydWN0b3JSZXR1cm4gZnJvbSAiRjpcXGNyb2RcdTk4NzlcdTc2RUVcXFx1NEVCQVx1NEU4Qlx1N0JBMVx1NzQwNlx1N0NGQlx1N0VERjJcXGlCaXpFSFJcXGFwcF9FSFJQaW1cXG5vZGVfbW9kdWxlc1xcQGJhYmVsXFxydW50aW1lL2hlbHBlcnMvZXNtL3Bvc3NpYmxlQ29uc3RydWN0b3JSZXR1cm4iOwppbXBvcnQgX2dldFByb3RvdHlwZU9mIGZyb20gIkY6XFxjcm9kXHU5ODc5XHU3NkVFXFxcdTRFQkFcdTRFOEJcdTdCQTFcdTc0MDZcdTdDRkJcdTdFREYyXFxpQml6RUhSXFxhcHBfRUhSUGltXFxub2RlX21vZHVsZXNcXEBiYWJlbFxccnVudGltZS9oZWxwZXJzL2VzbS9nZXRQcm90b3R5cGVPZiI7CmltcG9ydCBfaW5oZXJpdHMgZnJvbSAiRjpcXGNyb2RcdTk4NzlcdTc2RUVcXFx1NEVCQVx1NEU4Qlx1N0JBMVx1NzQwNlx1N0NGQlx1N0VERjJcXGlCaXpFSFJcXGFwcF9FSFJQaW1cXG5vZGVfbW9kdWxlc1xcQGJhYmVsXFxydW50aW1lL2hlbHBlcnMvZXNtL2luaGVyaXRzIjsKCmZ1bmN0aW9uIG93bktleXMob2JqZWN0LCBlbnVtZXJhYmxlT25seSkgeyB2YXIga2V5cyA9IE9iamVjdC5rZXlzKG9iamVjdCk7IGlmIChPYmplY3QuZ2V0T3duUHJvcGVydHlTeW1ib2xzKSB7IHZhciBzeW1ib2xzID0gT2JqZWN0LmdldE93blByb3BlcnR5U3ltYm9scyhvYmplY3QpOyBpZiAoZW51bWVyYWJsZU9ubHkpIHN5bWJvbHMgPSBzeW1ib2xzLmZpbHRlcihmdW5jdGlvbiAoc3ltKSB7IHJldHVybiBPYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yKG9iamVjdCwgc3ltKS5lbnVtZXJhYmxlOyB9KTsga2V5cy5wdXNoLmFwcGx5KGtleXMsIHN5bWJvbHMpOyB9IHJldHVybiBrZXlzOyB9CgpmdW5jdGlvbiBfb2JqZWN0U3ByZWFkKHRhcmdldCkgeyBmb3IgKHZhciBpID0gMTsgaSA8IGFyZ3VtZW50cy5sZW5ndGg7IGkrKykgeyB2YXIgc291cmNlID0gYXJndW1lbnRzW2ldICE9IG51bGwgPyBhcmd1bWVudHNbaV0gOiB7fTsgaWYgKGkgJSAyKSB7IG93bktleXMoT2JqZWN0KHNvdXJjZSksIHRydWUpLmZvckVhY2goZnVuY3Rpb24gKGtleSkgeyBfZGVmaW5lUHJvcGVydHkodGFyZ2V0LCBrZXksIHNvdXJjZVtrZXldKTsgfSk7IH0gZWxzZSBpZiAoT2JqZWN0LmdldE93blByb3BlcnR5RGVzY3JpcHRvcnMpIHsgT2JqZWN0LmRlZmluZVByb3BlcnRpZXModGFyZ2V0LCBPYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9ycyhzb3VyY2UpKTsgfSBlbHNlIHsgb3duS2V5cyhPYmplY3Qoc291cmNlKSkuZm9yRWFjaChmdW5jdGlvbiAoa2V5KSB7IE9iamVjdC5kZWZpbmVQcm9wZXJ0eSh0YXJnZXQsIGtleSwgT2JqZWN0LmdldE93blByb3BlcnR5RGVzY3JpcHRvcihzb3VyY2UsIGtleSkpOyB9KTsgfSB9IHJldHVybiB0YXJnZXQ7IH0KCmltcG9ydCAqIGFzIHRzbGliXzEgZnJvbSAidHNsaWIiOwppbXBvcnQgeyBWdWUsIENvbXBvbmVudCwgUHJvcCwgV2F0Y2ggfSBmcm9tICd2dWUtcHJvcGVydHktZGVjb3JhdG9yJzsKaW1wb3J0IFBpbVJld2FyZFB1bmlzaG1lbnRTZXJ2aWNlIGZyb20gJ0Avc2VydmljZS9waW0tcmV3YXJkLXB1bmlzaG1lbnQvcGltLXJld2FyZC1wdW5pc2htZW50LXNlcnZpY2UnOwppbXBvcnQgTWFpblNlcnZpY2UgZnJvbSAnLi9tYWluLWdyaWQtc2VydmljZSc7CmltcG9ydCBDb2RlTGlzdFNlcnZpY2UgZnJvbSAiQHNlcnZpY2UvYXBwL2NvZGVsaXN0LXNlcnZpY2UiOwppbXBvcnQgeyBGb3JtSXRlbU1vZGVsIH0gZnJvbSAnQC9tb2RlbC9mb3JtLWRldGFpbCc7Cgp2YXIgTWFpbkJhc2UgPQovKiNfX1BVUkVfXyovCmZ1bmN0aW9uIChfVnVlKSB7CiAgX2luaGVyaXRzKE1haW5CYXNlLCBfVnVlKTsKCiAgZnVuY3Rpb24gTWFpbkJhc2UoKSB7CiAgICB2YXIgX3RoaXMyOwoKICAgIF9jbGFzc0NhbGxDaGVjayh0aGlzLCBNYWluQmFzZSk7CgogICAgX3RoaXMyID0gX3Bvc3NpYmxlQ29uc3RydWN0b3JSZXR1cm4odGhpcywgX2dldFByb3RvdHlwZU9mKE1haW5CYXNlKS5hcHBseSh0aGlzLCBhcmd1bWVudHMpKTsKICAgIC8qKg0KICAgICAqIOiuoeaVsOWZqOacjeWKoeWvueixoembhuWQiA0KICAgICAqDQogICAgICogQHR5cGUge0FycmF5PCo+fQ0KICAgICAqIEBtZW1iZXJvZiBNYWluQmFzZQ0KICAgICAqLwoKICAgIF90aGlzMi5jb3VudGVyU2VydmljZUFycmF5ID0gW107CiAgICAvKioNCiAgICAgKiDlu7rmnoTpg6jku7bmnI3liqHlr7nosaENCiAgICAgKg0KICAgICAqIEB0eXBlIHtNYWluU2VydmljZX0NCiAgICAgKiBAbWVtYmVyb2YgTWFpbkJhc2UNCiAgICAgKi8KCiAgICBfdGhpczIuc2VydmljZSA9IG5ldyBNYWluU2VydmljZSh7CiAgICAgICRzdG9yZTogX3RoaXMyLiRzdG9yZQogICAgfSk7CiAgICAvKioNCiAgICAgKiDlrp7kvZPmnI3liqHlr7nosaENCiAgICAgKg0KICAgICAqIEB0eXBlIHtQaW1SZXdhcmRQdW5pc2htZW50U2VydmljZX0NCiAgICAgKiBAbWVtYmVyb2YgTWFpbkJhc2UNCiAgICAgKi8KCiAgICBfdGhpczIuYXBwRW50aXR5U2VydmljZSA9IG5ldyBQaW1SZXdhcmRQdW5pc2htZW50U2VydmljZSh7CiAgICAgICRzdG9yZTogX3RoaXMyLiRzdG9yZQogICAgfSk7CiAgICAvKioNCiAgICAgKiDku6PnoIHooajmnI3liqHlr7nosaENCiAgICAgKg0KICAgICAqIEB0eXBlIHtDb2RlTGlzdFNlcnZpY2V9DQogICAgICogQG1lbWJlcm9mIE1haW5CYXNlDQogICAgICovCgogICAgX3RoaXMyLmNvZGVMaXN0U2VydmljZSA9IG5ldyBDb2RlTGlzdFNlcnZpY2UoewogICAgICAkc3RvcmU6IF90aGlzMi4kc3RvcmUKICAgIH0pOwogICAgLyoqDQogICAgICog5b2T5YmN6aG1DQogICAgICoNCiAgICAgKiBAdHlwZSB7bnVtYmVyfQ0KICAgICAqIEBtZW1iZXJvZiBNYWluQmFzZQ0KICAgICAqLwoKICAgIF90aGlzMi5jdXJQYWdlID0gMTsKICAgIC8qKg0KICAgICAqIOaVsOaNrg0KICAgICAqDQogICAgICogQHR5cGUge2FueVtdfQ0KICAgICAqIEBtZW1iZXJvZiBNYWluQmFzZQ0KICAgICAqLwoKICAgIF90aGlzMi5pdGVtcyA9IFtdOwogICAgLyoqDQogICAgICog5piv5ZCm5pSv5oyB5YiG6aG1DQogICAgICoNCiAgICAgKiBAdHlwZSB7Ym9vbGVhbn0NCiAgICAgKiBAbWVtYmVyb2YgTWFpbkJhc2UNCiAgICAgKi8KCiAgICBfdGhpczIuaXNFbmFibGVQYWdpbmdCYXIgPSB0cnVlOwogICAgLyoqDQogICAgICog5piv5ZCm56aB55So5o6S5bqPDQogICAgICoNCiAgICAgKiBAdHlwZSB7Ym9vbGVhbn0NCiAgICAgKiBAbWVtYmVyb2YgTWFpbkJhc2UNCiAgICAgKi8KCiAgICBfdGhpczIuaXNOb1NvcnQgPSBmYWxzZTsKICAgIC8qKg0KICAgICAqIOaOkuW6j+aWueWQkQ0KICAgICAqDQogICAgICogQHR5cGUge3N0cmluZ30NCiAgICAgKiBAbWVtYmVyb2YgTWFpbkJhc2UNCiAgICAgKi8KCiAgICBfdGhpczIubWlub3JTb3J0RGlyID0gJyc7CiAgICAvKioNCiAgICAgKiDmjpLluo/lrZfmrrUNCiAgICAgKg0KICAgICAqIEB0eXBlIHtzdHJpbmd9DQogICAgICogQG1lbWJlcm9mIE1haW5CYXNlDQogICAgICovCgogICAgX3RoaXMyLm1pbm9yU29ydFBTREVGID0gJyc7CiAgICAvKioNCiAgICAgKiDliIbpobXmnaHmlbANCiAgICAgKg0KICAgICAqIEB0eXBlIHtudW1iZXJ9DQogICAgICogQG1lbWJlcm9mIE1haW5CYXNlDQogICAgICovCgogICAgX3RoaXMyLmxpbWl0ID0gMjA7CiAgICAvKioNCiAgICAgKiDmmK/lkKbmmL7npLrmoIfpopgNCiAgICAgKg0KICAgICAqIEB0eXBlIHtib29sZWFufQ0KICAgICAqIEBtZW1iZXJvZiBNYWluQmFzZQ0KICAgICAqLwoKICAgIF90aGlzMi5pc0hpZGVIZWFkZXIgPSBmYWxzZTsKICAgIC8qKg0KICAgICAqIOWunumZheaYr+WQpuW8gOWQr+ihjOe8lui+kQ0KICAgICAqDQogICAgICogQHR5cGUge2Jvb2xlYW59DQogICAgICogQG1lbWJlcm9mIE1haW5CYXNlDQogICAgICovCgogICAgX3RoaXMyLmFjdHVhbElzT3BlbkVkaXQgPSBfdGhpczIuaXNPcGVuRWRpdDsKICAgIC8qKg0KICAgICAqIOaAu+adoeaVsA0KICAgICAqDQogICAgICogQHR5cGUge251bWJlcn0NCiAgICAgKiBAbWVtYmVyb2YgTWFpbkJhc2UNCiAgICAgKi8KCiAgICBfdGhpczIudG90YWxyb3cgPSAwOwogICAgLyoqDQogICAgICog6YCJ5Lit6KGM5pWw5o2uDQogICAgICoNCiAgICAgKiBAdHlwZSB7YW55W119DQogICAgICogQG1lbWJlcm9mIE1haW4NCiAgICAgKi8KCiAgICBfdGhpczIuc2VsZWN0aW9ucyA9IFtdOwogICAgLyoqDQogICAgICog5oum5oiq6KGM6YCJ5LitDQogICAgICoNCiAgICAgKiBAdHlwZSB7Ym9vbGVhbn0NCiAgICAgKiBAbWVtYmVyb2YgTWFpbg0KICAgICAqLwoKICAgIF90aGlzMi5zdG9wUm93Q2xpY2sgPSBmYWxzZTsKICAgIC8qKg0KICAgICAqIOihqOagvOaYr+WQpuaYvuekug0KICAgICAqDQogICAgICogQHR5cGUge2Jvb2xlYW59DQogICAgICogQG1lbWJlcm9mIE1haW5CYXNlDQogICAgICovCgogICAgX3RoaXMyLmlzRGlzcGxheSA9IHRydWU7CiAgICAvKioNCiAgICAqIOmAiemhueahhuWIl+WuvQ0KICAgICoNCiAgICAqIEB0eXBlIHtudW1iZXJ9DQogICAgKiBAbWVtYmVyb2YgQXBwSW5kZXgNCiAgICAqLwoKICAgIF90aGlzMi5jaGVja2JveENvbFdpZHRoID0gMzQ7CiAgICAvKioNCiAgICAgKiDmmK/lkKblhYHorrjmi5bliqjliJflrr0NCiAgICAgKg0KICAgICAqIEB0eXBlIHtib29sZWFufQ0KICAgICAqIEBtZW1iZXJvZiBBcHBFbWJlZFBpY2tlcg0KICAgICAqLwoKICAgIF90aGlzMi5pc0RyYWdlbmRDb2wgPSBmYWxzZTsKICAgIC8qKg0KICAgICAqIOaJgOacieWIl+aIkOWRmA0KICAgICAqDQogICAgICogQHR5cGUge2FueVtdfQ0KICAgICAqIEBtZW1iZXJvZiBNYWluQmFzZQ0KICAgICAqLwoKICAgIF90aGlzMi5hbGxDb2x1bW5zID0gW3sKICAgICAgbmFtZTogJ2psc2onLAogICAgICBsYWJlbDogJ+iOt+WPluaXtumXtCcsCiAgICAgIGxhbmd0YWc6ICdlbnRpdGllcy5waW1yZXdhcmRwdW5pc2htZW50Lm1haW5fZ3JpZC5jb2x1bW5zLmpsc2onLAogICAgICBzaG93OiB0cnVlLAogICAgICB1dGlsOiAnUFgnCiAgICB9LCB7CiAgICAgIG5hbWU6ICdwaW1yZXdhcmRwdW5pc2htZW50bmFtZScsCiAgICAgIGxhYmVsOiAn5ZCN56ewJywKICAgICAgbGFuZ3RhZzogJ2VudGl0aWVzLnBpbXJld2FyZHB1bmlzaG1lbnQubWFpbl9ncmlkLmNvbHVtbnMucGltcmV3YXJkcHVuaXNobWVudG5hbWUnLAogICAgICBzaG93OiB0cnVlLAogICAgICB1dGlsOiAnUFgnCiAgICB9LCB7CiAgICAgIG5hbWU6ICdseCcsCiAgICAgIGxhYmVsOiAn5aWW5oOp5YiG57G7JywKICAgICAgbGFuZ3RhZzogJ2VudGl0aWVzLnBpbXJld2FyZHB1bmlzaG1lbnQubWFpbl9ncmlkLmNvbHVtbnMubHgnLAogICAgICBzaG93OiB0cnVlLAogICAgICB1dGlsOiAncHgnCiAgICB9LCB7CiAgICAgIG5hbWU6ICdkZXBhcnRtZW50JywKICAgICAgbGFiZWw6ICfmjojkuojljZXkvY0nLAogICAgICBsYW5ndGFnOiAnZW50aXRpZXMucGltcmV3YXJkcHVuaXNobWVudC5tYWluX2dyaWQuY29sdW1ucy5kZXBhcnRtZW50JywKICAgICAgc2hvdzogdHJ1ZSwKICAgICAgdXRpbDogJ3B4JwogICAgfV07CiAgICAvKioNCiAgICAgKiDooajmoLzmqKHlnovpm4blkIgNCiAgICAgKg0KICAgICAqIEB0eXBlIHsqfQ0KICAgICAqIEBtZW1iZXJvZiBNYWluQmFzZQ0KICAgICAqLwoKICAgIF90aGlzMi5ncmlkSXRlbXNNb2RlbCA9IFtdOwogICAgLyoqDQogICAgICog5bGe5oCn5YC86KeE5YiZDQogICAgICoNCiAgICAgKiBAdHlwZSB7Kn0NCiAgICAgKiBAbWVtYmVyb2YgTWFpbkJhc2UNCiAgICAgKi8KCiAgICBfdGhpczIucnVsZXMgPSB7CiAgICAgIHNyZmtleTogW3sKICAgICAgICByZXF1aXJlZDogZmFsc2UsCiAgICAgICAgdmFsaWRhdG9yOiBmdW5jdGlvbiB2YWxpZGF0b3IocnVsZSwgdmFsdWUsIGNhbGxiYWNrKSB7CiAgICAgICAgICByZXR1cm4gcnVsZS5yZXF1aXJlZCAmJiAodmFsdWUgPT09IG51bGwgfHwgdmFsdWUgPT09IHVuZGVmaW5lZCB8fCB2YWx1ZSA9PT0gIiIpID8gZmFsc2UgOiB0cnVlOwogICAgICAgIH0sCiAgICAgICAgbWVzc2FnZTogJ+WlluWKseaDqee9muagh+ivhiDlgLzkuI3og73kuLrnqbonLAogICAgICAgIHRyaWdnZXI6ICdjaGFuZ2UnCiAgICAgIH0sIHsKICAgICAgICByZXF1aXJlZDogZmFsc2UsCiAgICAgICAgdmFsaWRhdG9yOiBmdW5jdGlvbiB2YWxpZGF0b3IocnVsZSwgdmFsdWUsIGNhbGxiYWNrKSB7CiAgICAgICAgICByZXR1cm4gcnVsZS5yZXF1aXJlZCAmJiAodmFsdWUgPT09IG51bGwgfHwgdmFsdWUgPT09IHVuZGVmaW5lZCB8fCB2YWx1ZSA9PT0gIiIpID8gZmFsc2UgOiB0cnVlOwogICAgICAgIH0sCiAgICAgICAgbWVzc2FnZTogJ+WlluWKseaDqee9muagh+ivhiDlgLzkuI3og73kuLrnqbonLAogICAgICAgIHRyaWdnZXI6ICdibHVyJwogICAgICB9XQogICAgfTsKICAgIHJldHVybiBfdGhpczI7CiAgfQogIC8qKg0KICAgKiDojrflj5bpg6jku7bnsbvlnosNCiAgICoNCiAgICogQHJldHVybnMge3N0cmluZ30NCiAgICogQG1lbWJlcm9mIE1haW5CYXNlDQogICAqLwoKCiAgX2NyZWF0ZUNsYXNzKE1haW5CYXNlLCBbewogICAga2V5OiAiZ2V0Q29udHJvbFR5cGUiLAogICAgdmFsdWU6IGZ1bmN0aW9uIGdldENvbnRyb2xUeXBlKCkgewogICAgICByZXR1cm4gJ0dSSUQnOwogICAgfQogICAgLyoqDQogICAgICog5YWz6Zet6KeG5Zu+DQogICAgICoNCiAgICAgKiBAcGFyYW0ge2FueX0gYXJncw0KICAgICAqIEBtZW1iZXJvZiBNYWluQmFzZQ0KICAgICAqLwoKICB9LCB7CiAgICBrZXk6ICJjbG9zZVZpZXciLAogICAgdmFsdWU6IGZ1bmN0aW9uIGNsb3NlVmlldyhhcmdzKSB7CiAgICAgIHZhciBfdGhpcyA9IHRoaXM7CgogICAgICBfdGhpcy4kZW1pdCgnY2xvc2V2aWV3JywgW2FyZ3NdKTsKICAgIH0KICAgIC8qKg0KICAgICAqICDorqHmlbDlmajliLfmlrANCiAgICAgKg0KICAgICAqIEBtZW1iZXJvZiBNYWluQmFzZQ0KICAgICAqLwoKICB9LCB7CiAgICBrZXk6ICJjb3VudGVyUmVmcmVzaCIsCiAgICB2YWx1ZTogZnVuY3Rpb24gY291bnRlclJlZnJlc2goKSB7CiAgICAgIHZhciBfdGhpcyA9IHRoaXM7CgogICAgICBpZiAoX3RoaXMuY291bnRlclNlcnZpY2VBcnJheSAmJiBfdGhpcy5jb3VudGVyU2VydmljZUFycmF5Lmxlbmd0aCA+IDApIHsKICAgICAgICBfdGhpcy5jb3VudGVyU2VydmljZUFycmF5LmZvckVhY2goZnVuY3Rpb24gKGl0ZW0pIHsKICAgICAgICAgIGlmIChpdGVtLnJlZnJlc2hEYXRhICYmIGl0ZW0ucmVmcmVzaERhdGEgaW5zdGFuY2VvZiBGdW5jdGlvbikgewogICAgICAgICAgICBpdGVtLnJlZnJlc2hEYXRhKCk7CiAgICAgICAgICB9CiAgICAgICAgfSk7CiAgICAgIH0KICAgIH0KICAgIC8qKg0KICAgICAqIOiOt+WPluWkmumhueaVsOaNrg0KICAgICAqDQogICAgICogQHJldHVybnMge2FueVtdfQ0KICAgICAqIEBtZW1iZXJvZiBNYWluQmFzZQ0KICAgICAqLwoKICB9LCB7CiAgICBrZXk6ICJnZXREYXRhcyIsCiAgICB2YWx1ZTogZnVuY3Rpb24gZ2V0RGF0YXMoKSB7CiAgICAgIHJldHVybiB0aGlzLnNlbGVjdGlvbnM7CiAgICB9CiAgICAvKioNCiAgICAgKiDojrflj5bljZXpobnmoJENCiAgICAgKg0KICAgICAqIEByZXR1cm5zIHsqfQ0KICAgICAqIEBtZW1iZXJvZiBNYWluQmFzZQ0KICAgICAqLwoKICB9LCB7CiAgICBrZXk6ICJnZXREYXRhIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBnZXREYXRhKCkgewogICAgICByZXR1cm4gdGhpcy5zZWxlY3Rpb25zWzBdOwogICAgfQogICAgLyoqDQogICAgICog6YCJ5Lit5YC85Y+Y5YyWDQogICAgICoNCiAgICAgKiBAcGFyYW0geyp9IG5ld1ZhbA0KICAgICAqIEBwYXJhbSB7Kn0gb2xkVmFsDQogICAgICogQG1lbWJlcm9mIE1haW5CYXNlDQogICAgICovCgogIH0sIHsKICAgIGtleTogIm9uVmFsdWVDaGFuZ2UiLAogICAgdmFsdWU6IGZ1bmN0aW9uIG9uVmFsdWVDaGFuZ2UobmV3VmFsLCBvbGRWYWwpIHsKICAgICAgdmFyIF90aGlzMyA9IHRoaXM7CgogICAgICB0aGlzLnNlbGVjdGlvbnMgPSBbXTsKCiAgICAgIGlmICh0aGlzLnNlbGVjdGVkRGF0YSkgewogICAgICAgIHZhciByZWZzID0gdGhpcy4kcmVmczsKCiAgICAgICAgaWYgKHJlZnMubXVsdGlwbGVUYWJsZSkgewogICAgICAgICAgcmVmcy5tdWx0aXBsZVRhYmxlLmNsZWFyU2VsZWN0aW9uKCk7CiAgICAgICAgICBKU09OLnBhcnNlKHRoaXMuc2VsZWN0ZWREYXRhKS5mb3JFYWNoKGZ1bmN0aW9uIChzZWxlY3Rpb24pIHsKICAgICAgICAgICAgdmFyIHNlbGVjdGVkSXRlbSA9IF90aGlzMy5pdGVtcy5maW5kKGZ1bmN0aW9uIChpdGVtKSB7CiAgICAgICAgICAgICAgcmV0dXJuIE9iamVjdC5pcyhpdGVtLnNyZmtleSwgc2VsZWN0aW9uLnNyZmtleSk7CiAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgaWYgKHNlbGVjdGVkSXRlbSkgewogICAgICAgICAgICAgIF90aGlzMy5yb3dDbGljayhzZWxlY3RlZEl0ZW0pOwogICAgICAgICAgICB9CiAgICAgICAgICB9KTsKICAgICAgICB9CiAgICAgIH0KICAgIH0KICAgIC8qKg0KICAgICAqIOmDqOS7tuWIt+aWsA0KICAgICAqDQogICAgICogQHBhcmFtIHthbnlbXX0gYXJncw0KICAgICAqIEBtZW1iZXJvZiBNYWluQmFzZQ0KICAgICAqLwoKICB9LCB7CiAgICBrZXk6ICJyZWZyZXNoIiwKICAgIHZhbHVlOiBmdW5jdGlvbiByZWZyZXNoKGFyZ3MpIHsKICAgICAgdGhpcy5sb2FkKCk7CiAgICB9CiAgICAvKioNCiAgICAgKiDojrflj5booajmoLzooYzmqKHlnosNCiAgICAgKg0KICAgICAqIEB0eXBlIHsqfQ0KICAgICAqIEBtZW1iZXJvZiBNYWluQmFzZQ0KICAgICAqLwoKICB9LCB7CiAgICBrZXk6ICJnZXRHcmlkUm93TW9kZWwiLAogICAgdmFsdWU6IGZ1bmN0aW9uIGdldEdyaWRSb3dNb2RlbCgpIHsKICAgICAgcmV0dXJuIHsKICAgICAgICBzcmZrZXk6IG5ldyBGb3JtSXRlbU1vZGVsKCkKICAgICAgfTsKICAgIH0KICAgIC8qKg0KICAgICAqIOihqOagvOihjOe8lui+kemhueagoemqjA0KICAgICAqDQogICAgICogQHBhcmFtIHtzdHJpbmd9IHByb3BlcnR5IOWxnuaAp+WQjQ0KICAgICAqIEBwYXJhbSB7Kn0gZGF0YSDooYzmlbDmja4NCiAgICAgKiBAcGFyYW0ge251bWJlcn0gcm93SW5kZXgg6KGM57Si5byVDQogICAgICogQHJldHVybnMgUHJvbWlzZTxhbnk+DQogICAgICoNCiAgICAgKiBAbWVtYmVyb2YgTWFpbkJhc2UNCiAgICAgKi8KCiAgfSwgewogICAga2V5OiAidmFsaWRhdGUiLAogICAgdmFsdWU6IGZ1bmN0aW9uIHZhbGlkYXRlKHByb3BlcnR5LCBkYXRhLCByb3dJbmRleCkgewogICAgICB2YXIgX3RoaXM0ID0gdGhpczsKCiAgICAgIHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbiAocmVzb2x2ZSwgcmVqZWN0KSB7CiAgICAgICAgX3RoaXM0LiR1dGlsLnZhbGlkYXRlSXRlbShwcm9wZXJ0eSwgZGF0YSwgX3RoaXM0LnJ1bGVzKS50aGVuKGZ1bmN0aW9uICgpIHsKICAgICAgICAgIF90aGlzNC5ncmlkSXRlbXNNb2RlbFtyb3dJbmRleF1bcHJvcGVydHldLnNldEVycm9yKG51bGwpOwoKICAgICAgICAgIHJlc29sdmUodHJ1ZSk7CiAgICAgICAgfSlbImNhdGNoIl0oZnVuY3Rpb24gKF9yZWYpIHsKICAgICAgICAgIHZhciBlcnJvcnMgPSBfcmVmLmVycm9ycywKICAgICAgICAgICAgICBmaWVsZHMgPSBfcmVmLmZpZWxkczsKCiAgICAgICAgICBfdGhpczQuZ3JpZEl0ZW1zTW9kZWxbcm93SW5kZXhdW3Byb3BlcnR5XS5zZXRFcnJvcihlcnJvcnNbMF0ubWVzc2FnZSk7CgogICAgICAgICAgcmVzb2x2ZShmYWxzZSk7CiAgICAgICAgfSk7CiAgICAgIH0pOwogICAgfQogICAgLyoqDQogICAgICog5qCh6aqM5omA5pyJ5L+u5pS56L+H55qE57yW6L6R6aG5DQogICAgICoNCiAgICAgKiBAcmV0dXJucyBQcm9taXNlPGFueT4NCiAgICAgKiBAbWVtYmVyb2YgTWFpbkJhc2UNCiAgICAgKi8KCiAgfSwgewogICAga2V5OiAidmFsaWRhdGVBbGwiLAogICAgdmFsdWU6IGZ1bmN0aW9uICgpIHsKICAgICAgdmFyIF92YWxpZGF0ZUFsbCA9IF9hc3luY1RvR2VuZXJhdG9yKAogICAgICAvKiNfX1BVUkVfXyovCiAgICAgIHJlZ2VuZXJhdG9yUnVudGltZS5tYXJrKGZ1bmN0aW9uIF9jYWxsZWUoKSB7CiAgICAgICAgdmFyIHZhbGlkYXRlU3RhdGUsIGluZGV4LCBfaXRlcmF0b3JOb3JtYWxDb21wbGV0aW9uLCBfZGlkSXRlcmF0b3JFcnJvciwgX2l0ZXJhdG9yRXJyb3IsIF9pdGVyYXRvciwgX3N0ZXAsIGl0ZW0sIF9pLCBfT2JqZWN0JGtleXMsIHByb3BlcnR5OwoKICAgICAgICByZXR1cm4gcmVnZW5lcmF0b3JSdW50aW1lLndyYXAoZnVuY3Rpb24gX2NhbGxlZSQoX2NvbnRleHQpIHsKICAgICAgICAgIHdoaWxlICgxKSB7CiAgICAgICAgICAgIHN3aXRjaCAoX2NvbnRleHQucHJldiA9IF9jb250ZXh0Lm5leHQpIHsKICAgICAgICAgICAgICBjYXNlIDA6CiAgICAgICAgICAgICAgICB2YWxpZGF0ZVN0YXRlID0gdHJ1ZTsKICAgICAgICAgICAgICAgIGluZGV4ID0gLTE7CiAgICAgICAgICAgICAgICBfaXRlcmF0b3JOb3JtYWxDb21wbGV0aW9uID0gdHJ1ZTsKICAgICAgICAgICAgICAgIF9kaWRJdGVyYXRvckVycm9yID0gZmFsc2U7CiAgICAgICAgICAgICAgICBfaXRlcmF0b3JFcnJvciA9IHVuZGVmaW5lZDsKICAgICAgICAgICAgICAgIF9jb250ZXh0LnByZXYgPSA1OwogICAgICAgICAgICAgICAgX2l0ZXJhdG9yID0gdGhpcy5pdGVtc1tTeW1ib2wuaXRlcmF0b3JdKCk7CgogICAgICAgICAgICAgIGNhc2UgNzoKICAgICAgICAgICAgICAgIGlmIChfaXRlcmF0b3JOb3JtYWxDb21wbGV0aW9uID0gKF9zdGVwID0gX2l0ZXJhdG9yLm5leHQoKSkuZG9uZSkgewogICAgICAgICAgICAgICAgICBfY29udGV4dC5uZXh0ID0gMjQ7CiAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIGl0ZW0gPSBfc3RlcC52YWx1ZTsKICAgICAgICAgICAgICAgIGluZGV4Kys7CgogICAgICAgICAgICAgICAgaWYgKCEoaXRlbS5yb3dEYXRhU3RhdGUgPT09ICJjcmVhdGUiIHx8IGl0ZW0ucm93RGF0YVN0YXRlID09PSAidXBkYXRlIikpIHsKICAgICAgICAgICAgICAgICAgX2NvbnRleHQubmV4dCA9IDIxOwogICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBfaSA9IDAsIF9PYmplY3Qka2V5cyA9IE9iamVjdC5rZXlzKHRoaXMucnVsZXMpOwoKICAgICAgICAgICAgICBjYXNlIDEyOgogICAgICAgICAgICAgICAgaWYgKCEoX2kgPCBfT2JqZWN0JGtleXMubGVuZ3RoKSkgewogICAgICAgICAgICAgICAgICBfY29udGV4dC5uZXh0ID0gMjE7CiAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIHByb3BlcnR5ID0gX09iamVjdCRrZXlzW19pXTsKICAgICAgICAgICAgICAgIF9jb250ZXh0Lm5leHQgPSAxNjsKICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLnZhbGlkYXRlKHByb3BlcnR5LCBpdGVtLCBpbmRleCk7CgogICAgICAgICAgICAgIGNhc2UgMTY6CiAgICAgICAgICAgICAgICBpZiAoX2NvbnRleHQuc2VudCkgewogICAgICAgICAgICAgICAgICBfY29udGV4dC5uZXh0ID0gMTg7CiAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIHZhbGlkYXRlU3RhdGUgPSBmYWxzZTsKCiAgICAgICAgICAgICAgY2FzZSAxODoKICAgICAgICAgICAgICAgIF9pKys7CiAgICAgICAgICAgICAgICBfY29udGV4dC5uZXh0ID0gMTI7CiAgICAgICAgICAgICAgICBicmVhazsKCiAgICAgICAgICAgICAgY2FzZSAyMToKICAgICAgICAgICAgICAgIF9pdGVyYXRvck5vcm1hbENvbXBsZXRpb24gPSB0cnVlOwogICAgICAgICAgICAgICAgX2NvbnRleHQubmV4dCA9IDc7CiAgICAgICAgICAgICAgICBicmVhazsKCiAgICAgICAgICAgICAgY2FzZSAyNDoKICAgICAgICAgICAgICAgIF9jb250ZXh0Lm5leHQgPSAzMDsKICAgICAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgICAgICBjYXNlIDI2OgogICAgICAgICAgICAgICAgX2NvbnRleHQucHJldiA9IDI2OwogICAgICAgICAgICAgICAgX2NvbnRleHQudDAgPSBfY29udGV4dFsiY2F0Y2giXSg1KTsKICAgICAgICAgICAgICAgIF9kaWRJdGVyYXRvckVycm9yID0gdHJ1ZTsKICAgICAgICAgICAgICAgIF9pdGVyYXRvckVycm9yID0gX2NvbnRleHQudDA7CgogICAgICAgICAgICAgIGNhc2UgMzA6CiAgICAgICAgICAgICAgICBfY29udGV4dC5wcmV2ID0gMzA7CiAgICAgICAgICAgICAgICBfY29udGV4dC5wcmV2ID0gMzE7CgogICAgICAgICAgICAgICAgaWYgKCFfaXRlcmF0b3JOb3JtYWxDb21wbGV0aW9uICYmIF9pdGVyYXRvclsicmV0dXJuIl0gIT0gbnVsbCkgewogICAgICAgICAgICAgICAgICBfaXRlcmF0b3JbInJldHVybiJdKCk7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgIGNhc2UgMzM6CiAgICAgICAgICAgICAgICBfY29udGV4dC5wcmV2ID0gMzM7CgogICAgICAgICAgICAgICAgaWYgKCFfZGlkSXRlcmF0b3JFcnJvcikgewogICAgICAgICAgICAgICAgICBfY29udGV4dC5uZXh0ID0gMzY7CiAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIHRocm93IF9pdGVyYXRvckVycm9yOwoKICAgICAgICAgICAgICBjYXNlIDM2OgogICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0LmZpbmlzaCgzMyk7CgogICAgICAgICAgICAgIGNhc2UgMzc6CiAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQuZmluaXNoKDMwKTsKCiAgICAgICAgICAgICAgY2FzZSAzODoKICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dC5hYnJ1cHQoInJldHVybiIsIHZhbGlkYXRlU3RhdGUpOwoKICAgICAgICAgICAgICBjYXNlIDM5OgogICAgICAgICAgICAgIGNhc2UgImVuZCI6CiAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQuc3RvcCgpOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSwgX2NhbGxlZSwgdGhpcywgW1s1LCAyNiwgMzAsIDM4XSwgWzMxLCwgMzMsIDM3XV0pOwogICAgICB9KSk7CgogICAgICBmdW5jdGlvbiB2YWxpZGF0ZUFsbCgpIHsKICAgICAgICByZXR1cm4gX3ZhbGlkYXRlQWxsLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7CiAgICAgIH0KCiAgICAgIHJldHVybiB2YWxpZGF0ZUFsbDsKICAgIH0oKQogICAgLyoqDQogICAgICog6KGo5qC85pWw5o2u5Yqg6L29DQogICAgICoNCiAgICAgKiBAcGFyYW0geyp9IFthcmc9e31dDQogICAgICogQG1lbWJlcm9mIE1haW5CYXNlDQogICAgICovCgogIH0sIHsKICAgIGtleTogImxvYWQiLAogICAgdmFsdWU6IGZ1bmN0aW9uIGxvYWQoKSB7CiAgICAgIHZhciBfdGhpczUgPSB0aGlzOwoKICAgICAgdmFyIG9wdCA9IGFyZ3VtZW50cy5sZW5ndGggPiAwICYmIGFyZ3VtZW50c1swXSAhPT0gdW5kZWZpbmVkID8gYXJndW1lbnRzWzBdIDoge307CiAgICAgIHZhciBwYWdlUmVzZXQgPSBhcmd1bWVudHMubGVuZ3RoID4gMSAmJiBhcmd1bWVudHNbMV0gIT09IHVuZGVmaW5lZCA/IGFyZ3VtZW50c1sxXSA6IGZhbHNlOwoKICAgICAgaWYgKCF0aGlzLmZldGNoQWN0aW9uKSB7CiAgICAgICAgdGhpcy4kTm90aWNlLmVycm9yKHsKICAgICAgICAgIHRpdGxlOiAn6ZSZ6K+vJywKICAgICAgICAgIGRlc2M6ICdQSU1SRVdBUkRQVU5JU0hNRU5UUGltSmFuZ2xHcmlkVmlld+inhuWbvuihqOagvGZldGNoQWN0aW9u5Y+C5pWw5pyq6YWN572uJwogICAgICAgIH0pOwogICAgICAgIHJldHVybjsKICAgICAgfQoKICAgICAgaWYgKHBhZ2VSZXNldCkgewogICAgICAgIHRoaXMuY3VyUGFnZSA9IDE7CiAgICAgIH0KCiAgICAgIHZhciBhcmcgPSBfb2JqZWN0U3ByZWFkKHt9LCBvcHQpOwoKICAgICAgdmFyIHBhZ2UgPSB7fTsKCiAgICAgIGlmICh0aGlzLmlzRW5hYmxlUGFnaW5nQmFyKSB7CiAgICAgICAgT2JqZWN0LmFzc2lnbihwYWdlLCB7CiAgICAgICAgICBwYWdlOiB0aGlzLmN1clBhZ2UgLSAxLAogICAgICAgICAgc2l6ZTogdGhpcy5saW1pdAogICAgICAgIH0pOwogICAgICB9IC8vIOiuvue9ruaOkuW6jwoKCiAgICAgIGlmICghdGhpcy5pc05vU29ydCAmJiAhT2JqZWN0LmlzKHRoaXMubWlub3JTb3J0RGlyLCAnJykgJiYgIU9iamVjdC5pcyh0aGlzLm1pbm9yU29ydFBTREVGLCAnJykpIHsKICAgICAgICB2YXIgc29ydCA9IHRoaXMubWlub3JTb3J0UFNERUYgKyAiLCIgKyB0aGlzLm1pbm9yU29ydERpcjsKICAgICAgICBPYmplY3QuYXNzaWduKHBhZ2UsIHsKICAgICAgICAgIHNvcnQ6IHNvcnQKICAgICAgICB9KTsKICAgICAgfQoKICAgICAgT2JqZWN0LmFzc2lnbihhcmcsIHBhZ2UpOwogICAgICB2YXIgcGFyZW50ZGF0YSA9IHt9OwogICAgICB0aGlzLiRlbWl0KCdiZWZvcmVsb2FkJywgcGFyZW50ZGF0YSk7CiAgICAgIE9iamVjdC5hc3NpZ24oYXJnLCBwYXJlbnRkYXRhKTsKICAgICAgdmFyIHRlbXBWaWV3UGFyYW1zID0gcGFyZW50ZGF0YS52aWV3cGFyYW1zID8gcGFyZW50ZGF0YS52aWV3cGFyYW1zIDoge307CiAgICAgIE9iamVjdC5hc3NpZ24odGVtcFZpZXdQYXJhbXMsIEpTT04ucGFyc2UoSlNPTi5zdHJpbmdpZnkodGhpcy52aWV3cGFyYW1zKSkpOwogICAgICBPYmplY3QuYXNzaWduKGFyZywgewogICAgICAgIHZpZXdwYXJhbXM6IHRlbXBWaWV3UGFyYW1zCiAgICAgIH0pOwogICAgICB2YXIgcG9zdCA9IHRoaXMuc2VydmljZS5zZWFyY2godGhpcy5mZXRjaEFjdGlvbiwgSlNPTi5wYXJzZShKU09OLnN0cmluZ2lmeSh0aGlzLmNvbnRleHQpKSwgYXJnLCB0aGlzLnNob3dCdXN5SW5kaWNhdG9yKTsKICAgICAgcG9zdC50aGVuKGZ1bmN0aW9uIChyZXNwb25zZSkgewogICAgICAgIGlmICghcmVzcG9uc2Uuc3RhdHVzIHx8IHJlc3BvbnNlLnN0YXR1cyAhPT0gMjAwKSB7CiAgICAgICAgICBpZiAocmVzcG9uc2UuZXJyb3JNZXNzYWdlKSB7CiAgICAgICAgICAgIF90aGlzNS4kTm90aWNlLmVycm9yKHsKICAgICAgICAgICAgICB0aXRsZTogJ+mUmeivrycsCiAgICAgICAgICAgICAgZGVzYzogcmVzcG9uc2UuZXJyb3JNZXNzYWdlCiAgICAgICAgICAgIH0pOwogICAgICAgICAgfQoKICAgICAgICAgIHJldHVybjsKICAgICAgICB9CgogICAgICAgIHZhciBkYXRhID0gcmVzcG9uc2UuZGF0YTsKICAgICAgICBfdGhpczUudG90YWxyb3cgPSByZXNwb25zZS50b3RhbDsKICAgICAgICBfdGhpczUuaXRlbXMgPSBKU09OLnBhcnNlKEpTT04uc3RyaW5naWZ5KGRhdGEpKTsgLy8g5riF56m6c2VsZWN0aW9ucyxncmlkSXRlbXNNb2RlbAoKICAgICAgICBfdGhpczUuc2VsZWN0aW9ucyA9IFtdOwogICAgICAgIF90aGlzNS5ncmlkSXRlbXNNb2RlbCA9IFtdOwoKICAgICAgICBfdGhpczUuaXRlbXMuZm9yRWFjaChmdW5jdGlvbiAoKSB7CiAgICAgICAgICBfdGhpczUuZ3JpZEl0ZW1zTW9kZWwucHVzaChfdGhpczUuZ2V0R3JpZFJvd01vZGVsKCkpOwogICAgICAgIH0pOwoKICAgICAgICBfdGhpczUuJGVtaXQoJ2xvYWQnLCBfdGhpczUuaXRlbXMpOyAvLyDorr7nva7pu5jorqTpgInkuK0KCgogICAgICAgIHZhciBfdGhpcyA9IF90aGlzNTsKICAgICAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHsKICAgICAgICAgIGlmIChfdGhpcy5pc1NlbGVjdEZpcnN0RGVmYXVsdCkgewogICAgICAgICAgICBfdGhpcy5yb3dDbGljayhfdGhpcy5pdGVtc1swXSk7CiAgICAgICAgICB9CgogICAgICAgICAgaWYgKF90aGlzLnNlbGVjdGVkRGF0YSkgewogICAgICAgICAgICB2YXIgcmVmcyA9IF90aGlzLiRyZWZzOwoKICAgICAgICAgICAgaWYgKHJlZnMubXVsdGlwbGVUYWJsZSkgewogICAgICAgICAgICAgIHJlZnMubXVsdGlwbGVUYWJsZS5jbGVhclNlbGVjdGlvbigpOwogICAgICAgICAgICAgIEpTT04ucGFyc2UoX3RoaXMuc2VsZWN0ZWREYXRhKS5mb3JFYWNoKGZ1bmN0aW9uIChzZWxlY3Rpb24pIHsKICAgICAgICAgICAgICAgIHZhciBzZWxlY3RlZEl0ZW0gPSBfdGhpcy5pdGVtcy5maW5kKGZ1bmN0aW9uIChpdGVtKSB7CiAgICAgICAgICAgICAgICAgIHJldHVybiBPYmplY3QuaXMoaXRlbS5zcmZrZXksIHNlbGVjdGlvbi5zcmZrZXkpOwogICAgICAgICAgICAgICAgfSk7CgogICAgICAgICAgICAgICAgaWYgKHNlbGVjdGVkSXRlbSkgewogICAgICAgICAgICAgICAgICBfdGhpcy5yb3dDbGljayhzZWxlY3RlZEl0ZW0pOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSwgMzAwKTsKICAgICAgfSlbImNhdGNoIl0oZnVuY3Rpb24gKHJlc3BvbnNlKSB7CiAgICAgICAgaWYgKHJlc3BvbnNlICYmIHJlc3BvbnNlLnN0YXR1cyA9PT0gNDAxKSB7CiAgICAgICAgICByZXR1cm47CiAgICAgICAgfQoKICAgICAgICBfdGhpczUuJE5vdGljZS5lcnJvcih7CiAgICAgICAgICB0aXRsZTogJ+mUmeivrycsCiAgICAgICAgICBkZXNjOiByZXNwb25zZS5lcnJvck1lc3NhZ2UKICAgICAgICB9KTsKICAgICAgfSk7CiAgICB9CiAgICAvKioNCiAgICAgKiDliKDpmaQNCiAgICAgKg0KICAgICAqIEBwYXJhbSB7YW55W119IGRhdGFzDQogICAgICogQHJldHVybnMge1Byb21pc2U8YW55Pn0NCiAgICAgKiBAbWVtYmVyb2YgTWFpbkJhc2UNCiAgICAgKi8KCiAgfSwgewogICAga2V5OiAicmVtb3ZlIiwKICAgIHZhbHVlOiBmdW5jdGlvbiAoKSB7CiAgICAgIHZhciBfcmVtb3ZlID0gX2FzeW5jVG9HZW5lcmF0b3IoCiAgICAgIC8qI19fUFVSRV9fKi8KICAgICAgcmVnZW5lcmF0b3JSdW50aW1lLm1hcmsoZnVuY3Rpb24gX2NhbGxlZTIoZGF0YXMpIHsKICAgICAgICB2YXIgX3RoaXM2ID0gdGhpczsKCiAgICAgICAgdmFyIF9kYXRhcywgZGF0YUluZm8sIHJlbW92ZURhdGE7CgogICAgICAgIHJldHVybiByZWdlbmVyYXRvclJ1bnRpbWUud3JhcChmdW5jdGlvbiBfY2FsbGVlMiQoX2NvbnRleHQyKSB7CiAgICAgICAgICB3aGlsZSAoMSkgewogICAgICAgICAgICBzd2l0Y2ggKF9jb250ZXh0Mi5wcmV2ID0gX2NvbnRleHQyLm5leHQpIHsKICAgICAgICAgICAgICBjYXNlIDA6CiAgICAgICAgICAgICAgICBpZiAodGhpcy5yZW1vdmVBY3Rpb24pIHsKICAgICAgICAgICAgICAgICAgX2NvbnRleHQyLm5leHQgPSAzOwogICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICB0aGlzLiROb3RpY2UuZXJyb3IoewogICAgICAgICAgICAgICAgICB0aXRsZTogJ+mUmeivrycsCiAgICAgICAgICAgICAgICAgIGRlc2M6ICdQSU1SRVdBUkRQVU5JU0hNRU5UUGltSmFuZ2xHcmlkVmlld+inhuWbvuihqOagvHJlbW92ZUFjdGlvbuWPguaVsOacqumFjee9ricKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0Mi5hYnJ1cHQoInJldHVybiIpOwoKICAgICAgICAgICAgICBjYXNlIDM6CiAgICAgICAgICAgICAgICBfZGF0YXMgPSBbXTsKICAgICAgICAgICAgICAgIGRhdGFzLmZvckVhY2goZnVuY3Rpb24gKHJlY29yZCwgaW5kZXgpIHsKICAgICAgICAgICAgICAgICAgaWYgKE9iamVjdC5pcyhyZWNvcmQuc3JmdWYsICIwIikpIHsKICAgICAgICAgICAgICAgICAgICBfdGhpczYuaXRlbXMuc29tZShmdW5jdGlvbiAodmFsLCBudW0pIHsKICAgICAgICAgICAgICAgICAgICAgIGlmIChKU09OLnN0cmluZ2lmeSh2YWwpID09IEpTT04uc3RyaW5naWZ5KHJlY29yZCkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgX3RoaXM2Lml0ZW1zLnNwbGljZShudW0sIDEpOwoKICAgICAgICAgICAgICAgICAgICAgICAgX3RoaXM2LmdyaWRJdGVtc01vZGVsLnNwbGljZShudW0sIDEpOwoKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgX2RhdGFzLnB1c2goZGF0YXNbaW5kZXhdKTsKICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSk7CgogICAgICAgICAgICAgICAgaWYgKCEoX2RhdGFzLmxlbmd0aCA9PT0gMCkpIHsKICAgICAgICAgICAgICAgICAgX2NvbnRleHQyLm5leHQgPSA3OwogICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQyLmFicnVwdCgicmV0dXJuIik7CgogICAgICAgICAgICAgIGNhc2UgNzoKICAgICAgICAgICAgICAgIGRhdGFJbmZvID0gJyc7CgogICAgICAgICAgICAgICAgX2RhdGFzLmZvckVhY2goZnVuY3Rpb24gKHJlY29yZCwgaW5kZXgpIHsKICAgICAgICAgICAgICAgICAgdmFyIHNyZm1ham9ydGV4dCA9IHJlY29yZC5waW1yZXdhcmRwdW5pc2htZW50bmFtZTsKCiAgICAgICAgICAgICAgICAgIGlmIChpbmRleCA8IDUpIHsKICAgICAgICAgICAgICAgICAgICBpZiAoIU9iamVjdC5pcyhkYXRhSW5mbywgJycpKSB7CiAgICAgICAgICAgICAgICAgICAgICBkYXRhSW5mbyArPSAn44CBJzsKICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgIGRhdGFJbmZvICs9IHNyZm1ham9ydGV4dDsKICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgICAgIGlmIChfZGF0YXMubGVuZ3RoIDwgNSkgewogICAgICAgICAgICAgICAgICBkYXRhSW5mbyA9IGRhdGFJbmZvICsgJyDlhbEnICsgX2RhdGFzLmxlbmd0aCArICfmnaHmlbDmja4nOwogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgZGF0YUluZm8gPSBkYXRhSW5mbyArICcuLi4nICsgJyDlhbEnICsgX2RhdGFzLmxlbmd0aCArICfmnaHmlbDmja4nOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIHJlbW92ZURhdGEgPSBmdW5jdGlvbiByZW1vdmVEYXRhKCkgewogICAgICAgICAgICAgICAgICB2YXIga2V5cyA9IFtdOwoKICAgICAgICAgICAgICAgICAgX2RhdGFzLmZvckVhY2goZnVuY3Rpb24gKGRhdGEpIHsKICAgICAgICAgICAgICAgICAgICBrZXlzLnB1c2goZGF0YS5zcmZrZXkpOwogICAgICAgICAgICAgICAgICB9KTsKCiAgICAgICAgICAgICAgICAgIHZhciBfcmVtb3ZlQWN0aW9uID0ga2V5cy5sZW5ndGggPiAxID8gJ3JlbW92ZUJhdGNoJyA6IF90aGlzNi5yZW1vdmVBY3Rpb247CgogICAgICAgICAgICAgICAgICB2YXIgX2tleXMgPSBrZXlzLmxlbmd0aCA+IDEgPyBrZXlzIDoga2V5c1swXTsKCiAgICAgICAgICAgICAgICAgIHZhciBjb250ZXh0ID0gSlNPTi5wYXJzZShKU09OLnN0cmluZ2lmeShfdGhpczYuY29udGV4dCkpOwoKICAgICAgICAgICAgICAgICAgdmFyIHBvc3QgPSBfdGhpczYuc2VydmljZVsiZGVsZXRlIl0oX3JlbW92ZUFjdGlvbiwgT2JqZWN0LmFzc2lnbihjb250ZXh0LCB7CiAgICAgICAgICAgICAgICAgICAgcGltcmV3YXJkcHVuaXNobWVudDogX2tleXMKICAgICAgICAgICAgICAgICAgfSksIE9iamVjdC5hc3NpZ24oewogICAgICAgICAgICAgICAgICAgIHBpbXJld2FyZHB1bmlzaG1lbnQ6IF9rZXlzCiAgICAgICAgICAgICAgICAgIH0sIHsKICAgICAgICAgICAgICAgICAgICB2aWV3cGFyYW1zOiBfdGhpczYudmlld3BhcmFtcwogICAgICAgICAgICAgICAgICB9KSwgX3RoaXM2LnNob3dCdXN5SW5kaWNhdG9yKTsKCiAgICAgICAgICAgICAgICAgIHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbiAocmVzb2x2ZSwgcmVqZWN0KSB7CiAgICAgICAgICAgICAgICAgICAgcG9zdC50aGVuKGZ1bmN0aW9uIChyZXNwb25zZSkgewogICAgICAgICAgICAgICAgICAgICAgaWYgKCFyZXNwb25zZSB8fCByZXNwb25zZS5zdGF0dXMgIT09IDIwMCkgewogICAgICAgICAgICAgICAgICAgICAgICBfdGhpczYuJE5vdGljZS5lcnJvcih7CiAgICAgICAgICAgICAgICAgICAgICAgICAgdGl0bGU6ICcnLAogICAgICAgICAgICAgICAgICAgICAgICAgIGRlc2M6ICfliKDpmaTmlbDmja7lpLHotKUsJyArIHJlc3BvbnNlLmluZm8KICAgICAgICAgICAgICAgICAgICAgICAgfSk7CgogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICBfdGhpczYuJE5vdGljZS5zdWNjZXNzKHsKICAgICAgICAgICAgICAgICAgICAgICAgICB0aXRsZTogJycsCiAgICAgICAgICAgICAgICAgICAgICAgICAgZGVzYzogJ+WIoOmZpOaIkOWKnyEnCiAgICAgICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgICAgfSAvL+WIoOmZpGl0ZW1z5Lit5bey5Yig6Zmk55qE6aG5CgoKICAgICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKF90aGlzNi5pdGVtcyk7CgogICAgICAgICAgICAgICAgICAgICAgX2RhdGFzLmZvckVhY2goZnVuY3Rpb24gKGRhdGEpIHsKICAgICAgICAgICAgICAgICAgICAgICAgX3RoaXM2Lml0ZW1zLnNvbWUoZnVuY3Rpb24gKGl0ZW0sIGluZGV4KSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKE9iamVjdC5pcyhpdGVtLnNyZmtleSwgZGF0YS5zcmZrZXkpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBfdGhpczYuaXRlbXMuc3BsaWNlKGluZGV4LCAxKTsKCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBfdGhpczYuZ3JpZEl0ZW1zTW9kZWwuc3BsaWNlKGluZGV4LCAxKTsKCiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgICAgfSk7CgogICAgICAgICAgICAgICAgICAgICAgX3RoaXM2LnRvdGFscm93IC09IF9kYXRhcy5sZW5ndGg7CgogICAgICAgICAgICAgICAgICAgICAgX3RoaXM2LiRlbWl0KCdyZW1vdmUnLCBudWxsKTsKCiAgICAgICAgICAgICAgICAgICAgICBfdGhpczYuc2VsZWN0aW9ucyA9IFtdOwogICAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZShyZXNwb25zZSk7CiAgICAgICAgICAgICAgICAgICAgfSlbImNhdGNoIl0oZnVuY3Rpb24gKHJlc3BvbnNlKSB7CiAgICAgICAgICAgICAgICAgICAgICBpZiAocmVzcG9uc2UgJiYgcmVzcG9uc2Uuc3RhdHVzID09PSA0MDEpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICAgIGlmICghcmVzcG9uc2UgfHwgIXJlc3BvbnNlLnN0YXR1cyB8fCAhcmVzcG9uc2UuZGF0YSkgewogICAgICAgICAgICAgICAgICAgICAgICBfdGhpczYuJE5vdGljZS5lcnJvcih7CiAgICAgICAgICAgICAgICAgICAgICAgICAgdGl0bGU6ICfplJnor68nLAogICAgICAgICAgICAgICAgICAgICAgICAgIGRlc2M6ICfns7vnu5/lvILluLgnCiAgICAgICAgICAgICAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgICAgICAgICAgICAgcmVqZWN0KHJlc3BvbnNlKTsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICAgIHJlamVjdChyZXNwb25zZSk7CiAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgfTsKCiAgICAgICAgICAgICAgICBkYXRhSW5mbyA9IGRhdGFJbmZvLnJlcGxhY2UoL1tudWxsXS9nLCAnJykucmVwbGFjZSgvW3VuZGVmaW5lZF0vZywgJycpOwogICAgICAgICAgICAgICAgdGhpcy4kTW9kYWwuY29uZmlybSh7CiAgICAgICAgICAgICAgICAgIHRpdGxlOiAn6K2m5ZGKJywKICAgICAgICAgICAgICAgICAgY29udGVudDogJ+ehruiupOimgeWIoOmZpCAnICsgZGF0YUluZm8gKyAn77yM5Yig6Zmk5pON5L2c5bCG5LiN5Y+v5oGi5aSN77yfJywKICAgICAgICAgICAgICAgICAgb25PazogZnVuY3Rpb24gb25PaygpIHsKICAgICAgICAgICAgICAgICAgICByZW1vdmVEYXRhKCk7CiAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgIG9uQ2FuY2VsOiBmdW5jdGlvbiBvbkNhbmNlbCgpIHt9CiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDIuYWJydXB0KCJyZXR1cm4iLCByZW1vdmVEYXRhKTsKCiAgICAgICAgICAgICAgY2FzZSAxNDoKICAgICAgICAgICAgICBjYXNlICJlbmQiOgogICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0Mi5zdG9wKCk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9LCBfY2FsbGVlMiwgdGhpcyk7CiAgICAgIH0pKTsKCiAgICAgIGZ1bmN0aW9uIHJlbW92ZShfeCkgewogICAgICAgIHJldHVybiBfcmVtb3ZlLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7CiAgICAgIH0KCiAgICAgIHJldHVybiByZW1vdmU7CiAgICB9KCkKICAgIC8qKg0KICAgICAqIOaJuemHj+a3u+WKoA0KICAgICAqDQogICAgICogQHBhcmFtIHsqfSBbYXJnPXt9XQ0KICAgICAqIEBtZW1iZXJvZiBNYWluQmFzZQ0KICAgICAqLwoKICB9LCB7CiAgICBrZXk6ICJhZGRCYXRjaCIsCiAgICB2YWx1ZTogZnVuY3Rpb24gYWRkQmF0Y2goKSB7CiAgICAgIHZhciBhcmcgPSBhcmd1bWVudHMubGVuZ3RoID4gMCAmJiBhcmd1bWVudHNbMF0gIT09IHVuZGVmaW5lZCA/IGFyZ3VtZW50c1swXSA6IHt9OwoKICAgICAgaWYgKCF0aGlzLmZldGNoQWN0aW9uKSB7CiAgICAgICAgdGhpcy4kTm90aWNlLmVycm9yKHsKICAgICAgICAgIHRpdGxlOiAn6ZSZ6K+vJywKICAgICAgICAgIGRlc2M6ICdQSU1SRVdBUkRQVU5JU0hNRU5UUGltSmFuZ2xHcmlkVmlld+inhuWbvuihqOagvGZldGNoQWN0aW9u5Y+C5pWw5pyq6YWN572uJwogICAgICAgIH0pOwogICAgICAgIHJldHVybjsKICAgICAgfQoKICAgICAgaWYgKCFhcmcpIHsKICAgICAgICBhcmcgPSB7fTsKICAgICAgfQoKICAgICAgY29uc29sZS5lcnJvcigi5om56YeP5re75Yqg5pyq5a6e546wIik7CiAgICB9CiAgICAvKioNCiAgICAgKiDmlbDmja7lr7zlhaUNCiAgICAgKg0KICAgICAqIEBwYXJhbSB7Kn0gZGF0YQ0KICAgICAqIEBtZW1iZXJvZiBNYWluQmFzZQ0KICAgICAqLwoKICB9LCB7CiAgICBrZXk6ICJpbXBvcnRFeGNlbCIsCiAgICB2YWx1ZTogZnVuY3Rpb24gaW1wb3J0RXhjZWwoKSB7CiAgICAgIHZhciBfdGhpczcgPSB0aGlzOwoKICAgICAgdmFyIGRhdGEgPSBhcmd1bWVudHMubGVuZ3RoID4gMCAmJiBhcmd1bWVudHNbMF0gIT09IHVuZGVmaW5lZCA/IGFyZ3VtZW50c1swXSA6IHt9OwogICAgICAvL+WvvOWFpWV4Y2VsCiAgICAgIHZhciBpbXBvcnREYXRhTW9kZWwgPSB7fTsKCiAgICAgIGlmIChPYmplY3Qua2V5cyhpbXBvcnREYXRhTW9kZWwpLmxlbmd0aCA9PSAwKSB7CiAgICAgICAgdGhpcy4kTm90aWNlLndhcm5pbmcoewogICAgICAgICAgJ3RpdGxlJzogdGhpcy4kdCgiYXBwLnV0aWx2aWV3Lndhcm5pbmciKSwKICAgICAgICAgICdkZXNjJzogdGhpcy4kdCgiYXBwLnV0aWx2aWV3LmluZm8iKQogICAgICAgIH0pOwogICAgICAgIHJldHVybjsKICAgICAgfQoKICAgICAgdmFyIHZpZXcgPSB7CiAgICAgICAgdmlld25hbWU6ICdhcHAtZGF0YS11cGxvYWQnLAogICAgICAgIHRpdGxlOiB0aGlzLiR0KCJhcHAudXRpbHZpZXcuaW1wb3J0dmlldyIpLAogICAgICAgIHdpZHRoOiA5MDAsCiAgICAgICAgaGVpZ2h0OiA3MDAKICAgICAgfTsKICAgICAgdmFyIGNvbnRhaW5lciA9IHRoaXMuJGFwcG1vZGFsLm9wZW5Nb2RhbCh2aWV3LCBKU09OLnBhcnNlKEpTT04uc3RyaW5naWZ5KHRoaXMuY29udGV4dCkpLCBpbXBvcnREYXRhTW9kZWwpOwogICAgICBjb250YWluZXIuc3Vic2NyaWJlKGZ1bmN0aW9uIChyZXN1bHQpIHsKICAgICAgICBpZiAoT2JqZWN0LmlzKHJlc3VsdC5yZXQsICdPSycpKSB7CiAgICAgICAgICBfdGhpczcucmVmcmVzaChyZXN1bHQuZGF0YXMpOwogICAgICAgIH0KICAgICAgfSk7CiAgICB9CiAgICAvKioNCiAgICAgKiDmlbDmja7lr7zlh7oNCiAgICAgKg0KICAgICAqIEBwYXJhbSB7Kn0gZGF0YQ0KICAgICAqIEBtZW1iZXJvZiBNYWluQmFzZQ0KICAgICAqLwoKICB9LCB7CiAgICBrZXk6ICJleHBvcnRFeGNlbCIsCiAgICB2YWx1ZTogZnVuY3Rpb24gZXhwb3J0RXhjZWwoKSB7CiAgICAgIHZhciBfdGhpczggPSB0aGlzOwoKICAgICAgdmFyIGRhdGEgPSBhcmd1bWVudHMubGVuZ3RoID4gMCAmJiBhcmd1bWVudHNbMF0gIT09IHVuZGVmaW5lZCA/IGFyZ3VtZW50c1swXSA6IHt9OwoKICAgICAgLy8g5a+85Ye6RXhjZWwKICAgICAgdmFyIGRvRXhwb3J0ID0KICAgICAgLyojX19QVVJFX18qLwogICAgICBmdW5jdGlvbiAoKSB7CiAgICAgICAgdmFyIF9yZWYyID0gX2FzeW5jVG9HZW5lcmF0b3IoCiAgICAgICAgLyojX19QVVJFX18qLwogICAgICAgIHJlZ2VuZXJhdG9yUnVudGltZS5tYXJrKGZ1bmN0aW9uIF9jYWxsZWUzKF9kYXRhKSB7CiAgICAgICAgICB2YXIgdEhlYWRlciwgZmlsdGVyVmFsLCBkYXRhOwogICAgICAgICAgcmV0dXJuIHJlZ2VuZXJhdG9yUnVudGltZS53cmFwKGZ1bmN0aW9uIF9jYWxsZWUzJChfY29udGV4dDMpIHsKICAgICAgICAgICAgd2hpbGUgKDEpIHsKICAgICAgICAgICAgICBzd2l0Y2ggKF9jb250ZXh0My5wcmV2ID0gX2NvbnRleHQzLm5leHQpIHsKICAgICAgICAgICAgICAgIGNhc2UgMDoKICAgICAgICAgICAgICAgICAgdEhlYWRlciA9IFtdOwogICAgICAgICAgICAgICAgICBmaWx0ZXJWYWwgPSBbXTsKCiAgICAgICAgICAgICAgICAgIF90aGlzOC5hbGxDb2x1bW5zLmZvckVhY2goZnVuY3Rpb24gKGl0ZW0pIHsKICAgICAgICAgICAgICAgICAgICBpdGVtLnNob3cgJiYgaXRlbS5sYWJlbCA/IHRIZWFkZXIucHVzaChfdGhpczguJHQoaXRlbS5sYW5ndGFnKSkgOiAiIjsKICAgICAgICAgICAgICAgICAgICBpdGVtLnNob3cgJiYgaXRlbS5uYW1lID8gZmlsdGVyVmFsLnB1c2goaXRlbS5uYW1lKSA6ICIiOwogICAgICAgICAgICAgICAgICB9KTsKCiAgICAgICAgICAgICAgICAgIF9jb250ZXh0My5uZXh0ID0gNTsKICAgICAgICAgICAgICAgICAgcmV0dXJuIF90aGlzOC5mb3JtYXRFeGNlbERhdGEoZmlsdGVyVmFsLCBfZGF0YSk7CgogICAgICAgICAgICAgICAgY2FzZSA1OgogICAgICAgICAgICAgICAgICBkYXRhID0gX2NvbnRleHQzLnNlbnQ7CgogICAgICAgICAgICAgICAgICBfdGhpczguJGV4cG9ydC5leHBvcnRFeGNlbCgpLnRoZW4oZnVuY3Rpb24gKGV4Y2VsKSB7CiAgICAgICAgICAgICAgICAgICAgZXhjZWwuZXhwb3J0X2pzb25fdG9fZXhjZWwoewogICAgICAgICAgICAgICAgICAgICAgaGVhZGVyOiB0SGVhZGVyLAogICAgICAgICAgICAgICAgICAgICAgZGF0YTogZGF0YSwKICAgICAgICAgICAgICAgICAgICAgIGZpbGVuYW1lOiAi5aWW5oOp5L+h5oGv6KGoIiwKICAgICAgICAgICAgICAgICAgICAgIGF1dG9XaWR0aDogdHJ1ZSwKICAgICAgICAgICAgICAgICAgICAgIGJvb2tUeXBlOiAieGxzeCIgLy/pnZ7lv4XloasKCiAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgICAgIGNhc2UgNzoKICAgICAgICAgICAgICAgIGNhc2UgImVuZCI6CiAgICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDMuc3RvcCgpOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgfSwgX2NhbGxlZTMpOwogICAgICAgIH0pKTsKCiAgICAgICAgcmV0dXJuIGZ1bmN0aW9uIGRvRXhwb3J0KF94MikgewogICAgICAgICAgcmV0dXJuIF9yZWYyLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7CiAgICAgICAgfTsKICAgICAgfSgpOwoKICAgICAgdmFyIHBhZ2UgPSB7fTsgLy8g6K6+572ucGFnZe+8jHNpemUKCiAgICAgIGlmIChPYmplY3QuaXMoZGF0YS50eXBlLCAnbWF4Um93Q291bnQnKSkgewogICAgICAgIE9iamVjdC5hc3NpZ24ocGFnZSwgewogICAgICAgICAgcGFnZTogMCwKICAgICAgICAgIHNpemU6IGRhdGEubWF4Um93Q291bnQKICAgICAgICB9KTsKICAgICAgfSBlbHNlIGlmIChPYmplY3QuaXMoZGF0YS50eXBlLCAnYWN0aXZhdGVkUGFnZScpKSB7CiAgICAgICAgdHJ5IHsKICAgICAgICAgIGRvRXhwb3J0KEpTT04ucGFyc2UoSlNPTi5zdHJpbmdpZnkodGhpcy5pdGVtcykpKTsKICAgICAgICB9IGNhdGNoIChlcnJvcikgewogICAgICAgICAgY29uc29sZS5lcnJvcihlcnJvcik7CiAgICAgICAgfQoKICAgICAgICByZXR1cm47CiAgICAgIH0gLy8g6K6+572u5o6S5bqPCgoKICAgICAgaWYgKCF0aGlzLmlzTm9Tb3J0ICYmICFPYmplY3QuaXModGhpcy5taW5vclNvcnREaXIsICcnKSAmJiAhT2JqZWN0LmlzKHRoaXMubWlub3JTb3J0UFNERUYsICcnKSkgewogICAgICAgIHZhciBzb3J0ID0gdGhpcy5taW5vclNvcnRQU0RFRiArICIsIiArIHRoaXMubWlub3JTb3J0RGlyOwogICAgICAgIE9iamVjdC5hc3NpZ24ocGFnZSwgewogICAgICAgICAgc29ydDogc29ydAogICAgICAgIH0pOwogICAgICB9CgogICAgICB2YXIgYXJnID0ge307CiAgICAgIE9iamVjdC5hc3NpZ24oYXJnLCBwYWdlKTsgLy8g6I635Y+WcXVlcnks5pCc57Si6KGo5Y2V77yMdmlld3BhcmFtc+etieeItuaVsOaNrgoKICAgICAgdmFyIHBhcmVudGRhdGEgPSB7fTsKICAgICAgdGhpcy4kZW1pdCgnYmVmb3JlbG9hZCcsIHBhcmVudGRhdGEpOwogICAgICBPYmplY3QuYXNzaWduKGFyZywgcGFyZW50ZGF0YSk7CiAgICAgIHZhciBwb3N0ID0gdGhpcy5zZXJ2aWNlLnNlYXJjaCh0aGlzLmZldGNoQWN0aW9uLCBKU09OLnBhcnNlKEpTT04uc3RyaW5naWZ5KHRoaXMuY29udGV4dCkpLCBhcmcsIHRoaXMuc2hvd0J1c3lJbmRpY2F0b3IpOwogICAgICBwb3N0LnRoZW4oZnVuY3Rpb24gKHJlc3BvbnNlKSB7CiAgICAgICAgaWYgKCFyZXNwb25zZSB8fCByZXNwb25zZS5zdGF0dXMgIT09IDIwMCkgewogICAgICAgICAgX3RoaXM4LiROb3RpY2UuZXJyb3IoewogICAgICAgICAgICB0aXRsZTogJycsCiAgICAgICAgICAgIGRlc2M6ICfmlbDmja7lr7zlh7rlpLHotKUsJyArIHJlc3BvbnNlLmluZm8KICAgICAgICAgIH0pOwoKICAgICAgICAgIHJldHVybjsKICAgICAgICB9CgogICAgICAgIHRyeSB7CiAgICAgICAgICBkb0V4cG9ydChKU09OLnBhcnNlKEpTT04uc3RyaW5naWZ5KHJlc3BvbnNlLmRhdGEpKSk7CiAgICAgICAgfSBjYXRjaCAoZXJyb3IpIHsKICAgICAgICAgIGNvbnNvbGUuZXJyb3IoZXJyb3IpOwogICAgICAgIH0KICAgICAgfSlbImNhdGNoIl0oZnVuY3Rpb24gKHJlc3BvbnNlKSB7CiAgICAgICAgaWYgKHJlc3BvbnNlICYmIHJlc3BvbnNlLnN0YXR1cyA9PT0gNDAxKSB7CiAgICAgICAgICByZXR1cm47CiAgICAgICAgfQoKICAgICAgICBfdGhpczguJE5vdGljZS5lcnJvcih7CiAgICAgICAgICB0aXRsZTogJycsCiAgICAgICAgICBkZXNjOiAn5pWw5o2u5a+85Ye65aSx6LSlJwogICAgICAgIH0pOwogICAgICB9KTsKICAgIH0KICAgIC8qKg0KICAgICAqIOWvvOWHuuaVsOaNruagvOW8j+WMlg0KICAgICAqDQogICAgICogQHBhcmFtIHsqfSBmaWx0ZXJWYWwNCiAgICAgKiBAcGFyYW0geyp9IGpzb25EYXRhDQogICAgICogQHJldHVybnMge1tdfQ0KICAgICAqIEBtZW1iZXJvZiBNYWluQmFzZQ0KICAgICAqLwoKICB9LCB7CiAgICBrZXk6ICJmb3JtYXRFeGNlbERhdGEiLAogICAgdmFsdWU6IGZ1bmN0aW9uICgpIHsKICAgICAgdmFyIF9mb3JtYXRFeGNlbERhdGEgPSBfYXN5bmNUb0dlbmVyYXRvcigKICAgICAgLyojX19QVVJFX18qLwogICAgICByZWdlbmVyYXRvclJ1bnRpbWUubWFyayhmdW5jdGlvbiBfY2FsbGVlNChmaWx0ZXJWYWwsIGpzb25EYXRhKSB7CiAgICAgICAgdmFyIGNvZGVsaXN0Q29sdW1ucywgX3RoaXMsIF9sb29wLCBfaTIsIF9jb2RlbGlzdENvbHVtbnM7CgogICAgICAgIHJldHVybiByZWdlbmVyYXRvclJ1bnRpbWUud3JhcChmdW5jdGlvbiBfY2FsbGVlNCQoX2NvbnRleHQ1KSB7CiAgICAgICAgICB3aGlsZSAoMSkgewogICAgICAgICAgICBzd2l0Y2ggKF9jb250ZXh0NS5wcmV2ID0gX2NvbnRleHQ1Lm5leHQpIHsKICAgICAgICAgICAgICBjYXNlIDA6CiAgICAgICAgICAgICAgICBjb2RlbGlzdENvbHVtbnMgPSBbewogICAgICAgICAgICAgICAgICBuYW1lOiAnbHgnLAogICAgICAgICAgICAgICAgICBzcmZrZXk6ICdFaHJDb2RlTGlzdDAxMjQnLAogICAgICAgICAgICAgICAgICBjb2RlbGlzdFR5cGU6ICdTVEFUSUMnLAogICAgICAgICAgICAgICAgICB0ZXh0U2VwYXJhdG9yOiAn44CBJywKICAgICAgICAgICAgICAgICAgcmVuZGVyTW9kZTogJ3N0cmluZycsCiAgICAgICAgICAgICAgICAgIHZhbHVlU2VwYXJhdG9yOiAiOyIKICAgICAgICAgICAgICAgIH1dOwogICAgICAgICAgICAgICAgX3RoaXMgPSB0aGlzOwogICAgICAgICAgICAgICAgX2xvb3AgPQogICAgICAgICAgICAgICAgLyojX19QVVJFX18qLwogICAgICAgICAgICAgICAgcmVnZW5lcmF0b3JSdW50aW1lLm1hcmsoZnVuY3Rpb24gX2xvb3AoKSB7CiAgICAgICAgICAgICAgICAgIHZhciBjb2RlbGlzdCwgaXRlbXMsIF9pdGVtczsKCiAgICAgICAgICAgICAgICAgIHJldHVybiByZWdlbmVyYXRvclJ1bnRpbWUud3JhcChmdW5jdGlvbiBfbG9vcCQoX2NvbnRleHQ0KSB7CiAgICAgICAgICAgICAgICAgICAgd2hpbGUgKDEpIHsKICAgICAgICAgICAgICAgICAgICAgIHN3aXRjaCAoX2NvbnRleHQ0LnByZXYgPSBfY29udGV4dDQubmV4dCkgewogICAgICAgICAgICAgICAgICAgICAgICBjYXNlIDA6CiAgICAgICAgICAgICAgICAgICAgICAgICAgY29kZWxpc3QgPSBfY29kZWxpc3RDb2x1bW5zW19pMl07CgogICAgICAgICAgICAgICAgICAgICAgICAgIGlmICghT2JqZWN0LmlzKGNvZGVsaXN0LmNvZGVsaXN0VHlwZSwgIkRZTkFNSUMiKSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgX2NvbnRleHQ0Lm5leHQgPSA4OwogICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICAgICAgICBfY29udGV4dDQubmV4dCA9IDQ7CiAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIF90aGlzLmNvZGVMaXN0U2VydmljZS5nZXRJdGVtcyhjb2RlbGlzdC5zcmZrZXkpOwoKICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSA0OgogICAgICAgICAgICAgICAgICAgICAgICAgIGl0ZW1zID0gX2NvbnRleHQ0LnNlbnQ7CiAgICAgICAgICAgICAgICAgICAgICAgICAganNvbkRhdGEuZm9yRWFjaChmdW5jdGlvbiAocm93KSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICByb3dbY29kZWxpc3QubmFtZV0gPSBfdGhpcy5nZXRDb2RlbGlzdFZhbHVlKGl0ZW1zLCByb3dbY29kZWxpc3QubmFtZV0sIGNvZGVsaXN0KTsKICAgICAgICAgICAgICAgICAgICAgICAgICB9KTsgLy8g6Z2Z5oCB5aSE55CGCgogICAgICAgICAgICAgICAgICAgICAgICAgIF9jb250ZXh0NC5uZXh0ID0gMTM7CiAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgICAgICAgICAgICAgICBjYXNlIDg6CiAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCFPYmplY3QuaXMoY29kZWxpc3QuY29kZWxpc3RUeXBlLCAiU1RBVElDIikpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIF9jb250ZXh0NC5uZXh0ID0gMTM7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgICAgICAgIF9jb250ZXh0NC5uZXh0ID0gMTE7CiAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIF90aGlzLiRzdG9yZS5nZXR0ZXJzLmdldENvZGVMaXN0SXRlbXMoY29kZWxpc3Quc3Jma2V5KTsKCiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgMTE6CiAgICAgICAgICAgICAgICAgICAgICAgICAgX2l0ZW1zID0gX2NvbnRleHQ0LnNlbnQ7CiAgICAgICAgICAgICAgICAgICAgICAgICAganNvbkRhdGEuZm9yRWFjaChmdW5jdGlvbiAocm93KSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICByb3dbY29kZWxpc3QubmFtZV0gPSBfdGhpcy5nZXRDb2RlbGlzdFZhbHVlKF9pdGVtcywgcm93W2NvZGVsaXN0Lm5hbWVdLCBjb2RlbGlzdCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7CgogICAgICAgICAgICAgICAgICAgICAgICBjYXNlIDEzOgogICAgICAgICAgICAgICAgICAgICAgICBjYXNlICJlbmQiOgogICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDQuc3RvcCgpOwogICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgfSwgX2xvb3ApOwogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICBfaTIgPSAwLCBfY29kZWxpc3RDb2x1bW5zID0gY29kZWxpc3RDb2x1bW5zOwoKICAgICAgICAgICAgICBjYXNlIDQ6CiAgICAgICAgICAgICAgICBpZiAoIShfaTIgPCBfY29kZWxpc3RDb2x1bW5zLmxlbmd0aCkpIHsKICAgICAgICAgICAgICAgICAgX2NvbnRleHQ1Lm5leHQgPSA5OwogICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQ1LmRlbGVnYXRlWWllbGQoX2xvb3AoKSwgInQwIiwgNik7CgogICAgICAgICAgICAgIGNhc2UgNjoKICAgICAgICAgICAgICAgIF9pMisrOwogICAgICAgICAgICAgICAgX2NvbnRleHQ1Lm5leHQgPSA0OwogICAgICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgICAgIGNhc2UgOToKICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDUuYWJydXB0KCJyZXR1cm4iLCBqc29uRGF0YS5tYXAoZnVuY3Rpb24gKHYpIHsKICAgICAgICAgICAgICAgICAgcmV0dXJuIGZpbHRlclZhbC5tYXAoZnVuY3Rpb24gKGopIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gdltqXTsKICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICB9KSk7CgogICAgICAgICAgICAgIGNhc2UgMTA6CiAgICAgICAgICAgICAgY2FzZSAiZW5kIjoKICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDUuc3RvcCgpOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSwgX2NhbGxlZTQsIHRoaXMpOwogICAgICB9KSk7CgogICAgICBmdW5jdGlvbiBmb3JtYXRFeGNlbERhdGEoX3gzLCBfeDQpIHsKICAgICAgICByZXR1cm4gX2Zvcm1hdEV4Y2VsRGF0YS5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwogICAgICB9CgogICAgICByZXR1cm4gZm9ybWF0RXhjZWxEYXRhOwogICAgfSgpCiAgICAvKioNCiAgICAgKiDop6PmnpDku6PnoIHooajlkox2bGF1Ze+8jOiuvue9rml0ZW1zDQogICAgICoNCiAgICAgKiBAcHVibGljDQogICAgICogQHBhcmFtIHthbnlbXX0gaXRlbXMg5Luj56CB6KGo5pWw5o2uDQogICAgICogQHBhcmFtIHsqfSB2YWx1ZQ0KICAgICAqIEByZXR1cm5zIHsqfQ0KICAgICAqIEBtZW1iZXJvZiBNYWluQmFzZQ0KICAgICAqLwoKICB9LCB7CiAgICBrZXk6ICJnZXRDb2RlbGlzdFZhbHVlIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBnZXRDb2RlbGlzdFZhbHVlKGl0ZW1zLCB2YWx1ZSwgY29kZWxpc3QpIHsKICAgICAgdmFyIF90aGlzOSA9IHRoaXM7CgogICAgICBpZiAoIXZhbHVlKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuJHQoJ2NvZGVsaXN0LicgKyBjb2RlbGlzdC5zcmZrZXkgKyAnLmVtcHR5Jyk7CiAgICAgIH0KCiAgICAgIGlmIChpdGVtcykgewogICAgICAgIHZhciByZXN1bHQgPSBbXTsKCiAgICAgICAgaWYgKE9iamVjdC5pcyhjb2RlbGlzdC5yZW5kZXJNb2RlLCAibnVtYmVyIikpIHsKICAgICAgICAgIGl0ZW1zLm1hcChmdW5jdGlvbiAoX2l0ZW0sIGluZGV4KSB7CiAgICAgICAgICAgIHZhciBuVmFsdWUgPSBwYXJzZUludCh2YWx1ZSwgMTApOwogICAgICAgICAgICB2YXIgY29kZXZhbHVlID0gX2l0ZW0udmFsdWU7CgogICAgICAgICAgICBpZiAoKHBhcnNlSW50KGNvZGV2YWx1ZSwgMTApICYgblZhbHVlKSA+IDApIHsKICAgICAgICAgICAgICByZXN1bHQucHVzaChfaXRlbSk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0pOwogICAgICAgIH0gZWxzZSBpZiAoT2JqZWN0LmlzKGNvZGVsaXN0LnJlbmRlck1vZGUsICJzdHJpbmciKSkgewogICAgICAgICAgdmFyIGFycmF5VmFsdWUgPSB2YWx1ZS5zcGxpdChjb2RlbGlzdC52YWx1ZVNlcGFyYXRvcik7CiAgICAgICAgICBhcnJheVZhbHVlLm1hcChmdW5jdGlvbiAodmFsdWUsIGluZGV4KSB7CiAgICAgICAgICAgIHJlc3VsdC5wdXNoKFtdKTsKICAgICAgICAgICAgdmFyIHZhbHVlcyA9IE9iamVjdC5pcyhfdGhpczkuJHV0aWwudHlwZU9mKHZhbHVlKSwgJ251bWJlcicpID8gW3ZhbHVlXSA6IF90b0NvbnN1bWFibGVBcnJheSh2YWx1ZS5zcGxpdChjb2RlbGlzdC52YWx1ZVNlcGFyYXRvcikpOwogICAgICAgICAgICB2YWx1ZXMubWFwKGZ1bmN0aW9uICh2YWwsIG51bSkgewogICAgICAgICAgICAgIHZhciBpdGVtID0gX3RoaXM5LmdldEl0ZW0oaXRlbXMsIHZhbCwgY29kZWxpc3QpOwoKICAgICAgICAgICAgICBpZiAoaXRlbSkgewogICAgICAgICAgICAgICAgcmVzdWx0W2luZGV4XS5wdXNoKGl0ZW0pOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSk7CiAgICAgICAgICB9KTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgdmFyIHZhbHVlcyA9IE9iamVjdC5pcyh0aGlzLiR1dGlsLnR5cGVPZih2YWx1ZSksICdudW1iZXInKSA/IFt2YWx1ZV0gOiBfdG9Db25zdW1hYmxlQXJyYXkodmFsdWUuc3BsaXQoY29kZWxpc3QudmFsdWVTZXBhcmF0b3IpKTsKICAgICAgICAgIHZhbHVlcy5tYXAoZnVuY3Rpb24gKHZhbHVlLCBpbmRleCkgewogICAgICAgICAgICB2YXIgaXRlbSA9IF90aGlzOS5nZXRJdGVtKGl0ZW1zLCB2YWx1ZSwgY29kZWxpc3QpOwoKICAgICAgICAgICAgaWYgKGl0ZW0pIHsKICAgICAgICAgICAgICByZXN1bHQucHVzaChpdGVtKTsKICAgICAgICAgICAgfQogICAgICAgICAgfSk7CiAgICAgICAgfSAvLyDorr7nva5pdGVtcwoKCiAgICAgICAgaWYgKHJlc3VsdC5sZW5ndGggIT0gMCkgewogICAgICAgICAgcmV0dXJuIHJlc3VsdC5qb2luKGNvZGVsaXN0LnZhbHVlU2VwYXJhdG9yKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgcmV0dXJuIHZhbHVlOwogICAgICAgIH0KICAgICAgfQogICAgfQogICAgLyoqDQogICAgICog6I635Y+W5Luj56CB6aG5DQogICAgICoNCiAgICAgKiBAcHVibGljDQogICAgICogQHBhcmFtIHthbnlbXX0gaXRlbXMNCiAgICAgKiBAcGFyYW0geyp9IHZhbHVlDQogICAgICogQHJldHVybnMgeyp9DQogICAgICogQG1lbWJlcm9mIE1haW5CYXNlDQogICAgICovCgogIH0sIHsKICAgIGtleTogImdldEl0ZW0iLAogICAgdmFsdWU6IGZ1bmN0aW9uIGdldEl0ZW0oaXRlbXMsIHZhbHVlLCBjb2RlbGlzdCkgewogICAgICB2YXIgYXJyID0gaXRlbXMuZmlsdGVyKGZ1bmN0aW9uIChpdGVtKSB7CiAgICAgICAgcmV0dXJuIGl0ZW0udmFsdWUgPT0gdmFsdWU7CiAgICAgIH0pOwoKICAgICAgaWYgKGFyci5sZW5ndGggIT09IDEpIHsKICAgICAgICByZXR1cm4gdW5kZWZpbmVkOwogICAgICB9CgogICAgICBpZiAoT2JqZWN0LmlzKGNvZGVsaXN0LmNvZGVsaXN0VHlwZSwgJ1NUQVRJQycpKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuJHQoJ2NvZGVsaXN0LicgKyBjb2RlbGlzdC5zcmZrZXkgKyAnLicgKyBhcnJbMF0udmFsdWUpOwogICAgICB9IGVsc2UgewogICAgICAgIHJldHVybiBhcnJbMF0udGV4dDsKICAgICAgfQogICAgfQogICAgLyoqDQogICAgICog55Sf5ZG95ZGo5pyfDQogICAgICoNCiAgICAgKiBAbWVtYmVyb2YgTWFpbkJhc2UNCiAgICAgKi8KCiAgfSwgewogICAga2V5OiAiY3JlYXRlZCIsCiAgICB2YWx1ZTogZnVuY3Rpb24gY3JlYXRlZCgpIHsKICAgICAgdGhpcy5hZnRlckNyZWF0ZWQoKTsKICAgIH0KICAgIC8qKg0KICAgICAqIOaJp+ihjGNyZWF0ZWTlkI7nmoTpgLvovpENCiAgICAgKg0KICAgICAqICBAbWVtYmVyb2YgTWFpbkJhc2UNCiAgICAgKi8KCiAgfSwgewogICAga2V5OiAiYWZ0ZXJDcmVhdGVkIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBhZnRlckNyZWF0ZWQoKSB7CiAgICAgIHZhciBfdGhpczEwID0gdGhpczsKCiAgICAgIHRoaXMuc2V0Q29sU3RhdGUoKTsKCiAgICAgIGlmICh0aGlzLnZpZXdTdGF0ZSkgewogICAgICAgIHRoaXMudmlld1N0YXRlRXZlbnQgPSB0aGlzLnZpZXdTdGF0ZS5zdWJzY3JpYmUoZnVuY3Rpb24gKF9yZWYzKSB7CiAgICAgICAgICB2YXIgdGFnID0gX3JlZjMudGFnLAogICAgICAgICAgICAgIGFjdGlvbiA9IF9yZWYzLmFjdGlvbiwKICAgICAgICAgICAgICBkYXRhID0gX3JlZjMuZGF0YTsKCiAgICAgICAgICBpZiAoIU9iamVjdC5pcyh0YWcsIF90aGlzMTAubmFtZSkpIHsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgfQoKICAgICAgICAgIGlmIChPYmplY3QuaXMoJ2xvYWQnLCBhY3Rpb24pKSB7CiAgICAgICAgICAgIF90aGlzMTAubG9hZChkYXRhKTsKICAgICAgICAgIH0KCiAgICAgICAgICBpZiAoT2JqZWN0LmlzKCdyZW1vdmUnLCBhY3Rpb24pKSB7CiAgICAgICAgICAgIF90aGlzMTAucmVtb3ZlKGRhdGEpOwogICAgICAgICAgfQoKICAgICAgICAgIGlmIChPYmplY3QuaXMoJ3NhdmUnLCBhY3Rpb24pKSB7CiAgICAgICAgICAgIF90aGlzMTAuc2F2ZShkYXRhKTsKICAgICAgICAgIH0KICAgICAgICB9KTsKICAgICAgfQogICAgfQogICAgLyoqDQogICAgICogdnVlIOeUn+WRveWRqOacnw0KICAgICAqDQogICAgICogQG1lbWJlcm9mIE1haW5CYXNlDQogICAgICovCgogIH0sIHsKICAgIGtleTogImRlc3Ryb3llZCIsCiAgICB2YWx1ZTogZnVuY3Rpb24gZGVzdHJveWVkKCkgewogICAgICB0aGlzLmFmdGVyRGVzdHJveSgpOwogICAgfQogICAgLyoqDQogICAgICog5omn6KGMZGVzdHJveWVk5ZCO55qE6YC76L6RDQogICAgICoNCiAgICAgKiBAbWVtYmVyb2YgTWFpbkJhc2UNCiAgICAgKi8KCiAgfSwgewogICAga2V5OiAiYWZ0ZXJEZXN0cm95IiwKICAgIHZhbHVlOiBmdW5jdGlvbiBhZnRlckRlc3Ryb3koKSB7CiAgICAgIGlmICh0aGlzLnZpZXdTdGF0ZUV2ZW50KSB7CiAgICAgICAgdGhpcy52aWV3U3RhdGVFdmVudC51bnN1YnNjcmliZSgpOwogICAgICB9CiAgICB9CiAgICAvKioNCiAgICAgKiDojrflj5bpgInkuK3ooYzog6HmlbDmja4NCiAgICAgKg0KICAgICAqIEByZXR1cm5zIHthbnlbXX0NCiAgICAgKiBAbWVtYmVyb2YgTWFpbkJhc2UNCiAgICAgKi8KCiAgfSwgewogICAga2V5OiAiZ2V0U2VsZWN0aW9uIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBnZXRTZWxlY3Rpb24oKSB7CiAgICAgIHJldHVybiB0aGlzLnNlbGVjdGlvbnM7CiAgICB9CiAgICAvKioNCiAgICAgKiDooYzlj4zlh7vkuovku7YNCiAgICAgKg0KICAgICAqIEBwYXJhbSB7Kn0gJGV2ZW50DQogICAgICogQHJldHVybnMge3ZvaWR9DQogICAgICogQG1lbWJlcm9mIE1haW5CYXNlDQogICAgICovCgogIH0sIHsKICAgIGtleTogInJvd0RCTENsaWNrIiwKICAgIHZhbHVlOiBmdW5jdGlvbiByb3dEQkxDbGljaygkZXZlbnQpIHsKICAgICAgaWYgKCEkZXZlbnQgfHwgdGhpcy5hY3R1YWxJc09wZW5FZGl0IHx8IE9iamVjdC5pcyh0aGlzLmdyaWRSb3dBY3RpdmVNb2RlLCAwKSkgewogICAgICAgIHJldHVybjsKICAgICAgfQoKICAgICAgdGhpcy5zZWxlY3Rpb25zID0gW107CiAgICAgIHRoaXMuc2VsZWN0aW9ucy5wdXNoKEpTT04ucGFyc2UoSlNPTi5zdHJpbmdpZnkoJGV2ZW50KSkpOwogICAgICB2YXIgcmVmcyA9IHRoaXMuJHJlZnM7CgogICAgICBpZiAocmVmcy5tdWx0aXBsZVRhYmxlKSB7CiAgICAgICAgcmVmcy5tdWx0aXBsZVRhYmxlLmNsZWFyU2VsZWN0aW9uKCk7CiAgICAgICAgcmVmcy5tdWx0aXBsZVRhYmxlLnRvZ2dsZVJvd1NlbGVjdGlvbigkZXZlbnQpOwogICAgICB9CgogICAgICB0aGlzLiRlbWl0KCdyb3dkYmxjbGljaycsIHRoaXMuc2VsZWN0aW9ucyk7CiAgICAgIHRoaXMuJGVtaXQoJ3NlbGVjdGlvbmNoYW5nZScsIHRoaXMuc2VsZWN0aW9ucyk7CiAgICB9CiAgICAvKioNCiAgICAgKiDlpI3pgInmoYbmlbDmja7pgInkuK0NCiAgICAgKg0KICAgICAqIEBwYXJhbSB7Kn0gJGV2ZW50DQogICAgICogQHJldHVybnMge3ZvaWR9DQogICAgICogQG1lbWJlcm9mIE1haW5CYXNlDQogICAgICovCgogIH0sIHsKICAgIGtleTogInNlbGVjdCIsCiAgICB2YWx1ZTogZnVuY3Rpb24gc2VsZWN0KCRldmVudCkgewogICAgICBpZiAoISRldmVudCkgewogICAgICAgIHJldHVybjsKICAgICAgfQoKICAgICAgdGhpcy5zZWxlY3Rpb25zID0gW107CiAgICAgIHRoaXMuc2VsZWN0aW9ucyA9IF90b0NvbnN1bWFibGVBcnJheShKU09OLnBhcnNlKEpTT04uc3RyaW5naWZ5KCRldmVudCkpKTsKICAgICAgdGhpcy4kZW1pdCgnc2VsZWN0aW9uY2hhbmdlJywgdGhpcy5zZWxlY3Rpb25zKTsKICAgIH0KICAgIC8qKg0KICAgICAqIOWkjemAieahhuaVsOaNruWFqOmDqOmAieS4rQ0KICAgICAqDQogICAgICogQHBhcmFtIHsqfSAkZXZlbnQNCiAgICAgKiBAbWVtYmVyb2YgTWFpbkJhc2UNCiAgICAgKi8KCiAgfSwgewogICAga2V5OiAic2VsZWN0QWxsIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBzZWxlY3RBbGwoJGV2ZW50KSB7CiAgICAgIGlmICghJGV2ZW50KSB7CiAgICAgICAgcmV0dXJuOwogICAgICB9CgogICAgICB0aGlzLnNlbGVjdGlvbnMgPSBbXTsKICAgICAgdGhpcy5zZWxlY3Rpb25zID0gX3RvQ29uc3VtYWJsZUFycmF5KEpTT04ucGFyc2UoSlNPTi5zdHJpbmdpZnkoJGV2ZW50KSkpOwogICAgICB0aGlzLiRlbWl0KCdzZWxlY3Rpb25jaGFuZ2UnLCB0aGlzLnNlbGVjdGlvbnMpOwogICAgfQogICAgLyoqDQogICAgICog6KGM5Y2V5Ye76YCJ5LitDQogICAgICoNCiAgICAgKiBAcGFyYW0geyp9ICRldmVudA0KICAgICAqIEByZXR1cm5zIHt2b2lkfQ0KICAgICAqIEBtZW1iZXJvZiBNYWluQmFzZQ0KICAgICAqLwoKICB9LCB7CiAgICBrZXk6ICJyb3dDbGljayIsCiAgICB2YWx1ZTogZnVuY3Rpb24gcm93Q2xpY2soJGV2ZW50KSB7CiAgICAgIHZhciBpZkFsd2F5cyA9IGFyZ3VtZW50cy5sZW5ndGggPiAxICYmIGFyZ3VtZW50c1sxXSAhPT0gdW5kZWZpbmVkID8gYXJndW1lbnRzWzFdIDogZmFsc2U7CgogICAgICBpZiAoIWlmQWx3YXlzICYmICghJGV2ZW50IHx8IHRoaXMuYWN0dWFsSXNPcGVuRWRpdCkpIHsKICAgICAgICByZXR1cm47CiAgICAgIH0KCiAgICAgIGlmICh0aGlzLnN0b3BSb3dDbGljaykgewogICAgICAgIHRoaXMuc3RvcFJvd0NsaWNrID0gZmFsc2U7CiAgICAgICAgcmV0dXJuOwogICAgICB9CgogICAgICBpZiAodGhpcy5pc1NpbmdsZVNlbGVjdCkgewogICAgICAgIHRoaXMuc2VsZWN0aW9ucyA9IFtdOwogICAgICB9IC8vIOW3sumAieS4reWImeWIoOmZpO+8jOayoemAieS4reWImea3u+WKoAoKCiAgICAgIHZhciBzZWxlY3RJbmRleCA9IHRoaXMuc2VsZWN0aW9ucy5maW5kSW5kZXgoZnVuY3Rpb24gKGl0ZW0pIHsKICAgICAgICByZXR1cm4gT2JqZWN0LmlzKGl0ZW0ucGltcmV3YXJkcHVuaXNobWVudCwgJGV2ZW50LnBpbXJld2FyZHB1bmlzaG1lbnQpOwogICAgICB9KTsKCiAgICAgIGlmIChPYmplY3QuaXMoc2VsZWN0SW5kZXgsIC0xKSkgewogICAgICAgIHRoaXMuc2VsZWN0aW9ucy5wdXNoKEpTT04ucGFyc2UoSlNPTi5zdHJpbmdpZnkoJGV2ZW50KSkpOwogICAgICB9IGVsc2UgewogICAgICAgIHRoaXMuc2VsZWN0aW9ucy5zcGxpY2Uoc2VsZWN0SW5kZXgsIDEpOwogICAgICB9CgogICAgICB2YXIgcmVmcyA9IHRoaXMuJHJlZnM7CgogICAgICBpZiAocmVmcy5tdWx0aXBsZVRhYmxlKSB7CiAgICAgICAgaWYgKHRoaXMuaXNTaW5nbGVTZWxlY3QpIHsKICAgICAgICAgIHJlZnMubXVsdGlwbGVUYWJsZS5jbGVhclNlbGVjdGlvbigpOwogICAgICAgICAgcmVmcy5tdWx0aXBsZVRhYmxlLnNldEN1cnJlbnRSb3coJGV2ZW50KTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgcmVmcy5tdWx0aXBsZVRhYmxlLnRvZ2dsZVJvd1NlbGVjdGlvbigkZXZlbnQpOwogICAgICAgIH0KICAgICAgfQoKICAgICAgdGhpcy4kZW1pdCgnc2VsZWN0aW9uY2hhbmdlJywgdGhpcy5zZWxlY3Rpb25zKTsKICAgIH0KICAgIC8qKg0KICAgICAqIOmhtemdouWPmOWMlg0KICAgICAqDQogICAgICogQHBhcmFtIHsqfSAkZXZlbnQNCiAgICAgKiBAcmV0dXJucyB7dm9pZH0NCiAgICAgKiBAbWVtYmVyb2YgTWFpbkJhc2UNCiAgICAgKi8KCiAgfSwgewogICAga2V5OiAicGFnZU9uQ2hhbmdlIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBwYWdlT25DaGFuZ2UoJGV2ZW50KSB7CiAgICAgIGlmICghJGV2ZW50KSB7CiAgICAgICAgcmV0dXJuOwogICAgICB9CgogICAgICBpZiAoJGV2ZW50ID09PSB0aGlzLmN1clBhZ2UpIHsKICAgICAgICByZXR1cm47CiAgICAgIH0KCiAgICAgIHRoaXMuY3VyUGFnZSA9ICRldmVudDsKICAgICAgdGhpcy5sb2FkKHt9KTsKICAgIH0KICAgIC8qKg0KICAgICAqIOWIhumhteadoeaVsOWPmOWMlg0KICAgICAqDQogICAgICogQHBhcmFtIHsqfSAkZXZlbnQNCiAgICAgKiBAcmV0dXJucyB7dm9pZH0NCiAgICAgKiBAbWVtYmVyb2YgTWFpbkJhc2UNCiAgICAgKi8KCiAgfSwgewogICAga2V5OiAib25QYWdlU2l6ZUNoYW5nZSIsCiAgICB2YWx1ZTogZnVuY3Rpb24gb25QYWdlU2l6ZUNoYW5nZSgkZXZlbnQpIHsKICAgICAgaWYgKCEkZXZlbnQpIHsKICAgICAgICByZXR1cm47CiAgICAgIH0KCiAgICAgIGlmICgkZXZlbnQgPT09IHRoaXMubGltaXQpIHsKICAgICAgICByZXR1cm47CiAgICAgIH0KCiAgICAgIHRoaXMubGltaXQgPSAkZXZlbnQ7CgogICAgICBpZiAodGhpcy5jdXJQYWdlID09PSAxKSB7CiAgICAgICAgdGhpcy5sb2FkKHt9KTsKICAgICAgfQogICAgfQogICAgLyoqDQogICAgICog5YiG6aG15Yi35pawDQogICAgICoNCiAgICAgKiBAbWVtYmVyb2YgTWFpbkJhc2UNCiAgICAgKi8KCiAgfSwgewogICAga2V5OiAicGFnZVJlZnJlc2giLAogICAgdmFsdWU6IGZ1bmN0aW9uIHBhZ2VSZWZyZXNoKCkgewogICAgICB0aGlzLmxvYWQoe30pOwogICAgfQogICAgLyoqDQogICAgICog5o6S5bqP5Y+Y5YyWDQogICAgICoNCiAgICAgKiBAcGFyYW0ge3sgY29sdW1uOiBhbnksIHByb3A6IGFueSwgb3JkZXI6IGFueSB9fSB7IGNvbHVtbiwgcHJvcCwgb3JkZXIgfQ0KICAgICAqIEBtZW1iZXJvZiBNYWluQmFzZQ0KICAgICAqLwoKICB9LCB7CiAgICBrZXk6ICJvblNvcnRDaGFuZ2UiLAogICAgdmFsdWU6IGZ1bmN0aW9uIG9uU29ydENoYW5nZShfcmVmNCkgewogICAgICB2YXIgY29sdW1uID0gX3JlZjQuY29sdW1uLAogICAgICAgICAgcHJvcCA9IF9yZWY0LnByb3AsCiAgICAgICAgICBvcmRlciA9IF9yZWY0Lm9yZGVyOwogICAgICB2YXIgZGlyID0gT2JqZWN0LmlzKG9yZGVyLCAnYXNjZW5kaW5nJykgPyAnYXNjJyA6IE9iamVjdC5pcyhvcmRlciwgJ2Rlc2NlbmRpbmcnKSA/ICdkZXNjJyA6ICcnOwoKICAgICAgaWYgKE9iamVjdC5pcyhkaXIsIHRoaXMubWlub3JTb3J0RGlyKSAmJiBPYmplY3QuaXModGhpcy5taW5vclNvcnRQU0RFRiwgcHJvcCkpIHsKICAgICAgICByZXR1cm47CiAgICAgIH0KCiAgICAgIHRoaXMubWlub3JTb3J0RGlyID0gZGlyOwogICAgICB0aGlzLm1pbm9yU29ydFBTREVGID0gcHJvcCA/IHByb3AgOiAnJzsKICAgICAgdGhpcy5sb2FkKHt9KTsKICAgIH0KICAgIC8qKg0KICAgICAqIOihqOagvOihjOmAieS4reagt+W8jw0KICAgICAqDQogICAgICogQHBhcmFtIHt7IHJvdzogYW55LCByb3dJbmRleDogYW55IH19IHsgcm93LCByb3dJbmRleCB9DQogICAgICogQHJldHVybnMge3N0cmluZ30NCiAgICAgKiBAbWVtYmVyb2YgTWFpbkJhc2UNCiAgICAgKi8KCiAgfSwgewogICAga2V5OiAib25Sb3dDbGFzc05hbWUiLAogICAgdmFsdWU6IGZ1bmN0aW9uIG9uUm93Q2xhc3NOYW1lKF9yZWY1KSB7CiAgICAgIHZhciByb3cgPSBfcmVmNS5yb3csCiAgICAgICAgICByb3dJbmRleCA9IF9yZWY1LnJvd0luZGV4OwogICAgICB2YXIgaW5kZXggPSB0aGlzLnNlbGVjdGlvbnMuZmluZEluZGV4KGZ1bmN0aW9uIChzZWxlY3QpIHsKICAgICAgICByZXR1cm4gT2JqZWN0LmlzKHNlbGVjdC5zcmZrZXksIHJvdy5zcmZrZXkpOwogICAgICB9KTsKICAgICAgcmV0dXJuIGluZGV4ICE9PSAtMSA/ICdncmlkLXJvdy1zZWxlY3QnIDogJyc7CiAgICB9CiAgICAvKioNCiAgICAgKiDnlYzpnaLooYzkuLoNCiAgICAgKg0KICAgICAqIEBwYXJhbSB7Kn0gcm93DQogICAgICogQHBhcmFtIHsqfSB0YWcNCiAgICAgKiBAcGFyYW0geyp9ICRldmVudA0KICAgICAqIEBtZW1iZXJvZiBNYWluQmFzZQ0KICAgICAqLwoKICB9LCB7CiAgICBrZXk6ICJ1aUFjdGlvbiIsCiAgICB2YWx1ZTogZnVuY3Rpb24gdWlBY3Rpb24ocm93LCB0YWcsICRldmVudCkgewogICAgICAvLyB0aGlzLnJvd0NsaWNrKHJvdywgdHJ1ZSk7CiAgICAgICRldmVudC5zdG9wUHJvcGFnYXRpb24oKTsKICAgIH0KICAgIC8qKg0KICAgICAqIOiuvue9ruWIl+eKtuaAgQ0KICAgICAqDQogICAgICogQG1lbWJlcm9mIE1haW5CYXNlDQogICAgICovCgogIH0sIHsKICAgIGtleTogInNldENvbFN0YXRlIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBzZXRDb2xTdGF0ZSgpIHsKICAgICAgdmFyIF90aGlzMTEgPSB0aGlzOwoKICAgICAgdmFyIF9kYXRhID0gbG9jYWxTdG9yYWdlLmdldEl0ZW0oJ3BpbXJld2FyZHB1bmlzaG1lbnRfbWFpbl9ncmlkJyk7CgogICAgICBpZiAoX2RhdGEpIHsKICAgICAgICB2YXIgY29sdW1ucyA9IEpTT04ucGFyc2UoX2RhdGEpOwogICAgICAgIGNvbHVtbnMuZm9yRWFjaChmdW5jdGlvbiAoY29sKSB7CiAgICAgICAgICB2YXIgY29sdW1uID0gX3RoaXMxMS5hbGxDb2x1bW5zLmZpbmQoZnVuY3Rpb24gKGl0ZW0pIHsKICAgICAgICAgICAgcmV0dXJuIE9iamVjdC5pcyhjb2wubmFtZSwgaXRlbS5uYW1lKTsKICAgICAgICAgIH0pOwoKICAgICAgICAgIGlmIChjb2x1bW4pIHsKICAgICAgICAgICAgT2JqZWN0LmFzc2lnbihjb2x1bW4sIGNvbCk7CiAgICAgICAgICB9CiAgICAgICAgfSk7CiAgICAgIH0KICAgIH0KICAgIC8qKg0KICAgICAqIOWIl+WPmOWMlg0KICAgICAqDQogICAgICogQG1lbWJlcm9mIE1haW5CYXNlDQogICAgICovCgogIH0sIHsKICAgIGtleTogIm9uQ29sQ2hhbmdlIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBvbkNvbENoYW5nZSgpIHsKICAgICAgbG9jYWxTdG9yYWdlLnNldEl0ZW0oJ3BpbXJld2FyZHB1bmlzaG1lbnRfbWFpbl9ncmlkJywgSlNPTi5zdHJpbmdpZnkodGhpcy5hbGxDb2x1bW5zKSk7CiAgICB9CiAgICAvKioNCiAgICAgKiDojrflj5bliJfnirbmgIENCiAgICAgKg0KICAgICAqIEBwYXJhbSB7c3RyaW5nfSBuYW1lDQogICAgICogQHJldHVybnMge2Jvb2xlYW59DQogICAgICogQG1lbWJlcm9mIE1haW5CYXNlDQogICAgICovCgogIH0sIHsKICAgIGtleTogImdldENvbHVtblN0YXRlIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBnZXRDb2x1bW5TdGF0ZShuYW1lKSB7CiAgICAgIHZhciBjb2x1bW4gPSB0aGlzLmFsbENvbHVtbnMuZmluZChmdW5jdGlvbiAoY29sKSB7CiAgICAgICAgcmV0dXJuIE9iamVjdC5pcyhuYW1lLCBjb2wubmFtZSk7CiAgICAgIH0pOwogICAgICByZXR1cm4gY29sdW1uLnNob3cgPyB0cnVlIDogZmFsc2U7CiAgICB9CiAgICAvKioNCiAgICAgKiDooajmoLzliJfmmK/lkKboh6rpgILlupTluIPlsYANCiAgICAgKg0KICAgICAqIEByZWFkb25seQ0KICAgICAqIEB0eXBlIHtib29sZWFufQ0KICAgICAqIEBtZW1iZXJvZiBNYWluQmFzZQ0KICAgICAqLwoKICB9LCB7CiAgICBrZXk6ICJzYXZlIiwKCiAgICAvKioNCiAgICAgKiDkv53lrZgNCiAgICAgKg0KICAgICAqIEBwYXJhbSB7Kn0gJGV2ZW50DQogICAgICogQHJldHVybnMge1Byb21pc2U8YW55Pn0NCiAgICAgKiBAbWVtYmVyb2YgTWFpbkJhc2UNCiAgICAgKi8KICAgIHZhbHVlOiBmdW5jdGlvbiAoKSB7CiAgICAgIHZhciBfc2F2ZSA9IF9hc3luY1RvR2VuZXJhdG9yKAogICAgICAvKiNfX1BVUkVfXyovCiAgICAgIHJlZ2VuZXJhdG9yUnVudGltZS5tYXJrKGZ1bmN0aW9uIF9jYWxsZWU1KGFyZ3MsIHBhcmFtcywgJGV2ZW50LCB4RGF0YSkgewogICAgICAgIHZhciBfdGhpczEyID0gdGhpczsKCiAgICAgICAgdmFyIF90aGlzLCBzdWNjZXNzSXRlbXMsIGVycm9ySXRlbXMsIGVycm9yTWVzc2FnZSwgX2l0ZXJhdG9yTm9ybWFsQ29tcGxldGlvbjIsIF9kaWRJdGVyYXRvckVycm9yMiwgX2l0ZXJhdG9yRXJyb3IyLCBfaXRlcmF0b3IyLCBfc3RlcDIsIGl0ZW0sIHJlc3BvbnNlLCBfcmVzcG9uc2U7CgogICAgICAgIHJldHVybiByZWdlbmVyYXRvclJ1bnRpbWUud3JhcChmdW5jdGlvbiBfY2FsbGVlNSQoX2NvbnRleHQ2KSB7CiAgICAgICAgICB3aGlsZSAoMSkgewogICAgICAgICAgICBzd2l0Y2ggKF9jb250ZXh0Ni5wcmV2ID0gX2NvbnRleHQ2Lm5leHQpIHsKICAgICAgICAgICAgICBjYXNlIDA6CiAgICAgICAgICAgICAgICBfdGhpcyA9IHRoaXM7CiAgICAgICAgICAgICAgICBfY29udGV4dDYubmV4dCA9IDM7CiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy52YWxpZGF0ZUFsbCgpOwoKICAgICAgICAgICAgICBjYXNlIDM6CiAgICAgICAgICAgICAgICBpZiAoX2NvbnRleHQ2LnNlbnQpIHsKICAgICAgICAgICAgICAgICAgX2NvbnRleHQ2Lm5leHQgPSA2OwogICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICB0aGlzLiROb3RpY2UuZXJyb3IoewogICAgICAgICAgICAgICAgICB0aXRsZTogJ+mUmeivrycsCiAgICAgICAgICAgICAgICAgIGRlc2M6ICflgLzop4TliJnmoKHpqozlvILluLgnCiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDYuYWJydXB0KCJyZXR1cm4iLCBbXSk7CgogICAgICAgICAgICAgIGNhc2UgNjoKICAgICAgICAgICAgICAgIHN1Y2Nlc3NJdGVtcyA9IFtdOwogICAgICAgICAgICAgICAgZXJyb3JJdGVtcyA9IFtdOwogICAgICAgICAgICAgICAgZXJyb3JNZXNzYWdlID0gW107CiAgICAgICAgICAgICAgICBfaXRlcmF0b3JOb3JtYWxDb21wbGV0aW9uMiA9IHRydWU7CiAgICAgICAgICAgICAgICBfZGlkSXRlcmF0b3JFcnJvcjIgPSBmYWxzZTsKICAgICAgICAgICAgICAgIF9pdGVyYXRvckVycm9yMiA9IHVuZGVmaW5lZDsKICAgICAgICAgICAgICAgIF9jb250ZXh0Ni5wcmV2ID0gMTI7CiAgICAgICAgICAgICAgICBfaXRlcmF0b3IyID0gX3RoaXMuaXRlbXNbU3ltYm9sLml0ZXJhdG9yXSgpOwoKICAgICAgICAgICAgICBjYXNlIDE0OgogICAgICAgICAgICAgICAgaWYgKF9pdGVyYXRvck5vcm1hbENvbXBsZXRpb24yID0gKF9zdGVwMiA9IF9pdGVyYXRvcjIubmV4dCgpKS5kb25lKSB7CiAgICAgICAgICAgICAgICAgIF9jb250ZXh0Ni5uZXh0ID0gNDk7CiAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIGl0ZW0gPSBfc3RlcDIudmFsdWU7CiAgICAgICAgICAgICAgICBfY29udGV4dDYucHJldiA9IDE2OwoKICAgICAgICAgICAgICAgIGlmICghT2JqZWN0LmlzKGl0ZW0ucm93RGF0YVN0YXRlLCAnY3JlYXRlJykpIHsKICAgICAgICAgICAgICAgICAgX2NvbnRleHQ2Lm5leHQgPSAyOTsKICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgaWYgKHRoaXMuY3JlYXRlQWN0aW9uKSB7CiAgICAgICAgICAgICAgICAgIF9jb250ZXh0Ni5uZXh0ID0gMjI7CiAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIHRoaXMuJE5vdGljZS5lcnJvcih7CiAgICAgICAgICAgICAgICAgIHRpdGxlOiAn6ZSZ6K+vJywKICAgICAgICAgICAgICAgICAgZGVzYzogJ1BJTVJFV0FSRFBVTklTSE1FTlRQaW1KYW5nbEdyaWRWaWV36KeG5Zu+6KGo5qC8Y3JlYXRlQWN0aW9u5Y+C5pWw5pyq6YWN572uJwogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICBfY29udGV4dDYubmV4dCA9IDI3OwogICAgICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgICAgIGNhc2UgMjI6CiAgICAgICAgICAgICAgICBPYmplY3QuYXNzaWduKGl0ZW0sIHsKICAgICAgICAgICAgICAgICAgdmlld3BhcmFtczogdGhpcy52aWV3cGFyYW1zCiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIF9jb250ZXh0Ni5uZXh0ID0gMjU7CiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5zZXJ2aWNlLmFkZCh0aGlzLmNyZWF0ZUFjdGlvbiwgSlNPTi5wYXJzZShKU09OLnN0cmluZ2lmeSh0aGlzLmNvbnRleHQpKSwgaXRlbSwgdGhpcy5zaG93QnVzeUluZGljYXRvcik7CgogICAgICAgICAgICAgIGNhc2UgMjU6CiAgICAgICAgICAgICAgICByZXNwb25zZSA9IF9jb250ZXh0Ni5zZW50OwogICAgICAgICAgICAgICAgc3VjY2Vzc0l0ZW1zLnB1c2goSlNPTi5wYXJzZShKU09OLnN0cmluZ2lmeShyZXNwb25zZS5kYXRhKSkpOwoKICAgICAgICAgICAgICBjYXNlIDI3OgogICAgICAgICAgICAgICAgX2NvbnRleHQ2Lm5leHQgPSA0MDsKICAgICAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgICAgICBjYXNlIDI5OgogICAgICAgICAgICAgICAgaWYgKCFPYmplY3QuaXMoaXRlbS5yb3dEYXRhU3RhdGUsICd1cGRhdGUnKSkgewogICAgICAgICAgICAgICAgICBfY29udGV4dDYubmV4dCA9IDQwOwogICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBpZiAodGhpcy51cGRhdGVBY3Rpb24pIHsKICAgICAgICAgICAgICAgICAgX2NvbnRleHQ2Lm5leHQgPSAzNDsKICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgdGhpcy4kTm90aWNlLmVycm9yKHsKICAgICAgICAgICAgICAgICAgdGl0bGU6ICfplJnor68nLAogICAgICAgICAgICAgICAgICBkZXNjOiAnUElNUkVXQVJEUFVOSVNITUVOVFBpbUphbmdsR3JpZFZpZXfop4blm77ooajmoLx1cGRhdGVBY3Rpb27lj4LmlbDmnKrphY3nva4nCiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIF9jb250ZXh0Ni5uZXh0ID0gNDA7CiAgICAgICAgICAgICAgICBicmVhazsKCiAgICAgICAgICAgICAgY2FzZSAzNDoKICAgICAgICAgICAgICAgIE9iamVjdC5hc3NpZ24oaXRlbSwgewogICAgICAgICAgICAgICAgICB2aWV3cGFyYW1zOiB0aGlzLnZpZXdwYXJhbXMKICAgICAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgICAgIGlmIChpdGVtLnBpbXJld2FyZHB1bmlzaG1lbnQpIHsKICAgICAgICAgICAgICAgICAgT2JqZWN0LmFzc2lnbih0aGlzLmNvbnRleHQsIHsKICAgICAgICAgICAgICAgICAgICBwaW1yZXdhcmRwdW5pc2htZW50OiBpdGVtLnBpbXJld2FyZHB1bmlzaG1lbnQKICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgX2NvbnRleHQ2Lm5leHQgPSAzODsKICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLnNlcnZpY2UuYWRkKHRoaXMudXBkYXRlQWN0aW9uLCBKU09OLnBhcnNlKEpTT04uc3RyaW5naWZ5KHRoaXMuY29udGV4dCkpLCBpdGVtLCB0aGlzLnNob3dCdXN5SW5kaWNhdG9yKTsKCiAgICAgICAgICAgICAgY2FzZSAzODoKICAgICAgICAgICAgICAgIF9yZXNwb25zZSA9IF9jb250ZXh0Ni5zZW50OwogICAgICAgICAgICAgICAgc3VjY2Vzc0l0ZW1zLnB1c2goSlNPTi5wYXJzZShKU09OLnN0cmluZ2lmeShfcmVzcG9uc2UuZGF0YSkpKTsKCiAgICAgICAgICAgICAgY2FzZSA0MDoKICAgICAgICAgICAgICAgIF9jb250ZXh0Ni5uZXh0ID0gNDY7CiAgICAgICAgICAgICAgICBicmVhazsKCiAgICAgICAgICAgICAgY2FzZSA0MjoKICAgICAgICAgICAgICAgIF9jb250ZXh0Ni5wcmV2ID0gNDI7CiAgICAgICAgICAgICAgICBfY29udGV4dDYudDAgPSBfY29udGV4dDZbImNhdGNoIl0oMTYpOwogICAgICAgICAgICAgICAgZXJyb3JJdGVtcy5wdXNoKEpTT04ucGFyc2UoSlNPTi5zdHJpbmdpZnkoaXRlbSkpKTsKICAgICAgICAgICAgICAgIGVycm9yTWVzc2FnZS5wdXNoKF9jb250ZXh0Ni50MCk7CgogICAgICAgICAgICAgIGNhc2UgNDY6CiAgICAgICAgICAgICAgICBfaXRlcmF0b3JOb3JtYWxDb21wbGV0aW9uMiA9IHRydWU7CiAgICAgICAgICAgICAgICBfY29udGV4dDYubmV4dCA9IDE0OwogICAgICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgICAgIGNhc2UgNDk6CiAgICAgICAgICAgICAgICBfY29udGV4dDYubmV4dCA9IDU1OwogICAgICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgICAgIGNhc2UgNTE6CiAgICAgICAgICAgICAgICBfY29udGV4dDYucHJldiA9IDUxOwogICAgICAgICAgICAgICAgX2NvbnRleHQ2LnQxID0gX2NvbnRleHQ2WyJjYXRjaCJdKDEyKTsKICAgICAgICAgICAgICAgIF9kaWRJdGVyYXRvckVycm9yMiA9IHRydWU7CiAgICAgICAgICAgICAgICBfaXRlcmF0b3JFcnJvcjIgPSBfY29udGV4dDYudDE7CgogICAgICAgICAgICAgIGNhc2UgNTU6CiAgICAgICAgICAgICAgICBfY29udGV4dDYucHJldiA9IDU1OwogICAgICAgICAgICAgICAgX2NvbnRleHQ2LnByZXYgPSA1NjsKCiAgICAgICAgICAgICAgICBpZiAoIV9pdGVyYXRvck5vcm1hbENvbXBsZXRpb24yICYmIF9pdGVyYXRvcjJbInJldHVybiJdICE9IG51bGwpIHsKICAgICAgICAgICAgICAgICAgX2l0ZXJhdG9yMlsicmV0dXJuIl0oKTsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgY2FzZSA1ODoKICAgICAgICAgICAgICAgIF9jb250ZXh0Ni5wcmV2ID0gNTg7CgogICAgICAgICAgICAgICAgaWYgKCFfZGlkSXRlcmF0b3JFcnJvcjIpIHsKICAgICAgICAgICAgICAgICAgX2NvbnRleHQ2Lm5leHQgPSA2MTsKICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgdGhyb3cgX2l0ZXJhdG9yRXJyb3IyOwoKICAgICAgICAgICAgICBjYXNlIDYxOgogICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0Ni5maW5pc2goNTgpOwoKICAgICAgICAgICAgICBjYXNlIDYyOgogICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0Ni5maW5pc2goNTUpOwoKICAgICAgICAgICAgICBjYXNlIDYzOgogICAgICAgICAgICAgICAgdGhpcy4kZW1pdCgnc2F2ZScsIHN1Y2Nlc3NJdGVtcyk7CiAgICAgICAgICAgICAgICB0aGlzLnJlZnJlc2goW10pOwoKICAgICAgICAgICAgICAgIGlmIChlcnJvckl0ZW1zLmxlbmd0aCA9PT0gMCkgewogICAgICAgICAgICAgICAgICB0aGlzLiROb3RpY2Uuc3VjY2Vzcyh7CiAgICAgICAgICAgICAgICAgICAgdGl0bGU6ICcnLAogICAgICAgICAgICAgICAgICAgIGRlc2M6ICfkv53lrZjmiJDlip8hJwogICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgIGVycm9ySXRlbXMuZm9yRWFjaChmdW5jdGlvbiAoaXRlbSwgaW5kZXgpIHsKICAgICAgICAgICAgICAgICAgICBfdGhpczEyLiROb3RpY2UuZXJyb3IoewogICAgICAgICAgICAgICAgICAgICAgdGl0bGU6ICfkv53lrZjlpLHotKUnLAogICAgICAgICAgICAgICAgICAgICAgZGVzYzogaXRlbS5tYWpvcmVudGl0eW5hbWUgKyAn5L+d5a2Y5aSx6LSl77yBJwogICAgICAgICAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmVycm9yKGVycm9yTWVzc2FnZVtpbmRleF0pOwogICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQ2LmFicnVwdCgicmV0dXJuIiwgc3VjY2Vzc0l0ZW1zKTsKCiAgICAgICAgICAgICAgY2FzZSA2NzoKICAgICAgICAgICAgICBjYXNlICJlbmQiOgogICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0Ni5zdG9wKCk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9LCBfY2FsbGVlNSwgdGhpcywgW1sxMiwgNTEsIDU1LCA2M10sIFsxNiwgNDJdLCBbNTYsLCA1OCwgNjJdXSk7CiAgICAgIH0pKTsKCiAgICAgIGZ1bmN0aW9uIHNhdmUoX3g1LCBfeDYsIF94NywgX3g4KSB7CiAgICAgICAgcmV0dXJuIF9zYXZlLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7CiAgICAgIH0KCiAgICAgIHJldHVybiBzYXZlOwogICAgfSgpCiAgICAvKioNCiAgICAgKiDmlrDlu7rooYwNCiAgICAgKg0KICAgICAqIEBwYXJhbSB7Kn0gJGV2ZW50DQogICAgICogQHJldHVybnMge3ZvaWR9DQogICAgICogQG1lbWJlcm9mIE1haW5CYXNlDQogICAgICovCgogIH0sIHsKICAgIGtleTogIm5ld1JvdyIsCiAgICB2YWx1ZTogZnVuY3Rpb24gbmV3Um93KGFyZ3MsIHBhcmFtcywgJGV2ZW50LCB4RGF0YSkgewogICAgICB2YXIgX3RoaXMxMyA9IHRoaXM7CgogICAgICBpZiAoIXRoaXMubG9hZGRyYWZ0QWN0aW9uKSB7CiAgICAgICAgdGhpcy4kTm90aWNlLmVycm9yKHsKICAgICAgICAgIHRpdGxlOiAn6ZSZ6K+vJywKICAgICAgICAgIGRlc2M6ICdQSU1SRVdBUkRQVU5JU0hNRU5UUGltSmFuZ2xHcmlkVmlld+inhuWbvuihqOagvGxvYWRkcmFmdEFjdGlvbuWPguaVsOacqumFjee9ricKICAgICAgICB9KTsKICAgICAgICByZXR1cm47CiAgICAgIH0KCiAgICAgIHZhciBfdGhpcyA9IHRoaXM7CgogICAgICBPYmplY3QuYXNzaWduKGFyZ3NbMF0sIHsKICAgICAgICB2aWV3cGFyYW1zOiB0aGlzLnZpZXdwYXJhbXMKICAgICAgfSk7CiAgICAgIHZhciBwb3N0ID0gdGhpcy5zZXJ2aWNlLmxvYWREcmFmdCh0aGlzLmxvYWRkcmFmdEFjdGlvbiwgSlNPTi5wYXJzZShKU09OLnN0cmluZ2lmeSh0aGlzLmNvbnRleHQpKSwgYXJnc1swXSwgdGhpcy5zaG93QnVzeUluZGljYXRvcik7CiAgICAgIHBvc3QudGhlbihmdW5jdGlvbiAocmVzcG9uc2UpIHsKICAgICAgICBpZiAoIXJlc3BvbnNlLnN0YXR1cyB8fCByZXNwb25zZS5zdGF0dXMgIT09IDIwMCkgewogICAgICAgICAgaWYgKHJlc3BvbnNlLmVycm9yTWVzc2FnZSkgewogICAgICAgICAgICBfdGhpczEzLiROb3RpY2UuZXJyb3IoewogICAgICAgICAgICAgIHRpdGxlOiAn6ZSZ6K+vJywKICAgICAgICAgICAgICBkZXNjOiByZXNwb25zZS5lcnJvck1lc3NhZ2UKICAgICAgICAgICAgfSk7CiAgICAgICAgICB9CgogICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KCiAgICAgICAgdmFyIGRhdGEgPSByZXNwb25zZS5kYXRhOwoKICAgICAgICBfdGhpczEzLmNyZWF0ZURlZmF1bHQoZGF0YSk7CgogICAgICAgIGRhdGEucm93RGF0YVN0YXRlID0gImNyZWF0ZSI7CgogICAgICAgIF90aGlzLml0ZW1zLnB1c2goZGF0YSk7CgogICAgICAgIF90aGlzLmdyaWRJdGVtc01vZGVsLnB1c2goX3RoaXMuZ2V0R3JpZFJvd01vZGVsKCkpOwogICAgICB9KVsiY2F0Y2giXShmdW5jdGlvbiAocmVzcG9uc2UpIHsKICAgICAgICBpZiAocmVzcG9uc2UgJiYgcmVzcG9uc2Uuc3RhdHVzID09PSA0MDEpIHsKICAgICAgICAgIHJldHVybjsKICAgICAgICB9CgogICAgICAgIGlmICghcmVzcG9uc2UgfHwgIXJlc3BvbnNlLnN0YXR1cyB8fCAhcmVzcG9uc2UuZGF0YSkgewogICAgICAgICAgX3RoaXMxMy4kTm90aWNlLmVycm9yKHsKICAgICAgICAgICAgdGl0bGU6ICfplJnor68nLAogICAgICAgICAgICBkZXNjOiAn57O757uf5byC5bi4JwogICAgICAgICAgfSk7CgogICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KICAgICAgfSk7CiAgICB9CiAgICAvKioNCiAgICAgKiDooajmoLznvJbovpHpobnlgLzlj5jmm7QNCiAgICAgKg0KICAgICAqIEBwYXJhbSByb3cg6KGM5pWw5o2uDQogICAgICogQHBhcmFtIHt7IG5hbWU6IHN0cmluZywgdmFsdWU6IGFueSB9fSAkZXZlbnQNCiAgICAgKiBAcmV0dXJucyB7dm9pZH0NCiAgICAgKiBAbWVtYmVyb2YgTWFpbkJhc2UNCiAgICAgKi8KCiAgfSwgewogICAga2V5OiAib25HcmlkSXRlbVZhbHVlQ2hhbmdlIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBvbkdyaWRJdGVtVmFsdWVDaGFuZ2Uocm93LCAkZXZlbnQsIHJvd0luZGV4KSB7CiAgICAgIGlmICghJGV2ZW50KSB7CiAgICAgICAgcmV0dXJuOwogICAgICB9CgogICAgICBpZiAoISRldmVudC5uYW1lIHx8IE9iamVjdC5pcygkZXZlbnQubmFtZSwgJycpIHx8ICFyb3cuaGFzT3duUHJvcGVydHkoJGV2ZW50Lm5hbWUpKSB7CiAgICAgICAgcmV0dXJuOwogICAgICB9CgogICAgICByb3dbJGV2ZW50Lm5hbWVdID0gJGV2ZW50LnZhbHVlOwogICAgICB0aGlzLmdyaWRFZGl0SXRlbUNoYW5nZShyb3csICRldmVudC5uYW1lLCAkZXZlbnQudmFsdWUsIHJvd0luZGV4KTsKICAgIH0KICAgIC8qKg0KICAgICAqIOihqOagvOe8lui+kemhueWAvOWPmOWMlg0KICAgICAqDQogICAgICogQHB1YmxpYw0KICAgICAqIEBwYXJhbSByb3cg6KGM5pWw5o2uDQogICAgICogQHBhcmFtIHByb3BlcnR5IOWIl+e8lui+kemhueWQjQ0KICAgICAqIEBwYXJhbSByb3cg5YiX57yW6L6R6aG55YC8DQogICAgICogQHJldHVybnMge3ZvaWR9DQogICAgICogQG1lbWJlcm9mIE1haW5CYXNlDQogICAgICovCgogIH0sIHsKICAgIGtleTogImdyaWRFZGl0SXRlbUNoYW5nZSIsCiAgICB2YWx1ZTogZnVuY3Rpb24gZ3JpZEVkaXRJdGVtQ2hhbmdlKHJvdywgcHJvcGVydHksIHZhbHVlLCByb3dJbmRleCkgewogICAgICByb3cucm93RGF0YVN0YXRlID0gcm93LnJvd0RhdGFTdGF0ZSA/IHJvdy5yb3dEYXRhU3RhdGUgOiAidXBkYXRlIjsKICAgICAgdGhpcy52YWxpZGF0ZShwcm9wZXJ0eSwgcm93LCByb3dJbmRleCk7CiAgICB9CiAgICAvKioNCiAgICAgKiDooajmoLznvJbovpHpobnmm7TmlrANCiAgICAgKg0KICAgICAqIEBwYXJhbSB7c3RyaW5nfSBtb2RlIOeVjOmdouihjOS4uuWQjeensA0KICAgICAqIEBwYXJhbSB7Kn0gW2RhdGE9e31dIOivt+axguaVsOaNrg0KICAgICAqIEBwYXJhbSB7c3RyaW5nW119IHVwZGF0ZURldGFpbHMg5pu05paw6aG5DQogICAgICogQHBhcmFtIHtib29sZWFufSBbc2hvd2xvYWRpbmddIOaYr+WQpuaYvuekuuWKoOi9veeKtuaAgQ0KICAgICAqIEByZXR1cm5zIHt2b2lkfQ0KICAgICAqIEBtZW1iZXJvZiBNYWluQmFzZQ0KICAgICAqLwoKICB9LCB7CiAgICBrZXk6ICJ1cGRhdGVHcmlkRWRpdEl0ZW0iLAogICAgdmFsdWU6IGZ1bmN0aW9uIHVwZGF0ZUdyaWRFZGl0SXRlbShtb2RlKSB7CiAgICAgIHZhciBfdGhpczE0ID0gdGhpczsKCiAgICAgIHZhciBkYXRhID0gYXJndW1lbnRzLmxlbmd0aCA+IDEgJiYgYXJndW1lbnRzWzFdICE9PSB1bmRlZmluZWQgPyBhcmd1bWVudHNbMV0gOiB7fTsKICAgICAgdmFyIHVwZGF0ZURldGFpbHMgPSBhcmd1bWVudHMubGVuZ3RoID4gMiA/IGFyZ3VtZW50c1syXSA6IHVuZGVmaW5lZDsKICAgICAgdmFyIHNob3dsb2FkaW5nID0gYXJndW1lbnRzLmxlbmd0aCA+IDMgPyBhcmd1bWVudHNbM10gOiB1bmRlZmluZWQ7CgogICAgICBpZiAoIW1vZGUgfHwgbW9kZSAmJiBPYmplY3QuaXMobW9kZSwgJycpKSB7CiAgICAgICAgcmV0dXJuOwogICAgICB9CgogICAgICB2YXIgYXJnID0gSlNPTi5wYXJzZShKU09OLnN0cmluZ2lmeShkYXRhKSk7CiAgICAgIE9iamVjdC5hc3NpZ24oYXJnLCB7CiAgICAgICAgdmlld3BhcmFtczogdGhpcy52aWV3cGFyYW1zCiAgICAgIH0pOwogICAgICB2YXIgcG9zdCA9IHRoaXMuc2VydmljZS5mcm9udExvZ2ljKG1vZGUsIEpTT04ucGFyc2UoSlNPTi5zdHJpbmdpZnkodGhpcy5jb250ZXh0KSksIGFyZywgc2hvd2xvYWRpbmcpOwogICAgICBwb3N0LnRoZW4oZnVuY3Rpb24gKHJlc3BvbnNlKSB7CiAgICAgICAgaWYgKCFyZXNwb25zZSB8fCByZXNwb25zZS5zdGF0dXMgIT09IDIwMCkgewogICAgICAgICAgX3RoaXMxNC4kTm90aWNlLmVycm9yKHsKICAgICAgICAgICAgdGl0bGU6ICfplJnor68nLAogICAgICAgICAgICBkZXNjOiAn6KGo5Y2V6aG55pu05paw5aSx6LSlJwogICAgICAgICAgfSk7CgogICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KCiAgICAgICAgdmFyIF9kYXRhID0gcmVzcG9uc2UuZGF0YTsKCiAgICAgICAgaWYgKCFfZGF0YSkgewogICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KCiAgICAgICAgdXBkYXRlRGV0YWlscy5mb3JFYWNoKGZ1bmN0aW9uIChuYW1lKSB7CiAgICAgICAgICBpZiAoIV9kYXRhLmhhc093blByb3BlcnR5KG5hbWUpKSB7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgIH0KCiAgICAgICAgICBkYXRhW25hbWVdID0gX2RhdGFbbmFtZV07CiAgICAgICAgfSk7CiAgICAgIH0pWyJjYXRjaCJdKGZ1bmN0aW9uIChyZXNwb25zZSkgewogICAgICAgIGlmIChyZXNwb25zZSAmJiByZXNwb25zZS5zdGF0dXMgPT09IDQwMSkgewogICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KCiAgICAgICAgaWYgKCFyZXNwb25zZSB8fCAhcmVzcG9uc2Uuc3RhdHVzIHx8ICFyZXNwb25zZS5kYXRhKSB7CiAgICAgICAgICBfdGhpczE0LiROb3RpY2UuZXJyb3IoewogICAgICAgICAgICB0aXRsZTogJ+mUmeivrycsCiAgICAgICAgICAgIGRlc2M6ICfns7vnu5/lvILluLgnCiAgICAgICAgICB9KTsKCiAgICAgICAgICByZXR1cm47CiAgICAgICAgfQogICAgICB9KTsKICAgIH0KICAgIC8qKg0KICAgICAqIOiOt+WPluWvueW6lOihjGNsYXNzDQogICAgICoNCiAgICAgKiBAcGFyYW0geyp9ICRhcmdzIHJvdyDooYzmlbDmja7vvIxyb3dJbmRleCDooYzntKLlvJUNCiAgICAgKiBAcmV0dXJucyB7dm9pZH0NCiAgICAgKiBAbWVtYmVyb2YgTWFpbkJhc2UNCiAgICAgKi8KCiAgfSwgewogICAga2V5OiAiZ2V0Um93Q2xhc3NOYW1lIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBnZXRSb3dDbGFzc05hbWUoYXJncykgewogICAgICB2YXIgaXNTZWxlY3RlZCA9IHRoaXMuc2VsZWN0aW9ucy5zb21lKGZ1bmN0aW9uIChpdGVtKSB7CiAgICAgICAgcmV0dXJuIE9iamVjdC5pcyhpdGVtLnBpbXJld2FyZHB1bmlzaG1lbnQsIGFyZ3Mucm93LnBpbXJld2FyZHB1bmlzaG1lbnQpOwogICAgICB9KTsKICAgICAgcmV0dXJuIGlzU2VsZWN0ZWQgPyAiZ3JpZC1zZWxlY3RlZC1yb3ciIDogIiI7CiAgICB9CiAgICAvKioNCiAgICAgKiDojrflj5blr7nlupTliJdjbGFzcw0KICAgICAqDQogICAgICogQHBhcmFtIHsqfSAkYXJncyByb3cg6KGM5pWw5o2u77yMY29sdW1uIOWIl+aVsOaNru+8jHJvd0luZGV4IOihjOe0ouW8le+8jOWIl+e0ouW8lQ0KICAgICAqIEByZXR1cm5zIHt2b2lkfQ0KICAgICAqIEBtZW1iZXJvZiBNYWluQmFzZQ0KICAgICAqLwoKICB9LCB7CiAgICBrZXk6ICJnZXRDZWxsQ2xhc3NOYW1lIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBnZXRDZWxsQ2xhc3NOYW1lKGFyZ3MpIHsKICAgICAgdmFyIGhhc1Jvd0VkaXQgPSB7CiAgICAgICAgJ2psc2onOiBmYWxzZSwKICAgICAgICAncGltcmV3YXJkcHVuaXNobWVudG5hbWUnOiBmYWxzZSwKICAgICAgICAnbHgnOiBmYWxzZSwKICAgICAgICAnZGVwYXJ0bWVudCc6IGZhbHNlCiAgICAgIH07CiAgICAgIHJldHVybiBoYXNSb3dFZGl0W2FyZ3MuY29sdW1uLnByb3BlcnR5XSAmJiB0aGlzLmFjdHVhbElzT3BlbkVkaXQgPyAiZWRpdC1jZWxsIiA6ICJpbmZvLWNlbGwiOwogICAgfQogICAgLyoqDQogICAgICog5paw5bu66buY6K6k5YC8DQogICAgICogQHBhcmFtIHsqfSAgcm93IOihjOaVsOaNrg0KICAgICAqIEBtZW1iZXJvZiBNYWluQmFzZQ0KICAgICAqLwoKICB9LCB7CiAgICBrZXk6ICJjcmVhdGVEZWZhdWx0IiwKICAgIHZhbHVlOiBmdW5jdGlvbiBjcmVhdGVEZWZhdWx0KHJvdykge30KICB9LCB7CiAgICBrZXk6ICJhZGFwdGl2ZVN0YXRlIiwKICAgIGdldDogZnVuY3Rpb24gZ2V0KCkgewogICAgICByZXR1cm4gIXRoaXMuYWxsQ29sdW1ucy5maW5kKGZ1bmN0aW9uIChjb2x1bW4pIHsKICAgICAgICByZXR1cm4gY29sdW1uLnNob3cgJiYgT2JqZWN0LmlzKGNvbHVtbi51dGlsLCAnU1RBUicpOwogICAgICB9KTsKICAgIH0KICB9XSk7CgogIHJldHVybiBNYWluQmFzZTsKfShWdWUpOwoKdHNsaWJfMS5fX2RlY29yYXRlKFtQcm9wKCldLCBNYWluQmFzZS5wcm90b3R5cGUsICJuYW1lIiwgdm9pZCAwKTsKCnRzbGliXzEuX19kZWNvcmF0ZShbUHJvcCgpXSwgTWFpbkJhc2UucHJvdG90eXBlLCAidmlld1N0YXRlIiwgdm9pZCAwKTsKCnRzbGliXzEuX19kZWNvcmF0ZShbUHJvcCgpXSwgTWFpbkJhc2UucHJvdG90eXBlLCAiY29udGV4dCIsIHZvaWQgMCk7Cgp0c2xpYl8xLl9fZGVjb3JhdGUoW1Byb3AoKV0sIE1haW5CYXNlLnByb3RvdHlwZSwgInZpZXdwYXJhbXMiLCB2b2lkIDApOwoKdHNsaWJfMS5fX2RlY29yYXRlKFtQcm9wKCldLCBNYWluQmFzZS5wcm90b3R5cGUsICJuZXdkYXRhIiwgdm9pZCAwKTsKCnRzbGliXzEuX19kZWNvcmF0ZShbUHJvcCgpXSwgTWFpbkJhc2UucHJvdG90eXBlLCAib3BlbmRhdGEiLCB2b2lkIDApOwoKdHNsaWJfMS5fX2RlY29yYXRlKFtQcm9wKHsKICAiZGVmYXVsdCI6IHRydWUKfSldLCBNYWluQmFzZS5wcm90b3R5cGUsICJzaG93QnVzeUluZGljYXRvciIsIHZvaWQgMCk7Cgp0c2xpYl8xLl9fZGVjb3JhdGUoW1Byb3AoKV0sIE1haW5CYXNlLnByb3RvdHlwZSwgInVwZGF0ZUFjdGlvbiIsIHZvaWQgMCk7Cgp0c2xpYl8xLl9fZGVjb3JhdGUoW1Byb3AoKV0sIE1haW5CYXNlLnByb3RvdHlwZSwgImZldGNoQWN0aW9uIiwgdm9pZCAwKTsKCnRzbGliXzEuX19kZWNvcmF0ZShbUHJvcCgpXSwgTWFpbkJhc2UucHJvdG90eXBlLCAicmVtb3ZlQWN0aW9uIiwgdm9pZCAwKTsKCnRzbGliXzEuX19kZWNvcmF0ZShbUHJvcCgpXSwgTWFpbkJhc2UucHJvdG90eXBlLCAibG9hZEFjdGlvbiIsIHZvaWQgMCk7Cgp0c2xpYl8xLl9fZGVjb3JhdGUoW1Byb3AoKV0sIE1haW5CYXNlLnByb3RvdHlwZSwgImxvYWRkcmFmdEFjdGlvbiIsIHZvaWQgMCk7Cgp0c2xpYl8xLl9fZGVjb3JhdGUoW1Byb3AoKV0sIE1haW5CYXNlLnByb3RvdHlwZSwgImNyZWF0ZUFjdGlvbiIsIHZvaWQgMCk7Cgp0c2xpYl8xLl9fZGVjb3JhdGUoW1Byb3AoewogICJkZWZhdWx0IjogZmFsc2UKfSldLCBNYWluQmFzZS5wcm90b3R5cGUsICJpc1NlbGVjdEZpcnN0RGVmYXVsdCIsIHZvaWQgMCk7Cgp0c2xpYl8xLl9fZGVjb3JhdGUoW1Byb3AoKV0sIE1haW5CYXNlLnByb3RvdHlwZSwgImlzU2luZ2xlU2VsZWN0Iiwgdm9pZCAwKTsKCnRzbGliXzEuX19kZWNvcmF0ZShbUHJvcCgpXSwgTWFpbkJhc2UucHJvdG90eXBlLCAic2VsZWN0ZWREYXRhIiwgdm9pZCAwKTsKCnRzbGliXzEuX19kZWNvcmF0ZShbV2F0Y2goJ3NlbGVjdGVkRGF0YScpXSwgTWFpbkJhc2UucHJvdG90eXBlLCAib25WYWx1ZUNoYW5nZSIsIG51bGwpOwoKdHNsaWJfMS5fX2RlY29yYXRlKFtQcm9wKHsKICAiZGVmYXVsdCI6IDIKfSldLCBNYWluQmFzZS5wcm90b3R5cGUsICJncmlkUm93QWN0aXZlTW9kZSIsIHZvaWQgMCk7Cgp0c2xpYl8xLl9fZGVjb3JhdGUoW1Byb3AoewogICJkZWZhdWx0IjogZmFsc2UKfSldLCBNYWluQmFzZS5wcm90b3R5cGUsICJpc09wZW5FZGl0Iiwgdm9pZCAwKTsKCk1haW5CYXNlID0gdHNsaWJfMS5fX2RlY29yYXRlKFtDb21wb25lbnQoewogIGNvbXBvbmVudHM6IHt9Cn0pXSwgTWFpbkJhc2UpOwpleHBvcnQgZGVmYXVsdCBNYWluQmFzZTs="},null]}
{"remainingRequest":"F:\\crod项目\\人事管理系统2\\iBizEHR\\app_EHRPim\\node_modules\\thread-loader\\dist\\cjs.js!F:\\crod项目\\人事管理系统2\\iBizEHR\\app_EHRPim\\node_modules\\babel-loader\\lib\\index.js!F:\\crod项目\\人事管理系统2\\iBizEHR\\app_EHRPim\\node_modules\\ts-loader\\index.js??ref--13-3!F:\\crod项目\\人事管理系统2\\iBizEHR\\app_EHRPim\\src\\service\\pim-person\\pim-person-service-base.ts","dependencies":[{"path":"F:\\crod项目\\人事管理系统2\\iBizEHR\\app_EHRPim\\src\\service\\pim-person\\pim-person-service-base.ts","mtime":1630509410579},{"path":"F:\\crod项目\\人事管理系统2\\iBizEHR\\app_EHRPim\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1630511852775},{"path":"F:\\crod项目\\人事管理系统2\\iBizEHR\\app_EHRPim\\node_modules\\thread-loader\\dist\\cjs.js","mtime":1630511853252},{"path":"F:\\crod项目\\人事管理系统2\\iBizEHR\\app_EHRPim\\node_modules\\babel-loader\\lib\\index.js","mtime":1630511852747},{"path":"F:\\crod项目\\人事管理系统2\\iBizEHR\\app_EHRPim\\node_modules\\ts-loader\\index.js","mtime":1630511985412}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:aW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkuZm9yLWVhY2giOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5vYmplY3QuaXMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy93ZWIuZG9tLWNvbGxlY3Rpb25zLmZvci1lYWNoIjsKaW1wb3J0ICJyZWdlbmVyYXRvci1ydW50aW1lL3J1bnRpbWUiOwppbXBvcnQgX2FzeW5jVG9HZW5lcmF0b3IgZnJvbSAiRjpcXGNyb2RcdTk4NzlcdTc2RUVcXFx1NEVCQVx1NEU4Qlx1N0JBMVx1NzQwNlx1N0NGQlx1N0VERjJcXGlCaXpFSFJcXGFwcF9FSFJQaW1cXG5vZGVfbW9kdWxlc1xcQGJhYmVsXFxydW50aW1lL2hlbHBlcnMvZXNtL2FzeW5jVG9HZW5lcmF0b3IiOwppbXBvcnQgX2NsYXNzQ2FsbENoZWNrIGZyb20gIkY6XFxjcm9kXHU5ODc5XHU3NkVFXFxcdTRFQkFcdTRFOEJcdTdCQTFcdTc0MDZcdTdDRkJcdTdFREYyXFxpQml6RUhSXFxhcHBfRUhSUGltXFxub2RlX21vZHVsZXNcXEBiYWJlbFxccnVudGltZS9oZWxwZXJzL2VzbS9jbGFzc0NhbGxDaGVjayI7CmltcG9ydCBfY3JlYXRlQ2xhc3MgZnJvbSAiRjpcXGNyb2RcdTk4NzlcdTc2RUVcXFx1NEVCQVx1NEU4Qlx1N0JBMVx1NzQwNlx1N0NGQlx1N0VERjJcXGlCaXpFSFJcXGFwcF9FSFJQaW1cXG5vZGVfbW9kdWxlc1xcQGJhYmVsXFxydW50aW1lL2hlbHBlcnMvZXNtL2NyZWF0ZUNsYXNzIjsKaW1wb3J0IF9wb3NzaWJsZUNvbnN0cnVjdG9yUmV0dXJuIGZyb20gIkY6XFxjcm9kXHU5ODc5XHU3NkVFXFxcdTRFQkFcdTRFOEJcdTdCQTFcdTc0MDZcdTdDRkJcdTdFREYyXFxpQml6RUhSXFxhcHBfRUhSUGltXFxub2RlX21vZHVsZXNcXEBiYWJlbFxccnVudGltZS9oZWxwZXJzL2VzbS9wb3NzaWJsZUNvbnN0cnVjdG9yUmV0dXJuIjsKaW1wb3J0IF9nZXRQcm90b3R5cGVPZiBmcm9tICJGOlxcY3JvZFx1OTg3OVx1NzZFRVxcXHU0RUJBXHU0RThCXHU3QkExXHU3NDA2XHU3Q0ZCXHU3RURGMlxcaUJpekVIUlxcYXBwX0VIUlBpbVxcbm9kZV9tb2R1bGVzXFxAYmFiZWxcXHJ1bnRpbWUvaGVscGVycy9lc20vZ2V0UHJvdG90eXBlT2YiOwppbXBvcnQgX2luaGVyaXRzIGZyb20gIkY6XFxjcm9kXHU5ODc5XHU3NkVFXFxcdTRFQkFcdTRFOEJcdTdCQTFcdTc0MDZcdTdDRkJcdTdFREYyXFxpQml6RUhSXFxhcHBfRUhSUGltXFxub2RlX21vZHVsZXNcXEBiYWJlbFxccnVudGltZS9oZWxwZXJzL2VzbS9pbmhlcml0cyI7CmltcG9ydCB7IEh0dHAgfSBmcm9tICdAL3V0aWxzJzsKaW1wb3J0IEVudGl0eVNlcnZpY2UgZnJvbSAnLi4vZW50aXR5LXNlcnZpY2UnOwppbXBvcnQgR2V0SlRMWFJESExvZ2ljIGZyb20gJ0Avc2VydmljZS9waW0tcGVyc29uL2dldC1qdGx4cmRoLWxvZ2ljJzsKLyoqDQogKiDkurrlkZjkv6Hmga/mnI3liqHlr7nosaHln7rnsbsNCiAqDQogKiBAZXhwb3J0DQogKiBAY2xhc3MgUGltUGVyc29uU2VydmljZUJhc2UNCiAqIEBleHRlbmRzIHtFbnRpdHlTZXJ2aWV9DQogKi8KCnZhciBQaW1QZXJzb25TZXJ2aWNlQmFzZSA9Ci8qI19fUFVSRV9fKi8KZnVuY3Rpb24gKF9FbnRpdHlTZXJ2aWNlKSB7CiAgX2luaGVyaXRzKFBpbVBlcnNvblNlcnZpY2VCYXNlLCBfRW50aXR5U2VydmljZSk7CgogIC8qKg0KICAgKiBDcmVhdGVzIGFuIGluc3RhbmNlIG9mICBQaW1QZXJzb25TZXJ2aWNlQmFzZS4NCiAgICoNCiAgICogQHBhcmFtIHsqfSBbb3B0cz17fV0NCiAgICogQG1lbWJlcm9mICBQaW1QZXJzb25TZXJ2aWNlQmFzZQ0KICAgKi8KICBmdW5jdGlvbiBQaW1QZXJzb25TZXJ2aWNlQmFzZSgpIHsKICAgIHZhciBvcHRzID0gYXJndW1lbnRzLmxlbmd0aCA+IDAgJiYgYXJndW1lbnRzWzBdICE9PSB1bmRlZmluZWQgPyBhcmd1bWVudHNbMF0gOiB7fTsKCiAgICBfY2xhc3NDYWxsQ2hlY2sodGhpcywgUGltUGVyc29uU2VydmljZUJhc2UpOwoKICAgIHJldHVybiBfcG9zc2libGVDb25zdHJ1Y3RvclJldHVybih0aGlzLCBfZ2V0UHJvdG90eXBlT2YoUGltUGVyc29uU2VydmljZUJhc2UpLmNhbGwodGhpcywgb3B0cykpOwogIH0KICAvKioNCiAgICog5Yid5aeL5YyW5Z+656GA5pWw5o2uDQogICAqDQogICAqIEBtZW1iZXJvZiBQaW1QZXJzb25TZXJ2aWNlQmFzZQ0KICAgKi8KCgogIF9jcmVhdGVDbGFzcyhQaW1QZXJzb25TZXJ2aWNlQmFzZSwgW3sKICAgIGtleTogImluaXRCYXNpY0RhdGEiLAogICAgdmFsdWU6IGZ1bmN0aW9uIGluaXRCYXNpY0RhdGEoKSB7CiAgICAgIHRoaXMuQVBQTFlERUtFWSA9ICdwaW1wZXJzb24nOwogICAgICB0aGlzLkFQUERFS0VZID0gJ3BpbXBlcnNvbmlkJzsKICAgICAgdGhpcy5BUFBERU5BTUUgPSAncGltcGVvcGxlJzsKICAgICAgdGhpcy5BUFBERVRFWFQgPSAncGltcGVyc29ubmFtZSc7CiAgICAgIHRoaXMuQVBQTkFNRSA9ICdlaHJwaW0nOwogICAgICB0aGlzLlNZU1RFTU5BTUUgPSAnZWhyJzsKICAgIH0gLy8g5a6e5L2T5o6l5Y+jCgogICAgLyoqDQogICAgICogU2VsZWN05o6l5Y+j5pa55rOVDQogICAgICoNCiAgICAgKiBAcGFyYW0geyp9IFtjb250ZXh0PXt9XQ0KICAgICAqIEBwYXJhbSB7Kn0gW2RhdGE9e31dDQogICAgICogQHBhcmFtIHtib29sZWFufSBbaXNsb2FkaW5nXQ0KICAgICAqIEByZXR1cm5zIHtQcm9taXNlPGFueT59DQogICAgICogQG1lbWJlcm9mIFBpbVBlcnNvblNlcnZpY2VCYXNlDQogICAgICovCgogIH0sIHsKICAgIGtleTogIlNlbGVjdCIsCiAgICB2YWx1ZTogZnVuY3Rpb24gKCkgewogICAgICB2YXIgX1NlbGVjdCA9IF9hc3luY1RvR2VuZXJhdG9yKAogICAgICAvKiNfX1BVUkVfXyovCiAgICAgIHJlZ2VuZXJhdG9yUnVudGltZS5tYXJrKGZ1bmN0aW9uIF9jYWxsZWUoKSB7CiAgICAgICAgdmFyIGNvbnRleHQsCiAgICAgICAgICAgIGRhdGEsCiAgICAgICAgICAgIGlzbG9hZGluZywKICAgICAgICAgICAgX2FyZ3MgPSBhcmd1bWVudHM7CiAgICAgICAgcmV0dXJuIHJlZ2VuZXJhdG9yUnVudGltZS53cmFwKGZ1bmN0aW9uIF9jYWxsZWUkKF9jb250ZXh0KSB7CiAgICAgICAgICB3aGlsZSAoMSkgewogICAgICAgICAgICBzd2l0Y2ggKF9jb250ZXh0LnByZXYgPSBfY29udGV4dC5uZXh0KSB7CiAgICAgICAgICAgICAgY2FzZSAwOgogICAgICAgICAgICAgICAgY29udGV4dCA9IF9hcmdzLmxlbmd0aCA+IDAgJiYgX2FyZ3NbMF0gIT09IHVuZGVmaW5lZCA/IF9hcmdzWzBdIDoge307CiAgICAgICAgICAgICAgICBkYXRhID0gX2FyZ3MubGVuZ3RoID4gMSAmJiBfYXJnc1sxXSAhPT0gdW5kZWZpbmVkID8gX2FyZ3NbMV0gOiB7fTsKICAgICAgICAgICAgICAgIGlzbG9hZGluZyA9IF9hcmdzLmxlbmd0aCA+IDIgPyBfYXJnc1syXSA6IHVuZGVmaW5lZDsKICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dC5hYnJ1cHQoInJldHVybiIsIEh0dHAuZ2V0SW5zdGFuY2UoKS5nZXQoIi9waW1wZW9wbGUvIi5jb25jYXQoY29udGV4dC5waW1wZXJzb24sICIvc2VsZWN0IiksIGlzbG9hZGluZykpOwoKICAgICAgICAgICAgICBjYXNlIDQ6CiAgICAgICAgICAgICAgY2FzZSAiZW5kIjoKICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dC5zdG9wKCk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9LCBfY2FsbGVlKTsKICAgICAgfSkpOwoKICAgICAgZnVuY3Rpb24gU2VsZWN0KCkgewogICAgICAgIHJldHVybiBfU2VsZWN0LmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7CiAgICAgIH0KCiAgICAgIHJldHVybiBTZWxlY3Q7CiAgICB9KCkKICAgIC8qKg0KICAgICAqIFVwZGF0ZeaOpeWPo+aWueazlQ0KICAgICAqDQogICAgICogQHBhcmFtIHsqfSBbY29udGV4dD17fV0NCiAgICAgKiBAcGFyYW0geyp9IFtkYXRhPXt9XQ0KICAgICAqIEBwYXJhbSB7Ym9vbGVhbn0gW2lzbG9hZGluZ10NCiAgICAgKiBAcmV0dXJucyB7UHJvbWlzZTxhbnk+fQ0KICAgICAqIEBtZW1iZXJvZiBQaW1QZXJzb25TZXJ2aWNlQmFzZQ0KICAgICAqLwoKICB9LCB7CiAgICBrZXk6ICJVcGRhdGUiLAogICAgdmFsdWU6IGZ1bmN0aW9uICgpIHsKICAgICAgdmFyIF9VcGRhdGUgPSBfYXN5bmNUb0dlbmVyYXRvcigKICAgICAgLyojX19QVVJFX18qLwogICAgICByZWdlbmVyYXRvclJ1bnRpbWUubWFyayhmdW5jdGlvbiBfY2FsbGVlMigpIHsKICAgICAgICB2YXIgY29udGV4dCwKICAgICAgICAgICAgZGF0YSwKICAgICAgICAgICAgaXNsb2FkaW5nLAogICAgICAgICAgICBtYXN0ZXJEYXRhLAogICAgICAgICAgICBwaW1wZXJzb25hYmlsaXRpZXNEYXRhLAogICAgICAgICAgICBwaW1wYXBlcnNEYXRhLAogICAgICAgICAgICBwaW1kaXN0aXJidXRpb25zRGF0YSwKICAgICAgICAgICAgcGltdGl0bGVzRGF0YSwKICAgICAgICAgICAgcGltdm9jYXRpb25hbHNEYXRhLAogICAgICAgICAgICBwaW1hcm15Y2FkcmVzRGF0YSwKICAgICAgICAgICAgcGltY29ycmVjdGlvbmFwcGxpZXNEYXRhLAogICAgICAgICAgICBwaW12YWNhdGlvbnNEYXRhLAogICAgICAgICAgICB0cm10cmFpbnBlb3BsZURhdGEsCiAgICAgICAgICAgIHBpbWNvbnRyYWN0c0RhdGEsCiAgICAgICAgICAgIHBpbWVkdWNhdGlvbnNEYXRhLAogICAgICAgICAgICBwaW1wZXJzb25jaGFuZ2VzRGF0YSwKICAgICAgICAgICAgcGltYWNoaWV2ZW1lbnRzRGF0YSwKICAgICAgICAgICAgcGltcmVzZWFyY2hmaW5kaW5nc0RhdGEsCiAgICAgICAgICAgIHBpbWV4aXRhbmRlbnRyaWVzRGF0YSwKICAgICAgICAgICAgcGltcmV3YXJkcHVuaXNobWVudHNEYXRhLAogICAgICAgICAgICBwaW1wYXRlbnRzRGF0YSwKICAgICAgICAgICAgcGltbGFuZ3VhZ2VhYmlsaXRpZXNEYXRhLAogICAgICAgICAgICBwaW1hcmNoaXZlc0RhdGEsCiAgICAgICAgICAgIHBpbWZhbWluZm9zRGF0YSwKICAgICAgICAgICAgYXR0ZW5kYW5jZW1yZXBvcnRteGVzRGF0YSwKICAgICAgICAgICAgcGltd29ya2hpc3Rvcmllc0RhdGEsCiAgICAgICAgICAgIHJlcywKICAgICAgICAgICAgX2FyZ3MyID0gYXJndW1lbnRzOwogICAgICAgIHJldHVybiByZWdlbmVyYXRvclJ1bnRpbWUud3JhcChmdW5jdGlvbiBfY2FsbGVlMiQoX2NvbnRleHQyKSB7CiAgICAgICAgICB3aGlsZSAoMSkgewogICAgICAgICAgICBzd2l0Y2ggKF9jb250ZXh0Mi5wcmV2ID0gX2NvbnRleHQyLm5leHQpIHsKICAgICAgICAgICAgICBjYXNlIDA6CiAgICAgICAgICAgICAgICBjb250ZXh0ID0gX2FyZ3MyLmxlbmd0aCA+IDAgJiYgX2FyZ3MyWzBdICE9PSB1bmRlZmluZWQgPyBfYXJnczJbMF0gOiB7fTsKICAgICAgICAgICAgICAgIGRhdGEgPSBfYXJnczIubGVuZ3RoID4gMSAmJiBfYXJnczJbMV0gIT09IHVuZGVmaW5lZCA/IF9hcmdzMlsxXSA6IHt9OwogICAgICAgICAgICAgICAgaXNsb2FkaW5nID0gX2FyZ3MyLmxlbmd0aCA+IDIgPyBfYXJnczJbMl0gOiB1bmRlZmluZWQ7CiAgICAgICAgICAgICAgICBtYXN0ZXJEYXRhID0ge307CiAgICAgICAgICAgICAgICBwaW1wZXJzb25hYmlsaXRpZXNEYXRhID0gW107CgogICAgICAgICAgICAgICAgaWYgKCFPYmplY3QuaXModGhpcy50ZW1wU3RvcmFnZS5nZXRJdGVtKGNvbnRleHQuc3Jmc2Vzc2lvbmtleSArICdfcGltcGVyc29uYWJpbGl0aWVzJyksICd1bmRlZmluZWQnKSkgewogICAgICAgICAgICAgICAgICBwaW1wZXJzb25hYmlsaXRpZXNEYXRhID0gSlNPTi5wYXJzZSh0aGlzLnRlbXBTdG9yYWdlLmdldEl0ZW0oY29udGV4dC5zcmZzZXNzaW9ua2V5ICsgJ19waW1wZXJzb25hYmlsaXRpZXMnKSk7CgogICAgICAgICAgICAgICAgICBpZiAocGltcGVyc29uYWJpbGl0aWVzRGF0YSAmJiBwaW1wZXJzb25hYmlsaXRpZXNEYXRhLmxlbmd0aCAmJiBwaW1wZXJzb25hYmlsaXRpZXNEYXRhLmxlbmd0aCA+IDApIHsKICAgICAgICAgICAgICAgICAgICBwaW1wZXJzb25hYmlsaXRpZXNEYXRhLmZvckVhY2goZnVuY3Rpb24gKGl0ZW0pIHsKICAgICAgICAgICAgICAgICAgICAgIGlmIChpdGVtLnNyZmZyb250dWYpIHsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKE9iamVjdC5pcyhpdGVtLnNyZmZyb250dWYsICIwIikpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICBpdGVtLnBpbXBlcnNvbmFiaWxpdHlpZCA9IG51bGw7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgICAgIGRlbGV0ZSBpdGVtLnNyZmZyb250dWY7CiAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBtYXN0ZXJEYXRhLnBpbXBlcnNvbmFiaWxpdGllcyA9IHBpbXBlcnNvbmFiaWxpdGllc0RhdGE7CiAgICAgICAgICAgICAgICBwaW1wYXBlcnNEYXRhID0gW107CgogICAgICAgICAgICAgICAgaWYgKCFPYmplY3QuaXModGhpcy50ZW1wU3RvcmFnZS5nZXRJdGVtKGNvbnRleHQuc3Jmc2Vzc2lvbmtleSArICdfcGltcGFwZXJzJyksICd1bmRlZmluZWQnKSkgewogICAgICAgICAgICAgICAgICBwaW1wYXBlcnNEYXRhID0gSlNPTi5wYXJzZSh0aGlzLnRlbXBTdG9yYWdlLmdldEl0ZW0oY29udGV4dC5zcmZzZXNzaW9ua2V5ICsgJ19waW1wYXBlcnMnKSk7CgogICAgICAgICAgICAgICAgICBpZiAocGltcGFwZXJzRGF0YSAmJiBwaW1wYXBlcnNEYXRhLmxlbmd0aCAmJiBwaW1wYXBlcnNEYXRhLmxlbmd0aCA+IDApIHsKICAgICAgICAgICAgICAgICAgICBwaW1wYXBlcnNEYXRhLmZvckVhY2goZnVuY3Rpb24gKGl0ZW0pIHsKICAgICAgICAgICAgICAgICAgICAgIGlmIChpdGVtLnNyZmZyb250dWYpIHsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKE9iamVjdC5pcyhpdGVtLnNyZmZyb250dWYsICIwIikpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICBpdGVtLnBpbXBhcGVyaWQgPSBudWxsOwogICAgICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgICAgICBkZWxldGUgaXRlbS5zcmZmcm9udHVmOwogICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgbWFzdGVyRGF0YS5waW1wYXBlcnMgPSBwaW1wYXBlcnNEYXRhOwogICAgICAgICAgICAgICAgcGltZGlzdGlyYnV0aW9uc0RhdGEgPSBbXTsKCiAgICAgICAgICAgICAgICBpZiAoIU9iamVjdC5pcyh0aGlzLnRlbXBTdG9yYWdlLmdldEl0ZW0oY29udGV4dC5zcmZzZXNzaW9ua2V5ICsgJ19waW1kaXN0aXJidXRpb25zJyksICd1bmRlZmluZWQnKSkgewogICAgICAgICAgICAgICAgICBwaW1kaXN0aXJidXRpb25zRGF0YSA9IEpTT04ucGFyc2UodGhpcy50ZW1wU3RvcmFnZS5nZXRJdGVtKGNvbnRleHQuc3Jmc2Vzc2lvbmtleSArICdfcGltZGlzdGlyYnV0aW9ucycpKTsKCiAgICAgICAgICAgICAgICAgIGlmIChwaW1kaXN0aXJidXRpb25zRGF0YSAmJiBwaW1kaXN0aXJidXRpb25zRGF0YS5sZW5ndGggJiYgcGltZGlzdGlyYnV0aW9uc0RhdGEubGVuZ3RoID4gMCkgewogICAgICAgICAgICAgICAgICAgIHBpbWRpc3RpcmJ1dGlvbnNEYXRhLmZvckVhY2goZnVuY3Rpb24gKGl0ZW0pIHsKICAgICAgICAgICAgICAgICAgICAgIGlmIChpdGVtLnNyZmZyb250dWYpIHsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKE9iamVjdC5pcyhpdGVtLnNyZmZyb250dWYsICIwIikpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICBpdGVtLnBpbWRpc3RpcmJ1dGlvbmlkID0gbnVsbDsKICAgICAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICAgICAgZGVsZXRlIGl0ZW0uc3JmZnJvbnR1ZjsKICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIG1hc3RlckRhdGEucGltZGlzdGlyYnV0aW9ucyA9IHBpbWRpc3RpcmJ1dGlvbnNEYXRhOwogICAgICAgICAgICAgICAgcGltdGl0bGVzRGF0YSA9IFtdOwoKICAgICAgICAgICAgICAgIGlmICghT2JqZWN0LmlzKHRoaXMudGVtcFN0b3JhZ2UuZ2V0SXRlbShjb250ZXh0LnNyZnNlc3Npb25rZXkgKyAnX3BpbXRpdGxlcycpLCAndW5kZWZpbmVkJykpIHsKICAgICAgICAgICAgICAgICAgcGltdGl0bGVzRGF0YSA9IEpTT04ucGFyc2UodGhpcy50ZW1wU3RvcmFnZS5nZXRJdGVtKGNvbnRleHQuc3Jmc2Vzc2lvbmtleSArICdfcGltdGl0bGVzJykpOwoKICAgICAgICAgICAgICAgICAgaWYgKHBpbXRpdGxlc0RhdGEgJiYgcGltdGl0bGVzRGF0YS5sZW5ndGggJiYgcGltdGl0bGVzRGF0YS5sZW5ndGggPiAwKSB7CiAgICAgICAgICAgICAgICAgICAgcGltdGl0bGVzRGF0YS5mb3JFYWNoKGZ1bmN0aW9uIChpdGVtKSB7CiAgICAgICAgICAgICAgICAgICAgICBpZiAoaXRlbS5zcmZmcm9udHVmKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChPYmplY3QuaXMoaXRlbS5zcmZmcm9udHVmLCAiMCIpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgaXRlbS5waW10aXRsZWlkID0gbnVsbDsKICAgICAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICAgICAgZGVsZXRlIGl0ZW0uc3JmZnJvbnR1ZjsKICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIG1hc3RlckRhdGEucGltdGl0bGVzID0gcGltdGl0bGVzRGF0YTsKICAgICAgICAgICAgICAgIHBpbXZvY2F0aW9uYWxzRGF0YSA9IFtdOwoKICAgICAgICAgICAgICAgIGlmICghT2JqZWN0LmlzKHRoaXMudGVtcFN0b3JhZ2UuZ2V0SXRlbShjb250ZXh0LnNyZnNlc3Npb25rZXkgKyAnX3BpbXZvY2F0aW9uYWxzJyksICd1bmRlZmluZWQnKSkgewogICAgICAgICAgICAgICAgICBwaW12b2NhdGlvbmFsc0RhdGEgPSBKU09OLnBhcnNlKHRoaXMudGVtcFN0b3JhZ2UuZ2V0SXRlbShjb250ZXh0LnNyZnNlc3Npb25rZXkgKyAnX3BpbXZvY2F0aW9uYWxzJykpOwoKICAgICAgICAgICAgICAgICAgaWYgKHBpbXZvY2F0aW9uYWxzRGF0YSAmJiBwaW12b2NhdGlvbmFsc0RhdGEubGVuZ3RoICYmIHBpbXZvY2F0aW9uYWxzRGF0YS5sZW5ndGggPiAwKSB7CiAgICAgICAgICAgICAgICAgICAgcGltdm9jYXRpb25hbHNEYXRhLmZvckVhY2goZnVuY3Rpb24gKGl0ZW0pIHsKICAgICAgICAgICAgICAgICAgICAgIGlmIChpdGVtLnNyZmZyb250dWYpIHsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKE9iamVjdC5pcyhpdGVtLnNyZmZyb250dWYsICIwIikpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICBpdGVtLnBpbXZvY2F0aW9uYWxpZCA9IG51bGw7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgICAgIGRlbGV0ZSBpdGVtLnNyZmZyb250dWY7CiAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBtYXN0ZXJEYXRhLnBpbXZvY2F0aW9uYWxzID0gcGltdm9jYXRpb25hbHNEYXRhOwogICAgICAgICAgICAgICAgcGltYXJteWNhZHJlc0RhdGEgPSBbXTsKCiAgICAgICAgICAgICAgICBpZiAoIU9iamVjdC5pcyh0aGlzLnRlbXBTdG9yYWdlLmdldEl0ZW0oY29udGV4dC5zcmZzZXNzaW9ua2V5ICsgJ19waW1hcm15Y2FkcmVzJyksICd1bmRlZmluZWQnKSkgewogICAgICAgICAgICAgICAgICBwaW1hcm15Y2FkcmVzRGF0YSA9IEpTT04ucGFyc2UodGhpcy50ZW1wU3RvcmFnZS5nZXRJdGVtKGNvbnRleHQuc3Jmc2Vzc2lvbmtleSArICdfcGltYXJteWNhZHJlcycpKTsKCiAgICAgICAgICAgICAgICAgIGlmIChwaW1hcm15Y2FkcmVzRGF0YSAmJiBwaW1hcm15Y2FkcmVzRGF0YS5sZW5ndGggJiYgcGltYXJteWNhZHJlc0RhdGEubGVuZ3RoID4gMCkgewogICAgICAgICAgICAgICAgICAgIHBpbWFybXljYWRyZXNEYXRhLmZvckVhY2goZnVuY3Rpb24gKGl0ZW0pIHsKICAgICAgICAgICAgICAgICAgICAgIGlmIChpdGVtLnNyZmZyb250dWYpIHsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKE9iamVjdC5pcyhpdGVtLnNyZmZyb250dWYsICIwIikpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICBpdGVtLnBpbWFybXljYWRyZXNpZCA9IG51bGw7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgICAgIGRlbGV0ZSBpdGVtLnNyZmZyb250dWY7CiAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBtYXN0ZXJEYXRhLnBpbWFybXljYWRyZXMgPSBwaW1hcm15Y2FkcmVzRGF0YTsKICAgICAgICAgICAgICAgIHBpbWNvcnJlY3Rpb25hcHBsaWVzRGF0YSA9IFtdOwoKICAgICAgICAgICAgICAgIGlmICghT2JqZWN0LmlzKHRoaXMudGVtcFN0b3JhZ2UuZ2V0SXRlbShjb250ZXh0LnNyZnNlc3Npb25rZXkgKyAnX3BpbWNvcnJlY3Rpb25hcHBsaWVzJyksICd1bmRlZmluZWQnKSkgewogICAgICAgICAgICAgICAgICBwaW1jb3JyZWN0aW9uYXBwbGllc0RhdGEgPSBKU09OLnBhcnNlKHRoaXMudGVtcFN0b3JhZ2UuZ2V0SXRlbShjb250ZXh0LnNyZnNlc3Npb25rZXkgKyAnX3BpbWNvcnJlY3Rpb25hcHBsaWVzJykpOwoKICAgICAgICAgICAgICAgICAgaWYgKHBpbWNvcnJlY3Rpb25hcHBsaWVzRGF0YSAmJiBwaW1jb3JyZWN0aW9uYXBwbGllc0RhdGEubGVuZ3RoICYmIHBpbWNvcnJlY3Rpb25hcHBsaWVzRGF0YS5sZW5ndGggPiAwKSB7CiAgICAgICAgICAgICAgICAgICAgcGltY29ycmVjdGlvbmFwcGxpZXNEYXRhLmZvckVhY2goZnVuY3Rpb24gKGl0ZW0pIHsKICAgICAgICAgICAgICAgICAgICAgIGlmIChpdGVtLnNyZmZyb250dWYpIHsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKE9iamVjdC5pcyhpdGVtLnNyZmZyb250dWYsICIwIikpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICBpdGVtLnBpbWNvcnJlY3Rpb25hcHBseWlkID0gbnVsbDsKICAgICAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICAgICAgZGVsZXRlIGl0ZW0uc3JmZnJvbnR1ZjsKICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIG1hc3RlckRhdGEucGltY29ycmVjdGlvbmFwcGxpZXMgPSBwaW1jb3JyZWN0aW9uYXBwbGllc0RhdGE7CiAgICAgICAgICAgICAgICBwaW12YWNhdGlvbnNEYXRhID0gW107CgogICAgICAgICAgICAgICAgaWYgKCFPYmplY3QuaXModGhpcy50ZW1wU3RvcmFnZS5nZXRJdGVtKGNvbnRleHQuc3Jmc2Vzc2lvbmtleSArICdfcGltdmFjYXRpb25zJyksICd1bmRlZmluZWQnKSkgewogICAgICAgICAgICAgICAgICBwaW12YWNhdGlvbnNEYXRhID0gSlNPTi5wYXJzZSh0aGlzLnRlbXBTdG9yYWdlLmdldEl0ZW0oY29udGV4dC5zcmZzZXNzaW9ua2V5ICsgJ19waW12YWNhdGlvbnMnKSk7CgogICAgICAgICAgICAgICAgICBpZiAocGltdmFjYXRpb25zRGF0YSAmJiBwaW12YWNhdGlvbnNEYXRhLmxlbmd0aCAmJiBwaW12YWNhdGlvbnNEYXRhLmxlbmd0aCA+IDApIHsKICAgICAgICAgICAgICAgICAgICBwaW12YWNhdGlvbnNEYXRhLmZvckVhY2goZnVuY3Rpb24gKGl0ZW0pIHsKICAgICAgICAgICAgICAgICAgICAgIGlmIChpdGVtLnNyZmZyb250dWYpIHsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKE9iamVjdC5pcyhpdGVtLnNyZmZyb250dWYsICIwIikpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICBpdGVtLnBpbXZhY2F0aW9uaWQgPSBudWxsOwogICAgICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgICAgICBkZWxldGUgaXRlbS5zcmZmcm9udHVmOwogICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgbWFzdGVyRGF0YS5waW12YWNhdGlvbnMgPSBwaW12YWNhdGlvbnNEYXRhOwogICAgICAgICAgICAgICAgdHJtdHJhaW5wZW9wbGVEYXRhID0gW107CgogICAgICAgICAgICAgICAgaWYgKCFPYmplY3QuaXModGhpcy50ZW1wU3RvcmFnZS5nZXRJdGVtKGNvbnRleHQuc3Jmc2Vzc2lvbmtleSArICdfdHJtdHJhaW5wZW9wbGUnKSwgJ3VuZGVmaW5lZCcpKSB7CiAgICAgICAgICAgICAgICAgIHRybXRyYWlucGVvcGxlRGF0YSA9IEpTT04ucGFyc2UodGhpcy50ZW1wU3RvcmFnZS5nZXRJdGVtKGNvbnRleHQuc3Jmc2Vzc2lvbmtleSArICdfdHJtdHJhaW5wZW9wbGUnKSk7CgogICAgICAgICAgICAgICAgICBpZiAodHJtdHJhaW5wZW9wbGVEYXRhICYmIHRybXRyYWlucGVvcGxlRGF0YS5sZW5ndGggJiYgdHJtdHJhaW5wZW9wbGVEYXRhLmxlbmd0aCA+IDApIHsKICAgICAgICAgICAgICAgICAgICB0cm10cmFpbnBlb3BsZURhdGEuZm9yRWFjaChmdW5jdGlvbiAoaXRlbSkgewogICAgICAgICAgICAgICAgICAgICAgaWYgKGl0ZW0uc3JmZnJvbnR1ZikgewogICAgICAgICAgICAgICAgICAgICAgICBpZiAoT2JqZWN0LmlzKGl0ZW0uc3JmZnJvbnR1ZiwgIjAiKSkgewogICAgICAgICAgICAgICAgICAgICAgICAgIGl0ZW0udHJtdHJpYW5wZXJzb25pZCA9IG51bGw7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgICAgIGRlbGV0ZSBpdGVtLnNyZmZyb250dWY7CiAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBtYXN0ZXJEYXRhLnRybXRyYWlucGVvcGxlID0gdHJtdHJhaW5wZW9wbGVEYXRhOwogICAgICAgICAgICAgICAgcGltY29udHJhY3RzRGF0YSA9IFtdOwoKICAgICAgICAgICAgICAgIGlmICghT2JqZWN0LmlzKHRoaXMudGVtcFN0b3JhZ2UuZ2V0SXRlbShjb250ZXh0LnNyZnNlc3Npb25rZXkgKyAnX3BpbWNvbnRyYWN0cycpLCAndW5kZWZpbmVkJykpIHsKICAgICAgICAgICAgICAgICAgcGltY29udHJhY3RzRGF0YSA9IEpTT04ucGFyc2UodGhpcy50ZW1wU3RvcmFnZS5nZXRJdGVtKGNvbnRleHQuc3Jmc2Vzc2lvbmtleSArICdfcGltY29udHJhY3RzJykpOwoKICAgICAgICAgICAgICAgICAgaWYgKHBpbWNvbnRyYWN0c0RhdGEgJiYgcGltY29udHJhY3RzRGF0YS5sZW5ndGggJiYgcGltY29udHJhY3RzRGF0YS5sZW5ndGggPiAwKSB7CiAgICAgICAgICAgICAgICAgICAgcGltY29udHJhY3RzRGF0YS5mb3JFYWNoKGZ1bmN0aW9uIChpdGVtKSB7CiAgICAgICAgICAgICAgICAgICAgICBpZiAoaXRlbS5zcmZmcm9udHVmKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChPYmplY3QuaXMoaXRlbS5zcmZmcm9udHVmLCAiMCIpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgaXRlbS5waW1jb250cmFjdGlkID0gbnVsbDsKICAgICAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICAgICAgZGVsZXRlIGl0ZW0uc3JmZnJvbnR1ZjsKICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIG1hc3RlckRhdGEucGltY29udHJhY3RzID0gcGltY29udHJhY3RzRGF0YTsKICAgICAgICAgICAgICAgIHBpbWVkdWNhdGlvbnNEYXRhID0gW107CgogICAgICAgICAgICAgICAgaWYgKCFPYmplY3QuaXModGhpcy50ZW1wU3RvcmFnZS5nZXRJdGVtKGNvbnRleHQuc3Jmc2Vzc2lvbmtleSArICdfcGltZWR1Y2F0aW9ucycpLCAndW5kZWZpbmVkJykpIHsKICAgICAgICAgICAgICAgICAgcGltZWR1Y2F0aW9uc0RhdGEgPSBKU09OLnBhcnNlKHRoaXMudGVtcFN0b3JhZ2UuZ2V0SXRlbShjb250ZXh0LnNyZnNlc3Npb25rZXkgKyAnX3BpbWVkdWNhdGlvbnMnKSk7CgogICAgICAgICAgICAgICAgICBpZiAocGltZWR1Y2F0aW9uc0RhdGEgJiYgcGltZWR1Y2F0aW9uc0RhdGEubGVuZ3RoICYmIHBpbWVkdWNhdGlvbnNEYXRhLmxlbmd0aCA+IDApIHsKICAgICAgICAgICAgICAgICAgICBwaW1lZHVjYXRpb25zRGF0YS5mb3JFYWNoKGZ1bmN0aW9uIChpdGVtKSB7CiAgICAgICAgICAgICAgICAgICAgICBpZiAoaXRlbS5zcmZmcm9udHVmKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChPYmplY3QuaXMoaXRlbS5zcmZmcm9udHVmLCAiMCIpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgaXRlbS5waW1lZHVjYXRpb25pZCA9IG51bGw7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgICAgIGRlbGV0ZSBpdGVtLnNyZmZyb250dWY7CiAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBtYXN0ZXJEYXRhLnBpbWVkdWNhdGlvbnMgPSBwaW1lZHVjYXRpb25zRGF0YTsKICAgICAgICAgICAgICAgIHBpbXBlcnNvbmNoYW5nZXNEYXRhID0gW107CgogICAgICAgICAgICAgICAgaWYgKCFPYmplY3QuaXModGhpcy50ZW1wU3RvcmFnZS5nZXRJdGVtKGNvbnRleHQuc3Jmc2Vzc2lvbmtleSArICdfcGltcGVyc29uY2hhbmdlcycpLCAndW5kZWZpbmVkJykpIHsKICAgICAgICAgICAgICAgICAgcGltcGVyc29uY2hhbmdlc0RhdGEgPSBKU09OLnBhcnNlKHRoaXMudGVtcFN0b3JhZ2UuZ2V0SXRlbShjb250ZXh0LnNyZnNlc3Npb25rZXkgKyAnX3BpbXBlcnNvbmNoYW5nZXMnKSk7CgogICAgICAgICAgICAgICAgICBpZiAocGltcGVyc29uY2hhbmdlc0RhdGEgJiYgcGltcGVyc29uY2hhbmdlc0RhdGEubGVuZ3RoICYmIHBpbXBlcnNvbmNoYW5nZXNEYXRhLmxlbmd0aCA+IDApIHsKICAgICAgICAgICAgICAgICAgICBwaW1wZXJzb25jaGFuZ2VzRGF0YS5mb3JFYWNoKGZ1bmN0aW9uIChpdGVtKSB7CiAgICAgICAgICAgICAgICAgICAgICBpZiAoaXRlbS5zcmZmcm9udHVmKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChPYmplY3QuaXMoaXRlbS5zcmZmcm9udHVmLCAiMCIpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgaXRlbS5waW1wZXJzb25jaGFuZ2VpZCA9IG51bGw7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgICAgIGRlbGV0ZSBpdGVtLnNyZmZyb250dWY7CiAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBtYXN0ZXJEYXRhLnBpbXBlcnNvbmNoYW5nZXMgPSBwaW1wZXJzb25jaGFuZ2VzRGF0YTsKICAgICAgICAgICAgICAgIHBpbWFjaGlldmVtZW50c0RhdGEgPSBbXTsKCiAgICAgICAgICAgICAgICBpZiAoIU9iamVjdC5pcyh0aGlzLnRlbXBTdG9yYWdlLmdldEl0ZW0oY29udGV4dC5zcmZzZXNzaW9ua2V5ICsgJ19waW1hY2hpZXZlbWVudHMnKSwgJ3VuZGVmaW5lZCcpKSB7CiAgICAgICAgICAgICAgICAgIHBpbWFjaGlldmVtZW50c0RhdGEgPSBKU09OLnBhcnNlKHRoaXMudGVtcFN0b3JhZ2UuZ2V0SXRlbShjb250ZXh0LnNyZnNlc3Npb25rZXkgKyAnX3BpbWFjaGlldmVtZW50cycpKTsKCiAgICAgICAgICAgICAgICAgIGlmIChwaW1hY2hpZXZlbWVudHNEYXRhICYmIHBpbWFjaGlldmVtZW50c0RhdGEubGVuZ3RoICYmIHBpbWFjaGlldmVtZW50c0RhdGEubGVuZ3RoID4gMCkgewogICAgICAgICAgICAgICAgICAgIHBpbWFjaGlldmVtZW50c0RhdGEuZm9yRWFjaChmdW5jdGlvbiAoaXRlbSkgewogICAgICAgICAgICAgICAgICAgICAgaWYgKGl0ZW0uc3JmZnJvbnR1ZikgewogICAgICAgICAgICAgICAgICAgICAgICBpZiAoT2JqZWN0LmlzKGl0ZW0uc3JmZnJvbnR1ZiwgIjAiKSkgewogICAgICAgICAgICAgICAgICAgICAgICAgIGl0ZW0ucGltYWNoaWV2ZW1lbnRzaWQgPSBudWxsOwogICAgICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgICAgICBkZWxldGUgaXRlbS5zcmZmcm9udHVmOwogICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgbWFzdGVyRGF0YS5waW1hY2hpZXZlbWVudHMgPSBwaW1hY2hpZXZlbWVudHNEYXRhOwogICAgICAgICAgICAgICAgcGltcmVzZWFyY2hmaW5kaW5nc0RhdGEgPSBbXTsKCiAgICAgICAgICAgICAgICBpZiAoIU9iamVjdC5pcyh0aGlzLnRlbXBTdG9yYWdlLmdldEl0ZW0oY29udGV4dC5zcmZzZXNzaW9ua2V5ICsgJ19waW1yZXNlYXJjaGZpbmRpbmdzJyksICd1bmRlZmluZWQnKSkgewogICAgICAgICAgICAgICAgICBwaW1yZXNlYXJjaGZpbmRpbmdzRGF0YSA9IEpTT04ucGFyc2UodGhpcy50ZW1wU3RvcmFnZS5nZXRJdGVtKGNvbnRleHQuc3Jmc2Vzc2lvbmtleSArICdfcGltcmVzZWFyY2hmaW5kaW5ncycpKTsKCiAgICAgICAgICAgICAgICAgIGlmIChwaW1yZXNlYXJjaGZpbmRpbmdzRGF0YSAmJiBwaW1yZXNlYXJjaGZpbmRpbmdzRGF0YS5sZW5ndGggJiYgcGltcmVzZWFyY2hmaW5kaW5nc0RhdGEubGVuZ3RoID4gMCkgewogICAgICAgICAgICAgICAgICAgIHBpbXJlc2VhcmNoZmluZGluZ3NEYXRhLmZvckVhY2goZnVuY3Rpb24gKGl0ZW0pIHsKICAgICAgICAgICAgICAgICAgICAgIGlmIChpdGVtLnNyZmZyb250dWYpIHsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKE9iamVjdC5pcyhpdGVtLnNyZmZyb250dWYsICIwIikpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICBpdGVtLnBpbXJlc2VhcmNoZmluZGluZ3NpZCA9IG51bGw7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgICAgIGRlbGV0ZSBpdGVtLnNyZmZyb250dWY7CiAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBtYXN0ZXJEYXRhLnBpbXJlc2VhcmNoZmluZGluZ3MgPSBwaW1yZXNlYXJjaGZpbmRpbmdzRGF0YTsKICAgICAgICAgICAgICAgIHBpbWV4aXRhbmRlbnRyaWVzRGF0YSA9IFtdOwoKICAgICAgICAgICAgICAgIGlmICghT2JqZWN0LmlzKHRoaXMudGVtcFN0b3JhZ2UuZ2V0SXRlbShjb250ZXh0LnNyZnNlc3Npb25rZXkgKyAnX3BpbWV4aXRhbmRlbnRyaWVzJyksICd1bmRlZmluZWQnKSkgewogICAgICAgICAgICAgICAgICBwaW1leGl0YW5kZW50cmllc0RhdGEgPSBKU09OLnBhcnNlKHRoaXMudGVtcFN0b3JhZ2UuZ2V0SXRlbShjb250ZXh0LnNyZnNlc3Npb25rZXkgKyAnX3BpbWV4aXRhbmRlbnRyaWVzJykpOwoKICAgICAgICAgICAgICAgICAgaWYgKHBpbWV4aXRhbmRlbnRyaWVzRGF0YSAmJiBwaW1leGl0YW5kZW50cmllc0RhdGEubGVuZ3RoICYmIHBpbWV4aXRhbmRlbnRyaWVzRGF0YS5sZW5ndGggPiAwKSB7CiAgICAgICAgICAgICAgICAgICAgcGltZXhpdGFuZGVudHJpZXNEYXRhLmZvckVhY2goZnVuY3Rpb24gKGl0ZW0pIHsKICAgICAgICAgICAgICAgICAgICAgIGlmIChpdGVtLnNyZmZyb250dWYpIHsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKE9iamVjdC5pcyhpdGVtLnNyZmZyb250dWYsICIwIikpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICBpdGVtLnBpbWV4aXRhbmRlbnRyeWlkID0gbnVsbDsKICAgICAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICAgICAgZGVsZXRlIGl0ZW0uc3JmZnJvbnR1ZjsKICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIG1hc3RlckRhdGEucGltZXhpdGFuZGVudHJpZXMgPSBwaW1leGl0YW5kZW50cmllc0RhdGE7CiAgICAgICAgICAgICAgICBwaW1yZXdhcmRwdW5pc2htZW50c0RhdGEgPSBbXTsKCiAgICAgICAgICAgICAgICBpZiAoIU9iamVjdC5pcyh0aGlzLnRlbXBTdG9yYWdlLmdldEl0ZW0oY29udGV4dC5zcmZzZXNzaW9ua2V5ICsgJ19waW1yZXdhcmRwdW5pc2htZW50cycpLCAndW5kZWZpbmVkJykpIHsKICAgICAgICAgICAgICAgICAgcGltcmV3YXJkcHVuaXNobWVudHNEYXRhID0gSlNPTi5wYXJzZSh0aGlzLnRlbXBTdG9yYWdlLmdldEl0ZW0oY29udGV4dC5zcmZzZXNzaW9ua2V5ICsgJ19waW1yZXdhcmRwdW5pc2htZW50cycpKTsKCiAgICAgICAgICAgICAgICAgIGlmIChwaW1yZXdhcmRwdW5pc2htZW50c0RhdGEgJiYgcGltcmV3YXJkcHVuaXNobWVudHNEYXRhLmxlbmd0aCAmJiBwaW1yZXdhcmRwdW5pc2htZW50c0RhdGEubGVuZ3RoID4gMCkgewogICAgICAgICAgICAgICAgICAgIHBpbXJld2FyZHB1bmlzaG1lbnRzRGF0YS5mb3JFYWNoKGZ1bmN0aW9uIChpdGVtKSB7CiAgICAgICAgICAgICAgICAgICAgICBpZiAoaXRlbS5zcmZmcm9udHVmKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChPYmplY3QuaXMoaXRlbS5zcmZmcm9udHVmLCAiMCIpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgaXRlbS5waW1yZXdhcmRwdW5pc2htZW50aWQgPSBudWxsOwogICAgICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgICAgICBkZWxldGUgaXRlbS5zcmZmcm9udHVmOwogICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgbWFzdGVyRGF0YS5waW1yZXdhcmRwdW5pc2htZW50cyA9IHBpbXJld2FyZHB1bmlzaG1lbnRzRGF0YTsKICAgICAgICAgICAgICAgIHBpbXBhdGVudHNEYXRhID0gW107CgogICAgICAgICAgICAgICAgaWYgKCFPYmplY3QuaXModGhpcy50ZW1wU3RvcmFnZS5nZXRJdGVtKGNvbnRleHQuc3Jmc2Vzc2lvbmtleSArICdfcGltcGF0ZW50cycpLCAndW5kZWZpbmVkJykpIHsKICAgICAgICAgICAgICAgICAgcGltcGF0ZW50c0RhdGEgPSBKU09OLnBhcnNlKHRoaXMudGVtcFN0b3JhZ2UuZ2V0SXRlbShjb250ZXh0LnNyZnNlc3Npb25rZXkgKyAnX3BpbXBhdGVudHMnKSk7CgogICAgICAgICAgICAgICAgICBpZiAocGltcGF0ZW50c0RhdGEgJiYgcGltcGF0ZW50c0RhdGEubGVuZ3RoICYmIHBpbXBhdGVudHNEYXRhLmxlbmd0aCA+IDApIHsKICAgICAgICAgICAgICAgICAgICBwaW1wYXRlbnRzRGF0YS5mb3JFYWNoKGZ1bmN0aW9uIChpdGVtKSB7CiAgICAgICAgICAgICAgICAgICAgICBpZiAoaXRlbS5zcmZmcm9udHVmKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChPYmplY3QuaXMoaXRlbS5zcmZmcm9udHVmLCAiMCIpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgaXRlbS5waW1wYXRlbnRpZCA9IG51bGw7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgICAgIGRlbGV0ZSBpdGVtLnNyZmZyb250dWY7CiAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBtYXN0ZXJEYXRhLnBpbXBhdGVudHMgPSBwaW1wYXRlbnRzRGF0YTsKICAgICAgICAgICAgICAgIHBpbWxhbmd1YWdlYWJpbGl0aWVzRGF0YSA9IFtdOwoKICAgICAgICAgICAgICAgIGlmICghT2JqZWN0LmlzKHRoaXMudGVtcFN0b3JhZ2UuZ2V0SXRlbShjb250ZXh0LnNyZnNlc3Npb25rZXkgKyAnX3BpbWxhbmd1YWdlYWJpbGl0aWVzJyksICd1bmRlZmluZWQnKSkgewogICAgICAgICAgICAgICAgICBwaW1sYW5ndWFnZWFiaWxpdGllc0RhdGEgPSBKU09OLnBhcnNlKHRoaXMudGVtcFN0b3JhZ2UuZ2V0SXRlbShjb250ZXh0LnNyZnNlc3Npb25rZXkgKyAnX3BpbWxhbmd1YWdlYWJpbGl0aWVzJykpOwoKICAgICAgICAgICAgICAgICAgaWYgKHBpbWxhbmd1YWdlYWJpbGl0aWVzRGF0YSAmJiBwaW1sYW5ndWFnZWFiaWxpdGllc0RhdGEubGVuZ3RoICYmIHBpbWxhbmd1YWdlYWJpbGl0aWVzRGF0YS5sZW5ndGggPiAwKSB7CiAgICAgICAgICAgICAgICAgICAgcGltbGFuZ3VhZ2VhYmlsaXRpZXNEYXRhLmZvckVhY2goZnVuY3Rpb24gKGl0ZW0pIHsKICAgICAgICAgICAgICAgICAgICAgIGlmIChpdGVtLnNyZmZyb250dWYpIHsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKE9iamVjdC5pcyhpdGVtLnNyZmZyb250dWYsICIwIikpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICBpdGVtLnBpbWxhbmd1YWdlYWJpbGl0eWlkID0gbnVsbDsKICAgICAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICAgICAgZGVsZXRlIGl0ZW0uc3JmZnJvbnR1ZjsKICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIG1hc3RlckRhdGEucGltbGFuZ3VhZ2VhYmlsaXRpZXMgPSBwaW1sYW5ndWFnZWFiaWxpdGllc0RhdGE7CiAgICAgICAgICAgICAgICBwaW1hcmNoaXZlc0RhdGEgPSBbXTsKCiAgICAgICAgICAgICAgICBpZiAoIU9iamVjdC5pcyh0aGlzLnRlbXBTdG9yYWdlLmdldEl0ZW0oY29udGV4dC5zcmZzZXNzaW9ua2V5ICsgJ19waW1hcmNoaXZlcycpLCAndW5kZWZpbmVkJykpIHsKICAgICAgICAgICAgICAgICAgcGltYXJjaGl2ZXNEYXRhID0gSlNPTi5wYXJzZSh0aGlzLnRlbXBTdG9yYWdlLmdldEl0ZW0oY29udGV4dC5zcmZzZXNzaW9ua2V5ICsgJ19waW1hcmNoaXZlcycpKTsKCiAgICAgICAgICAgICAgICAgIGlmIChwaW1hcmNoaXZlc0RhdGEgJiYgcGltYXJjaGl2ZXNEYXRhLmxlbmd0aCAmJiBwaW1hcmNoaXZlc0RhdGEubGVuZ3RoID4gMCkgewogICAgICAgICAgICAgICAgICAgIHBpbWFyY2hpdmVzRGF0YS5mb3JFYWNoKGZ1bmN0aW9uIChpdGVtKSB7CiAgICAgICAgICAgICAgICAgICAgICBpZiAoaXRlbS5zcmZmcm9udHVmKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChPYmplY3QuaXMoaXRlbS5zcmZmcm9udHVmLCAiMCIpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgaXRlbS5waW1hcmNoaXZlc2lkID0gbnVsbDsKICAgICAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICAgICAgZGVsZXRlIGl0ZW0uc3JmZnJvbnR1ZjsKICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIG1hc3RlckRhdGEucGltYXJjaGl2ZXMgPSBwaW1hcmNoaXZlc0RhdGE7CiAgICAgICAgICAgICAgICBwaW1mYW1pbmZvc0RhdGEgPSBbXTsKCiAgICAgICAgICAgICAgICBpZiAoIU9iamVjdC5pcyh0aGlzLnRlbXBTdG9yYWdlLmdldEl0ZW0oY29udGV4dC5zcmZzZXNzaW9ua2V5ICsgJ19waW1mYW1pbmZvcycpLCAndW5kZWZpbmVkJykpIHsKICAgICAgICAgICAgICAgICAgcGltZmFtaW5mb3NEYXRhID0gSlNPTi5wYXJzZSh0aGlzLnRlbXBTdG9yYWdlLmdldEl0ZW0oY29udGV4dC5zcmZzZXNzaW9ua2V5ICsgJ19waW1mYW1pbmZvcycpKTsKCiAgICAgICAgICAgICAgICAgIGlmIChwaW1mYW1pbmZvc0RhdGEgJiYgcGltZmFtaW5mb3NEYXRhLmxlbmd0aCAmJiBwaW1mYW1pbmZvc0RhdGEubGVuZ3RoID4gMCkgewogICAgICAgICAgICAgICAgICAgIHBpbWZhbWluZm9zRGF0YS5mb3JFYWNoKGZ1bmN0aW9uIChpdGVtKSB7CiAgICAgICAgICAgICAgICAgICAgICBpZiAoaXRlbS5zcmZmcm9udHVmKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChPYmplY3QuaXMoaXRlbS5zcmZmcm9udHVmLCAiMCIpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgaXRlbS5waW1mYW1pbmZvaWQgPSBudWxsOwogICAgICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgICAgICBkZWxldGUgaXRlbS5zcmZmcm9udHVmOwogICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgbWFzdGVyRGF0YS5waW1mYW1pbmZvcyA9IHBpbWZhbWluZm9zRGF0YTsKICAgICAgICAgICAgICAgIGF0dGVuZGFuY2VtcmVwb3J0bXhlc0RhdGEgPSBbXTsKCiAgICAgICAgICAgICAgICBpZiAoIU9iamVjdC5pcyh0aGlzLnRlbXBTdG9yYWdlLmdldEl0ZW0oY29udGV4dC5zcmZzZXNzaW9ua2V5ICsgJ19hdHRlbmRhbmNlbXJlcG9ydG14ZXMnKSwgJ3VuZGVmaW5lZCcpKSB7CiAgICAgICAgICAgICAgICAgIGF0dGVuZGFuY2VtcmVwb3J0bXhlc0RhdGEgPSBKU09OLnBhcnNlKHRoaXMudGVtcFN0b3JhZ2UuZ2V0SXRlbShjb250ZXh0LnNyZnNlc3Npb25rZXkgKyAnX2F0dGVuZGFuY2VtcmVwb3J0bXhlcycpKTsKCiAgICAgICAgICAgICAgICAgIGlmIChhdHRlbmRhbmNlbXJlcG9ydG14ZXNEYXRhICYmIGF0dGVuZGFuY2VtcmVwb3J0bXhlc0RhdGEubGVuZ3RoICYmIGF0dGVuZGFuY2VtcmVwb3J0bXhlc0RhdGEubGVuZ3RoID4gMCkgewogICAgICAgICAgICAgICAgICAgIGF0dGVuZGFuY2VtcmVwb3J0bXhlc0RhdGEuZm9yRWFjaChmdW5jdGlvbiAoaXRlbSkgewogICAgICAgICAgICAgICAgICAgICAgaWYgKGl0ZW0uc3JmZnJvbnR1ZikgewogICAgICAgICAgICAgICAgICAgICAgICBpZiAoT2JqZWN0LmlzKGl0ZW0uc3JmZnJvbnR1ZiwgIjAiKSkgewogICAgICAgICAgICAgICAgICAgICAgICAgIGl0ZW0uYXR0ZW5kYW5jZW1yZXBvcnRteGlkID0gbnVsbDsKICAgICAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICAgICAgZGVsZXRlIGl0ZW0uc3JmZnJvbnR1ZjsKICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIG1hc3RlckRhdGEuYXR0ZW5kYW5jZW1yZXBvcnRteGVzID0gYXR0ZW5kYW5jZW1yZXBvcnRteGVzRGF0YTsKICAgICAgICAgICAgICAgIHBpbXdvcmtoaXN0b3JpZXNEYXRhID0gW107CgogICAgICAgICAgICAgICAgaWYgKCFPYmplY3QuaXModGhpcy50ZW1wU3RvcmFnZS5nZXRJdGVtKGNvbnRleHQuc3Jmc2Vzc2lvbmtleSArICdfcGltd29ya2hpc3RvcmllcycpLCAndW5kZWZpbmVkJykpIHsKICAgICAgICAgICAgICAgICAgcGltd29ya2hpc3Rvcmllc0RhdGEgPSBKU09OLnBhcnNlKHRoaXMudGVtcFN0b3JhZ2UuZ2V0SXRlbShjb250ZXh0LnNyZnNlc3Npb25rZXkgKyAnX3BpbXdvcmtoaXN0b3JpZXMnKSk7CgogICAgICAgICAgICAgICAgICBpZiAocGltd29ya2hpc3Rvcmllc0RhdGEgJiYgcGltd29ya2hpc3Rvcmllc0RhdGEubGVuZ3RoICYmIHBpbXdvcmtoaXN0b3JpZXNEYXRhLmxlbmd0aCA+IDApIHsKICAgICAgICAgICAgICAgICAgICBwaW13b3JraGlzdG9yaWVzRGF0YS5mb3JFYWNoKGZ1bmN0aW9uIChpdGVtKSB7CiAgICAgICAgICAgICAgICAgICAgICBpZiAoaXRlbS5zcmZmcm9udHVmKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChPYmplY3QuaXMoaXRlbS5zcmZmcm9udHVmLCAiMCIpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgaXRlbS5waW13b3JraGlzdG9yeWlkID0gbnVsbDsKICAgICAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICAgICAgZGVsZXRlIGl0ZW0uc3JmZnJvbnR1ZjsKICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIG1hc3RlckRhdGEucGltd29ya2hpc3RvcmllcyA9IHBpbXdvcmtoaXN0b3JpZXNEYXRhOwogICAgICAgICAgICAgICAgT2JqZWN0LmFzc2lnbihkYXRhLCBtYXN0ZXJEYXRhKTsKICAgICAgICAgICAgICAgIF9jb250ZXh0Mi5uZXh0ID0gNzM7CiAgICAgICAgICAgICAgICByZXR1cm4gSHR0cC5nZXRJbnN0YW5jZSgpLnB1dCgiL3BpbXBlb3BsZS8iLmNvbmNhdChjb250ZXh0LnBpbXBlcnNvbiksIGRhdGEsIGlzbG9hZGluZyk7CgogICAgICAgICAgICAgIGNhc2UgNzM6CiAgICAgICAgICAgICAgICByZXMgPSBfY29udGV4dDIuc2VudDsKICAgICAgICAgICAgICAgIHRoaXMudGVtcFN0b3JhZ2Uuc2V0SXRlbShjb250ZXh0LnNyZnNlc3Npb25rZXkgKyAnX3BpbXBlcnNvbmFiaWxpdGllcycsIEpTT04uc3RyaW5naWZ5KHJlcy5kYXRhLnBpbXBlcnNvbmFiaWxpdGllcykpOwogICAgICAgICAgICAgICAgdGhpcy50ZW1wU3RvcmFnZS5zZXRJdGVtKGNvbnRleHQuc3Jmc2Vzc2lvbmtleSArICdfcGltcGFwZXJzJywgSlNPTi5zdHJpbmdpZnkocmVzLmRhdGEucGltcGFwZXJzKSk7CiAgICAgICAgICAgICAgICB0aGlzLnRlbXBTdG9yYWdlLnNldEl0ZW0oY29udGV4dC5zcmZzZXNzaW9ua2V5ICsgJ19waW1kaXN0aXJidXRpb25zJywgSlNPTi5zdHJpbmdpZnkocmVzLmRhdGEucGltZGlzdGlyYnV0aW9ucykpOwogICAgICAgICAgICAgICAgdGhpcy50ZW1wU3RvcmFnZS5zZXRJdGVtKGNvbnRleHQuc3Jmc2Vzc2lvbmtleSArICdfcGltdGl0bGVzJywgSlNPTi5zdHJpbmdpZnkocmVzLmRhdGEucGltdGl0bGVzKSk7CiAgICAgICAgICAgICAgICB0aGlzLnRlbXBTdG9yYWdlLnNldEl0ZW0oY29udGV4dC5zcmZzZXNzaW9ua2V5ICsgJ19waW12b2NhdGlvbmFscycsIEpTT04uc3RyaW5naWZ5KHJlcy5kYXRhLnBpbXZvY2F0aW9uYWxzKSk7CiAgICAgICAgICAgICAgICB0aGlzLnRlbXBTdG9yYWdlLnNldEl0ZW0oY29udGV4dC5zcmZzZXNzaW9ua2V5ICsgJ19waW1hcm15Y2FkcmVzJywgSlNPTi5zdHJpbmdpZnkocmVzLmRhdGEucGltYXJteWNhZHJlcykpOwogICAgICAgICAgICAgICAgdGhpcy50ZW1wU3RvcmFnZS5zZXRJdGVtKGNvbnRleHQuc3Jmc2Vzc2lvbmtleSArICdfcGltY29ycmVjdGlvbmFwcGxpZXMnLCBKU09OLnN0cmluZ2lmeShyZXMuZGF0YS5waW1jb3JyZWN0aW9uYXBwbGllcykpOwogICAgICAgICAgICAgICAgdGhpcy50ZW1wU3RvcmFnZS5zZXRJdGVtKGNvbnRleHQuc3Jmc2Vzc2lvbmtleSArICdfcGltdmFjYXRpb25zJywgSlNPTi5zdHJpbmdpZnkocmVzLmRhdGEucGltdmFjYXRpb25zKSk7CiAgICAgICAgICAgICAgICB0aGlzLnRlbXBTdG9yYWdlLnNldEl0ZW0oY29udGV4dC5zcmZzZXNzaW9ua2V5ICsgJ190cm10cmFpbnBlb3BsZScsIEpTT04uc3RyaW5naWZ5KHJlcy5kYXRhLnRybXRyYWlucGVvcGxlKSk7CiAgICAgICAgICAgICAgICB0aGlzLnRlbXBTdG9yYWdlLnNldEl0ZW0oY29udGV4dC5zcmZzZXNzaW9ua2V5ICsgJ19waW1jb250cmFjdHMnLCBKU09OLnN0cmluZ2lmeShyZXMuZGF0YS5waW1jb250cmFjdHMpKTsKICAgICAgICAgICAgICAgIHRoaXMudGVtcFN0b3JhZ2Uuc2V0SXRlbShjb250ZXh0LnNyZnNlc3Npb25rZXkgKyAnX3BpbWVkdWNhdGlvbnMnLCBKU09OLnN0cmluZ2lmeShyZXMuZGF0YS5waW1lZHVjYXRpb25zKSk7CiAgICAgICAgICAgICAgICB0aGlzLnRlbXBTdG9yYWdlLnNldEl0ZW0oY29udGV4dC5zcmZzZXNzaW9ua2V5ICsgJ19waW1wZXJzb25jaGFuZ2VzJywgSlNPTi5zdHJpbmdpZnkocmVzLmRhdGEucGltcGVyc29uY2hhbmdlcykpOwogICAgICAgICAgICAgICAgdGhpcy50ZW1wU3RvcmFnZS5zZXRJdGVtKGNvbnRleHQuc3Jmc2Vzc2lvbmtleSArICdfcGltYWNoaWV2ZW1lbnRzJywgSlNPTi5zdHJpbmdpZnkocmVzLmRhdGEucGltYWNoaWV2ZW1lbnRzKSk7CiAgICAgICAgICAgICAgICB0aGlzLnRlbXBTdG9yYWdlLnNldEl0ZW0oY29udGV4dC5zcmZzZXNzaW9ua2V5ICsgJ19waW1yZXNlYXJjaGZpbmRpbmdzJywgSlNPTi5zdHJpbmdpZnkocmVzLmRhdGEucGltcmVzZWFyY2hmaW5kaW5ncykpOwogICAgICAgICAgICAgICAgdGhpcy50ZW1wU3RvcmFnZS5zZXRJdGVtKGNvbnRleHQuc3Jmc2Vzc2lvbmtleSArICdfcGltZXhpdGFuZGVudHJpZXMnLCBKU09OLnN0cmluZ2lmeShyZXMuZGF0YS5waW1leGl0YW5kZW50cmllcykpOwogICAgICAgICAgICAgICAgdGhpcy50ZW1wU3RvcmFnZS5zZXRJdGVtKGNvbnRleHQuc3Jmc2Vzc2lvbmtleSArICdfcGltcmV3YXJkcHVuaXNobWVudHMnLCBKU09OLnN0cmluZ2lmeShyZXMuZGF0YS5waW1yZXdhcmRwdW5pc2htZW50cykpOwogICAgICAgICAgICAgICAgdGhpcy50ZW1wU3RvcmFnZS5zZXRJdGVtKGNvbnRleHQuc3Jmc2Vzc2lvbmtleSArICdfcGltcGF0ZW50cycsIEpTT04uc3RyaW5naWZ5KHJlcy5kYXRhLnBpbXBhdGVudHMpKTsKICAgICAgICAgICAgICAgIHRoaXMudGVtcFN0b3JhZ2Uuc2V0SXRlbShjb250ZXh0LnNyZnNlc3Npb25rZXkgKyAnX3BpbWxhbmd1YWdlYWJpbGl0aWVzJywgSlNPTi5zdHJpbmdpZnkocmVzLmRhdGEucGltbGFuZ3VhZ2VhYmlsaXRpZXMpKTsKICAgICAgICAgICAgICAgIHRoaXMudGVtcFN0b3JhZ2Uuc2V0SXRlbShjb250ZXh0LnNyZnNlc3Npb25rZXkgKyAnX3BpbWFyY2hpdmVzJywgSlNPTi5zdHJpbmdpZnkocmVzLmRhdGEucGltYXJjaGl2ZXMpKTsKICAgICAgICAgICAgICAgIHRoaXMudGVtcFN0b3JhZ2Uuc2V0SXRlbShjb250ZXh0LnNyZnNlc3Npb25rZXkgKyAnX3BpbWZhbWluZm9zJywgSlNPTi5zdHJpbmdpZnkocmVzLmRhdGEucGltZmFtaW5mb3MpKTsKICAgICAgICAgICAgICAgIHRoaXMudGVtcFN0b3JhZ2Uuc2V0SXRlbShjb250ZXh0LnNyZnNlc3Npb25rZXkgKyAnX2F0dGVuZGFuY2VtcmVwb3J0bXhlcycsIEpTT04uc3RyaW5naWZ5KHJlcy5kYXRhLmF0dGVuZGFuY2VtcmVwb3J0bXhlcykpOwogICAgICAgICAgICAgICAgdGhpcy50ZW1wU3RvcmFnZS5zZXRJdGVtKGNvbnRleHQuc3Jmc2Vzc2lvbmtleSArICdfcGltd29ya2hpc3RvcmllcycsIEpTT04uc3RyaW5naWZ5KHJlcy5kYXRhLnBpbXdvcmtoaXN0b3JpZXMpKTsKICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDIuYWJydXB0KCJyZXR1cm4iLCByZXMpOwoKICAgICAgICAgICAgICBjYXNlIDk3OgogICAgICAgICAgICAgIGNhc2UgImVuZCI6CiAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQyLnN0b3AoKTsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0sIF9jYWxsZWUyLCB0aGlzKTsKICAgICAgfSkpOwoKICAgICAgZnVuY3Rpb24gVXBkYXRlKCkgewogICAgICAgIHJldHVybiBfVXBkYXRlLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7CiAgICAgIH0KCiAgICAgIHJldHVybiBVcGRhdGU7CiAgICB9KCkKICAgIC8qKg0KICAgICAqIFlaU0ZZWkZQ5o6l5Y+j5pa55rOVDQogICAgICoNCiAgICAgKiBAcGFyYW0geyp9IFtjb250ZXh0PXt9XQ0KICAgICAqIEBwYXJhbSB7Kn0gW2RhdGE9e31dDQogICAgICogQHBhcmFtIHtib29sZWFufSBbaXNsb2FkaW5nXQ0KICAgICAqIEByZXR1cm5zIHtQcm9taXNlPGFueT59DQogICAgICogQG1lbWJlcm9mIFBpbVBlcnNvblNlcnZpY2VCYXNlDQogICAgICovCgogIH0sIHsKICAgIGtleTogIllaU0ZZWkZQIiwKICAgIHZhbHVlOiBmdW5jdGlvbiAoKSB7CiAgICAgIHZhciBfWVpTRllaRlAgPSBfYXN5bmNUb0dlbmVyYXRvcigKICAgICAgLyojX19QVVJFX18qLwogICAgICByZWdlbmVyYXRvclJ1bnRpbWUubWFyayhmdW5jdGlvbiBfY2FsbGVlMygpIHsKICAgICAgICB2YXIgY29udGV4dCwKICAgICAgICAgICAgZGF0YSwKICAgICAgICAgICAgaXNsb2FkaW5nLAogICAgICAgICAgICBfYXJnczMgPSBhcmd1bWVudHM7CiAgICAgICAgcmV0dXJuIHJlZ2VuZXJhdG9yUnVudGltZS53cmFwKGZ1bmN0aW9uIF9jYWxsZWUzJChfY29udGV4dDMpIHsKICAgICAgICAgIHdoaWxlICgxKSB7CiAgICAgICAgICAgIHN3aXRjaCAoX2NvbnRleHQzLnByZXYgPSBfY29udGV4dDMubmV4dCkgewogICAgICAgICAgICAgIGNhc2UgMDoKICAgICAgICAgICAgICAgIGNvbnRleHQgPSBfYXJnczMubGVuZ3RoID4gMCAmJiBfYXJnczNbMF0gIT09IHVuZGVmaW5lZCA/IF9hcmdzM1swXSA6IHt9OwogICAgICAgICAgICAgICAgZGF0YSA9IF9hcmdzMy5sZW5ndGggPiAxICYmIF9hcmdzM1sxXSAhPT0gdW5kZWZpbmVkID8gX2FyZ3MzWzFdIDoge307CiAgICAgICAgICAgICAgICBpc2xvYWRpbmcgPSBfYXJnczMubGVuZ3RoID4gMiA/IF9hcmdzM1syXSA6IHVuZGVmaW5lZDsKICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDMuYWJydXB0KCJyZXR1cm4iLCBIdHRwLmdldEluc3RhbmNlKCkucG9zdCgiL3BpbXBlb3BsZS8iLmNvbmNhdChjb250ZXh0LnBpbXBlcnNvbiwgIi95enNmeXpmcCIpLCBkYXRhLCBpc2xvYWRpbmcpKTsKCiAgICAgICAgICAgICAgY2FzZSA0OgogICAgICAgICAgICAgIGNhc2UgImVuZCI6CiAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQzLnN0b3AoKTsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0sIF9jYWxsZWUzKTsKICAgICAgfSkpOwoKICAgICAgZnVuY3Rpb24gWVpTRllaRlAoKSB7CiAgICAgICAgcmV0dXJuIF9ZWlNGWVpGUC5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwogICAgICB9CgogICAgICByZXR1cm4gWVpTRllaRlA7CiAgICB9KCkKICAgIC8qKg0KICAgICAqIFRvZ2dsZUxlYWRlcuaOpeWPo+aWueazlQ0KICAgICAqDQogICAgICogQHBhcmFtIHsqfSBbY29udGV4dD17fV0NCiAgICAgKiBAcGFyYW0geyp9IFtkYXRhPXt9XQ0KICAgICAqIEBwYXJhbSB7Ym9vbGVhbn0gW2lzbG9hZGluZ10NCiAgICAgKiBAcmV0dXJucyB7UHJvbWlzZTxhbnk+fQ0KICAgICAqIEBtZW1iZXJvZiBQaW1QZXJzb25TZXJ2aWNlQmFzZQ0KICAgICAqLwoKICB9LCB7CiAgICBrZXk6ICJUb2dnbGVMZWFkZXIiLAogICAgdmFsdWU6IGZ1bmN0aW9uICgpIHsKICAgICAgdmFyIF9Ub2dnbGVMZWFkZXIgPSBfYXN5bmNUb0dlbmVyYXRvcigKICAgICAgLyojX19QVVJFX18qLwogICAgICByZWdlbmVyYXRvclJ1bnRpbWUubWFyayhmdW5jdGlvbiBfY2FsbGVlNCgpIHsKICAgICAgICB2YXIgY29udGV4dCwKICAgICAgICAgICAgZGF0YSwKICAgICAgICAgICAgaXNsb2FkaW5nLAogICAgICAgICAgICBfYXJnczQgPSBhcmd1bWVudHM7CiAgICAgICAgcmV0dXJuIHJlZ2VuZXJhdG9yUnVudGltZS53cmFwKGZ1bmN0aW9uIF9jYWxsZWU0JChfY29udGV4dDQpIHsKICAgICAgICAgIHdoaWxlICgxKSB7CiAgICAgICAgICAgIHN3aXRjaCAoX2NvbnRleHQ0LnByZXYgPSBfY29udGV4dDQubmV4dCkgewogICAgICAgICAgICAgIGNhc2UgMDoKICAgICAgICAgICAgICAgIGNvbnRleHQgPSBfYXJnczQubGVuZ3RoID4gMCAmJiBfYXJnczRbMF0gIT09IHVuZGVmaW5lZCA/IF9hcmdzNFswXSA6IHt9OwogICAgICAgICAgICAgICAgZGF0YSA9IF9hcmdzNC5sZW5ndGggPiAxICYmIF9hcmdzNFsxXSAhPT0gdW5kZWZpbmVkID8gX2FyZ3M0WzFdIDoge307CiAgICAgICAgICAgICAgICBpc2xvYWRpbmcgPSBfYXJnczQubGVuZ3RoID4gMiA/IF9hcmdzNFsyXSA6IHVuZGVmaW5lZDsKICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDQuYWJydXB0KCJyZXR1cm4iLCBIdHRwLmdldEluc3RhbmNlKCkucG9zdCgiL3BpbXBlb3BsZS8iLmNvbmNhdChjb250ZXh0LnBpbXBlcnNvbiwgIi90b2dnbGVsZWFkZXIiKSwgZGF0YSwgaXNsb2FkaW5nKSk7CgogICAgICAgICAgICAgIGNhc2UgNDoKICAgICAgICAgICAgICBjYXNlICJlbmQiOgogICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0NC5zdG9wKCk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9LCBfY2FsbGVlNCk7CiAgICAgIH0pKTsKCiAgICAgIGZ1bmN0aW9uIFRvZ2dsZUxlYWRlcigpIHsKICAgICAgICByZXR1cm4gX1RvZ2dsZUxlYWRlci5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwogICAgICB9CgogICAgICByZXR1cm4gVG9nZ2xlTGVhZGVyOwogICAgfSgpCiAgICAvKioNCiAgICAgKiBHZXTmjqXlj6Pmlrnms5UNCiAgICAgKg0KICAgICAqIEBwYXJhbSB7Kn0gW2NvbnRleHQ9e31dDQogICAgICogQHBhcmFtIHsqfSBbZGF0YT17fV0NCiAgICAgKiBAcGFyYW0ge2Jvb2xlYW59IFtpc2xvYWRpbmddDQogICAgICogQHJldHVybnMge1Byb21pc2U8YW55Pn0NCiAgICAgKiBAbWVtYmVyb2YgUGltUGVyc29uU2VydmljZUJhc2UNCiAgICAgKi8KCiAgfSwgewogICAga2V5OiAiR2V0IiwKICAgIHZhbHVlOiBmdW5jdGlvbiAoKSB7CiAgICAgIHZhciBfR2V0ID0gX2FzeW5jVG9HZW5lcmF0b3IoCiAgICAgIC8qI19fUFVSRV9fKi8KICAgICAgcmVnZW5lcmF0b3JSdW50aW1lLm1hcmsoZnVuY3Rpb24gX2NhbGxlZTUoKSB7CiAgICAgICAgdmFyIGNvbnRleHQsCiAgICAgICAgICAgIGRhdGEsCiAgICAgICAgICAgIGlzbG9hZGluZywKICAgICAgICAgICAgcmVzLAogICAgICAgICAgICBfYXJnczUgPSBhcmd1bWVudHM7CiAgICAgICAgcmV0dXJuIHJlZ2VuZXJhdG9yUnVudGltZS53cmFwKGZ1bmN0aW9uIF9jYWxsZWU1JChfY29udGV4dDUpIHsKICAgICAgICAgIHdoaWxlICgxKSB7CiAgICAgICAgICAgIHN3aXRjaCAoX2NvbnRleHQ1LnByZXYgPSBfY29udGV4dDUubmV4dCkgewogICAgICAgICAgICAgIGNhc2UgMDoKICAgICAgICAgICAgICAgIGNvbnRleHQgPSBfYXJnczUubGVuZ3RoID4gMCAmJiBfYXJnczVbMF0gIT09IHVuZGVmaW5lZCA/IF9hcmdzNVswXSA6IHt9OwogICAgICAgICAgICAgICAgZGF0YSA9IF9hcmdzNS5sZW5ndGggPiAxICYmIF9hcmdzNVsxXSAhPT0gdW5kZWZpbmVkID8gX2FyZ3M1WzFdIDoge307CiAgICAgICAgICAgICAgICBpc2xvYWRpbmcgPSBfYXJnczUubGVuZ3RoID4gMiA/IF9hcmdzNVsyXSA6IHVuZGVmaW5lZDsKICAgICAgICAgICAgICAgIF9jb250ZXh0NS5uZXh0ID0gNTsKICAgICAgICAgICAgICAgIHJldHVybiBIdHRwLmdldEluc3RhbmNlKCkuZ2V0KCIvcGltcGVvcGxlLyIuY29uY2F0KGNvbnRleHQucGltcGVyc29uKSwgaXNsb2FkaW5nKTsKCiAgICAgICAgICAgICAgY2FzZSA1OgogICAgICAgICAgICAgICAgcmVzID0gX2NvbnRleHQ1LnNlbnQ7CiAgICAgICAgICAgICAgICB0aGlzLnRlbXBTdG9yYWdlLnNldEl0ZW0oY29udGV4dC5zcmZzZXNzaW9ua2V5ICsgJ19waW1wZXJzb25hYmlsaXRpZXMnLCBKU09OLnN0cmluZ2lmeShyZXMuZGF0YS5waW1wZXJzb25hYmlsaXRpZXMpKTsKICAgICAgICAgICAgICAgIHRoaXMudGVtcFN0b3JhZ2Uuc2V0SXRlbShjb250ZXh0LnNyZnNlc3Npb25rZXkgKyAnX3BpbXBhcGVycycsIEpTT04uc3RyaW5naWZ5KHJlcy5kYXRhLnBpbXBhcGVycykpOwogICAgICAgICAgICAgICAgdGhpcy50ZW1wU3RvcmFnZS5zZXRJdGVtKGNvbnRleHQuc3Jmc2Vzc2lvbmtleSArICdfcGltZGlzdGlyYnV0aW9ucycsIEpTT04uc3RyaW5naWZ5KHJlcy5kYXRhLnBpbWRpc3RpcmJ1dGlvbnMpKTsKICAgICAgICAgICAgICAgIHRoaXMudGVtcFN0b3JhZ2Uuc2V0SXRlbShjb250ZXh0LnNyZnNlc3Npb25rZXkgKyAnX3BpbXRpdGxlcycsIEpTT04uc3RyaW5naWZ5KHJlcy5kYXRhLnBpbXRpdGxlcykpOwogICAgICAgICAgICAgICAgdGhpcy50ZW1wU3RvcmFnZS5zZXRJdGVtKGNvbnRleHQuc3Jmc2Vzc2lvbmtleSArICdfcGltdm9jYXRpb25hbHMnLCBKU09OLnN0cmluZ2lmeShyZXMuZGF0YS5waW12b2NhdGlvbmFscykpOwogICAgICAgICAgICAgICAgdGhpcy50ZW1wU3RvcmFnZS5zZXRJdGVtKGNvbnRleHQuc3Jmc2Vzc2lvbmtleSArICdfcGltYXJteWNhZHJlcycsIEpTT04uc3RyaW5naWZ5KHJlcy5kYXRhLnBpbWFybXljYWRyZXMpKTsKICAgICAgICAgICAgICAgIHRoaXMudGVtcFN0b3JhZ2Uuc2V0SXRlbShjb250ZXh0LnNyZnNlc3Npb25rZXkgKyAnX3BpbWNvcnJlY3Rpb25hcHBsaWVzJywgSlNPTi5zdHJpbmdpZnkocmVzLmRhdGEucGltY29ycmVjdGlvbmFwcGxpZXMpKTsKICAgICAgICAgICAgICAgIHRoaXMudGVtcFN0b3JhZ2Uuc2V0SXRlbShjb250ZXh0LnNyZnNlc3Npb25rZXkgKyAnX3BpbXZhY2F0aW9ucycsIEpTT04uc3RyaW5naWZ5KHJlcy5kYXRhLnBpbXZhY2F0aW9ucykpOwogICAgICAgICAgICAgICAgdGhpcy50ZW1wU3RvcmFnZS5zZXRJdGVtKGNvbnRleHQuc3Jmc2Vzc2lvbmtleSArICdfdHJtdHJhaW5wZW9wbGUnLCBKU09OLnN0cmluZ2lmeShyZXMuZGF0YS50cm10cmFpbnBlb3BsZSkpOwogICAgICAgICAgICAgICAgdGhpcy50ZW1wU3RvcmFnZS5zZXRJdGVtKGNvbnRleHQuc3Jmc2Vzc2lvbmtleSArICdfcGltY29udHJhY3RzJywgSlNPTi5zdHJpbmdpZnkocmVzLmRhdGEucGltY29udHJhY3RzKSk7CiAgICAgICAgICAgICAgICB0aGlzLnRlbXBTdG9yYWdlLnNldEl0ZW0oY29udGV4dC5zcmZzZXNzaW9ua2V5ICsgJ19waW1lZHVjYXRpb25zJywgSlNPTi5zdHJpbmdpZnkocmVzLmRhdGEucGltZWR1Y2F0aW9ucykpOwogICAgICAgICAgICAgICAgdGhpcy50ZW1wU3RvcmFnZS5zZXRJdGVtKGNvbnRleHQuc3Jmc2Vzc2lvbmtleSArICdfcGltcGVyc29uY2hhbmdlcycsIEpTT04uc3RyaW5naWZ5KHJlcy5kYXRhLnBpbXBlcnNvbmNoYW5nZXMpKTsKICAgICAgICAgICAgICAgIHRoaXMudGVtcFN0b3JhZ2Uuc2V0SXRlbShjb250ZXh0LnNyZnNlc3Npb25rZXkgKyAnX3BpbWFjaGlldmVtZW50cycsIEpTT04uc3RyaW5naWZ5KHJlcy5kYXRhLnBpbWFjaGlldmVtZW50cykpOwogICAgICAgICAgICAgICAgdGhpcy50ZW1wU3RvcmFnZS5zZXRJdGVtKGNvbnRleHQuc3Jmc2Vzc2lvbmtleSArICdfcGltcmVzZWFyY2hmaW5kaW5ncycsIEpTT04uc3RyaW5naWZ5KHJlcy5kYXRhLnBpbXJlc2VhcmNoZmluZGluZ3MpKTsKICAgICAgICAgICAgICAgIHRoaXMudGVtcFN0b3JhZ2Uuc2V0SXRlbShjb250ZXh0LnNyZnNlc3Npb25rZXkgKyAnX3BpbWV4aXRhbmRlbnRyaWVzJywgSlNPTi5zdHJpbmdpZnkocmVzLmRhdGEucGltZXhpdGFuZGVudHJpZXMpKTsKICAgICAgICAgICAgICAgIHRoaXMudGVtcFN0b3JhZ2Uuc2V0SXRlbShjb250ZXh0LnNyZnNlc3Npb25rZXkgKyAnX3BpbXJld2FyZHB1bmlzaG1lbnRzJywgSlNPTi5zdHJpbmdpZnkocmVzLmRhdGEucGltcmV3YXJkcHVuaXNobWVudHMpKTsKICAgICAgICAgICAgICAgIHRoaXMudGVtcFN0b3JhZ2Uuc2V0SXRlbShjb250ZXh0LnNyZnNlc3Npb25rZXkgKyAnX3BpbXBhdGVudHMnLCBKU09OLnN0cmluZ2lmeShyZXMuZGF0YS5waW1wYXRlbnRzKSk7CiAgICAgICAgICAgICAgICB0aGlzLnRlbXBTdG9yYWdlLnNldEl0ZW0oY29udGV4dC5zcmZzZXNzaW9ua2V5ICsgJ19waW1sYW5ndWFnZWFiaWxpdGllcycsIEpTT04uc3RyaW5naWZ5KHJlcy5kYXRhLnBpbWxhbmd1YWdlYWJpbGl0aWVzKSk7CiAgICAgICAgICAgICAgICB0aGlzLnRlbXBTdG9yYWdlLnNldEl0ZW0oY29udGV4dC5zcmZzZXNzaW9ua2V5ICsgJ19waW1hcmNoaXZlcycsIEpTT04uc3RyaW5naWZ5KHJlcy5kYXRhLnBpbWFyY2hpdmVzKSk7CiAgICAgICAgICAgICAgICB0aGlzLnRlbXBTdG9yYWdlLnNldEl0ZW0oY29udGV4dC5zcmZzZXNzaW9ua2V5ICsgJ19waW1mYW1pbmZvcycsIEpTT04uc3RyaW5naWZ5KHJlcy5kYXRhLnBpbWZhbWluZm9zKSk7CiAgICAgICAgICAgICAgICB0aGlzLnRlbXBTdG9yYWdlLnNldEl0ZW0oY29udGV4dC5zcmZzZXNzaW9ua2V5ICsgJ19hdHRlbmRhbmNlbXJlcG9ydG14ZXMnLCBKU09OLnN0cmluZ2lmeShyZXMuZGF0YS5hdHRlbmRhbmNlbXJlcG9ydG14ZXMpKTsKICAgICAgICAgICAgICAgIHRoaXMudGVtcFN0b3JhZ2Uuc2V0SXRlbShjb250ZXh0LnNyZnNlc3Npb25rZXkgKyAnX3BpbXdvcmtoaXN0b3JpZXMnLCBKU09OLnN0cmluZ2lmeShyZXMuZGF0YS5waW13b3JraGlzdG9yaWVzKSk7CiAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQ1LmFicnVwdCgicmV0dXJuIiwgcmVzKTsKCiAgICAgICAgICAgICAgY2FzZSAyOToKICAgICAgICAgICAgICBjYXNlICJlbmQiOgogICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0NS5zdG9wKCk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9LCBfY2FsbGVlNSwgdGhpcyk7CiAgICAgIH0pKTsKCiAgICAgIGZ1bmN0aW9uIEdldCgpIHsKICAgICAgICByZXR1cm4gX0dldC5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwogICAgICB9CgogICAgICByZXR1cm4gR2V0OwogICAgfSgpCiAgICAvKioNCiAgICAgKiBQZXJzb25VcGRhdGVJbmZv5o6l5Y+j5pa55rOVDQogICAgICoNCiAgICAgKiBAcGFyYW0geyp9IFtjb250ZXh0PXt9XQ0KICAgICAqIEBwYXJhbSB7Kn0gW2RhdGE9e31dDQogICAgICogQHBhcmFtIHtib29sZWFufSBbaXNsb2FkaW5nXQ0KICAgICAqIEByZXR1cm5zIHtQcm9taXNlPGFueT59DQogICAgICogQG1lbWJlcm9mIFBpbVBlcnNvblNlcnZpY2VCYXNlDQogICAgICovCgogIH0sIHsKICAgIGtleTogIlBlcnNvblVwZGF0ZUluZm8iLAogICAgdmFsdWU6IGZ1bmN0aW9uICgpIHsKICAgICAgdmFyIF9QZXJzb25VcGRhdGVJbmZvID0gX2FzeW5jVG9HZW5lcmF0b3IoCiAgICAgIC8qI19fUFVSRV9fKi8KICAgICAgcmVnZW5lcmF0b3JSdW50aW1lLm1hcmsoZnVuY3Rpb24gX2NhbGxlZTYoKSB7CiAgICAgICAgdmFyIGNvbnRleHQsCiAgICAgICAgICAgIGRhdGEsCiAgICAgICAgICAgIGlzbG9hZGluZywKICAgICAgICAgICAgX2FyZ3M2ID0gYXJndW1lbnRzOwogICAgICAgIHJldHVybiByZWdlbmVyYXRvclJ1bnRpbWUud3JhcChmdW5jdGlvbiBfY2FsbGVlNiQoX2NvbnRleHQ2KSB7CiAgICAgICAgICB3aGlsZSAoMSkgewogICAgICAgICAgICBzd2l0Y2ggKF9jb250ZXh0Ni5wcmV2ID0gX2NvbnRleHQ2Lm5leHQpIHsKICAgICAgICAgICAgICBjYXNlIDA6CiAgICAgICAgICAgICAgICBjb250ZXh0ID0gX2FyZ3M2Lmxlbmd0aCA+IDAgJiYgX2FyZ3M2WzBdICE9PSB1bmRlZmluZWQgPyBfYXJnczZbMF0gOiB7fTsKICAgICAgICAgICAgICAgIGRhdGEgPSBfYXJnczYubGVuZ3RoID4gMSAmJiBfYXJnczZbMV0gIT09IHVuZGVmaW5lZCA/IF9hcmdzNlsxXSA6IHt9OwogICAgICAgICAgICAgICAgaXNsb2FkaW5nID0gX2FyZ3M2Lmxlbmd0aCA+IDIgPyBfYXJnczZbMl0gOiB1bmRlZmluZWQ7CiAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQ2LmFicnVwdCgicmV0dXJuIiwgSHR0cC5nZXRJbnN0YW5jZSgpLnB1dCgiL3BpbXBlb3BsZS8iLmNvbmNhdChjb250ZXh0LnBpbXBlcnNvbiwgIi9wZXJzb251cGRhdGVpbmZvIiksIGRhdGEsIGlzbG9hZGluZykpOwoKICAgICAgICAgICAgICBjYXNlIDQ6CiAgICAgICAgICAgICAgY2FzZSAiZW5kIjoKICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDYuc3RvcCgpOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSwgX2NhbGxlZTYpOwogICAgICB9KSk7CgogICAgICBmdW5jdGlvbiBQZXJzb25VcGRhdGVJbmZvKCkgewogICAgICAgIHJldHVybiBfUGVyc29uVXBkYXRlSW5mby5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwogICAgICB9CgogICAgICByZXR1cm4gUGVyc29uVXBkYXRlSW5mbzsKICAgIH0oKQogICAgLyoqDQogICAgICogRmlsbFBlcnNvblR5cGXmjqXlj6Pmlrnms5UNCiAgICAgKg0KICAgICAqIEBwYXJhbSB7Kn0gW2NvbnRleHQ9e31dDQogICAgICogQHBhcmFtIHsqfSBbZGF0YT17fV0NCiAgICAgKiBAcGFyYW0ge2Jvb2xlYW59IFtpc2xvYWRpbmddDQogICAgICogQHJldHVybnMge1Byb21pc2U8YW55Pn0NCiAgICAgKiBAbWVtYmVyb2YgUGltUGVyc29uU2VydmljZUJhc2UNCiAgICAgKi8KCiAgfSwgewogICAga2V5OiAiRmlsbFBlcnNvblR5cGUiLAogICAgdmFsdWU6IGZ1bmN0aW9uICgpIHsKICAgICAgdmFyIF9GaWxsUGVyc29uVHlwZSA9IF9hc3luY1RvR2VuZXJhdG9yKAogICAgICAvKiNfX1BVUkVfXyovCiAgICAgIHJlZ2VuZXJhdG9yUnVudGltZS5tYXJrKGZ1bmN0aW9uIF9jYWxsZWU3KCkgewogICAgICAgIHZhciBjb250ZXh0LAogICAgICAgICAgICBkYXRhLAogICAgICAgICAgICBpc2xvYWRpbmcsCiAgICAgICAgICAgIF9hcmdzNyA9IGFyZ3VtZW50czsKICAgICAgICByZXR1cm4gcmVnZW5lcmF0b3JSdW50aW1lLndyYXAoZnVuY3Rpb24gX2NhbGxlZTckKF9jb250ZXh0NykgewogICAgICAgICAgd2hpbGUgKDEpIHsKICAgICAgICAgICAgc3dpdGNoIChfY29udGV4dDcucHJldiA9IF9jb250ZXh0Ny5uZXh0KSB7CiAgICAgICAgICAgICAgY2FzZSAwOgogICAgICAgICAgICAgICAgY29udGV4dCA9IF9hcmdzNy5sZW5ndGggPiAwICYmIF9hcmdzN1swXSAhPT0gdW5kZWZpbmVkID8gX2FyZ3M3WzBdIDoge307CiAgICAgICAgICAgICAgICBkYXRhID0gX2FyZ3M3Lmxlbmd0aCA+IDEgJiYgX2FyZ3M3WzFdICE9PSB1bmRlZmluZWQgPyBfYXJnczdbMV0gOiB7fTsKICAgICAgICAgICAgICAgIGlzbG9hZGluZyA9IF9hcmdzNy5sZW5ndGggPiAyID8gX2FyZ3M3WzJdIDogdW5kZWZpbmVkOwogICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0Ny5hYnJ1cHQoInJldHVybiIsIEh0dHAuZ2V0SW5zdGFuY2UoKS5wb3N0KCIvcGltcGVvcGxlLyIuY29uY2F0KGNvbnRleHQucGltcGVyc29uLCAiL2ZpbGxwZXJzb250eXBlIiksIGRhdGEsIGlzbG9hZGluZykpOwoKICAgICAgICAgICAgICBjYXNlIDQ6CiAgICAgICAgICAgICAgY2FzZSAiZW5kIjoKICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDcuc3RvcCgpOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSwgX2NhbGxlZTcpOwogICAgICB9KSk7CgogICAgICBmdW5jdGlvbiBGaWxsUGVyc29uVHlwZSgpIHsKICAgICAgICByZXR1cm4gX0ZpbGxQZXJzb25UeXBlLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7CiAgICAgIH0KCiAgICAgIHJldHVybiBGaWxsUGVyc29uVHlwZTsKICAgIH0oKQogICAgLyoqDQogICAgICogQ3JlYXRl5o6l5Y+j5pa55rOVDQogICAgICoNCiAgICAgKiBAcGFyYW0geyp9IFtjb250ZXh0PXt9XQ0KICAgICAqIEBwYXJhbSB7Kn0gW2RhdGE9e31dDQogICAgICogQHBhcmFtIHtib29sZWFufSBbaXNsb2FkaW5nXQ0KICAgICAqIEByZXR1cm5zIHtQcm9taXNlPGFueT59DQogICAgICogQG1lbWJlcm9mIFBpbVBlcnNvblNlcnZpY2VCYXNlDQogICAgICovCgogIH0sIHsKICAgIGtleTogIkNyZWF0ZSIsCiAgICB2YWx1ZTogZnVuY3Rpb24gKCkgewogICAgICB2YXIgX0NyZWF0ZSA9IF9hc3luY1RvR2VuZXJhdG9yKAogICAgICAvKiNfX1BVUkVfXyovCiAgICAgIHJlZ2VuZXJhdG9yUnVudGltZS5tYXJrKGZ1bmN0aW9uIF9jYWxsZWU4KCkgewogICAgICAgIHZhciBjb250ZXh0LAogICAgICAgICAgICBkYXRhLAogICAgICAgICAgICBpc2xvYWRpbmcsCiAgICAgICAgICAgIG1hc3RlckRhdGEsCiAgICAgICAgICAgIHBpbXBlcnNvbmFiaWxpdGllc0RhdGEsCiAgICAgICAgICAgIHBpbXBhcGVyc0RhdGEsCiAgICAgICAgICAgIHBpbWRpc3RpcmJ1dGlvbnNEYXRhLAogICAgICAgICAgICBwaW10aXRsZXNEYXRhLAogICAgICAgICAgICBwaW12b2NhdGlvbmFsc0RhdGEsCiAgICAgICAgICAgIHBpbWFybXljYWRyZXNEYXRhLAogICAgICAgICAgICBwaW1jb3JyZWN0aW9uYXBwbGllc0RhdGEsCiAgICAgICAgICAgIHBpbXZhY2F0aW9uc0RhdGEsCiAgICAgICAgICAgIHRybXRyYWlucGVvcGxlRGF0YSwKICAgICAgICAgICAgcGltY29udHJhY3RzRGF0YSwKICAgICAgICAgICAgcGltZWR1Y2F0aW9uc0RhdGEsCiAgICAgICAgICAgIHBpbXBlcnNvbmNoYW5nZXNEYXRhLAogICAgICAgICAgICBwaW1hY2hpZXZlbWVudHNEYXRhLAogICAgICAgICAgICBwaW1yZXNlYXJjaGZpbmRpbmdzRGF0YSwKICAgICAgICAgICAgcGltZXhpdGFuZGVudHJpZXNEYXRhLAogICAgICAgICAgICBwaW1yZXdhcmRwdW5pc2htZW50c0RhdGEsCiAgICAgICAgICAgIHBpbXBhdGVudHNEYXRhLAogICAgICAgICAgICBwaW1sYW5ndWFnZWFiaWxpdGllc0RhdGEsCiAgICAgICAgICAgIHBpbWFyY2hpdmVzRGF0YSwKICAgICAgICAgICAgcGltZmFtaW5mb3NEYXRhLAogICAgICAgICAgICBhdHRlbmRhbmNlbXJlcG9ydG14ZXNEYXRhLAogICAgICAgICAgICBwaW13b3JraGlzdG9yaWVzRGF0YSwKICAgICAgICAgICAgdGVtcENvbnRleHQsCiAgICAgICAgICAgIHJlcywKICAgICAgICAgICAgX2FyZ3M4ID0gYXJndW1lbnRzOwogICAgICAgIHJldHVybiByZWdlbmVyYXRvclJ1bnRpbWUud3JhcChmdW5jdGlvbiBfY2FsbGVlOCQoX2NvbnRleHQ4KSB7CiAgICAgICAgICB3aGlsZSAoMSkgewogICAgICAgICAgICBzd2l0Y2ggKF9jb250ZXh0OC5wcmV2ID0gX2NvbnRleHQ4Lm5leHQpIHsKICAgICAgICAgICAgICBjYXNlIDA6CiAgICAgICAgICAgICAgICBjb250ZXh0ID0gX2FyZ3M4Lmxlbmd0aCA+IDAgJiYgX2FyZ3M4WzBdICE9PSB1bmRlZmluZWQgPyBfYXJnczhbMF0gOiB7fTsKICAgICAgICAgICAgICAgIGRhdGEgPSBfYXJnczgubGVuZ3RoID4gMSAmJiBfYXJnczhbMV0gIT09IHVuZGVmaW5lZCA/IF9hcmdzOFsxXSA6IHt9OwogICAgICAgICAgICAgICAgaXNsb2FkaW5nID0gX2FyZ3M4Lmxlbmd0aCA+IDIgPyBfYXJnczhbMl0gOiB1bmRlZmluZWQ7CiAgICAgICAgICAgICAgICBtYXN0ZXJEYXRhID0ge307CiAgICAgICAgICAgICAgICBwaW1wZXJzb25hYmlsaXRpZXNEYXRhID0gW107CgogICAgICAgICAgICAgICAgaWYgKCFPYmplY3QuaXModGhpcy50ZW1wU3RvcmFnZS5nZXRJdGVtKGNvbnRleHQuc3Jmc2Vzc2lvbmtleSArICdfcGltcGVyc29uYWJpbGl0aWVzJyksICd1bmRlZmluZWQnKSkgewogICAgICAgICAgICAgICAgICBwaW1wZXJzb25hYmlsaXRpZXNEYXRhID0gSlNPTi5wYXJzZSh0aGlzLnRlbXBTdG9yYWdlLmdldEl0ZW0oY29udGV4dC5zcmZzZXNzaW9ua2V5ICsgJ19waW1wZXJzb25hYmlsaXRpZXMnKSk7CgogICAgICAgICAgICAgICAgICBpZiAocGltcGVyc29uYWJpbGl0aWVzRGF0YSAmJiBwaW1wZXJzb25hYmlsaXRpZXNEYXRhLmxlbmd0aCAmJiBwaW1wZXJzb25hYmlsaXRpZXNEYXRhLmxlbmd0aCA+IDApIHsKICAgICAgICAgICAgICAgICAgICBwaW1wZXJzb25hYmlsaXRpZXNEYXRhLmZvckVhY2goZnVuY3Rpb24gKGl0ZW0pIHsKICAgICAgICAgICAgICAgICAgICAgIGlmIChpdGVtLnNyZmZyb250dWYpIHsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKE9iamVjdC5pcyhpdGVtLnNyZmZyb250dWYsICIwIikpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICBpdGVtLnBpbXBlcnNvbmFiaWxpdHlpZCA9IG51bGw7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgICAgIGRlbGV0ZSBpdGVtLnNyZmZyb250dWY7CiAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBtYXN0ZXJEYXRhLnBpbXBlcnNvbmFiaWxpdGllcyA9IHBpbXBlcnNvbmFiaWxpdGllc0RhdGE7CiAgICAgICAgICAgICAgICBwaW1wYXBlcnNEYXRhID0gW107CgogICAgICAgICAgICAgICAgaWYgKCFPYmplY3QuaXModGhpcy50ZW1wU3RvcmFnZS5nZXRJdGVtKGNvbnRleHQuc3Jmc2Vzc2lvbmtleSArICdfcGltcGFwZXJzJyksICd1bmRlZmluZWQnKSkgewogICAgICAgICAgICAgICAgICBwaW1wYXBlcnNEYXRhID0gSlNPTi5wYXJzZSh0aGlzLnRlbXBTdG9yYWdlLmdldEl0ZW0oY29udGV4dC5zcmZzZXNzaW9ua2V5ICsgJ19waW1wYXBlcnMnKSk7CgogICAgICAgICAgICAgICAgICBpZiAocGltcGFwZXJzRGF0YSAmJiBwaW1wYXBlcnNEYXRhLmxlbmd0aCAmJiBwaW1wYXBlcnNEYXRhLmxlbmd0aCA+IDApIHsKICAgICAgICAgICAgICAgICAgICBwaW1wYXBlcnNEYXRhLmZvckVhY2goZnVuY3Rpb24gKGl0ZW0pIHsKICAgICAgICAgICAgICAgICAgICAgIGlmIChpdGVtLnNyZmZyb250dWYpIHsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKE9iamVjdC5pcyhpdGVtLnNyZmZyb250dWYsICIwIikpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICBpdGVtLnBpbXBhcGVyaWQgPSBudWxsOwogICAgICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgICAgICBkZWxldGUgaXRlbS5zcmZmcm9udHVmOwogICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgbWFzdGVyRGF0YS5waW1wYXBlcnMgPSBwaW1wYXBlcnNEYXRhOwogICAgICAgICAgICAgICAgcGltZGlzdGlyYnV0aW9uc0RhdGEgPSBbXTsKCiAgICAgICAgICAgICAgICBpZiAoIU9iamVjdC5pcyh0aGlzLnRlbXBTdG9yYWdlLmdldEl0ZW0oY29udGV4dC5zcmZzZXNzaW9ua2V5ICsgJ19waW1kaXN0aXJidXRpb25zJyksICd1bmRlZmluZWQnKSkgewogICAgICAgICAgICAgICAgICBwaW1kaXN0aXJidXRpb25zRGF0YSA9IEpTT04ucGFyc2UodGhpcy50ZW1wU3RvcmFnZS5nZXRJdGVtKGNvbnRleHQuc3Jmc2Vzc2lvbmtleSArICdfcGltZGlzdGlyYnV0aW9ucycpKTsKCiAgICAgICAgICAgICAgICAgIGlmIChwaW1kaXN0aXJidXRpb25zRGF0YSAmJiBwaW1kaXN0aXJidXRpb25zRGF0YS5sZW5ndGggJiYgcGltZGlzdGlyYnV0aW9uc0RhdGEubGVuZ3RoID4gMCkgewogICAgICAgICAgICAgICAgICAgIHBpbWRpc3RpcmJ1dGlvbnNEYXRhLmZvckVhY2goZnVuY3Rpb24gKGl0ZW0pIHsKICAgICAgICAgICAgICAgICAgICAgIGlmIChpdGVtLnNyZmZyb250dWYpIHsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKE9iamVjdC5pcyhpdGVtLnNyZmZyb250dWYsICIwIikpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICBpdGVtLnBpbWRpc3RpcmJ1dGlvbmlkID0gbnVsbDsKICAgICAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICAgICAgZGVsZXRlIGl0ZW0uc3JmZnJvbnR1ZjsKICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIG1hc3RlckRhdGEucGltZGlzdGlyYnV0aW9ucyA9IHBpbWRpc3RpcmJ1dGlvbnNEYXRhOwogICAgICAgICAgICAgICAgcGltdGl0bGVzRGF0YSA9IFtdOwoKICAgICAgICAgICAgICAgIGlmICghT2JqZWN0LmlzKHRoaXMudGVtcFN0b3JhZ2UuZ2V0SXRlbShjb250ZXh0LnNyZnNlc3Npb25rZXkgKyAnX3BpbXRpdGxlcycpLCAndW5kZWZpbmVkJykpIHsKICAgICAgICAgICAgICAgICAgcGltdGl0bGVzRGF0YSA9IEpTT04ucGFyc2UodGhpcy50ZW1wU3RvcmFnZS5nZXRJdGVtKGNvbnRleHQuc3Jmc2Vzc2lvbmtleSArICdfcGltdGl0bGVzJykpOwoKICAgICAgICAgICAgICAgICAgaWYgKHBpbXRpdGxlc0RhdGEgJiYgcGltdGl0bGVzRGF0YS5sZW5ndGggJiYgcGltdGl0bGVzRGF0YS5sZW5ndGggPiAwKSB7CiAgICAgICAgICAgICAgICAgICAgcGltdGl0bGVzRGF0YS5mb3JFYWNoKGZ1bmN0aW9uIChpdGVtKSB7CiAgICAgICAgICAgICAgICAgICAgICBpZiAoaXRlbS5zcmZmcm9udHVmKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChPYmplY3QuaXMoaXRlbS5zcmZmcm9udHVmLCAiMCIpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgaXRlbS5waW10aXRsZWlkID0gbnVsbDsKICAgICAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICAgICAgZGVsZXRlIGl0ZW0uc3JmZnJvbnR1ZjsKICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIG1hc3RlckRhdGEucGltdGl0bGVzID0gcGltdGl0bGVzRGF0YTsKICAgICAgICAgICAgICAgIHBpbXZvY2F0aW9uYWxzRGF0YSA9IFtdOwoKICAgICAgICAgICAgICAgIGlmICghT2JqZWN0LmlzKHRoaXMudGVtcFN0b3JhZ2UuZ2V0SXRlbShjb250ZXh0LnNyZnNlc3Npb25rZXkgKyAnX3BpbXZvY2F0aW9uYWxzJyksICd1bmRlZmluZWQnKSkgewogICAgICAgICAgICAgICAgICBwaW12b2NhdGlvbmFsc0RhdGEgPSBKU09OLnBhcnNlKHRoaXMudGVtcFN0b3JhZ2UuZ2V0SXRlbShjb250ZXh0LnNyZnNlc3Npb25rZXkgKyAnX3BpbXZvY2F0aW9uYWxzJykpOwoKICAgICAgICAgICAgICAgICAgaWYgKHBpbXZvY2F0aW9uYWxzRGF0YSAmJiBwaW12b2NhdGlvbmFsc0RhdGEubGVuZ3RoICYmIHBpbXZvY2F0aW9uYWxzRGF0YS5sZW5ndGggPiAwKSB7CiAgICAgICAgICAgICAgICAgICAgcGltdm9jYXRpb25hbHNEYXRhLmZvckVhY2goZnVuY3Rpb24gKGl0ZW0pIHsKICAgICAgICAgICAgICAgICAgICAgIGlmIChpdGVtLnNyZmZyb250dWYpIHsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKE9iamVjdC5pcyhpdGVtLnNyZmZyb250dWYsICIwIikpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICBpdGVtLnBpbXZvY2F0aW9uYWxpZCA9IG51bGw7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgICAgIGRlbGV0ZSBpdGVtLnNyZmZyb250dWY7CiAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBtYXN0ZXJEYXRhLnBpbXZvY2F0aW9uYWxzID0gcGltdm9jYXRpb25hbHNEYXRhOwogICAgICAgICAgICAgICAgcGltYXJteWNhZHJlc0RhdGEgPSBbXTsKCiAgICAgICAgICAgICAgICBpZiAoIU9iamVjdC5pcyh0aGlzLnRlbXBTdG9yYWdlLmdldEl0ZW0oY29udGV4dC5zcmZzZXNzaW9ua2V5ICsgJ19waW1hcm15Y2FkcmVzJyksICd1bmRlZmluZWQnKSkgewogICAgICAgICAgICAgICAgICBwaW1hcm15Y2FkcmVzRGF0YSA9IEpTT04ucGFyc2UodGhpcy50ZW1wU3RvcmFnZS5nZXRJdGVtKGNvbnRleHQuc3Jmc2Vzc2lvbmtleSArICdfcGltYXJteWNhZHJlcycpKTsKCiAgICAgICAgICAgICAgICAgIGlmIChwaW1hcm15Y2FkcmVzRGF0YSAmJiBwaW1hcm15Y2FkcmVzRGF0YS5sZW5ndGggJiYgcGltYXJteWNhZHJlc0RhdGEubGVuZ3RoID4gMCkgewogICAgICAgICAgICAgICAgICAgIHBpbWFybXljYWRyZXNEYXRhLmZvckVhY2goZnVuY3Rpb24gKGl0ZW0pIHsKICAgICAgICAgICAgICAgICAgICAgIGlmIChpdGVtLnNyZmZyb250dWYpIHsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKE9iamVjdC5pcyhpdGVtLnNyZmZyb250dWYsICIwIikpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICBpdGVtLnBpbWFybXljYWRyZXNpZCA9IG51bGw7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgICAgIGRlbGV0ZSBpdGVtLnNyZmZyb250dWY7CiAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBtYXN0ZXJEYXRhLnBpbWFybXljYWRyZXMgPSBwaW1hcm15Y2FkcmVzRGF0YTsKICAgICAgICAgICAgICAgIHBpbWNvcnJlY3Rpb25hcHBsaWVzRGF0YSA9IFtdOwoKICAgICAgICAgICAgICAgIGlmICghT2JqZWN0LmlzKHRoaXMudGVtcFN0b3JhZ2UuZ2V0SXRlbShjb250ZXh0LnNyZnNlc3Npb25rZXkgKyAnX3BpbWNvcnJlY3Rpb25hcHBsaWVzJyksICd1bmRlZmluZWQnKSkgewogICAgICAgICAgICAgICAgICBwaW1jb3JyZWN0aW9uYXBwbGllc0RhdGEgPSBKU09OLnBhcnNlKHRoaXMudGVtcFN0b3JhZ2UuZ2V0SXRlbShjb250ZXh0LnNyZnNlc3Npb25rZXkgKyAnX3BpbWNvcnJlY3Rpb25hcHBsaWVzJykpOwoKICAgICAgICAgICAgICAgICAgaWYgKHBpbWNvcnJlY3Rpb25hcHBsaWVzRGF0YSAmJiBwaW1jb3JyZWN0aW9uYXBwbGllc0RhdGEubGVuZ3RoICYmIHBpbWNvcnJlY3Rpb25hcHBsaWVzRGF0YS5sZW5ndGggPiAwKSB7CiAgICAgICAgICAgICAgICAgICAgcGltY29ycmVjdGlvbmFwcGxpZXNEYXRhLmZvckVhY2goZnVuY3Rpb24gKGl0ZW0pIHsKICAgICAgICAgICAgICAgICAgICAgIGlmIChpdGVtLnNyZmZyb250dWYpIHsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKE9iamVjdC5pcyhpdGVtLnNyZmZyb250dWYsICIwIikpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICBpdGVtLnBpbWNvcnJlY3Rpb25hcHBseWlkID0gbnVsbDsKICAgICAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICAgICAgZGVsZXRlIGl0ZW0uc3JmZnJvbnR1ZjsKICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIG1hc3RlckRhdGEucGltY29ycmVjdGlvbmFwcGxpZXMgPSBwaW1jb3JyZWN0aW9uYXBwbGllc0RhdGE7CiAgICAgICAgICAgICAgICBwaW12YWNhdGlvbnNEYXRhID0gW107CgogICAgICAgICAgICAgICAgaWYgKCFPYmplY3QuaXModGhpcy50ZW1wU3RvcmFnZS5nZXRJdGVtKGNvbnRleHQuc3Jmc2Vzc2lvbmtleSArICdfcGltdmFjYXRpb25zJyksICd1bmRlZmluZWQnKSkgewogICAgICAgICAgICAgICAgICBwaW12YWNhdGlvbnNEYXRhID0gSlNPTi5wYXJzZSh0aGlzLnRlbXBTdG9yYWdlLmdldEl0ZW0oY29udGV4dC5zcmZzZXNzaW9ua2V5ICsgJ19waW12YWNhdGlvbnMnKSk7CgogICAgICAgICAgICAgICAgICBpZiAocGltdmFjYXRpb25zRGF0YSAmJiBwaW12YWNhdGlvbnNEYXRhLmxlbmd0aCAmJiBwaW12YWNhdGlvbnNEYXRhLmxlbmd0aCA+IDApIHsKICAgICAgICAgICAgICAgICAgICBwaW12YWNhdGlvbnNEYXRhLmZvckVhY2goZnVuY3Rpb24gKGl0ZW0pIHsKICAgICAgICAgICAgICAgICAgICAgIGlmIChpdGVtLnNyZmZyb250dWYpIHsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKE9iamVjdC5pcyhpdGVtLnNyZmZyb250dWYsICIwIikpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICBpdGVtLnBpbXZhY2F0aW9uaWQgPSBudWxsOwogICAgICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgICAgICBkZWxldGUgaXRlbS5zcmZmcm9udHVmOwogICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgbWFzdGVyRGF0YS5waW12YWNhdGlvbnMgPSBwaW12YWNhdGlvbnNEYXRhOwogICAgICAgICAgICAgICAgdHJtdHJhaW5wZW9wbGVEYXRhID0gW107CgogICAgICAgICAgICAgICAgaWYgKCFPYmplY3QuaXModGhpcy50ZW1wU3RvcmFnZS5nZXRJdGVtKGNvbnRleHQuc3Jmc2Vzc2lvbmtleSArICdfdHJtdHJhaW5wZW9wbGUnKSwgJ3VuZGVmaW5lZCcpKSB7CiAgICAgICAgICAgICAgICAgIHRybXRyYWlucGVvcGxlRGF0YSA9IEpTT04ucGFyc2UodGhpcy50ZW1wU3RvcmFnZS5nZXRJdGVtKGNvbnRleHQuc3Jmc2Vzc2lvbmtleSArICdfdHJtdHJhaW5wZW9wbGUnKSk7CgogICAgICAgICAgICAgICAgICBpZiAodHJtdHJhaW5wZW9wbGVEYXRhICYmIHRybXRyYWlucGVvcGxlRGF0YS5sZW5ndGggJiYgdHJtdHJhaW5wZW9wbGVEYXRhLmxlbmd0aCA+IDApIHsKICAgICAgICAgICAgICAgICAgICB0cm10cmFpbnBlb3BsZURhdGEuZm9yRWFjaChmdW5jdGlvbiAoaXRlbSkgewogICAgICAgICAgICAgICAgICAgICAgaWYgKGl0ZW0uc3JmZnJvbnR1ZikgewogICAgICAgICAgICAgICAgICAgICAgICBpZiAoT2JqZWN0LmlzKGl0ZW0uc3JmZnJvbnR1ZiwgIjAiKSkgewogICAgICAgICAgICAgICAgICAgICAgICAgIGl0ZW0udHJtdHJpYW5wZXJzb25pZCA9IG51bGw7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgICAgIGRlbGV0ZSBpdGVtLnNyZmZyb250dWY7CiAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBtYXN0ZXJEYXRhLnRybXRyYWlucGVvcGxlID0gdHJtdHJhaW5wZW9wbGVEYXRhOwogICAgICAgICAgICAgICAgcGltY29udHJhY3RzRGF0YSA9IFtdOwoKICAgICAgICAgICAgICAgIGlmICghT2JqZWN0LmlzKHRoaXMudGVtcFN0b3JhZ2UuZ2V0SXRlbShjb250ZXh0LnNyZnNlc3Npb25rZXkgKyAnX3BpbWNvbnRyYWN0cycpLCAndW5kZWZpbmVkJykpIHsKICAgICAgICAgICAgICAgICAgcGltY29udHJhY3RzRGF0YSA9IEpTT04ucGFyc2UodGhpcy50ZW1wU3RvcmFnZS5nZXRJdGVtKGNvbnRleHQuc3Jmc2Vzc2lvbmtleSArICdfcGltY29udHJhY3RzJykpOwoKICAgICAgICAgICAgICAgICAgaWYgKHBpbWNvbnRyYWN0c0RhdGEgJiYgcGltY29udHJhY3RzRGF0YS5sZW5ndGggJiYgcGltY29udHJhY3RzRGF0YS5sZW5ndGggPiAwKSB7CiAgICAgICAgICAgICAgICAgICAgcGltY29udHJhY3RzRGF0YS5mb3JFYWNoKGZ1bmN0aW9uIChpdGVtKSB7CiAgICAgICAgICAgICAgICAgICAgICBpZiAoaXRlbS5zcmZmcm9udHVmKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChPYmplY3QuaXMoaXRlbS5zcmZmcm9udHVmLCAiMCIpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgaXRlbS5waW1jb250cmFjdGlkID0gbnVsbDsKICAgICAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICAgICAgZGVsZXRlIGl0ZW0uc3JmZnJvbnR1ZjsKICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIG1hc3RlckRhdGEucGltY29udHJhY3RzID0gcGltY29udHJhY3RzRGF0YTsKICAgICAgICAgICAgICAgIHBpbWVkdWNhdGlvbnNEYXRhID0gW107CgogICAgICAgICAgICAgICAgaWYgKCFPYmplY3QuaXModGhpcy50ZW1wU3RvcmFnZS5nZXRJdGVtKGNvbnRleHQuc3Jmc2Vzc2lvbmtleSArICdfcGltZWR1Y2F0aW9ucycpLCAndW5kZWZpbmVkJykpIHsKICAgICAgICAgICAgICAgICAgcGltZWR1Y2F0aW9uc0RhdGEgPSBKU09OLnBhcnNlKHRoaXMudGVtcFN0b3JhZ2UuZ2V0SXRlbShjb250ZXh0LnNyZnNlc3Npb25rZXkgKyAnX3BpbWVkdWNhdGlvbnMnKSk7CgogICAgICAgICAgICAgICAgICBpZiAocGltZWR1Y2F0aW9uc0RhdGEgJiYgcGltZWR1Y2F0aW9uc0RhdGEubGVuZ3RoICYmIHBpbWVkdWNhdGlvbnNEYXRhLmxlbmd0aCA+IDApIHsKICAgICAgICAgICAgICAgICAgICBwaW1lZHVjYXRpb25zRGF0YS5mb3JFYWNoKGZ1bmN0aW9uIChpdGVtKSB7CiAgICAgICAgICAgICAgICAgICAgICBpZiAoaXRlbS5zcmZmcm9udHVmKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChPYmplY3QuaXMoaXRlbS5zcmZmcm9udHVmLCAiMCIpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgaXRlbS5waW1lZHVjYXRpb25pZCA9IG51bGw7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgICAgIGRlbGV0ZSBpdGVtLnNyZmZyb250dWY7CiAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBtYXN0ZXJEYXRhLnBpbWVkdWNhdGlvbnMgPSBwaW1lZHVjYXRpb25zRGF0YTsKICAgICAgICAgICAgICAgIHBpbXBlcnNvbmNoYW5nZXNEYXRhID0gW107CgogICAgICAgICAgICAgICAgaWYgKCFPYmplY3QuaXModGhpcy50ZW1wU3RvcmFnZS5nZXRJdGVtKGNvbnRleHQuc3Jmc2Vzc2lvbmtleSArICdfcGltcGVyc29uY2hhbmdlcycpLCAndW5kZWZpbmVkJykpIHsKICAgICAgICAgICAgICAgICAgcGltcGVyc29uY2hhbmdlc0RhdGEgPSBKU09OLnBhcnNlKHRoaXMudGVtcFN0b3JhZ2UuZ2V0SXRlbShjb250ZXh0LnNyZnNlc3Npb25rZXkgKyAnX3BpbXBlcnNvbmNoYW5nZXMnKSk7CgogICAgICAgICAgICAgICAgICBpZiAocGltcGVyc29uY2hhbmdlc0RhdGEgJiYgcGltcGVyc29uY2hhbmdlc0RhdGEubGVuZ3RoICYmIHBpbXBlcnNvbmNoYW5nZXNEYXRhLmxlbmd0aCA+IDApIHsKICAgICAgICAgICAgICAgICAgICBwaW1wZXJzb25jaGFuZ2VzRGF0YS5mb3JFYWNoKGZ1bmN0aW9uIChpdGVtKSB7CiAgICAgICAgICAgICAgICAgICAgICBpZiAoaXRlbS5zcmZmcm9udHVmKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChPYmplY3QuaXMoaXRlbS5zcmZmcm9udHVmLCAiMCIpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgaXRlbS5waW1wZXJzb25jaGFuZ2VpZCA9IG51bGw7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgICAgIGRlbGV0ZSBpdGVtLnNyZmZyb250dWY7CiAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBtYXN0ZXJEYXRhLnBpbXBlcnNvbmNoYW5nZXMgPSBwaW1wZXJzb25jaGFuZ2VzRGF0YTsKICAgICAgICAgICAgICAgIHBpbWFjaGlldmVtZW50c0RhdGEgPSBbXTsKCiAgICAgICAgICAgICAgICBpZiAoIU9iamVjdC5pcyh0aGlzLnRlbXBTdG9yYWdlLmdldEl0ZW0oY29udGV4dC5zcmZzZXNzaW9ua2V5ICsgJ19waW1hY2hpZXZlbWVudHMnKSwgJ3VuZGVmaW5lZCcpKSB7CiAgICAgICAgICAgICAgICAgIHBpbWFjaGlldmVtZW50c0RhdGEgPSBKU09OLnBhcnNlKHRoaXMudGVtcFN0b3JhZ2UuZ2V0SXRlbShjb250ZXh0LnNyZnNlc3Npb25rZXkgKyAnX3BpbWFjaGlldmVtZW50cycpKTsKCiAgICAgICAgICAgICAgICAgIGlmIChwaW1hY2hpZXZlbWVudHNEYXRhICYmIHBpbWFjaGlldmVtZW50c0RhdGEubGVuZ3RoICYmIHBpbWFjaGlldmVtZW50c0RhdGEubGVuZ3RoID4gMCkgewogICAgICAgICAgICAgICAgICAgIHBpbWFjaGlldmVtZW50c0RhdGEuZm9yRWFjaChmdW5jdGlvbiAoaXRlbSkgewogICAgICAgICAgICAgICAgICAgICAgaWYgKGl0ZW0uc3JmZnJvbnR1ZikgewogICAgICAgICAgICAgICAgICAgICAgICBpZiAoT2JqZWN0LmlzKGl0ZW0uc3JmZnJvbnR1ZiwgIjAiKSkgewogICAgICAgICAgICAgICAgICAgICAgICAgIGl0ZW0ucGltYWNoaWV2ZW1lbnRzaWQgPSBudWxsOwogICAgICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgICAgICBkZWxldGUgaXRlbS5zcmZmcm9udHVmOwogICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgbWFzdGVyRGF0YS5waW1hY2hpZXZlbWVudHMgPSBwaW1hY2hpZXZlbWVudHNEYXRhOwogICAgICAgICAgICAgICAgcGltcmVzZWFyY2hmaW5kaW5nc0RhdGEgPSBbXTsKCiAgICAgICAgICAgICAgICBpZiAoIU9iamVjdC5pcyh0aGlzLnRlbXBTdG9yYWdlLmdldEl0ZW0oY29udGV4dC5zcmZzZXNzaW9ua2V5ICsgJ19waW1yZXNlYXJjaGZpbmRpbmdzJyksICd1bmRlZmluZWQnKSkgewogICAgICAgICAgICAgICAgICBwaW1yZXNlYXJjaGZpbmRpbmdzRGF0YSA9IEpTT04ucGFyc2UodGhpcy50ZW1wU3RvcmFnZS5nZXRJdGVtKGNvbnRleHQuc3Jmc2Vzc2lvbmtleSArICdfcGltcmVzZWFyY2hmaW5kaW5ncycpKTsKCiAgICAgICAgICAgICAgICAgIGlmIChwaW1yZXNlYXJjaGZpbmRpbmdzRGF0YSAmJiBwaW1yZXNlYXJjaGZpbmRpbmdzRGF0YS5sZW5ndGggJiYgcGltcmVzZWFyY2hmaW5kaW5nc0RhdGEubGVuZ3RoID4gMCkgewogICAgICAgICAgICAgICAgICAgIHBpbXJlc2VhcmNoZmluZGluZ3NEYXRhLmZvckVhY2goZnVuY3Rpb24gKGl0ZW0pIHsKICAgICAgICAgICAgICAgICAgICAgIGlmIChpdGVtLnNyZmZyb250dWYpIHsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKE9iamVjdC5pcyhpdGVtLnNyZmZyb250dWYsICIwIikpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICBpdGVtLnBpbXJlc2VhcmNoZmluZGluZ3NpZCA9IG51bGw7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgICAgIGRlbGV0ZSBpdGVtLnNyZmZyb250dWY7CiAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBtYXN0ZXJEYXRhLnBpbXJlc2VhcmNoZmluZGluZ3MgPSBwaW1yZXNlYXJjaGZpbmRpbmdzRGF0YTsKICAgICAgICAgICAgICAgIHBpbWV4aXRhbmRlbnRyaWVzRGF0YSA9IFtdOwoKICAgICAgICAgICAgICAgIGlmICghT2JqZWN0LmlzKHRoaXMudGVtcFN0b3JhZ2UuZ2V0SXRlbShjb250ZXh0LnNyZnNlc3Npb25rZXkgKyAnX3BpbWV4aXRhbmRlbnRyaWVzJyksICd1bmRlZmluZWQnKSkgewogICAgICAgICAgICAgICAgICBwaW1leGl0YW5kZW50cmllc0RhdGEgPSBKU09OLnBhcnNlKHRoaXMudGVtcFN0b3JhZ2UuZ2V0SXRlbShjb250ZXh0LnNyZnNlc3Npb25rZXkgKyAnX3BpbWV4aXRhbmRlbnRyaWVzJykpOwoKICAgICAgICAgICAgICAgICAgaWYgKHBpbWV4aXRhbmRlbnRyaWVzRGF0YSAmJiBwaW1leGl0YW5kZW50cmllc0RhdGEubGVuZ3RoICYmIHBpbWV4aXRhbmRlbnRyaWVzRGF0YS5sZW5ndGggPiAwKSB7CiAgICAgICAgICAgICAgICAgICAgcGltZXhpdGFuZGVudHJpZXNEYXRhLmZvckVhY2goZnVuY3Rpb24gKGl0ZW0pIHsKICAgICAgICAgICAgICAgICAgICAgIGlmIChpdGVtLnNyZmZyb250dWYpIHsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKE9iamVjdC5pcyhpdGVtLnNyZmZyb250dWYsICIwIikpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICBpdGVtLnBpbWV4aXRhbmRlbnRyeWlkID0gbnVsbDsKICAgICAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICAgICAgZGVsZXRlIGl0ZW0uc3JmZnJvbnR1ZjsKICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIG1hc3RlckRhdGEucGltZXhpdGFuZGVudHJpZXMgPSBwaW1leGl0YW5kZW50cmllc0RhdGE7CiAgICAgICAgICAgICAgICBwaW1yZXdhcmRwdW5pc2htZW50c0RhdGEgPSBbXTsKCiAgICAgICAgICAgICAgICBpZiAoIU9iamVjdC5pcyh0aGlzLnRlbXBTdG9yYWdlLmdldEl0ZW0oY29udGV4dC5zcmZzZXNzaW9ua2V5ICsgJ19waW1yZXdhcmRwdW5pc2htZW50cycpLCAndW5kZWZpbmVkJykpIHsKICAgICAgICAgICAgICAgICAgcGltcmV3YXJkcHVuaXNobWVudHNEYXRhID0gSlNPTi5wYXJzZSh0aGlzLnRlbXBTdG9yYWdlLmdldEl0ZW0oY29udGV4dC5zcmZzZXNzaW9ua2V5ICsgJ19waW1yZXdhcmRwdW5pc2htZW50cycpKTsKCiAgICAgICAgICAgICAgICAgIGlmIChwaW1yZXdhcmRwdW5pc2htZW50c0RhdGEgJiYgcGltcmV3YXJkcHVuaXNobWVudHNEYXRhLmxlbmd0aCAmJiBwaW1yZXdhcmRwdW5pc2htZW50c0RhdGEubGVuZ3RoID4gMCkgewogICAgICAgICAgICAgICAgICAgIHBpbXJld2FyZHB1bmlzaG1lbnRzRGF0YS5mb3JFYWNoKGZ1bmN0aW9uIChpdGVtKSB7CiAgICAgICAgICAgICAgICAgICAgICBpZiAoaXRlbS5zcmZmcm9udHVmKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChPYmplY3QuaXMoaXRlbS5zcmZmcm9udHVmLCAiMCIpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgaXRlbS5waW1yZXdhcmRwdW5pc2htZW50aWQgPSBudWxsOwogICAgICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgICAgICBkZWxldGUgaXRlbS5zcmZmcm9udHVmOwogICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgbWFzdGVyRGF0YS5waW1yZXdhcmRwdW5pc2htZW50cyA9IHBpbXJld2FyZHB1bmlzaG1lbnRzRGF0YTsKICAgICAgICAgICAgICAgIHBpbXBhdGVudHNEYXRhID0gW107CgogICAgICAgICAgICAgICAgaWYgKCFPYmplY3QuaXModGhpcy50ZW1wU3RvcmFnZS5nZXRJdGVtKGNvbnRleHQuc3Jmc2Vzc2lvbmtleSArICdfcGltcGF0ZW50cycpLCAndW5kZWZpbmVkJykpIHsKICAgICAgICAgICAgICAgICAgcGltcGF0ZW50c0RhdGEgPSBKU09OLnBhcnNlKHRoaXMudGVtcFN0b3JhZ2UuZ2V0SXRlbShjb250ZXh0LnNyZnNlc3Npb25rZXkgKyAnX3BpbXBhdGVudHMnKSk7CgogICAgICAgICAgICAgICAgICBpZiAocGltcGF0ZW50c0RhdGEgJiYgcGltcGF0ZW50c0RhdGEubGVuZ3RoICYmIHBpbXBhdGVudHNEYXRhLmxlbmd0aCA+IDApIHsKICAgICAgICAgICAgICAgICAgICBwaW1wYXRlbnRzRGF0YS5mb3JFYWNoKGZ1bmN0aW9uIChpdGVtKSB7CiAgICAgICAgICAgICAgICAgICAgICBpZiAoaXRlbS5zcmZmcm9udHVmKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChPYmplY3QuaXMoaXRlbS5zcmZmcm9udHVmLCAiMCIpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgaXRlbS5waW1wYXRlbnRpZCA9IG51bGw7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgICAgIGRlbGV0ZSBpdGVtLnNyZmZyb250dWY7CiAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBtYXN0ZXJEYXRhLnBpbXBhdGVudHMgPSBwaW1wYXRlbnRzRGF0YTsKICAgICAgICAgICAgICAgIHBpbWxhbmd1YWdlYWJpbGl0aWVzRGF0YSA9IFtdOwoKICAgICAgICAgICAgICAgIGlmICghT2JqZWN0LmlzKHRoaXMudGVtcFN0b3JhZ2UuZ2V0SXRlbShjb250ZXh0LnNyZnNlc3Npb25rZXkgKyAnX3BpbWxhbmd1YWdlYWJpbGl0aWVzJyksICd1bmRlZmluZWQnKSkgewogICAgICAgICAgICAgICAgICBwaW1sYW5ndWFnZWFiaWxpdGllc0RhdGEgPSBKU09OLnBhcnNlKHRoaXMudGVtcFN0b3JhZ2UuZ2V0SXRlbShjb250ZXh0LnNyZnNlc3Npb25rZXkgKyAnX3BpbWxhbmd1YWdlYWJpbGl0aWVzJykpOwoKICAgICAgICAgICAgICAgICAgaWYgKHBpbWxhbmd1YWdlYWJpbGl0aWVzRGF0YSAmJiBwaW1sYW5ndWFnZWFiaWxpdGllc0RhdGEubGVuZ3RoICYmIHBpbWxhbmd1YWdlYWJpbGl0aWVzRGF0YS5sZW5ndGggPiAwKSB7CiAgICAgICAgICAgICAgICAgICAgcGltbGFuZ3VhZ2VhYmlsaXRpZXNEYXRhLmZvckVhY2goZnVuY3Rpb24gKGl0ZW0pIHsKICAgICAgICAgICAgICAgICAgICAgIGlmIChpdGVtLnNyZmZyb250dWYpIHsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKE9iamVjdC5pcyhpdGVtLnNyZmZyb250dWYsICIwIikpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICBpdGVtLnBpbWxhbmd1YWdlYWJpbGl0eWlkID0gbnVsbDsKICAgICAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICAgICAgZGVsZXRlIGl0ZW0uc3JmZnJvbnR1ZjsKICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIG1hc3RlckRhdGEucGltbGFuZ3VhZ2VhYmlsaXRpZXMgPSBwaW1sYW5ndWFnZWFiaWxpdGllc0RhdGE7CiAgICAgICAgICAgICAgICBwaW1hcmNoaXZlc0RhdGEgPSBbXTsKCiAgICAgICAgICAgICAgICBpZiAoIU9iamVjdC5pcyh0aGlzLnRlbXBTdG9yYWdlLmdldEl0ZW0oY29udGV4dC5zcmZzZXNzaW9ua2V5ICsgJ19waW1hcmNoaXZlcycpLCAndW5kZWZpbmVkJykpIHsKICAgICAgICAgICAgICAgICAgcGltYXJjaGl2ZXNEYXRhID0gSlNPTi5wYXJzZSh0aGlzLnRlbXBTdG9yYWdlLmdldEl0ZW0oY29udGV4dC5zcmZzZXNzaW9ua2V5ICsgJ19waW1hcmNoaXZlcycpKTsKCiAgICAgICAgICAgICAgICAgIGlmIChwaW1hcmNoaXZlc0RhdGEgJiYgcGltYXJjaGl2ZXNEYXRhLmxlbmd0aCAmJiBwaW1hcmNoaXZlc0RhdGEubGVuZ3RoID4gMCkgewogICAgICAgICAgICAgICAgICAgIHBpbWFyY2hpdmVzRGF0YS5mb3JFYWNoKGZ1bmN0aW9uIChpdGVtKSB7CiAgICAgICAgICAgICAgICAgICAgICBpZiAoaXRlbS5zcmZmcm9udHVmKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChPYmplY3QuaXMoaXRlbS5zcmZmcm9udHVmLCAiMCIpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgaXRlbS5waW1hcmNoaXZlc2lkID0gbnVsbDsKICAgICAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICAgICAgZGVsZXRlIGl0ZW0uc3JmZnJvbnR1ZjsKICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIG1hc3RlckRhdGEucGltYXJjaGl2ZXMgPSBwaW1hcmNoaXZlc0RhdGE7CiAgICAgICAgICAgICAgICBwaW1mYW1pbmZvc0RhdGEgPSBbXTsKCiAgICAgICAgICAgICAgICBpZiAoIU9iamVjdC5pcyh0aGlzLnRlbXBTdG9yYWdlLmdldEl0ZW0oY29udGV4dC5zcmZzZXNzaW9ua2V5ICsgJ19waW1mYW1pbmZvcycpLCAndW5kZWZpbmVkJykpIHsKICAgICAgICAgICAgICAgICAgcGltZmFtaW5mb3NEYXRhID0gSlNPTi5wYXJzZSh0aGlzLnRlbXBTdG9yYWdlLmdldEl0ZW0oY29udGV4dC5zcmZzZXNzaW9ua2V5ICsgJ19waW1mYW1pbmZvcycpKTsKCiAgICAgICAgICAgICAgICAgIGlmIChwaW1mYW1pbmZvc0RhdGEgJiYgcGltZmFtaW5mb3NEYXRhLmxlbmd0aCAmJiBwaW1mYW1pbmZvc0RhdGEubGVuZ3RoID4gMCkgewogICAgICAgICAgICAgICAgICAgIHBpbWZhbWluZm9zRGF0YS5mb3JFYWNoKGZ1bmN0aW9uIChpdGVtKSB7CiAgICAgICAgICAgICAgICAgICAgICBpZiAoaXRlbS5zcmZmcm9udHVmKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChPYmplY3QuaXMoaXRlbS5zcmZmcm9udHVmLCAiMCIpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgaXRlbS5waW1mYW1pbmZvaWQgPSBudWxsOwogICAgICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgICAgICBkZWxldGUgaXRlbS5zcmZmcm9udHVmOwogICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgbWFzdGVyRGF0YS5waW1mYW1pbmZvcyA9IHBpbWZhbWluZm9zRGF0YTsKICAgICAgICAgICAgICAgIGF0dGVuZGFuY2VtcmVwb3J0bXhlc0RhdGEgPSBbXTsKCiAgICAgICAgICAgICAgICBpZiAoIU9iamVjdC5pcyh0aGlzLnRlbXBTdG9yYWdlLmdldEl0ZW0oY29udGV4dC5zcmZzZXNzaW9ua2V5ICsgJ19hdHRlbmRhbmNlbXJlcG9ydG14ZXMnKSwgJ3VuZGVmaW5lZCcpKSB7CiAgICAgICAgICAgICAgICAgIGF0dGVuZGFuY2VtcmVwb3J0bXhlc0RhdGEgPSBKU09OLnBhcnNlKHRoaXMudGVtcFN0b3JhZ2UuZ2V0SXRlbShjb250ZXh0LnNyZnNlc3Npb25rZXkgKyAnX2F0dGVuZGFuY2VtcmVwb3J0bXhlcycpKTsKCiAgICAgICAgICAgICAgICAgIGlmIChhdHRlbmRhbmNlbXJlcG9ydG14ZXNEYXRhICYmIGF0dGVuZGFuY2VtcmVwb3J0bXhlc0RhdGEubGVuZ3RoICYmIGF0dGVuZGFuY2VtcmVwb3J0bXhlc0RhdGEubGVuZ3RoID4gMCkgewogICAgICAgICAgICAgICAgICAgIGF0dGVuZGFuY2VtcmVwb3J0bXhlc0RhdGEuZm9yRWFjaChmdW5jdGlvbiAoaXRlbSkgewogICAgICAgICAgICAgICAgICAgICAgaWYgKGl0ZW0uc3JmZnJvbnR1ZikgewogICAgICAgICAgICAgICAgICAgICAgICBpZiAoT2JqZWN0LmlzKGl0ZW0uc3JmZnJvbnR1ZiwgIjAiKSkgewogICAgICAgICAgICAgICAgICAgICAgICAgIGl0ZW0uYXR0ZW5kYW5jZW1yZXBvcnRteGlkID0gbnVsbDsKICAgICAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICAgICAgZGVsZXRlIGl0ZW0uc3JmZnJvbnR1ZjsKICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIG1hc3RlckRhdGEuYXR0ZW5kYW5jZW1yZXBvcnRteGVzID0gYXR0ZW5kYW5jZW1yZXBvcnRteGVzRGF0YTsKICAgICAgICAgICAgICAgIHBpbXdvcmtoaXN0b3JpZXNEYXRhID0gW107CgogICAgICAgICAgICAgICAgaWYgKCFPYmplY3QuaXModGhpcy50ZW1wU3RvcmFnZS5nZXRJdGVtKGNvbnRleHQuc3Jmc2Vzc2lvbmtleSArICdfcGltd29ya2hpc3RvcmllcycpLCAndW5kZWZpbmVkJykpIHsKICAgICAgICAgICAgICAgICAgcGltd29ya2hpc3Rvcmllc0RhdGEgPSBKU09OLnBhcnNlKHRoaXMudGVtcFN0b3JhZ2UuZ2V0SXRlbShjb250ZXh0LnNyZnNlc3Npb25rZXkgKyAnX3BpbXdvcmtoaXN0b3JpZXMnKSk7CgogICAgICAgICAgICAgICAgICBpZiAocGltd29ya2hpc3Rvcmllc0RhdGEgJiYgcGltd29ya2hpc3Rvcmllc0RhdGEubGVuZ3RoICYmIHBpbXdvcmtoaXN0b3JpZXNEYXRhLmxlbmd0aCA+IDApIHsKICAgICAgICAgICAgICAgICAgICBwaW13b3JraGlzdG9yaWVzRGF0YS5mb3JFYWNoKGZ1bmN0aW9uIChpdGVtKSB7CiAgICAgICAgICAgICAgICAgICAgICBpZiAoaXRlbS5zcmZmcm9udHVmKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChPYmplY3QuaXMoaXRlbS5zcmZmcm9udHVmLCAiMCIpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgaXRlbS5waW13b3JraGlzdG9yeWlkID0gbnVsbDsKICAgICAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICAgICAgZGVsZXRlIGl0ZW0uc3JmZnJvbnR1ZjsKICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIG1hc3RlckRhdGEucGltd29ya2hpc3RvcmllcyA9IHBpbXdvcmtoaXN0b3JpZXNEYXRhOwogICAgICAgICAgICAgICAgT2JqZWN0LmFzc2lnbihkYXRhLCBtYXN0ZXJEYXRhKTsKCiAgICAgICAgICAgICAgICBpZiAoIWRhdGEuc3JmZnJvbnR1ZiB8fCBkYXRhLnNyZmZyb250dWYgIT09ICIxIikgewogICAgICAgICAgICAgICAgICBkYXRhW3RoaXMuQVBQREVLRVldID0gbnVsbDsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBpZiAoZGF0YS5zcmZmcm9udHVmKSB7CiAgICAgICAgICAgICAgICAgIGRlbGV0ZSBkYXRhLnNyZmZyb250dWY7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgdGVtcENvbnRleHQgPSBKU09OLnBhcnNlKEpTT04uc3RyaW5naWZ5KGNvbnRleHQpKTsKICAgICAgICAgICAgICAgIF9jb250ZXh0OC5uZXh0ID0gNzY7CiAgICAgICAgICAgICAgICByZXR1cm4gSHR0cC5nZXRJbnN0YW5jZSgpLnBvc3QoIi9waW1wZW9wbGUiLCBkYXRhLCBpc2xvYWRpbmcpOwoKICAgICAgICAgICAgICBjYXNlIDc2OgogICAgICAgICAgICAgICAgcmVzID0gX2NvbnRleHQ4LnNlbnQ7CiAgICAgICAgICAgICAgICB0aGlzLnRlbXBTdG9yYWdlLnNldEl0ZW0odGVtcENvbnRleHQuc3Jmc2Vzc2lvbmtleSArICdfcGltcGVyc29uYWJpbGl0aWVzJywgSlNPTi5zdHJpbmdpZnkocmVzLmRhdGEucGltcGVyc29uYWJpbGl0aWVzKSk7CiAgICAgICAgICAgICAgICB0aGlzLnRlbXBTdG9yYWdlLnNldEl0ZW0odGVtcENvbnRleHQuc3Jmc2Vzc2lvbmtleSArICdfcGltcGFwZXJzJywgSlNPTi5zdHJpbmdpZnkocmVzLmRhdGEucGltcGFwZXJzKSk7CiAgICAgICAgICAgICAgICB0aGlzLnRlbXBTdG9yYWdlLnNldEl0ZW0odGVtcENvbnRleHQuc3Jmc2Vzc2lvbmtleSArICdfcGltZGlzdGlyYnV0aW9ucycsIEpTT04uc3RyaW5naWZ5KHJlcy5kYXRhLnBpbWRpc3RpcmJ1dGlvbnMpKTsKICAgICAgICAgICAgICAgIHRoaXMudGVtcFN0b3JhZ2Uuc2V0SXRlbSh0ZW1wQ29udGV4dC5zcmZzZXNzaW9ua2V5ICsgJ19waW10aXRsZXMnLCBKU09OLnN0cmluZ2lmeShyZXMuZGF0YS5waW10aXRsZXMpKTsKICAgICAgICAgICAgICAgIHRoaXMudGVtcFN0b3JhZ2Uuc2V0SXRlbSh0ZW1wQ29udGV4dC5zcmZzZXNzaW9ua2V5ICsgJ19waW12b2NhdGlvbmFscycsIEpTT04uc3RyaW5naWZ5KHJlcy5kYXRhLnBpbXZvY2F0aW9uYWxzKSk7CiAgICAgICAgICAgICAgICB0aGlzLnRlbXBTdG9yYWdlLnNldEl0ZW0odGVtcENvbnRleHQuc3Jmc2Vzc2lvbmtleSArICdfcGltYXJteWNhZHJlcycsIEpTT04uc3RyaW5naWZ5KHJlcy5kYXRhLnBpbWFybXljYWRyZXMpKTsKICAgICAgICAgICAgICAgIHRoaXMudGVtcFN0b3JhZ2Uuc2V0SXRlbSh0ZW1wQ29udGV4dC5zcmZzZXNzaW9ua2V5ICsgJ19waW1jb3JyZWN0aW9uYXBwbGllcycsIEpTT04uc3RyaW5naWZ5KHJlcy5kYXRhLnBpbWNvcnJlY3Rpb25hcHBsaWVzKSk7CiAgICAgICAgICAgICAgICB0aGlzLnRlbXBTdG9yYWdlLnNldEl0ZW0odGVtcENvbnRleHQuc3Jmc2Vzc2lvbmtleSArICdfcGltdmFjYXRpb25zJywgSlNPTi5zdHJpbmdpZnkocmVzLmRhdGEucGltdmFjYXRpb25zKSk7CiAgICAgICAgICAgICAgICB0aGlzLnRlbXBTdG9yYWdlLnNldEl0ZW0odGVtcENvbnRleHQuc3Jmc2Vzc2lvbmtleSArICdfdHJtdHJhaW5wZW9wbGUnLCBKU09OLnN0cmluZ2lmeShyZXMuZGF0YS50cm10cmFpbnBlb3BsZSkpOwogICAgICAgICAgICAgICAgdGhpcy50ZW1wU3RvcmFnZS5zZXRJdGVtKHRlbXBDb250ZXh0LnNyZnNlc3Npb25rZXkgKyAnX3BpbWNvbnRyYWN0cycsIEpTT04uc3RyaW5naWZ5KHJlcy5kYXRhLnBpbWNvbnRyYWN0cykpOwogICAgICAgICAgICAgICAgdGhpcy50ZW1wU3RvcmFnZS5zZXRJdGVtKHRlbXBDb250ZXh0LnNyZnNlc3Npb25rZXkgKyAnX3BpbWVkdWNhdGlvbnMnLCBKU09OLnN0cmluZ2lmeShyZXMuZGF0YS5waW1lZHVjYXRpb25zKSk7CiAgICAgICAgICAgICAgICB0aGlzLnRlbXBTdG9yYWdlLnNldEl0ZW0odGVtcENvbnRleHQuc3Jmc2Vzc2lvbmtleSArICdfcGltcGVyc29uY2hhbmdlcycsIEpTT04uc3RyaW5naWZ5KHJlcy5kYXRhLnBpbXBlcnNvbmNoYW5nZXMpKTsKICAgICAgICAgICAgICAgIHRoaXMudGVtcFN0b3JhZ2Uuc2V0SXRlbSh0ZW1wQ29udGV4dC5zcmZzZXNzaW9ua2V5ICsgJ19waW1hY2hpZXZlbWVudHMnLCBKU09OLnN0cmluZ2lmeShyZXMuZGF0YS5waW1hY2hpZXZlbWVudHMpKTsKICAgICAgICAgICAgICAgIHRoaXMudGVtcFN0b3JhZ2Uuc2V0SXRlbSh0ZW1wQ29udGV4dC5zcmZzZXNzaW9ua2V5ICsgJ19waW1yZXNlYXJjaGZpbmRpbmdzJywgSlNPTi5zdHJpbmdpZnkocmVzLmRhdGEucGltcmVzZWFyY2hmaW5kaW5ncykpOwogICAgICAgICAgICAgICAgdGhpcy50ZW1wU3RvcmFnZS5zZXRJdGVtKHRlbXBDb250ZXh0LnNyZnNlc3Npb25rZXkgKyAnX3BpbWV4aXRhbmRlbnRyaWVzJywgSlNPTi5zdHJpbmdpZnkocmVzLmRhdGEucGltZXhpdGFuZGVudHJpZXMpKTsKICAgICAgICAgICAgICAgIHRoaXMudGVtcFN0b3JhZ2Uuc2V0SXRlbSh0ZW1wQ29udGV4dC5zcmZzZXNzaW9ua2V5ICsgJ19waW1yZXdhcmRwdW5pc2htZW50cycsIEpTT04uc3RyaW5naWZ5KHJlcy5kYXRhLnBpbXJld2FyZHB1bmlzaG1lbnRzKSk7CiAgICAgICAgICAgICAgICB0aGlzLnRlbXBTdG9yYWdlLnNldEl0ZW0odGVtcENvbnRleHQuc3Jmc2Vzc2lvbmtleSArICdfcGltcGF0ZW50cycsIEpTT04uc3RyaW5naWZ5KHJlcy5kYXRhLnBpbXBhdGVudHMpKTsKICAgICAgICAgICAgICAgIHRoaXMudGVtcFN0b3JhZ2Uuc2V0SXRlbSh0ZW1wQ29udGV4dC5zcmZzZXNzaW9ua2V5ICsgJ19waW1sYW5ndWFnZWFiaWxpdGllcycsIEpTT04uc3RyaW5naWZ5KHJlcy5kYXRhLnBpbWxhbmd1YWdlYWJpbGl0aWVzKSk7CiAgICAgICAgICAgICAgICB0aGlzLnRlbXBTdG9yYWdlLnNldEl0ZW0odGVtcENvbnRleHQuc3Jmc2Vzc2lvbmtleSArICdfcGltYXJjaGl2ZXMnLCBKU09OLnN0cmluZ2lmeShyZXMuZGF0YS5waW1hcmNoaXZlcykpOwogICAgICAgICAgICAgICAgdGhpcy50ZW1wU3RvcmFnZS5zZXRJdGVtKHRlbXBDb250ZXh0LnNyZnNlc3Npb25rZXkgKyAnX3BpbWZhbWluZm9zJywgSlNPTi5zdHJpbmdpZnkocmVzLmRhdGEucGltZmFtaW5mb3MpKTsKICAgICAgICAgICAgICAgIHRoaXMudGVtcFN0b3JhZ2Uuc2V0SXRlbSh0ZW1wQ29udGV4dC5zcmZzZXNzaW9ua2V5ICsgJ19hdHRlbmRhbmNlbXJlcG9ydG14ZXMnLCBKU09OLnN0cmluZ2lmeShyZXMuZGF0YS5hdHRlbmRhbmNlbXJlcG9ydG14ZXMpKTsKICAgICAgICAgICAgICAgIHRoaXMudGVtcFN0b3JhZ2Uuc2V0SXRlbSh0ZW1wQ29udGV4dC5zcmZzZXNzaW9ua2V5ICsgJ19waW13b3JraGlzdG9yaWVzJywgSlNPTi5zdHJpbmdpZnkocmVzLmRhdGEucGltd29ya2hpc3RvcmllcykpOwogICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0OC5hYnJ1cHQoInJldHVybiIsIHJlcyk7CgogICAgICAgICAgICAgIGNhc2UgMTAwOgogICAgICAgICAgICAgIGNhc2UgImVuZCI6CiAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQ4LnN0b3AoKTsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0sIF9jYWxsZWU4LCB0aGlzKTsKICAgICAgfSkpOwoKICAgICAgZnVuY3Rpb24gQ3JlYXRlKCkgewogICAgICAgIHJldHVybiBfQ3JlYXRlLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7CiAgICAgIH0KCiAgICAgIHJldHVybiBDcmVhdGU7CiAgICB9KCkKICAgIC8qKg0KICAgICAqIFNhdmXmjqXlj6Pmlrnms5UNCiAgICAgKg0KICAgICAqIEBwYXJhbSB7Kn0gW2NvbnRleHQ9e31dDQogICAgICogQHBhcmFtIHsqfSBbZGF0YT17fV0NCiAgICAgKiBAcGFyYW0ge2Jvb2xlYW59IFtpc2xvYWRpbmddDQogICAgICogQHJldHVybnMge1Byb21pc2U8YW55Pn0NCiAgICAgKiBAbWVtYmVyb2YgUGltUGVyc29uU2VydmljZUJhc2UNCiAgICAgKi8KCiAgfSwgewogICAga2V5OiAiU2F2ZSIsCiAgICB2YWx1ZTogZnVuY3Rpb24gKCkgewogICAgICB2YXIgX1NhdmUgPSBfYXN5bmNUb0dlbmVyYXRvcigKICAgICAgLyojX19QVVJFX18qLwogICAgICByZWdlbmVyYXRvclJ1bnRpbWUubWFyayhmdW5jdGlvbiBfY2FsbGVlOSgpIHsKICAgICAgICB2YXIgY29udGV4dCwKICAgICAgICAgICAgZGF0YSwKICAgICAgICAgICAgaXNsb2FkaW5nLAogICAgICAgICAgICBtYXN0ZXJEYXRhLAogICAgICAgICAgICBwaW1wZXJzb25hYmlsaXRpZXNEYXRhLAogICAgICAgICAgICBwaW1wYXBlcnNEYXRhLAogICAgICAgICAgICBwaW1kaXN0aXJidXRpb25zRGF0YSwKICAgICAgICAgICAgcGltdGl0bGVzRGF0YSwKICAgICAgICAgICAgcGltdm9jYXRpb25hbHNEYXRhLAogICAgICAgICAgICBwaW1hcm15Y2FkcmVzRGF0YSwKICAgICAgICAgICAgcGltY29ycmVjdGlvbmFwcGxpZXNEYXRhLAogICAgICAgICAgICBwaW12YWNhdGlvbnNEYXRhLAogICAgICAgICAgICB0cm10cmFpbnBlb3BsZURhdGEsCiAgICAgICAgICAgIHBpbWNvbnRyYWN0c0RhdGEsCiAgICAgICAgICAgIHBpbWVkdWNhdGlvbnNEYXRhLAogICAgICAgICAgICBwaW1wZXJzb25jaGFuZ2VzRGF0YSwKICAgICAgICAgICAgcGltYWNoaWV2ZW1lbnRzRGF0YSwKICAgICAgICAgICAgcGltcmVzZWFyY2hmaW5kaW5nc0RhdGEsCiAgICAgICAgICAgIHBpbWV4aXRhbmRlbnRyaWVzRGF0YSwKICAgICAgICAgICAgcGltcmV3YXJkcHVuaXNobWVudHNEYXRhLAogICAgICAgICAgICBwaW1wYXRlbnRzRGF0YSwKICAgICAgICAgICAgcGltbGFuZ3VhZ2VhYmlsaXRpZXNEYXRhLAogICAgICAgICAgICBwaW1hcmNoaXZlc0RhdGEsCiAgICAgICAgICAgIHBpbWZhbWluZm9zRGF0YSwKICAgICAgICAgICAgYXR0ZW5kYW5jZW1yZXBvcnRteGVzRGF0YSwKICAgICAgICAgICAgcGltd29ya2hpc3Rvcmllc0RhdGEsCiAgICAgICAgICAgIHJlcywKICAgICAgICAgICAgX2FyZ3M5ID0gYXJndW1lbnRzOwogICAgICAgIHJldHVybiByZWdlbmVyYXRvclJ1bnRpbWUud3JhcChmdW5jdGlvbiBfY2FsbGVlOSQoX2NvbnRleHQ5KSB7CiAgICAgICAgICB3aGlsZSAoMSkgewogICAgICAgICAgICBzd2l0Y2ggKF9jb250ZXh0OS5wcmV2ID0gX2NvbnRleHQ5Lm5leHQpIHsKICAgICAgICAgICAgICBjYXNlIDA6CiAgICAgICAgICAgICAgICBjb250ZXh0ID0gX2FyZ3M5Lmxlbmd0aCA+IDAgJiYgX2FyZ3M5WzBdICE9PSB1bmRlZmluZWQgPyBfYXJnczlbMF0gOiB7fTsKICAgICAgICAgICAgICAgIGRhdGEgPSBfYXJnczkubGVuZ3RoID4gMSAmJiBfYXJnczlbMV0gIT09IHVuZGVmaW5lZCA/IF9hcmdzOVsxXSA6IHt9OwogICAgICAgICAgICAgICAgaXNsb2FkaW5nID0gX2FyZ3M5Lmxlbmd0aCA+IDIgPyBfYXJnczlbMl0gOiB1bmRlZmluZWQ7CiAgICAgICAgICAgICAgICBtYXN0ZXJEYXRhID0ge307CiAgICAgICAgICAgICAgICBwaW1wZXJzb25hYmlsaXRpZXNEYXRhID0gW107CgogICAgICAgICAgICAgICAgaWYgKCFPYmplY3QuaXModGhpcy50ZW1wU3RvcmFnZS5nZXRJdGVtKGNvbnRleHQuc3Jmc2Vzc2lvbmtleSArICdfcGltcGVyc29uYWJpbGl0aWVzJyksICd1bmRlZmluZWQnKSkgewogICAgICAgICAgICAgICAgICBwaW1wZXJzb25hYmlsaXRpZXNEYXRhID0gSlNPTi5wYXJzZSh0aGlzLnRlbXBTdG9yYWdlLmdldEl0ZW0oY29udGV4dC5zcmZzZXNzaW9ua2V5ICsgJ19waW1wZXJzb25hYmlsaXRpZXMnKSk7CgogICAgICAgICAgICAgICAgICBpZiAocGltcGVyc29uYWJpbGl0aWVzRGF0YSAmJiBwaW1wZXJzb25hYmlsaXRpZXNEYXRhLmxlbmd0aCAmJiBwaW1wZXJzb25hYmlsaXRpZXNEYXRhLmxlbmd0aCA+IDApIHsKICAgICAgICAgICAgICAgICAgICBwaW1wZXJzb25hYmlsaXRpZXNEYXRhLmZvckVhY2goZnVuY3Rpb24gKGl0ZW0pIHsKICAgICAgICAgICAgICAgICAgICAgIGlmIChpdGVtLnNyZmZyb250dWYpIHsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKE9iamVjdC5pcyhpdGVtLnNyZmZyb250dWYsICIwIikpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICBpdGVtLnBpbXBlcnNvbmFiaWxpdHlpZCA9IG51bGw7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgICAgIGRlbGV0ZSBpdGVtLnNyZmZyb250dWY7CiAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBtYXN0ZXJEYXRhLnBpbXBlcnNvbmFiaWxpdGllcyA9IHBpbXBlcnNvbmFiaWxpdGllc0RhdGE7CiAgICAgICAgICAgICAgICBwaW1wYXBlcnNEYXRhID0gW107CgogICAgICAgICAgICAgICAgaWYgKCFPYmplY3QuaXModGhpcy50ZW1wU3RvcmFnZS5nZXRJdGVtKGNvbnRleHQuc3Jmc2Vzc2lvbmtleSArICdfcGltcGFwZXJzJyksICd1bmRlZmluZWQnKSkgewogICAgICAgICAgICAgICAgICBwaW1wYXBlcnNEYXRhID0gSlNPTi5wYXJzZSh0aGlzLnRlbXBTdG9yYWdlLmdldEl0ZW0oY29udGV4dC5zcmZzZXNzaW9ua2V5ICsgJ19waW1wYXBlcnMnKSk7CgogICAgICAgICAgICAgICAgICBpZiAocGltcGFwZXJzRGF0YSAmJiBwaW1wYXBlcnNEYXRhLmxlbmd0aCAmJiBwaW1wYXBlcnNEYXRhLmxlbmd0aCA+IDApIHsKICAgICAgICAgICAgICAgICAgICBwaW1wYXBlcnNEYXRhLmZvckVhY2goZnVuY3Rpb24gKGl0ZW0pIHsKICAgICAgICAgICAgICAgICAgICAgIGlmIChpdGVtLnNyZmZyb250dWYpIHsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKE9iamVjdC5pcyhpdGVtLnNyZmZyb250dWYsICIwIikpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICBpdGVtLnBpbXBhcGVyaWQgPSBudWxsOwogICAgICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgICAgICBkZWxldGUgaXRlbS5zcmZmcm9udHVmOwogICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgbWFzdGVyRGF0YS5waW1wYXBlcnMgPSBwaW1wYXBlcnNEYXRhOwogICAgICAgICAgICAgICAgcGltZGlzdGlyYnV0aW9uc0RhdGEgPSBbXTsKCiAgICAgICAgICAgICAgICBpZiAoIU9iamVjdC5pcyh0aGlzLnRlbXBTdG9yYWdlLmdldEl0ZW0oY29udGV4dC5zcmZzZXNzaW9ua2V5ICsgJ19waW1kaXN0aXJidXRpb25zJyksICd1bmRlZmluZWQnKSkgewogICAgICAgICAgICAgICAgICBwaW1kaXN0aXJidXRpb25zRGF0YSA9IEpTT04ucGFyc2UodGhpcy50ZW1wU3RvcmFnZS5nZXRJdGVtKGNvbnRleHQuc3Jmc2Vzc2lvbmtleSArICdfcGltZGlzdGlyYnV0aW9ucycpKTsKCiAgICAgICAgICAgICAgICAgIGlmIChwaW1kaXN0aXJidXRpb25zRGF0YSAmJiBwaW1kaXN0aXJidXRpb25zRGF0YS5sZW5ndGggJiYgcGltZGlzdGlyYnV0aW9uc0RhdGEubGVuZ3RoID4gMCkgewogICAgICAgICAgICAgICAgICAgIHBpbWRpc3RpcmJ1dGlvbnNEYXRhLmZvckVhY2goZnVuY3Rpb24gKGl0ZW0pIHsKICAgICAgICAgICAgICAgICAgICAgIGlmIChpdGVtLnNyZmZyb250dWYpIHsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKE9iamVjdC5pcyhpdGVtLnNyZmZyb250dWYsICIwIikpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICBpdGVtLnBpbWRpc3RpcmJ1dGlvbmlkID0gbnVsbDsKICAgICAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICAgICAgZGVsZXRlIGl0ZW0uc3JmZnJvbnR1ZjsKICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIG1hc3RlckRhdGEucGltZGlzdGlyYnV0aW9ucyA9IHBpbWRpc3RpcmJ1dGlvbnNEYXRhOwogICAgICAgICAgICAgICAgcGltdGl0bGVzRGF0YSA9IFtdOwoKICAgICAgICAgICAgICAgIGlmICghT2JqZWN0LmlzKHRoaXMudGVtcFN0b3JhZ2UuZ2V0SXRlbShjb250ZXh0LnNyZnNlc3Npb25rZXkgKyAnX3BpbXRpdGxlcycpLCAndW5kZWZpbmVkJykpIHsKICAgICAgICAgICAgICAgICAgcGltdGl0bGVzRGF0YSA9IEpTT04ucGFyc2UodGhpcy50ZW1wU3RvcmFnZS5nZXRJdGVtKGNvbnRleHQuc3Jmc2Vzc2lvbmtleSArICdfcGltdGl0bGVzJykpOwoKICAgICAgICAgICAgICAgICAgaWYgKHBpbXRpdGxlc0RhdGEgJiYgcGltdGl0bGVzRGF0YS5sZW5ndGggJiYgcGltdGl0bGVzRGF0YS5sZW5ndGggPiAwKSB7CiAgICAgICAgICAgICAgICAgICAgcGltdGl0bGVzRGF0YS5mb3JFYWNoKGZ1bmN0aW9uIChpdGVtKSB7CiAgICAgICAgICAgICAgICAgICAgICBpZiAoaXRlbS5zcmZmcm9udHVmKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChPYmplY3QuaXMoaXRlbS5zcmZmcm9udHVmLCAiMCIpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgaXRlbS5waW10aXRsZWlkID0gbnVsbDsKICAgICAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICAgICAgZGVsZXRlIGl0ZW0uc3JmZnJvbnR1ZjsKICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIG1hc3RlckRhdGEucGltdGl0bGVzID0gcGltdGl0bGVzRGF0YTsKICAgICAgICAgICAgICAgIHBpbXZvY2F0aW9uYWxzRGF0YSA9IFtdOwoKICAgICAgICAgICAgICAgIGlmICghT2JqZWN0LmlzKHRoaXMudGVtcFN0b3JhZ2UuZ2V0SXRlbShjb250ZXh0LnNyZnNlc3Npb25rZXkgKyAnX3BpbXZvY2F0aW9uYWxzJyksICd1bmRlZmluZWQnKSkgewogICAgICAgICAgICAgICAgICBwaW12b2NhdGlvbmFsc0RhdGEgPSBKU09OLnBhcnNlKHRoaXMudGVtcFN0b3JhZ2UuZ2V0SXRlbShjb250ZXh0LnNyZnNlc3Npb25rZXkgKyAnX3BpbXZvY2F0aW9uYWxzJykpOwoKICAgICAgICAgICAgICAgICAgaWYgKHBpbXZvY2F0aW9uYWxzRGF0YSAmJiBwaW12b2NhdGlvbmFsc0RhdGEubGVuZ3RoICYmIHBpbXZvY2F0aW9uYWxzRGF0YS5sZW5ndGggPiAwKSB7CiAgICAgICAgICAgICAgICAgICAgcGltdm9jYXRpb25hbHNEYXRhLmZvckVhY2goZnVuY3Rpb24gKGl0ZW0pIHsKICAgICAgICAgICAgICAgICAgICAgIGlmIChpdGVtLnNyZmZyb250dWYpIHsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKE9iamVjdC5pcyhpdGVtLnNyZmZyb250dWYsICIwIikpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICBpdGVtLnBpbXZvY2F0aW9uYWxpZCA9IG51bGw7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgICAgIGRlbGV0ZSBpdGVtLnNyZmZyb250dWY7CiAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBtYXN0ZXJEYXRhLnBpbXZvY2F0aW9uYWxzID0gcGltdm9jYXRpb25hbHNEYXRhOwogICAgICAgICAgICAgICAgcGltYXJteWNhZHJlc0RhdGEgPSBbXTsKCiAgICAgICAgICAgICAgICBpZiAoIU9iamVjdC5pcyh0aGlzLnRlbXBTdG9yYWdlLmdldEl0ZW0oY29udGV4dC5zcmZzZXNzaW9ua2V5ICsgJ19waW1hcm15Y2FkcmVzJyksICd1bmRlZmluZWQnKSkgewogICAgICAgICAgICAgICAgICBwaW1hcm15Y2FkcmVzRGF0YSA9IEpTT04ucGFyc2UodGhpcy50ZW1wU3RvcmFnZS5nZXRJdGVtKGNvbnRleHQuc3Jmc2Vzc2lvbmtleSArICdfcGltYXJteWNhZHJlcycpKTsKCiAgICAgICAgICAgICAgICAgIGlmIChwaW1hcm15Y2FkcmVzRGF0YSAmJiBwaW1hcm15Y2FkcmVzRGF0YS5sZW5ndGggJiYgcGltYXJteWNhZHJlc0RhdGEubGVuZ3RoID4gMCkgewogICAgICAgICAgICAgICAgICAgIHBpbWFybXljYWRyZXNEYXRhLmZvckVhY2goZnVuY3Rpb24gKGl0ZW0pIHsKICAgICAgICAgICAgICAgICAgICAgIGlmIChpdGVtLnNyZmZyb250dWYpIHsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKE9iamVjdC5pcyhpdGVtLnNyZmZyb250dWYsICIwIikpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICBpdGVtLnBpbWFybXljYWRyZXNpZCA9IG51bGw7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgICAgIGRlbGV0ZSBpdGVtLnNyZmZyb250dWY7CiAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBtYXN0ZXJEYXRhLnBpbWFybXljYWRyZXMgPSBwaW1hcm15Y2FkcmVzRGF0YTsKICAgICAgICAgICAgICAgIHBpbWNvcnJlY3Rpb25hcHBsaWVzRGF0YSA9IFtdOwoKICAgICAgICAgICAgICAgIGlmICghT2JqZWN0LmlzKHRoaXMudGVtcFN0b3JhZ2UuZ2V0SXRlbShjb250ZXh0LnNyZnNlc3Npb25rZXkgKyAnX3BpbWNvcnJlY3Rpb25hcHBsaWVzJyksICd1bmRlZmluZWQnKSkgewogICAgICAgICAgICAgICAgICBwaW1jb3JyZWN0aW9uYXBwbGllc0RhdGEgPSBKU09OLnBhcnNlKHRoaXMudGVtcFN0b3JhZ2UuZ2V0SXRlbShjb250ZXh0LnNyZnNlc3Npb25rZXkgKyAnX3BpbWNvcnJlY3Rpb25hcHBsaWVzJykpOwoKICAgICAgICAgICAgICAgICAgaWYgKHBpbWNvcnJlY3Rpb25hcHBsaWVzRGF0YSAmJiBwaW1jb3JyZWN0aW9uYXBwbGllc0RhdGEubGVuZ3RoICYmIHBpbWNvcnJlY3Rpb25hcHBsaWVzRGF0YS5sZW5ndGggPiAwKSB7CiAgICAgICAgICAgICAgICAgICAgcGltY29ycmVjdGlvbmFwcGxpZXNEYXRhLmZvckVhY2goZnVuY3Rpb24gKGl0ZW0pIHsKICAgICAgICAgICAgICAgICAgICAgIGlmIChpdGVtLnNyZmZyb250dWYpIHsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKE9iamVjdC5pcyhpdGVtLnNyZmZyb250dWYsICIwIikpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICBpdGVtLnBpbWNvcnJlY3Rpb25hcHBseWlkID0gbnVsbDsKICAgICAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICAgICAgZGVsZXRlIGl0ZW0uc3JmZnJvbnR1ZjsKICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIG1hc3RlckRhdGEucGltY29ycmVjdGlvbmFwcGxpZXMgPSBwaW1jb3JyZWN0aW9uYXBwbGllc0RhdGE7CiAgICAgICAgICAgICAgICBwaW12YWNhdGlvbnNEYXRhID0gW107CgogICAgICAgICAgICAgICAgaWYgKCFPYmplY3QuaXModGhpcy50ZW1wU3RvcmFnZS5nZXRJdGVtKGNvbnRleHQuc3Jmc2Vzc2lvbmtleSArICdfcGltdmFjYXRpb25zJyksICd1bmRlZmluZWQnKSkgewogICAgICAgICAgICAgICAgICBwaW12YWNhdGlvbnNEYXRhID0gSlNPTi5wYXJzZSh0aGlzLnRlbXBTdG9yYWdlLmdldEl0ZW0oY29udGV4dC5zcmZzZXNzaW9ua2V5ICsgJ19waW12YWNhdGlvbnMnKSk7CgogICAgICAgICAgICAgICAgICBpZiAocGltdmFjYXRpb25zRGF0YSAmJiBwaW12YWNhdGlvbnNEYXRhLmxlbmd0aCAmJiBwaW12YWNhdGlvbnNEYXRhLmxlbmd0aCA+IDApIHsKICAgICAgICAgICAgICAgICAgICBwaW12YWNhdGlvbnNEYXRhLmZvckVhY2goZnVuY3Rpb24gKGl0ZW0pIHsKICAgICAgICAgICAgICAgICAgICAgIGlmIChpdGVtLnNyZmZyb250dWYpIHsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKE9iamVjdC5pcyhpdGVtLnNyZmZyb250dWYsICIwIikpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICBpdGVtLnBpbXZhY2F0aW9uaWQgPSBudWxsOwogICAgICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgICAgICBkZWxldGUgaXRlbS5zcmZmcm9udHVmOwogICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgbWFzdGVyRGF0YS5waW12YWNhdGlvbnMgPSBwaW12YWNhdGlvbnNEYXRhOwogICAgICAgICAgICAgICAgdHJtdHJhaW5wZW9wbGVEYXRhID0gW107CgogICAgICAgICAgICAgICAgaWYgKCFPYmplY3QuaXModGhpcy50ZW1wU3RvcmFnZS5nZXRJdGVtKGNvbnRleHQuc3Jmc2Vzc2lvbmtleSArICdfdHJtdHJhaW5wZW9wbGUnKSwgJ3VuZGVmaW5lZCcpKSB7CiAgICAgICAgICAgICAgICAgIHRybXRyYWlucGVvcGxlRGF0YSA9IEpTT04ucGFyc2UodGhpcy50ZW1wU3RvcmFnZS5nZXRJdGVtKGNvbnRleHQuc3Jmc2Vzc2lvbmtleSArICdfdHJtdHJhaW5wZW9wbGUnKSk7CgogICAgICAgICAgICAgICAgICBpZiAodHJtdHJhaW5wZW9wbGVEYXRhICYmIHRybXRyYWlucGVvcGxlRGF0YS5sZW5ndGggJiYgdHJtdHJhaW5wZW9wbGVEYXRhLmxlbmd0aCA+IDApIHsKICAgICAgICAgICAgICAgICAgICB0cm10cmFpbnBlb3BsZURhdGEuZm9yRWFjaChmdW5jdGlvbiAoaXRlbSkgewogICAgICAgICAgICAgICAgICAgICAgaWYgKGl0ZW0uc3JmZnJvbnR1ZikgewogICAgICAgICAgICAgICAgICAgICAgICBpZiAoT2JqZWN0LmlzKGl0ZW0uc3JmZnJvbnR1ZiwgIjAiKSkgewogICAgICAgICAgICAgICAgICAgICAgICAgIGl0ZW0udHJtdHJpYW5wZXJzb25pZCA9IG51bGw7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgICAgIGRlbGV0ZSBpdGVtLnNyZmZyb250dWY7CiAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBtYXN0ZXJEYXRhLnRybXRyYWlucGVvcGxlID0gdHJtdHJhaW5wZW9wbGVEYXRhOwogICAgICAgICAgICAgICAgcGltY29udHJhY3RzRGF0YSA9IFtdOwoKICAgICAgICAgICAgICAgIGlmICghT2JqZWN0LmlzKHRoaXMudGVtcFN0b3JhZ2UuZ2V0SXRlbShjb250ZXh0LnNyZnNlc3Npb25rZXkgKyAnX3BpbWNvbnRyYWN0cycpLCAndW5kZWZpbmVkJykpIHsKICAgICAgICAgICAgICAgICAgcGltY29udHJhY3RzRGF0YSA9IEpTT04ucGFyc2UodGhpcy50ZW1wU3RvcmFnZS5nZXRJdGVtKGNvbnRleHQuc3Jmc2Vzc2lvbmtleSArICdfcGltY29udHJhY3RzJykpOwoKICAgICAgICAgICAgICAgICAgaWYgKHBpbWNvbnRyYWN0c0RhdGEgJiYgcGltY29udHJhY3RzRGF0YS5sZW5ndGggJiYgcGltY29udHJhY3RzRGF0YS5sZW5ndGggPiAwKSB7CiAgICAgICAgICAgICAgICAgICAgcGltY29udHJhY3RzRGF0YS5mb3JFYWNoKGZ1bmN0aW9uIChpdGVtKSB7CiAgICAgICAgICAgICAgICAgICAgICBpZiAoaXRlbS5zcmZmcm9udHVmKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChPYmplY3QuaXMoaXRlbS5zcmZmcm9udHVmLCAiMCIpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgaXRlbS5waW1jb250cmFjdGlkID0gbnVsbDsKICAgICAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICAgICAgZGVsZXRlIGl0ZW0uc3JmZnJvbnR1ZjsKICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIG1hc3RlckRhdGEucGltY29udHJhY3RzID0gcGltY29udHJhY3RzRGF0YTsKICAgICAgICAgICAgICAgIHBpbWVkdWNhdGlvbnNEYXRhID0gW107CgogICAgICAgICAgICAgICAgaWYgKCFPYmplY3QuaXModGhpcy50ZW1wU3RvcmFnZS5nZXRJdGVtKGNvbnRleHQuc3Jmc2Vzc2lvbmtleSArICdfcGltZWR1Y2F0aW9ucycpLCAndW5kZWZpbmVkJykpIHsKICAgICAgICAgICAgICAgICAgcGltZWR1Y2F0aW9uc0RhdGEgPSBKU09OLnBhcnNlKHRoaXMudGVtcFN0b3JhZ2UuZ2V0SXRlbShjb250ZXh0LnNyZnNlc3Npb25rZXkgKyAnX3BpbWVkdWNhdGlvbnMnKSk7CgogICAgICAgICAgICAgICAgICBpZiAocGltZWR1Y2F0aW9uc0RhdGEgJiYgcGltZWR1Y2F0aW9uc0RhdGEubGVuZ3RoICYmIHBpbWVkdWNhdGlvbnNEYXRhLmxlbmd0aCA+IDApIHsKICAgICAgICAgICAgICAgICAgICBwaW1lZHVjYXRpb25zRGF0YS5mb3JFYWNoKGZ1bmN0aW9uIChpdGVtKSB7CiAgICAgICAgICAgICAgICAgICAgICBpZiAoaXRlbS5zcmZmcm9udHVmKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChPYmplY3QuaXMoaXRlbS5zcmZmcm9udHVmLCAiMCIpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgaXRlbS5waW1lZHVjYXRpb25pZCA9IG51bGw7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgICAgIGRlbGV0ZSBpdGVtLnNyZmZyb250dWY7CiAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBtYXN0ZXJEYXRhLnBpbWVkdWNhdGlvbnMgPSBwaW1lZHVjYXRpb25zRGF0YTsKICAgICAgICAgICAgICAgIHBpbXBlcnNvbmNoYW5nZXNEYXRhID0gW107CgogICAgICAgICAgICAgICAgaWYgKCFPYmplY3QuaXModGhpcy50ZW1wU3RvcmFnZS5nZXRJdGVtKGNvbnRleHQuc3Jmc2Vzc2lvbmtleSArICdfcGltcGVyc29uY2hhbmdlcycpLCAndW5kZWZpbmVkJykpIHsKICAgICAgICAgICAgICAgICAgcGltcGVyc29uY2hhbmdlc0RhdGEgPSBKU09OLnBhcnNlKHRoaXMudGVtcFN0b3JhZ2UuZ2V0SXRlbShjb250ZXh0LnNyZnNlc3Npb25rZXkgKyAnX3BpbXBlcnNvbmNoYW5nZXMnKSk7CgogICAgICAgICAgICAgICAgICBpZiAocGltcGVyc29uY2hhbmdlc0RhdGEgJiYgcGltcGVyc29uY2hhbmdlc0RhdGEubGVuZ3RoICYmIHBpbXBlcnNvbmNoYW5nZXNEYXRhLmxlbmd0aCA+IDApIHsKICAgICAgICAgICAgICAgICAgICBwaW1wZXJzb25jaGFuZ2VzRGF0YS5mb3JFYWNoKGZ1bmN0aW9uIChpdGVtKSB7CiAgICAgICAgICAgICAgICAgICAgICBpZiAoaXRlbS5zcmZmcm9udHVmKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChPYmplY3QuaXMoaXRlbS5zcmZmcm9udHVmLCAiMCIpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgaXRlbS5waW1wZXJzb25jaGFuZ2VpZCA9IG51bGw7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgICAgIGRlbGV0ZSBpdGVtLnNyZmZyb250dWY7CiAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBtYXN0ZXJEYXRhLnBpbXBlcnNvbmNoYW5nZXMgPSBwaW1wZXJzb25jaGFuZ2VzRGF0YTsKICAgICAgICAgICAgICAgIHBpbWFjaGlldmVtZW50c0RhdGEgPSBbXTsKCiAgICAgICAgICAgICAgICBpZiAoIU9iamVjdC5pcyh0aGlzLnRlbXBTdG9yYWdlLmdldEl0ZW0oY29udGV4dC5zcmZzZXNzaW9ua2V5ICsgJ19waW1hY2hpZXZlbWVudHMnKSwgJ3VuZGVmaW5lZCcpKSB7CiAgICAgICAgICAgICAgICAgIHBpbWFjaGlldmVtZW50c0RhdGEgPSBKU09OLnBhcnNlKHRoaXMudGVtcFN0b3JhZ2UuZ2V0SXRlbShjb250ZXh0LnNyZnNlc3Npb25rZXkgKyAnX3BpbWFjaGlldmVtZW50cycpKTsKCiAgICAgICAgICAgICAgICAgIGlmIChwaW1hY2hpZXZlbWVudHNEYXRhICYmIHBpbWFjaGlldmVtZW50c0RhdGEubGVuZ3RoICYmIHBpbWFjaGlldmVtZW50c0RhdGEubGVuZ3RoID4gMCkgewogICAgICAgICAgICAgICAgICAgIHBpbWFjaGlldmVtZW50c0RhdGEuZm9yRWFjaChmdW5jdGlvbiAoaXRlbSkgewogICAgICAgICAgICAgICAgICAgICAgaWYgKGl0ZW0uc3JmZnJvbnR1ZikgewogICAgICAgICAgICAgICAgICAgICAgICBpZiAoT2JqZWN0LmlzKGl0ZW0uc3JmZnJvbnR1ZiwgIjAiKSkgewogICAgICAgICAgICAgICAgICAgICAgICAgIGl0ZW0ucGltYWNoaWV2ZW1lbnRzaWQgPSBudWxsOwogICAgICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgICAgICBkZWxldGUgaXRlbS5zcmZmcm9udHVmOwogICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgbWFzdGVyRGF0YS5waW1hY2hpZXZlbWVudHMgPSBwaW1hY2hpZXZlbWVudHNEYXRhOwogICAgICAgICAgICAgICAgcGltcmVzZWFyY2hmaW5kaW5nc0RhdGEgPSBbXTsKCiAgICAgICAgICAgICAgICBpZiAoIU9iamVjdC5pcyh0aGlzLnRlbXBTdG9yYWdlLmdldEl0ZW0oY29udGV4dC5zcmZzZXNzaW9ua2V5ICsgJ19waW1yZXNlYXJjaGZpbmRpbmdzJyksICd1bmRlZmluZWQnKSkgewogICAgICAgICAgICAgICAgICBwaW1yZXNlYXJjaGZpbmRpbmdzRGF0YSA9IEpTT04ucGFyc2UodGhpcy50ZW1wU3RvcmFnZS5nZXRJdGVtKGNvbnRleHQuc3Jmc2Vzc2lvbmtleSArICdfcGltcmVzZWFyY2hmaW5kaW5ncycpKTsKCiAgICAgICAgICAgICAgICAgIGlmIChwaW1yZXNlYXJjaGZpbmRpbmdzRGF0YSAmJiBwaW1yZXNlYXJjaGZpbmRpbmdzRGF0YS5sZW5ndGggJiYgcGltcmVzZWFyY2hmaW5kaW5nc0RhdGEubGVuZ3RoID4gMCkgewogICAgICAgICAgICAgICAgICAgIHBpbXJlc2VhcmNoZmluZGluZ3NEYXRhLmZvckVhY2goZnVuY3Rpb24gKGl0ZW0pIHsKICAgICAgICAgICAgICAgICAgICAgIGlmIChpdGVtLnNyZmZyb250dWYpIHsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKE9iamVjdC5pcyhpdGVtLnNyZmZyb250dWYsICIwIikpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICBpdGVtLnBpbXJlc2VhcmNoZmluZGluZ3NpZCA9IG51bGw7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgICAgIGRlbGV0ZSBpdGVtLnNyZmZyb250dWY7CiAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBtYXN0ZXJEYXRhLnBpbXJlc2VhcmNoZmluZGluZ3MgPSBwaW1yZXNlYXJjaGZpbmRpbmdzRGF0YTsKICAgICAgICAgICAgICAgIHBpbWV4aXRhbmRlbnRyaWVzRGF0YSA9IFtdOwoKICAgICAgICAgICAgICAgIGlmICghT2JqZWN0LmlzKHRoaXMudGVtcFN0b3JhZ2UuZ2V0SXRlbShjb250ZXh0LnNyZnNlc3Npb25rZXkgKyAnX3BpbWV4aXRhbmRlbnRyaWVzJyksICd1bmRlZmluZWQnKSkgewogICAgICAgICAgICAgICAgICBwaW1leGl0YW5kZW50cmllc0RhdGEgPSBKU09OLnBhcnNlKHRoaXMudGVtcFN0b3JhZ2UuZ2V0SXRlbShjb250ZXh0LnNyZnNlc3Npb25rZXkgKyAnX3BpbWV4aXRhbmRlbnRyaWVzJykpOwoKICAgICAgICAgICAgICAgICAgaWYgKHBpbWV4aXRhbmRlbnRyaWVzRGF0YSAmJiBwaW1leGl0YW5kZW50cmllc0RhdGEubGVuZ3RoICYmIHBpbWV4aXRhbmRlbnRyaWVzRGF0YS5sZW5ndGggPiAwKSB7CiAgICAgICAgICAgICAgICAgICAgcGltZXhpdGFuZGVudHJpZXNEYXRhLmZvckVhY2goZnVuY3Rpb24gKGl0ZW0pIHsKICAgICAgICAgICAgICAgICAgICAgIGlmIChpdGVtLnNyZmZyb250dWYpIHsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKE9iamVjdC5pcyhpdGVtLnNyZmZyb250dWYsICIwIikpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICBpdGVtLnBpbWV4aXRhbmRlbnRyeWlkID0gbnVsbDsKICAgICAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICAgICAgZGVsZXRlIGl0ZW0uc3JmZnJvbnR1ZjsKICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIG1hc3RlckRhdGEucGltZXhpdGFuZGVudHJpZXMgPSBwaW1leGl0YW5kZW50cmllc0RhdGE7CiAgICAgICAgICAgICAgICBwaW1yZXdhcmRwdW5pc2htZW50c0RhdGEgPSBbXTsKCiAgICAgICAgICAgICAgICBpZiAoIU9iamVjdC5pcyh0aGlzLnRlbXBTdG9yYWdlLmdldEl0ZW0oY29udGV4dC5zcmZzZXNzaW9ua2V5ICsgJ19waW1yZXdhcmRwdW5pc2htZW50cycpLCAndW5kZWZpbmVkJykpIHsKICAgICAgICAgICAgICAgICAgcGltcmV3YXJkcHVuaXNobWVudHNEYXRhID0gSlNPTi5wYXJzZSh0aGlzLnRlbXBTdG9yYWdlLmdldEl0ZW0oY29udGV4dC5zcmZzZXNzaW9ua2V5ICsgJ19waW1yZXdhcmRwdW5pc2htZW50cycpKTsKCiAgICAgICAgICAgICAgICAgIGlmIChwaW1yZXdhcmRwdW5pc2htZW50c0RhdGEgJiYgcGltcmV3YXJkcHVuaXNobWVudHNEYXRhLmxlbmd0aCAmJiBwaW1yZXdhcmRwdW5pc2htZW50c0RhdGEubGVuZ3RoID4gMCkgewogICAgICAgICAgICAgICAgICAgIHBpbXJld2FyZHB1bmlzaG1lbnRzRGF0YS5mb3JFYWNoKGZ1bmN0aW9uIChpdGVtKSB7CiAgICAgICAgICAgICAgICAgICAgICBpZiAoaXRlbS5zcmZmcm9udHVmKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChPYmplY3QuaXMoaXRlbS5zcmZmcm9udHVmLCAiMCIpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgaXRlbS5waW1yZXdhcmRwdW5pc2htZW50aWQgPSBudWxsOwogICAgICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgICAgICBkZWxldGUgaXRlbS5zcmZmcm9udHVmOwogICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgbWFzdGVyRGF0YS5waW1yZXdhcmRwdW5pc2htZW50cyA9IHBpbXJld2FyZHB1bmlzaG1lbnRzRGF0YTsKICAgICAgICAgICAgICAgIHBpbXBhdGVudHNEYXRhID0gW107CgogICAgICAgICAgICAgICAgaWYgKCFPYmplY3QuaXModGhpcy50ZW1wU3RvcmFnZS5nZXRJdGVtKGNvbnRleHQuc3Jmc2Vzc2lvbmtleSArICdfcGltcGF0ZW50cycpLCAndW5kZWZpbmVkJykpIHsKICAgICAgICAgICAgICAgICAgcGltcGF0ZW50c0RhdGEgPSBKU09OLnBhcnNlKHRoaXMudGVtcFN0b3JhZ2UuZ2V0SXRlbShjb250ZXh0LnNyZnNlc3Npb25rZXkgKyAnX3BpbXBhdGVudHMnKSk7CgogICAgICAgICAgICAgICAgICBpZiAocGltcGF0ZW50c0RhdGEgJiYgcGltcGF0ZW50c0RhdGEubGVuZ3RoICYmIHBpbXBhdGVudHNEYXRhLmxlbmd0aCA+IDApIHsKICAgICAgICAgICAgICAgICAgICBwaW1wYXRlbnRzRGF0YS5mb3JFYWNoKGZ1bmN0aW9uIChpdGVtKSB7CiAgICAgICAgICAgICAgICAgICAgICBpZiAoaXRlbS5zcmZmcm9udHVmKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChPYmplY3QuaXMoaXRlbS5zcmZmcm9udHVmLCAiMCIpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgaXRlbS5waW1wYXRlbnRpZCA9IG51bGw7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgICAgIGRlbGV0ZSBpdGVtLnNyZmZyb250dWY7CiAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBtYXN0ZXJEYXRhLnBpbXBhdGVudHMgPSBwaW1wYXRlbnRzRGF0YTsKICAgICAgICAgICAgICAgIHBpbWxhbmd1YWdlYWJpbGl0aWVzRGF0YSA9IFtdOwoKICAgICAgICAgICAgICAgIGlmICghT2JqZWN0LmlzKHRoaXMudGVtcFN0b3JhZ2UuZ2V0SXRlbShjb250ZXh0LnNyZnNlc3Npb25rZXkgKyAnX3BpbWxhbmd1YWdlYWJpbGl0aWVzJyksICd1bmRlZmluZWQnKSkgewogICAgICAgICAgICAgICAgICBwaW1sYW5ndWFnZWFiaWxpdGllc0RhdGEgPSBKU09OLnBhcnNlKHRoaXMudGVtcFN0b3JhZ2UuZ2V0SXRlbShjb250ZXh0LnNyZnNlc3Npb25rZXkgKyAnX3BpbWxhbmd1YWdlYWJpbGl0aWVzJykpOwoKICAgICAgICAgICAgICAgICAgaWYgKHBpbWxhbmd1YWdlYWJpbGl0aWVzRGF0YSAmJiBwaW1sYW5ndWFnZWFiaWxpdGllc0RhdGEubGVuZ3RoICYmIHBpbWxhbmd1YWdlYWJpbGl0aWVzRGF0YS5sZW5ndGggPiAwKSB7CiAgICAgICAgICAgICAgICAgICAgcGltbGFuZ3VhZ2VhYmlsaXRpZXNEYXRhLmZvckVhY2goZnVuY3Rpb24gKGl0ZW0pIHsKICAgICAgICAgICAgICAgICAgICAgIGlmIChpdGVtLnNyZmZyb250dWYpIHsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKE9iamVjdC5pcyhpdGVtLnNyZmZyb250dWYsICIwIikpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICBpdGVtLnBpbWxhbmd1YWdlYWJpbGl0eWlkID0gbnVsbDsKICAgICAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICAgICAgZGVsZXRlIGl0ZW0uc3JmZnJvbnR1ZjsKICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIG1hc3RlckRhdGEucGltbGFuZ3VhZ2VhYmlsaXRpZXMgPSBwaW1sYW5ndWFnZWFiaWxpdGllc0RhdGE7CiAgICAgICAgICAgICAgICBwaW1hcmNoaXZlc0RhdGEgPSBbXTsKCiAgICAgICAgICAgICAgICBpZiAoIU9iamVjdC5pcyh0aGlzLnRlbXBTdG9yYWdlLmdldEl0ZW0oY29udGV4dC5zcmZzZXNzaW9ua2V5ICsgJ19waW1hcmNoaXZlcycpLCAndW5kZWZpbmVkJykpIHsKICAgICAgICAgICAgICAgICAgcGltYXJjaGl2ZXNEYXRhID0gSlNPTi5wYXJzZSh0aGlzLnRlbXBTdG9yYWdlLmdldEl0ZW0oY29udGV4dC5zcmZzZXNzaW9ua2V5ICsgJ19waW1hcmNoaXZlcycpKTsKCiAgICAgICAgICAgICAgICAgIGlmIChwaW1hcmNoaXZlc0RhdGEgJiYgcGltYXJjaGl2ZXNEYXRhLmxlbmd0aCAmJiBwaW1hcmNoaXZlc0RhdGEubGVuZ3RoID4gMCkgewogICAgICAgICAgICAgICAgICAgIHBpbWFyY2hpdmVzRGF0YS5mb3JFYWNoKGZ1bmN0aW9uIChpdGVtKSB7CiAgICAgICAgICAgICAgICAgICAgICBpZiAoaXRlbS5zcmZmcm9udHVmKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChPYmplY3QuaXMoaXRlbS5zcmZmcm9udHVmLCAiMCIpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgaXRlbS5waW1hcmNoaXZlc2lkID0gbnVsbDsKICAgICAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICAgICAgZGVsZXRlIGl0ZW0uc3JmZnJvbnR1ZjsKICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIG1hc3RlckRhdGEucGltYXJjaGl2ZXMgPSBwaW1hcmNoaXZlc0RhdGE7CiAgICAgICAgICAgICAgICBwaW1mYW1pbmZvc0RhdGEgPSBbXTsKCiAgICAgICAgICAgICAgICBpZiAoIU9iamVjdC5pcyh0aGlzLnRlbXBTdG9yYWdlLmdldEl0ZW0oY29udGV4dC5zcmZzZXNzaW9ua2V5ICsgJ19waW1mYW1pbmZvcycpLCAndW5kZWZpbmVkJykpIHsKICAgICAgICAgICAgICAgICAgcGltZmFtaW5mb3NEYXRhID0gSlNPTi5wYXJzZSh0aGlzLnRlbXBTdG9yYWdlLmdldEl0ZW0oY29udGV4dC5zcmZzZXNzaW9ua2V5ICsgJ19waW1mYW1pbmZvcycpKTsKCiAgICAgICAgICAgICAgICAgIGlmIChwaW1mYW1pbmZvc0RhdGEgJiYgcGltZmFtaW5mb3NEYXRhLmxlbmd0aCAmJiBwaW1mYW1pbmZvc0RhdGEubGVuZ3RoID4gMCkgewogICAgICAgICAgICAgICAgICAgIHBpbWZhbWluZm9zRGF0YS5mb3JFYWNoKGZ1bmN0aW9uIChpdGVtKSB7CiAgICAgICAgICAgICAgICAgICAgICBpZiAoaXRlbS5zcmZmcm9udHVmKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChPYmplY3QuaXMoaXRlbS5zcmZmcm9udHVmLCAiMCIpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgaXRlbS5waW1mYW1pbmZvaWQgPSBudWxsOwogICAgICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgICAgICBkZWxldGUgaXRlbS5zcmZmcm9udHVmOwogICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgbWFzdGVyRGF0YS5waW1mYW1pbmZvcyA9IHBpbWZhbWluZm9zRGF0YTsKICAgICAgICAgICAgICAgIGF0dGVuZGFuY2VtcmVwb3J0bXhlc0RhdGEgPSBbXTsKCiAgICAgICAgICAgICAgICBpZiAoIU9iamVjdC5pcyh0aGlzLnRlbXBTdG9yYWdlLmdldEl0ZW0oY29udGV4dC5zcmZzZXNzaW9ua2V5ICsgJ19hdHRlbmRhbmNlbXJlcG9ydG14ZXMnKSwgJ3VuZGVmaW5lZCcpKSB7CiAgICAgICAgICAgICAgICAgIGF0dGVuZGFuY2VtcmVwb3J0bXhlc0RhdGEgPSBKU09OLnBhcnNlKHRoaXMudGVtcFN0b3JhZ2UuZ2V0SXRlbShjb250ZXh0LnNyZnNlc3Npb25rZXkgKyAnX2F0dGVuZGFuY2VtcmVwb3J0bXhlcycpKTsKCiAgICAgICAgICAgICAgICAgIGlmIChhdHRlbmRhbmNlbXJlcG9ydG14ZXNEYXRhICYmIGF0dGVuZGFuY2VtcmVwb3J0bXhlc0RhdGEubGVuZ3RoICYmIGF0dGVuZGFuY2VtcmVwb3J0bXhlc0RhdGEubGVuZ3RoID4gMCkgewogICAgICAgICAgICAgICAgICAgIGF0dGVuZGFuY2VtcmVwb3J0bXhlc0RhdGEuZm9yRWFjaChmdW5jdGlvbiAoaXRlbSkgewogICAgICAgICAgICAgICAgICAgICAgaWYgKGl0ZW0uc3JmZnJvbnR1ZikgewogICAgICAgICAgICAgICAgICAgICAgICBpZiAoT2JqZWN0LmlzKGl0ZW0uc3JmZnJvbnR1ZiwgIjAiKSkgewogICAgICAgICAgICAgICAgICAgICAgICAgIGl0ZW0uYXR0ZW5kYW5jZW1yZXBvcnRteGlkID0gbnVsbDsKICAgICAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICAgICAgZGVsZXRlIGl0ZW0uc3JmZnJvbnR1ZjsKICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIG1hc3RlckRhdGEuYXR0ZW5kYW5jZW1yZXBvcnRteGVzID0gYXR0ZW5kYW5jZW1yZXBvcnRteGVzRGF0YTsKICAgICAgICAgICAgICAgIHBpbXdvcmtoaXN0b3JpZXNEYXRhID0gW107CgogICAgICAgICAgICAgICAgaWYgKCFPYmplY3QuaXModGhpcy50ZW1wU3RvcmFnZS5nZXRJdGVtKGNvbnRleHQuc3Jmc2Vzc2lvbmtleSArICdfcGltd29ya2hpc3RvcmllcycpLCAndW5kZWZpbmVkJykpIHsKICAgICAgICAgICAgICAgICAgcGltd29ya2hpc3Rvcmllc0RhdGEgPSBKU09OLnBhcnNlKHRoaXMudGVtcFN0b3JhZ2UuZ2V0SXRlbShjb250ZXh0LnNyZnNlc3Npb25rZXkgKyAnX3BpbXdvcmtoaXN0b3JpZXMnKSk7CgogICAgICAgICAgICAgICAgICBpZiAocGltd29ya2hpc3Rvcmllc0RhdGEgJiYgcGltd29ya2hpc3Rvcmllc0RhdGEubGVuZ3RoICYmIHBpbXdvcmtoaXN0b3JpZXNEYXRhLmxlbmd0aCA+IDApIHsKICAgICAgICAgICAgICAgICAgICBwaW13b3JraGlzdG9yaWVzRGF0YS5mb3JFYWNoKGZ1bmN0aW9uIChpdGVtKSB7CiAgICAgICAgICAgICAgICAgICAgICBpZiAoaXRlbS5zcmZmcm9udHVmKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChPYmplY3QuaXMoaXRlbS5zcmZmcm9udHVmLCAiMCIpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgaXRlbS5waW13b3JraGlzdG9yeWlkID0gbnVsbDsKICAgICAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICAgICAgZGVsZXRlIGl0ZW0uc3JmZnJvbnR1ZjsKICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIG1hc3RlckRhdGEucGltd29ya2hpc3RvcmllcyA9IHBpbXdvcmtoaXN0b3JpZXNEYXRhOwogICAgICAgICAgICAgICAgT2JqZWN0LmFzc2lnbihkYXRhLCBtYXN0ZXJEYXRhKTsKICAgICAgICAgICAgICAgIF9jb250ZXh0OS5uZXh0ID0gNzM7CiAgICAgICAgICAgICAgICByZXR1cm4gSHR0cC5nZXRJbnN0YW5jZSgpLnBvc3QoIi9waW1wZW9wbGUvIi5jb25jYXQoY29udGV4dC5waW1wZXJzb24sICIvc2F2ZSIpLCBkYXRhLCBpc2xvYWRpbmcpOwoKICAgICAgICAgICAgICBjYXNlIDczOgogICAgICAgICAgICAgICAgcmVzID0gX2NvbnRleHQ5LnNlbnQ7CiAgICAgICAgICAgICAgICB0aGlzLnRlbXBTdG9yYWdlLnNldEl0ZW0oY29udGV4dC5zcmZzZXNzaW9ua2V5ICsgJ19waW1wZXJzb25hYmlsaXRpZXMnLCBKU09OLnN0cmluZ2lmeShyZXMuZGF0YS5waW1wZXJzb25hYmlsaXRpZXMpKTsKICAgICAgICAgICAgICAgIHRoaXMudGVtcFN0b3JhZ2Uuc2V0SXRlbShjb250ZXh0LnNyZnNlc3Npb25rZXkgKyAnX3BpbXBhcGVycycsIEpTT04uc3RyaW5naWZ5KHJlcy5kYXRhLnBpbXBhcGVycykpOwogICAgICAgICAgICAgICAgdGhpcy50ZW1wU3RvcmFnZS5zZXRJdGVtKGNvbnRleHQuc3Jmc2Vzc2lvbmtleSArICdfcGltZGlzdGlyYnV0aW9ucycsIEpTT04uc3RyaW5naWZ5KHJlcy5kYXRhLnBpbWRpc3RpcmJ1dGlvbnMpKTsKICAgICAgICAgICAgICAgIHRoaXMudGVtcFN0b3JhZ2Uuc2V0SXRlbShjb250ZXh0LnNyZnNlc3Npb25rZXkgKyAnX3BpbXRpdGxlcycsIEpTT04uc3RyaW5naWZ5KHJlcy5kYXRhLnBpbXRpdGxlcykpOwogICAgICAgICAgICAgICAgdGhpcy50ZW1wU3RvcmFnZS5zZXRJdGVtKGNvbnRleHQuc3Jmc2Vzc2lvbmtleSArICdfcGltdm9jYXRpb25hbHMnLCBKU09OLnN0cmluZ2lmeShyZXMuZGF0YS5waW12b2NhdGlvbmFscykpOwogICAgICAgICAgICAgICAgdGhpcy50ZW1wU3RvcmFnZS5zZXRJdGVtKGNvbnRleHQuc3Jmc2Vzc2lvbmtleSArICdfcGltYXJteWNhZHJlcycsIEpTT04uc3RyaW5naWZ5KHJlcy5kYXRhLnBpbWFybXljYWRyZXMpKTsKICAgICAgICAgICAgICAgIHRoaXMudGVtcFN0b3JhZ2Uuc2V0SXRlbShjb250ZXh0LnNyZnNlc3Npb25rZXkgKyAnX3BpbWNvcnJlY3Rpb25hcHBsaWVzJywgSlNPTi5zdHJpbmdpZnkocmVzLmRhdGEucGltY29ycmVjdGlvbmFwcGxpZXMpKTsKICAgICAgICAgICAgICAgIHRoaXMudGVtcFN0b3JhZ2Uuc2V0SXRlbShjb250ZXh0LnNyZnNlc3Npb25rZXkgKyAnX3BpbXZhY2F0aW9ucycsIEpTT04uc3RyaW5naWZ5KHJlcy5kYXRhLnBpbXZhY2F0aW9ucykpOwogICAgICAgICAgICAgICAgdGhpcy50ZW1wU3RvcmFnZS5zZXRJdGVtKGNvbnRleHQuc3Jmc2Vzc2lvbmtleSArICdfdHJtdHJhaW5wZW9wbGUnLCBKU09OLnN0cmluZ2lmeShyZXMuZGF0YS50cm10cmFpbnBlb3BsZSkpOwogICAgICAgICAgICAgICAgdGhpcy50ZW1wU3RvcmFnZS5zZXRJdGVtKGNvbnRleHQuc3Jmc2Vzc2lvbmtleSArICdfcGltY29udHJhY3RzJywgSlNPTi5zdHJpbmdpZnkocmVzLmRhdGEucGltY29udHJhY3RzKSk7CiAgICAgICAgICAgICAgICB0aGlzLnRlbXBTdG9yYWdlLnNldEl0ZW0oY29udGV4dC5zcmZzZXNzaW9ua2V5ICsgJ19waW1lZHVjYXRpb25zJywgSlNPTi5zdHJpbmdpZnkocmVzLmRhdGEucGltZWR1Y2F0aW9ucykpOwogICAgICAgICAgICAgICAgdGhpcy50ZW1wU3RvcmFnZS5zZXRJdGVtKGNvbnRleHQuc3Jmc2Vzc2lvbmtleSArICdfcGltcGVyc29uY2hhbmdlcycsIEpTT04uc3RyaW5naWZ5KHJlcy5kYXRhLnBpbXBlcnNvbmNoYW5nZXMpKTsKICAgICAgICAgICAgICAgIHRoaXMudGVtcFN0b3JhZ2Uuc2V0SXRlbShjb250ZXh0LnNyZnNlc3Npb25rZXkgKyAnX3BpbWFjaGlldmVtZW50cycsIEpTT04uc3RyaW5naWZ5KHJlcy5kYXRhLnBpbWFjaGlldmVtZW50cykpOwogICAgICAgICAgICAgICAgdGhpcy50ZW1wU3RvcmFnZS5zZXRJdGVtKGNvbnRleHQuc3Jmc2Vzc2lvbmtleSArICdfcGltcmVzZWFyY2hmaW5kaW5ncycsIEpTT04uc3RyaW5naWZ5KHJlcy5kYXRhLnBpbXJlc2VhcmNoZmluZGluZ3MpKTsKICAgICAgICAgICAgICAgIHRoaXMudGVtcFN0b3JhZ2Uuc2V0SXRlbShjb250ZXh0LnNyZnNlc3Npb25rZXkgKyAnX3BpbWV4aXRhbmRlbnRyaWVzJywgSlNPTi5zdHJpbmdpZnkocmVzLmRhdGEucGltZXhpdGFuZGVudHJpZXMpKTsKICAgICAgICAgICAgICAgIHRoaXMudGVtcFN0b3JhZ2Uuc2V0SXRlbShjb250ZXh0LnNyZnNlc3Npb25rZXkgKyAnX3BpbXJld2FyZHB1bmlzaG1lbnRzJywgSlNPTi5zdHJpbmdpZnkocmVzLmRhdGEucGltcmV3YXJkcHVuaXNobWVudHMpKTsKICAgICAgICAgICAgICAgIHRoaXMudGVtcFN0b3JhZ2Uuc2V0SXRlbShjb250ZXh0LnNyZnNlc3Npb25rZXkgKyAnX3BpbXBhdGVudHMnLCBKU09OLnN0cmluZ2lmeShyZXMuZGF0YS5waW1wYXRlbnRzKSk7CiAgICAgICAgICAgICAgICB0aGlzLnRlbXBTdG9yYWdlLnNldEl0ZW0oY29udGV4dC5zcmZzZXNzaW9ua2V5ICsgJ19waW1sYW5ndWFnZWFiaWxpdGllcycsIEpTT04uc3RyaW5naWZ5KHJlcy5kYXRhLnBpbWxhbmd1YWdlYWJpbGl0aWVzKSk7CiAgICAgICAgICAgICAgICB0aGlzLnRlbXBTdG9yYWdlLnNldEl0ZW0oY29udGV4dC5zcmZzZXNzaW9ua2V5ICsgJ19waW1hcmNoaXZlcycsIEpTT04uc3RyaW5naWZ5KHJlcy5kYXRhLnBpbWFyY2hpdmVzKSk7CiAgICAgICAgICAgICAgICB0aGlzLnRlbXBTdG9yYWdlLnNldEl0ZW0oY29udGV4dC5zcmZzZXNzaW9ua2V5ICsgJ19waW1mYW1pbmZvcycsIEpTT04uc3RyaW5naWZ5KHJlcy5kYXRhLnBpbWZhbWluZm9zKSk7CiAgICAgICAgICAgICAgICB0aGlzLnRlbXBTdG9yYWdlLnNldEl0ZW0oY29udGV4dC5zcmZzZXNzaW9ua2V5ICsgJ19hdHRlbmRhbmNlbXJlcG9ydG14ZXMnLCBKU09OLnN0cmluZ2lmeShyZXMuZGF0YS5hdHRlbmRhbmNlbXJlcG9ydG14ZXMpKTsKICAgICAgICAgICAgICAgIHRoaXMudGVtcFN0b3JhZ2Uuc2V0SXRlbShjb250ZXh0LnNyZnNlc3Npb25rZXkgKyAnX3BpbXdvcmtoaXN0b3JpZXMnLCBKU09OLnN0cmluZ2lmeShyZXMuZGF0YS5waW13b3JraGlzdG9yaWVzKSk7CiAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQ5LmFicnVwdCgicmV0dXJuIiwgcmVzKTsKCiAgICAgICAgICAgICAgY2FzZSA5NzoKICAgICAgICAgICAgICBjYXNlICJlbmQiOgogICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0OS5zdG9wKCk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9LCBfY2FsbGVlOSwgdGhpcyk7CiAgICAgIH0pKTsKCiAgICAgIGZ1bmN0aW9uIFNhdmUoKSB7CiAgICAgICAgcmV0dXJuIF9TYXZlLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7CiAgICAgIH0KCiAgICAgIHJldHVybiBTYXZlOwogICAgfSgpCiAgICAvKioNCiAgICAgKiBHZXRKVExYUkRI5o6l5Y+j5pa55rOVDQogICAgICoNCiAgICAgKiBAcGFyYW0geyp9IFtjb250ZXh0PXt9XQ0KICAgICAqIEBwYXJhbSB7Kn0gW2RhdGE9e31dDQogICAgICogQHBhcmFtIHtib29sZWFufSBbaXNsb2FkaW5nXQ0KICAgICAqIEByZXR1cm5zIHtQcm9taXNlPGFueT59DQogICAgICogQG1lbWJlcm9mIFBpbVBlcnNvblNlcnZpY2VCYXNlDQogICAgICovCgogIH0sIHsKICAgIGtleTogIkdldEpUTFhSREgiLAogICAgdmFsdWU6IGZ1bmN0aW9uICgpIHsKICAgICAgdmFyIF9HZXRKVExYUkRIID0gX2FzeW5jVG9HZW5lcmF0b3IoCiAgICAgIC8qI19fUFVSRV9fKi8KICAgICAgcmVnZW5lcmF0b3JSdW50aW1lLm1hcmsoZnVuY3Rpb24gX2NhbGxlZTEwKCkgewogICAgICAgIHZhciBjb250ZXh0LAogICAgICAgICAgICBkYXRhLAogICAgICAgICAgICBpc2xvYWRpbmcsCiAgICAgICAgICAgIGFwcExvZ2ljLAogICAgICAgICAgICByZXN1bHQsCiAgICAgICAgICAgIF9hcmdzMTAgPSBhcmd1bWVudHM7CiAgICAgICAgcmV0dXJuIHJlZ2VuZXJhdG9yUnVudGltZS53cmFwKGZ1bmN0aW9uIF9jYWxsZWUxMCQoX2NvbnRleHQxMCkgewogICAgICAgICAgd2hpbGUgKDEpIHsKICAgICAgICAgICAgc3dpdGNoIChfY29udGV4dDEwLnByZXYgPSBfY29udGV4dDEwLm5leHQpIHsKICAgICAgICAgICAgICBjYXNlIDA6CiAgICAgICAgICAgICAgICBjb250ZXh0ID0gX2FyZ3MxMC5sZW5ndGggPiAwICYmIF9hcmdzMTBbMF0gIT09IHVuZGVmaW5lZCA/IF9hcmdzMTBbMF0gOiB7fTsKICAgICAgICAgICAgICAgIGRhdGEgPSBfYXJnczEwLmxlbmd0aCA+IDEgJiYgX2FyZ3MxMFsxXSAhPT0gdW5kZWZpbmVkID8gX2FyZ3MxMFsxXSA6IHt9OwogICAgICAgICAgICAgICAgaXNsb2FkaW5nID0gX2FyZ3MxMC5sZW5ndGggPiAyID8gX2FyZ3MxMFsyXSA6IHVuZGVmaW5lZDsKICAgICAgICAgICAgICAgIGFwcExvZ2ljID0gbmV3IEdldEpUTFhSREhMb2dpYyh7CiAgICAgICAgICAgICAgICAgIGNvbnRleHQ6IEpTT04ucGFyc2UoSlNPTi5zdHJpbmdpZnkoY29udGV4dCkpLAogICAgICAgICAgICAgICAgICBkYXRhOiBKU09OLnBhcnNlKEpTT04uc3RyaW5naWZ5KGRhdGEpKQogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICBfY29udGV4dDEwLm5leHQgPSA2OwogICAgICAgICAgICAgICAgcmV0dXJuIGFwcExvZ2ljLm9uRXhlY3V0ZShjb250ZXh0LCBkYXRhLCBpc2xvYWRpbmcgPyB0cnVlIDogZmFsc2UpOwoKICAgICAgICAgICAgICBjYXNlIDY6CiAgICAgICAgICAgICAgICByZXN1bHQgPSBfY29udGV4dDEwLnNlbnQ7CiAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQxMC5hYnJ1cHQoInJldHVybiIsIHsKICAgICAgICAgICAgICAgICAgc3RhdHVzOiAyMDAsCiAgICAgICAgICAgICAgICAgIGRhdGE6IHJlc3VsdAogICAgICAgICAgICAgICAgfSk7CgogICAgICAgICAgICAgIGNhc2UgODoKICAgICAgICAgICAgICBjYXNlICJlbmQiOgogICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0MTAuc3RvcCgpOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSwgX2NhbGxlZTEwKTsKICAgICAgfSkpOwoKICAgICAgZnVuY3Rpb24gR2V0SlRMWFJESCgpIHsKICAgICAgICByZXR1cm4gX0dldEpUTFhSREguYXBwbHkodGhpcywgYXJndW1lbnRzKTsKICAgICAgfQoKICAgICAgcmV0dXJuIEdldEpUTFhSREg7CiAgICB9KCkKICAgIC8qKg0KICAgICAqIFN5blBlcnNvbuaOpeWPo+aWueazlQ0KICAgICAqDQogICAgICogQHBhcmFtIHsqfSBbY29udGV4dD17fV0NCiAgICAgKiBAcGFyYW0geyp9IFtkYXRhPXt9XQ0KICAgICAqIEBwYXJhbSB7Ym9vbGVhbn0gW2lzbG9hZGluZ10NCiAgICAgKiBAcmV0dXJucyB7UHJvbWlzZTxhbnk+fQ0KICAgICAqIEBtZW1iZXJvZiBQaW1QZXJzb25TZXJ2aWNlQmFzZQ0KICAgICAqLwoKICB9LCB7CiAgICBrZXk6ICJTeW5QZXJzb24iLAogICAgdmFsdWU6IGZ1bmN0aW9uICgpIHsKICAgICAgdmFyIF9TeW5QZXJzb24gPSBfYXN5bmNUb0dlbmVyYXRvcigKICAgICAgLyojX19QVVJFX18qLwogICAgICByZWdlbmVyYXRvclJ1bnRpbWUubWFyayhmdW5jdGlvbiBfY2FsbGVlMTEoKSB7CiAgICAgICAgdmFyIGNvbnRleHQsCiAgICAgICAgICAgIGRhdGEsCiAgICAgICAgICAgIGlzbG9hZGluZywKICAgICAgICAgICAgX2FyZ3MxMSA9IGFyZ3VtZW50czsKICAgICAgICByZXR1cm4gcmVnZW5lcmF0b3JSdW50aW1lLndyYXAoZnVuY3Rpb24gX2NhbGxlZTExJChfY29udGV4dDExKSB7CiAgICAgICAgICB3aGlsZSAoMSkgewogICAgICAgICAgICBzd2l0Y2ggKF9jb250ZXh0MTEucHJldiA9IF9jb250ZXh0MTEubmV4dCkgewogICAgICAgICAgICAgIGNhc2UgMDoKICAgICAgICAgICAgICAgIGNvbnRleHQgPSBfYXJnczExLmxlbmd0aCA+IDAgJiYgX2FyZ3MxMVswXSAhPT0gdW5kZWZpbmVkID8gX2FyZ3MxMVswXSA6IHt9OwogICAgICAgICAgICAgICAgZGF0YSA9IF9hcmdzMTEubGVuZ3RoID4gMSAmJiBfYXJnczExWzFdICE9PSB1bmRlZmluZWQgPyBfYXJnczExWzFdIDoge307CiAgICAgICAgICAgICAgICBpc2xvYWRpbmcgPSBfYXJnczExLmxlbmd0aCA+IDIgPyBfYXJnczExWzJdIDogdW5kZWZpbmVkOwogICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0MTEuYWJydXB0KCJyZXR1cm4iLCBIdHRwLmdldEluc3RhbmNlKCkucG9zdCgiL3BpbXBlb3BsZS8iLmNvbmNhdChjb250ZXh0LnBpbXBlcnNvbiwgIi9zeW5wZXJzb24iKSwgZGF0YSwgaXNsb2FkaW5nKSk7CgogICAgICAgICAgICAgIGNhc2UgNDoKICAgICAgICAgICAgICBjYXNlICJlbmQiOgogICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0MTEuc3RvcCgpOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSwgX2NhbGxlZTExKTsKICAgICAgfSkpOwoKICAgICAgZnVuY3Rpb24gU3luUGVyc29uKCkgewogICAgICAgIHJldHVybiBfU3luUGVyc29uLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7CiAgICAgIH0KCiAgICAgIHJldHVybiBTeW5QZXJzb247CiAgICB9KCkKICAgIC8qKg0KICAgICAqIFJlbW92ZeaOpeWPo+aWueazlQ0KICAgICAqDQogICAgICogQHBhcmFtIHsqfSBbY29udGV4dD17fV0NCiAgICAgKiBAcGFyYW0geyp9IFtkYXRhPXt9XQ0KICAgICAqIEBwYXJhbSB7Ym9vbGVhbn0gW2lzbG9hZGluZ10NCiAgICAgKiBAcmV0dXJucyB7UHJvbWlzZTxhbnk+fQ0KICAgICAqIEBtZW1iZXJvZiBQaW1QZXJzb25TZXJ2aWNlQmFzZQ0KICAgICAqLwoKICB9LCB7CiAgICBrZXk6ICJSZW1vdmUiLAogICAgdmFsdWU6IGZ1bmN0aW9uICgpIHsKICAgICAgdmFyIF9SZW1vdmUgPSBfYXN5bmNUb0dlbmVyYXRvcigKICAgICAgLyojX19QVVJFX18qLwogICAgICByZWdlbmVyYXRvclJ1bnRpbWUubWFyayhmdW5jdGlvbiBfY2FsbGVlMTIoKSB7CiAgICAgICAgdmFyIGNvbnRleHQsCiAgICAgICAgICAgIGRhdGEsCiAgICAgICAgICAgIGlzbG9hZGluZywKICAgICAgICAgICAgX2FyZ3MxMiA9IGFyZ3VtZW50czsKICAgICAgICByZXR1cm4gcmVnZW5lcmF0b3JSdW50aW1lLndyYXAoZnVuY3Rpb24gX2NhbGxlZTEyJChfY29udGV4dDEyKSB7CiAgICAgICAgICB3aGlsZSAoMSkgewogICAgICAgICAgICBzd2l0Y2ggKF9jb250ZXh0MTIucHJldiA9IF9jb250ZXh0MTIubmV4dCkgewogICAgICAgICAgICAgIGNhc2UgMDoKICAgICAgICAgICAgICAgIGNvbnRleHQgPSBfYXJnczEyLmxlbmd0aCA+IDAgJiYgX2FyZ3MxMlswXSAhPT0gdW5kZWZpbmVkID8gX2FyZ3MxMlswXSA6IHt9OwogICAgICAgICAgICAgICAgZGF0YSA9IF9hcmdzMTIubGVuZ3RoID4gMSAmJiBfYXJnczEyWzFdICE9PSB1bmRlZmluZWQgPyBfYXJnczEyWzFdIDoge307CiAgICAgICAgICAgICAgICBpc2xvYWRpbmcgPSBfYXJnczEyLmxlbmd0aCA+IDIgPyBfYXJnczEyWzJdIDogdW5kZWZpbmVkOwogICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0MTIuYWJydXB0KCJyZXR1cm4iLCBIdHRwLmdldEluc3RhbmNlKClbImRlbGV0ZSJdKCIvcGltcGVvcGxlLyIuY29uY2F0KGNvbnRleHQucGltcGVyc29uKSwgaXNsb2FkaW5nKSk7CgogICAgICAgICAgICAgIGNhc2UgNDoKICAgICAgICAgICAgICBjYXNlICJlbmQiOgogICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0MTIuc3RvcCgpOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSwgX2NhbGxlZTEyKTsKICAgICAgfSkpOwoKICAgICAgZnVuY3Rpb24gUmVtb3ZlKCkgewogICAgICAgIHJldHVybiBfUmVtb3ZlLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7CiAgICAgIH0KCiAgICAgIHJldHVybiBSZW1vdmU7CiAgICB9KCkKICAgIC8qKg0KICAgICAqIENoZWNrS2V55o6l5Y+j5pa55rOVDQogICAgICoNCiAgICAgKiBAcGFyYW0geyp9IFtjb250ZXh0PXt9XQ0KICAgICAqIEBwYXJhbSB7Kn0gW2RhdGE9e31dDQogICAgICogQHBhcmFtIHtib29sZWFufSBbaXNsb2FkaW5nXQ0KICAgICAqIEByZXR1cm5zIHtQcm9taXNlPGFueT59DQogICAgICogQG1lbWJlcm9mIFBpbVBlcnNvblNlcnZpY2VCYXNlDQogICAgICovCgogIH0sIHsKICAgIGtleTogIkNoZWNrS2V5IiwKICAgIHZhbHVlOiBmdW5jdGlvbiAoKSB7CiAgICAgIHZhciBfQ2hlY2tLZXkgPSBfYXN5bmNUb0dlbmVyYXRvcigKICAgICAgLyojX19QVVJFX18qLwogICAgICByZWdlbmVyYXRvclJ1bnRpbWUubWFyayhmdW5jdGlvbiBfY2FsbGVlMTMoKSB7CiAgICAgICAgdmFyIGNvbnRleHQsCiAgICAgICAgICAgIGRhdGEsCiAgICAgICAgICAgIGlzbG9hZGluZywKICAgICAgICAgICAgX2FyZ3MxMyA9IGFyZ3VtZW50czsKICAgICAgICByZXR1cm4gcmVnZW5lcmF0b3JSdW50aW1lLndyYXAoZnVuY3Rpb24gX2NhbGxlZTEzJChfY29udGV4dDEzKSB7CiAgICAgICAgICB3aGlsZSAoMSkgewogICAgICAgICAgICBzd2l0Y2ggKF9jb250ZXh0MTMucHJldiA9IF9jb250ZXh0MTMubmV4dCkgewogICAgICAgICAgICAgIGNhc2UgMDoKICAgICAgICAgICAgICAgIGNvbnRleHQgPSBfYXJnczEzLmxlbmd0aCA+IDAgJiYgX2FyZ3MxM1swXSAhPT0gdW5kZWZpbmVkID8gX2FyZ3MxM1swXSA6IHt9OwogICAgICAgICAgICAgICAgZGF0YSA9IF9hcmdzMTMubGVuZ3RoID4gMSAmJiBfYXJnczEzWzFdICE9PSB1bmRlZmluZWQgPyBfYXJnczEzWzFdIDoge307CiAgICAgICAgICAgICAgICBpc2xvYWRpbmcgPSBfYXJnczEzLmxlbmd0aCA+IDIgPyBfYXJnczEzWzJdIDogdW5kZWZpbmVkOwogICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0MTMuYWJydXB0KCJyZXR1cm4iLCBIdHRwLmdldEluc3RhbmNlKCkucG9zdCgiL3BpbXBlb3BsZS8iLmNvbmNhdChjb250ZXh0LnBpbXBlcnNvbiwgIi9jaGVja2tleSIpLCBkYXRhLCBpc2xvYWRpbmcpKTsKCiAgICAgICAgICAgICAgY2FzZSA0OgogICAgICAgICAgICAgIGNhc2UgImVuZCI6CiAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQxMy5zdG9wKCk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9LCBfY2FsbGVlMTMpOwogICAgICB9KSk7CgogICAgICBmdW5jdGlvbiBDaGVja0tleSgpIHsKICAgICAgICByZXR1cm4gX0NoZWNrS2V5LmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7CiAgICAgIH0KCiAgICAgIHJldHVybiBDaGVja0tleTsKICAgIH0oKQogICAgLyoqDQogICAgICogUVJUWOaOpeWPo+aWueazlQ0KICAgICAqDQogICAgICogQHBhcmFtIHsqfSBbY29udGV4dD17fV0NCiAgICAgKiBAcGFyYW0geyp9IFtkYXRhPXt9XQ0KICAgICAqIEBwYXJhbSB7Ym9vbGVhbn0gW2lzbG9hZGluZ10NCiAgICAgKiBAcmV0dXJucyB7UHJvbWlzZTxhbnk+fQ0KICAgICAqIEBtZW1iZXJvZiBQaW1QZXJzb25TZXJ2aWNlQmFzZQ0KICAgICAqLwoKICB9LCB7CiAgICBrZXk6ICJRUlRYIiwKICAgIHZhbHVlOiBmdW5jdGlvbiAoKSB7CiAgICAgIHZhciBfUVJUWCA9IF9hc3luY1RvR2VuZXJhdG9yKAogICAgICAvKiNfX1BVUkVfXyovCiAgICAgIHJlZ2VuZXJhdG9yUnVudGltZS5tYXJrKGZ1bmN0aW9uIF9jYWxsZWUxNCgpIHsKICAgICAgICB2YXIgY29udGV4dCwKICAgICAgICAgICAgZGF0YSwKICAgICAgICAgICAgaXNsb2FkaW5nLAogICAgICAgICAgICBfYXJnczE0ID0gYXJndW1lbnRzOwogICAgICAgIHJldHVybiByZWdlbmVyYXRvclJ1bnRpbWUud3JhcChmdW5jdGlvbiBfY2FsbGVlMTQkKF9jb250ZXh0MTQpIHsKICAgICAgICAgIHdoaWxlICgxKSB7CiAgICAgICAgICAgIHN3aXRjaCAoX2NvbnRleHQxNC5wcmV2ID0gX2NvbnRleHQxNC5uZXh0KSB7CiAgICAgICAgICAgICAgY2FzZSAwOgogICAgICAgICAgICAgICAgY29udGV4dCA9IF9hcmdzMTQubGVuZ3RoID4gMCAmJiBfYXJnczE0WzBdICE9PSB1bmRlZmluZWQgPyBfYXJnczE0WzBdIDoge307CiAgICAgICAgICAgICAgICBkYXRhID0gX2FyZ3MxNC5sZW5ndGggPiAxICYmIF9hcmdzMTRbMV0gIT09IHVuZGVmaW5lZCA/IF9hcmdzMTRbMV0gOiB7fTsKICAgICAgICAgICAgICAgIGlzbG9hZGluZyA9IF9hcmdzMTQubGVuZ3RoID4gMiA/IF9hcmdzMTRbMl0gOiB1bmRlZmluZWQ7CiAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQxNC5hYnJ1cHQoInJldHVybiIsIEh0dHAuZ2V0SW5zdGFuY2UoKS5wb3N0KCIvcGltcGVvcGxlLyIuY29uY2F0KGNvbnRleHQucGltcGVyc29uLCAiL3FydHgiKSwgZGF0YSwgaXNsb2FkaW5nKSk7CgogICAgICAgICAgICAgIGNhc2UgNDoKICAgICAgICAgICAgICBjYXNlICJlbmQiOgogICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0MTQuc3RvcCgpOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSwgX2NhbGxlZTE0KTsKICAgICAgfSkpOwoKICAgICAgZnVuY3Rpb24gUVJUWCgpIHsKICAgICAgICByZXR1cm4gX1FSVFguYXBwbHkodGhpcywgYXJndW1lbnRzKTsKICAgICAgfQoKICAgICAgcmV0dXJuIFFSVFg7CiAgICB9KCkKICAgIC8qKg0KICAgICAqIEdldERyYWZ05o6l5Y+j5pa55rOVDQogICAgICoNCiAgICAgKiBAcGFyYW0geyp9IFtjb250ZXh0PXt9XQ0KICAgICAqIEBwYXJhbSB7Kn0gW2RhdGE9e31dDQogICAgICogQHBhcmFtIHtib29sZWFufSBbaXNsb2FkaW5nXQ0KICAgICAqIEByZXR1cm5zIHtQcm9taXNlPGFueT59DQogICAgICogQG1lbWJlcm9mIFBpbVBlcnNvblNlcnZpY2VCYXNlDQogICAgICovCgogIH0sIHsKICAgIGtleTogIkdldERyYWZ0IiwKICAgIHZhbHVlOiBmdW5jdGlvbiAoKSB7CiAgICAgIHZhciBfR2V0RHJhZnQgPSBfYXN5bmNUb0dlbmVyYXRvcigKICAgICAgLyojX19QVVJFX18qLwogICAgICByZWdlbmVyYXRvclJ1bnRpbWUubWFyayhmdW5jdGlvbiBfY2FsbGVlMTUoKSB7CiAgICAgICAgdmFyIGNvbnRleHQsCiAgICAgICAgICAgIGRhdGEsCiAgICAgICAgICAgIGlzbG9hZGluZywKICAgICAgICAgICAgcmVzLAogICAgICAgICAgICBfYXJnczE1ID0gYXJndW1lbnRzOwogICAgICAgIHJldHVybiByZWdlbmVyYXRvclJ1bnRpbWUud3JhcChmdW5jdGlvbiBfY2FsbGVlMTUkKF9jb250ZXh0MTUpIHsKICAgICAgICAgIHdoaWxlICgxKSB7CiAgICAgICAgICAgIHN3aXRjaCAoX2NvbnRleHQxNS5wcmV2ID0gX2NvbnRleHQxNS5uZXh0KSB7CiAgICAgICAgICAgICAgY2FzZSAwOgogICAgICAgICAgICAgICAgY29udGV4dCA9IF9hcmdzMTUubGVuZ3RoID4gMCAmJiBfYXJnczE1WzBdICE9PSB1bmRlZmluZWQgPyBfYXJnczE1WzBdIDoge307CiAgICAgICAgICAgICAgICBkYXRhID0gX2FyZ3MxNS5sZW5ndGggPiAxICYmIF9hcmdzMTVbMV0gIT09IHVuZGVmaW5lZCA/IF9hcmdzMTVbMV0gOiB7fTsKICAgICAgICAgICAgICAgIGlzbG9hZGluZyA9IF9hcmdzMTUubGVuZ3RoID4gMiA/IF9hcmdzMTVbMl0gOiB1bmRlZmluZWQ7CiAgICAgICAgICAgICAgICBfY29udGV4dDE1Lm5leHQgPSA1OwogICAgICAgICAgICAgICAgcmV0dXJuIEh0dHAuZ2V0SW5zdGFuY2UoKS5nZXQoIi9waW1wZW9wbGUvZ2V0ZHJhZnQiLCBpc2xvYWRpbmcpOwoKICAgICAgICAgICAgICBjYXNlIDU6CiAgICAgICAgICAgICAgICByZXMgPSBfY29udGV4dDE1LnNlbnQ7CiAgICAgICAgICAgICAgICByZXMuZGF0YS5waW1wZXJzb24gPSBkYXRhLnBpbXBlcnNvbjsKICAgICAgICAgICAgICAgIHRoaXMudGVtcFN0b3JhZ2Uuc2V0SXRlbShjb250ZXh0LnNyZnNlc3Npb25rZXkgKyAnX3BpbXBlcnNvbmFiaWxpdGllcycsIEpTT04uc3RyaW5naWZ5KHJlcy5kYXRhLnBpbXBlcnNvbmFiaWxpdGllcykpOwogICAgICAgICAgICAgICAgdGhpcy50ZW1wU3RvcmFnZS5zZXRJdGVtKGNvbnRleHQuc3Jmc2Vzc2lvbmtleSArICdfcGltcGFwZXJzJywgSlNPTi5zdHJpbmdpZnkocmVzLmRhdGEucGltcGFwZXJzKSk7CiAgICAgICAgICAgICAgICB0aGlzLnRlbXBTdG9yYWdlLnNldEl0ZW0oY29udGV4dC5zcmZzZXNzaW9ua2V5ICsgJ19waW1kaXN0aXJidXRpb25zJywgSlNPTi5zdHJpbmdpZnkocmVzLmRhdGEucGltZGlzdGlyYnV0aW9ucykpOwogICAgICAgICAgICAgICAgdGhpcy50ZW1wU3RvcmFnZS5zZXRJdGVtKGNvbnRleHQuc3Jmc2Vzc2lvbmtleSArICdfcGltdGl0bGVzJywgSlNPTi5zdHJpbmdpZnkocmVzLmRhdGEucGltdGl0bGVzKSk7CiAgICAgICAgICAgICAgICB0aGlzLnRlbXBTdG9yYWdlLnNldEl0ZW0oY29udGV4dC5zcmZzZXNzaW9ua2V5ICsgJ19waW12b2NhdGlvbmFscycsIEpTT04uc3RyaW5naWZ5KHJlcy5kYXRhLnBpbXZvY2F0aW9uYWxzKSk7CiAgICAgICAgICAgICAgICB0aGlzLnRlbXBTdG9yYWdlLnNldEl0ZW0oY29udGV4dC5zcmZzZXNzaW9ua2V5ICsgJ19waW1hcm15Y2FkcmVzJywgSlNPTi5zdHJpbmdpZnkocmVzLmRhdGEucGltYXJteWNhZHJlcykpOwogICAgICAgICAgICAgICAgdGhpcy50ZW1wU3RvcmFnZS5zZXRJdGVtKGNvbnRleHQuc3Jmc2Vzc2lvbmtleSArICdfcGltY29ycmVjdGlvbmFwcGxpZXMnLCBKU09OLnN0cmluZ2lmeShyZXMuZGF0YS5waW1jb3JyZWN0aW9uYXBwbGllcykpOwogICAgICAgICAgICAgICAgdGhpcy50ZW1wU3RvcmFnZS5zZXRJdGVtKGNvbnRleHQuc3Jmc2Vzc2lvbmtleSArICdfcGltdmFjYXRpb25zJywgSlNPTi5zdHJpbmdpZnkocmVzLmRhdGEucGltdmFjYXRpb25zKSk7CiAgICAgICAgICAgICAgICB0aGlzLnRlbXBTdG9yYWdlLnNldEl0ZW0oY29udGV4dC5zcmZzZXNzaW9ua2V5ICsgJ190cm10cmFpbnBlb3BsZScsIEpTT04uc3RyaW5naWZ5KHJlcy5kYXRhLnRybXRyYWlucGVvcGxlKSk7CiAgICAgICAgICAgICAgICB0aGlzLnRlbXBTdG9yYWdlLnNldEl0ZW0oY29udGV4dC5zcmZzZXNzaW9ua2V5ICsgJ19waW1jb250cmFjdHMnLCBKU09OLnN0cmluZ2lmeShyZXMuZGF0YS5waW1jb250cmFjdHMpKTsKICAgICAgICAgICAgICAgIHRoaXMudGVtcFN0b3JhZ2Uuc2V0SXRlbShjb250ZXh0LnNyZnNlc3Npb25rZXkgKyAnX3BpbWVkdWNhdGlvbnMnLCBKU09OLnN0cmluZ2lmeShyZXMuZGF0YS5waW1lZHVjYXRpb25zKSk7CiAgICAgICAgICAgICAgICB0aGlzLnRlbXBTdG9yYWdlLnNldEl0ZW0oY29udGV4dC5zcmZzZXNzaW9ua2V5ICsgJ19waW1wZXJzb25jaGFuZ2VzJywgSlNPTi5zdHJpbmdpZnkocmVzLmRhdGEucGltcGVyc29uY2hhbmdlcykpOwogICAgICAgICAgICAgICAgdGhpcy50ZW1wU3RvcmFnZS5zZXRJdGVtKGNvbnRleHQuc3Jmc2Vzc2lvbmtleSArICdfcGltYWNoaWV2ZW1lbnRzJywgSlNPTi5zdHJpbmdpZnkocmVzLmRhdGEucGltYWNoaWV2ZW1lbnRzKSk7CiAgICAgICAgICAgICAgICB0aGlzLnRlbXBTdG9yYWdlLnNldEl0ZW0oY29udGV4dC5zcmZzZXNzaW9ua2V5ICsgJ19waW1yZXNlYXJjaGZpbmRpbmdzJywgSlNPTi5zdHJpbmdpZnkocmVzLmRhdGEucGltcmVzZWFyY2hmaW5kaW5ncykpOwogICAgICAgICAgICAgICAgdGhpcy50ZW1wU3RvcmFnZS5zZXRJdGVtKGNvbnRleHQuc3Jmc2Vzc2lvbmtleSArICdfcGltZXhpdGFuZGVudHJpZXMnLCBKU09OLnN0cmluZ2lmeShyZXMuZGF0YS5waW1leGl0YW5kZW50cmllcykpOwogICAgICAgICAgICAgICAgdGhpcy50ZW1wU3RvcmFnZS5zZXRJdGVtKGNvbnRleHQuc3Jmc2Vzc2lvbmtleSArICdfcGltcmV3YXJkcHVuaXNobWVudHMnLCBKU09OLnN0cmluZ2lmeShyZXMuZGF0YS5waW1yZXdhcmRwdW5pc2htZW50cykpOwogICAgICAgICAgICAgICAgdGhpcy50ZW1wU3RvcmFnZS5zZXRJdGVtKGNvbnRleHQuc3Jmc2Vzc2lvbmtleSArICdfcGltcGF0ZW50cycsIEpTT04uc3RyaW5naWZ5KHJlcy5kYXRhLnBpbXBhdGVudHMpKTsKICAgICAgICAgICAgICAgIHRoaXMudGVtcFN0b3JhZ2Uuc2V0SXRlbShjb250ZXh0LnNyZnNlc3Npb25rZXkgKyAnX3BpbWxhbmd1YWdlYWJpbGl0aWVzJywgSlNPTi5zdHJpbmdpZnkocmVzLmRhdGEucGltbGFuZ3VhZ2VhYmlsaXRpZXMpKTsKICAgICAgICAgICAgICAgIHRoaXMudGVtcFN0b3JhZ2Uuc2V0SXRlbShjb250ZXh0LnNyZnNlc3Npb25rZXkgKyAnX3BpbWFyY2hpdmVzJywgSlNPTi5zdHJpbmdpZnkocmVzLmRhdGEucGltYXJjaGl2ZXMpKTsKICAgICAgICAgICAgICAgIHRoaXMudGVtcFN0b3JhZ2Uuc2V0SXRlbShjb250ZXh0LnNyZnNlc3Npb25rZXkgKyAnX3BpbWZhbWluZm9zJywgSlNPTi5zdHJpbmdpZnkocmVzLmRhdGEucGltZmFtaW5mb3MpKTsKICAgICAgICAgICAgICAgIHRoaXMudGVtcFN0b3JhZ2Uuc2V0SXRlbShjb250ZXh0LnNyZnNlc3Npb25rZXkgKyAnX2F0dGVuZGFuY2VtcmVwb3J0bXhlcycsIEpTT04uc3RyaW5naWZ5KHJlcy5kYXRhLmF0dGVuZGFuY2VtcmVwb3J0bXhlcykpOwogICAgICAgICAgICAgICAgdGhpcy50ZW1wU3RvcmFnZS5zZXRJdGVtKGNvbnRleHQuc3Jmc2Vzc2lvbmtleSArICdfcGltd29ya2hpc3RvcmllcycsIEpTT04uc3RyaW5naWZ5KHJlcy5kYXRhLnBpbXdvcmtoaXN0b3JpZXMpKTsKICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDE1LmFicnVwdCgicmV0dXJuIiwgcmVzKTsKCiAgICAgICAgICAgICAgY2FzZSAzMDoKICAgICAgICAgICAgICBjYXNlICJlbmQiOgogICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0MTUuc3RvcCgpOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSwgX2NhbGxlZTE1LCB0aGlzKTsKICAgICAgfSkpOwoKICAgICAgZnVuY3Rpb24gR2V0RHJhZnQoKSB7CiAgICAgICAgcmV0dXJuIF9HZXREcmFmdC5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwogICAgICB9CgogICAgICByZXR1cm4gR2V0RHJhZnQ7CiAgICB9KCkKICAgIC8qKg0KICAgICAqIEdlbmVyYXRlUGVyc29uRmlsZeaOpeWPo+aWueazlQ0KICAgICAqDQogICAgICogQHBhcmFtIHsqfSBbY29udGV4dD17fV0NCiAgICAgKiBAcGFyYW0geyp9IFtkYXRhPXt9XQ0KICAgICAqIEBwYXJhbSB7Ym9vbGVhbn0gW2lzbG9hZGluZ10NCiAgICAgKiBAcmV0dXJucyB7UHJvbWlzZTxhbnk+fQ0KICAgICAqIEBtZW1iZXJvZiBQaW1QZXJzb25TZXJ2aWNlQmFzZQ0KICAgICAqLwoKICB9LCB7CiAgICBrZXk6ICJHZW5lcmF0ZVBlcnNvbkZpbGUiLAogICAgdmFsdWU6IGZ1bmN0aW9uICgpIHsKICAgICAgdmFyIF9HZW5lcmF0ZVBlcnNvbkZpbGUgPSBfYXN5bmNUb0dlbmVyYXRvcigKICAgICAgLyojX19QVVJFX18qLwogICAgICByZWdlbmVyYXRvclJ1bnRpbWUubWFyayhmdW5jdGlvbiBfY2FsbGVlMTYoKSB7CiAgICAgICAgdmFyIGNvbnRleHQsCiAgICAgICAgICAgIGRhdGEsCiAgICAgICAgICAgIGlzbG9hZGluZywKICAgICAgICAgICAgX2FyZ3MxNiA9IGFyZ3VtZW50czsKICAgICAgICByZXR1cm4gcmVnZW5lcmF0b3JSdW50aW1lLndyYXAoZnVuY3Rpb24gX2NhbGxlZTE2JChfY29udGV4dDE2KSB7CiAgICAgICAgICB3aGlsZSAoMSkgewogICAgICAgICAgICBzd2l0Y2ggKF9jb250ZXh0MTYucHJldiA9IF9jb250ZXh0MTYubmV4dCkgewogICAgICAgICAgICAgIGNhc2UgMDoKICAgICAgICAgICAgICAgIGNvbnRleHQgPSBfYXJnczE2Lmxlbmd0aCA+IDAgJiYgX2FyZ3MxNlswXSAhPT0gdW5kZWZpbmVkID8gX2FyZ3MxNlswXSA6IHt9OwogICAgICAgICAgICAgICAgZGF0YSA9IF9hcmdzMTYubGVuZ3RoID4gMSAmJiBfYXJnczE2WzFdICE9PSB1bmRlZmluZWQgPyBfYXJnczE2WzFdIDoge307CiAgICAgICAgICAgICAgICBpc2xvYWRpbmcgPSBfYXJnczE2Lmxlbmd0aCA+IDIgPyBfYXJnczE2WzJdIDogdW5kZWZpbmVkOwogICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0MTYuYWJydXB0KCJyZXR1cm4iLCBIdHRwLmdldEluc3RhbmNlKCkucG9zdCgiL3BpbXBlb3BsZS8iLmNvbmNhdChjb250ZXh0LnBpbXBlcnNvbiwgIi9nZW5lcmF0ZXBlcnNvbmZpbGUiKSwgZGF0YSwgaXNsb2FkaW5nKSk7CgogICAgICAgICAgICAgIGNhc2UgNDoKICAgICAgICAgICAgICBjYXNlICJlbmQiOgogICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0MTYuc3RvcCgpOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSwgX2NhbGxlZTE2KTsKICAgICAgfSkpOwoKICAgICAgZnVuY3Rpb24gR2VuZXJhdGVQZXJzb25GaWxlKCkgewogICAgICAgIHJldHVybiBfR2VuZXJhdGVQZXJzb25GaWxlLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7CiAgICAgIH0KCiAgICAgIHJldHVybiBHZW5lcmF0ZVBlcnNvbkZpbGU7CiAgICB9KCkKICAgIC8qKg0KICAgICAqIEZldGNoS0ZQUlnmjqXlj6Pmlrnms5UNCiAgICAgKg0KICAgICAqIEBwYXJhbSB7Kn0gW2NvbnRleHQ9e31dDQogICAgICogQHBhcmFtIHsqfSBbZGF0YT17fV0NCiAgICAgKiBAcGFyYW0ge2Jvb2xlYW59IFtpc2xvYWRpbmddDQogICAgICogQHJldHVybnMge1Byb21pc2U8YW55Pn0NCiAgICAgKiBAbWVtYmVyb2YgUGltUGVyc29uU2VydmljZUJhc2UNCiAgICAgKi8KCiAgfSwgewogICAga2V5OiAiRmV0Y2hLRlBSWSIsCiAgICB2YWx1ZTogZnVuY3Rpb24gKCkgewogICAgICB2YXIgX0ZldGNoS0ZQUlkgPSBfYXN5bmNUb0dlbmVyYXRvcigKICAgICAgLyojX19QVVJFX18qLwogICAgICByZWdlbmVyYXRvclJ1bnRpbWUubWFyayhmdW5jdGlvbiBfY2FsbGVlMTcoKSB7CiAgICAgICAgdmFyIGNvbnRleHQsCiAgICAgICAgICAgIGRhdGEsCiAgICAgICAgICAgIGlzbG9hZGluZywKICAgICAgICAgICAgdGVtcERhdGEsCiAgICAgICAgICAgIF9hcmdzMTcgPSBhcmd1bWVudHM7CiAgICAgICAgcmV0dXJuIHJlZ2VuZXJhdG9yUnVudGltZS53cmFwKGZ1bmN0aW9uIF9jYWxsZWUxNyQoX2NvbnRleHQxNykgewogICAgICAgICAgd2hpbGUgKDEpIHsKICAgICAgICAgICAgc3dpdGNoIChfY29udGV4dDE3LnByZXYgPSBfY29udGV4dDE3Lm5leHQpIHsKICAgICAgICAgICAgICBjYXNlIDA6CiAgICAgICAgICAgICAgICBjb250ZXh0ID0gX2FyZ3MxNy5sZW5ndGggPiAwICYmIF9hcmdzMTdbMF0gIT09IHVuZGVmaW5lZCA/IF9hcmdzMTdbMF0gOiB7fTsKICAgICAgICAgICAgICAgIGRhdGEgPSBfYXJnczE3Lmxlbmd0aCA+IDEgJiYgX2FyZ3MxN1sxXSAhPT0gdW5kZWZpbmVkID8gX2FyZ3MxN1sxXSA6IHt9OwogICAgICAgICAgICAgICAgaXNsb2FkaW5nID0gX2FyZ3MxNy5sZW5ndGggPiAyID8gX2FyZ3MxN1syXSA6IHVuZGVmaW5lZDsKICAgICAgICAgICAgICAgIHRlbXBEYXRhID0gSlNPTi5wYXJzZShKU09OLnN0cmluZ2lmeShkYXRhKSk7CiAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQxNy5hYnJ1cHQoInJldHVybiIsIEh0dHAuZ2V0SW5zdGFuY2UoKS5nZXQoIi9waW1wZW9wbGUvZmV0Y2hrZnByeSIsIHRlbXBEYXRhLCBpc2xvYWRpbmcpKTsKCiAgICAgICAgICAgICAgY2FzZSA1OgogICAgICAgICAgICAgIGNhc2UgImVuZCI6CiAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQxNy5zdG9wKCk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9LCBfY2FsbGVlMTcpOwogICAgICB9KSk7CgogICAgICBmdW5jdGlvbiBGZXRjaEtGUFJZKCkgewogICAgICAgIHJldHVybiBfRmV0Y2hLRlBSWS5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwogICAgICB9CgogICAgICByZXR1cm4gRmV0Y2hLRlBSWTsKICAgIH0oKQogICAgLyoqDQogICAgICogRmV0Y2hTZXRBdHRSdWxlc+aOpeWPo+aWueazlQ0KICAgICAqDQogICAgICogQHBhcmFtIHsqfSBbY29udGV4dD17fV0NCiAgICAgKiBAcGFyYW0geyp9IFtkYXRhPXt9XQ0KICAgICAqIEBwYXJhbSB7Ym9vbGVhbn0gW2lzbG9hZGluZ10NCiAgICAgKiBAcmV0dXJucyB7UHJvbWlzZTxhbnk+fQ0KICAgICAqIEBtZW1iZXJvZiBQaW1QZXJzb25TZXJ2aWNlQmFzZQ0KICAgICAqLwoKICB9LCB7CiAgICBrZXk6ICJGZXRjaFNldEF0dFJ1bGVzIiwKICAgIHZhbHVlOiBmdW5jdGlvbiAoKSB7CiAgICAgIHZhciBfRmV0Y2hTZXRBdHRSdWxlcyA9IF9hc3luY1RvR2VuZXJhdG9yKAogICAgICAvKiNfX1BVUkVfXyovCiAgICAgIHJlZ2VuZXJhdG9yUnVudGltZS5tYXJrKGZ1bmN0aW9uIF9jYWxsZWUxOCgpIHsKICAgICAgICB2YXIgY29udGV4dCwKICAgICAgICAgICAgZGF0YSwKICAgICAgICAgICAgaXNsb2FkaW5nLAogICAgICAgICAgICB0ZW1wRGF0YSwKICAgICAgICAgICAgX2FyZ3MxOCA9IGFyZ3VtZW50czsKICAgICAgICByZXR1cm4gcmVnZW5lcmF0b3JSdW50aW1lLndyYXAoZnVuY3Rpb24gX2NhbGxlZTE4JChfY29udGV4dDE4KSB7CiAgICAgICAgICB3aGlsZSAoMSkgewogICAgICAgICAgICBzd2l0Y2ggKF9jb250ZXh0MTgucHJldiA9IF9jb250ZXh0MTgubmV4dCkgewogICAgICAgICAgICAgIGNhc2UgMDoKICAgICAgICAgICAgICAgIGNvbnRleHQgPSBfYXJnczE4Lmxlbmd0aCA+IDAgJiYgX2FyZ3MxOFswXSAhPT0gdW5kZWZpbmVkID8gX2FyZ3MxOFswXSA6IHt9OwogICAgICAgICAgICAgICAgZGF0YSA9IF9hcmdzMTgubGVuZ3RoID4gMSAmJiBfYXJnczE4WzFdICE9PSB1bmRlZmluZWQgPyBfYXJnczE4WzFdIDoge307CiAgICAgICAgICAgICAgICBpc2xvYWRpbmcgPSBfYXJnczE4Lmxlbmd0aCA+IDIgPyBfYXJnczE4WzJdIDogdW5kZWZpbmVkOwogICAgICAgICAgICAgICAgdGVtcERhdGEgPSBKU09OLnBhcnNlKEpTT04uc3RyaW5naWZ5KGRhdGEpKTsKICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDE4LmFicnVwdCgicmV0dXJuIiwgSHR0cC5nZXRJbnN0YW5jZSgpLmdldCgiL3BpbXBlb3BsZS9mZXRjaHNldGF0dHJ1bGVzIiwgdGVtcERhdGEsIGlzbG9hZGluZykpOwoKICAgICAgICAgICAgICBjYXNlIDU6CiAgICAgICAgICAgICAgY2FzZSAiZW5kIjoKICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDE4LnN0b3AoKTsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0sIF9jYWxsZWUxOCk7CiAgICAgIH0pKTsKCiAgICAgIGZ1bmN0aW9uIEZldGNoU2V0QXR0UnVsZXMoKSB7CiAgICAgICAgcmV0dXJuIF9GZXRjaFNldEF0dFJ1bGVzLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7CiAgICAgIH0KCiAgICAgIHJldHVybiBGZXRjaFNldEF0dFJ1bGVzOwogICAgfSgpCiAgICAvKioNCiAgICAgKiBGZXRjaFNldFNvY0FyY2hpdmVz5o6l5Y+j5pa55rOVDQogICAgICoNCiAgICAgKiBAcGFyYW0geyp9IFtjb250ZXh0PXt9XQ0KICAgICAqIEBwYXJhbSB7Kn0gW2RhdGE9e31dDQogICAgICogQHBhcmFtIHtib29sZWFufSBbaXNsb2FkaW5nXQ0KICAgICAqIEByZXR1cm5zIHtQcm9taXNlPGFueT59DQogICAgICogQG1lbWJlcm9mIFBpbVBlcnNvblNlcnZpY2VCYXNlDQogICAgICovCgogIH0sIHsKICAgIGtleTogIkZldGNoU2V0U29jQXJjaGl2ZXMiLAogICAgdmFsdWU6IGZ1bmN0aW9uICgpIHsKICAgICAgdmFyIF9GZXRjaFNldFNvY0FyY2hpdmVzID0gX2FzeW5jVG9HZW5lcmF0b3IoCiAgICAgIC8qI19fUFVSRV9fKi8KICAgICAgcmVnZW5lcmF0b3JSdW50aW1lLm1hcmsoZnVuY3Rpb24gX2NhbGxlZTE5KCkgewogICAgICAgIHZhciBjb250ZXh0LAogICAgICAgICAgICBkYXRhLAogICAgICAgICAgICBpc2xvYWRpbmcsCiAgICAgICAgICAgIHRlbXBEYXRhLAogICAgICAgICAgICBfYXJnczE5ID0gYXJndW1lbnRzOwogICAgICAgIHJldHVybiByZWdlbmVyYXRvclJ1bnRpbWUud3JhcChmdW5jdGlvbiBfY2FsbGVlMTkkKF9jb250ZXh0MTkpIHsKICAgICAgICAgIHdoaWxlICgxKSB7CiAgICAgICAgICAgIHN3aXRjaCAoX2NvbnRleHQxOS5wcmV2ID0gX2NvbnRleHQxOS5uZXh0KSB7CiAgICAgICAgICAgICAgY2FzZSAwOgogICAgICAgICAgICAgICAgY29udGV4dCA9IF9hcmdzMTkubGVuZ3RoID4gMCAmJiBfYXJnczE5WzBdICE9PSB1bmRlZmluZWQgPyBfYXJnczE5WzBdIDoge307CiAgICAgICAgICAgICAgICBkYXRhID0gX2FyZ3MxOS5sZW5ndGggPiAxICYmIF9hcmdzMTlbMV0gIT09IHVuZGVmaW5lZCA/IF9hcmdzMTlbMV0gOiB7fTsKICAgICAgICAgICAgICAgIGlzbG9hZGluZyA9IF9hcmdzMTkubGVuZ3RoID4gMiA/IF9hcmdzMTlbMl0gOiB1bmRlZmluZWQ7CiAgICAgICAgICAgICAgICB0ZW1wRGF0YSA9IEpTT04ucGFyc2UoSlNPTi5zdHJpbmdpZnkoZGF0YSkpOwogICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0MTkuYWJydXB0KCJyZXR1cm4iLCBIdHRwLmdldEluc3RhbmNlKCkuZ2V0KCIvcGltcGVvcGxlL2ZldGNoc2V0c29jYXJjaGl2ZXMiLCB0ZW1wRGF0YSwgaXNsb2FkaW5nKSk7CgogICAgICAgICAgICAgIGNhc2UgNToKICAgICAgICAgICAgICBjYXNlICJlbmQiOgogICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0MTkuc3RvcCgpOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSwgX2NhbGxlZTE5KTsKICAgICAgfSkpOwoKICAgICAgZnVuY3Rpb24gRmV0Y2hTZXRTb2NBcmNoaXZlcygpIHsKICAgICAgICByZXR1cm4gX0ZldGNoU2V0U29jQXJjaGl2ZXMuYXBwbHkodGhpcywgYXJndW1lbnRzKTsKICAgICAgfQoKICAgICAgcmV0dXJuIEZldGNoU2V0U29jQXJjaGl2ZXM7CiAgICB9KCkKICAgIC8qKg0KICAgICAqIEZldGNoWUdYWEdMWeaOpeWPo+aWueazlQ0KICAgICAqDQogICAgICogQHBhcmFtIHsqfSBbY29udGV4dD17fV0NCiAgICAgKiBAcGFyYW0geyp9IFtkYXRhPXt9XQ0KICAgICAqIEBwYXJhbSB7Ym9vbGVhbn0gW2lzbG9hZGluZ10NCiAgICAgKiBAcmV0dXJucyB7UHJvbWlzZTxhbnk+fQ0KICAgICAqIEBtZW1iZXJvZiBQaW1QZXJzb25TZXJ2aWNlQmFzZQ0KICAgICAqLwoKICB9LCB7CiAgICBrZXk6ICJGZXRjaFlHWFhHTFkiLAogICAgdmFsdWU6IGZ1bmN0aW9uICgpIHsKICAgICAgdmFyIF9GZXRjaFlHWFhHTFkgPSBfYXN5bmNUb0dlbmVyYXRvcigKICAgICAgLyojX19QVVJFX18qLwogICAgICByZWdlbmVyYXRvclJ1bnRpbWUubWFyayhmdW5jdGlvbiBfY2FsbGVlMjAoKSB7CiAgICAgICAgdmFyIGNvbnRleHQsCiAgICAgICAgICAgIGRhdGEsCiAgICAgICAgICAgIGlzbG9hZGluZywKICAgICAgICAgICAgdGVtcERhdGEsCiAgICAgICAgICAgIF9hcmdzMjAgPSBhcmd1bWVudHM7CiAgICAgICAgcmV0dXJuIHJlZ2VuZXJhdG9yUnVudGltZS53cmFwKGZ1bmN0aW9uIF9jYWxsZWUyMCQoX2NvbnRleHQyMCkgewogICAgICAgICAgd2hpbGUgKDEpIHsKICAgICAgICAgICAgc3dpdGNoIChfY29udGV4dDIwLnByZXYgPSBfY29udGV4dDIwLm5leHQpIHsKICAgICAgICAgICAgICBjYXNlIDA6CiAgICAgICAgICAgICAgICBjb250ZXh0ID0gX2FyZ3MyMC5sZW5ndGggPiAwICYmIF9hcmdzMjBbMF0gIT09IHVuZGVmaW5lZCA/IF9hcmdzMjBbMF0gOiB7fTsKICAgICAgICAgICAgICAgIGRhdGEgPSBfYXJnczIwLmxlbmd0aCA+IDEgJiYgX2FyZ3MyMFsxXSAhPT0gdW5kZWZpbmVkID8gX2FyZ3MyMFsxXSA6IHt9OwogICAgICAgICAgICAgICAgaXNsb2FkaW5nID0gX2FyZ3MyMC5sZW5ndGggPiAyID8gX2FyZ3MyMFsyXSA6IHVuZGVmaW5lZDsKICAgICAgICAgICAgICAgIHRlbXBEYXRhID0gSlNPTi5wYXJzZShKU09OLnN0cmluZ2lmeShkYXRhKSk7CiAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQyMC5hYnJ1cHQoInJldHVybiIsIEh0dHAuZ2V0SW5zdGFuY2UoKS5nZXQoIi9waW1wZW9wbGUvZmV0Y2h5Z3h4Z2x5IiwgdGVtcERhdGEsIGlzbG9hZGluZykpOwoKICAgICAgICAgICAgICBjYXNlIDU6CiAgICAgICAgICAgICAgY2FzZSAiZW5kIjoKICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDIwLnN0b3AoKTsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0sIF9jYWxsZWUyMCk7CiAgICAgIH0pKTsKCiAgICAgIGZ1bmN0aW9uIEZldGNoWUdYWEdMWSgpIHsKICAgICAgICByZXR1cm4gX0ZldGNoWUdYWEdMWS5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwogICAgICB9CgogICAgICByZXR1cm4gRmV0Y2hZR1hYR0xZOwogICAgfSgpCiAgICAvKioNCiAgICAgKiBGZXRjaFhNQlJZQ1jmjqXlj6Pmlrnms5UNCiAgICAgKg0KICAgICAqIEBwYXJhbSB7Kn0gW2NvbnRleHQ9e31dDQogICAgICogQHBhcmFtIHsqfSBbZGF0YT17fV0NCiAgICAgKiBAcGFyYW0ge2Jvb2xlYW59IFtpc2xvYWRpbmddDQogICAgICogQHJldHVybnMge1Byb21pc2U8YW55Pn0NCiAgICAgKiBAbWVtYmVyb2YgUGltUGVyc29uU2VydmljZUJhc2UNCiAgICAgKi8KCiAgfSwgewogICAga2V5OiAiRmV0Y2hYTUJSWUNYIiwKICAgIHZhbHVlOiBmdW5jdGlvbiAoKSB7CiAgICAgIHZhciBfRmV0Y2hYTUJSWUNYID0gX2FzeW5jVG9HZW5lcmF0b3IoCiAgICAgIC8qI19fUFVSRV9fKi8KICAgICAgcmVnZW5lcmF0b3JSdW50aW1lLm1hcmsoZnVuY3Rpb24gX2NhbGxlZTIxKCkgewogICAgICAgIHZhciBjb250ZXh0LAogICAgICAgICAgICBkYXRhLAogICAgICAgICAgICBpc2xvYWRpbmcsCiAgICAgICAgICAgIHRlbXBEYXRhLAogICAgICAgICAgICBfYXJnczIxID0gYXJndW1lbnRzOwogICAgICAgIHJldHVybiByZWdlbmVyYXRvclJ1bnRpbWUud3JhcChmdW5jdGlvbiBfY2FsbGVlMjEkKF9jb250ZXh0MjEpIHsKICAgICAgICAgIHdoaWxlICgxKSB7CiAgICAgICAgICAgIHN3aXRjaCAoX2NvbnRleHQyMS5wcmV2ID0gX2NvbnRleHQyMS5uZXh0KSB7CiAgICAgICAgICAgICAgY2FzZSAwOgogICAgICAgICAgICAgICAgY29udGV4dCA9IF9hcmdzMjEubGVuZ3RoID4gMCAmJiBfYXJnczIxWzBdICE9PSB1bmRlZmluZWQgPyBfYXJnczIxWzBdIDoge307CiAgICAgICAgICAgICAgICBkYXRhID0gX2FyZ3MyMS5sZW5ndGggPiAxICYmIF9hcmdzMjFbMV0gIT09IHVuZGVmaW5lZCA/IF9hcmdzMjFbMV0gOiB7fTsKICAgICAgICAgICAgICAgIGlzbG9hZGluZyA9IF9hcmdzMjEubGVuZ3RoID4gMiA/IF9hcmdzMjFbMl0gOiB1bmRlZmluZWQ7CiAgICAgICAgICAgICAgICB0ZW1wRGF0YSA9IEpTT04ucGFyc2UoSlNPTi5zdHJpbmdpZnkoZGF0YSkpOwogICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0MjEuYWJydXB0KCJyZXR1cm4iLCBIdHRwLmdldEluc3RhbmNlKCkuZ2V0KCIvcGltcGVvcGxlL2ZldGNoeG1icnljeCIsIHRlbXBEYXRhLCBpc2xvYWRpbmcpKTsKCiAgICAgICAgICAgICAgY2FzZSA1OgogICAgICAgICAgICAgIGNhc2UgImVuZCI6CiAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQyMS5zdG9wKCk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9LCBfY2FsbGVlMjEpOwogICAgICB9KSk7CgogICAgICBmdW5jdGlvbiBGZXRjaFhNQlJZQ1goKSB7CiAgICAgICAgcmV0dXJuIF9GZXRjaFhNQlJZQ1guYXBwbHkodGhpcywgYXJndW1lbnRzKTsKICAgICAgfQoKICAgICAgcmV0dXJuIEZldGNoWE1CUllDWDsKICAgIH0oKQogICAgLyoqDQogICAgICogRmV0Y2hDdXJPcmdQZXJzb27mjqXlj6Pmlrnms5UNCiAgICAgKg0KICAgICAqIEBwYXJhbSB7Kn0gW2NvbnRleHQ9e31dDQogICAgICogQHBhcmFtIHsqfSBbZGF0YT17fV0NCiAgICAgKiBAcGFyYW0ge2Jvb2xlYW59IFtpc2xvYWRpbmddDQogICAgICogQHJldHVybnMge1Byb21pc2U8YW55Pn0NCiAgICAgKiBAbWVtYmVyb2YgUGltUGVyc29uU2VydmljZUJhc2UNCiAgICAgKi8KCiAgfSwgewogICAga2V5OiAiRmV0Y2hDdXJPcmdQZXJzb24iLAogICAgdmFsdWU6IGZ1bmN0aW9uICgpIHsKICAgICAgdmFyIF9GZXRjaEN1ck9yZ1BlcnNvbiA9IF9hc3luY1RvR2VuZXJhdG9yKAogICAgICAvKiNfX1BVUkVfXyovCiAgICAgIHJlZ2VuZXJhdG9yUnVudGltZS5tYXJrKGZ1bmN0aW9uIF9jYWxsZWUyMigpIHsKICAgICAgICB2YXIgY29udGV4dCwKICAgICAgICAgICAgZGF0YSwKICAgICAgICAgICAgaXNsb2FkaW5nLAogICAgICAgICAgICB0ZW1wRGF0YSwKICAgICAgICAgICAgX2FyZ3MyMiA9IGFyZ3VtZW50czsKICAgICAgICByZXR1cm4gcmVnZW5lcmF0b3JSdW50aW1lLndyYXAoZnVuY3Rpb24gX2NhbGxlZTIyJChfY29udGV4dDIyKSB7CiAgICAgICAgICB3aGlsZSAoMSkgewogICAgICAgICAgICBzd2l0Y2ggKF9jb250ZXh0MjIucHJldiA9IF9jb250ZXh0MjIubmV4dCkgewogICAgICAgICAgICAgIGNhc2UgMDoKICAgICAgICAgICAgICAgIGNvbnRleHQgPSBfYXJnczIyLmxlbmd0aCA+IDAgJiYgX2FyZ3MyMlswXSAhPT0gdW5kZWZpbmVkID8gX2FyZ3MyMlswXSA6IHt9OwogICAgICAgICAgICAgICAgZGF0YSA9IF9hcmdzMjIubGVuZ3RoID4gMSAmJiBfYXJnczIyWzFdICE9PSB1bmRlZmluZWQgPyBfYXJnczIyWzFdIDoge307CiAgICAgICAgICAgICAgICBpc2xvYWRpbmcgPSBfYXJnczIyLmxlbmd0aCA+IDIgPyBfYXJnczIyWzJdIDogdW5kZWZpbmVkOwogICAgICAgICAgICAgICAgdGVtcERhdGEgPSBKU09OLnBhcnNlKEpTT04uc3RyaW5naWZ5KGRhdGEpKTsKICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDIyLmFicnVwdCgicmV0dXJuIiwgSHR0cC5nZXRJbnN0YW5jZSgpLmdldCgiL3BpbXBlb3BsZS9mZXRjaGN1cm9yZ3BlcnNvbiIsIHRlbXBEYXRhLCBpc2xvYWRpbmcpKTsKCiAgICAgICAgICAgICAgY2FzZSA1OgogICAgICAgICAgICAgIGNhc2UgImVuZCI6CiAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQyMi5zdG9wKCk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9LCBfY2FsbGVlMjIpOwogICAgICB9KSk7CgogICAgICBmdW5jdGlvbiBGZXRjaEN1ck9yZ1BlcnNvbigpIHsKICAgICAgICByZXR1cm4gX0ZldGNoQ3VyT3JnUGVyc29uLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7CiAgICAgIH0KCiAgICAgIHJldHVybiBGZXRjaEN1ck9yZ1BlcnNvbjsKICAgIH0oKQogICAgLyoqDQogICAgICogRmV0Y2hKTFNTR1LmjqXlj6Pmlrnms5UNCiAgICAgKg0KICAgICAqIEBwYXJhbSB7Kn0gW2NvbnRleHQ9e31dDQogICAgICogQHBhcmFtIHsqfSBbZGF0YT17fV0NCiAgICAgKiBAcGFyYW0ge2Jvb2xlYW59IFtpc2xvYWRpbmddDQogICAgICogQHJldHVybnMge1Byb21pc2U8YW55Pn0NCiAgICAgKiBAbWVtYmVyb2YgUGltUGVyc29uU2VydmljZUJhc2UNCiAgICAgKi8KCiAgfSwgewogICAga2V5OiAiRmV0Y2hKTFNTR1IiLAogICAgdmFsdWU6IGZ1bmN0aW9uICgpIHsKICAgICAgdmFyIF9GZXRjaEpMU1NHUiA9IF9hc3luY1RvR2VuZXJhdG9yKAogICAgICAvKiNfX1BVUkVfXyovCiAgICAgIHJlZ2VuZXJhdG9yUnVudGltZS5tYXJrKGZ1bmN0aW9uIF9jYWxsZWUyMygpIHsKICAgICAgICB2YXIgY29udGV4dCwKICAgICAgICAgICAgZGF0YSwKICAgICAgICAgICAgaXNsb2FkaW5nLAogICAgICAgICAgICB0ZW1wRGF0YSwKICAgICAgICAgICAgX2FyZ3MyMyA9IGFyZ3VtZW50czsKICAgICAgICByZXR1cm4gcmVnZW5lcmF0b3JSdW50aW1lLndyYXAoZnVuY3Rpb24gX2NhbGxlZTIzJChfY29udGV4dDIzKSB7CiAgICAgICAgICB3aGlsZSAoMSkgewogICAgICAgICAgICBzd2l0Y2ggKF9jb250ZXh0MjMucHJldiA9IF9jb250ZXh0MjMubmV4dCkgewogICAgICAgICAgICAgIGNhc2UgMDoKICAgICAgICAgICAgICAgIGNvbnRleHQgPSBfYXJnczIzLmxlbmd0aCA+IDAgJiYgX2FyZ3MyM1swXSAhPT0gdW5kZWZpbmVkID8gX2FyZ3MyM1swXSA6IHt9OwogICAgICAgICAgICAgICAgZGF0YSA9IF9hcmdzMjMubGVuZ3RoID4gMSAmJiBfYXJnczIzWzFdICE9PSB1bmRlZmluZWQgPyBfYXJnczIzWzFdIDoge307CiAgICAgICAgICAgICAgICBpc2xvYWRpbmcgPSBfYXJnczIzLmxlbmd0aCA+IDIgPyBfYXJnczIzWzJdIDogdW5kZWZpbmVkOwogICAgICAgICAgICAgICAgdGVtcERhdGEgPSBKU09OLnBhcnNlKEpTT04uc3RyaW5naWZ5KGRhdGEpKTsKICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDIzLmFicnVwdCgicmV0dXJuIiwgSHR0cC5nZXRJbnN0YW5jZSgpLmdldCgiL3BpbXBlb3BsZS9mZXRjaGpsc3NnciIsIHRlbXBEYXRhLCBpc2xvYWRpbmcpKTsKCiAgICAgICAgICAgICAgY2FzZSA1OgogICAgICAgICAgICAgIGNhc2UgImVuZCI6CiAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQyMy5zdG9wKCk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9LCBfY2FsbGVlMjMpOwogICAgICB9KSk7CgogICAgICBmdW5jdGlvbiBGZXRjaEpMU1NHUigpIHsKICAgICAgICByZXR1cm4gX0ZldGNoSkxTU0dSLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7CiAgICAgIH0KCiAgICAgIHJldHVybiBGZXRjaEpMU1NHUjsKICAgIH0oKQogICAgLyoqDQogICAgICogRmV0Y2hDdXJMZWFkZXLmjqXlj6Pmlrnms5UNCiAgICAgKg0KICAgICAqIEBwYXJhbSB7Kn0gW2NvbnRleHQ9e31dDQogICAgICogQHBhcmFtIHsqfSBbZGF0YT17fV0NCiAgICAgKiBAcGFyYW0ge2Jvb2xlYW59IFtpc2xvYWRpbmddDQogICAgICogQHJldHVybnMge1Byb21pc2U8YW55Pn0NCiAgICAgKiBAbWVtYmVyb2YgUGltUGVyc29uU2VydmljZUJhc2UNCiAgICAgKi8KCiAgfSwgewogICAga2V5OiAiRmV0Y2hDdXJMZWFkZXIiLAogICAgdmFsdWU6IGZ1bmN0aW9uICgpIHsKICAgICAgdmFyIF9GZXRjaEN1ckxlYWRlciA9IF9hc3luY1RvR2VuZXJhdG9yKAogICAgICAvKiNfX1BVUkVfXyovCiAgICAgIHJlZ2VuZXJhdG9yUnVudGltZS5tYXJrKGZ1bmN0aW9uIF9jYWxsZWUyNCgpIHsKICAgICAgICB2YXIgY29udGV4dCwKICAgICAgICAgICAgZGF0YSwKICAgICAgICAgICAgaXNsb2FkaW5nLAogICAgICAgICAgICB0ZW1wRGF0YSwKICAgICAgICAgICAgX2FyZ3MyNCA9IGFyZ3VtZW50czsKICAgICAgICByZXR1cm4gcmVnZW5lcmF0b3JSdW50aW1lLndyYXAoZnVuY3Rpb24gX2NhbGxlZTI0JChfY29udGV4dDI0KSB7CiAgICAgICAgICB3aGlsZSAoMSkgewogICAgICAgICAgICBzd2l0Y2ggKF9jb250ZXh0MjQucHJldiA9IF9jb250ZXh0MjQubmV4dCkgewogICAgICAgICAgICAgIGNhc2UgMDoKICAgICAgICAgICAgICAgIGNvbnRleHQgPSBfYXJnczI0Lmxlbmd0aCA+IDAgJiYgX2FyZ3MyNFswXSAhPT0gdW5kZWZpbmVkID8gX2FyZ3MyNFswXSA6IHt9OwogICAgICAgICAgICAgICAgZGF0YSA9IF9hcmdzMjQubGVuZ3RoID4gMSAmJiBfYXJnczI0WzFdICE9PSB1bmRlZmluZWQgPyBfYXJnczI0WzFdIDoge307CiAgICAgICAgICAgICAgICBpc2xvYWRpbmcgPSBfYXJnczI0Lmxlbmd0aCA+IDIgPyBfYXJnczI0WzJdIDogdW5kZWZpbmVkOwogICAgICAgICAgICAgICAgdGVtcERhdGEgPSBKU09OLnBhcnNlKEpTT04uc3RyaW5naWZ5KGRhdGEpKTsKICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDI0LmFicnVwdCgicmV0dXJuIiwgSHR0cC5nZXRJbnN0YW5jZSgpLmdldCgiL3BpbXBlb3BsZS9mZXRjaGN1cmxlYWRlciIsIHRlbXBEYXRhLCBpc2xvYWRpbmcpKTsKCiAgICAgICAgICAgICAgY2FzZSA1OgogICAgICAgICAgICAgIGNhc2UgImVuZCI6CiAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQyNC5zdG9wKCk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9LCBfY2FsbGVlMjQpOwogICAgICB9KSk7CgogICAgICBmdW5jdGlvbiBGZXRjaEN1ckxlYWRlcigpIHsKICAgICAgICByZXR1cm4gX0ZldGNoQ3VyTGVhZGVyLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7CiAgICAgIH0KCiAgICAgIHJldHVybiBGZXRjaEN1ckxlYWRlcjsKICAgIH0oKQogICAgLyoqDQogICAgICogRmV0Y2hTRkhNROaOpeWPo+aWueazlQ0KICAgICAqDQogICAgICogQHBhcmFtIHsqfSBbY29udGV4dD17fV0NCiAgICAgKiBAcGFyYW0geyp9IFtkYXRhPXt9XQ0KICAgICAqIEBwYXJhbSB7Ym9vbGVhbn0gW2lzbG9hZGluZ10NCiAgICAgKiBAcmV0dXJucyB7UHJvbWlzZTxhbnk+fQ0KICAgICAqIEBtZW1iZXJvZiBQaW1QZXJzb25TZXJ2aWNlQmFzZQ0KICAgICAqLwoKICB9LCB7CiAgICBrZXk6ICJGZXRjaFNGSE1EIiwKICAgIHZhbHVlOiBmdW5jdGlvbiAoKSB7CiAgICAgIHZhciBfRmV0Y2hTRkhNRCA9IF9hc3luY1RvR2VuZXJhdG9yKAogICAgICAvKiNfX1BVUkVfXyovCiAgICAgIHJlZ2VuZXJhdG9yUnVudGltZS5tYXJrKGZ1bmN0aW9uIF9jYWxsZWUyNSgpIHsKICAgICAgICB2YXIgY29udGV4dCwKICAgICAgICAgICAgZGF0YSwKICAgICAgICAgICAgaXNsb2FkaW5nLAogICAgICAgICAgICB0ZW1wRGF0YSwKICAgICAgICAgICAgX2FyZ3MyNSA9IGFyZ3VtZW50czsKICAgICAgICByZXR1cm4gcmVnZW5lcmF0b3JSdW50aW1lLndyYXAoZnVuY3Rpb24gX2NhbGxlZTI1JChfY29udGV4dDI1KSB7CiAgICAgICAgICB3aGlsZSAoMSkgewogICAgICAgICAgICBzd2l0Y2ggKF9jb250ZXh0MjUucHJldiA9IF9jb250ZXh0MjUubmV4dCkgewogICAgICAgICAgICAgIGNhc2UgMDoKICAgICAgICAgICAgICAgIGNvbnRleHQgPSBfYXJnczI1Lmxlbmd0aCA+IDAgJiYgX2FyZ3MyNVswXSAhPT0gdW5kZWZpbmVkID8gX2FyZ3MyNVswXSA6IHt9OwogICAgICAgICAgICAgICAgZGF0YSA9IF9hcmdzMjUubGVuZ3RoID4gMSAmJiBfYXJnczI1WzFdICE9PSB1bmRlZmluZWQgPyBfYXJnczI1WzFdIDoge307CiAgICAgICAgICAgICAgICBpc2xvYWRpbmcgPSBfYXJnczI1Lmxlbmd0aCA+IDIgPyBfYXJnczI1WzJdIDogdW5kZWZpbmVkOwogICAgICAgICAgICAgICAgdGVtcERhdGEgPSBKU09OLnBhcnNlKEpTT04uc3RyaW5naWZ5KGRhdGEpKTsKICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDI1LmFicnVwdCgicmV0dXJuIiwgSHR0cC5nZXRJbnN0YW5jZSgpLmdldCgiL3BpbXBlb3BsZS9mZXRjaHNmaG1kIiwgdGVtcERhdGEsIGlzbG9hZGluZykpOwoKICAgICAgICAgICAgICBjYXNlIDU6CiAgICAgICAgICAgICAgY2FzZSAiZW5kIjoKICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDI1LnN0b3AoKTsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0sIF9jYWxsZWUyNSk7CiAgICAgIH0pKTsKCiAgICAgIGZ1bmN0aW9uIEZldGNoU0ZITUQoKSB7CiAgICAgICAgcmV0dXJuIF9GZXRjaFNGSE1ELmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7CiAgICAgIH0KCiAgICAgIHJldHVybiBGZXRjaFNGSE1EOwogICAgfSgpCiAgICAvKioNCiAgICAgKiBGZXRjaFNTVFJFUlNPTklORk/mjqXlj6Pmlrnms5UNCiAgICAgKg0KICAgICAqIEBwYXJhbSB7Kn0gW2NvbnRleHQ9e31dDQogICAgICogQHBhcmFtIHsqfSBbZGF0YT17fV0NCiAgICAgKiBAcGFyYW0ge2Jvb2xlYW59IFtpc2xvYWRpbmddDQogICAgICogQHJldHVybnMge1Byb21pc2U8YW55Pn0NCiAgICAgKiBAbWVtYmVyb2YgUGltUGVyc29uU2VydmljZUJhc2UNCiAgICAgKi8KCiAgfSwgewogICAga2V5OiAiRmV0Y2hTU1RSRVJTT05JTkZPIiwKICAgIHZhbHVlOiBmdW5jdGlvbiAoKSB7CiAgICAgIHZhciBfRmV0Y2hTU1RSRVJTT05JTkZPID0gX2FzeW5jVG9HZW5lcmF0b3IoCiAgICAgIC8qI19fUFVSRV9fKi8KICAgICAgcmVnZW5lcmF0b3JSdW50aW1lLm1hcmsoZnVuY3Rpb24gX2NhbGxlZTI2KCkgewogICAgICAgIHZhciBjb250ZXh0LAogICAgICAgICAgICBkYXRhLAogICAgICAgICAgICBpc2xvYWRpbmcsCiAgICAgICAgICAgIHRlbXBEYXRhLAogICAgICAgICAgICBfYXJnczI2ID0gYXJndW1lbnRzOwogICAgICAgIHJldHVybiByZWdlbmVyYXRvclJ1bnRpbWUud3JhcChmdW5jdGlvbiBfY2FsbGVlMjYkKF9jb250ZXh0MjYpIHsKICAgICAgICAgIHdoaWxlICgxKSB7CiAgICAgICAgICAgIHN3aXRjaCAoX2NvbnRleHQyNi5wcmV2ID0gX2NvbnRleHQyNi5uZXh0KSB7CiAgICAgICAgICAgICAgY2FzZSAwOgogICAgICAgICAgICAgICAgY29udGV4dCA9IF9hcmdzMjYubGVuZ3RoID4gMCAmJiBfYXJnczI2WzBdICE9PSB1bmRlZmluZWQgPyBfYXJnczI2WzBdIDoge307CiAgICAgICAgICAgICAgICBkYXRhID0gX2FyZ3MyNi5sZW5ndGggPiAxICYmIF9hcmdzMjZbMV0gIT09IHVuZGVmaW5lZCA/IF9hcmdzMjZbMV0gOiB7fTsKICAgICAgICAgICAgICAgIGlzbG9hZGluZyA9IF9hcmdzMjYubGVuZ3RoID4gMiA/IF9hcmdzMjZbMl0gOiB1bmRlZmluZWQ7CiAgICAgICAgICAgICAgICB0ZW1wRGF0YSA9IEpTT04ucGFyc2UoSlNPTi5zdHJpbmdpZnkoZGF0YSkpOwogICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0MjYuYWJydXB0KCJyZXR1cm4iLCBIdHRwLmdldEluc3RhbmNlKCkuZ2V0KCIvcGltcGVvcGxlL2ZldGNoc3N0cmVyc29uaW5mbyIsIHRlbXBEYXRhLCBpc2xvYWRpbmcpKTsKCiAgICAgICAgICAgICAgY2FzZSA1OgogICAgICAgICAgICAgIGNhc2UgImVuZCI6CiAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQyNi5zdG9wKCk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9LCBfY2FsbGVlMjYpOwogICAgICB9KSk7CgogICAgICBmdW5jdGlvbiBGZXRjaFNTVFJFUlNPTklORk8oKSB7CiAgICAgICAgcmV0dXJuIF9GZXRjaFNTVFJFUlNPTklORk8uYXBwbHkodGhpcywgYXJndW1lbnRzKTsKICAgICAgfQoKICAgICAgcmV0dXJuIEZldGNoU1NUUkVSU09OSU5GTzsKICAgIH0oKQogICAgLyoqDQogICAgICogRmV0Y2hDdXJKSFJZ5o6l5Y+j5pa55rOVDQogICAgICoNCiAgICAgKiBAcGFyYW0geyp9IFtjb250ZXh0PXt9XQ0KICAgICAqIEBwYXJhbSB7Kn0gW2RhdGE9e31dDQogICAgICogQHBhcmFtIHtib29sZWFufSBbaXNsb2FkaW5nXQ0KICAgICAqIEByZXR1cm5zIHtQcm9taXNlPGFueT59DQogICAgICogQG1lbWJlcm9mIFBpbVBlcnNvblNlcnZpY2VCYXNlDQogICAgICovCgogIH0sIHsKICAgIGtleTogIkZldGNoQ3VySkhSWSIsCiAgICB2YWx1ZTogZnVuY3Rpb24gKCkgewogICAgICB2YXIgX0ZldGNoQ3VySkhSWSA9IF9hc3luY1RvR2VuZXJhdG9yKAogICAgICAvKiNfX1BVUkVfXyovCiAgICAgIHJlZ2VuZXJhdG9yUnVudGltZS5tYXJrKGZ1bmN0aW9uIF9jYWxsZWUyNygpIHsKICAgICAgICB2YXIgY29udGV4dCwKICAgICAgICAgICAgZGF0YSwKICAgICAgICAgICAgaXNsb2FkaW5nLAogICAgICAgICAgICB0ZW1wRGF0YSwKICAgICAgICAgICAgX2FyZ3MyNyA9IGFyZ3VtZW50czsKICAgICAgICByZXR1cm4gcmVnZW5lcmF0b3JSdW50aW1lLndyYXAoZnVuY3Rpb24gX2NhbGxlZTI3JChfY29udGV4dDI3KSB7CiAgICAgICAgICB3aGlsZSAoMSkgewogICAgICAgICAgICBzd2l0Y2ggKF9jb250ZXh0MjcucHJldiA9IF9jb250ZXh0MjcubmV4dCkgewogICAgICAgICAgICAgIGNhc2UgMDoKICAgICAgICAgICAgICAgIGNvbnRleHQgPSBfYXJnczI3Lmxlbmd0aCA+IDAgJiYgX2FyZ3MyN1swXSAhPT0gdW5kZWZpbmVkID8gX2FyZ3MyN1swXSA6IHt9OwogICAgICAgICAgICAgICAgZGF0YSA9IF9hcmdzMjcubGVuZ3RoID4gMSAmJiBfYXJnczI3WzFdICE9PSB1bmRlZmluZWQgPyBfYXJnczI3WzFdIDoge307CiAgICAgICAgICAgICAgICBpc2xvYWRpbmcgPSBfYXJnczI3Lmxlbmd0aCA+IDIgPyBfYXJnczI3WzJdIDogdW5kZWZpbmVkOwogICAgICAgICAgICAgICAgdGVtcERhdGEgPSBKU09OLnBhcnNlKEpTT04uc3RyaW5naWZ5KGRhdGEpKTsKICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDI3LmFicnVwdCgicmV0dXJuIiwgSHR0cC5nZXRJbnN0YW5jZSgpLmdldCgiL3BpbXBlb3BsZS9mZXRjaGN1cmpocnkiLCB0ZW1wRGF0YSwgaXNsb2FkaW5nKSk7CgogICAgICAgICAgICAgIGNhc2UgNToKICAgICAgICAgICAgICBjYXNlICJlbmQiOgogICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0Mjcuc3RvcCgpOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSwgX2NhbGxlZTI3KTsKICAgICAgfSkpOwoKICAgICAgZnVuY3Rpb24gRmV0Y2hDdXJKSFJZKCkgewogICAgICAgIHJldHVybiBfRmV0Y2hDdXJKSFJZLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7CiAgICAgIH0KCiAgICAgIHJldHVybiBGZXRjaEN1ckpIUlk7CiAgICB9KCkKICAgIC8qKg0KICAgICAqIEZldGNoS1RYWUfmjqXlj6Pmlrnms5UNCiAgICAgKg0KICAgICAqIEBwYXJhbSB7Kn0gW2NvbnRleHQ9e31dDQogICAgICogQHBhcmFtIHsqfSBbZGF0YT17fV0NCiAgICAgKiBAcGFyYW0ge2Jvb2xlYW59IFtpc2xvYWRpbmddDQogICAgICogQHJldHVybnMge1Byb21pc2U8YW55Pn0NCiAgICAgKiBAbWVtYmVyb2YgUGltUGVyc29uU2VydmljZUJhc2UNCiAgICAgKi8KCiAgfSwgewogICAga2V5OiAiRmV0Y2hLVFhZRyIsCiAgICB2YWx1ZTogZnVuY3Rpb24gKCkgewogICAgICB2YXIgX0ZldGNoS1RYWUcgPSBfYXN5bmNUb0dlbmVyYXRvcigKICAgICAgLyojX19QVVJFX18qLwogICAgICByZWdlbmVyYXRvclJ1bnRpbWUubWFyayhmdW5jdGlvbiBfY2FsbGVlMjgoKSB7CiAgICAgICAgdmFyIGNvbnRleHQsCiAgICAgICAgICAgIGRhdGEsCiAgICAgICAgICAgIGlzbG9hZGluZywKICAgICAgICAgICAgdGVtcERhdGEsCiAgICAgICAgICAgIF9hcmdzMjggPSBhcmd1bWVudHM7CiAgICAgICAgcmV0dXJuIHJlZ2VuZXJhdG9yUnVudGltZS53cmFwKGZ1bmN0aW9uIF9jYWxsZWUyOCQoX2NvbnRleHQyOCkgewogICAgICAgICAgd2hpbGUgKDEpIHsKICAgICAgICAgICAgc3dpdGNoIChfY29udGV4dDI4LnByZXYgPSBfY29udGV4dDI4Lm5leHQpIHsKICAgICAgICAgICAgICBjYXNlIDA6CiAgICAgICAgICAgICAgICBjb250ZXh0ID0gX2FyZ3MyOC5sZW5ndGggPiAwICYmIF9hcmdzMjhbMF0gIT09IHVuZGVmaW5lZCA/IF9hcmdzMjhbMF0gOiB7fTsKICAgICAgICAgICAgICAgIGRhdGEgPSBfYXJnczI4Lmxlbmd0aCA+IDEgJiYgX2FyZ3MyOFsxXSAhPT0gdW5kZWZpbmVkID8gX2FyZ3MyOFsxXSA6IHt9OwogICAgICAgICAgICAgICAgaXNsb2FkaW5nID0gX2FyZ3MyOC5sZW5ndGggPiAyID8gX2FyZ3MyOFsyXSA6IHVuZGVmaW5lZDsKICAgICAgICAgICAgICAgIHRlbXBEYXRhID0gSlNPTi5wYXJzZShKU09OLnN0cmluZ2lmeShkYXRhKSk7CiAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQyOC5hYnJ1cHQoInJldHVybiIsIEh0dHAuZ2V0SW5zdGFuY2UoKS5nZXQoIi9waW1wZW9wbGUvZmV0Y2hrdHh5ZyIsIHRlbXBEYXRhLCBpc2xvYWRpbmcpKTsKCiAgICAgICAgICAgICAgY2FzZSA1OgogICAgICAgICAgICAgIGNhc2UgImVuZCI6CiAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQyOC5zdG9wKCk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9LCBfY2FsbGVlMjgpOwogICAgICB9KSk7CgogICAgICBmdW5jdGlvbiBGZXRjaEtUWFlHKCkgewogICAgICAgIHJldHVybiBfRmV0Y2hLVFhZRy5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwogICAgICB9CgogICAgICByZXR1cm4gRmV0Y2hLVFhZRzsKICAgIH0oKQogICAgLyoqDQogICAgICogRmV0Y2hCWUxZR+aOpeWPo+aWueazlQ0KICAgICAqDQogICAgICogQHBhcmFtIHsqfSBbY29udGV4dD17fV0NCiAgICAgKiBAcGFyYW0geyp9IFtkYXRhPXt9XQ0KICAgICAqIEBwYXJhbSB7Ym9vbGVhbn0gW2lzbG9hZGluZ10NCiAgICAgKiBAcmV0dXJucyB7UHJvbWlzZTxhbnk+fQ0KICAgICAqIEBtZW1iZXJvZiBQaW1QZXJzb25TZXJ2aWNlQmFzZQ0KICAgICAqLwoKICB9LCB7CiAgICBrZXk6ICJGZXRjaEJZTFlHIiwKICAgIHZhbHVlOiBmdW5jdGlvbiAoKSB7CiAgICAgIHZhciBfRmV0Y2hCWUxZRyA9IF9hc3luY1RvR2VuZXJhdG9yKAogICAgICAvKiNfX1BVUkVfXyovCiAgICAgIHJlZ2VuZXJhdG9yUnVudGltZS5tYXJrKGZ1bmN0aW9uIF9jYWxsZWUyOSgpIHsKICAgICAgICB2YXIgY29udGV4dCwKICAgICAgICAgICAgZGF0YSwKICAgICAgICAgICAgaXNsb2FkaW5nLAogICAgICAgICAgICB0ZW1wRGF0YSwKICAgICAgICAgICAgX2FyZ3MyOSA9IGFyZ3VtZW50czsKICAgICAgICByZXR1cm4gcmVnZW5lcmF0b3JSdW50aW1lLndyYXAoZnVuY3Rpb24gX2NhbGxlZTI5JChfY29udGV4dDI5KSB7CiAgICAgICAgICB3aGlsZSAoMSkgewogICAgICAgICAgICBzd2l0Y2ggKF9jb250ZXh0MjkucHJldiA9IF9jb250ZXh0MjkubmV4dCkgewogICAgICAgICAgICAgIGNhc2UgMDoKICAgICAgICAgICAgICAgIGNvbnRleHQgPSBfYXJnczI5Lmxlbmd0aCA+IDAgJiYgX2FyZ3MyOVswXSAhPT0gdW5kZWZpbmVkID8gX2FyZ3MyOVswXSA6IHt9OwogICAgICAgICAgICAgICAgZGF0YSA9IF9hcmdzMjkubGVuZ3RoID4gMSAmJiBfYXJnczI5WzFdICE9PSB1bmRlZmluZWQgPyBfYXJnczI5WzFdIDoge307CiAgICAgICAgICAgICAgICBpc2xvYWRpbmcgPSBfYXJnczI5Lmxlbmd0aCA+IDIgPyBfYXJnczI5WzJdIDogdW5kZWZpbmVkOwogICAgICAgICAgICAgICAgdGVtcERhdGEgPSBKU09OLnBhcnNlKEpTT04uc3RyaW5naWZ5KGRhdGEpKTsKICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDI5LmFicnVwdCgicmV0dXJuIiwgSHR0cC5nZXRJbnN0YW5jZSgpLmdldCgiL3BpbXBlb3BsZS9mZXRjaGJ5bHlnIiwgdGVtcERhdGEsIGlzbG9hZGluZykpOwoKICAgICAgICAgICAgICBjYXNlIDU6CiAgICAgICAgICAgICAgY2FzZSAiZW5kIjoKICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDI5LnN0b3AoKTsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0sIF9jYWxsZWUyOSk7CiAgICAgIH0pKTsKCiAgICAgIGZ1bmN0aW9uIEZldGNoQllMWUcoKSB7CiAgICAgICAgcmV0dXJuIF9GZXRjaEJZTFlHLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7CiAgICAgIH0KCiAgICAgIHJldHVybiBGZXRjaEJZTFlHOwogICAgfSgpCiAgICAvKioNCiAgICAgKiBGZXRjaEdCSE1D5o6l5Y+j5pa55rOVDQogICAgICoNCiAgICAgKiBAcGFyYW0geyp9IFtjb250ZXh0PXt9XQ0KICAgICAqIEBwYXJhbSB7Kn0gW2RhdGE9e31dDQogICAgICogQHBhcmFtIHtib29sZWFufSBbaXNsb2FkaW5nXQ0KICAgICAqIEByZXR1cm5zIHtQcm9taXNlPGFueT59DQogICAgICogQG1lbWJlcm9mIFBpbVBlcnNvblNlcnZpY2VCYXNlDQogICAgICovCgogIH0sIHsKICAgIGtleTogIkZldGNoR0JITUMiLAogICAgdmFsdWU6IGZ1bmN0aW9uICgpIHsKICAgICAgdmFyIF9GZXRjaEdCSE1DID0gX2FzeW5jVG9HZW5lcmF0b3IoCiAgICAgIC8qI19fUFVSRV9fKi8KICAgICAgcmVnZW5lcmF0b3JSdW50aW1lLm1hcmsoZnVuY3Rpb24gX2NhbGxlZTMwKCkgewogICAgICAgIHZhciBjb250ZXh0LAogICAgICAgICAgICBkYXRhLAogICAgICAgICAgICBpc2xvYWRpbmcsCiAgICAgICAgICAgIHRlbXBEYXRhLAogICAgICAgICAgICBfYXJnczMwID0gYXJndW1lbnRzOwogICAgICAgIHJldHVybiByZWdlbmVyYXRvclJ1bnRpbWUud3JhcChmdW5jdGlvbiBfY2FsbGVlMzAkKF9jb250ZXh0MzApIHsKICAgICAgICAgIHdoaWxlICgxKSB7CiAgICAgICAgICAgIHN3aXRjaCAoX2NvbnRleHQzMC5wcmV2ID0gX2NvbnRleHQzMC5uZXh0KSB7CiAgICAgICAgICAgICAgY2FzZSAwOgogICAgICAgICAgICAgICAgY29udGV4dCA9IF9hcmdzMzAubGVuZ3RoID4gMCAmJiBfYXJnczMwWzBdICE9PSB1bmRlZmluZWQgPyBfYXJnczMwWzBdIDoge307CiAgICAgICAgICAgICAgICBkYXRhID0gX2FyZ3MzMC5sZW5ndGggPiAxICYmIF9hcmdzMzBbMV0gIT09IHVuZGVmaW5lZCA/IF9hcmdzMzBbMV0gOiB7fTsKICAgICAgICAgICAgICAgIGlzbG9hZGluZyA9IF9hcmdzMzAubGVuZ3RoID4gMiA/IF9hcmdzMzBbMl0gOiB1bmRlZmluZWQ7CiAgICAgICAgICAgICAgICB0ZW1wRGF0YSA9IEpTT04ucGFyc2UoSlNPTi5zdHJpbmdpZnkoZGF0YSkpOwogICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0MzAuYWJydXB0KCJyZXR1cm4iLCBIdHRwLmdldEluc3RhbmNlKCkuZ2V0KCIvcGltcGVvcGxlL2ZldGNoZ2JobWMiLCB0ZW1wRGF0YSwgaXNsb2FkaW5nKSk7CgogICAgICAgICAgICAgIGNhc2UgNToKICAgICAgICAgICAgICBjYXNlICJlbmQiOgogICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0MzAuc3RvcCgpOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSwgX2NhbGxlZTMwKTsKICAgICAgfSkpOwoKICAgICAgZnVuY3Rpb24gRmV0Y2hHQkhNQygpIHsKICAgICAgICByZXR1cm4gX0ZldGNoR0JITUMuYXBwbHkodGhpcywgYXJndW1lbnRzKTsKICAgICAgfQoKICAgICAgcmV0dXJuIEZldGNoR0JITUM7CiAgICB9KCkKICAgIC8qKg0KICAgICAqIEZldGNoR1pEUUdM5o6l5Y+j5pa55rOVDQogICAgICoNCiAgICAgKiBAcGFyYW0geyp9IFtjb250ZXh0PXt9XQ0KICAgICAqIEBwYXJhbSB7Kn0gW2RhdGE9e31dDQogICAgICogQHBhcmFtIHtib29sZWFufSBbaXNsb2FkaW5nXQ0KICAgICAqIEByZXR1cm5zIHtQcm9taXNlPGFueT59DQogICAgICogQG1lbWJlcm9mIFBpbVBlcnNvblNlcnZpY2VCYXNlDQogICAgICovCgogIH0sIHsKICAgIGtleTogIkZldGNoR1pEUUdMIiwKICAgIHZhbHVlOiBmdW5jdGlvbiAoKSB7CiAgICAgIHZhciBfRmV0Y2hHWkRRR0wgPSBfYXN5bmNUb0dlbmVyYXRvcigKICAgICAgLyojX19QVVJFX18qLwogICAgICByZWdlbmVyYXRvclJ1bnRpbWUubWFyayhmdW5jdGlvbiBfY2FsbGVlMzEoKSB7CiAgICAgICAgdmFyIGNvbnRleHQsCiAgICAgICAgICAgIGRhdGEsCiAgICAgICAgICAgIGlzbG9hZGluZywKICAgICAgICAgICAgdGVtcERhdGEsCiAgICAgICAgICAgIF9hcmdzMzEgPSBhcmd1bWVudHM7CiAgICAgICAgcmV0dXJuIHJlZ2VuZXJhdG9yUnVudGltZS53cmFwKGZ1bmN0aW9uIF9jYWxsZWUzMSQoX2NvbnRleHQzMSkgewogICAgICAgICAgd2hpbGUgKDEpIHsKICAgICAgICAgICAgc3dpdGNoIChfY29udGV4dDMxLnByZXYgPSBfY29udGV4dDMxLm5leHQpIHsKICAgICAgICAgICAgICBjYXNlIDA6CiAgICAgICAgICAgICAgICBjb250ZXh0ID0gX2FyZ3MzMS5sZW5ndGggPiAwICYmIF9hcmdzMzFbMF0gIT09IHVuZGVmaW5lZCA/IF9hcmdzMzFbMF0gOiB7fTsKICAgICAgICAgICAgICAgIGRhdGEgPSBfYXJnczMxLmxlbmd0aCA+IDEgJiYgX2FyZ3MzMVsxXSAhPT0gdW5kZWZpbmVkID8gX2FyZ3MzMVsxXSA6IHt9OwogICAgICAgICAgICAgICAgaXNsb2FkaW5nID0gX2FyZ3MzMS5sZW5ndGggPiAyID8gX2FyZ3MzMVsyXSA6IHVuZGVmaW5lZDsKICAgICAgICAgICAgICAgIHRlbXBEYXRhID0gSlNPTi5wYXJzZShKU09OLnN0cmluZ2lmeShkYXRhKSk7CiAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQzMS5hYnJ1cHQoInJldHVybiIsIEh0dHAuZ2V0SW5zdGFuY2UoKS5nZXQoIi9waW1wZW9wbGUvZmV0Y2hnemRxZ2wiLCB0ZW1wRGF0YSwgaXNsb2FkaW5nKSk7CgogICAgICAgICAgICAgIGNhc2UgNToKICAgICAgICAgICAgICBjYXNlICJlbmQiOgogICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0MzEuc3RvcCgpOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSwgX2NhbGxlZTMxKTsKICAgICAgfSkpOwoKICAgICAgZnVuY3Rpb24gRmV0Y2hHWkRRR0woKSB7CiAgICAgICAgcmV0dXJuIF9GZXRjaEdaRFFHTC5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwogICAgICB9CgogICAgICByZXR1cm4gRmV0Y2hHWkRRR0w7CiAgICB9KCkKICAgIC8qKg0KICAgICAqIEZldGNoS1FKUllDWOaOpeWPo+aWueazlQ0KICAgICAqDQogICAgICogQHBhcmFtIHsqfSBbY29udGV4dD17fV0NCiAgICAgKiBAcGFyYW0geyp9IFtkYXRhPXt9XQ0KICAgICAqIEBwYXJhbSB7Ym9vbGVhbn0gW2lzbG9hZGluZ10NCiAgICAgKiBAcmV0dXJucyB7UHJvbWlzZTxhbnk+fQ0KICAgICAqIEBtZW1iZXJvZiBQaW1QZXJzb25TZXJ2aWNlQmFzZQ0KICAgICAqLwoKICB9LCB7CiAgICBrZXk6ICJGZXRjaEtRSlJZQ1giLAogICAgdmFsdWU6IGZ1bmN0aW9uICgpIHsKICAgICAgdmFyIF9GZXRjaEtRSlJZQ1ggPSBfYXN5bmNUb0dlbmVyYXRvcigKICAgICAgLyojX19QVVJFX18qLwogICAgICByZWdlbmVyYXRvclJ1bnRpbWUubWFyayhmdW5jdGlvbiBfY2FsbGVlMzIoKSB7CiAgICAgICAgdmFyIGNvbnRleHQsCiAgICAgICAgICAgIGRhdGEsCiAgICAgICAgICAgIGlzbG9hZGluZywKICAgICAgICAgICAgdGVtcERhdGEsCiAgICAgICAgICAgIF9hcmdzMzIgPSBhcmd1bWVudHM7CiAgICAgICAgcmV0dXJuIHJlZ2VuZXJhdG9yUnVudGltZS53cmFwKGZ1bmN0aW9uIF9jYWxsZWUzMiQoX2NvbnRleHQzMikgewogICAgICAgICAgd2hpbGUgKDEpIHsKICAgICAgICAgICAgc3dpdGNoIChfY29udGV4dDMyLnByZXYgPSBfY29udGV4dDMyLm5leHQpIHsKICAgICAgICAgICAgICBjYXNlIDA6CiAgICAgICAgICAgICAgICBjb250ZXh0ID0gX2FyZ3MzMi5sZW5ndGggPiAwICYmIF9hcmdzMzJbMF0gIT09IHVuZGVmaW5lZCA/IF9hcmdzMzJbMF0gOiB7fTsKICAgICAgICAgICAgICAgIGRhdGEgPSBfYXJnczMyLmxlbmd0aCA+IDEgJiYgX2FyZ3MzMlsxXSAhPT0gdW5kZWZpbmVkID8gX2FyZ3MzMlsxXSA6IHt9OwogICAgICAgICAgICAgICAgaXNsb2FkaW5nID0gX2FyZ3MzMi5sZW5ndGggPiAyID8gX2FyZ3MzMlsyXSA6IHVuZGVmaW5lZDsKICAgICAgICAgICAgICAgIHRlbXBEYXRhID0gSlNPTi5wYXJzZShKU09OLnN0cmluZ2lmeShkYXRhKSk7CiAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQzMi5hYnJ1cHQoInJldHVybiIsIEh0dHAuZ2V0SW5zdGFuY2UoKS5nZXQoIi9waW1wZW9wbGUvZmV0Y2hrcWpyeWN4IiwgdGVtcERhdGEsIGlzbG9hZGluZykpOwoKICAgICAgICAgICAgICBjYXNlIDU6CiAgICAgICAgICAgICAgY2FzZSAiZW5kIjoKICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDMyLnN0b3AoKTsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0sIF9jYWxsZWUzMik7CiAgICAgIH0pKTsKCiAgICAgIGZ1bmN0aW9uIEZldGNoS1FKUllDWCgpIHsKICAgICAgICByZXR1cm4gX0ZldGNoS1FKUllDWC5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwogICAgICB9CgogICAgICByZXR1cm4gRmV0Y2hLUUpSWUNYOwogICAgfSgpCiAgICAvKioNCiAgICAgKiBGZXRjaExUWFNUQUZG5o6l5Y+j5pa55rOVDQogICAgICoNCiAgICAgKiBAcGFyYW0geyp9IFtjb250ZXh0PXt9XQ0KICAgICAqIEBwYXJhbSB7Kn0gW2RhdGE9e31dDQogICAgICogQHBhcmFtIHtib29sZWFufSBbaXNsb2FkaW5nXQ0KICAgICAqIEByZXR1cm5zIHtQcm9taXNlPGFueT59DQogICAgICogQG1lbWJlcm9mIFBpbVBlcnNvblNlcnZpY2VCYXNlDQogICAgICovCgogIH0sIHsKICAgIGtleTogIkZldGNoTFRYU1RBRkYiLAogICAgdmFsdWU6IGZ1bmN0aW9uICgpIHsKICAgICAgdmFyIF9GZXRjaExUWFNUQUZGID0gX2FzeW5jVG9HZW5lcmF0b3IoCiAgICAgIC8qI19fUFVSRV9fKi8KICAgICAgcmVnZW5lcmF0b3JSdW50aW1lLm1hcmsoZnVuY3Rpb24gX2NhbGxlZTMzKCkgewogICAgICAgIHZhciBjb250ZXh0LAogICAgICAgICAgICBkYXRhLAogICAgICAgICAgICBpc2xvYWRpbmcsCiAgICAgICAgICAgIHRlbXBEYXRhLAogICAgICAgICAgICBfYXJnczMzID0gYXJndW1lbnRzOwogICAgICAgIHJldHVybiByZWdlbmVyYXRvclJ1bnRpbWUud3JhcChmdW5jdGlvbiBfY2FsbGVlMzMkKF9jb250ZXh0MzMpIHsKICAgICAgICAgIHdoaWxlICgxKSB7CiAgICAgICAgICAgIHN3aXRjaCAoX2NvbnRleHQzMy5wcmV2ID0gX2NvbnRleHQzMy5uZXh0KSB7CiAgICAgICAgICAgICAgY2FzZSAwOgogICAgICAgICAgICAgICAgY29udGV4dCA9IF9hcmdzMzMubGVuZ3RoID4gMCAmJiBfYXJnczMzWzBdICE9PSB1bmRlZmluZWQgPyBfYXJnczMzWzBdIDoge307CiAgICAgICAgICAgICAgICBkYXRhID0gX2FyZ3MzMy5sZW5ndGggPiAxICYmIF9hcmdzMzNbMV0gIT09IHVuZGVmaW5lZCA/IF9hcmdzMzNbMV0gOiB7fTsKICAgICAgICAgICAgICAgIGlzbG9hZGluZyA9IF9hcmdzMzMubGVuZ3RoID4gMiA/IF9hcmdzMzNbMl0gOiB1bmRlZmluZWQ7CiAgICAgICAgICAgICAgICB0ZW1wRGF0YSA9IEpTT04ucGFyc2UoSlNPTi5zdHJpbmdpZnkoZGF0YSkpOwogICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0MzMuYWJydXB0KCJyZXR1cm4iLCBIdHRwLmdldEluc3RhbmNlKCkuZ2V0KCIvcGltcGVvcGxlL2ZldGNobHR4c3RhZmYiLCB0ZW1wRGF0YSwgaXNsb2FkaW5nKSk7CgogICAgICAgICAgICAgIGNhc2UgNToKICAgICAgICAgICAgICBjYXNlICJlbmQiOgogICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0MzMuc3RvcCgpOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSwgX2NhbGxlZTMzKTsKICAgICAgfSkpOwoKICAgICAgZnVuY3Rpb24gRmV0Y2hMVFhTVEFGRigpIHsKICAgICAgICByZXR1cm4gX0ZldGNoTFRYU1RBRkYuYXBwbHkodGhpcywgYXJndW1lbnRzKTsKICAgICAgfQoKICAgICAgcmV0dXJuIEZldGNoTFRYU1RBRkY7CiAgICB9KCkKICAgIC8qKg0KICAgICAqIEZldGNoUkVQX1BFUlNPTk9SR1RZUEXmjqXlj6Pmlrnms5UNCiAgICAgKg0KICAgICAqIEBwYXJhbSB7Kn0gW2NvbnRleHQ9e31dDQogICAgICogQHBhcmFtIHsqfSBbZGF0YT17fV0NCiAgICAgKiBAcGFyYW0ge2Jvb2xlYW59IFtpc2xvYWRpbmddDQogICAgICogQHJldHVybnMge1Byb21pc2U8YW55Pn0NCiAgICAgKiBAbWVtYmVyb2YgUGltUGVyc29uU2VydmljZUJhc2UNCiAgICAgKi8KCiAgfSwgewogICAga2V5OiAiRmV0Y2hSRVBfUEVSU09OT1JHVFlQRSIsCiAgICB2YWx1ZTogZnVuY3Rpb24gKCkgewogICAgICB2YXIgX0ZldGNoUkVQX1BFUlNPTk9SR1RZUEUgPSBfYXN5bmNUb0dlbmVyYXRvcigKICAgICAgLyojX19QVVJFX18qLwogICAgICByZWdlbmVyYXRvclJ1bnRpbWUubWFyayhmdW5jdGlvbiBfY2FsbGVlMzQoKSB7CiAgICAgICAgdmFyIGNvbnRleHQsCiAgICAgICAgICAgIGRhdGEsCiAgICAgICAgICAgIGlzbG9hZGluZywKICAgICAgICAgICAgdGVtcERhdGEsCiAgICAgICAgICAgIF9hcmdzMzQgPSBhcmd1bWVudHM7CiAgICAgICAgcmV0dXJuIHJlZ2VuZXJhdG9yUnVudGltZS53cmFwKGZ1bmN0aW9uIF9jYWxsZWUzNCQoX2NvbnRleHQzNCkgewogICAgICAgICAgd2hpbGUgKDEpIHsKICAgICAgICAgICAgc3dpdGNoIChfY29udGV4dDM0LnByZXYgPSBfY29udGV4dDM0Lm5leHQpIHsKICAgICAgICAgICAgICBjYXNlIDA6CiAgICAgICAgICAgICAgICBjb250ZXh0ID0gX2FyZ3MzNC5sZW5ndGggPiAwICYmIF9hcmdzMzRbMF0gIT09IHVuZGVmaW5lZCA/IF9hcmdzMzRbMF0gOiB7fTsKICAgICAgICAgICAgICAgIGRhdGEgPSBfYXJnczM0Lmxlbmd0aCA+IDEgJiYgX2FyZ3MzNFsxXSAhPT0gdW5kZWZpbmVkID8gX2FyZ3MzNFsxXSA6IHt9OwogICAgICAgICAgICAgICAgaXNsb2FkaW5nID0gX2FyZ3MzNC5sZW5ndGggPiAyID8gX2FyZ3MzNFsyXSA6IHVuZGVmaW5lZDsKICAgICAgICAgICAgICAgIHRlbXBEYXRhID0gSlNPTi5wYXJzZShKU09OLnN0cmluZ2lmeShkYXRhKSk7CiAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQzNC5hYnJ1cHQoInJldHVybiIsIEh0dHAuZ2V0SW5zdGFuY2UoKS5nZXQoIi9waW1wZW9wbGUvZmV0Y2hyZXBfcGVyc29ub3JndHlwZSIsIHRlbXBEYXRhLCBpc2xvYWRpbmcpKTsKCiAgICAgICAgICAgICAgY2FzZSA1OgogICAgICAgICAgICAgIGNhc2UgImVuZCI6CiAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQzNC5zdG9wKCk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9LCBfY2FsbGVlMzQpOwogICAgICB9KSk7CgogICAgICBmdW5jdGlvbiBGZXRjaFJFUF9QRVJTT05PUkdUWVBFKCkgewogICAgICAgIHJldHVybiBfRmV0Y2hSRVBfUEVSU09OT1JHVFlQRS5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwogICAgICB9CgogICAgICByZXR1cm4gRmV0Y2hSRVBfUEVSU09OT1JHVFlQRTsKICAgIH0oKQogICAgLyoqDQogICAgICogRmV0Y2hBdXRoUGVyc29u5o6l5Y+j5pa55rOVDQogICAgICoNCiAgICAgKiBAcGFyYW0geyp9IFtjb250ZXh0PXt9XQ0KICAgICAqIEBwYXJhbSB7Kn0gW2RhdGE9e31dDQogICAgICogQHBhcmFtIHtib29sZWFufSBbaXNsb2FkaW5nXQ0KICAgICAqIEByZXR1cm5zIHtQcm9taXNlPGFueT59DQogICAgICogQG1lbWJlcm9mIFBpbVBlcnNvblNlcnZpY2VCYXNlDQogICAgICovCgogIH0sIHsKICAgIGtleTogIkZldGNoQXV0aFBlcnNvbiIsCiAgICB2YWx1ZTogZnVuY3Rpb24gKCkgewogICAgICB2YXIgX0ZldGNoQXV0aFBlcnNvbiA9IF9hc3luY1RvR2VuZXJhdG9yKAogICAgICAvKiNfX1BVUkVfXyovCiAgICAgIHJlZ2VuZXJhdG9yUnVudGltZS5tYXJrKGZ1bmN0aW9uIF9jYWxsZWUzNSgpIHsKICAgICAgICB2YXIgY29udGV4dCwKICAgICAgICAgICAgZGF0YSwKICAgICAgICAgICAgaXNsb2FkaW5nLAogICAgICAgICAgICB0ZW1wRGF0YSwKICAgICAgICAgICAgX2FyZ3MzNSA9IGFyZ3VtZW50czsKICAgICAgICByZXR1cm4gcmVnZW5lcmF0b3JSdW50aW1lLndyYXAoZnVuY3Rpb24gX2NhbGxlZTM1JChfY29udGV4dDM1KSB7CiAgICAgICAgICB3aGlsZSAoMSkgewogICAgICAgICAgICBzd2l0Y2ggKF9jb250ZXh0MzUucHJldiA9IF9jb250ZXh0MzUubmV4dCkgewogICAgICAgICAgICAgIGNhc2UgMDoKICAgICAgICAgICAgICAgIGNvbnRleHQgPSBfYXJnczM1Lmxlbmd0aCA+IDAgJiYgX2FyZ3MzNVswXSAhPT0gdW5kZWZpbmVkID8gX2FyZ3MzNVswXSA6IHt9OwogICAgICAgICAgICAgICAgZGF0YSA9IF9hcmdzMzUubGVuZ3RoID4gMSAmJiBfYXJnczM1WzFdICE9PSB1bmRlZmluZWQgPyBfYXJnczM1WzFdIDoge307CiAgICAgICAgICAgICAgICBpc2xvYWRpbmcgPSBfYXJnczM1Lmxlbmd0aCA+IDIgPyBfYXJnczM1WzJdIDogdW5kZWZpbmVkOwogICAgICAgICAgICAgICAgdGVtcERhdGEgPSBKU09OLnBhcnNlKEpTT04uc3RyaW5naWZ5KGRhdGEpKTsKICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDM1LmFicnVwdCgicmV0dXJuIiwgSHR0cC5nZXRJbnN0YW5jZSgpLmdldCgiL3BpbXBlb3BsZS9mZXRjaGF1dGhwZXJzb24iLCB0ZW1wRGF0YSwgaXNsb2FkaW5nKSk7CgogICAgICAgICAgICAgIGNhc2UgNToKICAgICAgICAgICAgICBjYXNlICJlbmQiOgogICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0MzUuc3RvcCgpOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSwgX2NhbGxlZTM1KTsKICAgICAgfSkpOwoKICAgICAgZnVuY3Rpb24gRmV0Y2hBdXRoUGVyc29uKCkgewogICAgICAgIHJldHVybiBfRmV0Y2hBdXRoUGVyc29uLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7CiAgICAgIH0KCiAgICAgIHJldHVybiBGZXRjaEF1dGhQZXJzb247CiAgICB9KCkKICAgIC8qKg0KICAgICAqIEZldGNoRGVmYXVsdOaOpeWPo+aWueazlQ0KICAgICAqDQogICAgICogQHBhcmFtIHsqfSBbY29udGV4dD17fV0NCiAgICAgKiBAcGFyYW0geyp9IFtkYXRhPXt9XQ0KICAgICAqIEBwYXJhbSB7Ym9vbGVhbn0gW2lzbG9hZGluZ10NCiAgICAgKiBAcmV0dXJucyB7UHJvbWlzZTxhbnk+fQ0KICAgICAqIEBtZW1iZXJvZiBQaW1QZXJzb25TZXJ2aWNlQmFzZQ0KICAgICAqLwoKICB9LCB7CiAgICBrZXk6ICJGZXRjaERlZmF1bHQiLAogICAgdmFsdWU6IGZ1bmN0aW9uICgpIHsKICAgICAgdmFyIF9GZXRjaERlZmF1bHQgPSBfYXN5bmNUb0dlbmVyYXRvcigKICAgICAgLyojX19QVVJFX18qLwogICAgICByZWdlbmVyYXRvclJ1bnRpbWUubWFyayhmdW5jdGlvbiBfY2FsbGVlMzYoKSB7CiAgICAgICAgdmFyIGNvbnRleHQsCiAgICAgICAgICAgIGRhdGEsCiAgICAgICAgICAgIGlzbG9hZGluZywKICAgICAgICAgICAgdGVtcERhdGEsCiAgICAgICAgICAgIF9hcmdzMzYgPSBhcmd1bWVudHM7CiAgICAgICAgcmV0dXJuIHJlZ2VuZXJhdG9yUnVudGltZS53cmFwKGZ1bmN0aW9uIF9jYWxsZWUzNiQoX2NvbnRleHQzNikgewogICAgICAgICAgd2hpbGUgKDEpIHsKICAgICAgICAgICAgc3dpdGNoIChfY29udGV4dDM2LnByZXYgPSBfY29udGV4dDM2Lm5leHQpIHsKICAgICAgICAgICAgICBjYXNlIDA6CiAgICAgICAgICAgICAgICBjb250ZXh0ID0gX2FyZ3MzNi5sZW5ndGggPiAwICYmIF9hcmdzMzZbMF0gIT09IHVuZGVmaW5lZCA/IF9hcmdzMzZbMF0gOiB7fTsKICAgICAgICAgICAgICAgIGRhdGEgPSBfYXJnczM2Lmxlbmd0aCA+IDEgJiYgX2FyZ3MzNlsxXSAhPT0gdW5kZWZpbmVkID8gX2FyZ3MzNlsxXSA6IHt9OwogICAgICAgICAgICAgICAgaXNsb2FkaW5nID0gX2FyZ3MzNi5sZW5ndGggPiAyID8gX2FyZ3MzNlsyXSA6IHVuZGVmaW5lZDsKICAgICAgICAgICAgICAgIHRlbXBEYXRhID0gSlNPTi5wYXJzZShKU09OLnN0cmluZ2lmeShkYXRhKSk7CiAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQzNi5hYnJ1cHQoInJldHVybiIsIEh0dHAuZ2V0SW5zdGFuY2UoKS5nZXQoIi9waW1wZW9wbGUvZmV0Y2hkZWZhdWx0IiwgdGVtcERhdGEsIGlzbG9hZGluZykpOwoKICAgICAgICAgICAgICBjYXNlIDU6CiAgICAgICAgICAgICAgY2FzZSAiZW5kIjoKICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDM2LnN0b3AoKTsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0sIF9jYWxsZWUzNik7CiAgICAgIH0pKTsKCiAgICAgIGZ1bmN0aW9uIEZldGNoRGVmYXVsdCgpIHsKICAgICAgICByZXR1cm4gX0ZldGNoRGVmYXVsdC5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwogICAgICB9CgogICAgICByZXR1cm4gRmV0Y2hEZWZhdWx0OwogICAgfSgpCiAgICAvKioNCiAgICAgKiBGZXRjaEtHWlJZ5o6l5Y+j5pa55rOVDQogICAgICoNCiAgICAgKiBAcGFyYW0geyp9IFtjb250ZXh0PXt9XQ0KICAgICAqIEBwYXJhbSB7Kn0gW2RhdGE9e31dDQogICAgICogQHBhcmFtIHtib29sZWFufSBbaXNsb2FkaW5nXQ0KICAgICAqIEByZXR1cm5zIHtQcm9taXNlPGFueT59DQogICAgICogQG1lbWJlcm9mIFBpbVBlcnNvblNlcnZpY2VCYXNlDQogICAgICovCgogIH0sIHsKICAgIGtleTogIkZldGNoS0daUlkiLAogICAgdmFsdWU6IGZ1bmN0aW9uICgpIHsKICAgICAgdmFyIF9GZXRjaEtHWlJZID0gX2FzeW5jVG9HZW5lcmF0b3IoCiAgICAgIC8qI19fUFVSRV9fKi8KICAgICAgcmVnZW5lcmF0b3JSdW50aW1lLm1hcmsoZnVuY3Rpb24gX2NhbGxlZTM3KCkgewogICAgICAgIHZhciBjb250ZXh0LAogICAgICAgICAgICBkYXRhLAogICAgICAgICAgICBpc2xvYWRpbmcsCiAgICAgICAgICAgIHRlbXBEYXRhLAogICAgICAgICAgICBfYXJnczM3ID0gYXJndW1lbnRzOwogICAgICAgIHJldHVybiByZWdlbmVyYXRvclJ1bnRpbWUud3JhcChmdW5jdGlvbiBfY2FsbGVlMzckKF9jb250ZXh0MzcpIHsKICAgICAgICAgIHdoaWxlICgxKSB7CiAgICAgICAgICAgIHN3aXRjaCAoX2NvbnRleHQzNy5wcmV2ID0gX2NvbnRleHQzNy5uZXh0KSB7CiAgICAgICAgICAgICAgY2FzZSAwOgogICAgICAgICAgICAgICAgY29udGV4dCA9IF9hcmdzMzcubGVuZ3RoID4gMCAmJiBfYXJnczM3WzBdICE9PSB1bmRlZmluZWQgPyBfYXJnczM3WzBdIDoge307CiAgICAgICAgICAgICAgICBkYXRhID0gX2FyZ3MzNy5sZW5ndGggPiAxICYmIF9hcmdzMzdbMV0gIT09IHVuZGVmaW5lZCA/IF9hcmdzMzdbMV0gOiB7fTsKICAgICAgICAgICAgICAgIGlzbG9hZGluZyA9IF9hcmdzMzcubGVuZ3RoID4gMiA/IF9hcmdzMzdbMl0gOiB1bmRlZmluZWQ7CiAgICAgICAgICAgICAgICB0ZW1wRGF0YSA9IEpTT04ucGFyc2UoSlNPTi5zdHJpbmdpZnkoZGF0YSkpOwogICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0MzcuYWJydXB0KCJyZXR1cm4iLCBIdHRwLmdldEluc3RhbmNlKCkuZ2V0KCIvcGltcGVvcGxlL2ZldGNoa2d6cnkiLCB0ZW1wRGF0YSwgaXNsb2FkaW5nKSk7CgogICAgICAgICAgICAgIGNhc2UgNToKICAgICAgICAgICAgICBjYXNlICJlbmQiOgogICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0Mzcuc3RvcCgpOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSwgX2NhbGxlZTM3KTsKICAgICAgfSkpOwoKICAgICAgZnVuY3Rpb24gRmV0Y2hLR1pSWSgpIHsKICAgICAgICByZXR1cm4gX0ZldGNoS0daUlkuYXBwbHkodGhpcywgYXJndW1lbnRzKTsKICAgICAgfQoKICAgICAgcmV0dXJuIEZldGNoS0daUlk7CiAgICB9KCkKICAgIC8qKg0KICAgICAqIEZldGNoU0VMRkhFTFBJROaOpeWPo+aWueazlQ0KICAgICAqDQogICAgICogQHBhcmFtIHsqfSBbY29udGV4dD17fV0NCiAgICAgKiBAcGFyYW0geyp9IFtkYXRhPXt9XQ0KICAgICAqIEBwYXJhbSB7Ym9vbGVhbn0gW2lzbG9hZGluZ10NCiAgICAgKiBAcmV0dXJucyB7UHJvbWlzZTxhbnk+fQ0KICAgICAqIEBtZW1iZXJvZiBQaW1QZXJzb25TZXJ2aWNlQmFzZQ0KICAgICAqLwoKICB9LCB7CiAgICBrZXk6ICJGZXRjaFNFTEZIRUxQSUQiLAogICAgdmFsdWU6IGZ1bmN0aW9uICgpIHsKICAgICAgdmFyIF9GZXRjaFNFTEZIRUxQSUQgPSBfYXN5bmNUb0dlbmVyYXRvcigKICAgICAgLyojX19QVVJFX18qLwogICAgICByZWdlbmVyYXRvclJ1bnRpbWUubWFyayhmdW5jdGlvbiBfY2FsbGVlMzgoKSB7CiAgICAgICAgdmFyIGNvbnRleHQsCiAgICAgICAgICAgIGRhdGEsCiAgICAgICAgICAgIGlzbG9hZGluZywKICAgICAgICAgICAgdGVtcERhdGEsCiAgICAgICAgICAgIF9hcmdzMzggPSBhcmd1bWVudHM7CiAgICAgICAgcmV0dXJuIHJlZ2VuZXJhdG9yUnVudGltZS53cmFwKGZ1bmN0aW9uIF9jYWxsZWUzOCQoX2NvbnRleHQzOCkgewogICAgICAgICAgd2hpbGUgKDEpIHsKICAgICAgICAgICAgc3dpdGNoIChfY29udGV4dDM4LnByZXYgPSBfY29udGV4dDM4Lm5leHQpIHsKICAgICAgICAgICAgICBjYXNlIDA6CiAgICAgICAgICAgICAgICBjb250ZXh0ID0gX2FyZ3MzOC5sZW5ndGggPiAwICYmIF9hcmdzMzhbMF0gIT09IHVuZGVmaW5lZCA/IF9hcmdzMzhbMF0gOiB7fTsKICAgICAgICAgICAgICAgIGRhdGEgPSBfYXJnczM4Lmxlbmd0aCA+IDEgJiYgX2FyZ3MzOFsxXSAhPT0gdW5kZWZpbmVkID8gX2FyZ3MzOFsxXSA6IHt9OwogICAgICAgICAgICAgICAgaXNsb2FkaW5nID0gX2FyZ3MzOC5sZW5ndGggPiAyID8gX2FyZ3MzOFsyXSA6IHVuZGVmaW5lZDsKICAgICAgICAgICAgICAgIHRlbXBEYXRhID0gSlNPTi5wYXJzZShKU09OLnN0cmluZ2lmeShkYXRhKSk7CiAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQzOC5hYnJ1cHQoInJldHVybiIsIEh0dHAuZ2V0SW5zdGFuY2UoKS5nZXQoIi9waW1wZW9wbGUvZmV0Y2hzZWxmaGVscGlkIiwgdGVtcERhdGEsIGlzbG9hZGluZykpOwoKICAgICAgICAgICAgICBjYXNlIDU6CiAgICAgICAgICAgICAgY2FzZSAiZW5kIjoKICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDM4LnN0b3AoKTsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0sIF9jYWxsZWUzOCk7CiAgICAgIH0pKTsKCiAgICAgIGZ1bmN0aW9uIEZldGNoU0VMRkhFTFBJRCgpIHsKICAgICAgICByZXR1cm4gX0ZldGNoU0VMRkhFTFBJRC5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwogICAgICB9CgogICAgICByZXR1cm4gRmV0Y2hTRUxGSEVMUElEOwogICAgfSgpCiAgICAvKioNCiAgICAgKiBGZXRjaFNZUVlHQ1jmjqXlj6Pmlrnms5UNCiAgICAgKg0KICAgICAqIEBwYXJhbSB7Kn0gW2NvbnRleHQ9e31dDQogICAgICogQHBhcmFtIHsqfSBbZGF0YT17fV0NCiAgICAgKiBAcGFyYW0ge2Jvb2xlYW59IFtpc2xvYWRpbmddDQogICAgICogQHJldHVybnMge1Byb21pc2U8YW55Pn0NCiAgICAgKiBAbWVtYmVyb2YgUGltUGVyc29uU2VydmljZUJhc2UNCiAgICAgKi8KCiAgfSwgewogICAga2V5OiAiRmV0Y2hTWVFZR0NYIiwKICAgIHZhbHVlOiBmdW5jdGlvbiAoKSB7CiAgICAgIHZhciBfRmV0Y2hTWVFZR0NYID0gX2FzeW5jVG9HZW5lcmF0b3IoCiAgICAgIC8qI19fUFVSRV9fKi8KICAgICAgcmVnZW5lcmF0b3JSdW50aW1lLm1hcmsoZnVuY3Rpb24gX2NhbGxlZTM5KCkgewogICAgICAgIHZhciBjb250ZXh0LAogICAgICAgICAgICBkYXRhLAogICAgICAgICAgICBpc2xvYWRpbmcsCiAgICAgICAgICAgIHRlbXBEYXRhLAogICAgICAgICAgICBfYXJnczM5ID0gYXJndW1lbnRzOwogICAgICAgIHJldHVybiByZWdlbmVyYXRvclJ1bnRpbWUud3JhcChmdW5jdGlvbiBfY2FsbGVlMzkkKF9jb250ZXh0MzkpIHsKICAgICAgICAgIHdoaWxlICgxKSB7CiAgICAgICAgICAgIHN3aXRjaCAoX2NvbnRleHQzOS5wcmV2ID0gX2NvbnRleHQzOS5uZXh0KSB7CiAgICAgICAgICAgICAgY2FzZSAwOgogICAgICAgICAgICAgICAgY29udGV4dCA9IF9hcmdzMzkubGVuZ3RoID4gMCAmJiBfYXJnczM5WzBdICE9PSB1bmRlZmluZWQgPyBfYXJnczM5WzBdIDoge307CiAgICAgICAgICAgICAgICBkYXRhID0gX2FyZ3MzOS5sZW5ndGggPiAxICYmIF9hcmdzMzlbMV0gIT09IHVuZGVmaW5lZCA/IF9hcmdzMzlbMV0gOiB7fTsKICAgICAgICAgICAgICAgIGlzbG9hZGluZyA9IF9hcmdzMzkubGVuZ3RoID4gMiA/IF9hcmdzMzlbMl0gOiB1bmRlZmluZWQ7CiAgICAgICAgICAgICAgICB0ZW1wRGF0YSA9IEpTT04ucGFyc2UoSlNPTi5zdHJpbmdpZnkoZGF0YSkpOwogICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0MzkuYWJydXB0KCJyZXR1cm4iLCBIdHRwLmdldEluc3RhbmNlKCkuZ2V0KCIvcGltcGVvcGxlL2ZldGNoc3lxeWdjeCIsIHRlbXBEYXRhLCBpc2xvYWRpbmcpKTsKCiAgICAgICAgICAgICAgY2FzZSA1OgogICAgICAgICAgICAgIGNhc2UgImVuZCI6CiAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQzOS5zdG9wKCk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9LCBfY2FsbGVlMzkpOwogICAgICB9KSk7CgogICAgICBmdW5jdGlvbiBGZXRjaFNZUVlHQ1goKSB7CiAgICAgICAgcmV0dXJuIF9GZXRjaFNZUVlHQ1guYXBwbHkodGhpcywgYXJndW1lbnRzKTsKICAgICAgfQoKICAgICAgcmV0dXJuIEZldGNoU1lRWUdDWDsKICAgIH0oKQogICAgLyoqDQogICAgICogRmV0Y2hMWlJZSE1D5o6l5Y+j5pa55rOVDQogICAgICoNCiAgICAgKiBAcGFyYW0geyp9IFtjb250ZXh0PXt9XQ0KICAgICAqIEBwYXJhbSB7Kn0gW2RhdGE9e31dDQogICAgICogQHBhcmFtIHtib29sZWFufSBbaXNsb2FkaW5nXQ0KICAgICAqIEByZXR1cm5zIHtQcm9taXNlPGFueT59DQogICAgICogQG1lbWJlcm9mIFBpbVBlcnNvblNlcnZpY2VCYXNlDQogICAgICovCgogIH0sIHsKICAgIGtleTogIkZldGNoTFpSWUhNQyIsCiAgICB2YWx1ZTogZnVuY3Rpb24gKCkgewogICAgICB2YXIgX0ZldGNoTFpSWUhNQyA9IF9hc3luY1RvR2VuZXJhdG9yKAogICAgICAvKiNfX1BVUkVfXyovCiAgICAgIHJlZ2VuZXJhdG9yUnVudGltZS5tYXJrKGZ1bmN0aW9uIF9jYWxsZWU0MCgpIHsKICAgICAgICB2YXIgY29udGV4dCwKICAgICAgICAgICAgZGF0YSwKICAgICAgICAgICAgaXNsb2FkaW5nLAogICAgICAgICAgICB0ZW1wRGF0YSwKICAgICAgICAgICAgX2FyZ3M0MCA9IGFyZ3VtZW50czsKICAgICAgICByZXR1cm4gcmVnZW5lcmF0b3JSdW50aW1lLndyYXAoZnVuY3Rpb24gX2NhbGxlZTQwJChfY29udGV4dDQwKSB7CiAgICAgICAgICB3aGlsZSAoMSkgewogICAgICAgICAgICBzd2l0Y2ggKF9jb250ZXh0NDAucHJldiA9IF9jb250ZXh0NDAubmV4dCkgewogICAgICAgICAgICAgIGNhc2UgMDoKICAgICAgICAgICAgICAgIGNvbnRleHQgPSBfYXJnczQwLmxlbmd0aCA+IDAgJiYgX2FyZ3M0MFswXSAhPT0gdW5kZWZpbmVkID8gX2FyZ3M0MFswXSA6IHt9OwogICAgICAgICAgICAgICAgZGF0YSA9IF9hcmdzNDAubGVuZ3RoID4gMSAmJiBfYXJnczQwWzFdICE9PSB1bmRlZmluZWQgPyBfYXJnczQwWzFdIDoge307CiAgICAgICAgICAgICAgICBpc2xvYWRpbmcgPSBfYXJnczQwLmxlbmd0aCA+IDIgPyBfYXJnczQwWzJdIDogdW5kZWZpbmVkOwogICAgICAgICAgICAgICAgdGVtcERhdGEgPSBKU09OLnBhcnNlKEpTT04uc3RyaW5naWZ5KGRhdGEpKTsKICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDQwLmFicnVwdCgicmV0dXJuIiwgSHR0cC5nZXRJbnN0YW5jZSgpLmdldCgiL3BpbXBlb3BsZS9mZXRjaGx6cnlobWMiLCB0ZW1wRGF0YSwgaXNsb2FkaW5nKSk7CgogICAgICAgICAgICAgIGNhc2UgNToKICAgICAgICAgICAgICBjYXNlICJlbmQiOgogICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0NDAuc3RvcCgpOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSwgX2NhbGxlZTQwKTsKICAgICAgfSkpOwoKICAgICAgZnVuY3Rpb24gRmV0Y2hMWlJZSE1DKCkgewogICAgICAgIHJldHVybiBfRmV0Y2hMWlJZSE1DLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7CiAgICAgIH0KCiAgICAgIHJldHVybiBGZXRjaExaUllITUM7CiAgICB9KCkKICAgIC8qKg0KICAgICAqIEZldGNoVGl0bGVVc2XmjqXlj6Pmlrnms5UNCiAgICAgKg0KICAgICAqIEBwYXJhbSB7Kn0gW2NvbnRleHQ9e31dDQogICAgICogQHBhcmFtIHsqfSBbZGF0YT17fV0NCiAgICAgKiBAcGFyYW0ge2Jvb2xlYW59IFtpc2xvYWRpbmddDQogICAgICogQHJldHVybnMge1Byb21pc2U8YW55Pn0NCiAgICAgKiBAbWVtYmVyb2YgUGltUGVyc29uU2VydmljZUJhc2UNCiAgICAgKi8KCiAgfSwgewogICAga2V5OiAiRmV0Y2hUaXRsZVVzZSIsCiAgICB2YWx1ZTogZnVuY3Rpb24gKCkgewogICAgICB2YXIgX0ZldGNoVGl0bGVVc2UgPSBfYXN5bmNUb0dlbmVyYXRvcigKICAgICAgLyojX19QVVJFX18qLwogICAgICByZWdlbmVyYXRvclJ1bnRpbWUubWFyayhmdW5jdGlvbiBfY2FsbGVlNDEoKSB7CiAgICAgICAgdmFyIGNvbnRleHQsCiAgICAgICAgICAgIGRhdGEsCiAgICAgICAgICAgIGlzbG9hZGluZywKICAgICAgICAgICAgdGVtcERhdGEsCiAgICAgICAgICAgIF9hcmdzNDEgPSBhcmd1bWVudHM7CiAgICAgICAgcmV0dXJuIHJlZ2VuZXJhdG9yUnVudGltZS53cmFwKGZ1bmN0aW9uIF9jYWxsZWU0MSQoX2NvbnRleHQ0MSkgewogICAgICAgICAgd2hpbGUgKDEpIHsKICAgICAgICAgICAgc3dpdGNoIChfY29udGV4dDQxLnByZXYgPSBfY29udGV4dDQxLm5leHQpIHsKICAgICAgICAgICAgICBjYXNlIDA6CiAgICAgICAgICAgICAgICBjb250ZXh0ID0gX2FyZ3M0MS5sZW5ndGggPiAwICYmIF9hcmdzNDFbMF0gIT09IHVuZGVmaW5lZCA/IF9hcmdzNDFbMF0gOiB7fTsKICAgICAgICAgICAgICAgIGRhdGEgPSBfYXJnczQxLmxlbmd0aCA+IDEgJiYgX2FyZ3M0MVsxXSAhPT0gdW5kZWZpbmVkID8gX2FyZ3M0MVsxXSA6IHt9OwogICAgICAgICAgICAgICAgaXNsb2FkaW5nID0gX2FyZ3M0MS5sZW5ndGggPiAyID8gX2FyZ3M0MVsyXSA6IHVuZGVmaW5lZDsKICAgICAgICAgICAgICAgIHRlbXBEYXRhID0gSlNPTi5wYXJzZShKU09OLnN0cmluZ2lmeShkYXRhKSk7CiAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQ0MS5hYnJ1cHQoInJldHVybiIsIEh0dHAuZ2V0SW5zdGFuY2UoKS5nZXQoIi9waW1wZW9wbGUvZmV0Y2h0aXRsZXVzZSIsIHRlbXBEYXRhLCBpc2xvYWRpbmcpKTsKCiAgICAgICAgICAgICAgY2FzZSA1OgogICAgICAgICAgICAgIGNhc2UgImVuZCI6CiAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQ0MS5zdG9wKCk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9LCBfY2FsbGVlNDEpOwogICAgICB9KSk7CgogICAgICBmdW5jdGlvbiBGZXRjaFRpdGxlVXNlKCkgewogICAgICAgIHJldHVybiBfRmV0Y2hUaXRsZVVzZS5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwogICAgICB9CgogICAgICByZXR1cm4gRmV0Y2hUaXRsZVVzZTsKICAgIH0oKQogICAgLyoqDQogICAgICogRmV0Y2hKWFFZR0NY5o6l5Y+j5pa55rOVDQogICAgICoNCiAgICAgKiBAcGFyYW0geyp9IFtjb250ZXh0PXt9XQ0KICAgICAqIEBwYXJhbSB7Kn0gW2RhdGE9e31dDQogICAgICogQHBhcmFtIHtib29sZWFufSBbaXNsb2FkaW5nXQ0KICAgICAqIEByZXR1cm5zIHtQcm9taXNlPGFueT59DQogICAgICogQG1lbWJlcm9mIFBpbVBlcnNvblNlcnZpY2VCYXNlDQogICAgICovCgogIH0sIHsKICAgIGtleTogIkZldGNoSlhRWUdDWCIsCiAgICB2YWx1ZTogZnVuY3Rpb24gKCkgewogICAgICB2YXIgX0ZldGNoSlhRWUdDWCA9IF9hc3luY1RvR2VuZXJhdG9yKAogICAgICAvKiNfX1BVUkVfXyovCiAgICAgIHJlZ2VuZXJhdG9yUnVudGltZS5tYXJrKGZ1bmN0aW9uIF9jYWxsZWU0MigpIHsKICAgICAgICB2YXIgY29udGV4dCwKICAgICAgICAgICAgZGF0YSwKICAgICAgICAgICAgaXNsb2FkaW5nLAogICAgICAgICAgICB0ZW1wRGF0YSwKICAgICAgICAgICAgX2FyZ3M0MiA9IGFyZ3VtZW50czsKICAgICAgICByZXR1cm4gcmVnZW5lcmF0b3JSdW50aW1lLndyYXAoZnVuY3Rpb24gX2NhbGxlZTQyJChfY29udGV4dDQyKSB7CiAgICAgICAgICB3aGlsZSAoMSkgewogICAgICAgICAgICBzd2l0Y2ggKF9jb250ZXh0NDIucHJldiA9IF9jb250ZXh0NDIubmV4dCkgewogICAgICAgICAgICAgIGNhc2UgMDoKICAgICAgICAgICAgICAgIGNvbnRleHQgPSBfYXJnczQyLmxlbmd0aCA+IDAgJiYgX2FyZ3M0MlswXSAhPT0gdW5kZWZpbmVkID8gX2FyZ3M0MlswXSA6IHt9OwogICAgICAgICAgICAgICAgZGF0YSA9IF9hcmdzNDIubGVuZ3RoID4gMSAmJiBfYXJnczQyWzFdICE9PSB1bmRlZmluZWQgPyBfYXJnczQyWzFdIDoge307CiAgICAgICAgICAgICAgICBpc2xvYWRpbmcgPSBfYXJnczQyLmxlbmd0aCA+IDIgPyBfYXJnczQyWzJdIDogdW5kZWZpbmVkOwogICAgICAgICAgICAgICAgdGVtcERhdGEgPSBKU09OLnBhcnNlKEpTT04uc3RyaW5naWZ5KGRhdGEpKTsKICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDQyLmFicnVwdCgicmV0dXJuIiwgSHR0cC5nZXRJbnN0YW5jZSgpLmdldCgiL3BpbXBlb3BsZS9mZXRjaGp4cXlnY3giLCB0ZW1wRGF0YSwgaXNsb2FkaW5nKSk7CgogICAgICAgICAgICAgIGNhc2UgNToKICAgICAgICAgICAgICBjYXNlICJlbmQiOgogICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0NDIuc3RvcCgpOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSwgX2NhbGxlZTQyKTsKICAgICAgfSkpOwoKICAgICAgZnVuY3Rpb24gRmV0Y2hKWFFZR0NYKCkgewogICAgICAgIHJldHVybiBfRmV0Y2hKWFFZR0NYLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7CiAgICAgIH0KCiAgICAgIHJldHVybiBGZXRjaEpYUVlHQ1g7CiAgICB9KCkKICAgIC8qKg0KICAgICAqIEZldGNoWVhaRlBSWURT5o6l5Y+j5pa55rOVDQogICAgICoNCiAgICAgKiBAcGFyYW0geyp9IFtjb250ZXh0PXt9XQ0KICAgICAqIEBwYXJhbSB7Kn0gW2RhdGE9e31dDQogICAgICogQHBhcmFtIHtib29sZWFufSBbaXNsb2FkaW5nXQ0KICAgICAqIEByZXR1cm5zIHtQcm9taXNlPGFueT59DQogICAgICogQG1lbWJlcm9mIFBpbVBlcnNvblNlcnZpY2VCYXNlDQogICAgICovCgogIH0sIHsKICAgIGtleTogIkZldGNoWVhaRlBSWURTIiwKICAgIHZhbHVlOiBmdW5jdGlvbiAoKSB7CiAgICAgIHZhciBfRmV0Y2hZWFpGUFJZRFMgPSBfYXN5bmNUb0dlbmVyYXRvcigKICAgICAgLyojX19QVVJFX18qLwogICAgICByZWdlbmVyYXRvclJ1bnRpbWUubWFyayhmdW5jdGlvbiBfY2FsbGVlNDMoKSB7CiAgICAgICAgdmFyIGNvbnRleHQsCiAgICAgICAgICAgIGRhdGEsCiAgICAgICAgICAgIGlzbG9hZGluZywKICAgICAgICAgICAgdGVtcERhdGEsCiAgICAgICAgICAgIF9hcmdzNDMgPSBhcmd1bWVudHM7CiAgICAgICAgcmV0dXJuIHJlZ2VuZXJhdG9yUnVudGltZS53cmFwKGZ1bmN0aW9uIF9jYWxsZWU0MyQoX2NvbnRleHQ0MykgewogICAgICAgICAgd2hpbGUgKDEpIHsKICAgICAgICAgICAgc3dpdGNoIChfY29udGV4dDQzLnByZXYgPSBfY29udGV4dDQzLm5leHQpIHsKICAgICAgICAgICAgICBjYXNlIDA6CiAgICAgICAgICAgICAgICBjb250ZXh0ID0gX2FyZ3M0My5sZW5ndGggPiAwICYmIF9hcmdzNDNbMF0gIT09IHVuZGVmaW5lZCA/IF9hcmdzNDNbMF0gOiB7fTsKICAgICAgICAgICAgICAgIGRhdGEgPSBfYXJnczQzLmxlbmd0aCA+IDEgJiYgX2FyZ3M0M1sxXSAhPT0gdW5kZWZpbmVkID8gX2FyZ3M0M1sxXSA6IHt9OwogICAgICAgICAgICAgICAgaXNsb2FkaW5nID0gX2FyZ3M0My5sZW5ndGggPiAyID8gX2FyZ3M0M1syXSA6IHVuZGVmaW5lZDsKICAgICAgICAgICAgICAgIHRlbXBEYXRhID0gSlNPTi5wYXJzZShKU09OLnN0cmluZ2lmeShkYXRhKSk7CiAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQ0My5hYnJ1cHQoInJldHVybiIsIEh0dHAuZ2V0SW5zdGFuY2UoKS5nZXQoIi9waW1wZW9wbGUvZmV0Y2h5eHpmcHJ5ZHMiLCB0ZW1wRGF0YSwgaXNsb2FkaW5nKSk7CgogICAgICAgICAgICAgIGNhc2UgNToKICAgICAgICAgICAgICBjYXNlICJlbmQiOgogICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0NDMuc3RvcCgpOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSwgX2NhbGxlZTQzKTsKICAgICAgfSkpOwoKICAgICAgZnVuY3Rpb24gRmV0Y2hZWFpGUFJZRFMoKSB7CiAgICAgICAgcmV0dXJuIF9GZXRjaFlYWkZQUllEUy5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwogICAgICB9CgogICAgICByZXR1cm4gRmV0Y2hZWFpGUFJZRFM7CiAgICB9KCkKICAgIC8qKg0KICAgICAqIEZldGNoUllaVF8zMOaOpeWPo+aWueazlQ0KICAgICAqDQogICAgICogQHBhcmFtIHsqfSBbY29udGV4dD17fV0NCiAgICAgKiBAcGFyYW0geyp9IFtkYXRhPXt9XQ0KICAgICAqIEBwYXJhbSB7Ym9vbGVhbn0gW2lzbG9hZGluZ10NCiAgICAgKiBAcmV0dXJucyB7UHJvbWlzZTxhbnk+fQ0KICAgICAqIEBtZW1iZXJvZiBQaW1QZXJzb25TZXJ2aWNlQmFzZQ0KICAgICAqLwoKICB9LCB7CiAgICBrZXk6ICJGZXRjaFJZWlRfMzAiLAogICAgdmFsdWU6IGZ1bmN0aW9uICgpIHsKICAgICAgdmFyIF9GZXRjaFJZWlRfID0gX2FzeW5jVG9HZW5lcmF0b3IoCiAgICAgIC8qI19fUFVSRV9fKi8KICAgICAgcmVnZW5lcmF0b3JSdW50aW1lLm1hcmsoZnVuY3Rpb24gX2NhbGxlZTQ0KCkgewogICAgICAgIHZhciBjb250ZXh0LAogICAgICAgICAgICBkYXRhLAogICAgICAgICAgICBpc2xvYWRpbmcsCiAgICAgICAgICAgIHRlbXBEYXRhLAogICAgICAgICAgICBfYXJnczQ0ID0gYXJndW1lbnRzOwogICAgICAgIHJldHVybiByZWdlbmVyYXRvclJ1bnRpbWUud3JhcChmdW5jdGlvbiBfY2FsbGVlNDQkKF9jb250ZXh0NDQpIHsKICAgICAgICAgIHdoaWxlICgxKSB7CiAgICAgICAgICAgIHN3aXRjaCAoX2NvbnRleHQ0NC5wcmV2ID0gX2NvbnRleHQ0NC5uZXh0KSB7CiAgICAgICAgICAgICAgY2FzZSAwOgogICAgICAgICAgICAgICAgY29udGV4dCA9IF9hcmdzNDQubGVuZ3RoID4gMCAmJiBfYXJnczQ0WzBdICE9PSB1bmRlZmluZWQgPyBfYXJnczQ0WzBdIDoge307CiAgICAgICAgICAgICAgICBkYXRhID0gX2FyZ3M0NC5sZW5ndGggPiAxICYmIF9hcmdzNDRbMV0gIT09IHVuZGVmaW5lZCA/IF9hcmdzNDRbMV0gOiB7fTsKICAgICAgICAgICAgICAgIGlzbG9hZGluZyA9IF9hcmdzNDQubGVuZ3RoID4gMiA/IF9hcmdzNDRbMl0gOiB1bmRlZmluZWQ7CiAgICAgICAgICAgICAgICB0ZW1wRGF0YSA9IEpTT04ucGFyc2UoSlNPTi5zdHJpbmdpZnkoZGF0YSkpOwogICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0NDQuYWJydXB0KCJyZXR1cm4iLCBIdHRwLmdldEluc3RhbmNlKCkuZ2V0KCIvcGltcGVvcGxlL2ZldGNocnl6dF8zMCIsIHRlbXBEYXRhLCBpc2xvYWRpbmcpKTsKCiAgICAgICAgICAgICAgY2FzZSA1OgogICAgICAgICAgICAgIGNhc2UgImVuZCI6CiAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQ0NC5zdG9wKCk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9LCBfY2FsbGVlNDQpOwogICAgICB9KSk7CgogICAgICBmdW5jdGlvbiBGZXRjaFJZWlRfMzAoKSB7CiAgICAgICAgcmV0dXJuIF9GZXRjaFJZWlRfLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7CiAgICAgIH0KCiAgICAgIHJldHVybiBGZXRjaFJZWlRfMzA7CiAgICB9KCkKICAgIC8qKg0KICAgICAqIEZldGNoRFRYWUfmjqXlj6Pmlrnms5UNCiAgICAgKg0KICAgICAqIEBwYXJhbSB7Kn0gW2NvbnRleHQ9e31dDQogICAgICogQHBhcmFtIHsqfSBbZGF0YT17fV0NCiAgICAgKiBAcGFyYW0ge2Jvb2xlYW59IFtpc2xvYWRpbmddDQogICAgICogQHJldHVybnMge1Byb21pc2U8YW55Pn0NCiAgICAgKiBAbWVtYmVyb2YgUGltUGVyc29uU2VydmljZUJhc2UNCiAgICAgKi8KCiAgfSwgewogICAga2V5OiAiRmV0Y2hEVFhZRyIsCiAgICB2YWx1ZTogZnVuY3Rpb24gKCkgewogICAgICB2YXIgX0ZldGNoRFRYWUcgPSBfYXN5bmNUb0dlbmVyYXRvcigKICAgICAgLyojX19QVVJFX18qLwogICAgICByZWdlbmVyYXRvclJ1bnRpbWUubWFyayhmdW5jdGlvbiBfY2FsbGVlNDUoKSB7CiAgICAgICAgdmFyIGNvbnRleHQsCiAgICAgICAgICAgIGRhdGEsCiAgICAgICAgICAgIGlzbG9hZGluZywKICAgICAgICAgICAgdGVtcERhdGEsCiAgICAgICAgICAgIF9hcmdzNDUgPSBhcmd1bWVudHM7CiAgICAgICAgcmV0dXJuIHJlZ2VuZXJhdG9yUnVudGltZS53cmFwKGZ1bmN0aW9uIF9jYWxsZWU0NSQoX2NvbnRleHQ0NSkgewogICAgICAgICAgd2hpbGUgKDEpIHsKICAgICAgICAgICAgc3dpdGNoIChfY29udGV4dDQ1LnByZXYgPSBfY29udGV4dDQ1Lm5leHQpIHsKICAgICAgICAgICAgICBjYXNlIDA6CiAgICAgICAgICAgICAgICBjb250ZXh0ID0gX2FyZ3M0NS5sZW5ndGggPiAwICYmIF9hcmdzNDVbMF0gIT09IHVuZGVmaW5lZCA/IF9hcmdzNDVbMF0gOiB7fTsKICAgICAgICAgICAgICAgIGRhdGEgPSBfYXJnczQ1Lmxlbmd0aCA+IDEgJiYgX2FyZ3M0NVsxXSAhPT0gdW5kZWZpbmVkID8gX2FyZ3M0NVsxXSA6IHt9OwogICAgICAgICAgICAgICAgaXNsb2FkaW5nID0gX2FyZ3M0NS5sZW5ndGggPiAyID8gX2FyZ3M0NVsyXSA6IHVuZGVmaW5lZDsKICAgICAgICAgICAgICAgIHRlbXBEYXRhID0gSlNPTi5wYXJzZShKU09OLnN0cmluZ2lmeShkYXRhKSk7CiAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQ0NS5hYnJ1cHQoInJldHVybiIsIEh0dHAuZ2V0SW5zdGFuY2UoKS5nZXQoIi9waW1wZW9wbGUvZmV0Y2hkdHh5ZyIsIHRlbXBEYXRhLCBpc2xvYWRpbmcpKTsKCiAgICAgICAgICAgICAgY2FzZSA1OgogICAgICAgICAgICAgIGNhc2UgImVuZCI6CiAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQ0NS5zdG9wKCk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9LCBfY2FsbGVlNDUpOwogICAgICB9KSk7CgogICAgICBmdW5jdGlvbiBGZXRjaERUWFlHKCkgewogICAgICAgIHJldHVybiBfRmV0Y2hEVFhZRy5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwogICAgICB9CgogICAgICByZXR1cm4gRmV0Y2hEVFhZRzsKICAgIH0oKQogICAgLyoqDQogICAgICogRmV0Y2hYWktRUlnmjqXlj6Pmlrnms5UNCiAgICAgKg0KICAgICAqIEBwYXJhbSB7Kn0gW2NvbnRleHQ9e31dDQogICAgICogQHBhcmFtIHsqfSBbZGF0YT17fV0NCiAgICAgKiBAcGFyYW0ge2Jvb2xlYW59IFtpc2xvYWRpbmddDQogICAgICogQHJldHVybnMge1Byb21pc2U8YW55Pn0NCiAgICAgKiBAbWVtYmVyb2YgUGltUGVyc29uU2VydmljZUJhc2UNCiAgICAgKi8KCiAgfSwgewogICAga2V5OiAiRmV0Y2hYWktRUlkiLAogICAgdmFsdWU6IGZ1bmN0aW9uICgpIHsKICAgICAgdmFyIF9GZXRjaFhaS1FSWSA9IF9hc3luY1RvR2VuZXJhdG9yKAogICAgICAvKiNfX1BVUkVfXyovCiAgICAgIHJlZ2VuZXJhdG9yUnVudGltZS5tYXJrKGZ1bmN0aW9uIF9jYWxsZWU0NigpIHsKICAgICAgICB2YXIgY29udGV4dCwKICAgICAgICAgICAgZGF0YSwKICAgICAgICAgICAgaXNsb2FkaW5nLAogICAgICAgICAgICB0ZW1wRGF0YSwKICAgICAgICAgICAgX2FyZ3M0NiA9IGFyZ3VtZW50czsKICAgICAgICByZXR1cm4gcmVnZW5lcmF0b3JSdW50aW1lLndyYXAoZnVuY3Rpb24gX2NhbGxlZTQ2JChfY29udGV4dDQ2KSB7CiAgICAgICAgICB3aGlsZSAoMSkgewogICAgICAgICAgICBzd2l0Y2ggKF9jb250ZXh0NDYucHJldiA9IF9jb250ZXh0NDYubmV4dCkgewogICAgICAgICAgICAgIGNhc2UgMDoKICAgICAgICAgICAgICAgIGNvbnRleHQgPSBfYXJnczQ2Lmxlbmd0aCA+IDAgJiYgX2FyZ3M0NlswXSAhPT0gdW5kZWZpbmVkID8gX2FyZ3M0NlswXSA6IHt9OwogICAgICAgICAgICAgICAgZGF0YSA9IF9hcmdzNDYubGVuZ3RoID4gMSAmJiBfYXJnczQ2WzFdICE9PSB1bmRlZmluZWQgPyBfYXJnczQ2WzFdIDoge307CiAgICAgICAgICAgICAgICBpc2xvYWRpbmcgPSBfYXJnczQ2Lmxlbmd0aCA+IDIgPyBfYXJnczQ2WzJdIDogdW5kZWZpbmVkOwogICAgICAgICAgICAgICAgdGVtcERhdGEgPSBKU09OLnBhcnNlKEpTT04uc3RyaW5naWZ5KGRhdGEpKTsKICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDQ2LmFicnVwdCgicmV0dXJuIiwgSHR0cC5nZXRJbnN0YW5jZSgpLmdldCgiL3BpbXBlb3BsZS9mZXRjaHh6a3FyeSIsIHRlbXBEYXRhLCBpc2xvYWRpbmcpKTsKCiAgICAgICAgICAgICAgY2FzZSA1OgogICAgICAgICAgICAgIGNhc2UgImVuZCI6CiAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQ0Ni5zdG9wKCk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9LCBfY2FsbGVlNDYpOwogICAgICB9KSk7CgogICAgICBmdW5jdGlvbiBGZXRjaFhaS1FSWSgpIHsKICAgICAgICByZXR1cm4gX0ZldGNoWFpLUVJZLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7CiAgICAgIH0KCiAgICAgIHJldHVybiBGZXRjaFhaS1FSWTsKICAgIH0oKQogICAgLyoqDQogICAgICogRmV0Y2hSRVBfUEVSU09OQUdF5o6l5Y+j5pa55rOVDQogICAgICoNCiAgICAgKiBAcGFyYW0geyp9IFtjb250ZXh0PXt9XQ0KICAgICAqIEBwYXJhbSB7Kn0gW2RhdGE9e31dDQogICAgICogQHBhcmFtIHtib29sZWFufSBbaXNsb2FkaW5nXQ0KICAgICAqIEByZXR1cm5zIHtQcm9taXNlPGFueT59DQogICAgICogQG1lbWJlcm9mIFBpbVBlcnNvblNlcnZpY2VCYXNlDQogICAgICovCgogIH0sIHsKICAgIGtleTogIkZldGNoUkVQX1BFUlNPTkFHRSIsCiAgICB2YWx1ZTogZnVuY3Rpb24gKCkgewogICAgICB2YXIgX0ZldGNoUkVQX1BFUlNPTkFHRSA9IF9hc3luY1RvR2VuZXJhdG9yKAogICAgICAvKiNfX1BVUkVfXyovCiAgICAgIHJlZ2VuZXJhdG9yUnVudGltZS5tYXJrKGZ1bmN0aW9uIF9jYWxsZWU0NygpIHsKICAgICAgICB2YXIgY29udGV4dCwKICAgICAgICAgICAgZGF0YSwKICAgICAgICAgICAgaXNsb2FkaW5nLAogICAgICAgICAgICB0ZW1wRGF0YSwKICAgICAgICAgICAgX2FyZ3M0NyA9IGFyZ3VtZW50czsKICAgICAgICByZXR1cm4gcmVnZW5lcmF0b3JSdW50aW1lLndyYXAoZnVuY3Rpb24gX2NhbGxlZTQ3JChfY29udGV4dDQ3KSB7CiAgICAgICAgICB3aGlsZSAoMSkgewogICAgICAgICAgICBzd2l0Y2ggKF9jb250ZXh0NDcucHJldiA9IF9jb250ZXh0NDcubmV4dCkgewogICAgICAgICAgICAgIGNhc2UgMDoKICAgICAgICAgICAgICAgIGNvbnRleHQgPSBfYXJnczQ3Lmxlbmd0aCA+IDAgJiYgX2FyZ3M0N1swXSAhPT0gdW5kZWZpbmVkID8gX2FyZ3M0N1swXSA6IHt9OwogICAgICAgICAgICAgICAgZGF0YSA9IF9hcmdzNDcubGVuZ3RoID4gMSAmJiBfYXJnczQ3WzFdICE9PSB1bmRlZmluZWQgPyBfYXJnczQ3WzFdIDoge307CiAgICAgICAgICAgICAgICBpc2xvYWRpbmcgPSBfYXJnczQ3Lmxlbmd0aCA+IDIgPyBfYXJnczQ3WzJdIDogdW5kZWZpbmVkOwogICAgICAgICAgICAgICAgdGVtcERhdGEgPSBKU09OLnBhcnNlKEpTT04uc3RyaW5naWZ5KGRhdGEpKTsKICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDQ3LmFicnVwdCgicmV0dXJuIiwgSHR0cC5nZXRJbnN0YW5jZSgpLmdldCgiL3BpbXBlb3BsZS9mZXRjaHJlcF9wZXJzb25hZ2UiLCB0ZW1wRGF0YSwgaXNsb2FkaW5nKSk7CgogICAgICAgICAgICAgIGNhc2UgNToKICAgICAgICAgICAgICBjYXNlICJlbmQiOgogICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0NDcuc3RvcCgpOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSwgX2NhbGxlZTQ3KTsKICAgICAgfSkpOwoKICAgICAgZnVuY3Rpb24gRmV0Y2hSRVBfUEVSU09OQUdFKCkgewogICAgICAgIHJldHVybiBfRmV0Y2hSRVBfUEVSU09OQUdFLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7CiAgICAgIH0KCiAgICAgIHJldHVybiBGZXRjaFJFUF9QRVJTT05BR0U7CiAgICB9KCkKICAgIC8qKg0KICAgICAqIEZldGNoU1lRS1paUlnmjqXlj6Pmlrnms5UNCiAgICAgKg0KICAgICAqIEBwYXJhbSB7Kn0gW2NvbnRleHQ9e31dDQogICAgICogQHBhcmFtIHsqfSBbZGF0YT17fV0NCiAgICAgKiBAcGFyYW0ge2Jvb2xlYW59IFtpc2xvYWRpbmddDQogICAgICogQHJldHVybnMge1Byb21pc2U8YW55Pn0NCiAgICAgKiBAbWVtYmVyb2YgUGltUGVyc29uU2VydmljZUJhc2UNCiAgICAgKi8KCiAgfSwgewogICAga2V5OiAiRmV0Y2hTWVFLWlpSWSIsCiAgICB2YWx1ZTogZnVuY3Rpb24gKCkgewogICAgICB2YXIgX0ZldGNoU1lRS1paUlkgPSBfYXN5bmNUb0dlbmVyYXRvcigKICAgICAgLyojX19QVVJFX18qLwogICAgICByZWdlbmVyYXRvclJ1bnRpbWUubWFyayhmdW5jdGlvbiBfY2FsbGVlNDgoKSB7CiAgICAgICAgdmFyIGNvbnRleHQsCiAgICAgICAgICAgIGRhdGEsCiAgICAgICAgICAgIGlzbG9hZGluZywKICAgICAgICAgICAgdGVtcERhdGEsCiAgICAgICAgICAgIF9hcmdzNDggPSBhcmd1bWVudHM7CiAgICAgICAgcmV0dXJuIHJlZ2VuZXJhdG9yUnVudGltZS53cmFwKGZ1bmN0aW9uIF9jYWxsZWU0OCQoX2NvbnRleHQ0OCkgewogICAgICAgICAgd2hpbGUgKDEpIHsKICAgICAgICAgICAgc3dpdGNoIChfY29udGV4dDQ4LnByZXYgPSBfY29udGV4dDQ4Lm5leHQpIHsKICAgICAgICAgICAgICBjYXNlIDA6CiAgICAgICAgICAgICAgICBjb250ZXh0ID0gX2FyZ3M0OC5sZW5ndGggPiAwICYmIF9hcmdzNDhbMF0gIT09IHVuZGVmaW5lZCA/IF9hcmdzNDhbMF0gOiB7fTsKICAgICAgICAgICAgICAgIGRhdGEgPSBfYXJnczQ4Lmxlbmd0aCA+IDEgJiYgX2FyZ3M0OFsxXSAhPT0gdW5kZWZpbmVkID8gX2FyZ3M0OFsxXSA6IHt9OwogICAgICAgICAgICAgICAgaXNsb2FkaW5nID0gX2FyZ3M0OC5sZW5ndGggPiAyID8gX2FyZ3M0OFsyXSA6IHVuZGVmaW5lZDsKICAgICAgICAgICAgICAgIHRlbXBEYXRhID0gSlNPTi5wYXJzZShKU09OLnN0cmluZ2lmeShkYXRhKSk7CiAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQ0OC5hYnJ1cHQoInJldHVybiIsIEh0dHAuZ2V0SW5zdGFuY2UoKS5nZXQoIi9waW1wZW9wbGUvZmV0Y2hzeXFrenpyeSIsIHRlbXBEYXRhLCBpc2xvYWRpbmcpKTsKCiAgICAgICAgICAgICAgY2FzZSA1OgogICAgICAgICAgICAgIGNhc2UgImVuZCI6CiAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQ0OC5zdG9wKCk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9LCBfY2FsbGVlNDgpOwogICAgICB9KSk7CgogICAgICBmdW5jdGlvbiBGZXRjaFNZUUtaWlJZKCkgewogICAgICAgIHJldHVybiBfRmV0Y2hTWVFLWlpSWS5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwogICAgICB9CgogICAgICByZXR1cm4gRmV0Y2hTWVFLWlpSWTsKICAgIH0oKQogICAgLyoqDQogICAgICogRmV0Y2hKWFFLWlpSWeaOpeWPo+aWueazlQ0KICAgICAqDQogICAgICogQHBhcmFtIHsqfSBbY29udGV4dD17fV0NCiAgICAgKiBAcGFyYW0geyp9IFtkYXRhPXt9XQ0KICAgICAqIEBwYXJhbSB7Ym9vbGVhbn0gW2lzbG9hZGluZ10NCiAgICAgKiBAcmV0dXJucyB7UHJvbWlzZTxhbnk+fQ0KICAgICAqIEBtZW1iZXJvZiBQaW1QZXJzb25TZXJ2aWNlQmFzZQ0KICAgICAqLwoKICB9LCB7CiAgICBrZXk6ICJGZXRjaEpYUUtaWlJZIiwKICAgIHZhbHVlOiBmdW5jdGlvbiAoKSB7CiAgICAgIHZhciBfRmV0Y2hKWFFLWlpSWSA9IF9hc3luY1RvR2VuZXJhdG9yKAogICAgICAvKiNfX1BVUkVfXyovCiAgICAgIHJlZ2VuZXJhdG9yUnVudGltZS5tYXJrKGZ1bmN0aW9uIF9jYWxsZWU0OSgpIHsKICAgICAgICB2YXIgY29udGV4dCwKICAgICAgICAgICAgZGF0YSwKICAgICAgICAgICAgaXNsb2FkaW5nLAogICAgICAgICAgICB0ZW1wRGF0YSwKICAgICAgICAgICAgX2FyZ3M0OSA9IGFyZ3VtZW50czsKICAgICAgICByZXR1cm4gcmVnZW5lcmF0b3JSdW50aW1lLndyYXAoZnVuY3Rpb24gX2NhbGxlZTQ5JChfY29udGV4dDQ5KSB7CiAgICAgICAgICB3aGlsZSAoMSkgewogICAgICAgICAgICBzd2l0Y2ggKF9jb250ZXh0NDkucHJldiA9IF9jb250ZXh0NDkubmV4dCkgewogICAgICAgICAgICAgIGNhc2UgMDoKICAgICAgICAgICAgICAgIGNvbnRleHQgPSBfYXJnczQ5Lmxlbmd0aCA+IDAgJiYgX2FyZ3M0OVswXSAhPT0gdW5kZWZpbmVkID8gX2FyZ3M0OVswXSA6IHt9OwogICAgICAgICAgICAgICAgZGF0YSA9IF9hcmdzNDkubGVuZ3RoID4gMSAmJiBfYXJnczQ5WzFdICE9PSB1bmRlZmluZWQgPyBfYXJnczQ5WzFdIDoge307CiAgICAgICAgICAgICAgICBpc2xvYWRpbmcgPSBfYXJnczQ5Lmxlbmd0aCA+IDIgPyBfYXJnczQ5WzJdIDogdW5kZWZpbmVkOwogICAgICAgICAgICAgICAgdGVtcERhdGEgPSBKU09OLnBhcnNlKEpTT04uc3RyaW5naWZ5KGRhdGEpKTsKICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDQ5LmFicnVwdCgicmV0dXJuIiwgSHR0cC5nZXRJbnN0YW5jZSgpLmdldCgiL3BpbXBlb3BsZS9mZXRjaGp4cWt6enJ5IiwgdGVtcERhdGEsIGlzbG9hZGluZykpOwoKICAgICAgICAgICAgICBjYXNlIDU6CiAgICAgICAgICAgICAgY2FzZSAiZW5kIjoKICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDQ5LnN0b3AoKTsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0sIF9jYWxsZWU0OSk7CiAgICAgIH0pKTsKCiAgICAgIGZ1bmN0aW9uIEZldGNoSlhRS1paUlkoKSB7CiAgICAgICAgcmV0dXJuIF9GZXRjaEpYUUtaWlJZLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7CiAgICAgIH0KCiAgICAgIHJldHVybiBGZXRjaEpYUUtaWlJZOwogICAgfSgpCiAgICAvKioNCiAgICAgKiBGZXRjaFRYR0LmjqXlj6Pmlrnms5UNCiAgICAgKg0KICAgICAqIEBwYXJhbSB7Kn0gW2NvbnRleHQ9e31dDQogICAgICogQHBhcmFtIHsqfSBbZGF0YT17fV0NCiAgICAgKiBAcGFyYW0ge2Jvb2xlYW59IFtpc2xvYWRpbmddDQogICAgICogQHJldHVybnMge1Byb21pc2U8YW55Pn0NCiAgICAgKiBAbWVtYmVyb2YgUGltUGVyc29uU2VydmljZUJhc2UNCiAgICAgKi8KCiAgfSwgewogICAga2V5OiAiRmV0Y2hUWEdCIiwKICAgIHZhbHVlOiBmdW5jdGlvbiAoKSB7CiAgICAgIHZhciBfRmV0Y2hUWEdCID0gX2FzeW5jVG9HZW5lcmF0b3IoCiAgICAgIC8qI19fUFVSRV9fKi8KICAgICAgcmVnZW5lcmF0b3JSdW50aW1lLm1hcmsoZnVuY3Rpb24gX2NhbGxlZTUwKCkgewogICAgICAgIHZhciBjb250ZXh0LAogICAgICAgICAgICBkYXRhLAogICAgICAgICAgICBpc2xvYWRpbmcsCiAgICAgICAgICAgIHRlbXBEYXRhLAogICAgICAgICAgICBfYXJnczUwID0gYXJndW1lbnRzOwogICAgICAgIHJldHVybiByZWdlbmVyYXRvclJ1bnRpbWUud3JhcChmdW5jdGlvbiBfY2FsbGVlNTAkKF9jb250ZXh0NTApIHsKICAgICAgICAgIHdoaWxlICgxKSB7CiAgICAgICAgICAgIHN3aXRjaCAoX2NvbnRleHQ1MC5wcmV2ID0gX2NvbnRleHQ1MC5uZXh0KSB7CiAgICAgICAgICAgICAgY2FzZSAwOgogICAgICAgICAgICAgICAgY29udGV4dCA9IF9hcmdzNTAubGVuZ3RoID4gMCAmJiBfYXJnczUwWzBdICE9PSB1bmRlZmluZWQgPyBfYXJnczUwWzBdIDoge307CiAgICAgICAgICAgICAgICBkYXRhID0gX2FyZ3M1MC5sZW5ndGggPiAxICYmIF9hcmdzNTBbMV0gIT09IHVuZGVmaW5lZCA/IF9hcmdzNTBbMV0gOiB7fTsKICAgICAgICAgICAgICAgIGlzbG9hZGluZyA9IF9hcmdzNTAubGVuZ3RoID4gMiA/IF9hcmdzNTBbMl0gOiB1bmRlZmluZWQ7CiAgICAgICAgICAgICAgICB0ZW1wRGF0YSA9IEpTT04ucGFyc2UoSlNPTi5zdHJpbmdpZnkoZGF0YSkpOwogICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0NTAuYWJydXB0KCJyZXR1cm4iLCBIdHRwLmdldEluc3RhbmNlKCkuZ2V0KCIvcGltcGVvcGxlL2ZldGNodHhnYiIsIHRlbXBEYXRhLCBpc2xvYWRpbmcpKTsKCiAgICAgICAgICAgICAgY2FzZSA1OgogICAgICAgICAgICAgIGNhc2UgImVuZCI6CiAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQ1MC5zdG9wKCk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9LCBfY2FsbGVlNTApOwogICAgICB9KSk7CgogICAgICBmdW5jdGlvbiBGZXRjaFRYR0IoKSB7CiAgICAgICAgcmV0dXJuIF9GZXRjaFRYR0IuYXBwbHkodGhpcywgYXJndW1lbnRzKTsKICAgICAgfQoKICAgICAgcmV0dXJuIEZldGNoVFhHQjsKICAgIH0oKQogICAgLyoqDQogICAgICogRmV0Y2hLWkpCRFJZ5o6l5Y+j5pa55rOVDQogICAgICoNCiAgICAgKiBAcGFyYW0geyp9IFtjb250ZXh0PXt9XQ0KICAgICAqIEBwYXJhbSB7Kn0gW2RhdGE9e31dDQogICAgICogQHBhcmFtIHtib29sZWFufSBbaXNsb2FkaW5nXQ0KICAgICAqIEByZXR1cm5zIHtQcm9taXNlPGFueT59DQogICAgICogQG1lbWJlcm9mIFBpbVBlcnNvblNlcnZpY2VCYXNlDQogICAgICovCgogIH0sIHsKICAgIGtleTogIkZldGNoS1pKQkRSWSIsCiAgICB2YWx1ZTogZnVuY3Rpb24gKCkgewogICAgICB2YXIgX0ZldGNoS1pKQkRSWSA9IF9hc3luY1RvR2VuZXJhdG9yKAogICAgICAvKiNfX1BVUkVfXyovCiAgICAgIHJlZ2VuZXJhdG9yUnVudGltZS5tYXJrKGZ1bmN0aW9uIF9jYWxsZWU1MSgpIHsKICAgICAgICB2YXIgY29udGV4dCwKICAgICAgICAgICAgZGF0YSwKICAgICAgICAgICAgaXNsb2FkaW5nLAogICAgICAgICAgICB0ZW1wRGF0YSwKICAgICAgICAgICAgX2FyZ3M1MSA9IGFyZ3VtZW50czsKICAgICAgICByZXR1cm4gcmVnZW5lcmF0b3JSdW50aW1lLndyYXAoZnVuY3Rpb24gX2NhbGxlZTUxJChfY29udGV4dDUxKSB7CiAgICAgICAgICB3aGlsZSAoMSkgewogICAgICAgICAgICBzd2l0Y2ggKF9jb250ZXh0NTEucHJldiA9IF9jb250ZXh0NTEubmV4dCkgewogICAgICAgICAgICAgIGNhc2UgMDoKICAgICAgICAgICAgICAgIGNvbnRleHQgPSBfYXJnczUxLmxlbmd0aCA+IDAgJiYgX2FyZ3M1MVswXSAhPT0gdW5kZWZpbmVkID8gX2FyZ3M1MVswXSA6IHt9OwogICAgICAgICAgICAgICAgZGF0YSA9IF9hcmdzNTEubGVuZ3RoID4gMSAmJiBfYXJnczUxWzFdICE9PSB1bmRlZmluZWQgPyBfYXJnczUxWzFdIDoge307CiAgICAgICAgICAgICAgICBpc2xvYWRpbmcgPSBfYXJnczUxLmxlbmd0aCA+IDIgPyBfYXJnczUxWzJdIDogdW5kZWZpbmVkOwogICAgICAgICAgICAgICAgdGVtcERhdGEgPSBKU09OLnBhcnNlKEpTT04uc3RyaW5naWZ5KGRhdGEpKTsKICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDUxLmFicnVwdCgicmV0dXJuIiwgSHR0cC5nZXRJbnN0YW5jZSgpLmdldCgiL3BpbXBlb3BsZS9mZXRjaGt6amJkcnkiLCB0ZW1wRGF0YSwgaXNsb2FkaW5nKSk7CgogICAgICAgICAgICAgIGNhc2UgNToKICAgICAgICAgICAgICBjYXNlICJlbmQiOgogICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0NTEuc3RvcCgpOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSwgX2NhbGxlZTUxKTsKICAgICAgfSkpOwoKICAgICAgZnVuY3Rpb24gRmV0Y2hLWkpCRFJZKCkgewogICAgICAgIHJldHVybiBfRmV0Y2hLWkpCRFJZLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7CiAgICAgIH0KCiAgICAgIHJldHVybiBGZXRjaEtaSkJEUlk7CiAgICB9KCkKICAgIC8qKg0KICAgICAqIEZldGNoQ3VyT3JnUGltcGVyc29u5o6l5Y+j5pa55rOVDQogICAgICoNCiAgICAgKiBAcGFyYW0geyp9IFtjb250ZXh0PXt9XQ0KICAgICAqIEBwYXJhbSB7Kn0gW2RhdGE9e31dDQogICAgICogQHBhcmFtIHtib29sZWFufSBbaXNsb2FkaW5nXQ0KICAgICAqIEByZXR1cm5zIHtQcm9taXNlPGFueT59DQogICAgICogQG1lbWJlcm9mIFBpbVBlcnNvblNlcnZpY2VCYXNlDQogICAgICovCgogIH0sIHsKICAgIGtleTogIkZldGNoQ3VyT3JnUGltcGVyc29uIiwKICAgIHZhbHVlOiBmdW5jdGlvbiAoKSB7CiAgICAgIHZhciBfRmV0Y2hDdXJPcmdQaW1wZXJzb24gPSBfYXN5bmNUb0dlbmVyYXRvcigKICAgICAgLyojX19QVVJFX18qLwogICAgICByZWdlbmVyYXRvclJ1bnRpbWUubWFyayhmdW5jdGlvbiBfY2FsbGVlNTIoKSB7CiAgICAgICAgdmFyIGNvbnRleHQsCiAgICAgICAgICAgIGRhdGEsCiAgICAgICAgICAgIGlzbG9hZGluZywKICAgICAgICAgICAgdGVtcERhdGEsCiAgICAgICAgICAgIF9hcmdzNTIgPSBhcmd1bWVudHM7CiAgICAgICAgcmV0dXJuIHJlZ2VuZXJhdG9yUnVudGltZS53cmFwKGZ1bmN0aW9uIF9jYWxsZWU1MiQoX2NvbnRleHQ1MikgewogICAgICAgICAgd2hpbGUgKDEpIHsKICAgICAgICAgICAgc3dpdGNoIChfY29udGV4dDUyLnByZXYgPSBfY29udGV4dDUyLm5leHQpIHsKICAgICAgICAgICAgICBjYXNlIDA6CiAgICAgICAgICAgICAgICBjb250ZXh0ID0gX2FyZ3M1Mi5sZW5ndGggPiAwICYmIF9hcmdzNTJbMF0gIT09IHVuZGVmaW5lZCA/IF9hcmdzNTJbMF0gOiB7fTsKICAgICAgICAgICAgICAgIGRhdGEgPSBfYXJnczUyLmxlbmd0aCA+IDEgJiYgX2FyZ3M1MlsxXSAhPT0gdW5kZWZpbmVkID8gX2FyZ3M1MlsxXSA6IHt9OwogICAgICAgICAgICAgICAgaXNsb2FkaW5nID0gX2FyZ3M1Mi5sZW5ndGggPiAyID8gX2FyZ3M1MlsyXSA6IHVuZGVmaW5lZDsKICAgICAgICAgICAgICAgIHRlbXBEYXRhID0gSlNPTi5wYXJzZShKU09OLnN0cmluZ2lmeShkYXRhKSk7CiAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQ1Mi5hYnJ1cHQoInJldHVybiIsIEh0dHAuZ2V0SW5zdGFuY2UoKS5nZXQoIi9waW1wZW9wbGUvZmV0Y2hjdXJvcmdwaW1wZXJzb24iLCB0ZW1wRGF0YSwgaXNsb2FkaW5nKSk7CgogICAgICAgICAgICAgIGNhc2UgNToKICAgICAgICAgICAgICBjYXNlICJlbmQiOgogICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0NTIuc3RvcCgpOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSwgX2NhbGxlZTUyKTsKICAgICAgfSkpOwoKICAgICAgZnVuY3Rpb24gRmV0Y2hDdXJPcmdQaW1wZXJzb24oKSB7CiAgICAgICAgcmV0dXJuIF9GZXRjaEN1ck9yZ1BpbXBlcnNvbi5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwogICAgICB9CgogICAgICByZXR1cm4gRmV0Y2hDdXJPcmdQaW1wZXJzb247CiAgICB9KCkKICAgIC8qKg0KICAgICAqIEZldGNoVFhSWUNY5o6l5Y+j5pa55rOVDQogICAgICoNCiAgICAgKiBAcGFyYW0geyp9IFtjb250ZXh0PXt9XQ0KICAgICAqIEBwYXJhbSB7Kn0gW2RhdGE9e31dDQogICAgICogQHBhcmFtIHtib29sZWFufSBbaXNsb2FkaW5nXQ0KICAgICAqIEByZXR1cm5zIHtQcm9taXNlPGFueT59DQogICAgICogQG1lbWJlcm9mIFBpbVBlcnNvblNlcnZpY2VCYXNlDQogICAgICovCgogIH0sIHsKICAgIGtleTogIkZldGNoVFhSWUNYIiwKICAgIHZhbHVlOiBmdW5jdGlvbiAoKSB7CiAgICAgIHZhciBfRmV0Y2hUWFJZQ1ggPSBfYXN5bmNUb0dlbmVyYXRvcigKICAgICAgLyojX19QVVJFX18qLwogICAgICByZWdlbmVyYXRvclJ1bnRpbWUubWFyayhmdW5jdGlvbiBfY2FsbGVlNTMoKSB7CiAgICAgICAgdmFyIGNvbnRleHQsCiAgICAgICAgICAgIGRhdGEsCiAgICAgICAgICAgIGlzbG9hZGluZywKICAgICAgICAgICAgdGVtcERhdGEsCiAgICAgICAgICAgIF9hcmdzNTMgPSBhcmd1bWVudHM7CiAgICAgICAgcmV0dXJuIHJlZ2VuZXJhdG9yUnVudGltZS53cmFwKGZ1bmN0aW9uIF9jYWxsZWU1MyQoX2NvbnRleHQ1MykgewogICAgICAgICAgd2hpbGUgKDEpIHsKICAgICAgICAgICAgc3dpdGNoIChfY29udGV4dDUzLnByZXYgPSBfY29udGV4dDUzLm5leHQpIHsKICAgICAgICAgICAgICBjYXNlIDA6CiAgICAgICAgICAgICAgICBjb250ZXh0ID0gX2FyZ3M1My5sZW5ndGggPiAwICYmIF9hcmdzNTNbMF0gIT09IHVuZGVmaW5lZCA/IF9hcmdzNTNbMF0gOiB7fTsKICAgICAgICAgICAgICAgIGRhdGEgPSBfYXJnczUzLmxlbmd0aCA+IDEgJiYgX2FyZ3M1M1sxXSAhPT0gdW5kZWZpbmVkID8gX2FyZ3M1M1sxXSA6IHt9OwogICAgICAgICAgICAgICAgaXNsb2FkaW5nID0gX2FyZ3M1My5sZW5ndGggPiAyID8gX2FyZ3M1M1syXSA6IHVuZGVmaW5lZDsKICAgICAgICAgICAgICAgIHRlbXBEYXRhID0gSlNPTi5wYXJzZShKU09OLnN0cmluZ2lmeShkYXRhKSk7CiAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQ1My5hYnJ1cHQoInJldHVybiIsIEh0dHAuZ2V0SW5zdGFuY2UoKS5nZXQoIi9waW1wZW9wbGUvZmV0Y2h0eHJ5Y3giLCB0ZW1wRGF0YSwgaXNsb2FkaW5nKSk7CgogICAgICAgICAgICAgIGNhc2UgNToKICAgICAgICAgICAgICBjYXNlICJlbmQiOgogICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0NTMuc3RvcCgpOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSwgX2NhbGxlZTUzKTsKICAgICAgfSkpOwoKICAgICAgZnVuY3Rpb24gRmV0Y2hUWFJZQ1goKSB7CiAgICAgICAgcmV0dXJuIF9GZXRjaFRYUllDWC5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwogICAgICB9CgogICAgICByZXR1cm4gRmV0Y2hUWFJZQ1g7CiAgICB9KCkKICAgIC8qKg0KICAgICAqIEZldGNoS1haU1lRS1paUllEU+aOpeWPo+aWueazlQ0KICAgICAqDQogICAgICogQHBhcmFtIHsqfSBbY29udGV4dD17fV0NCiAgICAgKiBAcGFyYW0geyp9IFtkYXRhPXt9XQ0KICAgICAqIEBwYXJhbSB7Ym9vbGVhbn0gW2lzbG9hZGluZ10NCiAgICAgKiBAcmV0dXJucyB7UHJvbWlzZTxhbnk+fQ0KICAgICAqIEBtZW1iZXJvZiBQaW1QZXJzb25TZXJ2aWNlQmFzZQ0KICAgICAqLwoKICB9LCB7CiAgICBrZXk6ICJGZXRjaEtYWlNZUUtaWlJZRFMiLAogICAgdmFsdWU6IGZ1bmN0aW9uICgpIHsKICAgICAgdmFyIF9GZXRjaEtYWlNZUUtaWlJZRFMgPSBfYXN5bmNUb0dlbmVyYXRvcigKICAgICAgLyojX19QVVJFX18qLwogICAgICByZWdlbmVyYXRvclJ1bnRpbWUubWFyayhmdW5jdGlvbiBfY2FsbGVlNTQoKSB7CiAgICAgICAgdmFyIGNvbnRleHQsCiAgICAgICAgICAgIGRhdGEsCiAgICAgICAgICAgIGlzbG9hZGluZywKICAgICAgICAgICAgdGVtcERhdGEsCiAgICAgICAgICAgIF9hcmdzNTQgPSBhcmd1bWVudHM7CiAgICAgICAgcmV0dXJuIHJlZ2VuZXJhdG9yUnVudGltZS53cmFwKGZ1bmN0aW9uIF9jYWxsZWU1NCQoX2NvbnRleHQ1NCkgewogICAgICAgICAgd2hpbGUgKDEpIHsKICAgICAgICAgICAgc3dpdGNoIChfY29udGV4dDU0LnByZXYgPSBfY29udGV4dDU0Lm5leHQpIHsKICAgICAgICAgICAgICBjYXNlIDA6CiAgICAgICAgICAgICAgICBjb250ZXh0ID0gX2FyZ3M1NC5sZW5ndGggPiAwICYmIF9hcmdzNTRbMF0gIT09IHVuZGVmaW5lZCA/IF9hcmdzNTRbMF0gOiB7fTsKICAgICAgICAgICAgICAgIGRhdGEgPSBfYXJnczU0Lmxlbmd0aCA+IDEgJiYgX2FyZ3M1NFsxXSAhPT0gdW5kZWZpbmVkID8gX2FyZ3M1NFsxXSA6IHt9OwogICAgICAgICAgICAgICAgaXNsb2FkaW5nID0gX2FyZ3M1NC5sZW5ndGggPiAyID8gX2FyZ3M1NFsyXSA6IHVuZGVmaW5lZDsKICAgICAgICAgICAgICAgIHRlbXBEYXRhID0gSlNPTi5wYXJzZShKU09OLnN0cmluZ2lmeShkYXRhKSk7CiAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQ1NC5hYnJ1cHQoInJldHVybiIsIEh0dHAuZ2V0SW5zdGFuY2UoKS5nZXQoIi9waW1wZW9wbGUvZmV0Y2hreHpzeXFrenpyeWRzIiwgdGVtcERhdGEsIGlzbG9hZGluZykpOwoKICAgICAgICAgICAgICBjYXNlIDU6CiAgICAgICAgICAgICAgY2FzZSAiZW5kIjoKICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDU0LnN0b3AoKTsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0sIF9jYWxsZWU1NCk7CiAgICAgIH0pKTsKCiAgICAgIGZ1bmN0aW9uIEZldGNoS1haU1lRS1paUllEUygpIHsKICAgICAgICByZXR1cm4gX0ZldGNoS1haU1lRS1paUllEUy5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwogICAgICB9CgogICAgICByZXR1cm4gRmV0Y2hLWFpTWVFLWlpSWURTOwogICAgfSgpCiAgfV0pOwoKICByZXR1cm4gUGltUGVyc29uU2VydmljZUJhc2U7Cn0oRW50aXR5U2VydmljZSk7CgpleHBvcnQgeyBQaW1QZXJzb25TZXJ2aWNlQmFzZSBhcyBkZWZhdWx0IH07"},null]}
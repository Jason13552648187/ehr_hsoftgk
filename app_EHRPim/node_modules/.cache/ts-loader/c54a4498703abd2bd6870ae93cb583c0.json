{"remainingRequest":"F:\\crod项目\\人事管理系统2\\iBizEHR\\app_EHRPim\\node_modules\\thread-loader\\dist\\cjs.js!F:\\crod项目\\人事管理系统2\\iBizEHR\\app_EHRPim\\node_modules\\babel-loader\\lib\\index.js!F:\\crod项目\\人事管理系统2\\iBizEHR\\app_EHRPim\\node_modules\\ts-loader\\index.js??ref--14-3!F:\\crod项目\\人事管理系统2\\iBizEHR\\app_EHRPim\\node_modules\\cache-loader\\dist\\cjs.js??ref--0-0!F:\\crod项目\\人事管理系统2\\iBizEHR\\app_EHRPim\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!F:\\crod项目\\人事管理系统2\\iBizEHR\\app_EHRPim\\src\\widgets\\pim-person\\hmdinfo-grid-grid\\hmdinfo-grid-grid-base.vue?vue&type=script&lang=tsx&","dependencies":[{"path":"F:\\crod项目\\人事管理系统2\\iBizEHR\\app_EHRPim\\src\\widgets\\pim-person\\hmdinfo-grid-grid\\hmdinfo-grid-grid-base.vue","mtime":1630509411871},{"path":"F:\\crod项目\\人事管理系统2\\iBizEHR\\app_EHRPim\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1630511852775},{"path":"F:\\crod项目\\人事管理系统2\\iBizEHR\\app_EHRPim\\node_modules\\thread-loader\\dist\\cjs.js","mtime":1630511853252},{"path":"F:\\crod项目\\人事管理系统2\\iBizEHR\\app_EHRPim\\node_modules\\babel-loader\\lib\\index.js","mtime":1630511852747},{"path":"F:\\crod项目\\人事管理系统2\\iBizEHR\\app_EHRPim\\node_modules\\ts-loader\\index.js","mtime":1630511985412},{"path":"F:\\crod项目\\人事管理系统2\\iBizEHR\\app_EHRPim\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1630511852775},{"path":"F:\\crod项目\\人事管理系统2\\iBizEHR\\app_EHRPim\\node_modules\\vue-loader\\lib\\index.js","mtime":1630512070338}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:aW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuc3ltYm9sIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuc3ltYm9sLmRlc2NyaXB0aW9uIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuc3ltYm9sLml0ZXJhdG9yIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkuZmlsdGVyIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkuZmluZCI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLmFycmF5LmZpbmQtaW5kZXgiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5hcnJheS5mb3ItZWFjaCI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLmFycmF5LmpvaW4iOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5hcnJheS5tYXAiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5hcnJheS5zb21lIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkuc3BsaWNlIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuZnVuY3Rpb24ubmFtZSI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLm9iamVjdC5kZWZpbmUtcHJvcGVydGllcyI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLm9iamVjdC5kZWZpbmUtcHJvcGVydHkiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5vYmplY3QuZ2V0LW93bi1wcm9wZXJ0eS1kZXNjcmlwdG9yIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMub2JqZWN0LmdldC1vd24tcHJvcGVydHktZGVzY3JpcHRvcnMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5vYmplY3QuaXMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5vYmplY3Qua2V5cyI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLm9iamVjdC50by1zdHJpbmciOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5wYXJzZS1pbnQiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5yZWdleHAuZXhlYyI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLnN0cmluZy5pdGVyYXRvciI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLnN0cmluZy5yZXBsYWNlIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuc3RyaW5nLnNlYXJjaCI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLnN0cmluZy5zcGxpdCI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL3dlYi5kb20tY29sbGVjdGlvbnMuZm9yLWVhY2giOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy93ZWIuZG9tLWNvbGxlY3Rpb25zLml0ZXJhdG9yIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvd2ViLnRpbWVycyI7CmltcG9ydCBfdG9Db25zdW1hYmxlQXJyYXkgZnJvbSAiRjpcXGNyb2RcdTk4NzlcdTc2RUVcXFx1NEVCQVx1NEU4Qlx1N0JBMVx1NzQwNlx1N0NGQlx1N0VERjJcXGlCaXpFSFJcXGFwcF9FSFJQaW1cXG5vZGVfbW9kdWxlc1xcQGJhYmVsXFxydW50aW1lL2hlbHBlcnMvZXNtL3RvQ29uc3VtYWJsZUFycmF5IjsKaW1wb3J0IF9kZWZpbmVQcm9wZXJ0eSBmcm9tICJGOlxcY3JvZFx1OTg3OVx1NzZFRVxcXHU0RUJBXHU0RThCXHU3QkExXHU3NDA2XHU3Q0ZCXHU3RURGMlxcaUJpekVIUlxcYXBwX0VIUlBpbVxcbm9kZV9tb2R1bGVzXFxAYmFiZWxcXHJ1bnRpbWUvaGVscGVycy9lc20vZGVmaW5lUHJvcGVydHkiOwppbXBvcnQgInJlZ2VuZXJhdG9yLXJ1bnRpbWUvcnVudGltZSI7CmltcG9ydCBfYXN5bmNUb0dlbmVyYXRvciBmcm9tICJGOlxcY3JvZFx1OTg3OVx1NzZFRVxcXHU0RUJBXHU0RThCXHU3QkExXHU3NDA2XHU3Q0ZCXHU3RURGMlxcaUJpekVIUlxcYXBwX0VIUlBpbVxcbm9kZV9tb2R1bGVzXFxAYmFiZWxcXHJ1bnRpbWUvaGVscGVycy9lc20vYXN5bmNUb0dlbmVyYXRvciI7CmltcG9ydCBfY2xhc3NDYWxsQ2hlY2sgZnJvbSAiRjpcXGNyb2RcdTk4NzlcdTc2RUVcXFx1NEVCQVx1NEU4Qlx1N0JBMVx1NzQwNlx1N0NGQlx1N0VERjJcXGlCaXpFSFJcXGFwcF9FSFJQaW1cXG5vZGVfbW9kdWxlc1xcQGJhYmVsXFxydW50aW1lL2hlbHBlcnMvZXNtL2NsYXNzQ2FsbENoZWNrIjsKaW1wb3J0IF9jcmVhdGVDbGFzcyBmcm9tICJGOlxcY3JvZFx1OTg3OVx1NzZFRVxcXHU0RUJBXHU0RThCXHU3QkExXHU3NDA2XHU3Q0ZCXHU3RURGMlxcaUJpekVIUlxcYXBwX0VIUlBpbVxcbm9kZV9tb2R1bGVzXFxAYmFiZWxcXHJ1bnRpbWUvaGVscGVycy9lc20vY3JlYXRlQ2xhc3MiOwppbXBvcnQgX3Bvc3NpYmxlQ29uc3RydWN0b3JSZXR1cm4gZnJvbSAiRjpcXGNyb2RcdTk4NzlcdTc2RUVcXFx1NEVCQVx1NEU4Qlx1N0JBMVx1NzQwNlx1N0NGQlx1N0VERjJcXGlCaXpFSFJcXGFwcF9FSFJQaW1cXG5vZGVfbW9kdWxlc1xcQGJhYmVsXFxydW50aW1lL2hlbHBlcnMvZXNtL3Bvc3NpYmxlQ29uc3RydWN0b3JSZXR1cm4iOwppbXBvcnQgX2dldFByb3RvdHlwZU9mIGZyb20gIkY6XFxjcm9kXHU5ODc5XHU3NkVFXFxcdTRFQkFcdTRFOEJcdTdCQTFcdTc0MDZcdTdDRkJcdTdFREYyXFxpQml6RUhSXFxhcHBfRUhSUGltXFxub2RlX21vZHVsZXNcXEBiYWJlbFxccnVudGltZS9oZWxwZXJzL2VzbS9nZXRQcm90b3R5cGVPZiI7CmltcG9ydCBfaW5oZXJpdHMgZnJvbSAiRjpcXGNyb2RcdTk4NzlcdTc2RUVcXFx1NEVCQVx1NEU4Qlx1N0JBMVx1NzQwNlx1N0NGQlx1N0VERjJcXGlCaXpFSFJcXGFwcF9FSFJQaW1cXG5vZGVfbW9kdWxlc1xcQGJhYmVsXFxydW50aW1lL2hlbHBlcnMvZXNtL2luaGVyaXRzIjsKCmZ1bmN0aW9uIG93bktleXMob2JqZWN0LCBlbnVtZXJhYmxlT25seSkgeyB2YXIga2V5cyA9IE9iamVjdC5rZXlzKG9iamVjdCk7IGlmIChPYmplY3QuZ2V0T3duUHJvcGVydHlTeW1ib2xzKSB7IHZhciBzeW1ib2xzID0gT2JqZWN0LmdldE93blByb3BlcnR5U3ltYm9scyhvYmplY3QpOyBpZiAoZW51bWVyYWJsZU9ubHkpIHN5bWJvbHMgPSBzeW1ib2xzLmZpbHRlcihmdW5jdGlvbiAoc3ltKSB7IHJldHVybiBPYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yKG9iamVjdCwgc3ltKS5lbnVtZXJhYmxlOyB9KTsga2V5cy5wdXNoLmFwcGx5KGtleXMsIHN5bWJvbHMpOyB9IHJldHVybiBrZXlzOyB9CgpmdW5jdGlvbiBfb2JqZWN0U3ByZWFkKHRhcmdldCkgeyBmb3IgKHZhciBpID0gMTsgaSA8IGFyZ3VtZW50cy5sZW5ndGg7IGkrKykgeyB2YXIgc291cmNlID0gYXJndW1lbnRzW2ldICE9IG51bGwgPyBhcmd1bWVudHNbaV0gOiB7fTsgaWYgKGkgJSAyKSB7IG93bktleXMoT2JqZWN0KHNvdXJjZSksIHRydWUpLmZvckVhY2goZnVuY3Rpb24gKGtleSkgeyBfZGVmaW5lUHJvcGVydHkodGFyZ2V0LCBrZXksIHNvdXJjZVtrZXldKTsgfSk7IH0gZWxzZSBpZiAoT2JqZWN0LmdldE93blByb3BlcnR5RGVzY3JpcHRvcnMpIHsgT2JqZWN0LmRlZmluZVByb3BlcnRpZXModGFyZ2V0LCBPYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9ycyhzb3VyY2UpKTsgfSBlbHNlIHsgb3duS2V5cyhPYmplY3Qoc291cmNlKSkuZm9yRWFjaChmdW5jdGlvbiAoa2V5KSB7IE9iamVjdC5kZWZpbmVQcm9wZXJ0eSh0YXJnZXQsIGtleSwgT2JqZWN0LmdldE93blByb3BlcnR5RGVzY3JpcHRvcihzb3VyY2UsIGtleSkpOyB9KTsgfSB9IHJldHVybiB0YXJnZXQ7IH0KCmltcG9ydCAqIGFzIHRzbGliXzEgZnJvbSAidHNsaWIiOwppbXBvcnQgeyBWdWUsIENvbXBvbmVudCwgUHJvcCwgV2F0Y2ggfSBmcm9tICd2dWUtcHJvcGVydHktZGVjb3JhdG9yJzsKaW1wb3J0IFBpbVBlcnNvblNlcnZpY2UgZnJvbSAnQC9zZXJ2aWNlL3BpbS1wZXJzb24vcGltLXBlcnNvbi1zZXJ2aWNlJzsKaW1wb3J0IEhNREluZm9HcmlkU2VydmljZSBmcm9tICcuL2htZGluZm8tZ3JpZC1ncmlkLXNlcnZpY2UnOwppbXBvcnQgQ29kZUxpc3RTZXJ2aWNlIGZyb20gIkBzZXJ2aWNlL2FwcC9jb2RlbGlzdC1zZXJ2aWNlIjsKaW1wb3J0IHsgRm9ybUl0ZW1Nb2RlbCB9IGZyb20gJ0AvbW9kZWwvZm9ybS1kZXRhaWwnOwoKdmFyIEhNREluZm9HcmlkQmFzZSA9Ci8qI19fUFVSRV9fKi8KZnVuY3Rpb24gKF9WdWUpIHsKICBfaW5oZXJpdHMoSE1ESW5mb0dyaWRCYXNlLCBfVnVlKTsKCiAgZnVuY3Rpb24gSE1ESW5mb0dyaWRCYXNlKCkgewogICAgdmFyIF90aGlzMjsKCiAgICBfY2xhc3NDYWxsQ2hlY2sodGhpcywgSE1ESW5mb0dyaWRCYXNlKTsKCiAgICBfdGhpczIgPSBfcG9zc2libGVDb25zdHJ1Y3RvclJldHVybih0aGlzLCBfZ2V0UHJvdG90eXBlT2YoSE1ESW5mb0dyaWRCYXNlKS5hcHBseSh0aGlzLCBhcmd1bWVudHMpKTsKICAgIC8qKg0KICAgICAqIOiuoeaVsOWZqOacjeWKoeWvueixoembhuWQiA0KICAgICAqDQogICAgICogQHR5cGUge0FycmF5PCo+fQ0KICAgICAqIEBtZW1iZXJvZiBITURJbmZvR3JpZEJhc2UNCiAgICAgKi8KCiAgICBfdGhpczIuY291bnRlclNlcnZpY2VBcnJheSA9IFtdOwogICAgLyoqDQogICAgICog5bu65p6E6YOo5Lu25pyN5Yqh5a+56LGhDQogICAgICoNCiAgICAgKiBAdHlwZSB7SE1ESW5mb0dyaWRTZXJ2aWNlfQ0KICAgICAqIEBtZW1iZXJvZiBITURJbmZvR3JpZEJhc2UNCiAgICAgKi8KCiAgICBfdGhpczIuc2VydmljZSA9IG5ldyBITURJbmZvR3JpZFNlcnZpY2UoewogICAgICAkc3RvcmU6IF90aGlzMi4kc3RvcmUKICAgIH0pOwogICAgLyoqDQogICAgICog5a6e5L2T5pyN5Yqh5a+56LGhDQogICAgICoNCiAgICAgKiBAdHlwZSB7UGltUGVyc29uU2VydmljZX0NCiAgICAgKiBAbWVtYmVyb2YgSE1ESW5mb0dyaWRCYXNlDQogICAgICovCgogICAgX3RoaXMyLmFwcEVudGl0eVNlcnZpY2UgPSBuZXcgUGltUGVyc29uU2VydmljZSh7CiAgICAgICRzdG9yZTogX3RoaXMyLiRzdG9yZQogICAgfSk7CiAgICAvKioNCiAgICAgKiDku6PnoIHooajmnI3liqHlr7nosaENCiAgICAgKg0KICAgICAqIEB0eXBlIHtDb2RlTGlzdFNlcnZpY2V9DQogICAgICogQG1lbWJlcm9mIEhNREluZm9HcmlkQmFzZQ0KICAgICAqLwoKICAgIF90aGlzMi5jb2RlTGlzdFNlcnZpY2UgPSBuZXcgQ29kZUxpc3RTZXJ2aWNlKHsKICAgICAgJHN0b3JlOiBfdGhpczIuJHN0b3JlCiAgICB9KTsKICAgIC8qKg0KICAgICAqIOW9k+WJjemhtQ0KICAgICAqDQogICAgICogQHR5cGUge251bWJlcn0NCiAgICAgKiBAbWVtYmVyb2YgSE1ESW5mb0dyaWRCYXNlDQogICAgICovCgogICAgX3RoaXMyLmN1clBhZ2UgPSAxOwogICAgLyoqDQogICAgICog5pWw5o2uDQogICAgICoNCiAgICAgKiBAdHlwZSB7YW55W119DQogICAgICogQG1lbWJlcm9mIEhNREluZm9HcmlkQmFzZQ0KICAgICAqLwoKICAgIF90aGlzMi5pdGVtcyA9IFtdOwogICAgLyoqDQogICAgICog5piv5ZCm5pSv5oyB5YiG6aG1DQogICAgICoNCiAgICAgKiBAdHlwZSB7Ym9vbGVhbn0NCiAgICAgKiBAbWVtYmVyb2YgSE1ESW5mb0dyaWRCYXNlDQogICAgICovCgogICAgX3RoaXMyLmlzRW5hYmxlUGFnaW5nQmFyID0gdHJ1ZTsKICAgIC8qKg0KICAgICAqIOaYr+WQpuemgeeUqOaOkuW6jw0KICAgICAqDQogICAgICogQHR5cGUge2Jvb2xlYW59DQogICAgICogQG1lbWJlcm9mIEhNREluZm9HcmlkQmFzZQ0KICAgICAqLwoKICAgIF90aGlzMi5pc05vU29ydCA9IGZhbHNlOwogICAgLyoqDQogICAgICog5o6S5bqP5pa55ZCRDQogICAgICoNCiAgICAgKiBAdHlwZSB7c3RyaW5nfQ0KICAgICAqIEBtZW1iZXJvZiBITURJbmZvR3JpZEJhc2UNCiAgICAgKi8KCiAgICBfdGhpczIubWlub3JTb3J0RGlyID0gJ0RFU0MnOwogICAgLyoqDQogICAgICog5o6S5bqP5a2X5q61DQogICAgICoNCiAgICAgKiBAdHlwZSB7c3RyaW5nfQ0KICAgICAqIEBtZW1iZXJvZiBITURJbmZvR3JpZEJhc2UNCiAgICAgKi8KCiAgICBfdGhpczIubWlub3JTb3J0UFNERUYgPSAndXBkYXRlZGF0ZSc7CiAgICAvKioNCiAgICAgKiDliIbpobXmnaHmlbANCiAgICAgKg0KICAgICAqIEB0eXBlIHtudW1iZXJ9DQogICAgICogQG1lbWJlcm9mIEhNREluZm9HcmlkQmFzZQ0KICAgICAqLwoKICAgIF90aGlzMi5saW1pdCA9IDEwMDsKICAgIC8qKg0KICAgICAqIOaYr+WQpuaYvuekuuagh+mimA0KICAgICAqDQogICAgICogQHR5cGUge2Jvb2xlYW59DQogICAgICogQG1lbWJlcm9mIEhNREluZm9HcmlkQmFzZQ0KICAgICAqLwoKICAgIF90aGlzMi5pc0hpZGVIZWFkZXIgPSBmYWxzZTsKICAgIC8qKg0KICAgICAqIOWunumZheaYr+WQpuW8gOWQr+ihjOe8lui+kQ0KICAgICAqDQogICAgICogQHR5cGUge2Jvb2xlYW59DQogICAgICogQG1lbWJlcm9mIEhNREluZm9HcmlkQmFzZQ0KICAgICAqLwoKICAgIF90aGlzMi5hY3R1YWxJc09wZW5FZGl0ID0gX3RoaXMyLmlzT3BlbkVkaXQ7CiAgICAvKioNCiAgICAgKiDmgLvmnaHmlbANCiAgICAgKg0KICAgICAqIEB0eXBlIHtudW1iZXJ9DQogICAgICogQG1lbWJlcm9mIEhNREluZm9HcmlkQmFzZQ0KICAgICAqLwoKICAgIF90aGlzMi50b3RhbHJvdyA9IDA7CiAgICAvKioNCiAgICAgKiDpgInkuK3ooYzmlbDmja4NCiAgICAgKg0KICAgICAqIEB0eXBlIHthbnlbXX0NCiAgICAgKiBAbWVtYmVyb2YgTWFpbg0KICAgICAqLwoKICAgIF90aGlzMi5zZWxlY3Rpb25zID0gW107CiAgICAvKioNCiAgICAgKiDmi6bmiKrooYzpgInkuK0NCiAgICAgKg0KICAgICAqIEB0eXBlIHtib29sZWFufQ0KICAgICAqIEBtZW1iZXJvZiBNYWluDQogICAgICovCgogICAgX3RoaXMyLnN0b3BSb3dDbGljayA9IGZhbHNlOwogICAgLyoqDQogICAgICog6KGo5qC85piv5ZCm5pi+56S6DQogICAgICoNCiAgICAgKiBAdHlwZSB7Ym9vbGVhbn0NCiAgICAgKiBAbWVtYmVyb2YgSE1ESW5mb0dyaWRCYXNlDQogICAgICovCgogICAgX3RoaXMyLmlzRGlzcGxheSA9IHRydWU7CiAgICAvKioNCiAgICAqIOmAiemhueahhuWIl+WuvQ0KICAgICoNCiAgICAqIEB0eXBlIHtudW1iZXJ9DQogICAgKiBAbWVtYmVyb2YgQXBwSW5kZXgNCiAgICAqLwoKICAgIF90aGlzMi5jaGVja2JveENvbFdpZHRoID0gMzQ7CiAgICAvKioNCiAgICAgKiDmmK/lkKblhYHorrjmi5bliqjliJflrr0NCiAgICAgKg0KICAgICAqIEB0eXBlIHtib29sZWFufQ0KICAgICAqIEBtZW1iZXJvZiBBcHBFbWJlZFBpY2tlcg0KICAgICAqLwoKICAgIF90aGlzMi5pc0RyYWdlbmRDb2wgPSBmYWxzZTsKICAgIC8qKg0KICAgICAqIOaJgOacieWIl+aIkOWRmA0KICAgICAqDQogICAgICogQHR5cGUge2FueVtdfQ0KICAgICAqIEBtZW1iZXJvZiBITURJbmZvR3JpZEJhc2UNCiAgICAgKi8KCiAgICBfdGhpczIuYWxsQ29sdW1ucyA9IFt7CiAgICAgIG5hbWU6ICd5Z2JoJywKICAgICAgbGFiZWw6ICflkZjlt6XnvJblj7cnLAogICAgICBsYW5ndGFnOiAnZW50aXRpZXMucGltcGVyc29uLmhtZGluZm9ncmlkX2dyaWQuY29sdW1ucy55Z2JoJywKICAgICAgc2hvdzogdHJ1ZSwKICAgICAgdXRpbDogJ1BYJwogICAgfSwgewogICAgICBuYW1lOiAncGltcGVyc29ubmFtZScsCiAgICAgIGxhYmVsOiAn5ZGY5bel5aeT5ZCNJywKICAgICAgbGFuZ3RhZzogJ2VudGl0aWVzLnBpbXBlcnNvbi5obWRpbmZvZ3JpZF9ncmlkLmNvbHVtbnMucGltcGVyc29ubmFtZScsCiAgICAgIHNob3c6IHRydWUsCiAgICAgIHV0aWw6ICdQWCcKICAgIH0sIHsKICAgICAgbmFtZTogJ3pqaG0nLAogICAgICBsYWJlbDogJ+ivgeS7tuWPt+eggScsCiAgICAgIGxhbmd0YWc6ICdlbnRpdGllcy5waW1wZXJzb24uaG1kaW5mb2dyaWRfZ3JpZC5jb2x1bW5zLnpqaG0nLAogICAgICBzaG93OiB0cnVlLAogICAgICB1dGlsOiAnUFgnCiAgICB9LCB7CiAgICAgIG5hbWU6ICd6emR6cycsCiAgICAgIGxhYmVsOiAn57uE57uHJywKICAgICAgbGFuZ3RhZzogJ2VudGl0aWVzLnBpbXBlcnNvbi5obWRpbmZvZ3JpZF9ncmlkLmNvbHVtbnMuenpkenMnLAogICAgICBzaG93OiB0cnVlLAogICAgICB1dGlsOiAncHgnCiAgICB9LCB7CiAgICAgIG5hbWU6ICd5Z3p0JywKICAgICAgbGFiZWw6ICflkZjlt6XnirbmgIEnLAogICAgICBsYW5ndGFnOiAnZW50aXRpZXMucGltcGVyc29uLmhtZGluZm9ncmlkX2dyaWQuY29sdW1ucy55Z3p0JywKICAgICAgc2hvdzogdHJ1ZSwKICAgICAgdXRpbDogJ1BYJwogICAgfSwgewogICAgICBuYW1lOiAnaG1kJywKICAgICAgbGFiZWw6ICfliJflhaXpu5HlkI3ljZUnLAogICAgICBsYW5ndGFnOiAnZW50aXRpZXMucGltcGVyc29uLmhtZGluZm9ncmlkX2dyaWQuY29sdW1ucy5obWQnLAogICAgICBzaG93OiB0cnVlLAogICAgICB1dGlsOiAnUFgnCiAgICB9LCB7CiAgICAgIG5hbWU6ICdibGFja2xpc3RyZWFzb25zJywKICAgICAgbGFiZWw6ICfpu5HlkI3ljZXljp/lm6AnLAogICAgICBsYW5ndGFnOiAnZW50aXRpZXMucGltcGVyc29uLmhtZGluZm9ncmlkX2dyaWQuY29sdW1ucy5ibGFja2xpc3RyZWFzb25zJywKICAgICAgc2hvdzogdHJ1ZSwKICAgICAgdXRpbDogJ1BYJwogICAgfV07CiAgICAvKioNCiAgICAgKiDooajmoLzmqKHlnovpm4blkIgNCiAgICAgKg0KICAgICAqIEB0eXBlIHsqfQ0KICAgICAqIEBtZW1iZXJvZiBITURJbmZvR3JpZEJhc2UNCiAgICAgKi8KCiAgICBfdGhpczIuZ3JpZEl0ZW1zTW9kZWwgPSBbXTsKICAgIC8qKg0KICAgICAqIOWxnuaAp+WAvOinhOWImQ0KICAgICAqDQogICAgICogQHR5cGUgeyp9DQogICAgICogQG1lbWJlcm9mIEhNREluZm9HcmlkQmFzZQ0KICAgICAqLwoKICAgIF90aGlzMi5ydWxlcyA9IHsKICAgICAgc3Jma2V5OiBbewogICAgICAgIHJlcXVpcmVkOiBmYWxzZSwKICAgICAgICB2YWxpZGF0b3I6IGZ1bmN0aW9uIHZhbGlkYXRvcihydWxlLCB2YWx1ZSwgY2FsbGJhY2spIHsKICAgICAgICAgIHJldHVybiBydWxlLnJlcXVpcmVkICYmICh2YWx1ZSA9PT0gbnVsbCB8fCB2YWx1ZSA9PT0gdW5kZWZpbmVkIHx8IHZhbHVlID09PSAiIikgPyBmYWxzZSA6IHRydWU7CiAgICAgICAgfSwKICAgICAgICBtZXNzYWdlOiAn5Lq65ZGY5L+h5oGv5qCH6K+GIOWAvOS4jeiDveS4uuepuicsCiAgICAgICAgdHJpZ2dlcjogJ2NoYW5nZScKICAgICAgfSwgewogICAgICAgIHJlcXVpcmVkOiBmYWxzZSwKICAgICAgICB2YWxpZGF0b3I6IGZ1bmN0aW9uIHZhbGlkYXRvcihydWxlLCB2YWx1ZSwgY2FsbGJhY2spIHsKICAgICAgICAgIHJldHVybiBydWxlLnJlcXVpcmVkICYmICh2YWx1ZSA9PT0gbnVsbCB8fCB2YWx1ZSA9PT0gdW5kZWZpbmVkIHx8IHZhbHVlID09PSAiIikgPyBmYWxzZSA6IHRydWU7CiAgICAgICAgfSwKICAgICAgICBtZXNzYWdlOiAn5Lq65ZGY5L+h5oGv5qCH6K+GIOWAvOS4jeiDveS4uuepuicsCiAgICAgICAgdHJpZ2dlcjogJ2JsdXInCiAgICAgIH1dCiAgICB9OwogICAgcmV0dXJuIF90aGlzMjsKICB9CiAgLyoqDQogICAqIOiOt+WPlumDqOS7tuexu+Weiw0KICAgKg0KICAgKiBAcmV0dXJucyB7c3RyaW5nfQ0KICAgKiBAbWVtYmVyb2YgSE1ESW5mb0dyaWRCYXNlDQogICAqLwoKCiAgX2NyZWF0ZUNsYXNzKEhNREluZm9HcmlkQmFzZSwgW3sKICAgIGtleTogImdldENvbnRyb2xUeXBlIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBnZXRDb250cm9sVHlwZSgpIHsKICAgICAgcmV0dXJuICdHUklEJzsKICAgIH0KICAgIC8qKg0KICAgICAqIOWFs+mXreinhuWbvg0KICAgICAqDQogICAgICogQHBhcmFtIHthbnl9IGFyZ3MNCiAgICAgKiBAbWVtYmVyb2YgSE1ESW5mb0dyaWRCYXNlDQogICAgICovCgogIH0sIHsKICAgIGtleTogImNsb3NlVmlldyIsCiAgICB2YWx1ZTogZnVuY3Rpb24gY2xvc2VWaWV3KGFyZ3MpIHsKICAgICAgdmFyIF90aGlzID0gdGhpczsKCiAgICAgIF90aGlzLiRlbWl0KCdjbG9zZXZpZXcnLCBbYXJnc10pOwogICAgfQogICAgLyoqDQogICAgICogIOiuoeaVsOWZqOWIt+aWsA0KICAgICAqDQogICAgICogQG1lbWJlcm9mIEhNREluZm9HcmlkQmFzZQ0KICAgICAqLwoKICB9LCB7CiAgICBrZXk6ICJjb3VudGVyUmVmcmVzaCIsCiAgICB2YWx1ZTogZnVuY3Rpb24gY291bnRlclJlZnJlc2goKSB7CiAgICAgIHZhciBfdGhpcyA9IHRoaXM7CgogICAgICBpZiAoX3RoaXMuY291bnRlclNlcnZpY2VBcnJheSAmJiBfdGhpcy5jb3VudGVyU2VydmljZUFycmF5Lmxlbmd0aCA+IDApIHsKICAgICAgICBfdGhpcy5jb3VudGVyU2VydmljZUFycmF5LmZvckVhY2goZnVuY3Rpb24gKGl0ZW0pIHsKICAgICAgICAgIGlmIChpdGVtLnJlZnJlc2hEYXRhICYmIGl0ZW0ucmVmcmVzaERhdGEgaW5zdGFuY2VvZiBGdW5jdGlvbikgewogICAgICAgICAgICBpdGVtLnJlZnJlc2hEYXRhKCk7CiAgICAgICAgICB9CiAgICAgICAgfSk7CiAgICAgIH0KICAgIH0KICAgIC8qKg0KICAgICAqIOiOt+WPluWkmumhueaVsOaNrg0KICAgICAqDQogICAgICogQHJldHVybnMge2FueVtdfQ0KICAgICAqIEBtZW1iZXJvZiBITURJbmZvR3JpZEJhc2UNCiAgICAgKi8KCiAgfSwgewogICAga2V5OiAiZ2V0RGF0YXMiLAogICAgdmFsdWU6IGZ1bmN0aW9uIGdldERhdGFzKCkgewogICAgICByZXR1cm4gdGhpcy5zZWxlY3Rpb25zOwogICAgfQogICAgLyoqDQogICAgICog6I635Y+W5Y2V6aG55qCRDQogICAgICoNCiAgICAgKiBAcmV0dXJucyB7Kn0NCiAgICAgKiBAbWVtYmVyb2YgSE1ESW5mb0dyaWRCYXNlDQogICAgICovCgogIH0sIHsKICAgIGtleTogImdldERhdGEiLAogICAgdmFsdWU6IGZ1bmN0aW9uIGdldERhdGEoKSB7CiAgICAgIHJldHVybiB0aGlzLnNlbGVjdGlvbnNbMF07CiAgICB9CiAgICAvKioNCiAgICAgKiDpgInkuK3lgLzlj5jljJYNCiAgICAgKg0KICAgICAqIEBwYXJhbSB7Kn0gbmV3VmFsDQogICAgICogQHBhcmFtIHsqfSBvbGRWYWwNCiAgICAgKiBAbWVtYmVyb2YgSE1ESW5mb0dyaWRCYXNlDQogICAgICovCgogIH0sIHsKICAgIGtleTogIm9uVmFsdWVDaGFuZ2UiLAogICAgdmFsdWU6IGZ1bmN0aW9uIG9uVmFsdWVDaGFuZ2UobmV3VmFsLCBvbGRWYWwpIHsKICAgICAgdmFyIF90aGlzMyA9IHRoaXM7CgogICAgICB0aGlzLnNlbGVjdGlvbnMgPSBbXTsKCiAgICAgIGlmICh0aGlzLnNlbGVjdGVkRGF0YSkgewogICAgICAgIHZhciByZWZzID0gdGhpcy4kcmVmczsKCiAgICAgICAgaWYgKHJlZnMubXVsdGlwbGVUYWJsZSkgewogICAgICAgICAgcmVmcy5tdWx0aXBsZVRhYmxlLmNsZWFyU2VsZWN0aW9uKCk7CiAgICAgICAgICBKU09OLnBhcnNlKHRoaXMuc2VsZWN0ZWREYXRhKS5mb3JFYWNoKGZ1bmN0aW9uIChzZWxlY3Rpb24pIHsKICAgICAgICAgICAgdmFyIHNlbGVjdGVkSXRlbSA9IF90aGlzMy5pdGVtcy5maW5kKGZ1bmN0aW9uIChpdGVtKSB7CiAgICAgICAgICAgICAgcmV0dXJuIE9iamVjdC5pcyhpdGVtLnNyZmtleSwgc2VsZWN0aW9uLnNyZmtleSk7CiAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgaWYgKHNlbGVjdGVkSXRlbSkgewogICAgICAgICAgICAgIF90aGlzMy5yb3dDbGljayhzZWxlY3RlZEl0ZW0pOwogICAgICAgICAgICB9CiAgICAgICAgICB9KTsKICAgICAgICB9CiAgICAgIH0KICAgIH0KICAgIC8qKg0KICAgICAqIOmDqOS7tuWIt+aWsA0KICAgICAqDQogICAgICogQHBhcmFtIHthbnlbXX0gYXJncw0KICAgICAqIEBtZW1iZXJvZiBITURJbmZvR3JpZEJhc2UNCiAgICAgKi8KCiAgfSwgewogICAga2V5OiAicmVmcmVzaCIsCiAgICB2YWx1ZTogZnVuY3Rpb24gcmVmcmVzaChhcmdzKSB7CiAgICAgIHRoaXMubG9hZCgpOwogICAgfQogICAgLyoqDQogICAgICog6I635Y+W6KGo5qC86KGM5qih5Z6LDQogICAgICoNCiAgICAgKiBAdHlwZSB7Kn0NCiAgICAgKiBAbWVtYmVyb2YgSE1ESW5mb0dyaWRCYXNlDQogICAgICovCgogIH0sIHsKICAgIGtleTogImdldEdyaWRSb3dNb2RlbCIsCiAgICB2YWx1ZTogZnVuY3Rpb24gZ2V0R3JpZFJvd01vZGVsKCkgewogICAgICByZXR1cm4gewogICAgICAgIHNyZmtleTogbmV3IEZvcm1JdGVtTW9kZWwoKQogICAgICB9OwogICAgfQogICAgLyoqDQogICAgICog6KGo5qC86KGM57yW6L6R6aG55qCh6aqMDQogICAgICoNCiAgICAgKiBAcGFyYW0ge3N0cmluZ30gcHJvcGVydHkg5bGe5oCn5ZCNDQogICAgICogQHBhcmFtIHsqfSBkYXRhIOihjOaVsOaNrg0KICAgICAqIEBwYXJhbSB7bnVtYmVyfSByb3dJbmRleCDooYzntKLlvJUNCiAgICAgKiBAcmV0dXJucyBQcm9taXNlPGFueT4NCiAgICAgKg0KICAgICAqIEBtZW1iZXJvZiBITURJbmZvR3JpZEJhc2UNCiAgICAgKi8KCiAgfSwgewogICAga2V5OiAidmFsaWRhdGUiLAogICAgdmFsdWU6IGZ1bmN0aW9uIHZhbGlkYXRlKHByb3BlcnR5LCBkYXRhLCByb3dJbmRleCkgewogICAgICB2YXIgX3RoaXM0ID0gdGhpczsKCiAgICAgIHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbiAocmVzb2x2ZSwgcmVqZWN0KSB7CiAgICAgICAgX3RoaXM0LiR1dGlsLnZhbGlkYXRlSXRlbShwcm9wZXJ0eSwgZGF0YSwgX3RoaXM0LnJ1bGVzKS50aGVuKGZ1bmN0aW9uICgpIHsKICAgICAgICAgIF90aGlzNC5ncmlkSXRlbXNNb2RlbFtyb3dJbmRleF1bcHJvcGVydHldLnNldEVycm9yKG51bGwpOwoKICAgICAgICAgIHJlc29sdmUodHJ1ZSk7CiAgICAgICAgfSlbImNhdGNoIl0oZnVuY3Rpb24gKF9yZWYpIHsKICAgICAgICAgIHZhciBlcnJvcnMgPSBfcmVmLmVycm9ycywKICAgICAgICAgICAgICBmaWVsZHMgPSBfcmVmLmZpZWxkczsKCiAgICAgICAgICBfdGhpczQuZ3JpZEl0ZW1zTW9kZWxbcm93SW5kZXhdW3Byb3BlcnR5XS5zZXRFcnJvcihlcnJvcnNbMF0ubWVzc2FnZSk7CgogICAgICAgICAgcmVzb2x2ZShmYWxzZSk7CiAgICAgICAgfSk7CiAgICAgIH0pOwogICAgfQogICAgLyoqDQogICAgICog5qCh6aqM5omA5pyJ5L+u5pS56L+H55qE57yW6L6R6aG5DQogICAgICoNCiAgICAgKiBAcmV0dXJucyBQcm9taXNlPGFueT4NCiAgICAgKiBAbWVtYmVyb2YgSE1ESW5mb0dyaWRCYXNlDQogICAgICovCgogIH0sIHsKICAgIGtleTogInZhbGlkYXRlQWxsIiwKICAgIHZhbHVlOiBmdW5jdGlvbiAoKSB7CiAgICAgIHZhciBfdmFsaWRhdGVBbGwgPSBfYXN5bmNUb0dlbmVyYXRvcigKICAgICAgLyojX19QVVJFX18qLwogICAgICByZWdlbmVyYXRvclJ1bnRpbWUubWFyayhmdW5jdGlvbiBfY2FsbGVlKCkgewogICAgICAgIHZhciB2YWxpZGF0ZVN0YXRlLCBpbmRleCwgX2l0ZXJhdG9yTm9ybWFsQ29tcGxldGlvbiwgX2RpZEl0ZXJhdG9yRXJyb3IsIF9pdGVyYXRvckVycm9yLCBfaXRlcmF0b3IsIF9zdGVwLCBpdGVtLCBfaSwgX09iamVjdCRrZXlzLCBwcm9wZXJ0eTsKCiAgICAgICAgcmV0dXJuIHJlZ2VuZXJhdG9yUnVudGltZS53cmFwKGZ1bmN0aW9uIF9jYWxsZWUkKF9jb250ZXh0KSB7CiAgICAgICAgICB3aGlsZSAoMSkgewogICAgICAgICAgICBzd2l0Y2ggKF9jb250ZXh0LnByZXYgPSBfY29udGV4dC5uZXh0KSB7CiAgICAgICAgICAgICAgY2FzZSAwOgogICAgICAgICAgICAgICAgdmFsaWRhdGVTdGF0ZSA9IHRydWU7CiAgICAgICAgICAgICAgICBpbmRleCA9IC0xOwogICAgICAgICAgICAgICAgX2l0ZXJhdG9yTm9ybWFsQ29tcGxldGlvbiA9IHRydWU7CiAgICAgICAgICAgICAgICBfZGlkSXRlcmF0b3JFcnJvciA9IGZhbHNlOwogICAgICAgICAgICAgICAgX2l0ZXJhdG9yRXJyb3IgPSB1bmRlZmluZWQ7CiAgICAgICAgICAgICAgICBfY29udGV4dC5wcmV2ID0gNTsKICAgICAgICAgICAgICAgIF9pdGVyYXRvciA9IHRoaXMuaXRlbXNbU3ltYm9sLml0ZXJhdG9yXSgpOwoKICAgICAgICAgICAgICBjYXNlIDc6CiAgICAgICAgICAgICAgICBpZiAoX2l0ZXJhdG9yTm9ybWFsQ29tcGxldGlvbiA9IChfc3RlcCA9IF9pdGVyYXRvci5uZXh0KCkpLmRvbmUpIHsKICAgICAgICAgICAgICAgICAgX2NvbnRleHQubmV4dCA9IDI0OwogICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBpdGVtID0gX3N0ZXAudmFsdWU7CiAgICAgICAgICAgICAgICBpbmRleCsrOwoKICAgICAgICAgICAgICAgIGlmICghKGl0ZW0ucm93RGF0YVN0YXRlID09PSAiY3JlYXRlIiB8fCBpdGVtLnJvd0RhdGFTdGF0ZSA9PT0gInVwZGF0ZSIpKSB7CiAgICAgICAgICAgICAgICAgIF9jb250ZXh0Lm5leHQgPSAyMTsKICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgX2kgPSAwLCBfT2JqZWN0JGtleXMgPSBPYmplY3Qua2V5cyh0aGlzLnJ1bGVzKTsKCiAgICAgICAgICAgICAgY2FzZSAxMjoKICAgICAgICAgICAgICAgIGlmICghKF9pIDwgX09iamVjdCRrZXlzLmxlbmd0aCkpIHsKICAgICAgICAgICAgICAgICAgX2NvbnRleHQubmV4dCA9IDIxOwogICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBwcm9wZXJ0eSA9IF9PYmplY3Qka2V5c1tfaV07CiAgICAgICAgICAgICAgICBfY29udGV4dC5uZXh0ID0gMTY7CiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy52YWxpZGF0ZShwcm9wZXJ0eSwgaXRlbSwgaW5kZXgpOwoKICAgICAgICAgICAgICBjYXNlIDE2OgogICAgICAgICAgICAgICAgaWYgKF9jb250ZXh0LnNlbnQpIHsKICAgICAgICAgICAgICAgICAgX2NvbnRleHQubmV4dCA9IDE4OwogICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICB2YWxpZGF0ZVN0YXRlID0gZmFsc2U7CgogICAgICAgICAgICAgIGNhc2UgMTg6CiAgICAgICAgICAgICAgICBfaSsrOwogICAgICAgICAgICAgICAgX2NvbnRleHQubmV4dCA9IDEyOwogICAgICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgICAgIGNhc2UgMjE6CiAgICAgICAgICAgICAgICBfaXRlcmF0b3JOb3JtYWxDb21wbGV0aW9uID0gdHJ1ZTsKICAgICAgICAgICAgICAgIF9jb250ZXh0Lm5leHQgPSA3OwogICAgICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgICAgIGNhc2UgMjQ6CiAgICAgICAgICAgICAgICBfY29udGV4dC5uZXh0ID0gMzA7CiAgICAgICAgICAgICAgICBicmVhazsKCiAgICAgICAgICAgICAgY2FzZSAyNjoKICAgICAgICAgICAgICAgIF9jb250ZXh0LnByZXYgPSAyNjsKICAgICAgICAgICAgICAgIF9jb250ZXh0LnQwID0gX2NvbnRleHRbImNhdGNoIl0oNSk7CiAgICAgICAgICAgICAgICBfZGlkSXRlcmF0b3JFcnJvciA9IHRydWU7CiAgICAgICAgICAgICAgICBfaXRlcmF0b3JFcnJvciA9IF9jb250ZXh0LnQwOwoKICAgICAgICAgICAgICBjYXNlIDMwOgogICAgICAgICAgICAgICAgX2NvbnRleHQucHJldiA9IDMwOwogICAgICAgICAgICAgICAgX2NvbnRleHQucHJldiA9IDMxOwoKICAgICAgICAgICAgICAgIGlmICghX2l0ZXJhdG9yTm9ybWFsQ29tcGxldGlvbiAmJiBfaXRlcmF0b3JbInJldHVybiJdICE9IG51bGwpIHsKICAgICAgICAgICAgICAgICAgX2l0ZXJhdG9yWyJyZXR1cm4iXSgpOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICBjYXNlIDMzOgogICAgICAgICAgICAgICAgX2NvbnRleHQucHJldiA9IDMzOwoKICAgICAgICAgICAgICAgIGlmICghX2RpZEl0ZXJhdG9yRXJyb3IpIHsKICAgICAgICAgICAgICAgICAgX2NvbnRleHQubmV4dCA9IDM2OwogICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICB0aHJvdyBfaXRlcmF0b3JFcnJvcjsKCiAgICAgICAgICAgICAgY2FzZSAzNjoKICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dC5maW5pc2goMzMpOwoKICAgICAgICAgICAgICBjYXNlIDM3OgogICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0LmZpbmlzaCgzMCk7CgogICAgICAgICAgICAgIGNhc2UgMzg6CiAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQuYWJydXB0KCJyZXR1cm4iLCB2YWxpZGF0ZVN0YXRlKTsKCiAgICAgICAgICAgICAgY2FzZSAzOToKICAgICAgICAgICAgICBjYXNlICJlbmQiOgogICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0LnN0b3AoKTsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0sIF9jYWxsZWUsIHRoaXMsIFtbNSwgMjYsIDMwLCAzOF0sIFszMSwsIDMzLCAzN11dKTsKICAgICAgfSkpOwoKICAgICAgZnVuY3Rpb24gdmFsaWRhdGVBbGwoKSB7CiAgICAgICAgcmV0dXJuIF92YWxpZGF0ZUFsbC5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwogICAgICB9CgogICAgICByZXR1cm4gdmFsaWRhdGVBbGw7CiAgICB9KCkKICAgIC8qKg0KICAgICAqIOihqOagvOaVsOaNruWKoOi9vQ0KICAgICAqDQogICAgICogQHBhcmFtIHsqfSBbYXJnPXt9XQ0KICAgICAqIEBtZW1iZXJvZiBITURJbmZvR3JpZEJhc2UNCiAgICAgKi8KCiAgfSwgewogICAga2V5OiAibG9hZCIsCiAgICB2YWx1ZTogZnVuY3Rpb24gbG9hZCgpIHsKICAgICAgdmFyIF90aGlzNSA9IHRoaXM7CgogICAgICB2YXIgb3B0ID0gYXJndW1lbnRzLmxlbmd0aCA+IDAgJiYgYXJndW1lbnRzWzBdICE9PSB1bmRlZmluZWQgPyBhcmd1bWVudHNbMF0gOiB7fTsKICAgICAgdmFyIHBhZ2VSZXNldCA9IGFyZ3VtZW50cy5sZW5ndGggPiAxICYmIGFyZ3VtZW50c1sxXSAhPT0gdW5kZWZpbmVkID8gYXJndW1lbnRzWzFdIDogZmFsc2U7CgogICAgICBpZiAoIXRoaXMuZmV0Y2hBY3Rpb24pIHsKICAgICAgICB0aGlzLiROb3RpY2UuZXJyb3IoewogICAgICAgICAgdGl0bGU6ICfplJnor68nLAogICAgICAgICAgZGVzYzogJ1BJTVBFUlNPTkhNREdyaWRWaWV36KeG5Zu+6KGo5qC8ZmV0Y2hBY3Rpb27lj4LmlbDmnKrphY3nva4nCiAgICAgICAgfSk7CiAgICAgICAgcmV0dXJuOwogICAgICB9CgogICAgICBpZiAocGFnZVJlc2V0KSB7CiAgICAgICAgdGhpcy5jdXJQYWdlID0gMTsKICAgICAgfQoKICAgICAgdmFyIGFyZyA9IF9vYmplY3RTcHJlYWQoe30sIG9wdCk7CgogICAgICB2YXIgcGFnZSA9IHt9OwoKICAgICAgaWYgKHRoaXMuaXNFbmFibGVQYWdpbmdCYXIpIHsKICAgICAgICBPYmplY3QuYXNzaWduKHBhZ2UsIHsKICAgICAgICAgIHBhZ2U6IHRoaXMuY3VyUGFnZSAtIDEsCiAgICAgICAgICBzaXplOiB0aGlzLmxpbWl0CiAgICAgICAgfSk7CiAgICAgIH0gLy8g6K6+572u5o6S5bqPCgoKICAgICAgaWYgKCF0aGlzLmlzTm9Tb3J0ICYmICFPYmplY3QuaXModGhpcy5taW5vclNvcnREaXIsICcnKSAmJiAhT2JqZWN0LmlzKHRoaXMubWlub3JTb3J0UFNERUYsICcnKSkgewogICAgICAgIHZhciBzb3J0ID0gdGhpcy5taW5vclNvcnRQU0RFRiArICIsIiArIHRoaXMubWlub3JTb3J0RGlyOwogICAgICAgIE9iamVjdC5hc3NpZ24ocGFnZSwgewogICAgICAgICAgc29ydDogc29ydAogICAgICAgIH0pOwogICAgICB9CgogICAgICBPYmplY3QuYXNzaWduKGFyZywgcGFnZSk7CiAgICAgIHZhciBwYXJlbnRkYXRhID0ge307CiAgICAgIHRoaXMuJGVtaXQoJ2JlZm9yZWxvYWQnLCBwYXJlbnRkYXRhKTsKICAgICAgT2JqZWN0LmFzc2lnbihhcmcsIHBhcmVudGRhdGEpOwogICAgICB2YXIgdGVtcFZpZXdQYXJhbXMgPSBwYXJlbnRkYXRhLnZpZXdwYXJhbXMgPyBwYXJlbnRkYXRhLnZpZXdwYXJhbXMgOiB7fTsKICAgICAgT2JqZWN0LmFzc2lnbih0ZW1wVmlld1BhcmFtcywgSlNPTi5wYXJzZShKU09OLnN0cmluZ2lmeSh0aGlzLnZpZXdwYXJhbXMpKSk7CiAgICAgIE9iamVjdC5hc3NpZ24oYXJnLCB7CiAgICAgICAgdmlld3BhcmFtczogdGVtcFZpZXdQYXJhbXMKICAgICAgfSk7CiAgICAgIHZhciBwb3N0ID0gdGhpcy5zZXJ2aWNlLnNlYXJjaCh0aGlzLmZldGNoQWN0aW9uLCBKU09OLnBhcnNlKEpTT04uc3RyaW5naWZ5KHRoaXMuY29udGV4dCkpLCBhcmcsIHRoaXMuc2hvd0J1c3lJbmRpY2F0b3IpOwogICAgICBwb3N0LnRoZW4oZnVuY3Rpb24gKHJlc3BvbnNlKSB7CiAgICAgICAgaWYgKCFyZXNwb25zZS5zdGF0dXMgfHwgcmVzcG9uc2Uuc3RhdHVzICE9PSAyMDApIHsKICAgICAgICAgIGlmIChyZXNwb25zZS5lcnJvck1lc3NhZ2UpIHsKICAgICAgICAgICAgX3RoaXM1LiROb3RpY2UuZXJyb3IoewogICAgICAgICAgICAgIHRpdGxlOiAn6ZSZ6K+vJywKICAgICAgICAgICAgICBkZXNjOiByZXNwb25zZS5lcnJvck1lc3NhZ2UKICAgICAgICAgICAgfSk7CiAgICAgICAgICB9CgogICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KCiAgICAgICAgdmFyIGRhdGEgPSByZXNwb25zZS5kYXRhOwogICAgICAgIF90aGlzNS50b3RhbHJvdyA9IHJlc3BvbnNlLnRvdGFsOwogICAgICAgIF90aGlzNS5pdGVtcyA9IEpTT04ucGFyc2UoSlNPTi5zdHJpbmdpZnkoZGF0YSkpOyAvLyDmuIXnqbpzZWxlY3Rpb25zLGdyaWRJdGVtc01vZGVsCgogICAgICAgIF90aGlzNS5zZWxlY3Rpb25zID0gW107CiAgICAgICAgX3RoaXM1LmdyaWRJdGVtc01vZGVsID0gW107CgogICAgICAgIF90aGlzNS5pdGVtcy5mb3JFYWNoKGZ1bmN0aW9uICgpIHsKICAgICAgICAgIF90aGlzNS5ncmlkSXRlbXNNb2RlbC5wdXNoKF90aGlzNS5nZXRHcmlkUm93TW9kZWwoKSk7CiAgICAgICAgfSk7CgogICAgICAgIF90aGlzNS4kZW1pdCgnbG9hZCcsIF90aGlzNS5pdGVtcyk7IC8vIOiuvue9rum7mOiupOmAieS4rQoKCiAgICAgICAgdmFyIF90aGlzID0gX3RoaXM1OwogICAgICAgIHNldFRpbWVvdXQoZnVuY3Rpb24gKCkgewogICAgICAgICAgaWYgKF90aGlzLmlzU2VsZWN0Rmlyc3REZWZhdWx0KSB7CiAgICAgICAgICAgIF90aGlzLnJvd0NsaWNrKF90aGlzLml0ZW1zWzBdKTsKICAgICAgICAgIH0KCiAgICAgICAgICBpZiAoX3RoaXMuc2VsZWN0ZWREYXRhKSB7CiAgICAgICAgICAgIHZhciByZWZzID0gX3RoaXMuJHJlZnM7CgogICAgICAgICAgICBpZiAocmVmcy5tdWx0aXBsZVRhYmxlKSB7CiAgICAgICAgICAgICAgcmVmcy5tdWx0aXBsZVRhYmxlLmNsZWFyU2VsZWN0aW9uKCk7CiAgICAgICAgICAgICAgSlNPTi5wYXJzZShfdGhpcy5zZWxlY3RlZERhdGEpLmZvckVhY2goZnVuY3Rpb24gKHNlbGVjdGlvbikgewogICAgICAgICAgICAgICAgdmFyIHNlbGVjdGVkSXRlbSA9IF90aGlzLml0ZW1zLmZpbmQoZnVuY3Rpb24gKGl0ZW0pIHsKICAgICAgICAgICAgICAgICAgcmV0dXJuIE9iamVjdC5pcyhpdGVtLnNyZmtleSwgc2VsZWN0aW9uLnNyZmtleSk7CiAgICAgICAgICAgICAgICB9KTsKCiAgICAgICAgICAgICAgICBpZiAoc2VsZWN0ZWRJdGVtKSB7CiAgICAgICAgICAgICAgICAgIF90aGlzLnJvd0NsaWNrKHNlbGVjdGVkSXRlbSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9LCAzMDApOwogICAgICB9KVsiY2F0Y2giXShmdW5jdGlvbiAocmVzcG9uc2UpIHsKICAgICAgICBpZiAocmVzcG9uc2UgJiYgcmVzcG9uc2Uuc3RhdHVzID09PSA0MDEpIHsKICAgICAgICAgIHJldHVybjsKICAgICAgICB9CgogICAgICAgIF90aGlzNS4kTm90aWNlLmVycm9yKHsKICAgICAgICAgIHRpdGxlOiAn6ZSZ6K+vJywKICAgICAgICAgIGRlc2M6IHJlc3BvbnNlLmVycm9yTWVzc2FnZQogICAgICAgIH0pOwogICAgICB9KTsKICAgIH0KICAgIC8qKg0KICAgICAqIOWIoOmZpA0KICAgICAqDQogICAgICogQHBhcmFtIHthbnlbXX0gZGF0YXMNCiAgICAgKiBAcmV0dXJucyB7UHJvbWlzZTxhbnk+fQ0KICAgICAqIEBtZW1iZXJvZiBITURJbmZvR3JpZEJhc2UNCiAgICAgKi8KCiAgfSwgewogICAga2V5OiAicmVtb3ZlIiwKICAgIHZhbHVlOiBmdW5jdGlvbiAoKSB7CiAgICAgIHZhciBfcmVtb3ZlID0gX2FzeW5jVG9HZW5lcmF0b3IoCiAgICAgIC8qI19fUFVSRV9fKi8KICAgICAgcmVnZW5lcmF0b3JSdW50aW1lLm1hcmsoZnVuY3Rpb24gX2NhbGxlZTIoZGF0YXMpIHsKICAgICAgICB2YXIgX3RoaXM2ID0gdGhpczsKCiAgICAgICAgdmFyIF9kYXRhcywgZGF0YUluZm8sIHJlbW92ZURhdGE7CgogICAgICAgIHJldHVybiByZWdlbmVyYXRvclJ1bnRpbWUud3JhcChmdW5jdGlvbiBfY2FsbGVlMiQoX2NvbnRleHQyKSB7CiAgICAgICAgICB3aGlsZSAoMSkgewogICAgICAgICAgICBzd2l0Y2ggKF9jb250ZXh0Mi5wcmV2ID0gX2NvbnRleHQyLm5leHQpIHsKICAgICAgICAgICAgICBjYXNlIDA6CiAgICAgICAgICAgICAgICBpZiAodGhpcy5yZW1vdmVBY3Rpb24pIHsKICAgICAgICAgICAgICAgICAgX2NvbnRleHQyLm5leHQgPSAzOwogICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICB0aGlzLiROb3RpY2UuZXJyb3IoewogICAgICAgICAgICAgICAgICB0aXRsZTogJ+mUmeivrycsCiAgICAgICAgICAgICAgICAgIGRlc2M6ICdQSU1QRVJTT05ITURHcmlkVmlld+inhuWbvuihqOagvHJlbW92ZUFjdGlvbuWPguaVsOacqumFjee9ricKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0Mi5hYnJ1cHQoInJldHVybiIpOwoKICAgICAgICAgICAgICBjYXNlIDM6CiAgICAgICAgICAgICAgICBfZGF0YXMgPSBbXTsKICAgICAgICAgICAgICAgIGRhdGFzLmZvckVhY2goZnVuY3Rpb24gKHJlY29yZCwgaW5kZXgpIHsKICAgICAgICAgICAgICAgICAgaWYgKE9iamVjdC5pcyhyZWNvcmQuc3JmdWYsICIwIikpIHsKICAgICAgICAgICAgICAgICAgICBfdGhpczYuaXRlbXMuc29tZShmdW5jdGlvbiAodmFsLCBudW0pIHsKICAgICAgICAgICAgICAgICAgICAgIGlmIChKU09OLnN0cmluZ2lmeSh2YWwpID09IEpTT04uc3RyaW5naWZ5KHJlY29yZCkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgX3RoaXM2Lml0ZW1zLnNwbGljZShudW0sIDEpOwoKICAgICAgICAgICAgICAgICAgICAgICAgX3RoaXM2LmdyaWRJdGVtc01vZGVsLnNwbGljZShudW0sIDEpOwoKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgX2RhdGFzLnB1c2goZGF0YXNbaW5kZXhdKTsKICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSk7CgogICAgICAgICAgICAgICAgaWYgKCEoX2RhdGFzLmxlbmd0aCA9PT0gMCkpIHsKICAgICAgICAgICAgICAgICAgX2NvbnRleHQyLm5leHQgPSA3OwogICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQyLmFicnVwdCgicmV0dXJuIik7CgogICAgICAgICAgICAgIGNhc2UgNzoKICAgICAgICAgICAgICAgIGRhdGFJbmZvID0gJyc7CgogICAgICAgICAgICAgICAgX2RhdGFzLmZvckVhY2goZnVuY3Rpb24gKHJlY29yZCwgaW5kZXgpIHsKICAgICAgICAgICAgICAgICAgdmFyIHNyZm1ham9ydGV4dCA9IHJlY29yZC5waW1wZXJzb25uYW1lOwoKICAgICAgICAgICAgICAgICAgaWYgKGluZGV4IDwgNSkgewogICAgICAgICAgICAgICAgICAgIGlmICghT2JqZWN0LmlzKGRhdGFJbmZvLCAnJykpIHsKICAgICAgICAgICAgICAgICAgICAgIGRhdGFJbmZvICs9ICfjgIEnOwogICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgZGF0YUluZm8gKz0gc3JmbWFqb3J0ZXh0OwogICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSk7CgogICAgICAgICAgICAgICAgaWYgKF9kYXRhcy5sZW5ndGggPCA1KSB7CiAgICAgICAgICAgICAgICAgIGRhdGFJbmZvID0gZGF0YUluZm8gKyAnIOWFsScgKyBfZGF0YXMubGVuZ3RoICsgJ+adoeaVsOaNric7CiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICBkYXRhSW5mbyA9IGRhdGFJbmZvICsgJy4uLicgKyAnIOWFsScgKyBfZGF0YXMubGVuZ3RoICsgJ+adoeaVsOaNric7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgcmVtb3ZlRGF0YSA9IGZ1bmN0aW9uIHJlbW92ZURhdGEoKSB7CiAgICAgICAgICAgICAgICAgIHZhciBrZXlzID0gW107CgogICAgICAgICAgICAgICAgICBfZGF0YXMuZm9yRWFjaChmdW5jdGlvbiAoZGF0YSkgewogICAgICAgICAgICAgICAgICAgIGtleXMucHVzaChkYXRhLnNyZmtleSk7CiAgICAgICAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgICAgICAgdmFyIF9yZW1vdmVBY3Rpb24gPSBrZXlzLmxlbmd0aCA+IDEgPyAncmVtb3ZlQmF0Y2gnIDogX3RoaXM2LnJlbW92ZUFjdGlvbjsKCiAgICAgICAgICAgICAgICAgIHZhciBfa2V5cyA9IGtleXMubGVuZ3RoID4gMSA/IGtleXMgOiBrZXlzWzBdOwoKICAgICAgICAgICAgICAgICAgdmFyIGNvbnRleHQgPSBKU09OLnBhcnNlKEpTT04uc3RyaW5naWZ5KF90aGlzNi5jb250ZXh0KSk7CgogICAgICAgICAgICAgICAgICB2YXIgcG9zdCA9IF90aGlzNi5zZXJ2aWNlWyJkZWxldGUiXShfcmVtb3ZlQWN0aW9uLCBPYmplY3QuYXNzaWduKGNvbnRleHQsIHsKICAgICAgICAgICAgICAgICAgICBwaW1wZXJzb246IF9rZXlzCiAgICAgICAgICAgICAgICAgIH0pLCBPYmplY3QuYXNzaWduKHsKICAgICAgICAgICAgICAgICAgICBwaW1wZXJzb246IF9rZXlzCiAgICAgICAgICAgICAgICAgIH0sIHsKICAgICAgICAgICAgICAgICAgICB2aWV3cGFyYW1zOiBfdGhpczYudmlld3BhcmFtcwogICAgICAgICAgICAgICAgICB9KSwgX3RoaXM2LnNob3dCdXN5SW5kaWNhdG9yKTsKCiAgICAgICAgICAgICAgICAgIHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbiAocmVzb2x2ZSwgcmVqZWN0KSB7CiAgICAgICAgICAgICAgICAgICAgcG9zdC50aGVuKGZ1bmN0aW9uIChyZXNwb25zZSkgewogICAgICAgICAgICAgICAgICAgICAgaWYgKCFyZXNwb25zZSB8fCByZXNwb25zZS5zdGF0dXMgIT09IDIwMCkgewogICAgICAgICAgICAgICAgICAgICAgICBfdGhpczYuJE5vdGljZS5lcnJvcih7CiAgICAgICAgICAgICAgICAgICAgICAgICAgdGl0bGU6ICcnLAogICAgICAgICAgICAgICAgICAgICAgICAgIGRlc2M6ICfliKDpmaTmlbDmja7lpLHotKUsJyArIHJlc3BvbnNlLmluZm8KICAgICAgICAgICAgICAgICAgICAgICAgfSk7CgogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICBfdGhpczYuJE5vdGljZS5zdWNjZXNzKHsKICAgICAgICAgICAgICAgICAgICAgICAgICB0aXRsZTogJycsCiAgICAgICAgICAgICAgICAgICAgICAgICAgZGVzYzogJ+WIoOmZpOaIkOWKnyEnCiAgICAgICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgICAgfSAvL+WIoOmZpGl0ZW1z5Lit5bey5Yig6Zmk55qE6aG5CgoKICAgICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKF90aGlzNi5pdGVtcyk7CgogICAgICAgICAgICAgICAgICAgICAgX2RhdGFzLmZvckVhY2goZnVuY3Rpb24gKGRhdGEpIHsKICAgICAgICAgICAgICAgICAgICAgICAgX3RoaXM2Lml0ZW1zLnNvbWUoZnVuY3Rpb24gKGl0ZW0sIGluZGV4KSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKE9iamVjdC5pcyhpdGVtLnNyZmtleSwgZGF0YS5zcmZrZXkpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBfdGhpczYuaXRlbXMuc3BsaWNlKGluZGV4LCAxKTsKCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBfdGhpczYuZ3JpZEl0ZW1zTW9kZWwuc3BsaWNlKGluZGV4LCAxKTsKCiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgICAgfSk7CgogICAgICAgICAgICAgICAgICAgICAgX3RoaXM2LnRvdGFscm93IC09IF9kYXRhcy5sZW5ndGg7CgogICAgICAgICAgICAgICAgICAgICAgX3RoaXM2LiRlbWl0KCdyZW1vdmUnLCBudWxsKTsKCiAgICAgICAgICAgICAgICAgICAgICBfdGhpczYuc2VsZWN0aW9ucyA9IFtdOwogICAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZShyZXNwb25zZSk7CiAgICAgICAgICAgICAgICAgICAgfSlbImNhdGNoIl0oZnVuY3Rpb24gKHJlc3BvbnNlKSB7CiAgICAgICAgICAgICAgICAgICAgICBpZiAocmVzcG9uc2UgJiYgcmVzcG9uc2Uuc3RhdHVzID09PSA0MDEpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICAgIGlmICghcmVzcG9uc2UgfHwgIXJlc3BvbnNlLnN0YXR1cyB8fCAhcmVzcG9uc2UuZGF0YSkgewogICAgICAgICAgICAgICAgICAgICAgICBfdGhpczYuJE5vdGljZS5lcnJvcih7CiAgICAgICAgICAgICAgICAgICAgICAgICAgdGl0bGU6ICfplJnor68nLAogICAgICAgICAgICAgICAgICAgICAgICAgIGRlc2M6ICfns7vnu5/lvILluLgnCiAgICAgICAgICAgICAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgICAgICAgICAgICAgcmVqZWN0KHJlc3BvbnNlKTsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICAgIHJlamVjdChyZXNwb25zZSk7CiAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgfTsKCiAgICAgICAgICAgICAgICBkYXRhSW5mbyA9IGRhdGFJbmZvLnJlcGxhY2UoL1tudWxsXS9nLCAnJykucmVwbGFjZSgvW3VuZGVmaW5lZF0vZywgJycpOwogICAgICAgICAgICAgICAgdGhpcy4kTW9kYWwuY29uZmlybSh7CiAgICAgICAgICAgICAgICAgIHRpdGxlOiAn6K2m5ZGKJywKICAgICAgICAgICAgICAgICAgY29udGVudDogJ+ehruiupOimgeWIoOmZpCAnICsgZGF0YUluZm8gKyAn77yM5Yig6Zmk5pON5L2c5bCG5LiN5Y+v5oGi5aSN77yfJywKICAgICAgICAgICAgICAgICAgb25PazogZnVuY3Rpb24gb25PaygpIHsKICAgICAgICAgICAgICAgICAgICByZW1vdmVEYXRhKCk7CiAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgIG9uQ2FuY2VsOiBmdW5jdGlvbiBvbkNhbmNlbCgpIHt9CiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDIuYWJydXB0KCJyZXR1cm4iLCByZW1vdmVEYXRhKTsKCiAgICAgICAgICAgICAgY2FzZSAxNDoKICAgICAgICAgICAgICBjYXNlICJlbmQiOgogICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0Mi5zdG9wKCk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9LCBfY2FsbGVlMiwgdGhpcyk7CiAgICAgIH0pKTsKCiAgICAgIGZ1bmN0aW9uIHJlbW92ZShfeCkgewogICAgICAgIHJldHVybiBfcmVtb3ZlLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7CiAgICAgIH0KCiAgICAgIHJldHVybiByZW1vdmU7CiAgICB9KCkKICAgIC8qKg0KICAgICAqIOaJuemHj+a3u+WKoA0KICAgICAqDQogICAgICogQHBhcmFtIHsqfSBbYXJnPXt9XQ0KICAgICAqIEBtZW1iZXJvZiBITURJbmZvR3JpZEJhc2UNCiAgICAgKi8KCiAgfSwgewogICAga2V5OiAiYWRkQmF0Y2giLAogICAgdmFsdWU6IGZ1bmN0aW9uIGFkZEJhdGNoKCkgewogICAgICB2YXIgYXJnID0gYXJndW1lbnRzLmxlbmd0aCA+IDAgJiYgYXJndW1lbnRzWzBdICE9PSB1bmRlZmluZWQgPyBhcmd1bWVudHNbMF0gOiB7fTsKCiAgICAgIGlmICghdGhpcy5mZXRjaEFjdGlvbikgewogICAgICAgIHRoaXMuJE5vdGljZS5lcnJvcih7CiAgICAgICAgICB0aXRsZTogJ+mUmeivrycsCiAgICAgICAgICBkZXNjOiAnUElNUEVSU09OSE1ER3JpZFZpZXfop4blm77ooajmoLxmZXRjaEFjdGlvbuWPguaVsOacqumFjee9ricKICAgICAgICB9KTsKICAgICAgICByZXR1cm47CiAgICAgIH0KCiAgICAgIGlmICghYXJnKSB7CiAgICAgICAgYXJnID0ge307CiAgICAgIH0KCiAgICAgIGNvbnNvbGUuZXJyb3IoIuaJuemHj+a3u+WKoOacquWunueOsCIpOwogICAgfQogICAgLyoqDQogICAgICog5pWw5o2u5a+85YWlDQogICAgICoNCiAgICAgKiBAcGFyYW0geyp9IGRhdGENCiAgICAgKiBAbWVtYmVyb2YgSE1ESW5mb0dyaWRCYXNlDQogICAgICovCgogIH0sIHsKICAgIGtleTogImltcG9ydEV4Y2VsIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBpbXBvcnRFeGNlbCgpIHsKICAgICAgdmFyIF90aGlzNyA9IHRoaXM7CgogICAgICB2YXIgZGF0YSA9IGFyZ3VtZW50cy5sZW5ndGggPiAwICYmIGFyZ3VtZW50c1swXSAhPT0gdW5kZWZpbmVkID8gYXJndW1lbnRzWzBdIDoge307CiAgICAgIC8v5a+85YWlZXhjZWwKICAgICAgdmFyIGltcG9ydERhdGFNb2RlbCA9IHt9OwoKICAgICAgaWYgKE9iamVjdC5rZXlzKGltcG9ydERhdGFNb2RlbCkubGVuZ3RoID09IDApIHsKICAgICAgICB0aGlzLiROb3RpY2Uud2FybmluZyh7CiAgICAgICAgICAndGl0bGUnOiB0aGlzLiR0KCJhcHAudXRpbHZpZXcud2FybmluZyIpLAogICAgICAgICAgJ2Rlc2MnOiB0aGlzLiR0KCJhcHAudXRpbHZpZXcuaW5mbyIpCiAgICAgICAgfSk7CiAgICAgICAgcmV0dXJuOwogICAgICB9CgogICAgICB2YXIgdmlldyA9IHsKICAgICAgICB2aWV3bmFtZTogJ2FwcC1kYXRhLXVwbG9hZCcsCiAgICAgICAgdGl0bGU6IHRoaXMuJHQoImFwcC51dGlsdmlldy5pbXBvcnR2aWV3IiksCiAgICAgICAgd2lkdGg6IDkwMCwKICAgICAgICBoZWlnaHQ6IDcwMAogICAgICB9OwogICAgICB2YXIgY29udGFpbmVyID0gdGhpcy4kYXBwbW9kYWwub3Blbk1vZGFsKHZpZXcsIEpTT04ucGFyc2UoSlNPTi5zdHJpbmdpZnkodGhpcy5jb250ZXh0KSksIGltcG9ydERhdGFNb2RlbCk7CiAgICAgIGNvbnRhaW5lci5zdWJzY3JpYmUoZnVuY3Rpb24gKHJlc3VsdCkgewogICAgICAgIGlmIChPYmplY3QuaXMocmVzdWx0LnJldCwgJ09LJykpIHsKICAgICAgICAgIF90aGlzNy5yZWZyZXNoKHJlc3VsdC5kYXRhcyk7CiAgICAgICAgfQogICAgICB9KTsKICAgIH0KICAgIC8qKg0KICAgICAqIOaVsOaNruWvvOWHug0KICAgICAqDQogICAgICogQHBhcmFtIHsqfSBkYXRhDQogICAgICogQG1lbWJlcm9mIEhNREluZm9HcmlkQmFzZQ0KICAgICAqLwoKICB9LCB7CiAgICBrZXk6ICJleHBvcnRFeGNlbCIsCiAgICB2YWx1ZTogZnVuY3Rpb24gZXhwb3J0RXhjZWwoKSB7CiAgICAgIHZhciBfdGhpczggPSB0aGlzOwoKICAgICAgdmFyIGRhdGEgPSBhcmd1bWVudHMubGVuZ3RoID4gMCAmJiBhcmd1bWVudHNbMF0gIT09IHVuZGVmaW5lZCA/IGFyZ3VtZW50c1swXSA6IHt9OwoKICAgICAgLy8g5a+85Ye6RXhjZWwKICAgICAgdmFyIGRvRXhwb3J0ID0KICAgICAgLyojX19QVVJFX18qLwogICAgICBmdW5jdGlvbiAoKSB7CiAgICAgICAgdmFyIF9yZWYyID0gX2FzeW5jVG9HZW5lcmF0b3IoCiAgICAgICAgLyojX19QVVJFX18qLwogICAgICAgIHJlZ2VuZXJhdG9yUnVudGltZS5tYXJrKGZ1bmN0aW9uIF9jYWxsZWUzKF9kYXRhKSB7CiAgICAgICAgICB2YXIgdEhlYWRlciwgZmlsdGVyVmFsLCBkYXRhOwogICAgICAgICAgcmV0dXJuIHJlZ2VuZXJhdG9yUnVudGltZS53cmFwKGZ1bmN0aW9uIF9jYWxsZWUzJChfY29udGV4dDMpIHsKICAgICAgICAgICAgd2hpbGUgKDEpIHsKICAgICAgICAgICAgICBzd2l0Y2ggKF9jb250ZXh0My5wcmV2ID0gX2NvbnRleHQzLm5leHQpIHsKICAgICAgICAgICAgICAgIGNhc2UgMDoKICAgICAgICAgICAgICAgICAgdEhlYWRlciA9IFtdOwogICAgICAgICAgICAgICAgICBmaWx0ZXJWYWwgPSBbXTsKCiAgICAgICAgICAgICAgICAgIF90aGlzOC5hbGxDb2x1bW5zLmZvckVhY2goZnVuY3Rpb24gKGl0ZW0pIHsKICAgICAgICAgICAgICAgICAgICBpdGVtLnNob3cgJiYgaXRlbS5sYWJlbCA/IHRIZWFkZXIucHVzaChfdGhpczguJHQoaXRlbS5sYW5ndGFnKSkgOiAiIjsKICAgICAgICAgICAgICAgICAgICBpdGVtLnNob3cgJiYgaXRlbS5uYW1lID8gZmlsdGVyVmFsLnB1c2goaXRlbS5uYW1lKSA6ICIiOwogICAgICAgICAgICAgICAgICB9KTsKCiAgICAgICAgICAgICAgICAgIF9jb250ZXh0My5uZXh0ID0gNTsKICAgICAgICAgICAgICAgICAgcmV0dXJuIF90aGlzOC5mb3JtYXRFeGNlbERhdGEoZmlsdGVyVmFsLCBfZGF0YSk7CgogICAgICAgICAgICAgICAgY2FzZSA1OgogICAgICAgICAgICAgICAgICBkYXRhID0gX2NvbnRleHQzLnNlbnQ7CgogICAgICAgICAgICAgICAgICBfdGhpczguJGV4cG9ydC5leHBvcnRFeGNlbCgpLnRoZW4oZnVuY3Rpb24gKGV4Y2VsKSB7CiAgICAgICAgICAgICAgICAgICAgZXhjZWwuZXhwb3J0X2pzb25fdG9fZXhjZWwoewogICAgICAgICAgICAgICAgICAgICAgaGVhZGVyOiB0SGVhZGVyLAogICAgICAgICAgICAgICAgICAgICAgZGF0YTogZGF0YSwKICAgICAgICAgICAgICAgICAgICAgIGZpbGVuYW1lOiAi5Lq65ZGY5L+h5oGv6KGoIiwKICAgICAgICAgICAgICAgICAgICAgIGF1dG9XaWR0aDogdHJ1ZSwKICAgICAgICAgICAgICAgICAgICAgIGJvb2tUeXBlOiAieGxzeCIgLy/pnZ7lv4XloasKCiAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgICAgIGNhc2UgNzoKICAgICAgICAgICAgICAgIGNhc2UgImVuZCI6CiAgICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDMuc3RvcCgpOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgfSwgX2NhbGxlZTMpOwogICAgICAgIH0pKTsKCiAgICAgICAgcmV0dXJuIGZ1bmN0aW9uIGRvRXhwb3J0KF94MikgewogICAgICAgICAgcmV0dXJuIF9yZWYyLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7CiAgICAgICAgfTsKICAgICAgfSgpOwoKICAgICAgdmFyIHBhZ2UgPSB7fTsgLy8g6K6+572ucGFnZe+8jHNpemUKCiAgICAgIGlmIChPYmplY3QuaXMoZGF0YS50eXBlLCAnbWF4Um93Q291bnQnKSkgewogICAgICAgIE9iamVjdC5hc3NpZ24ocGFnZSwgewogICAgICAgICAgcGFnZTogMCwKICAgICAgICAgIHNpemU6IGRhdGEubWF4Um93Q291bnQKICAgICAgICB9KTsKICAgICAgfSBlbHNlIGlmIChPYmplY3QuaXMoZGF0YS50eXBlLCAnYWN0aXZhdGVkUGFnZScpKSB7CiAgICAgICAgdHJ5IHsKICAgICAgICAgIGRvRXhwb3J0KEpTT04ucGFyc2UoSlNPTi5zdHJpbmdpZnkodGhpcy5pdGVtcykpKTsKICAgICAgICB9IGNhdGNoIChlcnJvcikgewogICAgICAgICAgY29uc29sZS5lcnJvcihlcnJvcik7CiAgICAgICAgfQoKICAgICAgICByZXR1cm47CiAgICAgIH0gLy8g6K6+572u5o6S5bqPCgoKICAgICAgaWYgKCF0aGlzLmlzTm9Tb3J0ICYmICFPYmplY3QuaXModGhpcy5taW5vclNvcnREaXIsICcnKSAmJiAhT2JqZWN0LmlzKHRoaXMubWlub3JTb3J0UFNERUYsICcnKSkgewogICAgICAgIHZhciBzb3J0ID0gdGhpcy5taW5vclNvcnRQU0RFRiArICIsIiArIHRoaXMubWlub3JTb3J0RGlyOwogICAgICAgIE9iamVjdC5hc3NpZ24ocGFnZSwgewogICAgICAgICAgc29ydDogc29ydAogICAgICAgIH0pOwogICAgICB9CgogICAgICB2YXIgYXJnID0ge307CiAgICAgIE9iamVjdC5hc3NpZ24oYXJnLCBwYWdlKTsgLy8g6I635Y+WcXVlcnks5pCc57Si6KGo5Y2V77yMdmlld3BhcmFtc+etieeItuaVsOaNrgoKICAgICAgdmFyIHBhcmVudGRhdGEgPSB7fTsKICAgICAgdGhpcy4kZW1pdCgnYmVmb3JlbG9hZCcsIHBhcmVudGRhdGEpOwogICAgICBPYmplY3QuYXNzaWduKGFyZywgcGFyZW50ZGF0YSk7CiAgICAgIHZhciBwb3N0ID0gdGhpcy5zZXJ2aWNlLnNlYXJjaCh0aGlzLmZldGNoQWN0aW9uLCBKU09OLnBhcnNlKEpTT04uc3RyaW5naWZ5KHRoaXMuY29udGV4dCkpLCBhcmcsIHRoaXMuc2hvd0J1c3lJbmRpY2F0b3IpOwogICAgICBwb3N0LnRoZW4oZnVuY3Rpb24gKHJlc3BvbnNlKSB7CiAgICAgICAgaWYgKCFyZXNwb25zZSB8fCByZXNwb25zZS5zdGF0dXMgIT09IDIwMCkgewogICAgICAgICAgX3RoaXM4LiROb3RpY2UuZXJyb3IoewogICAgICAgICAgICB0aXRsZTogJycsCiAgICAgICAgICAgIGRlc2M6ICfmlbDmja7lr7zlh7rlpLHotKUsJyArIHJlc3BvbnNlLmluZm8KICAgICAgICAgIH0pOwoKICAgICAgICAgIHJldHVybjsKICAgICAgICB9CgogICAgICAgIHRyeSB7CiAgICAgICAgICBkb0V4cG9ydChKU09OLnBhcnNlKEpTT04uc3RyaW5naWZ5KHJlc3BvbnNlLmRhdGEpKSk7CiAgICAgICAgfSBjYXRjaCAoZXJyb3IpIHsKICAgICAgICAgIGNvbnNvbGUuZXJyb3IoZXJyb3IpOwogICAgICAgIH0KICAgICAgfSlbImNhdGNoIl0oZnVuY3Rpb24gKHJlc3BvbnNlKSB7CiAgICAgICAgaWYgKHJlc3BvbnNlICYmIHJlc3BvbnNlLnN0YXR1cyA9PT0gNDAxKSB7CiAgICAgICAgICByZXR1cm47CiAgICAgICAgfQoKICAgICAgICBfdGhpczguJE5vdGljZS5lcnJvcih7CiAgICAgICAgICB0aXRsZTogJycsCiAgICAgICAgICBkZXNjOiAn5pWw5o2u5a+85Ye65aSx6LSlJwogICAgICAgIH0pOwogICAgICB9KTsKICAgIH0KICAgIC8qKg0KICAgICAqIOWvvOWHuuaVsOaNruagvOW8j+WMlg0KICAgICAqDQogICAgICogQHBhcmFtIHsqfSBmaWx0ZXJWYWwNCiAgICAgKiBAcGFyYW0geyp9IGpzb25EYXRhDQogICAgICogQHJldHVybnMge1tdfQ0KICAgICAqIEBtZW1iZXJvZiBITURJbmZvR3JpZEJhc2UNCiAgICAgKi8KCiAgfSwgewogICAga2V5OiAiZm9ybWF0RXhjZWxEYXRhIiwKICAgIHZhbHVlOiBmdW5jdGlvbiAoKSB7CiAgICAgIHZhciBfZm9ybWF0RXhjZWxEYXRhID0gX2FzeW5jVG9HZW5lcmF0b3IoCiAgICAgIC8qI19fUFVSRV9fKi8KICAgICAgcmVnZW5lcmF0b3JSdW50aW1lLm1hcmsoZnVuY3Rpb24gX2NhbGxlZTQoZmlsdGVyVmFsLCBqc29uRGF0YSkgewogICAgICAgIHZhciBjb2RlbGlzdENvbHVtbnMsIF90aGlzLCBfbG9vcCwgX2kyLCBfY29kZWxpc3RDb2x1bW5zOwoKICAgICAgICByZXR1cm4gcmVnZW5lcmF0b3JSdW50aW1lLndyYXAoZnVuY3Rpb24gX2NhbGxlZTQkKF9jb250ZXh0NSkgewogICAgICAgICAgd2hpbGUgKDEpIHsKICAgICAgICAgICAgc3dpdGNoIChfY29udGV4dDUucHJldiA9IF9jb250ZXh0NS5uZXh0KSB7CiAgICAgICAgICAgICAgY2FzZSAwOgogICAgICAgICAgICAgICAgY29kZWxpc3RDb2x1bW5zID0gW3sKICAgICAgICAgICAgICAgICAgbmFtZTogJ3lnenQnLAogICAgICAgICAgICAgICAgICBzcmZrZXk6ICdFaHJDb2RlTGlzdDAwMTQnLAogICAgICAgICAgICAgICAgICBjb2RlbGlzdFR5cGU6ICdEWU5BTUlDJywKICAgICAgICAgICAgICAgICAgcmVuZGVyTW9kZTogJ290aGVyJywKICAgICAgICAgICAgICAgICAgdGV4dFNlcGFyYXRvcjogJ+OAgScsCiAgICAgICAgICAgICAgICAgIHZhbHVlU2VwYXJhdG9yOiAnLCcKICAgICAgICAgICAgICAgIH0sIHsKICAgICAgICAgICAgICAgICAgbmFtZTogJ2htZCcsCiAgICAgICAgICAgICAgICAgIHNyZmtleTogJ0VockNvZGVMaXN0MDQwMScsCiAgICAgICAgICAgICAgICAgIGNvZGVsaXN0VHlwZTogJ1NUQVRJQycsCiAgICAgICAgICAgICAgICAgIHRleHRTZXBhcmF0b3I6ICfjgIEnLAogICAgICAgICAgICAgICAgICByZW5kZXJNb2RlOiAnc3RyaW5nJywKICAgICAgICAgICAgICAgICAgdmFsdWVTZXBhcmF0b3I6ICI7IgogICAgICAgICAgICAgICAgfV07CiAgICAgICAgICAgICAgICBfdGhpcyA9IHRoaXM7CiAgICAgICAgICAgICAgICBfbG9vcCA9CiAgICAgICAgICAgICAgICAvKiNfX1BVUkVfXyovCiAgICAgICAgICAgICAgICByZWdlbmVyYXRvclJ1bnRpbWUubWFyayhmdW5jdGlvbiBfbG9vcCgpIHsKICAgICAgICAgICAgICAgICAgdmFyIGNvZGVsaXN0LCBpdGVtcywgX2l0ZW1zOwoKICAgICAgICAgICAgICAgICAgcmV0dXJuIHJlZ2VuZXJhdG9yUnVudGltZS53cmFwKGZ1bmN0aW9uIF9sb29wJChfY29udGV4dDQpIHsKICAgICAgICAgICAgICAgICAgICB3aGlsZSAoMSkgewogICAgICAgICAgICAgICAgICAgICAgc3dpdGNoIChfY29udGV4dDQucHJldiA9IF9jb250ZXh0NC5uZXh0KSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgMDoKICAgICAgICAgICAgICAgICAgICAgICAgICBjb2RlbGlzdCA9IF9jb2RlbGlzdENvbHVtbnNbX2kyXTsKCiAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCFPYmplY3QuaXMoY29kZWxpc3QuY29kZWxpc3RUeXBlLCAiRFlOQU1JQyIpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBfY29udGV4dDQubmV4dCA9IDg7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgICAgICAgIF9jb250ZXh0NC5uZXh0ID0gNDsKICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gX3RoaXMuY29kZUxpc3RTZXJ2aWNlLmdldEl0ZW1zKGNvZGVsaXN0LnNyZmtleSk7CgogICAgICAgICAgICAgICAgICAgICAgICBjYXNlIDQ6CiAgICAgICAgICAgICAgICAgICAgICAgICAgaXRlbXMgPSBfY29udGV4dDQuc2VudDsKICAgICAgICAgICAgICAgICAgICAgICAgICBqc29uRGF0YS5mb3JFYWNoKGZ1bmN0aW9uIChyb3cpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJvd1tjb2RlbGlzdC5uYW1lXSA9IF90aGlzLmdldENvZGVsaXN0VmFsdWUoaXRlbXMsIHJvd1tjb2RlbGlzdC5uYW1lXSwgY29kZWxpc3QpOwogICAgICAgICAgICAgICAgICAgICAgICAgIH0pOyAvLyDpnZnmgIHlpITnkIYKCiAgICAgICAgICAgICAgICAgICAgICAgICAgX2NvbnRleHQ0Lm5leHQgPSAxMzsKICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKCiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgODoKICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoIU9iamVjdC5pcyhjb2RlbGlzdC5jb2RlbGlzdFR5cGUsICJTVEFUSUMiKSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgX2NvbnRleHQ0Lm5leHQgPSAxMzsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgICAgICAgX2NvbnRleHQ0Lm5leHQgPSAxMTsKICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gX3RoaXMuJHN0b3JlLmdldHRlcnMuZ2V0Q29kZUxpc3RJdGVtcyhjb2RlbGlzdC5zcmZrZXkpOwoKICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAxMToKICAgICAgICAgICAgICAgICAgICAgICAgICBfaXRlbXMgPSBfY29udGV4dDQuc2VudDsKICAgICAgICAgICAgICAgICAgICAgICAgICBqc29uRGF0YS5mb3JFYWNoKGZ1bmN0aW9uIChyb3cpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJvd1tjb2RlbGlzdC5uYW1lXSA9IF90aGlzLmdldENvZGVsaXN0VmFsdWUoX2l0ZW1zLCByb3dbY29kZWxpc3QubmFtZV0sIGNvZGVsaXN0KTsKICAgICAgICAgICAgICAgICAgICAgICAgICB9KTsKCiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgMTM6CiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgImVuZCI6CiAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0NC5zdG9wKCk7CiAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICB9LCBfbG9vcCk7CiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIF9pMiA9IDAsIF9jb2RlbGlzdENvbHVtbnMgPSBjb2RlbGlzdENvbHVtbnM7CgogICAgICAgICAgICAgIGNhc2UgNDoKICAgICAgICAgICAgICAgIGlmICghKF9pMiA8IF9jb2RlbGlzdENvbHVtbnMubGVuZ3RoKSkgewogICAgICAgICAgICAgICAgICBfY29udGV4dDUubmV4dCA9IDk7CiAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDUuZGVsZWdhdGVZaWVsZChfbG9vcCgpLCAidDAiLCA2KTsKCiAgICAgICAgICAgICAgY2FzZSA2OgogICAgICAgICAgICAgICAgX2kyKys7CiAgICAgICAgICAgICAgICBfY29udGV4dDUubmV4dCA9IDQ7CiAgICAgICAgICAgICAgICBicmVhazsKCiAgICAgICAgICAgICAgY2FzZSA5OgogICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0NS5hYnJ1cHQoInJldHVybiIsIGpzb25EYXRhLm1hcChmdW5jdGlvbiAodikgewogICAgICAgICAgICAgICAgICByZXR1cm4gZmlsdGVyVmFsLm1hcChmdW5jdGlvbiAoaikgewogICAgICAgICAgICAgICAgICAgIHJldHVybiB2W2pdOwogICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIH0pKTsKCiAgICAgICAgICAgICAgY2FzZSAxMDoKICAgICAgICAgICAgICBjYXNlICJlbmQiOgogICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0NS5zdG9wKCk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9LCBfY2FsbGVlNCwgdGhpcyk7CiAgICAgIH0pKTsKCiAgICAgIGZ1bmN0aW9uIGZvcm1hdEV4Y2VsRGF0YShfeDMsIF94NCkgewogICAgICAgIHJldHVybiBfZm9ybWF0RXhjZWxEYXRhLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7CiAgICAgIH0KCiAgICAgIHJldHVybiBmb3JtYXRFeGNlbERhdGE7CiAgICB9KCkKICAgIC8qKg0KICAgICAqIOino+aekOS7o+eggeihqOWSjHZsYXVl77yM6K6+572uaXRlbXMNCiAgICAgKg0KICAgICAqIEBwdWJsaWMNCiAgICAgKiBAcGFyYW0ge2FueVtdfSBpdGVtcyDku6PnoIHooajmlbDmja4NCiAgICAgKiBAcGFyYW0geyp9IHZhbHVlDQogICAgICogQHJldHVybnMgeyp9DQogICAgICogQG1lbWJlcm9mIEhNREluZm9HcmlkQmFzZQ0KICAgICAqLwoKICB9LCB7CiAgICBrZXk6ICJnZXRDb2RlbGlzdFZhbHVlIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBnZXRDb2RlbGlzdFZhbHVlKGl0ZW1zLCB2YWx1ZSwgY29kZWxpc3QpIHsKICAgICAgdmFyIF90aGlzOSA9IHRoaXM7CgogICAgICBpZiAoIXZhbHVlKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuJHQoJ2NvZGVsaXN0LicgKyBjb2RlbGlzdC5zcmZrZXkgKyAnLmVtcHR5Jyk7CiAgICAgIH0KCiAgICAgIGlmIChpdGVtcykgewogICAgICAgIHZhciByZXN1bHQgPSBbXTsKCiAgICAgICAgaWYgKE9iamVjdC5pcyhjb2RlbGlzdC5yZW5kZXJNb2RlLCAibnVtYmVyIikpIHsKICAgICAgICAgIGl0ZW1zLm1hcChmdW5jdGlvbiAoX2l0ZW0sIGluZGV4KSB7CiAgICAgICAgICAgIHZhciBuVmFsdWUgPSBwYXJzZUludCh2YWx1ZSwgMTApOwogICAgICAgICAgICB2YXIgY29kZXZhbHVlID0gX2l0ZW0udmFsdWU7CgogICAgICAgICAgICBpZiAoKHBhcnNlSW50KGNvZGV2YWx1ZSwgMTApICYgblZhbHVlKSA+IDApIHsKICAgICAgICAgICAgICByZXN1bHQucHVzaChfaXRlbSk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0pOwogICAgICAgIH0gZWxzZSBpZiAoT2JqZWN0LmlzKGNvZGVsaXN0LnJlbmRlck1vZGUsICJzdHJpbmciKSkgewogICAgICAgICAgdmFyIGFycmF5VmFsdWUgPSB2YWx1ZS5zcGxpdChjb2RlbGlzdC52YWx1ZVNlcGFyYXRvcik7CiAgICAgICAgICBhcnJheVZhbHVlLm1hcChmdW5jdGlvbiAodmFsdWUsIGluZGV4KSB7CiAgICAgICAgICAgIHJlc3VsdC5wdXNoKFtdKTsKICAgICAgICAgICAgdmFyIHZhbHVlcyA9IE9iamVjdC5pcyhfdGhpczkuJHV0aWwudHlwZU9mKHZhbHVlKSwgJ251bWJlcicpID8gW3ZhbHVlXSA6IF90b0NvbnN1bWFibGVBcnJheSh2YWx1ZS5zcGxpdChjb2RlbGlzdC52YWx1ZVNlcGFyYXRvcikpOwogICAgICAgICAgICB2YWx1ZXMubWFwKGZ1bmN0aW9uICh2YWwsIG51bSkgewogICAgICAgICAgICAgIHZhciBpdGVtID0gX3RoaXM5LmdldEl0ZW0oaXRlbXMsIHZhbCwgY29kZWxpc3QpOwoKICAgICAgICAgICAgICBpZiAoaXRlbSkgewogICAgICAgICAgICAgICAgcmVzdWx0W2luZGV4XS5wdXNoKGl0ZW0pOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSk7CiAgICAgICAgICB9KTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgdmFyIHZhbHVlcyA9IE9iamVjdC5pcyh0aGlzLiR1dGlsLnR5cGVPZih2YWx1ZSksICdudW1iZXInKSA/IFt2YWx1ZV0gOiBfdG9Db25zdW1hYmxlQXJyYXkodmFsdWUuc3BsaXQoY29kZWxpc3QudmFsdWVTZXBhcmF0b3IpKTsKICAgICAgICAgIHZhbHVlcy5tYXAoZnVuY3Rpb24gKHZhbHVlLCBpbmRleCkgewogICAgICAgICAgICB2YXIgaXRlbSA9IF90aGlzOS5nZXRJdGVtKGl0ZW1zLCB2YWx1ZSwgY29kZWxpc3QpOwoKICAgICAgICAgICAgaWYgKGl0ZW0pIHsKICAgICAgICAgICAgICByZXN1bHQucHVzaChpdGVtKTsKICAgICAgICAgICAgfQogICAgICAgICAgfSk7CiAgICAgICAgfSAvLyDorr7nva5pdGVtcwoKCiAgICAgICAgaWYgKHJlc3VsdC5sZW5ndGggIT0gMCkgewogICAgICAgICAgcmV0dXJuIHJlc3VsdC5qb2luKGNvZGVsaXN0LnZhbHVlU2VwYXJhdG9yKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgcmV0dXJuIHZhbHVlOwogICAgICAgIH0KICAgICAgfQogICAgfQogICAgLyoqDQogICAgICog6I635Y+W5Luj56CB6aG5DQogICAgICoNCiAgICAgKiBAcHVibGljDQogICAgICogQHBhcmFtIHthbnlbXX0gaXRlbXMNCiAgICAgKiBAcGFyYW0geyp9IHZhbHVlDQogICAgICogQHJldHVybnMgeyp9DQogICAgICogQG1lbWJlcm9mIEhNREluZm9HcmlkQmFzZQ0KICAgICAqLwoKICB9LCB7CiAgICBrZXk6ICJnZXRJdGVtIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBnZXRJdGVtKGl0ZW1zLCB2YWx1ZSwgY29kZWxpc3QpIHsKICAgICAgdmFyIGFyciA9IGl0ZW1zLmZpbHRlcihmdW5jdGlvbiAoaXRlbSkgewogICAgICAgIHJldHVybiBpdGVtLnZhbHVlID09IHZhbHVlOwogICAgICB9KTsKCiAgICAgIGlmIChhcnIubGVuZ3RoICE9PSAxKSB7CiAgICAgICAgcmV0dXJuIHVuZGVmaW5lZDsKICAgICAgfQoKICAgICAgaWYgKE9iamVjdC5pcyhjb2RlbGlzdC5jb2RlbGlzdFR5cGUsICdTVEFUSUMnKSkgewogICAgICAgIHJldHVybiB0aGlzLiR0KCdjb2RlbGlzdC4nICsgY29kZWxpc3Quc3Jma2V5ICsgJy4nICsgYXJyWzBdLnZhbHVlKTsKICAgICAgfSBlbHNlIHsKICAgICAgICByZXR1cm4gYXJyWzBdLnRleHQ7CiAgICAgIH0KICAgIH0KICAgIC8qKg0KICAgICAqIOeUn+WRveWRqOacnw0KICAgICAqDQogICAgICogQG1lbWJlcm9mIEhNREluZm9HcmlkQmFzZQ0KICAgICAqLwoKICB9LCB7CiAgICBrZXk6ICJjcmVhdGVkIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBjcmVhdGVkKCkgewogICAgICB0aGlzLmFmdGVyQ3JlYXRlZCgpOwogICAgfQogICAgLyoqDQogICAgICog5omn6KGMY3JlYXRlZOWQjueahOmAu+i+kQ0KICAgICAqDQogICAgICogIEBtZW1iZXJvZiBITURJbmZvR3JpZEJhc2UNCiAgICAgKi8KCiAgfSwgewogICAga2V5OiAiYWZ0ZXJDcmVhdGVkIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBhZnRlckNyZWF0ZWQoKSB7CiAgICAgIHZhciBfdGhpczEwID0gdGhpczsKCiAgICAgIHRoaXMuc2V0Q29sU3RhdGUoKTsKCiAgICAgIGlmICh0aGlzLnZpZXdTdGF0ZSkgewogICAgICAgIHRoaXMudmlld1N0YXRlRXZlbnQgPSB0aGlzLnZpZXdTdGF0ZS5zdWJzY3JpYmUoZnVuY3Rpb24gKF9yZWYzKSB7CiAgICAgICAgICB2YXIgdGFnID0gX3JlZjMudGFnLAogICAgICAgICAgICAgIGFjdGlvbiA9IF9yZWYzLmFjdGlvbiwKICAgICAgICAgICAgICBkYXRhID0gX3JlZjMuZGF0YTsKCiAgICAgICAgICBpZiAoIU9iamVjdC5pcyh0YWcsIF90aGlzMTAubmFtZSkpIHsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgfQoKICAgICAgICAgIGlmIChPYmplY3QuaXMoJ2xvYWQnLCBhY3Rpb24pKSB7CiAgICAgICAgICAgIF90aGlzMTAubG9hZChkYXRhKTsKICAgICAgICAgIH0KCiAgICAgICAgICBpZiAoT2JqZWN0LmlzKCdyZW1vdmUnLCBhY3Rpb24pKSB7CiAgICAgICAgICAgIF90aGlzMTAucmVtb3ZlKGRhdGEpOwogICAgICAgICAgfQoKICAgICAgICAgIGlmIChPYmplY3QuaXMoJ3NhdmUnLCBhY3Rpb24pKSB7CiAgICAgICAgICAgIF90aGlzMTAuc2F2ZShkYXRhKTsKICAgICAgICAgIH0KICAgICAgICB9KTsKICAgICAgfQogICAgfQogICAgLyoqDQogICAgICogdnVlIOeUn+WRveWRqOacnw0KICAgICAqDQogICAgICogQG1lbWJlcm9mIEhNREluZm9HcmlkQmFzZQ0KICAgICAqLwoKICB9LCB7CiAgICBrZXk6ICJkZXN0cm95ZWQiLAogICAgdmFsdWU6IGZ1bmN0aW9uIGRlc3Ryb3llZCgpIHsKICAgICAgdGhpcy5hZnRlckRlc3Ryb3koKTsKICAgIH0KICAgIC8qKg0KICAgICAqIOaJp+ihjGRlc3Ryb3llZOWQjueahOmAu+i+kQ0KICAgICAqDQogICAgICogQG1lbWJlcm9mIEhNREluZm9HcmlkQmFzZQ0KICAgICAqLwoKICB9LCB7CiAgICBrZXk6ICJhZnRlckRlc3Ryb3kiLAogICAgdmFsdWU6IGZ1bmN0aW9uIGFmdGVyRGVzdHJveSgpIHsKICAgICAgaWYgKHRoaXMudmlld1N0YXRlRXZlbnQpIHsKICAgICAgICB0aGlzLnZpZXdTdGF0ZUV2ZW50LnVuc3Vic2NyaWJlKCk7CiAgICAgIH0KICAgIH0KICAgIC8qKg0KICAgICAqIOiOt+WPlumAieS4reihjOiDoeaVsOaNrg0KICAgICAqDQogICAgICogQHJldHVybnMge2FueVtdfQ0KICAgICAqIEBtZW1iZXJvZiBITURJbmZvR3JpZEJhc2UNCiAgICAgKi8KCiAgfSwgewogICAga2V5OiAiZ2V0U2VsZWN0aW9uIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBnZXRTZWxlY3Rpb24oKSB7CiAgICAgIHJldHVybiB0aGlzLnNlbGVjdGlvbnM7CiAgICB9CiAgICAvKioNCiAgICAgKiDooYzlj4zlh7vkuovku7YNCiAgICAgKg0KICAgICAqIEBwYXJhbSB7Kn0gJGV2ZW50DQogICAgICogQHJldHVybnMge3ZvaWR9DQogICAgICogQG1lbWJlcm9mIEhNREluZm9HcmlkQmFzZQ0KICAgICAqLwoKICB9LCB7CiAgICBrZXk6ICJyb3dEQkxDbGljayIsCiAgICB2YWx1ZTogZnVuY3Rpb24gcm93REJMQ2xpY2soJGV2ZW50KSB7CiAgICAgIGlmICghJGV2ZW50IHx8IHRoaXMuYWN0dWFsSXNPcGVuRWRpdCB8fCBPYmplY3QuaXModGhpcy5ncmlkUm93QWN0aXZlTW9kZSwgMCkpIHsKICAgICAgICByZXR1cm47CiAgICAgIH0KCiAgICAgIHRoaXMuc2VsZWN0aW9ucyA9IFtdOwogICAgICB0aGlzLnNlbGVjdGlvbnMucHVzaChKU09OLnBhcnNlKEpTT04uc3RyaW5naWZ5KCRldmVudCkpKTsKICAgICAgdmFyIHJlZnMgPSB0aGlzLiRyZWZzOwoKICAgICAgaWYgKHJlZnMubXVsdGlwbGVUYWJsZSkgewogICAgICAgIHJlZnMubXVsdGlwbGVUYWJsZS5jbGVhclNlbGVjdGlvbigpOwogICAgICAgIHJlZnMubXVsdGlwbGVUYWJsZS50b2dnbGVSb3dTZWxlY3Rpb24oJGV2ZW50KTsKICAgICAgfQoKICAgICAgdGhpcy4kZW1pdCgncm93ZGJsY2xpY2snLCB0aGlzLnNlbGVjdGlvbnMpOwogICAgICB0aGlzLiRlbWl0KCdzZWxlY3Rpb25jaGFuZ2UnLCB0aGlzLnNlbGVjdGlvbnMpOwogICAgfQogICAgLyoqDQogICAgICog5aSN6YCJ5qGG5pWw5o2u6YCJ5LitDQogICAgICoNCiAgICAgKiBAcGFyYW0geyp9ICRldmVudA0KICAgICAqIEByZXR1cm5zIHt2b2lkfQ0KICAgICAqIEBtZW1iZXJvZiBITURJbmZvR3JpZEJhc2UNCiAgICAgKi8KCiAgfSwgewogICAga2V5OiAic2VsZWN0IiwKICAgIHZhbHVlOiBmdW5jdGlvbiBzZWxlY3QoJGV2ZW50KSB7CiAgICAgIGlmICghJGV2ZW50KSB7CiAgICAgICAgcmV0dXJuOwogICAgICB9CgogICAgICB0aGlzLnNlbGVjdGlvbnMgPSBbXTsKICAgICAgdGhpcy5zZWxlY3Rpb25zID0gX3RvQ29uc3VtYWJsZUFycmF5KEpTT04ucGFyc2UoSlNPTi5zdHJpbmdpZnkoJGV2ZW50KSkpOwogICAgICB0aGlzLiRlbWl0KCdzZWxlY3Rpb25jaGFuZ2UnLCB0aGlzLnNlbGVjdGlvbnMpOwogICAgfQogICAgLyoqDQogICAgICog5aSN6YCJ5qGG5pWw5o2u5YWo6YOo6YCJ5LitDQogICAgICoNCiAgICAgKiBAcGFyYW0geyp9ICRldmVudA0KICAgICAqIEBtZW1iZXJvZiBITURJbmZvR3JpZEJhc2UNCiAgICAgKi8KCiAgfSwgewogICAga2V5OiAic2VsZWN0QWxsIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBzZWxlY3RBbGwoJGV2ZW50KSB7CiAgICAgIGlmICghJGV2ZW50KSB7CiAgICAgICAgcmV0dXJuOwogICAgICB9CgogICAgICB0aGlzLnNlbGVjdGlvbnMgPSBbXTsKICAgICAgdGhpcy5zZWxlY3Rpb25zID0gX3RvQ29uc3VtYWJsZUFycmF5KEpTT04ucGFyc2UoSlNPTi5zdHJpbmdpZnkoJGV2ZW50KSkpOwogICAgICB0aGlzLiRlbWl0KCdzZWxlY3Rpb25jaGFuZ2UnLCB0aGlzLnNlbGVjdGlvbnMpOwogICAgfQogICAgLyoqDQogICAgICog6KGM5Y2V5Ye76YCJ5LitDQogICAgICoNCiAgICAgKiBAcGFyYW0geyp9ICRldmVudA0KICAgICAqIEByZXR1cm5zIHt2b2lkfQ0KICAgICAqIEBtZW1iZXJvZiBITURJbmZvR3JpZEJhc2UNCiAgICAgKi8KCiAgfSwgewogICAga2V5OiAicm93Q2xpY2siLAogICAgdmFsdWU6IGZ1bmN0aW9uIHJvd0NsaWNrKCRldmVudCkgewogICAgICB2YXIgaWZBbHdheXMgPSBhcmd1bWVudHMubGVuZ3RoID4gMSAmJiBhcmd1bWVudHNbMV0gIT09IHVuZGVmaW5lZCA/IGFyZ3VtZW50c1sxXSA6IGZhbHNlOwoKICAgICAgaWYgKCFpZkFsd2F5cyAmJiAoISRldmVudCB8fCB0aGlzLmFjdHVhbElzT3BlbkVkaXQpKSB7CiAgICAgICAgcmV0dXJuOwogICAgICB9CgogICAgICBpZiAodGhpcy5zdG9wUm93Q2xpY2spIHsKICAgICAgICB0aGlzLnN0b3BSb3dDbGljayA9IGZhbHNlOwogICAgICAgIHJldHVybjsKICAgICAgfQoKICAgICAgaWYgKHRoaXMuaXNTaW5nbGVTZWxlY3QpIHsKICAgICAgICB0aGlzLnNlbGVjdGlvbnMgPSBbXTsKICAgICAgfSAvLyDlt7LpgInkuK3liJnliKDpmaTvvIzmsqHpgInkuK3liJnmt7vliqAKCgogICAgICB2YXIgc2VsZWN0SW5kZXggPSB0aGlzLnNlbGVjdGlvbnMuZmluZEluZGV4KGZ1bmN0aW9uIChpdGVtKSB7CiAgICAgICAgcmV0dXJuIE9iamVjdC5pcyhpdGVtLnBpbXBlcnNvbiwgJGV2ZW50LnBpbXBlcnNvbik7CiAgICAgIH0pOwoKICAgICAgaWYgKE9iamVjdC5pcyhzZWxlY3RJbmRleCwgLTEpKSB7CiAgICAgICAgdGhpcy5zZWxlY3Rpb25zLnB1c2goSlNPTi5wYXJzZShKU09OLnN0cmluZ2lmeSgkZXZlbnQpKSk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgdGhpcy5zZWxlY3Rpb25zLnNwbGljZShzZWxlY3RJbmRleCwgMSk7CiAgICAgIH0KCiAgICAgIHZhciByZWZzID0gdGhpcy4kcmVmczsKCiAgICAgIGlmIChyZWZzLm11bHRpcGxlVGFibGUpIHsKICAgICAgICBpZiAodGhpcy5pc1NpbmdsZVNlbGVjdCkgewogICAgICAgICAgcmVmcy5tdWx0aXBsZVRhYmxlLmNsZWFyU2VsZWN0aW9uKCk7CiAgICAgICAgICByZWZzLm11bHRpcGxlVGFibGUuc2V0Q3VycmVudFJvdygkZXZlbnQpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICByZWZzLm11bHRpcGxlVGFibGUudG9nZ2xlUm93U2VsZWN0aW9uKCRldmVudCk7CiAgICAgICAgfQogICAgICB9CgogICAgICB0aGlzLiRlbWl0KCdzZWxlY3Rpb25jaGFuZ2UnLCB0aGlzLnNlbGVjdGlvbnMpOwogICAgfQogICAgLyoqDQogICAgICog6aG16Z2i5Y+Y5YyWDQogICAgICoNCiAgICAgKiBAcGFyYW0geyp9ICRldmVudA0KICAgICAqIEByZXR1cm5zIHt2b2lkfQ0KICAgICAqIEBtZW1iZXJvZiBITURJbmZvR3JpZEJhc2UNCiAgICAgKi8KCiAgfSwgewogICAga2V5OiAicGFnZU9uQ2hhbmdlIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBwYWdlT25DaGFuZ2UoJGV2ZW50KSB7CiAgICAgIGlmICghJGV2ZW50KSB7CiAgICAgICAgcmV0dXJuOwogICAgICB9CgogICAgICBpZiAoJGV2ZW50ID09PSB0aGlzLmN1clBhZ2UpIHsKICAgICAgICByZXR1cm47CiAgICAgIH0KCiAgICAgIHRoaXMuY3VyUGFnZSA9ICRldmVudDsKICAgICAgdGhpcy5sb2FkKHt9KTsKICAgIH0KICAgIC8qKg0KICAgICAqIOWIhumhteadoeaVsOWPmOWMlg0KICAgICAqDQogICAgICogQHBhcmFtIHsqfSAkZXZlbnQNCiAgICAgKiBAcmV0dXJucyB7dm9pZH0NCiAgICAgKiBAbWVtYmVyb2YgSE1ESW5mb0dyaWRCYXNlDQogICAgICovCgogIH0sIHsKICAgIGtleTogIm9uUGFnZVNpemVDaGFuZ2UiLAogICAgdmFsdWU6IGZ1bmN0aW9uIG9uUGFnZVNpemVDaGFuZ2UoJGV2ZW50KSB7CiAgICAgIGlmICghJGV2ZW50KSB7CiAgICAgICAgcmV0dXJuOwogICAgICB9CgogICAgICBpZiAoJGV2ZW50ID09PSB0aGlzLmxpbWl0KSB7CiAgICAgICAgcmV0dXJuOwogICAgICB9CgogICAgICB0aGlzLmxpbWl0ID0gJGV2ZW50OwoKICAgICAgaWYgKHRoaXMuY3VyUGFnZSA9PT0gMSkgewogICAgICAgIHRoaXMubG9hZCh7fSk7CiAgICAgIH0KICAgIH0KICAgIC8qKg0KICAgICAqIOWIhumhteWIt+aWsA0KICAgICAqDQogICAgICogQG1lbWJlcm9mIEhNREluZm9HcmlkQmFzZQ0KICAgICAqLwoKICB9LCB7CiAgICBrZXk6ICJwYWdlUmVmcmVzaCIsCiAgICB2YWx1ZTogZnVuY3Rpb24gcGFnZVJlZnJlc2goKSB7CiAgICAgIHRoaXMubG9hZCh7fSk7CiAgICB9CiAgICAvKioNCiAgICAgKiDmjpLluo/lj5jljJYNCiAgICAgKg0KICAgICAqIEBwYXJhbSB7eyBjb2x1bW46IGFueSwgcHJvcDogYW55LCBvcmRlcjogYW55IH19IHsgY29sdW1uLCBwcm9wLCBvcmRlciB9DQogICAgICogQG1lbWJlcm9mIEhNREluZm9HcmlkQmFzZQ0KICAgICAqLwoKICB9LCB7CiAgICBrZXk6ICJvblNvcnRDaGFuZ2UiLAogICAgdmFsdWU6IGZ1bmN0aW9uIG9uU29ydENoYW5nZShfcmVmNCkgewogICAgICB2YXIgY29sdW1uID0gX3JlZjQuY29sdW1uLAogICAgICAgICAgcHJvcCA9IF9yZWY0LnByb3AsCiAgICAgICAgICBvcmRlciA9IF9yZWY0Lm9yZGVyOwogICAgICB2YXIgZGlyID0gT2JqZWN0LmlzKG9yZGVyLCAnYXNjZW5kaW5nJykgPyAnYXNjJyA6IE9iamVjdC5pcyhvcmRlciwgJ2Rlc2NlbmRpbmcnKSA/ICdkZXNjJyA6ICcnOwoKICAgICAgaWYgKE9iamVjdC5pcyhkaXIsIHRoaXMubWlub3JTb3J0RGlyKSAmJiBPYmplY3QuaXModGhpcy5taW5vclNvcnRQU0RFRiwgcHJvcCkpIHsKICAgICAgICByZXR1cm47CiAgICAgIH0KCiAgICAgIHRoaXMubWlub3JTb3J0RGlyID0gZGlyOwogICAgICB0aGlzLm1pbm9yU29ydFBTREVGID0gcHJvcCA/IHByb3AgOiAnJzsKICAgICAgdGhpcy5sb2FkKHt9KTsKICAgIH0KICAgIC8qKg0KICAgICAqIOihqOagvOihjOmAieS4reagt+W8jw0KICAgICAqDQogICAgICogQHBhcmFtIHt7IHJvdzogYW55LCByb3dJbmRleDogYW55IH19IHsgcm93LCByb3dJbmRleCB9DQogICAgICogQHJldHVybnMge3N0cmluZ30NCiAgICAgKiBAbWVtYmVyb2YgSE1ESW5mb0dyaWRCYXNlDQogICAgICovCgogIH0sIHsKICAgIGtleTogIm9uUm93Q2xhc3NOYW1lIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBvblJvd0NsYXNzTmFtZShfcmVmNSkgewogICAgICB2YXIgcm93ID0gX3JlZjUucm93LAogICAgICAgICAgcm93SW5kZXggPSBfcmVmNS5yb3dJbmRleDsKICAgICAgdmFyIGluZGV4ID0gdGhpcy5zZWxlY3Rpb25zLmZpbmRJbmRleChmdW5jdGlvbiAoc2VsZWN0KSB7CiAgICAgICAgcmV0dXJuIE9iamVjdC5pcyhzZWxlY3Quc3Jma2V5LCByb3cuc3Jma2V5KTsKICAgICAgfSk7CiAgICAgIHJldHVybiBpbmRleCAhPT0gLTEgPyAnZ3JpZC1yb3ctc2VsZWN0JyA6ICcnOwogICAgfQogICAgLyoqDQogICAgICog55WM6Z2i6KGM5Li6DQogICAgICoNCiAgICAgKiBAcGFyYW0geyp9IHJvdw0KICAgICAqIEBwYXJhbSB7Kn0gdGFnDQogICAgICogQHBhcmFtIHsqfSAkZXZlbnQNCiAgICAgKiBAbWVtYmVyb2YgSE1ESW5mb0dyaWRCYXNlDQogICAgICovCgogIH0sIHsKICAgIGtleTogInVpQWN0aW9uIiwKICAgIHZhbHVlOiBmdW5jdGlvbiB1aUFjdGlvbihyb3csIHRhZywgJGV2ZW50KSB7CiAgICAgIC8vIHRoaXMucm93Q2xpY2socm93LCB0cnVlKTsKICAgICAgJGV2ZW50LnN0b3BQcm9wYWdhdGlvbigpOwogICAgfQogICAgLyoqDQogICAgICog6K6+572u5YiX54q25oCBDQogICAgICoNCiAgICAgKiBAbWVtYmVyb2YgSE1ESW5mb0dyaWRCYXNlDQogICAgICovCgogIH0sIHsKICAgIGtleTogInNldENvbFN0YXRlIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBzZXRDb2xTdGF0ZSgpIHsKICAgICAgdmFyIF90aGlzMTEgPSB0aGlzOwoKICAgICAgdmFyIF9kYXRhID0gbG9jYWxTdG9yYWdlLmdldEl0ZW0oJ3BpbXBlcnNvbl9obWRpbmZvZ3JpZF9ncmlkJyk7CgogICAgICBpZiAoX2RhdGEpIHsKICAgICAgICB2YXIgY29sdW1ucyA9IEpTT04ucGFyc2UoX2RhdGEpOwogICAgICAgIGNvbHVtbnMuZm9yRWFjaChmdW5jdGlvbiAoY29sKSB7CiAgICAgICAgICB2YXIgY29sdW1uID0gX3RoaXMxMS5hbGxDb2x1bW5zLmZpbmQoZnVuY3Rpb24gKGl0ZW0pIHsKICAgICAgICAgICAgcmV0dXJuIE9iamVjdC5pcyhjb2wubmFtZSwgaXRlbS5uYW1lKTsKICAgICAgICAgIH0pOwoKICAgICAgICAgIGlmIChjb2x1bW4pIHsKICAgICAgICAgICAgT2JqZWN0LmFzc2lnbihjb2x1bW4sIGNvbCk7CiAgICAgICAgICB9CiAgICAgICAgfSk7CiAgICAgIH0KICAgIH0KICAgIC8qKg0KICAgICAqIOWIl+WPmOWMlg0KICAgICAqDQogICAgICogQG1lbWJlcm9mIEhNREluZm9HcmlkQmFzZQ0KICAgICAqLwoKICB9LCB7CiAgICBrZXk6ICJvbkNvbENoYW5nZSIsCiAgICB2YWx1ZTogZnVuY3Rpb24gb25Db2xDaGFuZ2UoKSB7CiAgICAgIGxvY2FsU3RvcmFnZS5zZXRJdGVtKCdwaW1wZXJzb25faG1kaW5mb2dyaWRfZ3JpZCcsIEpTT04uc3RyaW5naWZ5KHRoaXMuYWxsQ29sdW1ucykpOwogICAgfQogICAgLyoqDQogICAgICog6I635Y+W5YiX54q25oCBDQogICAgICoNCiAgICAgKiBAcGFyYW0ge3N0cmluZ30gbmFtZQ0KICAgICAqIEByZXR1cm5zIHtib29sZWFufQ0KICAgICAqIEBtZW1iZXJvZiBITURJbmZvR3JpZEJhc2UNCiAgICAgKi8KCiAgfSwgewogICAga2V5OiAiZ2V0Q29sdW1uU3RhdGUiLAogICAgdmFsdWU6IGZ1bmN0aW9uIGdldENvbHVtblN0YXRlKG5hbWUpIHsKICAgICAgdmFyIGNvbHVtbiA9IHRoaXMuYWxsQ29sdW1ucy5maW5kKGZ1bmN0aW9uIChjb2wpIHsKICAgICAgICByZXR1cm4gT2JqZWN0LmlzKG5hbWUsIGNvbC5uYW1lKTsKICAgICAgfSk7CiAgICAgIHJldHVybiBjb2x1bW4uc2hvdyA/IHRydWUgOiBmYWxzZTsKICAgIH0KICAgIC8qKg0KICAgICAqIOihqOagvOWIl+aYr+WQpuiHqumAguW6lOW4g+WxgA0KICAgICAqDQogICAgICogQHJlYWRvbmx5DQogICAgICogQHR5cGUge2Jvb2xlYW59DQogICAgICogQG1lbWJlcm9mIEhNREluZm9HcmlkQmFzZQ0KICAgICAqLwoKICB9LCB7CiAgICBrZXk6ICJzYXZlIiwKCiAgICAvKioNCiAgICAgKiDkv53lrZgNCiAgICAgKg0KICAgICAqIEBwYXJhbSB7Kn0gJGV2ZW50DQogICAgICogQHJldHVybnMge1Byb21pc2U8YW55Pn0NCiAgICAgKiBAbWVtYmVyb2YgSE1ESW5mb0dyaWRCYXNlDQogICAgICovCiAgICB2YWx1ZTogZnVuY3Rpb24gKCkgewogICAgICB2YXIgX3NhdmUgPSBfYXN5bmNUb0dlbmVyYXRvcigKICAgICAgLyojX19QVVJFX18qLwogICAgICByZWdlbmVyYXRvclJ1bnRpbWUubWFyayhmdW5jdGlvbiBfY2FsbGVlNShhcmdzLCBwYXJhbXMsICRldmVudCwgeERhdGEpIHsKICAgICAgICB2YXIgX3RoaXMxMiA9IHRoaXM7CgogICAgICAgIHZhciBfdGhpcywgc3VjY2Vzc0l0ZW1zLCBlcnJvckl0ZW1zLCBlcnJvck1lc3NhZ2UsIF9pdGVyYXRvck5vcm1hbENvbXBsZXRpb24yLCBfZGlkSXRlcmF0b3JFcnJvcjIsIF9pdGVyYXRvckVycm9yMiwgX2l0ZXJhdG9yMiwgX3N0ZXAyLCBpdGVtLCByZXNwb25zZSwgX3Jlc3BvbnNlOwoKICAgICAgICByZXR1cm4gcmVnZW5lcmF0b3JSdW50aW1lLndyYXAoZnVuY3Rpb24gX2NhbGxlZTUkKF9jb250ZXh0NikgewogICAgICAgICAgd2hpbGUgKDEpIHsKICAgICAgICAgICAgc3dpdGNoIChfY29udGV4dDYucHJldiA9IF9jb250ZXh0Ni5uZXh0KSB7CiAgICAgICAgICAgICAgY2FzZSAwOgogICAgICAgICAgICAgICAgX3RoaXMgPSB0aGlzOwogICAgICAgICAgICAgICAgX2NvbnRleHQ2Lm5leHQgPSAzOwogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMudmFsaWRhdGVBbGwoKTsKCiAgICAgICAgICAgICAgY2FzZSAzOgogICAgICAgICAgICAgICAgaWYgKF9jb250ZXh0Ni5zZW50KSB7CiAgICAgICAgICAgICAgICAgIF9jb250ZXh0Ni5uZXh0ID0gNjsKICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgdGhpcy4kTm90aWNlLmVycm9yKHsKICAgICAgICAgICAgICAgICAgdGl0bGU6ICfplJnor68nLAogICAgICAgICAgICAgICAgICBkZXNjOiAn5YC86KeE5YiZ5qCh6aqM5byC5bi4JwogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQ2LmFicnVwdCgicmV0dXJuIiwgW10pOwoKICAgICAgICAgICAgICBjYXNlIDY6CiAgICAgICAgICAgICAgICBzdWNjZXNzSXRlbXMgPSBbXTsKICAgICAgICAgICAgICAgIGVycm9ySXRlbXMgPSBbXTsKICAgICAgICAgICAgICAgIGVycm9yTWVzc2FnZSA9IFtdOwogICAgICAgICAgICAgICAgX2l0ZXJhdG9yTm9ybWFsQ29tcGxldGlvbjIgPSB0cnVlOwogICAgICAgICAgICAgICAgX2RpZEl0ZXJhdG9yRXJyb3IyID0gZmFsc2U7CiAgICAgICAgICAgICAgICBfaXRlcmF0b3JFcnJvcjIgPSB1bmRlZmluZWQ7CiAgICAgICAgICAgICAgICBfY29udGV4dDYucHJldiA9IDEyOwogICAgICAgICAgICAgICAgX2l0ZXJhdG9yMiA9IF90aGlzLml0ZW1zW1N5bWJvbC5pdGVyYXRvcl0oKTsKCiAgICAgICAgICAgICAgY2FzZSAxNDoKICAgICAgICAgICAgICAgIGlmIChfaXRlcmF0b3JOb3JtYWxDb21wbGV0aW9uMiA9IChfc3RlcDIgPSBfaXRlcmF0b3IyLm5leHQoKSkuZG9uZSkgewogICAgICAgICAgICAgICAgICBfY29udGV4dDYubmV4dCA9IDQ5OwogICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBpdGVtID0gX3N0ZXAyLnZhbHVlOwogICAgICAgICAgICAgICAgX2NvbnRleHQ2LnByZXYgPSAxNjsKCiAgICAgICAgICAgICAgICBpZiAoIU9iamVjdC5pcyhpdGVtLnJvd0RhdGFTdGF0ZSwgJ2NyZWF0ZScpKSB7CiAgICAgICAgICAgICAgICAgIF9jb250ZXh0Ni5uZXh0ID0gMjk7CiAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIGlmICh0aGlzLmNyZWF0ZUFjdGlvbikgewogICAgICAgICAgICAgICAgICBfY29udGV4dDYubmV4dCA9IDIyOwogICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICB0aGlzLiROb3RpY2UuZXJyb3IoewogICAgICAgICAgICAgICAgICB0aXRsZTogJ+mUmeivrycsCiAgICAgICAgICAgICAgICAgIGRlc2M6ICdQSU1QRVJTT05ITURHcmlkVmlld+inhuWbvuihqOagvGNyZWF0ZUFjdGlvbuWPguaVsOacqumFjee9ricKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgX2NvbnRleHQ2Lm5leHQgPSAyNzsKICAgICAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgICAgICBjYXNlIDIyOgogICAgICAgICAgICAgICAgT2JqZWN0LmFzc2lnbihpdGVtLCB7CiAgICAgICAgICAgICAgICAgIHZpZXdwYXJhbXM6IHRoaXMudmlld3BhcmFtcwogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICBfY29udGV4dDYubmV4dCA9IDI1OwogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuc2VydmljZS5hZGQodGhpcy5jcmVhdGVBY3Rpb24sIEpTT04ucGFyc2UoSlNPTi5zdHJpbmdpZnkodGhpcy5jb250ZXh0KSksIGl0ZW0sIHRoaXMuc2hvd0J1c3lJbmRpY2F0b3IpOwoKICAgICAgICAgICAgICBjYXNlIDI1OgogICAgICAgICAgICAgICAgcmVzcG9uc2UgPSBfY29udGV4dDYuc2VudDsKICAgICAgICAgICAgICAgIHN1Y2Nlc3NJdGVtcy5wdXNoKEpTT04ucGFyc2UoSlNPTi5zdHJpbmdpZnkocmVzcG9uc2UuZGF0YSkpKTsKCiAgICAgICAgICAgICAgY2FzZSAyNzoKICAgICAgICAgICAgICAgIF9jb250ZXh0Ni5uZXh0ID0gNDA7CiAgICAgICAgICAgICAgICBicmVhazsKCiAgICAgICAgICAgICAgY2FzZSAyOToKICAgICAgICAgICAgICAgIGlmICghT2JqZWN0LmlzKGl0ZW0ucm93RGF0YVN0YXRlLCAndXBkYXRlJykpIHsKICAgICAgICAgICAgICAgICAgX2NvbnRleHQ2Lm5leHQgPSA0MDsKICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgaWYgKHRoaXMudXBkYXRlQWN0aW9uKSB7CiAgICAgICAgICAgICAgICAgIF9jb250ZXh0Ni5uZXh0ID0gMzQ7CiAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIHRoaXMuJE5vdGljZS5lcnJvcih7CiAgICAgICAgICAgICAgICAgIHRpdGxlOiAn6ZSZ6K+vJywKICAgICAgICAgICAgICAgICAgZGVzYzogJ1BJTVBFUlNPTkhNREdyaWRWaWV36KeG5Zu+6KGo5qC8dXBkYXRlQWN0aW9u5Y+C5pWw5pyq6YWN572uJwogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICBfY29udGV4dDYubmV4dCA9IDQwOwogICAgICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgICAgIGNhc2UgMzQ6CiAgICAgICAgICAgICAgICBPYmplY3QuYXNzaWduKGl0ZW0sIHsKICAgICAgICAgICAgICAgICAgdmlld3BhcmFtczogdGhpcy52aWV3cGFyYW1zCiAgICAgICAgICAgICAgICB9KTsKCiAgICAgICAgICAgICAgICBpZiAoaXRlbS5waW1wZXJzb24pIHsKICAgICAgICAgICAgICAgICAgT2JqZWN0LmFzc2lnbih0aGlzLmNvbnRleHQsIHsKICAgICAgICAgICAgICAgICAgICBwaW1wZXJzb246IGl0ZW0ucGltcGVyc29uCiAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIF9jb250ZXh0Ni5uZXh0ID0gMzg7CiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5zZXJ2aWNlLmFkZCh0aGlzLnVwZGF0ZUFjdGlvbiwgSlNPTi5wYXJzZShKU09OLnN0cmluZ2lmeSh0aGlzLmNvbnRleHQpKSwgaXRlbSwgdGhpcy5zaG93QnVzeUluZGljYXRvcik7CgogICAgICAgICAgICAgIGNhc2UgMzg6CiAgICAgICAgICAgICAgICBfcmVzcG9uc2UgPSBfY29udGV4dDYuc2VudDsKICAgICAgICAgICAgICAgIHN1Y2Nlc3NJdGVtcy5wdXNoKEpTT04ucGFyc2UoSlNPTi5zdHJpbmdpZnkoX3Jlc3BvbnNlLmRhdGEpKSk7CgogICAgICAgICAgICAgIGNhc2UgNDA6CiAgICAgICAgICAgICAgICBfY29udGV4dDYubmV4dCA9IDQ2OwogICAgICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgICAgIGNhc2UgNDI6CiAgICAgICAgICAgICAgICBfY29udGV4dDYucHJldiA9IDQyOwogICAgICAgICAgICAgICAgX2NvbnRleHQ2LnQwID0gX2NvbnRleHQ2WyJjYXRjaCJdKDE2KTsKICAgICAgICAgICAgICAgIGVycm9ySXRlbXMucHVzaChKU09OLnBhcnNlKEpTT04uc3RyaW5naWZ5KGl0ZW0pKSk7CiAgICAgICAgICAgICAgICBlcnJvck1lc3NhZ2UucHVzaChfY29udGV4dDYudDApOwoKICAgICAgICAgICAgICBjYXNlIDQ2OgogICAgICAgICAgICAgICAgX2l0ZXJhdG9yTm9ybWFsQ29tcGxldGlvbjIgPSB0cnVlOwogICAgICAgICAgICAgICAgX2NvbnRleHQ2Lm5leHQgPSAxNDsKICAgICAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgICAgICBjYXNlIDQ5OgogICAgICAgICAgICAgICAgX2NvbnRleHQ2Lm5leHQgPSA1NTsKICAgICAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgICAgICBjYXNlIDUxOgogICAgICAgICAgICAgICAgX2NvbnRleHQ2LnByZXYgPSA1MTsKICAgICAgICAgICAgICAgIF9jb250ZXh0Ni50MSA9IF9jb250ZXh0NlsiY2F0Y2giXSgxMik7CiAgICAgICAgICAgICAgICBfZGlkSXRlcmF0b3JFcnJvcjIgPSB0cnVlOwogICAgICAgICAgICAgICAgX2l0ZXJhdG9yRXJyb3IyID0gX2NvbnRleHQ2LnQxOwoKICAgICAgICAgICAgICBjYXNlIDU1OgogICAgICAgICAgICAgICAgX2NvbnRleHQ2LnByZXYgPSA1NTsKICAgICAgICAgICAgICAgIF9jb250ZXh0Ni5wcmV2ID0gNTY7CgogICAgICAgICAgICAgICAgaWYgKCFfaXRlcmF0b3JOb3JtYWxDb21wbGV0aW9uMiAmJiBfaXRlcmF0b3IyWyJyZXR1cm4iXSAhPSBudWxsKSB7CiAgICAgICAgICAgICAgICAgIF9pdGVyYXRvcjJbInJldHVybiJdKCk7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgIGNhc2UgNTg6CiAgICAgICAgICAgICAgICBfY29udGV4dDYucHJldiA9IDU4OwoKICAgICAgICAgICAgICAgIGlmICghX2RpZEl0ZXJhdG9yRXJyb3IyKSB7CiAgICAgICAgICAgICAgICAgIF9jb250ZXh0Ni5uZXh0ID0gNjE7CiAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIHRocm93IF9pdGVyYXRvckVycm9yMjsKCiAgICAgICAgICAgICAgY2FzZSA2MToKICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDYuZmluaXNoKDU4KTsKCiAgICAgICAgICAgICAgY2FzZSA2MjoKICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDYuZmluaXNoKDU1KTsKCiAgICAgICAgICAgICAgY2FzZSA2MzoKICAgICAgICAgICAgICAgIHRoaXMuJGVtaXQoJ3NhdmUnLCBzdWNjZXNzSXRlbXMpOwogICAgICAgICAgICAgICAgdGhpcy5yZWZyZXNoKFtdKTsKCiAgICAgICAgICAgICAgICBpZiAoZXJyb3JJdGVtcy5sZW5ndGggPT09IDApIHsKICAgICAgICAgICAgICAgICAgdGhpcy4kTm90aWNlLnN1Y2Nlc3MoewogICAgICAgICAgICAgICAgICAgIHRpdGxlOiAnJywKICAgICAgICAgICAgICAgICAgICBkZXNjOiAn5L+d5a2Y5oiQ5YqfIScKICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICBlcnJvckl0ZW1zLmZvckVhY2goZnVuY3Rpb24gKGl0ZW0sIGluZGV4KSB7CiAgICAgICAgICAgICAgICAgICAgX3RoaXMxMi4kTm90aWNlLmVycm9yKHsKICAgICAgICAgICAgICAgICAgICAgIHRpdGxlOiAn5L+d5a2Y5aSx6LSlJywKICAgICAgICAgICAgICAgICAgICAgIGRlc2M6IGl0ZW0ubWFqb3JlbnRpdHluYW1lICsgJ+S/neWtmOWksei0pe+8gScKICAgICAgICAgICAgICAgICAgICB9KTsKCiAgICAgICAgICAgICAgICAgICAgY29uc29sZS5lcnJvcihlcnJvck1lc3NhZ2VbaW5kZXhdKTsKICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0Ni5hYnJ1cHQoInJldHVybiIsIHN1Y2Nlc3NJdGVtcyk7CgogICAgICAgICAgICAgIGNhc2UgNjc6CiAgICAgICAgICAgICAgY2FzZSAiZW5kIjoKICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDYuc3RvcCgpOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSwgX2NhbGxlZTUsIHRoaXMsIFtbMTIsIDUxLCA1NSwgNjNdLCBbMTYsIDQyXSwgWzU2LCwgNTgsIDYyXV0pOwogICAgICB9KSk7CgogICAgICBmdW5jdGlvbiBzYXZlKF94NSwgX3g2LCBfeDcsIF94OCkgewogICAgICAgIHJldHVybiBfc2F2ZS5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwogICAgICB9CgogICAgICByZXR1cm4gc2F2ZTsKICAgIH0oKQogICAgLyoqDQogICAgICog5paw5bu66KGMDQogICAgICoNCiAgICAgKiBAcGFyYW0geyp9ICRldmVudA0KICAgICAqIEByZXR1cm5zIHt2b2lkfQ0KICAgICAqIEBtZW1iZXJvZiBITURJbmZvR3JpZEJhc2UNCiAgICAgKi8KCiAgfSwgewogICAga2V5OiAibmV3Um93IiwKICAgIHZhbHVlOiBmdW5jdGlvbiBuZXdSb3coYXJncywgcGFyYW1zLCAkZXZlbnQsIHhEYXRhKSB7CiAgICAgIHZhciBfdGhpczEzID0gdGhpczsKCiAgICAgIGlmICghdGhpcy5sb2FkZHJhZnRBY3Rpb24pIHsKICAgICAgICB0aGlzLiROb3RpY2UuZXJyb3IoewogICAgICAgICAgdGl0bGU6ICfplJnor68nLAogICAgICAgICAgZGVzYzogJ1BJTVBFUlNPTkhNREdyaWRWaWV36KeG5Zu+6KGo5qC8bG9hZGRyYWZ0QWN0aW9u5Y+C5pWw5pyq6YWN572uJwogICAgICAgIH0pOwogICAgICAgIHJldHVybjsKICAgICAgfQoKICAgICAgdmFyIF90aGlzID0gdGhpczsKCiAgICAgIE9iamVjdC5hc3NpZ24oYXJnc1swXSwgewogICAgICAgIHZpZXdwYXJhbXM6IHRoaXMudmlld3BhcmFtcwogICAgICB9KTsKICAgICAgdmFyIHBvc3QgPSB0aGlzLnNlcnZpY2UubG9hZERyYWZ0KHRoaXMubG9hZGRyYWZ0QWN0aW9uLCBKU09OLnBhcnNlKEpTT04uc3RyaW5naWZ5KHRoaXMuY29udGV4dCkpLCBhcmdzWzBdLCB0aGlzLnNob3dCdXN5SW5kaWNhdG9yKTsKICAgICAgcG9zdC50aGVuKGZ1bmN0aW9uIChyZXNwb25zZSkgewogICAgICAgIGlmICghcmVzcG9uc2Uuc3RhdHVzIHx8IHJlc3BvbnNlLnN0YXR1cyAhPT0gMjAwKSB7CiAgICAgICAgICBpZiAocmVzcG9uc2UuZXJyb3JNZXNzYWdlKSB7CiAgICAgICAgICAgIF90aGlzMTMuJE5vdGljZS5lcnJvcih7CiAgICAgICAgICAgICAgdGl0bGU6ICfplJnor68nLAogICAgICAgICAgICAgIGRlc2M6IHJlc3BvbnNlLmVycm9yTWVzc2FnZQogICAgICAgICAgICB9KTsKICAgICAgICAgIH0KCiAgICAgICAgICByZXR1cm47CiAgICAgICAgfQoKICAgICAgICB2YXIgZGF0YSA9IHJlc3BvbnNlLmRhdGE7CgogICAgICAgIF90aGlzMTMuY3JlYXRlRGVmYXVsdChkYXRhKTsKCiAgICAgICAgZGF0YS5yb3dEYXRhU3RhdGUgPSAiY3JlYXRlIjsKCiAgICAgICAgX3RoaXMuaXRlbXMucHVzaChkYXRhKTsKCiAgICAgICAgX3RoaXMuZ3JpZEl0ZW1zTW9kZWwucHVzaChfdGhpcy5nZXRHcmlkUm93TW9kZWwoKSk7CiAgICAgIH0pWyJjYXRjaCJdKGZ1bmN0aW9uIChyZXNwb25zZSkgewogICAgICAgIGlmIChyZXNwb25zZSAmJiByZXNwb25zZS5zdGF0dXMgPT09IDQwMSkgewogICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KCiAgICAgICAgaWYgKCFyZXNwb25zZSB8fCAhcmVzcG9uc2Uuc3RhdHVzIHx8ICFyZXNwb25zZS5kYXRhKSB7CiAgICAgICAgICBfdGhpczEzLiROb3RpY2UuZXJyb3IoewogICAgICAgICAgICB0aXRsZTogJ+mUmeivrycsCiAgICAgICAgICAgIGRlc2M6ICfns7vnu5/lvILluLgnCiAgICAgICAgICB9KTsKCiAgICAgICAgICByZXR1cm47CiAgICAgICAgfQogICAgICB9KTsKICAgIH0KICAgIC8qKg0KICAgICAqIOihqOagvOe8lui+kemhueWAvOWPmOabtA0KICAgICAqDQogICAgICogQHBhcmFtIHJvdyDooYzmlbDmja4NCiAgICAgKiBAcGFyYW0ge3sgbmFtZTogc3RyaW5nLCB2YWx1ZTogYW55IH19ICRldmVudA0KICAgICAqIEByZXR1cm5zIHt2b2lkfQ0KICAgICAqIEBtZW1iZXJvZiBITURJbmZvR3JpZEJhc2UNCiAgICAgKi8KCiAgfSwgewogICAga2V5OiAib25HcmlkSXRlbVZhbHVlQ2hhbmdlIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBvbkdyaWRJdGVtVmFsdWVDaGFuZ2Uocm93LCAkZXZlbnQsIHJvd0luZGV4KSB7CiAgICAgIGlmICghJGV2ZW50KSB7CiAgICAgICAgcmV0dXJuOwogICAgICB9CgogICAgICBpZiAoISRldmVudC5uYW1lIHx8IE9iamVjdC5pcygkZXZlbnQubmFtZSwgJycpIHx8ICFyb3cuaGFzT3duUHJvcGVydHkoJGV2ZW50Lm5hbWUpKSB7CiAgICAgICAgcmV0dXJuOwogICAgICB9CgogICAgICByb3dbJGV2ZW50Lm5hbWVdID0gJGV2ZW50LnZhbHVlOwogICAgICB0aGlzLmdyaWRFZGl0SXRlbUNoYW5nZShyb3csICRldmVudC5uYW1lLCAkZXZlbnQudmFsdWUsIHJvd0luZGV4KTsKICAgIH0KICAgIC8qKg0KICAgICAqIOihqOagvOe8lui+kemhueWAvOWPmOWMlg0KICAgICAqDQogICAgICogQHB1YmxpYw0KICAgICAqIEBwYXJhbSByb3cg6KGM5pWw5o2uDQogICAgICogQHBhcmFtIHByb3BlcnR5IOWIl+e8lui+kemhueWQjQ0KICAgICAqIEBwYXJhbSByb3cg5YiX57yW6L6R6aG55YC8DQogICAgICogQHJldHVybnMge3ZvaWR9DQogICAgICogQG1lbWJlcm9mIEhNREluZm9HcmlkQmFzZQ0KICAgICAqLwoKICB9LCB7CiAgICBrZXk6ICJncmlkRWRpdEl0ZW1DaGFuZ2UiLAogICAgdmFsdWU6IGZ1bmN0aW9uIGdyaWRFZGl0SXRlbUNoYW5nZShyb3csIHByb3BlcnR5LCB2YWx1ZSwgcm93SW5kZXgpIHsKICAgICAgcm93LnJvd0RhdGFTdGF0ZSA9IHJvdy5yb3dEYXRhU3RhdGUgPyByb3cucm93RGF0YVN0YXRlIDogInVwZGF0ZSI7CiAgICAgIHRoaXMudmFsaWRhdGUocHJvcGVydHksIHJvdywgcm93SW5kZXgpOwogICAgfQogICAgLyoqDQogICAgICog6KGo5qC857yW6L6R6aG55pu05pawDQogICAgICoNCiAgICAgKiBAcGFyYW0ge3N0cmluZ30gbW9kZSDnlYzpnaLooYzkuLrlkI3np7ANCiAgICAgKiBAcGFyYW0geyp9IFtkYXRhPXt9XSDor7fmsYLmlbDmja4NCiAgICAgKiBAcGFyYW0ge3N0cmluZ1tdfSB1cGRhdGVEZXRhaWxzIOabtOaWsOmhuQ0KICAgICAqIEBwYXJhbSB7Ym9vbGVhbn0gW3Nob3dsb2FkaW5nXSDmmK/lkKbmmL7npLrliqDovb3nirbmgIENCiAgICAgKiBAcmV0dXJucyB7dm9pZH0NCiAgICAgKiBAbWVtYmVyb2YgSE1ESW5mb0dyaWRCYXNlDQogICAgICovCgogIH0sIHsKICAgIGtleTogInVwZGF0ZUdyaWRFZGl0SXRlbSIsCiAgICB2YWx1ZTogZnVuY3Rpb24gdXBkYXRlR3JpZEVkaXRJdGVtKG1vZGUpIHsKICAgICAgdmFyIF90aGlzMTQgPSB0aGlzOwoKICAgICAgdmFyIGRhdGEgPSBhcmd1bWVudHMubGVuZ3RoID4gMSAmJiBhcmd1bWVudHNbMV0gIT09IHVuZGVmaW5lZCA/IGFyZ3VtZW50c1sxXSA6IHt9OwogICAgICB2YXIgdXBkYXRlRGV0YWlscyA9IGFyZ3VtZW50cy5sZW5ndGggPiAyID8gYXJndW1lbnRzWzJdIDogdW5kZWZpbmVkOwogICAgICB2YXIgc2hvd2xvYWRpbmcgPSBhcmd1bWVudHMubGVuZ3RoID4gMyA/IGFyZ3VtZW50c1szXSA6IHVuZGVmaW5lZDsKCiAgICAgIGlmICghbW9kZSB8fCBtb2RlICYmIE9iamVjdC5pcyhtb2RlLCAnJykpIHsKICAgICAgICByZXR1cm47CiAgICAgIH0KCiAgICAgIHZhciBhcmcgPSBKU09OLnBhcnNlKEpTT04uc3RyaW5naWZ5KGRhdGEpKTsKICAgICAgT2JqZWN0LmFzc2lnbihhcmcsIHsKICAgICAgICB2aWV3cGFyYW1zOiB0aGlzLnZpZXdwYXJhbXMKICAgICAgfSk7CiAgICAgIHZhciBwb3N0ID0gdGhpcy5zZXJ2aWNlLmZyb250TG9naWMobW9kZSwgSlNPTi5wYXJzZShKU09OLnN0cmluZ2lmeSh0aGlzLmNvbnRleHQpKSwgYXJnLCBzaG93bG9hZGluZyk7CiAgICAgIHBvc3QudGhlbihmdW5jdGlvbiAocmVzcG9uc2UpIHsKICAgICAgICBpZiAoIXJlc3BvbnNlIHx8IHJlc3BvbnNlLnN0YXR1cyAhPT0gMjAwKSB7CiAgICAgICAgICBfdGhpczE0LiROb3RpY2UuZXJyb3IoewogICAgICAgICAgICB0aXRsZTogJ+mUmeivrycsCiAgICAgICAgICAgIGRlc2M6ICfooajljZXpobnmm7TmlrDlpLHotKUnCiAgICAgICAgICB9KTsKCiAgICAgICAgICByZXR1cm47CiAgICAgICAgfQoKICAgICAgICB2YXIgX2RhdGEgPSByZXNwb25zZS5kYXRhOwoKICAgICAgICBpZiAoIV9kYXRhKSB7CiAgICAgICAgICByZXR1cm47CiAgICAgICAgfQoKICAgICAgICB1cGRhdGVEZXRhaWxzLmZvckVhY2goZnVuY3Rpb24gKG5hbWUpIHsKICAgICAgICAgIGlmICghX2RhdGEuaGFzT3duUHJvcGVydHkobmFtZSkpIHsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgfQoKICAgICAgICAgIGRhdGFbbmFtZV0gPSBfZGF0YVtuYW1lXTsKICAgICAgICB9KTsKICAgICAgfSlbImNhdGNoIl0oZnVuY3Rpb24gKHJlc3BvbnNlKSB7CiAgICAgICAgaWYgKHJlc3BvbnNlICYmIHJlc3BvbnNlLnN0YXR1cyA9PT0gNDAxKSB7CiAgICAgICAgICByZXR1cm47CiAgICAgICAgfQoKICAgICAgICBpZiAoIXJlc3BvbnNlIHx8ICFyZXNwb25zZS5zdGF0dXMgfHwgIXJlc3BvbnNlLmRhdGEpIHsKICAgICAgICAgIF90aGlzMTQuJE5vdGljZS5lcnJvcih7CiAgICAgICAgICAgIHRpdGxlOiAn6ZSZ6K+vJywKICAgICAgICAgICAgZGVzYzogJ+ezu+e7n+W8guW4uCcKICAgICAgICAgIH0pOwoKICAgICAgICAgIHJldHVybjsKICAgICAgICB9CiAgICAgIH0pOwogICAgfQogICAgLyoqDQogICAgICog6I635Y+W5a+55bqU6KGMY2xhc3MNCiAgICAgKg0KICAgICAqIEBwYXJhbSB7Kn0gJGFyZ3Mgcm93IOihjOaVsOaNru+8jHJvd0luZGV4IOihjOe0ouW8lQ0KICAgICAqIEByZXR1cm5zIHt2b2lkfQ0KICAgICAqIEBtZW1iZXJvZiBITURJbmZvR3JpZEJhc2UNCiAgICAgKi8KCiAgfSwgewogICAga2V5OiAiZ2V0Um93Q2xhc3NOYW1lIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBnZXRSb3dDbGFzc05hbWUoYXJncykgewogICAgICB2YXIgaXNTZWxlY3RlZCA9IHRoaXMuc2VsZWN0aW9ucy5zb21lKGZ1bmN0aW9uIChpdGVtKSB7CiAgICAgICAgcmV0dXJuIE9iamVjdC5pcyhpdGVtLnBpbXBlcnNvbiwgYXJncy5yb3cucGltcGVyc29uKTsKICAgICAgfSk7CiAgICAgIHJldHVybiBpc1NlbGVjdGVkID8gImdyaWQtc2VsZWN0ZWQtcm93IiA6ICIiOwogICAgfQogICAgLyoqDQogICAgICog6I635Y+W5a+55bqU5YiXY2xhc3MNCiAgICAgKg0KICAgICAqIEBwYXJhbSB7Kn0gJGFyZ3Mgcm93IOihjOaVsOaNru+8jGNvbHVtbiDliJfmlbDmja7vvIxyb3dJbmRleCDooYzntKLlvJXvvIzliJfntKLlvJUNCiAgICAgKiBAcmV0dXJucyB7dm9pZH0NCiAgICAgKiBAbWVtYmVyb2YgSE1ESW5mb0dyaWRCYXNlDQogICAgICovCgogIH0sIHsKICAgIGtleTogImdldENlbGxDbGFzc05hbWUiLAogICAgdmFsdWU6IGZ1bmN0aW9uIGdldENlbGxDbGFzc05hbWUoYXJncykgewogICAgICB2YXIgaGFzUm93RWRpdCA9IHsKICAgICAgICAneWdiaCc6IGZhbHNlLAogICAgICAgICdwaW1wZXJzb25uYW1lJzogZmFsc2UsCiAgICAgICAgJ3pqaG0nOiBmYWxzZSwKICAgICAgICAnenpkenMnOiBmYWxzZSwKICAgICAgICAneWd6dCc6IGZhbHNlLAogICAgICAgICdobWQnOiBmYWxzZSwKICAgICAgICAnYmxhY2tsaXN0cmVhc29ucyc6IGZhbHNlCiAgICAgIH07CiAgICAgIHJldHVybiBoYXNSb3dFZGl0W2FyZ3MuY29sdW1uLnByb3BlcnR5XSAmJiB0aGlzLmFjdHVhbElzT3BlbkVkaXQgPyAiZWRpdC1jZWxsIiA6ICJpbmZvLWNlbGwiOwogICAgfQogICAgLyoqDQogICAgICog5paw5bu66buY6K6k5YC8DQogICAgICogQHBhcmFtIHsqfSAgcm93IOihjOaVsOaNrg0KICAgICAqIEBtZW1iZXJvZiBITURJbmZvR3JpZEJhc2UNCiAgICAgKi8KCiAgfSwgewogICAga2V5OiAiY3JlYXRlRGVmYXVsdCIsCiAgICB2YWx1ZTogZnVuY3Rpb24gY3JlYXRlRGVmYXVsdChyb3cpIHt9CiAgfSwgewogICAga2V5OiAiYWRhcHRpdmVTdGF0ZSIsCiAgICBnZXQ6IGZ1bmN0aW9uIGdldCgpIHsKICAgICAgcmV0dXJuICF0aGlzLmFsbENvbHVtbnMuZmluZChmdW5jdGlvbiAoY29sdW1uKSB7CiAgICAgICAgcmV0dXJuIGNvbHVtbi5zaG93ICYmIE9iamVjdC5pcyhjb2x1bW4udXRpbCwgJ1NUQVInKTsKICAgICAgfSk7CiAgICB9CiAgfV0pOwoKICByZXR1cm4gSE1ESW5mb0dyaWRCYXNlOwp9KFZ1ZSk7Cgp0c2xpYl8xLl9fZGVjb3JhdGUoW1Byb3AoKV0sIEhNREluZm9HcmlkQmFzZS5wcm90b3R5cGUsICJuYW1lIiwgdm9pZCAwKTsKCnRzbGliXzEuX19kZWNvcmF0ZShbUHJvcCgpXSwgSE1ESW5mb0dyaWRCYXNlLnByb3RvdHlwZSwgInZpZXdTdGF0ZSIsIHZvaWQgMCk7Cgp0c2xpYl8xLl9fZGVjb3JhdGUoW1Byb3AoKV0sIEhNREluZm9HcmlkQmFzZS5wcm90b3R5cGUsICJjb250ZXh0Iiwgdm9pZCAwKTsKCnRzbGliXzEuX19kZWNvcmF0ZShbUHJvcCgpXSwgSE1ESW5mb0dyaWRCYXNlLnByb3RvdHlwZSwgInZpZXdwYXJhbXMiLCB2b2lkIDApOwoKdHNsaWJfMS5fX2RlY29yYXRlKFtQcm9wKCldLCBITURJbmZvR3JpZEJhc2UucHJvdG90eXBlLCAibmV3ZGF0YSIsIHZvaWQgMCk7Cgp0c2xpYl8xLl9fZGVjb3JhdGUoW1Byb3AoKV0sIEhNREluZm9HcmlkQmFzZS5wcm90b3R5cGUsICJvcGVuZGF0YSIsIHZvaWQgMCk7Cgp0c2xpYl8xLl9fZGVjb3JhdGUoW1Byb3AoewogICJkZWZhdWx0IjogdHJ1ZQp9KV0sIEhNREluZm9HcmlkQmFzZS5wcm90b3R5cGUsICJzaG93QnVzeUluZGljYXRvciIsIHZvaWQgMCk7Cgp0c2xpYl8xLl9fZGVjb3JhdGUoW1Byb3AoKV0sIEhNREluZm9HcmlkQmFzZS5wcm90b3R5cGUsICJ1cGRhdGVBY3Rpb24iLCB2b2lkIDApOwoKdHNsaWJfMS5fX2RlY29yYXRlKFtQcm9wKCldLCBITURJbmZvR3JpZEJhc2UucHJvdG90eXBlLCAiZmV0Y2hBY3Rpb24iLCB2b2lkIDApOwoKdHNsaWJfMS5fX2RlY29yYXRlKFtQcm9wKCldLCBITURJbmZvR3JpZEJhc2UucHJvdG90eXBlLCAicmVtb3ZlQWN0aW9uIiwgdm9pZCAwKTsKCnRzbGliXzEuX19kZWNvcmF0ZShbUHJvcCgpXSwgSE1ESW5mb0dyaWRCYXNlLnByb3RvdHlwZSwgImxvYWRBY3Rpb24iLCB2b2lkIDApOwoKdHNsaWJfMS5fX2RlY29yYXRlKFtQcm9wKCldLCBITURJbmZvR3JpZEJhc2UucHJvdG90eXBlLCAibG9hZGRyYWZ0QWN0aW9uIiwgdm9pZCAwKTsKCnRzbGliXzEuX19kZWNvcmF0ZShbUHJvcCgpXSwgSE1ESW5mb0dyaWRCYXNlLnByb3RvdHlwZSwgImNyZWF0ZUFjdGlvbiIsIHZvaWQgMCk7Cgp0c2xpYl8xLl9fZGVjb3JhdGUoW1Byb3AoewogICJkZWZhdWx0IjogZmFsc2UKfSldLCBITURJbmZvR3JpZEJhc2UucHJvdG90eXBlLCAiaXNTZWxlY3RGaXJzdERlZmF1bHQiLCB2b2lkIDApOwoKdHNsaWJfMS5fX2RlY29yYXRlKFtQcm9wKCldLCBITURJbmZvR3JpZEJhc2UucHJvdG90eXBlLCAiaXNTaW5nbGVTZWxlY3QiLCB2b2lkIDApOwoKdHNsaWJfMS5fX2RlY29yYXRlKFtQcm9wKCldLCBITURJbmZvR3JpZEJhc2UucHJvdG90eXBlLCAic2VsZWN0ZWREYXRhIiwgdm9pZCAwKTsKCnRzbGliXzEuX19kZWNvcmF0ZShbV2F0Y2goJ3NlbGVjdGVkRGF0YScpXSwgSE1ESW5mb0dyaWRCYXNlLnByb3RvdHlwZSwgIm9uVmFsdWVDaGFuZ2UiLCBudWxsKTsKCnRzbGliXzEuX19kZWNvcmF0ZShbUHJvcCh7CiAgImRlZmF1bHQiOiAyCn0pXSwgSE1ESW5mb0dyaWRCYXNlLnByb3RvdHlwZSwgImdyaWRSb3dBY3RpdmVNb2RlIiwgdm9pZCAwKTsKCnRzbGliXzEuX19kZWNvcmF0ZShbUHJvcCh7CiAgImRlZmF1bHQiOiBmYWxzZQp9KV0sIEhNREluZm9HcmlkQmFzZS5wcm90b3R5cGUsICJpc09wZW5FZGl0Iiwgdm9pZCAwKTsKCkhNREluZm9HcmlkQmFzZSA9IHRzbGliXzEuX19kZWNvcmF0ZShbQ29tcG9uZW50KHsKICBjb21wb25lbnRzOiB7fQp9KV0sIEhNREluZm9HcmlkQmFzZSk7CmV4cG9ydCBkZWZhdWx0IEhNREluZm9HcmlkQmFzZTs="},null]}
{"remainingRequest":"F:\\crod项目\\人事管理系统2\\iBizEHR\\app_EHRPim\\node_modules\\thread-loader\\dist\\cjs.js!F:\\crod项目\\人事管理系统2\\iBizEHR\\app_EHRPim\\node_modules\\babel-loader\\lib\\index.js!F:\\crod项目\\人事管理系统2\\iBizEHR\\app_EHRPim\\node_modules\\ts-loader\\index.js??ref--13-3!F:\\crod项目\\人事管理系统2\\iBizEHR\\app_EHRPim\\src\\service\\entity-service.ts","dependencies":[{"path":"F:\\crod项目\\人事管理系统2\\iBizEHR\\app_EHRPim\\src\\service\\entity-service.ts","mtime":1630509410413},{"path":"F:\\crod项目\\人事管理系统2\\iBizEHR\\app_EHRPim\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1630511852775},{"path":"F:\\crod项目\\人事管理系统2\\iBizEHR\\app_EHRPim\\node_modules\\thread-loader\\dist\\cjs.js","mtime":1630511853252},{"path":"F:\\crod项目\\人事管理系统2\\iBizEHR\\app_EHRPim\\node_modules\\babel-loader\\lib\\index.js","mtime":1630511852747},{"path":"F:\\crod项目\\人事管理系统2\\iBizEHR\\app_EHRPim\\node_modules\\ts-loader\\index.js","mtime":1630511985412}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:aW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkuY29uY2F0IjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkuZmlsdGVyIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkuZm9yLWVhY2giOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5vYmplY3QuZGVmaW5lLXByb3BlcnR5IjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMub2JqZWN0LmlzIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMub2JqZWN0LmtleXMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy93ZWIuZG9tLWNvbGxlY3Rpb25zLmZvci1lYWNoIjsKaW1wb3J0ICJyZWdlbmVyYXRvci1ydW50aW1lL3J1bnRpbWUiOwppbXBvcnQgX2FzeW5jVG9HZW5lcmF0b3IgZnJvbSAiRjpcXGNyb2RcdTk4NzlcdTc2RUVcXFx1NEVCQVx1NEU4Qlx1N0JBMVx1NzQwNlx1N0NGQlx1N0VERjJcXGlCaXpFSFJcXGFwcF9FSFJQaW1cXG5vZGVfbW9kdWxlc1xcQGJhYmVsXFxydW50aW1lL2hlbHBlcnMvZXNtL2FzeW5jVG9HZW5lcmF0b3IiOwppbXBvcnQgX2NsYXNzQ2FsbENoZWNrIGZyb20gIkY6XFxjcm9kXHU5ODc5XHU3NkVFXFxcdTRFQkFcdTRFOEJcdTdCQTFcdTc0MDZcdTdDRkJcdTdFREYyXFxpQml6RUhSXFxhcHBfRUhSUGltXFxub2RlX21vZHVsZXNcXEBiYWJlbFxccnVudGltZS9oZWxwZXJzL2VzbS9jbGFzc0NhbGxDaGVjayI7CmltcG9ydCBfY3JlYXRlQ2xhc3MgZnJvbSAiRjpcXGNyb2RcdTk4NzlcdTc2RUVcXFx1NEVCQVx1NEU4Qlx1N0JBMVx1NzQwNlx1N0NGQlx1N0VERjJcXGlCaXpFSFJcXGFwcF9FSFJQaW1cXG5vZGVfbW9kdWxlc1xcQGJhYmVsXFxydW50aW1lL2hlbHBlcnMvZXNtL2NyZWF0ZUNsYXNzIjsKaW1wb3J0IHsgSHR0cCB9IGZyb20gJ0AvdXRpbHMnOwovKioNCiAqIOWunuS9k+acjeWKoeWfuuexuw0KICoNCiAqIEBleHBvcnQNCiAqIEBjbGFzcyBFbnRpdHlTZXJ2aWNlDQogKi8KCnZhciBFbnRpdHlTZXJ2aWNlID0KLyojX19QVVJFX18qLwpmdW5jdGlvbiAoKSB7CiAgLyoqDQogICAqIENyZWF0ZXMgYW4gaW5zdGFuY2Ugb2YgRW50aXR5U2VydmljZS4NCiAgICoNCiAgICogQHBhcmFtIHsqfSBbb3B0cz17fV0NCiAgICogQG1lbWJlcm9mIEVudGl0eVNlcnZpY2UNCiAgICovCiAgZnVuY3Rpb24gRW50aXR5U2VydmljZSgpIHsKICAgIHZhciBvcHRzID0gYXJndW1lbnRzLmxlbmd0aCA+IDAgJiYgYXJndW1lbnRzWzBdICE9PSB1bmRlZmluZWQgPyBhcmd1bWVudHNbMF0gOiB7fTsKCiAgICBfY2xhc3NDYWxsQ2hlY2sodGhpcywgRW50aXR5U2VydmljZSk7CgogICAgLyoqDQogICAgICogVnVlIOeKtuaAgeeuoeeQhuWZqA0KICAgICAqDQogICAgICogQHByaXZhdGUNCiAgICAgKiBAdHlwZSB7KGFueSB8IG51bGwpfQ0KICAgICAqIEBtZW1iZXJvZiBFbnRpdHlTZXJ2aWNlDQogICAgICovCiAgICB0aGlzLiRzdG9yZSA9IG51bGw7CiAgICAvKioNCiAgICAgKiDlvZPliY1EReagh+ivhg0KICAgICAqDQogICAgICogQHB1YmxpYw0KICAgICAqIEB0eXBlIHsoc3RyaW5nKX0NCiAgICAgKiBAbWVtYmVyb2YgRW50aXR5U2VydmljZQ0KICAgICAqLwoKICAgIHRoaXMuQVBQREVLRVkgPSAnJzsKICAgIC8qKg0KICAgICAqIOW9k+WJjUFQUERF5qCH6K+GDQogICAgICoNCiAgICAgKiBAcHVibGljDQogICAgICogQHR5cGUgeyhzdHJpbmcpfQ0KICAgICAqIEBtZW1iZXJvZiBFbnRpdHlTZXJ2aWNlDQogICAgICovCgogICAgdGhpcy5BUFBMWURFS0VZID0gJyc7CiAgICAvKioNCiAgICAgKiDlvZPliY1OQU1FDQogICAgICoNCiAgICAgKiBAcHVibGljDQogICAgICogQHR5cGUgeyhzdHJpbmcpfQ0KICAgICAqIEBtZW1iZXJvZiBFbnRpdHlTZXJ2aWNlDQogICAgICovCgogICAgdGhpcy5BUFBERU5BTUUgPSAnJzsKICAgIC8qKg0KICAgICAqIOW9k+WJjeS4u+S/oeaBr+WQjQ0KICAgICAqDQogICAgICogQHB1YmxpYw0KICAgICAqIEB0eXBlIHsoc3RyaW5nKX0NCiAgICAgKiBAbWVtYmVyb2YgRW50aXR5U2VydmljZQ0KICAgICAqLwoKICAgIHRoaXMuQVBQREVURVhUID0gJyc7CiAgICAvKioNCiAgICAgKiDlvZPliY3ns7vnu5/lkI0NCiAgICAgKg0KICAgICAqIEBwdWJsaWMNCiAgICAgKiBAdHlwZSB7KHN0cmluZyl9DQogICAgICogQG1lbWJlcm9mIEVudGl0eVNlcnZpY2UNCiAgICAgKi8KCiAgICB0aGlzLlNZU1RFTU5BTUUgPSAnJzsKICAgIC8qKg0KICAgICAqIOW9k+WJjeW6lOeUqOWQjQ0KICAgICAqDQogICAgICogQHB1YmxpYw0KICAgICAqIEB0eXBlIHsoc3RyaW5nKX0NCiAgICAgKiBAbWVtYmVyb2YgRW50aXR5U2VydmljZQ0KICAgICAqLwoKICAgIHRoaXMuQVBQTkFNRSA9ICcnOwogICAgdGhpcy4kc3RvcmUgPSBvcHRzLiRzdG9yZTsKICAgIHRoaXMudGVtcFN0b3JhZ2UgPSBsb2NhbFN0b3JhZ2U7CiAgICB0aGlzLmluaXRCYXNpY0RhdGEoKTsKICB9CiAgLyoqDQogICAqIOiOt+WPluWunuS9k+aVsOaNruacjeWKoQ0KICAgKg0KICAgKiBAcHJvdGVjdGVkDQogICAqIEBwYXJhbSB7c3RyaW5nfSBuYW1lIOWunuS9k+WQjeensA0KICAgKiBAcmV0dXJucyB7UHJvbWlzZTxhbnk+fQ0KICAgKiBAbWVtYmVyb2YgRW50aXR5U2VydmljZQ0KICAgKi8KCgogIF9jcmVhdGVDbGFzcyhFbnRpdHlTZXJ2aWNlLCBbewogICAga2V5OiAiZ2V0U2VydmljZSIsCiAgICB2YWx1ZTogZnVuY3Rpb24gZ2V0U2VydmljZShuYW1lKSB7CiAgICAgIHJldHVybiB3aW5kb3dbJ2VudGl0eVNlcnZpY2VSZWdpc3RlciddLmdldFNlcnZpY2UobmFtZSk7CiAgICB9CiAgICAvKioNCiAgICAgKiDojrflj5bnirbmgIHnrqHnkIblmagNCiAgICAgKg0KICAgICAqIEByZXR1cm5zIHsoYW55IHwgbnVsbCl9DQogICAgICogQG1lbWJlcm9mIEVudGl0eVNlcnZpY2UNCiAgICAgKi8KCiAgfSwgewogICAga2V5OiAiZ2V0U3RvcmUiLAogICAgdmFsdWU6IGZ1bmN0aW9uIGdldFN0b3JlKCkgewogICAgICByZXR1cm4gdGhpcy4kc3RvcmU7CiAgICB9CiAgICAvKioNCiAgICAgKiDliJ3lp4vljJbln7rnoYDmlbDmja4NCiAgICAgKg0KICAgICAqIEBtZW1iZXJvZiBFbnRpdHlTZXJ2aWNlDQogICAgICovCgogIH0sIHsKICAgIGtleTogImluaXRCYXNpY0RhdGEiLAogICAgdmFsdWU6IGZ1bmN0aW9uIGluaXRCYXNpY0RhdGEoKSB7fQogICAgLyoqDQogICAgICogU2VsZWN05o6l5Y+j5pa55rOVDQogICAgICoNCiAgICAgKiBAcGFyYW0geyp9IFtjb250ZXh0PXt9XQ0KICAgICAqIEBwYXJhbSB7Kn0gW2RhdGE9e31dDQogICAgICogQHBhcmFtIHtib29sZWFufSBbaXNsb2FkaW5nXQ0KICAgICAqIEByZXR1cm5zIHtQcm9taXNlPGFueT59DQogICAgICogQG1lbWJlcm9mIEVudGl0eVNlcnZpY2UNCiAgICAgKi8KCiAgfSwgewogICAga2V5OiAiU2VsZWN0IiwKICAgIHZhbHVlOiBmdW5jdGlvbiAoKSB7CiAgICAgIHZhciBfU2VsZWN0ID0gX2FzeW5jVG9HZW5lcmF0b3IoCiAgICAgIC8qI19fUFVSRV9fKi8KICAgICAgcmVnZW5lcmF0b3JSdW50aW1lLm1hcmsoZnVuY3Rpb24gX2NhbGxlZSgpIHsKICAgICAgICB2YXIgY29udGV4dCwKICAgICAgICAgICAgZGF0YSwKICAgICAgICAgICAgaXNsb2FkaW5nLAogICAgICAgICAgICBfYXJncyA9IGFyZ3VtZW50czsKICAgICAgICByZXR1cm4gcmVnZW5lcmF0b3JSdW50aW1lLndyYXAoZnVuY3Rpb24gX2NhbGxlZSQoX2NvbnRleHQpIHsKICAgICAgICAgIHdoaWxlICgxKSB7CiAgICAgICAgICAgIHN3aXRjaCAoX2NvbnRleHQucHJldiA9IF9jb250ZXh0Lm5leHQpIHsKICAgICAgICAgICAgICBjYXNlIDA6CiAgICAgICAgICAgICAgICBjb250ZXh0ID0gX2FyZ3MubGVuZ3RoID4gMCAmJiBfYXJnc1swXSAhPT0gdW5kZWZpbmVkID8gX2FyZ3NbMF0gOiB7fTsKICAgICAgICAgICAgICAgIGRhdGEgPSBfYXJncy5sZW5ndGggPiAxICYmIF9hcmdzWzFdICE9PSB1bmRlZmluZWQgPyBfYXJnc1sxXSA6IHt9OwogICAgICAgICAgICAgICAgaXNsb2FkaW5nID0gX2FyZ3MubGVuZ3RoID4gMiA/IF9hcmdzWzJdIDogdW5kZWZpbmVkOwogICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0LmFicnVwdCgicmV0dXJuIiwgdGhpcy5TZWxlY3RUZW1wKGNvbnRleHQsIGRhdGEsIGlzbG9hZGluZykpOwoKICAgICAgICAgICAgICBjYXNlIDQ6CiAgICAgICAgICAgICAgY2FzZSAiZW5kIjoKICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dC5zdG9wKCk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9LCBfY2FsbGVlLCB0aGlzKTsKICAgICAgfSkpOwoKICAgICAgZnVuY3Rpb24gU2VsZWN0KCkgewogICAgICAgIHJldHVybiBfU2VsZWN0LmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7CiAgICAgIH0KCiAgICAgIHJldHVybiBTZWxlY3Q7CiAgICB9KCkKICAgIC8qKg0KICAgICAqIFNlbGVjdFRlbXDmjqXlj6Pmlrnms5UNCiAgICAgKg0KICAgICAqIEBwYXJhbSB7Kn0gW2NvbnRleHQ9e31dDQogICAgICogQHBhcmFtIHsqfSBbZGF0YT17fV0NCiAgICAgKiBAcGFyYW0ge2Jvb2xlYW59IFtpc2xvYWRpbmddDQogICAgICogQHJldHVybnMge1Byb21pc2U8YW55Pn0NCiAgICAgKiBAbWVtYmVyb2YgRW50aXR5U2VydmljZQ0KICAgICAqLwoKICB9LCB7CiAgICBrZXk6ICJTZWxlY3RUZW1wIiwKICAgIHZhbHVlOiBmdW5jdGlvbiAoKSB7CiAgICAgIHZhciBfU2VsZWN0VGVtcCA9IF9hc3luY1RvR2VuZXJhdG9yKAogICAgICAvKiNfX1BVUkVfXyovCiAgICAgIHJlZ2VuZXJhdG9yUnVudGltZS5tYXJrKGZ1bmN0aW9uIF9jYWxsZWUyKCkgewogICAgICAgIHZhciBfdGhpcyA9IHRoaXM7CgogICAgICAgIHZhciBjb250ZXh0LAogICAgICAgICAgICBkYXRhLAogICAgICAgICAgICBpc2xvYWRpbmcsCiAgICAgICAgICAgIHJlc3VsdCwKICAgICAgICAgICAgdGVtcFJlc3VsdCwKICAgICAgICAgICAgdGVtcFJlc3VsdERhdGEsCiAgICAgICAgICAgIF9hcmdzMiA9IGFyZ3VtZW50czsKICAgICAgICByZXR1cm4gcmVnZW5lcmF0b3JSdW50aW1lLndyYXAoZnVuY3Rpb24gX2NhbGxlZTIkKF9jb250ZXh0MikgewogICAgICAgICAgd2hpbGUgKDEpIHsKICAgICAgICAgICAgc3dpdGNoIChfY29udGV4dDIucHJldiA9IF9jb250ZXh0Mi5uZXh0KSB7CiAgICAgICAgICAgICAgY2FzZSAwOgogICAgICAgICAgICAgICAgY29udGV4dCA9IF9hcmdzMi5sZW5ndGggPiAwICYmIF9hcmdzMlswXSAhPT0gdW5kZWZpbmVkID8gX2FyZ3MyWzBdIDoge307CiAgICAgICAgICAgICAgICBkYXRhID0gX2FyZ3MyLmxlbmd0aCA+IDEgJiYgX2FyZ3MyWzFdICE9PSB1bmRlZmluZWQgPyBfYXJnczJbMV0gOiB7fTsKICAgICAgICAgICAgICAgIGlzbG9hZGluZyA9IF9hcmdzMi5sZW5ndGggPiAyID8gX2FyZ3MyWzJdIDogdW5kZWZpbmVkOwoKICAgICAgICAgICAgICAgIGlmICghKGNvbnRleHQuc3Jmc2Vzc2lvbmtleSAmJiAhT2JqZWN0LmlzKHRoaXMudGVtcFN0b3JhZ2UuZ2V0SXRlbShjb250ZXh0LnNyZnNlc3Npb25rZXkgKyAnXycgKyB0aGlzLkFQUERFTkFNRSksICd1bmRlZmluZWQnKSkpIHsKICAgICAgICAgICAgICAgICAgX2NvbnRleHQyLm5leHQgPSAxMjsKICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgcmVzdWx0ID0gSlNPTi5wYXJzZSh0aGlzLnRlbXBTdG9yYWdlLmdldEl0ZW0oY29udGV4dC5zcmZzZXNzaW9ua2V5ICsgJ18nICsgdGhpcy5BUFBERU5BTUUpKTsKCiAgICAgICAgICAgICAgICBpZiAoIXJlc3VsdCkgewogICAgICAgICAgICAgICAgICBfY29udGV4dDIubmV4dCA9IDExOwogICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICB0ZW1wUmVzdWx0ID0gcmVzdWx0LmZpbHRlcihmdW5jdGlvbiAoaXRlbSkgewogICAgICAgICAgICAgICAgICByZXR1cm4gT2JqZWN0LmlzKGl0ZW1bX3RoaXMuQVBQREVLRVldLCBkYXRhW190aGlzLkFQUERFS0VZXSk7CiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIHRlbXBSZXN1bHREYXRhID0gdGVtcFJlc3VsdC5sZW5ndGggPiAwID8gdGVtcFJlc3VsdFswXSA6IE9iamVjdC5hc3NpZ24oe30sIGRhdGEpOwogICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0Mi5hYnJ1cHQoInJldHVybiIsIHsKICAgICAgICAgICAgICAgICAgInN0YXR1cyI6IDIwMCwKICAgICAgICAgICAgICAgICAgImRhdGEiOiB0ZW1wUmVzdWx0RGF0YQogICAgICAgICAgICAgICAgfSk7CgogICAgICAgICAgICAgIGNhc2UgMTE6CiAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQyLmFicnVwdCgicmV0dXJuIiwgewogICAgICAgICAgICAgICAgICAic3RhdHVzIjogNTAwLAogICAgICAgICAgICAgICAgICAiZGF0YSI6IG51bGwKICAgICAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgICBjYXNlIDEyOgogICAgICAgICAgICAgIGNhc2UgImVuZCI6CiAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQyLnN0b3AoKTsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0sIF9jYWxsZWUyLCB0aGlzKTsKICAgICAgfSkpOwoKICAgICAgZnVuY3Rpb24gU2VsZWN0VGVtcCgpIHsKICAgICAgICByZXR1cm4gX1NlbGVjdFRlbXAuYXBwbHkodGhpcywgYXJndW1lbnRzKTsKICAgICAgfQoKICAgICAgcmV0dXJuIFNlbGVjdFRlbXA7CiAgICB9KCkKICAgIC8qKg0KICAgICAqIENyZWF0ZVRlbXDmjqXlj6Pmlrnms5UNCiAgICAgKg0KICAgICAqIEBwYXJhbSB7Kn0gW2NvbnRleHQ9e31dDQogICAgICogQHBhcmFtIHsqfSBbZGF0YT17fV0NCiAgICAgKiBAcGFyYW0ge2Jvb2xlYW59IFtpc2xvYWRpbmddDQogICAgICogQHJldHVybnMge1Byb21pc2U8YW55Pn0NCiAgICAgKiBAbWVtYmVyb2YgRW50aXR5U2VydmljZQ0KICAgICAqLwoKICB9LCB7CiAgICBrZXk6ICJDcmVhdGVUZW1wIiwKICAgIHZhbHVlOiBmdW5jdGlvbiAoKSB7CiAgICAgIHZhciBfQ3JlYXRlVGVtcCA9IF9hc3luY1RvR2VuZXJhdG9yKAogICAgICAvKiNfX1BVUkVfXyovCiAgICAgIHJlZ2VuZXJhdG9yUnVudGltZS5tYXJrKGZ1bmN0aW9uIF9jYWxsZWUzKCkgewogICAgICAgIHZhciBjb250ZXh0LAogICAgICAgICAgICBkYXRhLAogICAgICAgICAgICBpc2xvYWRpbmcsCiAgICAgICAgICAgIHRlbXBEYXRhLAogICAgICAgICAgICBfYXJnczMgPSBhcmd1bWVudHM7CiAgICAgICAgcmV0dXJuIHJlZ2VuZXJhdG9yUnVudGltZS53cmFwKGZ1bmN0aW9uIF9jYWxsZWUzJChfY29udGV4dDMpIHsKICAgICAgICAgIHdoaWxlICgxKSB7CiAgICAgICAgICAgIHN3aXRjaCAoX2NvbnRleHQzLnByZXYgPSBfY29udGV4dDMubmV4dCkgewogICAgICAgICAgICAgIGNhc2UgMDoKICAgICAgICAgICAgICAgIGNvbnRleHQgPSBfYXJnczMubGVuZ3RoID4gMCAmJiBfYXJnczNbMF0gIT09IHVuZGVmaW5lZCA/IF9hcmdzM1swXSA6IHt9OwogICAgICAgICAgICAgICAgZGF0YSA9IF9hcmdzMy5sZW5ndGggPiAxICYmIF9hcmdzM1sxXSAhPT0gdW5kZWZpbmVkID8gX2FyZ3MzWzFdIDoge307CiAgICAgICAgICAgICAgICBpc2xvYWRpbmcgPSBfYXJnczMubGVuZ3RoID4gMiA/IF9hcmdzM1syXSA6IHVuZGVmaW5lZDsKCiAgICAgICAgICAgICAgICBpZiAoIShjb250ZXh0LnNyZnNlc3Npb25rZXkgJiYgIU9iamVjdC5pcyh0aGlzLnRlbXBTdG9yYWdlLmdldEl0ZW0oY29udGV4dC5zcmZzZXNzaW9ua2V5ICsgJ18nICsgdGhpcy5BUFBERU5BTUUpLCAndW5kZWZpbmVkJykpKSB7CiAgICAgICAgICAgICAgICAgIF9jb250ZXh0My5uZXh0ID0gMTE7CiAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIHRlbXBEYXRhID0gSlNPTi5wYXJzZSh0aGlzLnRlbXBTdG9yYWdlLmdldEl0ZW0oY29udGV4dC5zcmZzZXNzaW9ua2V5ICsgJ18nICsgdGhpcy5BUFBERU5BTUUpKTsKICAgICAgICAgICAgICAgIGRhdGEuc3JmZnJvbnR1ZiA9ICIwIjsKICAgICAgICAgICAgICAgIHRlbXBEYXRhLnB1c2goZGF0YSk7CiAgICAgICAgICAgICAgICB0aGlzLnRlbXBTdG9yYWdlLnNldEl0ZW0oY29udGV4dC5zcmZzZXNzaW9ua2V5ICsgJ18nICsgdGhpcy5BUFBERU5BTUUsIEpTT04uc3RyaW5naWZ5KHRlbXBEYXRhKSk7CiAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQzLmFicnVwdCgicmV0dXJuIiwgewogICAgICAgICAgICAgICAgICAic3RhdHVzIjogMjAwLAogICAgICAgICAgICAgICAgICAiZGF0YSI6IGRhdGEKICAgICAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgICBjYXNlIDExOgogICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0My5hYnJ1cHQoInJldHVybiIsIHsKICAgICAgICAgICAgICAgICAgInN0YXR1cyI6IDIwMCwKICAgICAgICAgICAgICAgICAgImRhdGEiOiB7fQogICAgICAgICAgICAgICAgfSk7CgogICAgICAgICAgICAgIGNhc2UgMTI6CiAgICAgICAgICAgICAgY2FzZSAiZW5kIjoKICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDMuc3RvcCgpOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSwgX2NhbGxlZTMsIHRoaXMpOwogICAgICB9KSk7CgogICAgICBmdW5jdGlvbiBDcmVhdGVUZW1wKCkgewogICAgICAgIHJldHVybiBfQ3JlYXRlVGVtcC5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwogICAgICB9CgogICAgICByZXR1cm4gQ3JlYXRlVGVtcDsKICAgIH0oKQogICAgLyoqDQogICAgICogR2V0VGVtcOaOpeWPo+aWueazlQ0KICAgICAqDQogICAgICogQHBhcmFtIHsqfSBbY29udGV4dD17fV0NCiAgICAgKiBAcGFyYW0geyp9IFtkYXRhPXt9XQ0KICAgICAqIEBwYXJhbSB7Ym9vbGVhbn0gW2lzbG9hZGluZ10NCiAgICAgKiBAcmV0dXJucyB7UHJvbWlzZTxhbnk+fQ0KICAgICAqIEBtZW1iZXJvZiBFbnRpdHlTZXJ2aWNlDQogICAgICovCgogIH0sIHsKICAgIGtleTogIkdldFRlbXAiLAogICAgdmFsdWU6IGZ1bmN0aW9uICgpIHsKICAgICAgdmFyIF9HZXRUZW1wID0gX2FzeW5jVG9HZW5lcmF0b3IoCiAgICAgIC8qI19fUFVSRV9fKi8KICAgICAgcmVnZW5lcmF0b3JSdW50aW1lLm1hcmsoZnVuY3Rpb24gX2NhbGxlZTQoKSB7CiAgICAgICAgdmFyIF90aGlzMiA9IHRoaXM7CgogICAgICAgIHZhciBjb250ZXh0LAogICAgICAgICAgICBkYXRhLAogICAgICAgICAgICBpc2xvYWRpbmcsCiAgICAgICAgICAgIHJlc3VsdCwKICAgICAgICAgICAgdGVtcFJlc3VsdCwKICAgICAgICAgICAgdGVtcFJlc3VsdERhdGEsCiAgICAgICAgICAgIF9hcmdzNCA9IGFyZ3VtZW50czsKICAgICAgICByZXR1cm4gcmVnZW5lcmF0b3JSdW50aW1lLndyYXAoZnVuY3Rpb24gX2NhbGxlZTQkKF9jb250ZXh0NCkgewogICAgICAgICAgd2hpbGUgKDEpIHsKICAgICAgICAgICAgc3dpdGNoIChfY29udGV4dDQucHJldiA9IF9jb250ZXh0NC5uZXh0KSB7CiAgICAgICAgICAgICAgY2FzZSAwOgogICAgICAgICAgICAgICAgY29udGV4dCA9IF9hcmdzNC5sZW5ndGggPiAwICYmIF9hcmdzNFswXSAhPT0gdW5kZWZpbmVkID8gX2FyZ3M0WzBdIDoge307CiAgICAgICAgICAgICAgICBkYXRhID0gX2FyZ3M0Lmxlbmd0aCA+IDEgJiYgX2FyZ3M0WzFdICE9PSB1bmRlZmluZWQgPyBfYXJnczRbMV0gOiB7fTsKICAgICAgICAgICAgICAgIGlzbG9hZGluZyA9IF9hcmdzNC5sZW5ndGggPiAyID8gX2FyZ3M0WzJdIDogdW5kZWZpbmVkOwoKICAgICAgICAgICAgICAgIGlmICghKGNvbnRleHQuc3Jmc2Vzc2lvbmtleSAmJiAhT2JqZWN0LmlzKHRoaXMudGVtcFN0b3JhZ2UuZ2V0SXRlbShjb250ZXh0LnNyZnNlc3Npb25rZXkgKyAnXycgKyB0aGlzLkFQUERFTkFNRSksICd1bmRlZmluZWQnKSkpIHsKICAgICAgICAgICAgICAgICAgX2NvbnRleHQ0Lm5leHQgPSAxMjsKICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgcmVzdWx0ID0gSlNPTi5wYXJzZSh0aGlzLnRlbXBTdG9yYWdlLmdldEl0ZW0oY29udGV4dC5zcmZzZXNzaW9ua2V5ICsgJ18nICsgdGhpcy5BUFBERU5BTUUpKTsKCiAgICAgICAgICAgICAgICBpZiAoIXJlc3VsdCkgewogICAgICAgICAgICAgICAgICBfY29udGV4dDQubmV4dCA9IDExOwogICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICB0ZW1wUmVzdWx0ID0gcmVzdWx0LmZpbHRlcihmdW5jdGlvbiAoaXRlbSkgewogICAgICAgICAgICAgICAgICByZXR1cm4gT2JqZWN0LmlzKGl0ZW1bX3RoaXMyLkFQUERFS0VZXSwgZGF0YVtfdGhpczIuQVBQREVLRVldKTsKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgdGVtcFJlc3VsdERhdGEgPSB0ZW1wUmVzdWx0Lmxlbmd0aCA+IDAgPyB0ZW1wUmVzdWx0WzBdIDogT2JqZWN0LmFzc2lnbih7fSwgZGF0YSk7CiAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQ0LmFicnVwdCgicmV0dXJuIiwgewogICAgICAgICAgICAgICAgICAic3RhdHVzIjogMjAwLAogICAgICAgICAgICAgICAgICAiZGF0YSI6IHRlbXBSZXN1bHREYXRhCiAgICAgICAgICAgICAgICB9KTsKCiAgICAgICAgICAgICAgY2FzZSAxMToKICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDQuYWJydXB0KCJyZXR1cm4iLCB7CiAgICAgICAgICAgICAgICAgICJzdGF0dXMiOiA1MDAsCiAgICAgICAgICAgICAgICAgICJkYXRhIjogbnVsbAogICAgICAgICAgICAgICAgfSk7CgogICAgICAgICAgICAgIGNhc2UgMTI6CiAgICAgICAgICAgICAgY2FzZSAiZW5kIjoKICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDQuc3RvcCgpOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSwgX2NhbGxlZTQsIHRoaXMpOwogICAgICB9KSk7CgogICAgICBmdW5jdGlvbiBHZXRUZW1wKCkgewogICAgICAgIHJldHVybiBfR2V0VGVtcC5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwogICAgICB9CgogICAgICByZXR1cm4gR2V0VGVtcDsKICAgIH0oKQogICAgLyoqDQogICAgICogVXBkYXRl5o6l5Y+j5pa55rOVDQogICAgICoNCiAgICAgKiBAcGFyYW0geyp9IFtjb250ZXh0PXt9XQ0KICAgICAqIEBwYXJhbSB7Kn0gW2RhdGE9e31dDQogICAgICogQHBhcmFtIHtib29sZWFufSBbaXNsb2FkaW5nXQ0KICAgICAqIEByZXR1cm5zIHtQcm9taXNlPGFueT59DQogICAgICogQG1lbWJlcm9mIEVudGl0eVNlcnZpY2UNCiAgICAgKi8KCiAgfSwgewogICAga2V5OiAiVXBkYXRlIiwKICAgIHZhbHVlOiBmdW5jdGlvbiAoKSB7CiAgICAgIHZhciBfVXBkYXRlID0gX2FzeW5jVG9HZW5lcmF0b3IoCiAgICAgIC8qI19fUFVSRV9fKi8KICAgICAgcmVnZW5lcmF0b3JSdW50aW1lLm1hcmsoZnVuY3Rpb24gX2NhbGxlZTUoKSB7CiAgICAgICAgdmFyIGNvbnRleHQsCiAgICAgICAgICAgIGRhdGEsCiAgICAgICAgICAgIGlzbG9hZGluZywKICAgICAgICAgICAgX2FyZ3M1ID0gYXJndW1lbnRzOwogICAgICAgIHJldHVybiByZWdlbmVyYXRvclJ1bnRpbWUud3JhcChmdW5jdGlvbiBfY2FsbGVlNSQoX2NvbnRleHQ1KSB7CiAgICAgICAgICB3aGlsZSAoMSkgewogICAgICAgICAgICBzd2l0Y2ggKF9jb250ZXh0NS5wcmV2ID0gX2NvbnRleHQ1Lm5leHQpIHsKICAgICAgICAgICAgICBjYXNlIDA6CiAgICAgICAgICAgICAgICBjb250ZXh0ID0gX2FyZ3M1Lmxlbmd0aCA+IDAgJiYgX2FyZ3M1WzBdICE9PSB1bmRlZmluZWQgPyBfYXJnczVbMF0gOiB7fTsKICAgICAgICAgICAgICAgIGRhdGEgPSBfYXJnczUubGVuZ3RoID4gMSAmJiBfYXJnczVbMV0gIT09IHVuZGVmaW5lZCA/IF9hcmdzNVsxXSA6IHt9OwogICAgICAgICAgICAgICAgaXNsb2FkaW5nID0gX2FyZ3M1Lmxlbmd0aCA+IDIgPyBfYXJnczVbMl0gOiB1bmRlZmluZWQ7CiAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQ1LmFicnVwdCgicmV0dXJuIiwgdGhpcy5VcGRhdGVUZW1wKGNvbnRleHQsIGRhdGEsIGlzbG9hZGluZykpOwoKICAgICAgICAgICAgICBjYXNlIDQ6CiAgICAgICAgICAgICAgY2FzZSAiZW5kIjoKICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDUuc3RvcCgpOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSwgX2NhbGxlZTUsIHRoaXMpOwogICAgICB9KSk7CgogICAgICBmdW5jdGlvbiBVcGRhdGUoKSB7CiAgICAgICAgcmV0dXJuIF9VcGRhdGUuYXBwbHkodGhpcywgYXJndW1lbnRzKTsKICAgICAgfQoKICAgICAgcmV0dXJuIFVwZGF0ZTsKICAgIH0oKQogICAgLyoqDQogICAgICogVXBkYXRlVGVtcE1ham9y5o6l5Y+j5pa55rOVDQogICAgICoNCiAgICAgKiBAcGFyYW0geyp9IFtjb250ZXh0PXt9XQ0KICAgICAqIEBwYXJhbSB7Kn0gW2RhdGE9e31dDQogICAgICogQHBhcmFtIHtib29sZWFufSBbaXNsb2FkaW5nXQ0KICAgICAqIEByZXR1cm5zIHtQcm9taXNlPGFueT59DQogICAgICogQG1lbWJlcm9mIEVudGl0eVNlcnZpY2UNCiAgICAgKi8KCiAgfSwgewogICAga2V5OiAiVXBkYXRlVGVtcE1ham9yIiwKICAgIHZhbHVlOiBmdW5jdGlvbiAoKSB7CiAgICAgIHZhciBfVXBkYXRlVGVtcE1ham9yID0gX2FzeW5jVG9HZW5lcmF0b3IoCiAgICAgIC8qI19fUFVSRV9fKi8KICAgICAgcmVnZW5lcmF0b3JSdW50aW1lLm1hcmsoZnVuY3Rpb24gX2NhbGxlZTYoKSB7CiAgICAgICAgdmFyIGNvbnRleHQsCiAgICAgICAgICAgIGRhdGEsCiAgICAgICAgICAgIGlzbG9hZGluZywKICAgICAgICAgICAgX2FyZ3M2ID0gYXJndW1lbnRzOwogICAgICAgIHJldHVybiByZWdlbmVyYXRvclJ1bnRpbWUud3JhcChmdW5jdGlvbiBfY2FsbGVlNiQoX2NvbnRleHQ2KSB7CiAgICAgICAgICB3aGlsZSAoMSkgewogICAgICAgICAgICBzd2l0Y2ggKF9jb250ZXh0Ni5wcmV2ID0gX2NvbnRleHQ2Lm5leHQpIHsKICAgICAgICAgICAgICBjYXNlIDA6CiAgICAgICAgICAgICAgICBjb250ZXh0ID0gX2FyZ3M2Lmxlbmd0aCA+IDAgJiYgX2FyZ3M2WzBdICE9PSB1bmRlZmluZWQgPyBfYXJnczZbMF0gOiB7fTsKICAgICAgICAgICAgICAgIGRhdGEgPSBfYXJnczYubGVuZ3RoID4gMSAmJiBfYXJnczZbMV0gIT09IHVuZGVmaW5lZCA/IF9hcmdzNlsxXSA6IHt9OwogICAgICAgICAgICAgICAgaXNsb2FkaW5nID0gX2FyZ3M2Lmxlbmd0aCA+IDIgPyBfYXJnczZbMl0gOiB1bmRlZmluZWQ7CiAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQ2LmFicnVwdCgicmV0dXJuIiwgdGhpcy5VcGRhdGUoY29udGV4dCwgZGF0YSwgaXNsb2FkaW5nKSk7CgogICAgICAgICAgICAgIGNhc2UgNDoKICAgICAgICAgICAgICBjYXNlICJlbmQiOgogICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0Ni5zdG9wKCk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9LCBfY2FsbGVlNiwgdGhpcyk7CiAgICAgIH0pKTsKCiAgICAgIGZ1bmN0aW9uIFVwZGF0ZVRlbXBNYWpvcigpIHsKICAgICAgICByZXR1cm4gX1VwZGF0ZVRlbXBNYWpvci5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwogICAgICB9CgogICAgICByZXR1cm4gVXBkYXRlVGVtcE1ham9yOwogICAgfSgpCiAgICAvKioNCiAgICAgKiBTYXZl5o6l5Y+j5pa55rOVDQogICAgICoNCiAgICAgKiBAcGFyYW0geyp9IFtjb250ZXh0PXt9XQ0KICAgICAqIEBwYXJhbSB7Kn0gW2RhdGE9e31dDQogICAgICogQHBhcmFtIHtib29sZWFufSBbaXNsb2FkaW5nXQ0KICAgICAqIEByZXR1cm5zIHtQcm9taXNlPGFueT59DQogICAgICogQG1lbWJlcm9mIEVudGl0eVNlcnZpY2UNCiAgICAgKi8KCiAgfSwgewogICAga2V5OiAiU2F2ZSIsCiAgICB2YWx1ZTogZnVuY3Rpb24gKCkgewogICAgICB2YXIgX1NhdmUgPSBfYXN5bmNUb0dlbmVyYXRvcigKICAgICAgLyojX19QVVJFX18qLwogICAgICByZWdlbmVyYXRvclJ1bnRpbWUubWFyayhmdW5jdGlvbiBfY2FsbGVlNygpIHsKICAgICAgICB2YXIgY29udGV4dCwKICAgICAgICAgICAgZGF0YSwKICAgICAgICAgICAgaXNsb2FkaW5nLAogICAgICAgICAgICBfYXJnczcgPSBhcmd1bWVudHM7CiAgICAgICAgcmV0dXJuIHJlZ2VuZXJhdG9yUnVudGltZS53cmFwKGZ1bmN0aW9uIF9jYWxsZWU3JChfY29udGV4dDcpIHsKICAgICAgICAgIHdoaWxlICgxKSB7CiAgICAgICAgICAgIHN3aXRjaCAoX2NvbnRleHQ3LnByZXYgPSBfY29udGV4dDcubmV4dCkgewogICAgICAgICAgICAgIGNhc2UgMDoKICAgICAgICAgICAgICAgIGNvbnRleHQgPSBfYXJnczcubGVuZ3RoID4gMCAmJiBfYXJnczdbMF0gIT09IHVuZGVmaW5lZCA/IF9hcmdzN1swXSA6IHt9OwogICAgICAgICAgICAgICAgZGF0YSA9IF9hcmdzNy5sZW5ndGggPiAxICYmIF9hcmdzN1sxXSAhPT0gdW5kZWZpbmVkID8gX2FyZ3M3WzFdIDoge307CiAgICAgICAgICAgICAgICBpc2xvYWRpbmcgPSBfYXJnczcubGVuZ3RoID4gMiA/IF9hcmdzN1syXSA6IHVuZGVmaW5lZDsKICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDcuYWJydXB0KCJyZXR1cm4iLCB7CiAgICAgICAgICAgICAgICAgIHN0YXR1czogNTAwLAogICAgICAgICAgICAgICAgICBkYXRhOiB7CiAgICAgICAgICAgICAgICAgICAgdGl0bGU6ICflpLHotKUnLAogICAgICAgICAgICAgICAgICAgIG1lc3NhZ2U6ICfpooTnva7lrp7kvZPooYzkuLogU2F2ZSDmnKrlrp7njrAnCiAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgICBjYXNlIDQ6CiAgICAgICAgICAgICAgY2FzZSAiZW5kIjoKICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDcuc3RvcCgpOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSwgX2NhbGxlZTcpOwogICAgICB9KSk7CgogICAgICBmdW5jdGlvbiBTYXZlKCkgewogICAgICAgIHJldHVybiBfU2F2ZS5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwogICAgICB9CgogICAgICByZXR1cm4gU2F2ZTsKICAgIH0oKQogICAgLyoqDQogICAgICogVXBkYXRlVGVtcOaOpeWPo+aWueazlQ0KICAgICAqDQogICAgICogQHBhcmFtIHsqfSBbY29udGV4dD17fV0NCiAgICAgKiBAcGFyYW0geyp9IFtkYXRhPXt9XQ0KICAgICAqIEBwYXJhbSB7Ym9vbGVhbn0gW2lzbG9hZGluZ10NCiAgICAgKiBAcmV0dXJucyB7UHJvbWlzZTxhbnk+fQ0KICAgICAqIEBtZW1iZXJvZiBFbnRpdHlTZXJ2aWNlDQogICAgICovCgogIH0sIHsKICAgIGtleTogIlVwZGF0ZVRlbXAiLAogICAgdmFsdWU6IGZ1bmN0aW9uICgpIHsKICAgICAgdmFyIF9VcGRhdGVUZW1wID0gX2FzeW5jVG9HZW5lcmF0b3IoCiAgICAgIC8qI19fUFVSRV9fKi8KICAgICAgcmVnZW5lcmF0b3JSdW50aW1lLm1hcmsoZnVuY3Rpb24gX2NhbGxlZTgoKSB7CiAgICAgICAgdmFyIF90aGlzMyA9IHRoaXM7CgogICAgICAgIHZhciBjb250ZXh0LAogICAgICAgICAgICBkYXRhLAogICAgICAgICAgICBpc2xvYWRpbmcsCiAgICAgICAgICAgIHJlc3VsdCwKICAgICAgICAgICAgdGVtcERhdGEsCiAgICAgICAgICAgIF9hcmdzOCA9IGFyZ3VtZW50czsKICAgICAgICByZXR1cm4gcmVnZW5lcmF0b3JSdW50aW1lLndyYXAoZnVuY3Rpb24gX2NhbGxlZTgkKF9jb250ZXh0OCkgewogICAgICAgICAgd2hpbGUgKDEpIHsKICAgICAgICAgICAgc3dpdGNoIChfY29udGV4dDgucHJldiA9IF9jb250ZXh0OC5uZXh0KSB7CiAgICAgICAgICAgICAgY2FzZSAwOgogICAgICAgICAgICAgICAgY29udGV4dCA9IF9hcmdzOC5sZW5ndGggPiAwICYmIF9hcmdzOFswXSAhPT0gdW5kZWZpbmVkID8gX2FyZ3M4WzBdIDoge307CiAgICAgICAgICAgICAgICBkYXRhID0gX2FyZ3M4Lmxlbmd0aCA+IDEgJiYgX2FyZ3M4WzFdICE9PSB1bmRlZmluZWQgPyBfYXJnczhbMV0gOiB7fTsKICAgICAgICAgICAgICAgIGlzbG9hZGluZyA9IF9hcmdzOC5sZW5ndGggPiAyID8gX2FyZ3M4WzJdIDogdW5kZWZpbmVkOwoKICAgICAgICAgICAgICAgIGlmICghKGNvbnRleHQuc3Jmc2Vzc2lvbmtleSAmJiAhT2JqZWN0LmlzKHRoaXMudGVtcFN0b3JhZ2UuZ2V0SXRlbShjb250ZXh0LnNyZnNlc3Npb25rZXkgKyAnXycgKyB0aGlzLkFQUERFTkFNRSksICd1bmRlZmluZWQnKSkpIHsKICAgICAgICAgICAgICAgICAgX2NvbnRleHQ4Lm5leHQgPSAxMzsKICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgcmVzdWx0ID0gSlNPTi5wYXJzZSh0aGlzLnRlbXBTdG9yYWdlLmdldEl0ZW0oY29udGV4dC5zcmZzZXNzaW9ua2V5ICsgJ18nICsgdGhpcy5BUFBERU5BTUUpKTsKICAgICAgICAgICAgICAgIHRlbXBEYXRhID0gW107CgogICAgICAgICAgICAgICAgaWYgKCEocmVzdWx0ICYmIHJlc3VsdC5sZW5ndGggPiAwKSkgewogICAgICAgICAgICAgICAgICBfY29udGV4dDgubmV4dCA9IDEyOwogICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICByZXN1bHQuZm9yRWFjaChmdW5jdGlvbiAoaXRlbSkgewogICAgICAgICAgICAgICAgICB2YXIgc2luZ2xlRGF0YSA9IHt9OwoKICAgICAgICAgICAgICAgICAgaWYgKE9iamVjdC5pcyhpdGVtW190aGlzMy5BUFBERUtFWV0sIGRhdGFbX3RoaXMzLkFQUERFS0VZXSkpIHsKICAgICAgICAgICAgICAgICAgICBPYmplY3Qua2V5cyhpdGVtKS5mb3JFYWNoKGZ1bmN0aW9uIChmaWVsZCkgewogICAgICAgICAgICAgICAgICAgICAgc2luZ2xlRGF0YVtmaWVsZF0gPSBkYXRhW2ZpZWxkXSA/IGRhdGFbZmllbGRdIDogaXRlbVtmaWVsZF07CiAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgIGlmIChPYmplY3Qua2V5cyhzaW5nbGVEYXRhKS5sZW5ndGggPiAwKSB7CiAgICAgICAgICAgICAgICAgICAgdGVtcERhdGEucHVzaChzaW5nbGVEYXRhKTsKICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICB0ZW1wRGF0YS5wdXNoKGl0ZW0pOwogICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIHRoaXMudGVtcFN0b3JhZ2Uuc2V0SXRlbShjb250ZXh0LnNyZnNlc3Npb25rZXkgKyAnXycgKyB0aGlzLkFQUERFTkFNRSwgSlNPTi5zdHJpbmdpZnkodGVtcERhdGEpKTsKICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDguYWJydXB0KCJyZXR1cm4iLCB7CiAgICAgICAgICAgICAgICAgICJzdGF0dXMiOiAyMDAsCiAgICAgICAgICAgICAgICAgICJkYXRhIjogZGF0YQogICAgICAgICAgICAgICAgfSk7CgogICAgICAgICAgICAgIGNhc2UgMTI6CiAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQ4LmFicnVwdCgicmV0dXJuIiwgewogICAgICAgICAgICAgICAgICAic3RhdHVzIjogNTAwLAogICAgICAgICAgICAgICAgICAiZGF0YSI6IG51bGwKICAgICAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgICBjYXNlIDEzOgogICAgICAgICAgICAgIGNhc2UgImVuZCI6CiAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQ4LnN0b3AoKTsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0sIF9jYWxsZWU4LCB0aGlzKTsKICAgICAgfSkpOwoKICAgICAgZnVuY3Rpb24gVXBkYXRlVGVtcCgpIHsKICAgICAgICByZXR1cm4gX1VwZGF0ZVRlbXAuYXBwbHkodGhpcywgYXJndW1lbnRzKTsKICAgICAgfQoKICAgICAgcmV0dXJuIFVwZGF0ZVRlbXA7CiAgICB9KCkKICAgIC8qKg0KICAgICAqIFJlbW92ZVRlbXDmjqXlj6Pmlrnms5UNCiAgICAgKg0KICAgICAqIEBwYXJhbSB7Kn0gW2NvbnRleHQ9e31dDQogICAgICogQHBhcmFtIHsqfSBbZGF0YT17fV0NCiAgICAgKiBAcGFyYW0ge2Jvb2xlYW59IFtpc2xvYWRpbmddDQogICAgICogQHJldHVybnMge1Byb21pc2U8YW55Pn0NCiAgICAgKiBAbWVtYmVyb2YgRW50aXR5U2VydmljZQ0KICAgICAqLwoKICB9LCB7CiAgICBrZXk6ICJSZW1vdmVUZW1wIiwKICAgIHZhbHVlOiBmdW5jdGlvbiAoKSB7CiAgICAgIHZhciBfUmVtb3ZlVGVtcCA9IF9hc3luY1RvR2VuZXJhdG9yKAogICAgICAvKiNfX1BVUkVfXyovCiAgICAgIHJlZ2VuZXJhdG9yUnVudGltZS5tYXJrKGZ1bmN0aW9uIF9jYWxsZWU5KCkgewogICAgICAgIHZhciBfdGhpczQgPSB0aGlzOwoKICAgICAgICB2YXIgY29udGV4dCwKICAgICAgICAgICAgZGF0YSwKICAgICAgICAgICAgaXNsb2FkaW5nLAogICAgICAgICAgICByZXN1bHQsCiAgICAgICAgICAgIHRlbXBSZXN1bHQsCiAgICAgICAgICAgIF9hcmdzOSA9IGFyZ3VtZW50czsKICAgICAgICByZXR1cm4gcmVnZW5lcmF0b3JSdW50aW1lLndyYXAoZnVuY3Rpb24gX2NhbGxlZTkkKF9jb250ZXh0OSkgewogICAgICAgICAgd2hpbGUgKDEpIHsKICAgICAgICAgICAgc3dpdGNoIChfY29udGV4dDkucHJldiA9IF9jb250ZXh0OS5uZXh0KSB7CiAgICAgICAgICAgICAgY2FzZSAwOgogICAgICAgICAgICAgICAgY29udGV4dCA9IF9hcmdzOS5sZW5ndGggPiAwICYmIF9hcmdzOVswXSAhPT0gdW5kZWZpbmVkID8gX2FyZ3M5WzBdIDoge307CiAgICAgICAgICAgICAgICBkYXRhID0gX2FyZ3M5Lmxlbmd0aCA+IDEgJiYgX2FyZ3M5WzFdICE9PSB1bmRlZmluZWQgPyBfYXJnczlbMV0gOiB7fTsKICAgICAgICAgICAgICAgIGlzbG9hZGluZyA9IF9hcmdzOS5sZW5ndGggPiAyID8gX2FyZ3M5WzJdIDogdW5kZWZpbmVkOwoKICAgICAgICAgICAgICAgIGlmICghKGNvbnRleHQuc3Jmc2Vzc2lvbmtleSAmJiAhT2JqZWN0LmlzKHRoaXMudGVtcFN0b3JhZ2UuZ2V0SXRlbShjb250ZXh0LnNyZnNlc3Npb25rZXkgKyAnXycgKyB0aGlzLkFQUERFTkFNRSksICd1bmRlZmluZWQnKSkpIHsKICAgICAgICAgICAgICAgICAgX2NvbnRleHQ5Lm5leHQgPSAxMjsKICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgcmVzdWx0ID0gSlNPTi5wYXJzZSh0aGlzLnRlbXBTdG9yYWdlLmdldEl0ZW0oY29udGV4dC5zcmZzZXNzaW9ua2V5ICsgJ18nICsgdGhpcy5BUFBERU5BTUUpKTsKCiAgICAgICAgICAgICAgICBpZiAoIXJlc3VsdCkgewogICAgICAgICAgICAgICAgICBfY29udGV4dDkubmV4dCA9IDExOwogICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICB0ZW1wUmVzdWx0ID0gcmVzdWx0LmZpbHRlcihmdW5jdGlvbiAoaXRlbSkgewogICAgICAgICAgICAgICAgICByZXR1cm4gIShPYmplY3QuaXMoaXRlbVtfdGhpczQuQVBQREVLRVldLCBkYXRhW190aGlzNC5BUFBERUtFWV0pICYmIE9iamVjdC5pcyhpdGVtW190aGlzNC5BUFBERVRFWFRdLCBkYXRhW190aGlzNC5BUFBERVRFWFRdKSk7CiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIHRoaXMudGVtcFN0b3JhZ2Uuc2V0SXRlbShjb250ZXh0LnNyZnNlc3Npb25rZXkgKyAnXycgKyB0aGlzLkFQUERFTkFNRSwgSlNPTi5zdHJpbmdpZnkodGVtcFJlc3VsdCkpOwogICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0OS5hYnJ1cHQoInJldHVybiIsIHsKICAgICAgICAgICAgICAgICAgInN0YXR1cyI6IDIwMCwKICAgICAgICAgICAgICAgICAgImRhdGEiOiBkYXRhCiAgICAgICAgICAgICAgICB9KTsKCiAgICAgICAgICAgICAgY2FzZSAxMToKICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDkuYWJydXB0KCJyZXR1cm4iLCB7CiAgICAgICAgICAgICAgICAgICJzdGF0dXMiOiA1MDAsCiAgICAgICAgICAgICAgICAgICJkYXRhIjogbnVsbAogICAgICAgICAgICAgICAgfSk7CgogICAgICAgICAgICAgIGNhc2UgMTI6CiAgICAgICAgICAgICAgY2FzZSAiZW5kIjoKICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDkuc3RvcCgpOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSwgX2NhbGxlZTksIHRoaXMpOwogICAgICB9KSk7CgogICAgICBmdW5jdGlvbiBSZW1vdmVUZW1wKCkgewogICAgICAgIHJldHVybiBfUmVtb3ZlVGVtcC5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwogICAgICB9CgogICAgICByZXR1cm4gUmVtb3ZlVGVtcDsKICAgIH0oKQogICAgLyoqDQogICAgICogQ2hlY2tLZXnmjqXlj6Pmlrnms5UNCiAgICAgKg0KICAgICAqIEBwYXJhbSB7Kn0gW2NvbnRleHQ9e31dDQogICAgICogQHBhcmFtIHsqfSBbZGF0YT17fV0NCiAgICAgKiBAcGFyYW0ge2Jvb2xlYW59IFtpc2xvYWRpbmddDQogICAgICogQHJldHVybnMge1Byb21pc2U8YW55Pn0NCiAgICAgKiBAbWVtYmVyb2YgRW50aXR5U2VydmljZQ0KICAgICAqLwoKICB9LCB7CiAgICBrZXk6ICJDaGVja0tleSIsCiAgICB2YWx1ZTogZnVuY3Rpb24gKCkgewogICAgICB2YXIgX0NoZWNrS2V5ID0gX2FzeW5jVG9HZW5lcmF0b3IoCiAgICAgIC8qI19fUFVSRV9fKi8KICAgICAgcmVnZW5lcmF0b3JSdW50aW1lLm1hcmsoZnVuY3Rpb24gX2NhbGxlZTEwKCkgewogICAgICAgIHZhciBfdGhpczUgPSB0aGlzOwoKICAgICAgICB2YXIgY29udGV4dCwKICAgICAgICAgICAgZGF0YSwKICAgICAgICAgICAgaXNsb2FkaW5nLAogICAgICAgICAgICByZXN1bHQsCiAgICAgICAgICAgIGZsYWcsCiAgICAgICAgICAgIF9hcmdzMTAgPSBhcmd1bWVudHM7CiAgICAgICAgcmV0dXJuIHJlZ2VuZXJhdG9yUnVudGltZS53cmFwKGZ1bmN0aW9uIF9jYWxsZWUxMCQoX2NvbnRleHQxMCkgewogICAgICAgICAgd2hpbGUgKDEpIHsKICAgICAgICAgICAgc3dpdGNoIChfY29udGV4dDEwLnByZXYgPSBfY29udGV4dDEwLm5leHQpIHsKICAgICAgICAgICAgICBjYXNlIDA6CiAgICAgICAgICAgICAgICBjb250ZXh0ID0gX2FyZ3MxMC5sZW5ndGggPiAwICYmIF9hcmdzMTBbMF0gIT09IHVuZGVmaW5lZCA/IF9hcmdzMTBbMF0gOiB7fTsKICAgICAgICAgICAgICAgIGRhdGEgPSBfYXJnczEwLmxlbmd0aCA+IDEgJiYgX2FyZ3MxMFsxXSAhPT0gdW5kZWZpbmVkID8gX2FyZ3MxMFsxXSA6IHt9OwogICAgICAgICAgICAgICAgaXNsb2FkaW5nID0gX2FyZ3MxMC5sZW5ndGggPiAyID8gX2FyZ3MxMFsyXSA6IHVuZGVmaW5lZDsKCiAgICAgICAgICAgICAgICBpZiAoIShjb250ZXh0LnNyZnNlc3Npb25rZXkgJiYgIU9iamVjdC5pcyh0aGlzLnRlbXBTdG9yYWdlLmdldEl0ZW0oY29udGV4dC5zcmZzZXNzaW9ua2V5ICsgJ18nICsgdGhpcy5BUFBERU5BTUUpLCAndW5kZWZpbmVkJykpKSB7CiAgICAgICAgICAgICAgICAgIF9jb250ZXh0MTAubmV4dCA9IDEyOwogICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICByZXN1bHQgPSBKU09OLnBhcnNlKHRoaXMudGVtcFN0b3JhZ2UuZ2V0SXRlbShjb250ZXh0LnNyZnNlc3Npb25rZXkgKyAnXycgKyB0aGlzLkFQUERFTkFNRSkpOwoKICAgICAgICAgICAgICAgIGlmICghcmVzdWx0KSB7CiAgICAgICAgICAgICAgICAgIF9jb250ZXh0MTAubmV4dCA9IDExOwogICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBmbGFnID0gZmFsc2U7CiAgICAgICAgICAgICAgICByZXN1bHQuZm9yRWFjaChmdW5jdGlvbiAoaXRlbSkgewogICAgICAgICAgICAgICAgICBpZiAoT2JqZWN0LmlzKGl0ZW1bX3RoaXM1LkFQUERFS0VZXSwgZGF0YVtfdGhpczUuQVBQREVLRVldKSkgewogICAgICAgICAgICAgICAgICAgIGZsYWcgPSB0cnVlOwogICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDEwLmFicnVwdCgicmV0dXJuIiwgewogICAgICAgICAgICAgICAgICAic3RhdHVzIjogMjAwLAogICAgICAgICAgICAgICAgICAiZGF0YSI6IGZsYWcKICAgICAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgICBjYXNlIDExOgogICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0MTAuYWJydXB0KCJyZXR1cm4iLCB7CiAgICAgICAgICAgICAgICAgICJzdGF0dXMiOiA1MDAsCiAgICAgICAgICAgICAgICAgICJkYXRhIjogbnVsbAogICAgICAgICAgICAgICAgfSk7CgogICAgICAgICAgICAgIGNhc2UgMTI6CiAgICAgICAgICAgICAgY2FzZSAiZW5kIjoKICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDEwLnN0b3AoKTsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0sIF9jYWxsZWUxMCwgdGhpcyk7CiAgICAgIH0pKTsKCiAgICAgIGZ1bmN0aW9uIENoZWNrS2V5KCkgewogICAgICAgIHJldHVybiBfQ2hlY2tLZXkuYXBwbHkodGhpcywgYXJndW1lbnRzKTsKICAgICAgfQoKICAgICAgcmV0dXJuIENoZWNrS2V5OwogICAgfSgpCiAgICAvKioNCiAgICAgKiBHZXREcmFmdOaOpeWPo+aWueazlQ0KICAgICAqDQogICAgICogQHBhcmFtIHsqfSBbY29udGV4dD17fV0NCiAgICAgKiBAcGFyYW0geyp9IFtkYXRhPXt9XQ0KICAgICAqIEBwYXJhbSB7Ym9vbGVhbn0gW2lzbG9hZGluZ10NCiAgICAgKiBAcmV0dXJucyB7UHJvbWlzZTxhbnk+fQ0KICAgICAqIEBtZW1iZXJvZiBFbnRpdHlTZXJ2aWNlDQogICAgICovCgogIH0sIHsKICAgIGtleTogIkdldERyYWZ0IiwKICAgIHZhbHVlOiBmdW5jdGlvbiAoKSB7CiAgICAgIHZhciBfR2V0RHJhZnQgPSBfYXN5bmNUb0dlbmVyYXRvcigKICAgICAgLyojX19QVVJFX18qLwogICAgICByZWdlbmVyYXRvclJ1bnRpbWUubWFyayhmdW5jdGlvbiBfY2FsbGVlMTEoKSB7CiAgICAgICAgdmFyIGNvbnRleHQsCiAgICAgICAgICAgIGRhdGEsCiAgICAgICAgICAgIGlzbG9hZGluZywKICAgICAgICAgICAgX2FyZ3MxMSA9IGFyZ3VtZW50czsKICAgICAgICByZXR1cm4gcmVnZW5lcmF0b3JSdW50aW1lLndyYXAoZnVuY3Rpb24gX2NhbGxlZTExJChfY29udGV4dDExKSB7CiAgICAgICAgICB3aGlsZSAoMSkgewogICAgICAgICAgICBzd2l0Y2ggKF9jb250ZXh0MTEucHJldiA9IF9jb250ZXh0MTEubmV4dCkgewogICAgICAgICAgICAgIGNhc2UgMDoKICAgICAgICAgICAgICAgIGNvbnRleHQgPSBfYXJnczExLmxlbmd0aCA+IDAgJiYgX2FyZ3MxMVswXSAhPT0gdW5kZWZpbmVkID8gX2FyZ3MxMVswXSA6IHt9OwogICAgICAgICAgICAgICAgZGF0YSA9IF9hcmdzMTEubGVuZ3RoID4gMSAmJiBfYXJnczExWzFdICE9PSB1bmRlZmluZWQgPyBfYXJnczExWzFdIDoge307CiAgICAgICAgICAgICAgICBpc2xvYWRpbmcgPSBfYXJnczExLmxlbmd0aCA+IDIgPyBfYXJnczExWzJdIDogdW5kZWZpbmVkOwogICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0MTEuYWJydXB0KCJyZXR1cm4iLCB0aGlzLkdldERyYWZ0VGVtcChjb250ZXh0LCBkYXRhLCBpc2xvYWRpbmcpKTsKCiAgICAgICAgICAgICAgY2FzZSA0OgogICAgICAgICAgICAgIGNhc2UgImVuZCI6CiAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQxMS5zdG9wKCk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9LCBfY2FsbGVlMTEsIHRoaXMpOwogICAgICB9KSk7CgogICAgICBmdW5jdGlvbiBHZXREcmFmdCgpIHsKICAgICAgICByZXR1cm4gX0dldERyYWZ0LmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7CiAgICAgIH0KCiAgICAgIHJldHVybiBHZXREcmFmdDsKICAgIH0oKQogICAgLyoqDQogICAgICogUmVtb3Zl5o6l5Y+j5pa55rOVDQogICAgICoNCiAgICAgKiBAcGFyYW0geyp9IFtjb250ZXh0PXt9XQ0KICAgICAqIEBwYXJhbSB7Kn0gW2RhdGE9e31dDQogICAgICogQHBhcmFtIHtib29sZWFufSBbaXNsb2FkaW5nXQ0KICAgICAqIEByZXR1cm5zIHtQcm9taXNlPGFueT59DQogICAgICogQG1lbWJlcm9mIEVudGl0eVNlcnZpY2UNCiAgICAgKi8KCiAgfSwgewogICAga2V5OiAiUmVtb3ZlIiwKICAgIHZhbHVlOiBmdW5jdGlvbiAoKSB7CiAgICAgIHZhciBfUmVtb3ZlID0gX2FzeW5jVG9HZW5lcmF0b3IoCiAgICAgIC8qI19fUFVSRV9fKi8KICAgICAgcmVnZW5lcmF0b3JSdW50aW1lLm1hcmsoZnVuY3Rpb24gX2NhbGxlZTEyKCkgewogICAgICAgIHZhciBjb250ZXh0LAogICAgICAgICAgICBkYXRhLAogICAgICAgICAgICBpc2xvYWRpbmcsCiAgICAgICAgICAgIF9hcmdzMTIgPSBhcmd1bWVudHM7CiAgICAgICAgcmV0dXJuIHJlZ2VuZXJhdG9yUnVudGltZS53cmFwKGZ1bmN0aW9uIF9jYWxsZWUxMiQoX2NvbnRleHQxMikgewogICAgICAgICAgd2hpbGUgKDEpIHsKICAgICAgICAgICAgc3dpdGNoIChfY29udGV4dDEyLnByZXYgPSBfY29udGV4dDEyLm5leHQpIHsKICAgICAgICAgICAgICBjYXNlIDA6CiAgICAgICAgICAgICAgICBjb250ZXh0ID0gX2FyZ3MxMi5sZW5ndGggPiAwICYmIF9hcmdzMTJbMF0gIT09IHVuZGVmaW5lZCA/IF9hcmdzMTJbMF0gOiB7fTsKICAgICAgICAgICAgICAgIGRhdGEgPSBfYXJnczEyLmxlbmd0aCA+IDEgJiYgX2FyZ3MxMlsxXSAhPT0gdW5kZWZpbmVkID8gX2FyZ3MxMlsxXSA6IHt9OwogICAgICAgICAgICAgICAgaXNsb2FkaW5nID0gX2FyZ3MxMi5sZW5ndGggPiAyID8gX2FyZ3MxMlsyXSA6IHVuZGVmaW5lZDsKICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDEyLmFicnVwdCgicmV0dXJuIiwgdGhpcy5SZW1vdmVUZW1wKGNvbnRleHQsIGRhdGEsIGlzbG9hZGluZykpOwoKICAgICAgICAgICAgICBjYXNlIDQ6CiAgICAgICAgICAgICAgY2FzZSAiZW5kIjoKICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDEyLnN0b3AoKTsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0sIF9jYWxsZWUxMiwgdGhpcyk7CiAgICAgIH0pKTsKCiAgICAgIGZ1bmN0aW9uIFJlbW92ZSgpIHsKICAgICAgICByZXR1cm4gX1JlbW92ZS5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwogICAgICB9CgogICAgICByZXR1cm4gUmVtb3ZlOwogICAgfSgpCiAgICAvKioNCiAgICAgKiBDcmVhdGVUZW1wTWFqb3LmjqXlj6Pmlrnms5UNCiAgICAgKg0KICAgICAqIEBwYXJhbSB7Kn0gW2NvbnRleHQ9e31dDQogICAgICogQHBhcmFtIHsqfSBbZGF0YT17fV0NCiAgICAgKiBAcGFyYW0ge2Jvb2xlYW59IFtpc2xvYWRpbmddDQogICAgICogQHJldHVybnMge1Byb21pc2U8YW55Pn0NCiAgICAgKiBAbWVtYmVyb2YgRW50aXR5U2VydmljZQ0KICAgICAqLwoKICB9LCB7CiAgICBrZXk6ICJDcmVhdGVUZW1wTWFqb3IiLAogICAgdmFsdWU6IGZ1bmN0aW9uICgpIHsKICAgICAgdmFyIF9DcmVhdGVUZW1wTWFqb3IgPSBfYXN5bmNUb0dlbmVyYXRvcigKICAgICAgLyojX19QVVJFX18qLwogICAgICByZWdlbmVyYXRvclJ1bnRpbWUubWFyayhmdW5jdGlvbiBfY2FsbGVlMTMoKSB7CiAgICAgICAgdmFyIGNvbnRleHQsCiAgICAgICAgICAgIGRhdGEsCiAgICAgICAgICAgIGlzbG9hZGluZywKICAgICAgICAgICAgX2FyZ3MxMyA9IGFyZ3VtZW50czsKICAgICAgICByZXR1cm4gcmVnZW5lcmF0b3JSdW50aW1lLndyYXAoZnVuY3Rpb24gX2NhbGxlZTEzJChfY29udGV4dDEzKSB7CiAgICAgICAgICB3aGlsZSAoMSkgewogICAgICAgICAgICBzd2l0Y2ggKF9jb250ZXh0MTMucHJldiA9IF9jb250ZXh0MTMubmV4dCkgewogICAgICAgICAgICAgIGNhc2UgMDoKICAgICAgICAgICAgICAgIGNvbnRleHQgPSBfYXJnczEzLmxlbmd0aCA+IDAgJiYgX2FyZ3MxM1swXSAhPT0gdW5kZWZpbmVkID8gX2FyZ3MxM1swXSA6IHt9OwogICAgICAgICAgICAgICAgZGF0YSA9IF9hcmdzMTMubGVuZ3RoID4gMSAmJiBfYXJnczEzWzFdICE9PSB1bmRlZmluZWQgPyBfYXJnczEzWzFdIDoge307CiAgICAgICAgICAgICAgICBpc2xvYWRpbmcgPSBfYXJnczEzLmxlbmd0aCA+IDIgPyBfYXJnczEzWzJdIDogdW5kZWZpbmVkOwogICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0MTMuYWJydXB0KCJyZXR1cm4iLCB0aGlzLkNyZWF0ZShjb250ZXh0LCBkYXRhLCBpc2xvYWRpbmcpKTsKCiAgICAgICAgICAgICAgY2FzZSA0OgogICAgICAgICAgICAgIGNhc2UgImVuZCI6CiAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQxMy5zdG9wKCk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9LCBfY2FsbGVlMTMsIHRoaXMpOwogICAgICB9KSk7CgogICAgICBmdW5jdGlvbiBDcmVhdGVUZW1wTWFqb3IoKSB7CiAgICAgICAgcmV0dXJuIF9DcmVhdGVUZW1wTWFqb3IuYXBwbHkodGhpcywgYXJndW1lbnRzKTsKICAgICAgfQoKICAgICAgcmV0dXJuIENyZWF0ZVRlbXBNYWpvcjsKICAgIH0oKQogICAgLyoqDQogICAgICogUmVtb3ZlVGVtcE1ham9y5o6l5Y+j5pa55rOVDQogICAgICoNCiAgICAgKiBAcGFyYW0geyp9IFtjb250ZXh0PXt9XQ0KICAgICAqIEBwYXJhbSB7Kn0gW2RhdGE9e31dDQogICAgICogQHBhcmFtIHtib29sZWFufSBbaXNsb2FkaW5nXQ0KICAgICAqIEByZXR1cm5zIHtQcm9taXNlPGFueT59DQogICAgICogQG1lbWJlcm9mIEVudGl0eVNlcnZpY2UNCiAgICAgKi8KCiAgfSwgewogICAga2V5OiAiUmVtb3ZlVGVtcE1ham9yIiwKICAgIHZhbHVlOiBmdW5jdGlvbiAoKSB7CiAgICAgIHZhciBfUmVtb3ZlVGVtcE1ham9yID0gX2FzeW5jVG9HZW5lcmF0b3IoCiAgICAgIC8qI19fUFVSRV9fKi8KICAgICAgcmVnZW5lcmF0b3JSdW50aW1lLm1hcmsoZnVuY3Rpb24gX2NhbGxlZTE0KCkgewogICAgICAgIHZhciBjb250ZXh0LAogICAgICAgICAgICBkYXRhLAogICAgICAgICAgICBpc2xvYWRpbmcsCiAgICAgICAgICAgIF9hcmdzMTQgPSBhcmd1bWVudHM7CiAgICAgICAgcmV0dXJuIHJlZ2VuZXJhdG9yUnVudGltZS53cmFwKGZ1bmN0aW9uIF9jYWxsZWUxNCQoX2NvbnRleHQxNCkgewogICAgICAgICAgd2hpbGUgKDEpIHsKICAgICAgICAgICAgc3dpdGNoIChfY29udGV4dDE0LnByZXYgPSBfY29udGV4dDE0Lm5leHQpIHsKICAgICAgICAgICAgICBjYXNlIDA6CiAgICAgICAgICAgICAgICBjb250ZXh0ID0gX2FyZ3MxNC5sZW5ndGggPiAwICYmIF9hcmdzMTRbMF0gIT09IHVuZGVmaW5lZCA/IF9hcmdzMTRbMF0gOiB7fTsKICAgICAgICAgICAgICAgIGRhdGEgPSBfYXJnczE0Lmxlbmd0aCA+IDEgJiYgX2FyZ3MxNFsxXSAhPT0gdW5kZWZpbmVkID8gX2FyZ3MxNFsxXSA6IHt9OwogICAgICAgICAgICAgICAgaXNsb2FkaW5nID0gX2FyZ3MxNC5sZW5ndGggPiAyID8gX2FyZ3MxNFsyXSA6IHVuZGVmaW5lZDsKICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDE0LmFicnVwdCgicmV0dXJuIiwgdGhpcy5SZW1vdmUoY29udGV4dCwgZGF0YSwgaXNsb2FkaW5nKSk7CgogICAgICAgICAgICAgIGNhc2UgNDoKICAgICAgICAgICAgICBjYXNlICJlbmQiOgogICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0MTQuc3RvcCgpOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSwgX2NhbGxlZTE0LCB0aGlzKTsKICAgICAgfSkpOwoKICAgICAgZnVuY3Rpb24gUmVtb3ZlVGVtcE1ham9yKCkgewogICAgICAgIHJldHVybiBfUmVtb3ZlVGVtcE1ham9yLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7CiAgICAgIH0KCiAgICAgIHJldHVybiBSZW1vdmVUZW1wTWFqb3I7CiAgICB9KCkKICAgIC8qKg0KICAgICAqIEdldOaOpeWPo+aWueazlQ0KICAgICAqDQogICAgICogQHBhcmFtIHsqfSBbY29udGV4dD17fV0NCiAgICAgKiBAcGFyYW0geyp9IFtkYXRhPXt9XQ0KICAgICAqIEBwYXJhbSB7Ym9vbGVhbn0gW2lzbG9hZGluZ10NCiAgICAgKiBAcmV0dXJucyB7UHJvbWlzZTxhbnk+fQ0KICAgICAqIEBtZW1iZXJvZiBFbnRpdHlTZXJ2aWNlDQogICAgICovCgogIH0sIHsKICAgIGtleTogIkdldCIsCiAgICB2YWx1ZTogZnVuY3Rpb24gKCkgewogICAgICB2YXIgX0dldCA9IF9hc3luY1RvR2VuZXJhdG9yKAogICAgICAvKiNfX1BVUkVfXyovCiAgICAgIHJlZ2VuZXJhdG9yUnVudGltZS5tYXJrKGZ1bmN0aW9uIF9jYWxsZWUxNSgpIHsKICAgICAgICB2YXIgY29udGV4dCwKICAgICAgICAgICAgZGF0YSwKICAgICAgICAgICAgaXNsb2FkaW5nLAogICAgICAgICAgICBfYXJnczE1ID0gYXJndW1lbnRzOwogICAgICAgIHJldHVybiByZWdlbmVyYXRvclJ1bnRpbWUud3JhcChmdW5jdGlvbiBfY2FsbGVlMTUkKF9jb250ZXh0MTUpIHsKICAgICAgICAgIHdoaWxlICgxKSB7CiAgICAgICAgICAgIHN3aXRjaCAoX2NvbnRleHQxNS5wcmV2ID0gX2NvbnRleHQxNS5uZXh0KSB7CiAgICAgICAgICAgICAgY2FzZSAwOgogICAgICAgICAgICAgICAgY29udGV4dCA9IF9hcmdzMTUubGVuZ3RoID4gMCAmJiBfYXJnczE1WzBdICE9PSB1bmRlZmluZWQgPyBfYXJnczE1WzBdIDoge307CiAgICAgICAgICAgICAgICBkYXRhID0gX2FyZ3MxNS5sZW5ndGggPiAxICYmIF9hcmdzMTVbMV0gIT09IHVuZGVmaW5lZCA/IF9hcmdzMTVbMV0gOiB7fTsKICAgICAgICAgICAgICAgIGlzbG9hZGluZyA9IF9hcmdzMTUubGVuZ3RoID4gMiA/IF9hcmdzMTVbMl0gOiB1bmRlZmluZWQ7CiAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQxNS5hYnJ1cHQoInJldHVybiIsIHRoaXMuR2V0VGVtcChjb250ZXh0LCBkYXRhLCBpc2xvYWRpbmcpKTsKCiAgICAgICAgICAgICAgY2FzZSA0OgogICAgICAgICAgICAgIGNhc2UgImVuZCI6CiAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQxNS5zdG9wKCk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9LCBfY2FsbGVlMTUsIHRoaXMpOwogICAgICB9KSk7CgogICAgICBmdW5jdGlvbiBHZXQoKSB7CiAgICAgICAgcmV0dXJuIF9HZXQuYXBwbHkodGhpcywgYXJndW1lbnRzKTsKICAgICAgfQoKICAgICAgcmV0dXJuIEdldDsKICAgIH0oKQogICAgLyoqDQogICAgICogR2V0RHJhZnRUZW1wTWFqb3LmjqXlj6Pmlrnms5UNCiAgICAgKg0KICAgICAqIEBwYXJhbSB7Kn0gW2NvbnRleHQ9e31dDQogICAgICogQHBhcmFtIHsqfSBbZGF0YT17fV0NCiAgICAgKiBAcGFyYW0ge2Jvb2xlYW59IFtpc2xvYWRpbmddDQogICAgICogQHJldHVybnMge1Byb21pc2U8YW55Pn0NCiAgICAgKiBAbWVtYmVyb2YgRW50aXR5U2VydmljZQ0KICAgICAqLwoKICB9LCB7CiAgICBrZXk6ICJHZXREcmFmdFRlbXBNYWpvciIsCiAgICB2YWx1ZTogZnVuY3Rpb24gKCkgewogICAgICB2YXIgX0dldERyYWZ0VGVtcE1ham9yID0gX2FzeW5jVG9HZW5lcmF0b3IoCiAgICAgIC8qI19fUFVSRV9fKi8KICAgICAgcmVnZW5lcmF0b3JSdW50aW1lLm1hcmsoZnVuY3Rpb24gX2NhbGxlZTE2KCkgewogICAgICAgIHZhciBjb250ZXh0LAogICAgICAgICAgICBkYXRhLAogICAgICAgICAgICBpc2xvYWRpbmcsCiAgICAgICAgICAgIF9hcmdzMTYgPSBhcmd1bWVudHM7CiAgICAgICAgcmV0dXJuIHJlZ2VuZXJhdG9yUnVudGltZS53cmFwKGZ1bmN0aW9uIF9jYWxsZWUxNiQoX2NvbnRleHQxNikgewogICAgICAgICAgd2hpbGUgKDEpIHsKICAgICAgICAgICAgc3dpdGNoIChfY29udGV4dDE2LnByZXYgPSBfY29udGV4dDE2Lm5leHQpIHsKICAgICAgICAgICAgICBjYXNlIDA6CiAgICAgICAgICAgICAgICBjb250ZXh0ID0gX2FyZ3MxNi5sZW5ndGggPiAwICYmIF9hcmdzMTZbMF0gIT09IHVuZGVmaW5lZCA/IF9hcmdzMTZbMF0gOiB7fTsKICAgICAgICAgICAgICAgIGRhdGEgPSBfYXJnczE2Lmxlbmd0aCA+IDEgJiYgX2FyZ3MxNlsxXSAhPT0gdW5kZWZpbmVkID8gX2FyZ3MxNlsxXSA6IHt9OwogICAgICAgICAgICAgICAgaXNsb2FkaW5nID0gX2FyZ3MxNi5sZW5ndGggPiAyID8gX2FyZ3MxNlsyXSA6IHVuZGVmaW5lZDsKICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDE2LmFicnVwdCgicmV0dXJuIiwgdGhpcy5HZXREcmFmdChjb250ZXh0LCBkYXRhLCBpc2xvYWRpbmcpKTsKCiAgICAgICAgICAgICAgY2FzZSA0OgogICAgICAgICAgICAgIGNhc2UgImVuZCI6CiAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQxNi5zdG9wKCk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9LCBfY2FsbGVlMTYsIHRoaXMpOwogICAgICB9KSk7CgogICAgICBmdW5jdGlvbiBHZXREcmFmdFRlbXBNYWpvcigpIHsKICAgICAgICByZXR1cm4gX0dldERyYWZ0VGVtcE1ham9yLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7CiAgICAgIH0KCiAgICAgIHJldHVybiBHZXREcmFmdFRlbXBNYWpvcjsKICAgIH0oKQogICAgLyoqDQogICAgICogQ3JlYXRl5o6l5Y+j5pa55rOVDQogICAgICoNCiAgICAgKiBAcGFyYW0geyp9IFtjb250ZXh0PXt9XQ0KICAgICAqIEBwYXJhbSB7Kn0gW2RhdGE9e31dDQogICAgICogQHBhcmFtIHtib29sZWFufSBbaXNsb2FkaW5nXQ0KICAgICAqIEByZXR1cm5zIHtQcm9taXNlPGFueT59DQogICAgICogQG1lbWJlcm9mIEVudGl0eVNlcnZpY2UNCiAgICAgKi8KCiAgfSwgewogICAga2V5OiAiQ3JlYXRlIiwKICAgIHZhbHVlOiBmdW5jdGlvbiAoKSB7CiAgICAgIHZhciBfQ3JlYXRlID0gX2FzeW5jVG9HZW5lcmF0b3IoCiAgICAgIC8qI19fUFVSRV9fKi8KICAgICAgcmVnZW5lcmF0b3JSdW50aW1lLm1hcmsoZnVuY3Rpb24gX2NhbGxlZTE3KCkgewogICAgICAgIHZhciBjb250ZXh0LAogICAgICAgICAgICBkYXRhLAogICAgICAgICAgICBpc2xvYWRpbmcsCiAgICAgICAgICAgIF9hcmdzMTcgPSBhcmd1bWVudHM7CiAgICAgICAgcmV0dXJuIHJlZ2VuZXJhdG9yUnVudGltZS53cmFwKGZ1bmN0aW9uIF9jYWxsZWUxNyQoX2NvbnRleHQxNykgewogICAgICAgICAgd2hpbGUgKDEpIHsKICAgICAgICAgICAgc3dpdGNoIChfY29udGV4dDE3LnByZXYgPSBfY29udGV4dDE3Lm5leHQpIHsKICAgICAgICAgICAgICBjYXNlIDA6CiAgICAgICAgICAgICAgICBjb250ZXh0ID0gX2FyZ3MxNy5sZW5ndGggPiAwICYmIF9hcmdzMTdbMF0gIT09IHVuZGVmaW5lZCA/IF9hcmdzMTdbMF0gOiB7fTsKICAgICAgICAgICAgICAgIGRhdGEgPSBfYXJnczE3Lmxlbmd0aCA+IDEgJiYgX2FyZ3MxN1sxXSAhPT0gdW5kZWZpbmVkID8gX2FyZ3MxN1sxXSA6IHt9OwogICAgICAgICAgICAgICAgaXNsb2FkaW5nID0gX2FyZ3MxNy5sZW5ndGggPiAyID8gX2FyZ3MxN1syXSA6IHVuZGVmaW5lZDsKICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDE3LmFicnVwdCgicmV0dXJuIiwgdGhpcy5DcmVhdGVUZW1wKGNvbnRleHQsIGRhdGEsIGlzbG9hZGluZykpOwoKICAgICAgICAgICAgICBjYXNlIDQ6CiAgICAgICAgICAgICAgY2FzZSAiZW5kIjoKICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDE3LnN0b3AoKTsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0sIF9jYWxsZWUxNywgdGhpcyk7CiAgICAgIH0pKTsKCiAgICAgIGZ1bmN0aW9uIENyZWF0ZSgpIHsKICAgICAgICByZXR1cm4gX0NyZWF0ZS5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwogICAgICB9CgogICAgICByZXR1cm4gQ3JlYXRlOwogICAgfSgpCiAgICAvKioNCiAgICAgKiBHZXRUZW1wTWFqb3LmjqXlj6Pmlrnms5UNCiAgICAgKg0KICAgICAqIEBwYXJhbSB7Kn0gW2NvbnRleHQ9e31dDQogICAgICogQHBhcmFtIHsqfSBbZGF0YT17fV0NCiAgICAgKiBAcGFyYW0ge2Jvb2xlYW59IFtpc2xvYWRpbmddDQogICAgICogQHJldHVybnMge1Byb21pc2U8YW55Pn0NCiAgICAgKiBAbWVtYmVyb2YgRW50aXR5U2VydmljZQ0KICAgICAqLwoKICB9LCB7CiAgICBrZXk6ICJHZXRUZW1wTWFqb3IiLAogICAgdmFsdWU6IGZ1bmN0aW9uICgpIHsKICAgICAgdmFyIF9HZXRUZW1wTWFqb3IgPSBfYXN5bmNUb0dlbmVyYXRvcigKICAgICAgLyojX19QVVJFX18qLwogICAgICByZWdlbmVyYXRvclJ1bnRpbWUubWFyayhmdW5jdGlvbiBfY2FsbGVlMTgoKSB7CiAgICAgICAgdmFyIGNvbnRleHQsCiAgICAgICAgICAgIGRhdGEsCiAgICAgICAgICAgIGlzbG9hZGluZywKICAgICAgICAgICAgX2FyZ3MxOCA9IGFyZ3VtZW50czsKICAgICAgICByZXR1cm4gcmVnZW5lcmF0b3JSdW50aW1lLndyYXAoZnVuY3Rpb24gX2NhbGxlZTE4JChfY29udGV4dDE4KSB7CiAgICAgICAgICB3aGlsZSAoMSkgewogICAgICAgICAgICBzd2l0Y2ggKF9jb250ZXh0MTgucHJldiA9IF9jb250ZXh0MTgubmV4dCkgewogICAgICAgICAgICAgIGNhc2UgMDoKICAgICAgICAgICAgICAgIGNvbnRleHQgPSBfYXJnczE4Lmxlbmd0aCA+IDAgJiYgX2FyZ3MxOFswXSAhPT0gdW5kZWZpbmVkID8gX2FyZ3MxOFswXSA6IHt9OwogICAgICAgICAgICAgICAgZGF0YSA9IF9hcmdzMTgubGVuZ3RoID4gMSAmJiBfYXJnczE4WzFdICE9PSB1bmRlZmluZWQgPyBfYXJnczE4WzFdIDoge307CiAgICAgICAgICAgICAgICBpc2xvYWRpbmcgPSBfYXJnczE4Lmxlbmd0aCA+IDIgPyBfYXJnczE4WzJdIDogdW5kZWZpbmVkOwogICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0MTguYWJydXB0KCJyZXR1cm4iLCB0aGlzLkdldChjb250ZXh0LCBkYXRhLCBpc2xvYWRpbmcpKTsKCiAgICAgICAgICAgICAgY2FzZSA0OgogICAgICAgICAgICAgIGNhc2UgImVuZCI6CiAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQxOC5zdG9wKCk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9LCBfY2FsbGVlMTgsIHRoaXMpOwogICAgICB9KSk7CgogICAgICBmdW5jdGlvbiBHZXRUZW1wTWFqb3IoKSB7CiAgICAgICAgcmV0dXJuIF9HZXRUZW1wTWFqb3IuYXBwbHkodGhpcywgYXJndW1lbnRzKTsKICAgICAgfQoKICAgICAgcmV0dXJuIEdldFRlbXBNYWpvcjsKICAgIH0oKQogICAgLyoqDQogICAgICogR2V0RHJhZnRUZW1w5o6l5Y+j5pa55rOVDQogICAgICoNCiAgICAgKiBAcGFyYW0geyp9IFtjb250ZXh0PXt9XQ0KICAgICAqIEBwYXJhbSB7Kn0gW2RhdGE9e31dDQogICAgICogQHBhcmFtIHtib29sZWFufSBbaXNsb2FkaW5nXQ0KICAgICAqIEByZXR1cm5zIHtQcm9taXNlPGFueT59DQogICAgICogQG1lbWJlcm9mIEVudGl0eVNlcnZpY2UNCiAgICAgKi8KCiAgfSwgewogICAga2V5OiAiR2V0RHJhZnRUZW1wIiwKICAgIHZhbHVlOiBmdW5jdGlvbiAoKSB7CiAgICAgIHZhciBfR2V0RHJhZnRUZW1wID0gX2FzeW5jVG9HZW5lcmF0b3IoCiAgICAgIC8qI19fUFVSRV9fKi8KICAgICAgcmVnZW5lcmF0b3JSdW50aW1lLm1hcmsoZnVuY3Rpb24gX2NhbGxlZTE5KCkgewogICAgICAgIHZhciBjb250ZXh0LAogICAgICAgICAgICBkYXRhLAogICAgICAgICAgICBpc2xvYWRpbmcsCiAgICAgICAgICAgIHRlbXBEYXRhLAogICAgICAgICAgICBfYXJnczE5ID0gYXJndW1lbnRzOwogICAgICAgIHJldHVybiByZWdlbmVyYXRvclJ1bnRpbWUud3JhcChmdW5jdGlvbiBfY2FsbGVlMTkkKF9jb250ZXh0MTkpIHsKICAgICAgICAgIHdoaWxlICgxKSB7CiAgICAgICAgICAgIHN3aXRjaCAoX2NvbnRleHQxOS5wcmV2ID0gX2NvbnRleHQxOS5uZXh0KSB7CiAgICAgICAgICAgICAgY2FzZSAwOgogICAgICAgICAgICAgICAgY29udGV4dCA9IF9hcmdzMTkubGVuZ3RoID4gMCAmJiBfYXJnczE5WzBdICE9PSB1bmRlZmluZWQgPyBfYXJnczE5WzBdIDoge307CiAgICAgICAgICAgICAgICBkYXRhID0gX2FyZ3MxOS5sZW5ndGggPiAxICYmIF9hcmdzMTlbMV0gIT09IHVuZGVmaW5lZCA/IF9hcmdzMTlbMV0gOiB7fTsKICAgICAgICAgICAgICAgIGlzbG9hZGluZyA9IF9hcmdzMTkubGVuZ3RoID4gMiA/IF9hcmdzMTlbMl0gOiB1bmRlZmluZWQ7CiAgICAgICAgICAgICAgICB0ZW1wRGF0YSA9IHsKICAgICAgICAgICAgICAgICAgc3Jmc2Vzc2lvbmtleTogY29udGV4dC5zcmZzZXNzaW9ua2V5CiAgICAgICAgICAgICAgICB9OwogICAgICAgICAgICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KHRlbXBEYXRhLCB0aGlzLkFQUERFS0VZLCB7CiAgICAgICAgICAgICAgICAgIGVudW1lcmFibGU6IHRydWUsCiAgICAgICAgICAgICAgICAgIHZhbHVlOiBkYXRhW3RoaXMuQVBQREVLRVldCiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIE9iamVjdC5hc3NpZ24oZGF0YSwgdGVtcERhdGEpOwogICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0MTkuYWJydXB0KCJyZXR1cm4iLCB7CiAgICAgICAgICAgICAgICAgICJzdGF0dXMiOiAyMDAsCiAgICAgICAgICAgICAgICAgICJkYXRhIjogZGF0YQogICAgICAgICAgICAgICAgfSk7CgogICAgICAgICAgICAgIGNhc2UgNzoKICAgICAgICAgICAgICBjYXNlICJlbmQiOgogICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0MTkuc3RvcCgpOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSwgX2NhbGxlZTE5LCB0aGlzKTsKICAgICAgfSkpOwoKICAgICAgZnVuY3Rpb24gR2V0RHJhZnRUZW1wKCkgewogICAgICAgIHJldHVybiBfR2V0RHJhZnRUZW1wLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7CiAgICAgIH0KCiAgICAgIHJldHVybiBHZXREcmFmdFRlbXA7CiAgICB9KCkKICAgIC8qKg0KICAgICAqIEZldGNoRGVmYXVsdOaOpeWPo+aWueazlQ0KICAgICAqDQogICAgICogQHBhcmFtIHsqfSBbY29udGV4dD17fV0NCiAgICAgKiBAcGFyYW0geyp9IFtkYXRhPXt9XQ0KICAgICAqIEBwYXJhbSB7Ym9vbGVhbn0gW2lzbG9hZGluZ10NCiAgICAgKiBAcmV0dXJucyB7UHJvbWlzZTxhbnk+fQ0KICAgICAqIEBtZW1iZXJvZiBFbnRpdHlTZXJ2aWNlDQogICAgICovCgogIH0sIHsKICAgIGtleTogIkZldGNoRGVmYXVsdCIsCiAgICB2YWx1ZTogZnVuY3Rpb24gKCkgewogICAgICB2YXIgX0ZldGNoRGVmYXVsdCA9IF9hc3luY1RvR2VuZXJhdG9yKAogICAgICAvKiNfX1BVUkVfXyovCiAgICAgIHJlZ2VuZXJhdG9yUnVudGltZS5tYXJrKGZ1bmN0aW9uIF9jYWxsZWUyMCgpIHsKICAgICAgICB2YXIgY29udGV4dCwKICAgICAgICAgICAgZGF0YSwKICAgICAgICAgICAgaXNsb2FkaW5nLAogICAgICAgICAgICBfYXJnczIwID0gYXJndW1lbnRzOwogICAgICAgIHJldHVybiByZWdlbmVyYXRvclJ1bnRpbWUud3JhcChmdW5jdGlvbiBfY2FsbGVlMjAkKF9jb250ZXh0MjApIHsKICAgICAgICAgIHdoaWxlICgxKSB7CiAgICAgICAgICAgIHN3aXRjaCAoX2NvbnRleHQyMC5wcmV2ID0gX2NvbnRleHQyMC5uZXh0KSB7CiAgICAgICAgICAgICAgY2FzZSAwOgogICAgICAgICAgICAgICAgY29udGV4dCA9IF9hcmdzMjAubGVuZ3RoID4gMCAmJiBfYXJnczIwWzBdICE9PSB1bmRlZmluZWQgPyBfYXJnczIwWzBdIDoge307CiAgICAgICAgICAgICAgICBkYXRhID0gX2FyZ3MyMC5sZW5ndGggPiAxICYmIF9hcmdzMjBbMV0gIT09IHVuZGVmaW5lZCA/IF9hcmdzMjBbMV0gOiB7fTsKICAgICAgICAgICAgICAgIGlzbG9hZGluZyA9IF9hcmdzMjAubGVuZ3RoID4gMiA/IF9hcmdzMjBbMl0gOiB1bmRlZmluZWQ7CiAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQyMC5hYnJ1cHQoInJldHVybiIsIHsKICAgICAgICAgICAgICAgICAgc3RhdHVzOiA1MDAsCiAgICAgICAgICAgICAgICAgIGRhdGE6IHsKICAgICAgICAgICAgICAgICAgICB0aXRsZTogJ+Wksei0pScsCiAgICAgICAgICAgICAgICAgICAgbWVzc2FnZTogJ+mihOe9ruWunuS9k+ihjOS4uiBGZXRjaERlZmF1bHQg5pyq5a6e546wJwogICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9KTsKCiAgICAgICAgICAgICAgY2FzZSA0OgogICAgICAgICAgICAgIGNhc2UgImVuZCI6CiAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQyMC5zdG9wKCk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9LCBfY2FsbGVlMjApOwogICAgICB9KSk7CgogICAgICBmdW5jdGlvbiBGZXRjaERlZmF1bHQoKSB7CiAgICAgICAgcmV0dXJuIF9GZXRjaERlZmF1bHQuYXBwbHkodGhpcywgYXJndW1lbnRzKTsKICAgICAgfQoKICAgICAgcmV0dXJuIEZldGNoRGVmYXVsdDsKICAgIH0oKQogICAgLyoqDQogICAgICogRmV0Y2hUZW1wRGVmYXVsdOaOpeWPo+aWueazlQ0KICAgICAqDQogICAgICogQHBhcmFtIHsqfSBbY29udGV4dD17fV0NCiAgICAgKiBAcGFyYW0geyp9IFtkYXRhPXt9XQ0KICAgICAqIEBwYXJhbSB7Ym9vbGVhbn0gW2lzbG9hZGluZ10NCiAgICAgKiBAcmV0dXJucyB7UHJvbWlzZTxhbnk+fQ0KICAgICAqIEBtZW1iZXJvZiBFbnRpdHlTZXJ2aWNlDQogICAgICovCgogIH0sIHsKICAgIGtleTogIkZldGNoVGVtcERlZmF1bHQiLAogICAgdmFsdWU6IGZ1bmN0aW9uICgpIHsKICAgICAgdmFyIF9GZXRjaFRlbXBEZWZhdWx0ID0gX2FzeW5jVG9HZW5lcmF0b3IoCiAgICAgIC8qI19fUFVSRV9fKi8KICAgICAgcmVnZW5lcmF0b3JSdW50aW1lLm1hcmsoZnVuY3Rpb24gX2NhbGxlZTIxKCkgewogICAgICAgIHZhciBjb250ZXh0LAogICAgICAgICAgICBkYXRhLAogICAgICAgICAgICBpc2xvYWRpbmcsCiAgICAgICAgICAgIF9hcmdzMjEgPSBhcmd1bWVudHM7CiAgICAgICAgcmV0dXJuIHJlZ2VuZXJhdG9yUnVudGltZS53cmFwKGZ1bmN0aW9uIF9jYWxsZWUyMSQoX2NvbnRleHQyMSkgewogICAgICAgICAgd2hpbGUgKDEpIHsKICAgICAgICAgICAgc3dpdGNoIChfY29udGV4dDIxLnByZXYgPSBfY29udGV4dDIxLm5leHQpIHsKICAgICAgICAgICAgICBjYXNlIDA6CiAgICAgICAgICAgICAgICBjb250ZXh0ID0gX2FyZ3MyMS5sZW5ndGggPiAwICYmIF9hcmdzMjFbMF0gIT09IHVuZGVmaW5lZCA/IF9hcmdzMjFbMF0gOiB7fTsKICAgICAgICAgICAgICAgIGRhdGEgPSBfYXJnczIxLmxlbmd0aCA+IDEgJiYgX2FyZ3MyMVsxXSAhPT0gdW5kZWZpbmVkID8gX2FyZ3MyMVsxXSA6IHt9OwogICAgICAgICAgICAgICAgaXNsb2FkaW5nID0gX2FyZ3MyMS5sZW5ndGggPiAyID8gX2FyZ3MyMVsyXSA6IHVuZGVmaW5lZDsKICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDIxLmFicnVwdCgicmV0dXJuIiwgewogICAgICAgICAgICAgICAgICBzdGF0dXM6IDUwMCwKICAgICAgICAgICAgICAgICAgZGF0YTogewogICAgICAgICAgICAgICAgICAgIHRpdGxlOiAn5aSx6LSlJywKICAgICAgICAgICAgICAgICAgICBtZXNzYWdlOiAn6aKE572u5a6e5L2T6KGM5Li6IEZldGNoRGVmYXVsdCDmnKrlrp7njrAnCiAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgICBjYXNlIDQ6CiAgICAgICAgICAgICAgY2FzZSAiZW5kIjoKICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDIxLnN0b3AoKTsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0sIF9jYWxsZWUyMSk7CiAgICAgIH0pKTsKCiAgICAgIGZ1bmN0aW9uIEZldGNoVGVtcERlZmF1bHQoKSB7CiAgICAgICAgcmV0dXJuIF9GZXRjaFRlbXBEZWZhdWx0LmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7CiAgICAgIH0KCiAgICAgIHJldHVybiBGZXRjaFRlbXBEZWZhdWx0OwogICAgfSgpCiAgICAvKioNCiAgICAgKiBGaWx0ZXJVcGRhdGXmjqXlj6Pmlrnms5UNCiAgICAgKg0KICAgICAqIEBwYXJhbSB7Kn0gW2NvbnRleHQ9e31dDQogICAgICogQHBhcmFtIHsqfSBbZGF0YT17fV0NCiAgICAgKiBAcGFyYW0ge2Jvb2xlYW59IFtpc2xvYWRpbmddDQogICAgICogQHJldHVybnMge1Byb21pc2U8YW55Pn0NCiAgICAgKiBAbWVtYmVyb2YgRW50aXR5U2VydmljZQ0KICAgICAqLwoKICB9LCB7CiAgICBrZXk6ICJGaWx0ZXJVcGRhdGUiLAogICAgdmFsdWU6IGZ1bmN0aW9uICgpIHsKICAgICAgdmFyIF9GaWx0ZXJVcGRhdGUgPSBfYXN5bmNUb0dlbmVyYXRvcigKICAgICAgLyojX19QVVJFX18qLwogICAgICByZWdlbmVyYXRvclJ1bnRpbWUubWFyayhmdW5jdGlvbiBfY2FsbGVlMjIoKSB7CiAgICAgICAgdmFyIGNvbnRleHQsCiAgICAgICAgICAgIGRhdGEsCiAgICAgICAgICAgIGlzbG9hZGluZywKICAgICAgICAgICAgX2FyZ3MyMiA9IGFyZ3VtZW50czsKICAgICAgICByZXR1cm4gcmVnZW5lcmF0b3JSdW50aW1lLndyYXAoZnVuY3Rpb24gX2NhbGxlZTIyJChfY29udGV4dDIyKSB7CiAgICAgICAgICB3aGlsZSAoMSkgewogICAgICAgICAgICBzd2l0Y2ggKF9jb250ZXh0MjIucHJldiA9IF9jb250ZXh0MjIubmV4dCkgewogICAgICAgICAgICAgIGNhc2UgMDoKICAgICAgICAgICAgICAgIGNvbnRleHQgPSBfYXJnczIyLmxlbmd0aCA+IDAgJiYgX2FyZ3MyMlswXSAhPT0gdW5kZWZpbmVkID8gX2FyZ3MyMlswXSA6IHt9OwogICAgICAgICAgICAgICAgZGF0YSA9IF9hcmdzMjIubGVuZ3RoID4gMSAmJiBfYXJnczIyWzFdICE9PSB1bmRlZmluZWQgPyBfYXJnczIyWzFdIDoge307CiAgICAgICAgICAgICAgICBpc2xvYWRpbmcgPSBfYXJnczIyLmxlbmd0aCA+IDIgPyBfYXJnczIyWzJdIDogdW5kZWZpbmVkOwogICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0MjIuYWJydXB0KCJyZXR1cm4iLCB0aGlzLlVwZGF0ZShjb250ZXh0LCBkYXRhLCBpc2xvYWRpbmcpKTsKCiAgICAgICAgICAgICAgY2FzZSA0OgogICAgICAgICAgICAgIGNhc2UgImVuZCI6CiAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQyMi5zdG9wKCk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9LCBfY2FsbGVlMjIsIHRoaXMpOwogICAgICB9KSk7CgogICAgICBmdW5jdGlvbiBGaWx0ZXJVcGRhdGUoKSB7CiAgICAgICAgcmV0dXJuIF9GaWx0ZXJVcGRhdGUuYXBwbHkodGhpcywgYXJndW1lbnRzKTsKICAgICAgfQoKICAgICAgcmV0dXJuIEZpbHRlclVwZGF0ZTsKICAgIH0oKQogICAgLyoqDQogICAgICogRmlsdGVyU2VhcmNo5o6l5Y+j5pa55rOVDQogICAgICoNCiAgICAgKiBAcGFyYW0geyp9IFtjb250ZXh0PXt9XQ0KICAgICAqIEBwYXJhbSB7Kn0gW2RhdGE9e31dDQogICAgICogQHBhcmFtIHtib29sZWFufSBbaXNsb2FkaW5nXQ0KICAgICAqIEByZXR1cm5zIHtQcm9taXNlPGFueT59DQogICAgICogQG1lbWJlcm9mIEVudGl0eVNlcnZpY2UNCiAgICAgKi8KCiAgfSwgewogICAga2V5OiAiRmlsdGVyU2VhcmNoIiwKICAgIHZhbHVlOiBmdW5jdGlvbiAoKSB7CiAgICAgIHZhciBfRmlsdGVyU2VhcmNoID0gX2FzeW5jVG9HZW5lcmF0b3IoCiAgICAgIC8qI19fUFVSRV9fKi8KICAgICAgcmVnZW5lcmF0b3JSdW50aW1lLm1hcmsoZnVuY3Rpb24gX2NhbGxlZTIzKCkgewogICAgICAgIHZhciBjb250ZXh0LAogICAgICAgICAgICBkYXRhLAogICAgICAgICAgICBpc2xvYWRpbmcsCiAgICAgICAgICAgIF9hcmdzMjMgPSBhcmd1bWVudHM7CiAgICAgICAgcmV0dXJuIHJlZ2VuZXJhdG9yUnVudGltZS53cmFwKGZ1bmN0aW9uIF9jYWxsZWUyMyQoX2NvbnRleHQyMykgewogICAgICAgICAgd2hpbGUgKDEpIHsKICAgICAgICAgICAgc3dpdGNoIChfY29udGV4dDIzLnByZXYgPSBfY29udGV4dDIzLm5leHQpIHsKICAgICAgICAgICAgICBjYXNlIDA6CiAgICAgICAgICAgICAgICBjb250ZXh0ID0gX2FyZ3MyMy5sZW5ndGggPiAwICYmIF9hcmdzMjNbMF0gIT09IHVuZGVmaW5lZCA/IF9hcmdzMjNbMF0gOiB7fTsKICAgICAgICAgICAgICAgIGRhdGEgPSBfYXJnczIzLmxlbmd0aCA+IDEgJiYgX2FyZ3MyM1sxXSAhPT0gdW5kZWZpbmVkID8gX2FyZ3MyM1sxXSA6IHt9OwogICAgICAgICAgICAgICAgaXNsb2FkaW5nID0gX2FyZ3MyMy5sZW5ndGggPiAyID8gX2FyZ3MyM1syXSA6IHVuZGVmaW5lZDsKICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDIzLmFicnVwdCgicmV0dXJuIiwgdGhpcy5GZXRjaERlZmF1bHQoY29udGV4dCwgZGF0YSwgaXNsb2FkaW5nKSk7CgogICAgICAgICAgICAgIGNhc2UgNDoKICAgICAgICAgICAgICBjYXNlICJlbmQiOgogICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0MjMuc3RvcCgpOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSwgX2NhbGxlZTIzLCB0aGlzKTsKICAgICAgfSkpOwoKICAgICAgZnVuY3Rpb24gRmlsdGVyU2VhcmNoKCkgewogICAgICAgIHJldHVybiBfRmlsdGVyU2VhcmNoLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7CiAgICAgIH0KCiAgICAgIHJldHVybiBGaWx0ZXJTZWFyY2g7CiAgICB9KCkKICAgIC8qKg0KICAgICAqIEZpbHRlckdldOaOpeWPo+aWueazlQ0KICAgICAqDQogICAgICogQHBhcmFtIHsqfSBbY29udGV4dD17fV0NCiAgICAgKiBAcGFyYW0geyp9IFtkYXRhPXt9XQ0KICAgICAqIEBwYXJhbSB7Ym9vbGVhbn0gW2lzbG9hZGluZ10NCiAgICAgKiBAcmV0dXJucyB7UHJvbWlzZTxhbnk+fQ0KICAgICAqIEBtZW1iZXJvZiBFbnRpdHlTZXJ2aWNlDQogICAgICovCgogIH0sIHsKICAgIGtleTogIkZpbHRlckdldCIsCiAgICB2YWx1ZTogZnVuY3Rpb24gKCkgewogICAgICB2YXIgX0ZpbHRlckdldCA9IF9hc3luY1RvR2VuZXJhdG9yKAogICAgICAvKiNfX1BVUkVfXyovCiAgICAgIHJlZ2VuZXJhdG9yUnVudGltZS5tYXJrKGZ1bmN0aW9uIF9jYWxsZWUyNCgpIHsKICAgICAgICB2YXIgY29udGV4dCwKICAgICAgICAgICAgZGF0YSwKICAgICAgICAgICAgaXNsb2FkaW5nLAogICAgICAgICAgICBfYXJnczI0ID0gYXJndW1lbnRzOwogICAgICAgIHJldHVybiByZWdlbmVyYXRvclJ1bnRpbWUud3JhcChmdW5jdGlvbiBfY2FsbGVlMjQkKF9jb250ZXh0MjQpIHsKICAgICAgICAgIHdoaWxlICgxKSB7CiAgICAgICAgICAgIHN3aXRjaCAoX2NvbnRleHQyNC5wcmV2ID0gX2NvbnRleHQyNC5uZXh0KSB7CiAgICAgICAgICAgICAgY2FzZSAwOgogICAgICAgICAgICAgICAgY29udGV4dCA9IF9hcmdzMjQubGVuZ3RoID4gMCAmJiBfYXJnczI0WzBdICE9PSB1bmRlZmluZWQgPyBfYXJnczI0WzBdIDoge307CiAgICAgICAgICAgICAgICBkYXRhID0gX2FyZ3MyNC5sZW5ndGggPiAxICYmIF9hcmdzMjRbMV0gIT09IHVuZGVmaW5lZCA/IF9hcmdzMjRbMV0gOiB7fTsKICAgICAgICAgICAgICAgIGlzbG9hZGluZyA9IF9hcmdzMjQubGVuZ3RoID4gMiA/IF9hcmdzMjRbMl0gOiB1bmRlZmluZWQ7CiAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQyNC5hYnJ1cHQoInJldHVybiIsIHRoaXMuR2V0KGNvbnRleHQsIGRhdGEsIGlzbG9hZGluZykpOwoKICAgICAgICAgICAgICBjYXNlIDQ6CiAgICAgICAgICAgICAgY2FzZSAiZW5kIjoKICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDI0LnN0b3AoKTsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0sIF9jYWxsZWUyNCwgdGhpcyk7CiAgICAgIH0pKTsKCiAgICAgIGZ1bmN0aW9uIEZpbHRlckdldCgpIHsKICAgICAgICByZXR1cm4gX0ZpbHRlckdldC5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwogICAgICB9CgogICAgICByZXR1cm4gRmlsdGVyR2V0OwogICAgfSgpCiAgICAvKioNCiAgICAgKiBGaWx0ZXJDcmVhdGXmjqXlj6Pmlrnms5UNCiAgICAgKg0KICAgICAqIEBwYXJhbSB7Kn0gW2NvbnRleHQ9e31dDQogICAgICogQHBhcmFtIHsqfSBbZGF0YT17fV0NCiAgICAgKiBAcGFyYW0ge2Jvb2xlYW59IFtpc2xvYWRpbmddDQogICAgICogQHJldHVybnMge1Byb21pc2U8YW55Pn0NCiAgICAgKiBAbWVtYmVyb2YgRW50aXR5U2VydmljZQ0KICAgICAqLwoKICB9LCB7CiAgICBrZXk6ICJGaWx0ZXJDcmVhdGUiLAogICAgdmFsdWU6IGZ1bmN0aW9uICgpIHsKICAgICAgdmFyIF9GaWx0ZXJDcmVhdGUgPSBfYXN5bmNUb0dlbmVyYXRvcigKICAgICAgLyojX19QVVJFX18qLwogICAgICByZWdlbmVyYXRvclJ1bnRpbWUubWFyayhmdW5jdGlvbiBfY2FsbGVlMjUoKSB7CiAgICAgICAgdmFyIGNvbnRleHQsCiAgICAgICAgICAgIGRhdGEsCiAgICAgICAgICAgIGlzbG9hZGluZywKICAgICAgICAgICAgX2FyZ3MyNSA9IGFyZ3VtZW50czsKICAgICAgICByZXR1cm4gcmVnZW5lcmF0b3JSdW50aW1lLndyYXAoZnVuY3Rpb24gX2NhbGxlZTI1JChfY29udGV4dDI1KSB7CiAgICAgICAgICB3aGlsZSAoMSkgewogICAgICAgICAgICBzd2l0Y2ggKF9jb250ZXh0MjUucHJldiA9IF9jb250ZXh0MjUubmV4dCkgewogICAgICAgICAgICAgIGNhc2UgMDoKICAgICAgICAgICAgICAgIGNvbnRleHQgPSBfYXJnczI1Lmxlbmd0aCA+IDAgJiYgX2FyZ3MyNVswXSAhPT0gdW5kZWZpbmVkID8gX2FyZ3MyNVswXSA6IHt9OwogICAgICAgICAgICAgICAgZGF0YSA9IF9hcmdzMjUubGVuZ3RoID4gMSAmJiBfYXJnczI1WzFdICE9PSB1bmRlZmluZWQgPyBfYXJnczI1WzFdIDoge307CiAgICAgICAgICAgICAgICBpc2xvYWRpbmcgPSBfYXJnczI1Lmxlbmd0aCA+IDIgPyBfYXJnczI1WzJdIDogdW5kZWZpbmVkOwogICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0MjUuYWJydXB0KCJyZXR1cm4iLCB0aGlzLkNyZWF0ZShjb250ZXh0LCBkYXRhLCBpc2xvYWRpbmcpKTsKCiAgICAgICAgICAgICAgY2FzZSA0OgogICAgICAgICAgICAgIGNhc2UgImVuZCI6CiAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQyNS5zdG9wKCk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9LCBfY2FsbGVlMjUsIHRoaXMpOwogICAgICB9KSk7CgogICAgICBmdW5jdGlvbiBGaWx0ZXJDcmVhdGUoKSB7CiAgICAgICAgcmV0dXJuIF9GaWx0ZXJDcmVhdGUuYXBwbHkodGhpcywgYXJndW1lbnRzKTsKICAgICAgfQoKICAgICAgcmV0dXJuIEZpbHRlckNyZWF0ZTsKICAgIH0oKQogICAgLyoqDQogICAgICogRmlsdGVyR2V0RHJhZnTmjqXlj6Pmlrnms5UNCiAgICAgKg0KICAgICAqIEBwYXJhbSB7Kn0gW2NvbnRleHQ9e31dDQogICAgICogQHBhcmFtIHsqfSBbZGF0YT17fV0NCiAgICAgKiBAcGFyYW0ge2Jvb2xlYW59IFtpc2xvYWRpbmddDQogICAgICogQHJldHVybnMge1Byb21pc2U8YW55Pn0NCiAgICAgKiBAbWVtYmVyb2YgRW50aXR5U2VydmljZQ0KICAgICAqLwoKICB9LCB7CiAgICBrZXk6ICJGaWx0ZXJHZXREcmFmdCIsCiAgICB2YWx1ZTogZnVuY3Rpb24gKCkgewogICAgICB2YXIgX0ZpbHRlckdldERyYWZ0ID0gX2FzeW5jVG9HZW5lcmF0b3IoCiAgICAgIC8qI19fUFVSRV9fKi8KICAgICAgcmVnZW5lcmF0b3JSdW50aW1lLm1hcmsoZnVuY3Rpb24gX2NhbGxlZTI2KCkgewogICAgICAgIHZhciBjb250ZXh0LAogICAgICAgICAgICBkYXRhLAogICAgICAgICAgICBpc2xvYWRpbmcsCiAgICAgICAgICAgIF9hcmdzMjYgPSBhcmd1bWVudHM7CiAgICAgICAgcmV0dXJuIHJlZ2VuZXJhdG9yUnVudGltZS53cmFwKGZ1bmN0aW9uIF9jYWxsZWUyNiQoX2NvbnRleHQyNikgewogICAgICAgICAgd2hpbGUgKDEpIHsKICAgICAgICAgICAgc3dpdGNoIChfY29udGV4dDI2LnByZXYgPSBfY29udGV4dDI2Lm5leHQpIHsKICAgICAgICAgICAgICBjYXNlIDA6CiAgICAgICAgICAgICAgICBjb250ZXh0ID0gX2FyZ3MyNi5sZW5ndGggPiAwICYmIF9hcmdzMjZbMF0gIT09IHVuZGVmaW5lZCA/IF9hcmdzMjZbMF0gOiB7fTsKICAgICAgICAgICAgICAgIGRhdGEgPSBfYXJnczI2Lmxlbmd0aCA+IDEgJiYgX2FyZ3MyNlsxXSAhPT0gdW5kZWZpbmVkID8gX2FyZ3MyNlsxXSA6IHt9OwogICAgICAgICAgICAgICAgaXNsb2FkaW5nID0gX2FyZ3MyNi5sZW5ndGggPiAyID8gX2FyZ3MyNlsyXSA6IHVuZGVmaW5lZDsKICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDI2LmFicnVwdCgicmV0dXJuIiwgdGhpcy5HZXREcmFmdChjb250ZXh0LCBkYXRhLCBpc2xvYWRpbmcpKTsKCiAgICAgICAgICAgICAgY2FzZSA0OgogICAgICAgICAgICAgIGNhc2UgImVuZCI6CiAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQyNi5zdG9wKCk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9LCBfY2FsbGVlMjYsIHRoaXMpOwogICAgICB9KSk7CgogICAgICBmdW5jdGlvbiBGaWx0ZXJHZXREcmFmdCgpIHsKICAgICAgICByZXR1cm4gX0ZpbHRlckdldERyYWZ0LmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7CiAgICAgIH0KCiAgICAgIHJldHVybiBGaWx0ZXJHZXREcmFmdDsKICAgIH0oKQogICAgLyoqDQogICAgICogRmlsdGVyUmVtb3Zl5o6l5Y+j5pa55rOVDQogICAgICoNCiAgICAgKiBAcGFyYW0geyp9IFtjb250ZXh0PXt9XQ0KICAgICAqIEBwYXJhbSB7Kn0gW2RhdGE9e31dDQogICAgICogQHBhcmFtIHtib29sZWFufSBbaXNsb2FkaW5nXQ0KICAgICAqIEByZXR1cm5zIHtQcm9taXNlPGFueT59DQogICAgICogQG1lbWJlcm9mIEVudGl0eVNlcnZpY2UNCiAgICAgKi8KCiAgfSwgewogICAga2V5OiAiRmlsdGVyUmVtb3ZlIiwKICAgIHZhbHVlOiBmdW5jdGlvbiAoKSB7CiAgICAgIHZhciBfRmlsdGVyUmVtb3ZlID0gX2FzeW5jVG9HZW5lcmF0b3IoCiAgICAgIC8qI19fUFVSRV9fKi8KICAgICAgcmVnZW5lcmF0b3JSdW50aW1lLm1hcmsoZnVuY3Rpb24gX2NhbGxlZTI3KCkgewogICAgICAgIHZhciBjb250ZXh0LAogICAgICAgICAgICBkYXRhLAogICAgICAgICAgICBpc2xvYWRpbmcsCiAgICAgICAgICAgIF9hcmdzMjcgPSBhcmd1bWVudHM7CiAgICAgICAgcmV0dXJuIHJlZ2VuZXJhdG9yUnVudGltZS53cmFwKGZ1bmN0aW9uIF9jYWxsZWUyNyQoX2NvbnRleHQyNykgewogICAgICAgICAgd2hpbGUgKDEpIHsKICAgICAgICAgICAgc3dpdGNoIChfY29udGV4dDI3LnByZXYgPSBfY29udGV4dDI3Lm5leHQpIHsKICAgICAgICAgICAgICBjYXNlIDA6CiAgICAgICAgICAgICAgICBjb250ZXh0ID0gX2FyZ3MyNy5sZW5ndGggPiAwICYmIF9hcmdzMjdbMF0gIT09IHVuZGVmaW5lZCA/IF9hcmdzMjdbMF0gOiB7fTsKICAgICAgICAgICAgICAgIGRhdGEgPSBfYXJnczI3Lmxlbmd0aCA+IDEgJiYgX2FyZ3MyN1sxXSAhPT0gdW5kZWZpbmVkID8gX2FyZ3MyN1sxXSA6IHt9OwogICAgICAgICAgICAgICAgaXNsb2FkaW5nID0gX2FyZ3MyNy5sZW5ndGggPiAyID8gX2FyZ3MyN1syXSA6IHVuZGVmaW5lZDsKICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDI3LmFicnVwdCgicmV0dXJuIiwgdGhpcy5SZW1vdmUoY29udGV4dCwgZGF0YSwgaXNsb2FkaW5nKSk7CgogICAgICAgICAgICAgIGNhc2UgNDoKICAgICAgICAgICAgICBjYXNlICJlbmQiOgogICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0Mjcuc3RvcCgpOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSwgX2NhbGxlZTI3LCB0aGlzKTsKICAgICAgfSkpOwoKICAgICAgZnVuY3Rpb24gRmlsdGVyUmVtb3ZlKCkgewogICAgICAgIHJldHVybiBfRmlsdGVyUmVtb3ZlLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7CiAgICAgIH0KCiAgICAgIHJldHVybiBGaWx0ZXJSZW1vdmU7CiAgICB9KCkKICAgIC8qKg0KICAgICAqIEZpbHRlckZldGNo5o6l5Y+j5pa55rOVDQogICAgICoNCiAgICAgKiBAcGFyYW0geyp9IFtjb250ZXh0PXt9XQ0KICAgICAqIEBwYXJhbSB7Kn0gW2RhdGE9e31dDQogICAgICogQHBhcmFtIHtib29sZWFufSBbaXNsb2FkaW5nXQ0KICAgICAqIEByZXR1cm5zIHtQcm9taXNlPGFueT59DQogICAgICogQG1lbWJlcm9mIEVudGl0eVNlcnZpY2UNCiAgICAgKi8KCiAgfSwgewogICAga2V5OiAiRmlsdGVyRmV0Y2giLAogICAgdmFsdWU6IGZ1bmN0aW9uICgpIHsKICAgICAgdmFyIF9GaWx0ZXJGZXRjaCA9IF9hc3luY1RvR2VuZXJhdG9yKAogICAgICAvKiNfX1BVUkVfXyovCiAgICAgIHJlZ2VuZXJhdG9yUnVudGltZS5tYXJrKGZ1bmN0aW9uIF9jYWxsZWUyOCgpIHsKICAgICAgICB2YXIgY29udGV4dCwKICAgICAgICAgICAgZGF0YSwKICAgICAgICAgICAgaXNsb2FkaW5nLAogICAgICAgICAgICBfYXJnczI4ID0gYXJndW1lbnRzOwogICAgICAgIHJldHVybiByZWdlbmVyYXRvclJ1bnRpbWUud3JhcChmdW5jdGlvbiBfY2FsbGVlMjgkKF9jb250ZXh0MjgpIHsKICAgICAgICAgIHdoaWxlICgxKSB7CiAgICAgICAgICAgIHN3aXRjaCAoX2NvbnRleHQyOC5wcmV2ID0gX2NvbnRleHQyOC5uZXh0KSB7CiAgICAgICAgICAgICAgY2FzZSAwOgogICAgICAgICAgICAgICAgY29udGV4dCA9IF9hcmdzMjgubGVuZ3RoID4gMCAmJiBfYXJnczI4WzBdICE9PSB1bmRlZmluZWQgPyBfYXJnczI4WzBdIDoge307CiAgICAgICAgICAgICAgICBkYXRhID0gX2FyZ3MyOC5sZW5ndGggPiAxICYmIF9hcmdzMjhbMV0gIT09IHVuZGVmaW5lZCA/IF9hcmdzMjhbMV0gOiB7fTsKICAgICAgICAgICAgICAgIGlzbG9hZGluZyA9IF9hcmdzMjgubGVuZ3RoID4gMiA/IF9hcmdzMjhbMl0gOiB1bmRlZmluZWQ7CiAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQyOC5hYnJ1cHQoInJldHVybiIsIHRoaXMuRmV0Y2hEZWZhdWx0KGNvbnRleHQsIGRhdGEsIGlzbG9hZGluZykpOwoKICAgICAgICAgICAgICBjYXNlIDQ6CiAgICAgICAgICAgICAgY2FzZSAiZW5kIjoKICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDI4LnN0b3AoKTsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0sIF9jYWxsZWUyOCwgdGhpcyk7CiAgICAgIH0pKTsKCiAgICAgIGZ1bmN0aW9uIEZpbHRlckZldGNoKCkgewogICAgICAgIHJldHVybiBfRmlsdGVyRmV0Y2guYXBwbHkodGhpcywgYXJndW1lbnRzKTsKICAgICAgfQoKICAgICAgcmV0dXJuIEZpbHRlckZldGNoOwogICAgfSgpCiAgICAvKioNCiAgICAgKiBJbXBvcnREYXRh5o6l5Y+j5pa55rOVDQogICAgICoNCiAgICAgKiBAcGFyYW0geyp9IFtjb250ZXh0PXt9XQ0KICAgICAqIEBwYXJhbSB7Kn0gW2RhdGE9e31dDQogICAgICogQHBhcmFtIHtib29sZWFufSBbaXNsb2FkaW5nXQ0KICAgICAqIEByZXR1cm5zIHtQcm9taXNlPGFueT59DQogICAgICogQG1lbWJlcm9mIEVudGl0eVNlcnZpY2UNCiAgICAgKi8KCiAgfSwgewogICAga2V5OiAiSW1wb3J0RGF0YSIsCiAgICB2YWx1ZTogZnVuY3Rpb24gKCkgewogICAgICB2YXIgX0ltcG9ydERhdGEgPSBfYXN5bmNUb0dlbmVyYXRvcigKICAgICAgLyojX19QVVJFX18qLwogICAgICByZWdlbmVyYXRvclJ1bnRpbWUubWFyayhmdW5jdGlvbiBfY2FsbGVlMjkoKSB7CiAgICAgICAgdmFyIGNvbnRleHQsCiAgICAgICAgICAgIGRhdGEsCiAgICAgICAgICAgIGlzbG9hZGluZywKICAgICAgICAgICAgX2FyZ3MyOSA9IGFyZ3VtZW50czsKICAgICAgICByZXR1cm4gcmVnZW5lcmF0b3JSdW50aW1lLndyYXAoZnVuY3Rpb24gX2NhbGxlZTI5JChfY29udGV4dDI5KSB7CiAgICAgICAgICB3aGlsZSAoMSkgewogICAgICAgICAgICBzd2l0Y2ggKF9jb250ZXh0MjkucHJldiA9IF9jb250ZXh0MjkubmV4dCkgewogICAgICAgICAgICAgIGNhc2UgMDoKICAgICAgICAgICAgICAgIGNvbnRleHQgPSBfYXJnczI5Lmxlbmd0aCA+IDAgJiYgX2FyZ3MyOVswXSAhPT0gdW5kZWZpbmVkID8gX2FyZ3MyOVswXSA6IHt9OwogICAgICAgICAgICAgICAgZGF0YSA9IF9hcmdzMjkubGVuZ3RoID4gMSAmJiBfYXJnczI5WzFdICE9PSB1bmRlZmluZWQgPyBfYXJnczI5WzFdIDoge307CiAgICAgICAgICAgICAgICBpc2xvYWRpbmcgPSBfYXJnczI5Lmxlbmd0aCA+IDIgPyBfYXJnczI5WzJdIDogdW5kZWZpbmVkOwogICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0MjkuYWJydXB0KCJyZXR1cm4iLCBIdHRwLmdldEluc3RhbmNlKCkucG9zdCgiLyIuY29uY2F0KHRoaXMuQVBQREVOQU1FLCAiL2ltcG9ydCIpLCBkYXRhLCBpc2xvYWRpbmcpKTsKCiAgICAgICAgICAgICAgY2FzZSA0OgogICAgICAgICAgICAgIGNhc2UgImVuZCI6CiAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQyOS5zdG9wKCk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9LCBfY2FsbGVlMjksIHRoaXMpOwogICAgICB9KSk7CgogICAgICBmdW5jdGlvbiBJbXBvcnREYXRhKCkgewogICAgICAgIHJldHVybiBfSW1wb3J0RGF0YS5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwogICAgICB9CgogICAgICByZXR1cm4gSW1wb3J0RGF0YTsKICAgIH0oKQogICAgLyoqDQogICAgICogY3JlYXRlQmF0Y2jmjqXlj6Pmlrnms5UNCiAgICAgKg0KICAgICAqIEBwYXJhbSB7Kn0gW2NvbnRleHQ9e31dDQogICAgICogQHBhcmFtIHsqfSBbZGF0YV0NCiAgICAgKiBAcGFyYW0ge2Jvb2xlYW59IFtpc2xvYWRpbmddDQogICAgICogQHJldHVybnMge1Byb21pc2U8YW55Pn0NCiAgICAgKiBAbWVtYmVyb2YgRW50aXR5U2VydmljZQ0KICAgICAqLwoKICB9LCB7CiAgICBrZXk6ICJjcmVhdGVCYXRjaCIsCiAgICB2YWx1ZTogZnVuY3Rpb24gKCkgewogICAgICB2YXIgX2NyZWF0ZUJhdGNoID0gX2FzeW5jVG9HZW5lcmF0b3IoCiAgICAgIC8qI19fUFVSRV9fKi8KICAgICAgcmVnZW5lcmF0b3JSdW50aW1lLm1hcmsoZnVuY3Rpb24gX2NhbGxlZTMwKCkgewogICAgICAgIHZhciBjb250ZXh0LAogICAgICAgICAgICBkYXRhLAogICAgICAgICAgICBpc2xvYWRpbmcsCiAgICAgICAgICAgIF9hcmdzMzAgPSBhcmd1bWVudHM7CiAgICAgICAgcmV0dXJuIHJlZ2VuZXJhdG9yUnVudGltZS53cmFwKGZ1bmN0aW9uIF9jYWxsZWUzMCQoX2NvbnRleHQzMCkgewogICAgICAgICAgd2hpbGUgKDEpIHsKICAgICAgICAgICAgc3dpdGNoIChfY29udGV4dDMwLnByZXYgPSBfY29udGV4dDMwLm5leHQpIHsKICAgICAgICAgICAgICBjYXNlIDA6CiAgICAgICAgICAgICAgICBjb250ZXh0ID0gX2FyZ3MzMC5sZW5ndGggPiAwICYmIF9hcmdzMzBbMF0gIT09IHVuZGVmaW5lZCA/IF9hcmdzMzBbMF0gOiB7fTsKICAgICAgICAgICAgICAgIGRhdGEgPSBfYXJnczMwLmxlbmd0aCA+IDEgPyBfYXJnczMwWzFdIDogdW5kZWZpbmVkOwogICAgICAgICAgICAgICAgaXNsb2FkaW5nID0gX2FyZ3MzMC5sZW5ndGggPiAyID8gX2FyZ3MzMFsyXSA6IHVuZGVmaW5lZDsKICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDMwLmFicnVwdCgicmV0dXJuIiwgSHR0cC5nZXRJbnN0YW5jZSgpLnBvc3QoIi8iLmNvbmNhdCh0aGlzLkFQUERFTkFNRSwgIi9iYXRjaCIpLCBkYXRhLCBpc2xvYWRpbmcpKTsKCiAgICAgICAgICAgICAgY2FzZSA0OgogICAgICAgICAgICAgIGNhc2UgImVuZCI6CiAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQzMC5zdG9wKCk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9LCBfY2FsbGVlMzAsIHRoaXMpOwogICAgICB9KSk7CgogICAgICBmdW5jdGlvbiBjcmVhdGVCYXRjaCgpIHsKICAgICAgICByZXR1cm4gX2NyZWF0ZUJhdGNoLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7CiAgICAgIH0KCiAgICAgIHJldHVybiBjcmVhdGVCYXRjaDsKICAgIH0oKQogICAgLyoqDQogICAgICogdXBkYXRlQmF0Y2jmjqXlj6Pmlrnms5UNCiAgICAgKg0KICAgICAqIEBwYXJhbSB7Kn0gW2NvbnRleHQ9e31dDQogICAgICogQHBhcmFtIHsqfSBbZGF0YV0NCiAgICAgKiBAcGFyYW0ge2Jvb2xlYW59IFtpc2xvYWRpbmddDQogICAgICogQHJldHVybnMge1Byb21pc2U8YW55Pn0NCiAgICAgKiBAbWVtYmVyb2YgRW50aXR5U2VydmljZQ0KICAgICAqLwoKICB9LCB7CiAgICBrZXk6ICJ1cGRhdGVCYXRjaCIsCiAgICB2YWx1ZTogZnVuY3Rpb24gKCkgewogICAgICB2YXIgX3VwZGF0ZUJhdGNoID0gX2FzeW5jVG9HZW5lcmF0b3IoCiAgICAgIC8qI19fUFVSRV9fKi8KICAgICAgcmVnZW5lcmF0b3JSdW50aW1lLm1hcmsoZnVuY3Rpb24gX2NhbGxlZTMxKCkgewogICAgICAgIHZhciBjb250ZXh0LAogICAgICAgICAgICBkYXRhLAogICAgICAgICAgICBpc2xvYWRpbmcsCiAgICAgICAgICAgIF9hcmdzMzEgPSBhcmd1bWVudHM7CiAgICAgICAgcmV0dXJuIHJlZ2VuZXJhdG9yUnVudGltZS53cmFwKGZ1bmN0aW9uIF9jYWxsZWUzMSQoX2NvbnRleHQzMSkgewogICAgICAgICAgd2hpbGUgKDEpIHsKICAgICAgICAgICAgc3dpdGNoIChfY29udGV4dDMxLnByZXYgPSBfY29udGV4dDMxLm5leHQpIHsKICAgICAgICAgICAgICBjYXNlIDA6CiAgICAgICAgICAgICAgICBjb250ZXh0ID0gX2FyZ3MzMS5sZW5ndGggPiAwICYmIF9hcmdzMzFbMF0gIT09IHVuZGVmaW5lZCA/IF9hcmdzMzFbMF0gOiB7fTsKICAgICAgICAgICAgICAgIGRhdGEgPSBfYXJnczMxLmxlbmd0aCA+IDEgPyBfYXJnczMxWzFdIDogdW5kZWZpbmVkOwogICAgICAgICAgICAgICAgaXNsb2FkaW5nID0gX2FyZ3MzMS5sZW5ndGggPiAyID8gX2FyZ3MzMVsyXSA6IHVuZGVmaW5lZDsKICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDMxLmFicnVwdCgicmV0dXJuIiwgSHR0cC5nZXRJbnN0YW5jZSgpLnB1dCgiLyIuY29uY2F0KHRoaXMuQVBQREVOQU1FLCAiL2JhdGNoIiksIGRhdGEsIGlzbG9hZGluZykpOwoKICAgICAgICAgICAgICBjYXNlIDQ6CiAgICAgICAgICAgICAgY2FzZSAiZW5kIjoKICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDMxLnN0b3AoKTsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0sIF9jYWxsZWUzMSwgdGhpcyk7CiAgICAgIH0pKTsKCiAgICAgIGZ1bmN0aW9uIHVwZGF0ZUJhdGNoKCkgewogICAgICAgIHJldHVybiBfdXBkYXRlQmF0Y2guYXBwbHkodGhpcywgYXJndW1lbnRzKTsKICAgICAgfQoKICAgICAgcmV0dXJuIHVwZGF0ZUJhdGNoOwogICAgfSgpCiAgICAvKioNCiAgICAgKiByZW1vdmVCYXRjaOaOpeWPo+aWueazlQ0KICAgICAqDQogICAgICogQHBhcmFtIHsqfSBbY29udGV4dD17fV0NCiAgICAgKiBAcGFyYW0geyp9IFtkYXRhXQ0KICAgICAqIEBwYXJhbSB7Ym9vbGVhbn0gW2lzbG9hZGluZ10NCiAgICAgKiBAcmV0dXJucyB7UHJvbWlzZTxhbnk+fQ0KICAgICAqIEBtZW1iZXJvZiBFbnRpdHlTZXJ2aWNlDQogICAgICovCgogIH0sIHsKICAgIGtleTogInJlbW92ZUJhdGNoIiwKICAgIHZhbHVlOiBmdW5jdGlvbiAoKSB7CiAgICAgIHZhciBfcmVtb3ZlQmF0Y2ggPSBfYXN5bmNUb0dlbmVyYXRvcigKICAgICAgLyojX19QVVJFX18qLwogICAgICByZWdlbmVyYXRvclJ1bnRpbWUubWFyayhmdW5jdGlvbiBfY2FsbGVlMzIoKSB7CiAgICAgICAgdmFyIGNvbnRleHQsCiAgICAgICAgICAgIGRhdGEsCiAgICAgICAgICAgIGlzbG9hZGluZywKICAgICAgICAgICAgX2FyZ3MzMiA9IGFyZ3VtZW50czsKICAgICAgICByZXR1cm4gcmVnZW5lcmF0b3JSdW50aW1lLndyYXAoZnVuY3Rpb24gX2NhbGxlZTMyJChfY29udGV4dDMyKSB7CiAgICAgICAgICB3aGlsZSAoMSkgewogICAgICAgICAgICBzd2l0Y2ggKF9jb250ZXh0MzIucHJldiA9IF9jb250ZXh0MzIubmV4dCkgewogICAgICAgICAgICAgIGNhc2UgMDoKICAgICAgICAgICAgICAgIGNvbnRleHQgPSBfYXJnczMyLmxlbmd0aCA+IDAgJiYgX2FyZ3MzMlswXSAhPT0gdW5kZWZpbmVkID8gX2FyZ3MzMlswXSA6IHt9OwogICAgICAgICAgICAgICAgZGF0YSA9IF9hcmdzMzIubGVuZ3RoID4gMSA/IF9hcmdzMzJbMV0gOiB1bmRlZmluZWQ7CiAgICAgICAgICAgICAgICBpc2xvYWRpbmcgPSBfYXJnczMyLmxlbmd0aCA+IDIgPyBfYXJnczMyWzJdIDogdW5kZWZpbmVkOwogICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0MzIuYWJydXB0KCJyZXR1cm4iLCBIdHRwLmdldEluc3RhbmNlKClbImRlbGV0ZSJdKCIvIi5jb25jYXQodGhpcy5BUFBERU5BTUUsICIvYmF0Y2giKSwgaXNsb2FkaW5nLCBkYXRhW3RoaXMuQVBQREVLRVldKSk7CgogICAgICAgICAgICAgIGNhc2UgNDoKICAgICAgICAgICAgICBjYXNlICJlbmQiOgogICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0MzIuc3RvcCgpOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSwgX2NhbGxlZTMyLCB0aGlzKTsKICAgICAgfSkpOwoKICAgICAgZnVuY3Rpb24gcmVtb3ZlQmF0Y2goKSB7CiAgICAgICAgcmV0dXJuIF9yZW1vdmVCYXRjaC5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwogICAgICB9CgogICAgICByZXR1cm4gcmVtb3ZlQmF0Y2g7CiAgICB9KCkKICAgIC8qKg0KICAgICAqIGdldERhdGFJbmZv5o6l5Y+j5pa55rOVDQogICAgICoNCiAgICAgKiBAcGFyYW0geyp9IFtjb250ZXh0PXt9XQ0KICAgICAqIEBwYXJhbSB7Kn0gW2RhdGFdDQogICAgICogQHBhcmFtIHtib29sZWFufSBbaXNsb2FkaW5nXQ0KICAgICAqIEByZXR1cm5zIHtQcm9taXNlPGFueT59DQogICAgICogQG1lbWJlcm9mIEVudGl0eVNlcnZpY2UNCiAgICAgKi8KCiAgfSwgewogICAga2V5OiAiZ2V0RGF0YUluZm8iLAogICAgdmFsdWU6IGZ1bmN0aW9uICgpIHsKICAgICAgdmFyIF9nZXREYXRhSW5mbyA9IF9hc3luY1RvR2VuZXJhdG9yKAogICAgICAvKiNfX1BVUkVfXyovCiAgICAgIHJlZ2VuZXJhdG9yUnVudGltZS5tYXJrKGZ1bmN0aW9uIF9jYWxsZWUzMygpIHsKICAgICAgICB2YXIgY29udGV4dCwKICAgICAgICAgICAgZGF0YSwKICAgICAgICAgICAgaXNsb2FkaW5nLAogICAgICAgICAgICBfYXJnczMzID0gYXJndW1lbnRzOwogICAgICAgIHJldHVybiByZWdlbmVyYXRvclJ1bnRpbWUud3JhcChmdW5jdGlvbiBfY2FsbGVlMzMkKF9jb250ZXh0MzMpIHsKICAgICAgICAgIHdoaWxlICgxKSB7CiAgICAgICAgICAgIHN3aXRjaCAoX2NvbnRleHQzMy5wcmV2ID0gX2NvbnRleHQzMy5uZXh0KSB7CiAgICAgICAgICAgICAgY2FzZSAwOgogICAgICAgICAgICAgICAgY29udGV4dCA9IF9hcmdzMzMubGVuZ3RoID4gMCAmJiBfYXJnczMzWzBdICE9PSB1bmRlZmluZWQgPyBfYXJnczMzWzBdIDoge307CiAgICAgICAgICAgICAgICBkYXRhID0gX2FyZ3MzMy5sZW5ndGggPiAxID8gX2FyZ3MzM1sxXSA6IHVuZGVmaW5lZDsKICAgICAgICAgICAgICAgIGlzbG9hZGluZyA9IF9hcmdzMzMubGVuZ3RoID4gMiA/IF9hcmdzMzNbMl0gOiB1bmRlZmluZWQ7CgogICAgICAgICAgICAgICAgaWYgKCFjb250ZXh0W3RoaXMuQVBQTFlERUtFWV0pIHsKICAgICAgICAgICAgICAgICAgX2NvbnRleHQzMy5uZXh0ID0gNTsKICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0MzMuYWJydXB0KCJyZXR1cm4iLCB0aGlzLkdldChjb250ZXh0LCBkYXRhLCBpc2xvYWRpbmcpKTsKCiAgICAgICAgICAgICAgY2FzZSA1OgogICAgICAgICAgICAgIGNhc2UgImVuZCI6CiAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQzMy5zdG9wKCk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9LCBfY2FsbGVlMzMsIHRoaXMpOwogICAgICB9KSk7CgogICAgICBmdW5jdGlvbiBnZXREYXRhSW5mbygpIHsKICAgICAgICByZXR1cm4gX2dldERhdGFJbmZvLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7CiAgICAgIH0KCiAgICAgIHJldHVybiBnZXREYXRhSW5mbzsKICAgIH0oKQogICAgLyoqDQogICAgICogZ2V0RHluYU1vZGVsKOiOt+WPluWKqOaAgeaooeWeiynmjqXlj6Pmlrnms5UNCiAgICAgKg0KICAgICAqIEBwYXJhbSB7Kn0gW2NvbnRleHQ9e31dDQogICAgICogQHBhcmFtIHsqfSBbZGF0YV0NCiAgICAgKiBAcGFyYW0ge2Jvb2xlYW59IFtpc2xvYWRpbmddDQogICAgICogQHJldHVybnMge1Byb21pc2U8YW55Pn0NCiAgICAgKiBAbWVtYmVyb2YgRW50aXR5U2VydmljZQ0KICAgICAqLwoKICB9LCB7CiAgICBrZXk6ICJnZXREeW5hTW9kZWwiLAogICAgdmFsdWU6IGZ1bmN0aW9uICgpIHsKICAgICAgdmFyIF9nZXREeW5hTW9kZWwgPSBfYXN5bmNUb0dlbmVyYXRvcigKICAgICAgLyojX19QVVJFX18qLwogICAgICByZWdlbmVyYXRvclJ1bnRpbWUubWFyayhmdW5jdGlvbiBfY2FsbGVlMzQoKSB7CiAgICAgICAgdmFyIGNvbnRleHQsCiAgICAgICAgICAgIGRhdGEsCiAgICAgICAgICAgIGlzbG9hZGluZywKICAgICAgICAgICAgX2FyZ3MzNCA9IGFyZ3VtZW50czsKICAgICAgICByZXR1cm4gcmVnZW5lcmF0b3JSdW50aW1lLndyYXAoZnVuY3Rpb24gX2NhbGxlZTM0JChfY29udGV4dDM0KSB7CiAgICAgICAgICB3aGlsZSAoMSkgewogICAgICAgICAgICBzd2l0Y2ggKF9jb250ZXh0MzQucHJldiA9IF9jb250ZXh0MzQubmV4dCkgewogICAgICAgICAgICAgIGNhc2UgMDoKICAgICAgICAgICAgICAgIGNvbnRleHQgPSBfYXJnczM0Lmxlbmd0aCA+IDAgJiYgX2FyZ3MzNFswXSAhPT0gdW5kZWZpbmVkID8gX2FyZ3MzNFswXSA6IHt9OwogICAgICAgICAgICAgICAgZGF0YSA9IF9hcmdzMzQubGVuZ3RoID4gMSA/IF9hcmdzMzRbMV0gOiB1bmRlZmluZWQ7CiAgICAgICAgICAgICAgICBpc2xvYWRpbmcgPSBfYXJnczM0Lmxlbmd0aCA+IDIgPyBfYXJnczM0WzJdIDogdW5kZWZpbmVkOwoKICAgICAgICAgICAgICAgIGlmICghKGRhdGEgJiYgZGF0YS5jb25maWdUeXBlICYmIGRhdGEudGFyZ2V0VHlwZSkpIHsKICAgICAgICAgICAgICAgICAgX2NvbnRleHQzNC5uZXh0ID0gNTsKICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0MzQuYWJydXB0KCJyZXR1cm4iLCBIdHRwLmdldEluc3RhbmNlKCkuZ2V0KCIvY29uZmlncy8iLmNvbmNhdChkYXRhLmNvbmZpZ1R5cGUsICIvIikuY29uY2F0KGRhdGEudGFyZ2V0VHlwZSkpKTsKCiAgICAgICAgICAgICAgY2FzZSA1OgogICAgICAgICAgICAgIGNhc2UgImVuZCI6CiAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQzNC5zdG9wKCk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9LCBfY2FsbGVlMzQpOwogICAgICB9KSk7CgogICAgICBmdW5jdGlvbiBnZXREeW5hTW9kZWwoKSB7CiAgICAgICAgcmV0dXJuIF9nZXREeW5hTW9kZWwuYXBwbHkodGhpcywgYXJndW1lbnRzKTsKICAgICAgfQoKICAgICAgcmV0dXJuIGdldER5bmFNb2RlbDsKICAgIH0oKQogICAgLyoqDQogICAgICogc2V0RHluYU1vZGVsKOiuvue9ruWKqOaAgeaooeWeiynmjqXlj6Pmlrnms5UNCiAgICAgKg0KICAgICAqIEBwYXJhbSB7Kn0gW2NvbnRleHQ9e31dDQogICAgICogQHBhcmFtIHsqfSBbZGF0YV0NCiAgICAgKiBAcGFyYW0ge2Jvb2xlYW59IFtpc2xvYWRpbmddDQogICAgICogQHJldHVybnMge1Byb21pc2U8YW55Pn0NCiAgICAgKiBAbWVtYmVyb2YgRW50aXR5U2VydmljZQ0KICAgICAqLwoKICB9LCB7CiAgICBrZXk6ICJzZXREeW5hTW9kZWwiLAogICAgdmFsdWU6IGZ1bmN0aW9uICgpIHsKICAgICAgdmFyIF9zZXREeW5hTW9kZWwgPSBfYXN5bmNUb0dlbmVyYXRvcigKICAgICAgLyojX19QVVJFX18qLwogICAgICByZWdlbmVyYXRvclJ1bnRpbWUubWFyayhmdW5jdGlvbiBfY2FsbGVlMzUoKSB7CiAgICAgICAgdmFyIGNvbnRleHQsCiAgICAgICAgICAgIGRhdGEsCiAgICAgICAgICAgIGlzbG9hZGluZywKICAgICAgICAgICAgX2FyZ3MzNSA9IGFyZ3VtZW50czsKICAgICAgICByZXR1cm4gcmVnZW5lcmF0b3JSdW50aW1lLndyYXAoZnVuY3Rpb24gX2NhbGxlZTM1JChfY29udGV4dDM1KSB7CiAgICAgICAgICB3aGlsZSAoMSkgewogICAgICAgICAgICBzd2l0Y2ggKF9jb250ZXh0MzUucHJldiA9IF9jb250ZXh0MzUubmV4dCkgewogICAgICAgICAgICAgIGNhc2UgMDoKICAgICAgICAgICAgICAgIGNvbnRleHQgPSBfYXJnczM1Lmxlbmd0aCA+IDAgJiYgX2FyZ3MzNVswXSAhPT0gdW5kZWZpbmVkID8gX2FyZ3MzNVswXSA6IHt9OwogICAgICAgICAgICAgICAgZGF0YSA9IF9hcmdzMzUubGVuZ3RoID4gMSA/IF9hcmdzMzVbMV0gOiB1bmRlZmluZWQ7CiAgICAgICAgICAgICAgICBpc2xvYWRpbmcgPSBfYXJnczM1Lmxlbmd0aCA+IDIgPyBfYXJnczM1WzJdIDogdW5kZWZpbmVkOwoKICAgICAgICAgICAgICAgIGlmICghKGRhdGEgJiYgZGF0YS5jb25maWdUeXBlICYmIGRhdGEudGFyZ2V0VHlwZSkpIHsKICAgICAgICAgICAgICAgICAgX2NvbnRleHQzNS5uZXh0ID0gNTsKICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0MzUuYWJydXB0KCJyZXR1cm4iLCBIdHRwLmdldEluc3RhbmNlKCkucHV0KCIvY29uZmlncy8iLmNvbmNhdChkYXRhLmNvbmZpZ1R5cGUsICIvIikuY29uY2F0KGRhdGEudGFyZ2V0VHlwZSksIHsKICAgICAgICAgICAgICAgICAgbW9kZWw6IGRhdGEubW9kZWwKICAgICAgICAgICAgICAgIH0pKTsKCiAgICAgICAgICAgICAgY2FzZSA1OgogICAgICAgICAgICAgIGNhc2UgImVuZCI6CiAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQzNS5zdG9wKCk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9LCBfY2FsbGVlMzUpOwogICAgICB9KSk7CgogICAgICBmdW5jdGlvbiBzZXREeW5hTW9kZWwoKSB7CiAgICAgICAgcmV0dXJuIF9zZXREeW5hTW9kZWwuYXBwbHkodGhpcywgYXJndW1lbnRzKTsKICAgICAgfQoKICAgICAgcmV0dXJuIHNldER5bmFNb2RlbDsKICAgIH0oKQogICAgLyoqDQogICAgICogV0ZTdGFydOaOpeWPo+aWueazlQ0KICAgICAqDQogICAgICogQHBhcmFtIHsqfSBbY29udGV4dD17fV0NCiAgICAgKiBAcGFyYW0geyp9IFtkYXRhPXt9XQ0KICAgICAqIEBwYXJhbSB7Ym9vbGVhbn0gW2lzbG9hZGluZ10NCiAgICAgKiBAcGFyYW0geyp9IFtsb2NhbGRhdGFdDQogICAgICogQHJldHVybnMge1Byb21pc2U8YW55Pn0NCiAgICAgKiBAbWVtYmVyb2YgRW50aXR5U2VydmljZQ0KICAgICAqLwoKICB9LCB7CiAgICBrZXk6ICJXRlN0YXJ0IiwKICAgIHZhbHVlOiBmdW5jdGlvbiAoKSB7CiAgICAgIHZhciBfV0ZTdGFydCA9IF9hc3luY1RvR2VuZXJhdG9yKAogICAgICAvKiNfX1BVUkVfXyovCiAgICAgIHJlZ2VuZXJhdG9yUnVudGltZS5tYXJrKGZ1bmN0aW9uIF9jYWxsZWUzNigpIHsKICAgICAgICB2YXIgY29udGV4dCwKICAgICAgICAgICAgZGF0YSwKICAgICAgICAgICAgaXNsb2FkaW5nLAogICAgICAgICAgICBsb2NhbGRhdGEsCiAgICAgICAgICAgIHJlcXVlc3REYXRhLAogICAgICAgICAgICBfcmVxdWVzdERhdGEsCiAgICAgICAgICAgIF9hcmdzMzYgPSBhcmd1bWVudHM7CgogICAgICAgIHJldHVybiByZWdlbmVyYXRvclJ1bnRpbWUud3JhcChmdW5jdGlvbiBfY2FsbGVlMzYkKF9jb250ZXh0MzYpIHsKICAgICAgICAgIHdoaWxlICgxKSB7CiAgICAgICAgICAgIHN3aXRjaCAoX2NvbnRleHQzNi5wcmV2ID0gX2NvbnRleHQzNi5uZXh0KSB7CiAgICAgICAgICAgICAgY2FzZSAwOgogICAgICAgICAgICAgICAgY29udGV4dCA9IF9hcmdzMzYubGVuZ3RoID4gMCAmJiBfYXJnczM2WzBdICE9PSB1bmRlZmluZWQgPyBfYXJnczM2WzBdIDoge307CiAgICAgICAgICAgICAgICBkYXRhID0gX2FyZ3MzNi5sZW5ndGggPiAxICYmIF9hcmdzMzZbMV0gIT09IHVuZGVmaW5lZCA/IF9hcmdzMzZbMV0gOiB7fTsKICAgICAgICAgICAgICAgIGlzbG9hZGluZyA9IF9hcmdzMzYubGVuZ3RoID4gMiA/IF9hcmdzMzZbMl0gOiB1bmRlZmluZWQ7CiAgICAgICAgICAgICAgICBsb2NhbGRhdGEgPSBfYXJnczM2Lmxlbmd0aCA+IDMgPyBfYXJnczM2WzNdIDogdW5kZWZpbmVkOwoKICAgICAgICAgICAgICAgIGlmICghKGxvY2FsZGF0YSAmJiBPYmplY3Qua2V5cyhsb2NhbGRhdGEpLmxlbmd0aCA+IDApKSB7CiAgICAgICAgICAgICAgICAgIF9jb250ZXh0MzYubmV4dCA9IDExOwogICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICByZXF1ZXN0RGF0YSA9IHt9OwogICAgICAgICAgICAgICAgT2JqZWN0LmFzc2lnbihyZXF1ZXN0RGF0YSwgewogICAgICAgICAgICAgICAgICBhY3RpdmVkYXRhOiBkYXRhCiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIE9iamVjdC5hc3NpZ24ocmVxdWVzdERhdGEsIGxvY2FsZGF0YSk7CiAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQzNi5hYnJ1cHQoInJldHVybiIsIEh0dHAuZ2V0SW5zdGFuY2UoKS5wb3N0KCIvd2Zjb3JlLyIuY29uY2F0KHRoaXMuU1lTVEVNTkFNRSwgIi1hcHAtIikuY29uY2F0KHRoaXMuQVBQTkFNRSwgIi8iKS5jb25jYXQodGhpcy5BUFBERU5BTUUsICIvIikuY29uY2F0KGRhdGFbdGhpcy5BUFBERUtFWV0sICIvcHJvY2Vzcy1pbnN0YW5jZXMiKSwgcmVxdWVzdERhdGEsIGlzbG9hZGluZykpOwoKICAgICAgICAgICAgICBjYXNlIDExOgogICAgICAgICAgICAgICAgX3JlcXVlc3REYXRhID0ge307CiAgICAgICAgICAgICAgICBPYmplY3QuYXNzaWduKF9yZXF1ZXN0RGF0YSwgewogICAgICAgICAgICAgICAgICB3ZmRhdGE6IGRhdGEKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0MzYuYWJydXB0KCJyZXR1cm4iLCBIdHRwLmdldEluc3RhbmNlKCkucG9zdCgiLyIuY29uY2F0KHRoaXMuQVBQREVOQU1FLCAiLyIpLmNvbmNhdChkYXRhW3RoaXMuQVBQREVLRVldLCAiL3dmc3RhcnQiKSwgX3JlcXVlc3REYXRhLCBpc2xvYWRpbmcpKTsKCiAgICAgICAgICAgICAgY2FzZSAxNDoKICAgICAgICAgICAgICBjYXNlICJlbmQiOgogICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0MzYuc3RvcCgpOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSwgX2NhbGxlZTM2LCB0aGlzKTsKICAgICAgfSkpOwoKICAgICAgZnVuY3Rpb24gV0ZTdGFydCgpIHsKICAgICAgICByZXR1cm4gX1dGU3RhcnQuYXBwbHkodGhpcywgYXJndW1lbnRzKTsKICAgICAgfQoKICAgICAgcmV0dXJuIFdGU3RhcnQ7CiAgICB9KCkKICAgIC8qKg0KICAgICAqIFdGQ2xvc2XmjqXlj6Pmlrnms5UNCiAgICAgKg0KICAgICAqIEBwYXJhbSB7Kn0gW2NvbnRleHQ9e31dDQogICAgICogQHBhcmFtIHsqfSBbZGF0YT17fV0NCiAgICAgKiBAcGFyYW0ge2Jvb2xlYW59IFtpc2xvYWRpbmddDQogICAgICogQHJldHVybnMge1Byb21pc2U8YW55Pn0NCiAgICAgKiBAbWVtYmVyb2YgRW50aXR5U2VydmljZQ0KICAgICAqLwoKICB9LCB7CiAgICBrZXk6ICJXRkNsb3NlIiwKICAgIHZhbHVlOiBmdW5jdGlvbiAoKSB7CiAgICAgIHZhciBfV0ZDbG9zZSA9IF9hc3luY1RvR2VuZXJhdG9yKAogICAgICAvKiNfX1BVUkVfXyovCiAgICAgIHJlZ2VuZXJhdG9yUnVudGltZS5tYXJrKGZ1bmN0aW9uIF9jYWxsZWUzNygpIHsKICAgICAgICB2YXIgY29udGV4dCwKICAgICAgICAgICAgZGF0YSwKICAgICAgICAgICAgaXNsb2FkaW5nLAogICAgICAgICAgICBfYXJnczM3ID0gYXJndW1lbnRzOwogICAgICAgIHJldHVybiByZWdlbmVyYXRvclJ1bnRpbWUud3JhcChmdW5jdGlvbiBfY2FsbGVlMzckKF9jb250ZXh0MzcpIHsKICAgICAgICAgIHdoaWxlICgxKSB7CiAgICAgICAgICAgIHN3aXRjaCAoX2NvbnRleHQzNy5wcmV2ID0gX2NvbnRleHQzNy5uZXh0KSB7CiAgICAgICAgICAgICAgY2FzZSAwOgogICAgICAgICAgICAgICAgY29udGV4dCA9IF9hcmdzMzcubGVuZ3RoID4gMCAmJiBfYXJnczM3WzBdICE9PSB1bmRlZmluZWQgPyBfYXJnczM3WzBdIDoge307CiAgICAgICAgICAgICAgICBkYXRhID0gX2FyZ3MzNy5sZW5ndGggPiAxICYmIF9hcmdzMzdbMV0gIT09IHVuZGVmaW5lZCA/IF9hcmdzMzdbMV0gOiB7fTsKICAgICAgICAgICAgICAgIGlzbG9hZGluZyA9IF9hcmdzMzcubGVuZ3RoID4gMiA/IF9hcmdzMzdbMl0gOiB1bmRlZmluZWQ7CiAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQzNy5hYnJ1cHQoInJldHVybiIsIEh0dHAuZ2V0SW5zdGFuY2UoKS5wb3N0KCIvIi5jb25jYXQodGhpcy5BUFBERU5BTUUsICIvIikuY29uY2F0KGRhdGFbdGhpcy5BUFBERUtFWV0sICIvd2ZjbG9zZSIpLCBkYXRhLCBpc2xvYWRpbmcpKTsKCiAgICAgICAgICAgICAgY2FzZSA0OgogICAgICAgICAgICAgIGNhc2UgImVuZCI6CiAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQzNy5zdG9wKCk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9LCBfY2FsbGVlMzcsIHRoaXMpOwogICAgICB9KSk7CgogICAgICBmdW5jdGlvbiBXRkNsb3NlKCkgewogICAgICAgIHJldHVybiBfV0ZDbG9zZS5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwogICAgICB9CgogICAgICByZXR1cm4gV0ZDbG9zZTsKICAgIH0oKQogICAgLyoqDQogICAgICogV0ZNYXJrUmVhZOaOpeWPo+aWueazlQ0KICAgICAqDQogICAgICogQHBhcmFtIHsqfSBbY29udGV4dD17fV0NCiAgICAgKiBAcGFyYW0geyp9IFtkYXRhPXt9XQ0KICAgICAqIEBwYXJhbSB7Ym9vbGVhbn0gW2lzbG9hZGluZ10NCiAgICAgKiBAcmV0dXJucyB7UHJvbWlzZTxhbnk+fQ0KICAgICAqIEBtZW1iZXJvZiBFbnRpdHlTZXJ2aWNlDQogICAgICovCgogIH0sIHsKICAgIGtleTogIldGTWFya1JlYWQiLAogICAgdmFsdWU6IGZ1bmN0aW9uICgpIHsKICAgICAgdmFyIF9XRk1hcmtSZWFkID0gX2FzeW5jVG9HZW5lcmF0b3IoCiAgICAgIC8qI19fUFVSRV9fKi8KICAgICAgcmVnZW5lcmF0b3JSdW50aW1lLm1hcmsoZnVuY3Rpb24gX2NhbGxlZTM4KCkgewogICAgICAgIHZhciBjb250ZXh0LAogICAgICAgICAgICBkYXRhLAogICAgICAgICAgICBpc2xvYWRpbmcsCiAgICAgICAgICAgIF9hcmdzMzggPSBhcmd1bWVudHM7CiAgICAgICAgcmV0dXJuIHJlZ2VuZXJhdG9yUnVudGltZS53cmFwKGZ1bmN0aW9uIF9jYWxsZWUzOCQoX2NvbnRleHQzOCkgewogICAgICAgICAgd2hpbGUgKDEpIHsKICAgICAgICAgICAgc3dpdGNoIChfY29udGV4dDM4LnByZXYgPSBfY29udGV4dDM4Lm5leHQpIHsKICAgICAgICAgICAgICBjYXNlIDA6CiAgICAgICAgICAgICAgICBjb250ZXh0ID0gX2FyZ3MzOC5sZW5ndGggPiAwICYmIF9hcmdzMzhbMF0gIT09IHVuZGVmaW5lZCA/IF9hcmdzMzhbMF0gOiB7fTsKICAgICAgICAgICAgICAgIGRhdGEgPSBfYXJnczM4Lmxlbmd0aCA+IDEgJiYgX2FyZ3MzOFsxXSAhPT0gdW5kZWZpbmVkID8gX2FyZ3MzOFsxXSA6IHt9OwogICAgICAgICAgICAgICAgaXNsb2FkaW5nID0gX2FyZ3MzOC5sZW5ndGggPiAyID8gX2FyZ3MzOFsyXSA6IHVuZGVmaW5lZDsKICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDM4LmFicnVwdCgicmV0dXJuIiwgSHR0cC5nZXRJbnN0YW5jZSgpLnBvc3QoIi8iLmNvbmNhdCh0aGlzLkFQUERFTkFNRSwgIi8iKS5jb25jYXQoZGF0YVt0aGlzLkFQUERFS0VZXSwgIi93Zm1hcmtyZWFkIiksIGRhdGEsIGlzbG9hZGluZykpOwoKICAgICAgICAgICAgICBjYXNlIDQ6CiAgICAgICAgICAgICAgY2FzZSAiZW5kIjoKICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDM4LnN0b3AoKTsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0sIF9jYWxsZWUzOCwgdGhpcyk7CiAgICAgIH0pKTsKCiAgICAgIGZ1bmN0aW9uIFdGTWFya1JlYWQoKSB7CiAgICAgICAgcmV0dXJuIF9XRk1hcmtSZWFkLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7CiAgICAgIH0KCiAgICAgIHJldHVybiBXRk1hcmtSZWFkOwogICAgfSgpCiAgICAvKioNCiAgICAgKiBXRkdvdG/mjqXlj6Pmlrnms5UNCiAgICAgKg0KICAgICAqIEBwYXJhbSB7Kn0gW2NvbnRleHQ9e31dDQogICAgICogQHBhcmFtIHsqfSBbZGF0YT17fV0NCiAgICAgKiBAcGFyYW0ge2Jvb2xlYW59IFtpc2xvYWRpbmddDQogICAgICogQHJldHVybnMge1Byb21pc2U8YW55Pn0NCiAgICAgKiBAbWVtYmVyb2YgRW50aXR5U2VydmljZQ0KICAgICAqLwoKICB9LCB7CiAgICBrZXk6ICJXRkdvdG8iLAogICAgdmFsdWU6IGZ1bmN0aW9uICgpIHsKICAgICAgdmFyIF9XRkdvdG8gPSBfYXN5bmNUb0dlbmVyYXRvcigKICAgICAgLyojX19QVVJFX18qLwogICAgICByZWdlbmVyYXRvclJ1bnRpbWUubWFyayhmdW5jdGlvbiBfY2FsbGVlMzkoKSB7CiAgICAgICAgdmFyIGNvbnRleHQsCiAgICAgICAgICAgIGRhdGEsCiAgICAgICAgICAgIGlzbG9hZGluZywKICAgICAgICAgICAgX2FyZ3MzOSA9IGFyZ3VtZW50czsKICAgICAgICByZXR1cm4gcmVnZW5lcmF0b3JSdW50aW1lLndyYXAoZnVuY3Rpb24gX2NhbGxlZTM5JChfY29udGV4dDM5KSB7CiAgICAgICAgICB3aGlsZSAoMSkgewogICAgICAgICAgICBzd2l0Y2ggKF9jb250ZXh0MzkucHJldiA9IF9jb250ZXh0MzkubmV4dCkgewogICAgICAgICAgICAgIGNhc2UgMDoKICAgICAgICAgICAgICAgIGNvbnRleHQgPSBfYXJnczM5Lmxlbmd0aCA+IDAgJiYgX2FyZ3MzOVswXSAhPT0gdW5kZWZpbmVkID8gX2FyZ3MzOVswXSA6IHt9OwogICAgICAgICAgICAgICAgZGF0YSA9IF9hcmdzMzkubGVuZ3RoID4gMSAmJiBfYXJnczM5WzFdICE9PSB1bmRlZmluZWQgPyBfYXJnczM5WzFdIDoge307CiAgICAgICAgICAgICAgICBpc2xvYWRpbmcgPSBfYXJnczM5Lmxlbmd0aCA+IDIgPyBfYXJnczM5WzJdIDogdW5kZWZpbmVkOwogICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0MzkuYWJydXB0KCJyZXR1cm4iLCBIdHRwLmdldEluc3RhbmNlKCkucG9zdCgiLyIuY29uY2F0KHRoaXMuQVBQREVOQU1FLCAiLyIpLmNvbmNhdChkYXRhW3RoaXMuQVBQREVLRVldLCAiL3dmZ290byIpLCBkYXRhLCBpc2xvYWRpbmcpKTsKCiAgICAgICAgICAgICAgY2FzZSA0OgogICAgICAgICAgICAgIGNhc2UgImVuZCI6CiAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQzOS5zdG9wKCk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9LCBfY2FsbGVlMzksIHRoaXMpOwogICAgICB9KSk7CgogICAgICBmdW5jdGlvbiBXRkdvdG8oKSB7CiAgICAgICAgcmV0dXJuIF9XRkdvdG8uYXBwbHkodGhpcywgYXJndW1lbnRzKTsKICAgICAgfQoKICAgICAgcmV0dXJuIFdGR290bzsKICAgIH0oKQogICAgLyoqDQogICAgICogV0ZSb2xsYmFja+aOpeWPo+aWueazlQ0KICAgICAqDQogICAgICogQHBhcmFtIHsqfSBbY29udGV4dD17fV0NCiAgICAgKiBAcGFyYW0geyp9IFtkYXRhPXt9XQ0KICAgICAqIEBwYXJhbSB7Ym9vbGVhbn0gW2lzbG9hZGluZ10NCiAgICAgKiBAcmV0dXJucyB7UHJvbWlzZTxhbnk+fQ0KICAgICAqIEBtZW1iZXJvZiBFbnRpdHlTZXJ2aWNlDQogICAgICovCgogIH0sIHsKICAgIGtleTogIldGUm9sbGJhY2siLAogICAgdmFsdWU6IGZ1bmN0aW9uICgpIHsKICAgICAgdmFyIF9XRlJvbGxiYWNrID0gX2FzeW5jVG9HZW5lcmF0b3IoCiAgICAgIC8qI19fUFVSRV9fKi8KICAgICAgcmVnZW5lcmF0b3JSdW50aW1lLm1hcmsoZnVuY3Rpb24gX2NhbGxlZTQwKCkgewogICAgICAgIHZhciBjb250ZXh0LAogICAgICAgICAgICBkYXRhLAogICAgICAgICAgICBpc2xvYWRpbmcsCiAgICAgICAgICAgIF9hcmdzNDAgPSBhcmd1bWVudHM7CiAgICAgICAgcmV0dXJuIHJlZ2VuZXJhdG9yUnVudGltZS53cmFwKGZ1bmN0aW9uIF9jYWxsZWU0MCQoX2NvbnRleHQ0MCkgewogICAgICAgICAgd2hpbGUgKDEpIHsKICAgICAgICAgICAgc3dpdGNoIChfY29udGV4dDQwLnByZXYgPSBfY29udGV4dDQwLm5leHQpIHsKICAgICAgICAgICAgICBjYXNlIDA6CiAgICAgICAgICAgICAgICBjb250ZXh0ID0gX2FyZ3M0MC5sZW5ndGggPiAwICYmIF9hcmdzNDBbMF0gIT09IHVuZGVmaW5lZCA/IF9hcmdzNDBbMF0gOiB7fTsKICAgICAgICAgICAgICAgIGRhdGEgPSBfYXJnczQwLmxlbmd0aCA+IDEgJiYgX2FyZ3M0MFsxXSAhPT0gdW5kZWZpbmVkID8gX2FyZ3M0MFsxXSA6IHt9OwogICAgICAgICAgICAgICAgaXNsb2FkaW5nID0gX2FyZ3M0MC5sZW5ndGggPiAyID8gX2FyZ3M0MFsyXSA6IHVuZGVmaW5lZDsKICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDQwLmFicnVwdCgicmV0dXJuIiwgSHR0cC5nZXRJbnN0YW5jZSgpLnBvc3QoIi8iLmNvbmNhdCh0aGlzLkFQUERFTkFNRSwgIi8iKS5jb25jYXQoZGF0YVt0aGlzLkFQUERFS0VZXSwgIi93ZnJvbGxiYWNrIiksIGRhdGEsIGlzbG9hZGluZykpOwoKICAgICAgICAgICAgICBjYXNlIDQ6CiAgICAgICAgICAgICAgY2FzZSAiZW5kIjoKICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDQwLnN0b3AoKTsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0sIF9jYWxsZWU0MCwgdGhpcyk7CiAgICAgIH0pKTsKCiAgICAgIGZ1bmN0aW9uIFdGUm9sbGJhY2soKSB7CiAgICAgICAgcmV0dXJuIF9XRlJvbGxiYWNrLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7CiAgICAgIH0KCiAgICAgIHJldHVybiBXRlJvbGxiYWNrOwogICAgfSgpCiAgICAvKioNCiAgICAgKiBXRlJlc3RhcnTmjqXlj6Pmlrnms5UNCiAgICAgKg0KICAgICAqIEBwYXJhbSB7Kn0gW2NvbnRleHQ9e31dDQogICAgICogQHBhcmFtIHsqfSBbZGF0YT17fV0NCiAgICAgKiBAcGFyYW0ge2Jvb2xlYW59IFtpc2xvYWRpbmddDQogICAgICogQHJldHVybnMge1Byb21pc2U8YW55Pn0NCiAgICAgKiBAbWVtYmVyb2YgRW50aXR5U2VydmljZQ0KICAgICAqLwoKICB9LCB7CiAgICBrZXk6ICJXRlJlc3RhcnQiLAogICAgdmFsdWU6IGZ1bmN0aW9uICgpIHsKICAgICAgdmFyIF9XRlJlc3RhcnQgPSBfYXN5bmNUb0dlbmVyYXRvcigKICAgICAgLyojX19QVVJFX18qLwogICAgICByZWdlbmVyYXRvclJ1bnRpbWUubWFyayhmdW5jdGlvbiBfY2FsbGVlNDEoKSB7CiAgICAgICAgdmFyIGNvbnRleHQsCiAgICAgICAgICAgIGRhdGEsCiAgICAgICAgICAgIGlzbG9hZGluZywKICAgICAgICAgICAgX2FyZ3M0MSA9IGFyZ3VtZW50czsKICAgICAgICByZXR1cm4gcmVnZW5lcmF0b3JSdW50aW1lLndyYXAoZnVuY3Rpb24gX2NhbGxlZTQxJChfY29udGV4dDQxKSB7CiAgICAgICAgICB3aGlsZSAoMSkgewogICAgICAgICAgICBzd2l0Y2ggKF9jb250ZXh0NDEucHJldiA9IF9jb250ZXh0NDEubmV4dCkgewogICAgICAgICAgICAgIGNhc2UgMDoKICAgICAgICAgICAgICAgIGNvbnRleHQgPSBfYXJnczQxLmxlbmd0aCA+IDAgJiYgX2FyZ3M0MVswXSAhPT0gdW5kZWZpbmVkID8gX2FyZ3M0MVswXSA6IHt9OwogICAgICAgICAgICAgICAgZGF0YSA9IF9hcmdzNDEubGVuZ3RoID4gMSAmJiBfYXJnczQxWzFdICE9PSB1bmRlZmluZWQgPyBfYXJnczQxWzFdIDoge307CiAgICAgICAgICAgICAgICBpc2xvYWRpbmcgPSBfYXJnczQxLmxlbmd0aCA+IDIgPyBfYXJnczQxWzJdIDogdW5kZWZpbmVkOwogICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0NDEuYWJydXB0KCJyZXR1cm4iLCBIdHRwLmdldEluc3RhbmNlKCkucG9zdCgiLyIuY29uY2F0KHRoaXMuQVBQREVOQU1FLCAiLyIpLmNvbmNhdChkYXRhW3RoaXMuQVBQREVLRVldLCAiL3dmcmVzdGFydCIpLCBkYXRhLCBpc2xvYWRpbmcpKTsKCiAgICAgICAgICAgICAgY2FzZSA0OgogICAgICAgICAgICAgIGNhc2UgImVuZCI6CiAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQ0MS5zdG9wKCk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9LCBfY2FsbGVlNDEsIHRoaXMpOwogICAgICB9KSk7CgogICAgICBmdW5jdGlvbiBXRlJlc3RhcnQoKSB7CiAgICAgICAgcmV0dXJuIF9XRlJlc3RhcnQuYXBwbHkodGhpcywgYXJndW1lbnRzKTsKICAgICAgfQoKICAgICAgcmV0dXJuIFdGUmVzdGFydDsKICAgIH0oKQogICAgLyoqDQogICAgICogV0ZSZWFzc2lnbuaOpeWPo+aWueazlQ0KICAgICAqDQogICAgICogQHBhcmFtIHsqfSBbY29udGV4dD17fV0NCiAgICAgKiBAcGFyYW0geyp9IFtkYXRhPXt9XQ0KICAgICAqIEBwYXJhbSB7Ym9vbGVhbn0gW2lzbG9hZGluZ10NCiAgICAgKiBAcmV0dXJucyB7UHJvbWlzZTxhbnk+fQ0KICAgICAqIEBtZW1iZXJvZiBFbnRpdHlTZXJ2aWNlDQogICAgICovCgogIH0sIHsKICAgIGtleTogIldGUmVhc3NpZ24iLAogICAgdmFsdWU6IGZ1bmN0aW9uICgpIHsKICAgICAgdmFyIF9XRlJlYXNzaWduID0gX2FzeW5jVG9HZW5lcmF0b3IoCiAgICAgIC8qI19fUFVSRV9fKi8KICAgICAgcmVnZW5lcmF0b3JSdW50aW1lLm1hcmsoZnVuY3Rpb24gX2NhbGxlZTQyKCkgewogICAgICAgIHZhciBjb250ZXh0LAogICAgICAgICAgICBkYXRhLAogICAgICAgICAgICBpc2xvYWRpbmcsCiAgICAgICAgICAgIF9hcmdzNDIgPSBhcmd1bWVudHM7CiAgICAgICAgcmV0dXJuIHJlZ2VuZXJhdG9yUnVudGltZS53cmFwKGZ1bmN0aW9uIF9jYWxsZWU0MiQoX2NvbnRleHQ0MikgewogICAgICAgICAgd2hpbGUgKDEpIHsKICAgICAgICAgICAgc3dpdGNoIChfY29udGV4dDQyLnByZXYgPSBfY29udGV4dDQyLm5leHQpIHsKICAgICAgICAgICAgICBjYXNlIDA6CiAgICAgICAgICAgICAgICBjb250ZXh0ID0gX2FyZ3M0Mi5sZW5ndGggPiAwICYmIF9hcmdzNDJbMF0gIT09IHVuZGVmaW5lZCA/IF9hcmdzNDJbMF0gOiB7fTsKICAgICAgICAgICAgICAgIGRhdGEgPSBfYXJnczQyLmxlbmd0aCA+IDEgJiYgX2FyZ3M0MlsxXSAhPT0gdW5kZWZpbmVkID8gX2FyZ3M0MlsxXSA6IHt9OwogICAgICAgICAgICAgICAgaXNsb2FkaW5nID0gX2FyZ3M0Mi5sZW5ndGggPiAyID8gX2FyZ3M0MlsyXSA6IHVuZGVmaW5lZDsKICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDQyLmFicnVwdCgicmV0dXJuIiwgSHR0cC5nZXRJbnN0YW5jZSgpLnBvc3QoIi8iLmNvbmNhdCh0aGlzLkFQUERFTkFNRSwgIi8iKS5jb25jYXQoZGF0YVt0aGlzLkFQUERFS0VZXSwgIi93ZnJlYXNzaWduIiksIGRhdGEsIGlzbG9hZGluZykpOwoKICAgICAgICAgICAgICBjYXNlIDQ6CiAgICAgICAgICAgICAgY2FzZSAiZW5kIjoKICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDQyLnN0b3AoKTsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0sIF9jYWxsZWU0MiwgdGhpcyk7CiAgICAgIH0pKTsKCiAgICAgIGZ1bmN0aW9uIFdGUmVhc3NpZ24oKSB7CiAgICAgICAgcmV0dXJuIF9XRlJlYXNzaWduLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7CiAgICAgIH0KCiAgICAgIHJldHVybiBXRlJlYXNzaWduOwogICAgfSgpCiAgICAvKioNCiAgICAgKiBXRkdldFdvcmtGbG935o6l5Y+j5pa55rOVKOiOt+WPluW3peS9nOa1geWumuS5iSkNCiAgICAgKg0KICAgICAqIEBwYXJhbSB7Kn0gW2NvbnRleHQ9e31dDQogICAgICogQHBhcmFtIHsqfSBbZGF0YT17fV0NCiAgICAgKiBAcGFyYW0ge2Jvb2xlYW59IFtpc2xvYWRpbmddDQogICAgICogQHJldHVybnMge1Byb21pc2U8YW55Pn0NCiAgICAgKiBAbWVtYmVyb2YgRW50aXR5U2VydmljZQ0KICAgICAqLwoKICB9LCB7CiAgICBrZXk6ICJXRkdldFdvcmtGbG93IiwKICAgIHZhbHVlOiBmdW5jdGlvbiAoKSB7CiAgICAgIHZhciBfV0ZHZXRXb3JrRmxvdyA9IF9hc3luY1RvR2VuZXJhdG9yKAogICAgICAvKiNfX1BVUkVfXyovCiAgICAgIHJlZ2VuZXJhdG9yUnVudGltZS5tYXJrKGZ1bmN0aW9uIF9jYWxsZWU0MygpIHsKICAgICAgICB2YXIgY29udGV4dCwKICAgICAgICAgICAgZGF0YSwKICAgICAgICAgICAgaXNsb2FkaW5nLAogICAgICAgICAgICBfYXJnczQzID0gYXJndW1lbnRzOwogICAgICAgIHJldHVybiByZWdlbmVyYXRvclJ1bnRpbWUud3JhcChmdW5jdGlvbiBfY2FsbGVlNDMkKF9jb250ZXh0NDMpIHsKICAgICAgICAgIHdoaWxlICgxKSB7CiAgICAgICAgICAgIHN3aXRjaCAoX2NvbnRleHQ0My5wcmV2ID0gX2NvbnRleHQ0My5uZXh0KSB7CiAgICAgICAgICAgICAgY2FzZSAwOgogICAgICAgICAgICAgICAgY29udGV4dCA9IF9hcmdzNDMubGVuZ3RoID4gMCAmJiBfYXJnczQzWzBdICE9PSB1bmRlZmluZWQgPyBfYXJnczQzWzBdIDoge307CiAgICAgICAgICAgICAgICBkYXRhID0gX2FyZ3M0My5sZW5ndGggPiAxICYmIF9hcmdzNDNbMV0gIT09IHVuZGVmaW5lZCA/IF9hcmdzNDNbMV0gOiB7fTsKICAgICAgICAgICAgICAgIGlzbG9hZGluZyA9IF9hcmdzNDMubGVuZ3RoID4gMiA/IF9hcmdzNDNbMl0gOiB1bmRlZmluZWQ7CiAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQ0My5hYnJ1cHQoInJldHVybiIsIEh0dHAuZ2V0SW5zdGFuY2UoKS5nZXQoIi93ZmNvcmUvIi5jb25jYXQodGhpcy5TWVNURU1OQU1FLCAiLWFwcC0iKS5jb25jYXQodGhpcy5BUFBOQU1FLCAiLyIpLmNvbmNhdCh0aGlzLkFQUERFTkFNRSwgIi9wcm9jZXNzLWRlZmluaXRpb25zIikpKTsKCiAgICAgICAgICAgICAgY2FzZSA0OgogICAgICAgICAgICAgIGNhc2UgImVuZCI6CiAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQ0My5zdG9wKCk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9LCBfY2FsbGVlNDMsIHRoaXMpOwogICAgICB9KSk7CgogICAgICBmdW5jdGlvbiBXRkdldFdvcmtGbG93KCkgewogICAgICAgIHJldHVybiBfV0ZHZXRXb3JrRmxvdy5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwogICAgICB9CgogICAgICByZXR1cm4gV0ZHZXRXb3JrRmxvdzsKICAgIH0oKQogICAgLyoqDQogICAgICogV0ZHZXRXRlN0ZXDmjqXlj6Pmlrnms5Uo5qC55o2u57O757uf5a6e5L2T5p+l5om+5b2T5YmN6YCC6YWN55qE5bel5L2c5rWB5qih5Z6L5q2l6aqkKQ0KICAgICAqDQogICAgICogQHBhcmFtIHsqfSBbY29udGV4dD17fV0NCiAgICAgKiBAcGFyYW0geyp9IFtkYXRhPXt9XQ0KICAgICAqIEBwYXJhbSB7Ym9vbGVhbn0gW2lzbG9hZGluZ10NCiAgICAgKiBAcmV0dXJucyB7UHJvbWlzZTxhbnk+fQ0KICAgICAqIEBtZW1iZXJvZiBFbnRpdHlTZXJ2aWNlDQogICAgICovCgogIH0sIHsKICAgIGtleTogIldGR2V0V0ZTdGVwIiwKICAgIHZhbHVlOiBmdW5jdGlvbiAoKSB7CiAgICAgIHZhciBfV0ZHZXRXRlN0ZXAgPSBfYXN5bmNUb0dlbmVyYXRvcigKICAgICAgLyojX19QVVJFX18qLwogICAgICByZWdlbmVyYXRvclJ1bnRpbWUubWFyayhmdW5jdGlvbiBfY2FsbGVlNDQoKSB7CiAgICAgICAgdmFyIGNvbnRleHQsCiAgICAgICAgICAgIGRhdGEsCiAgICAgICAgICAgIGlzbG9hZGluZywKICAgICAgICAgICAgX2FyZ3M0NCA9IGFyZ3VtZW50czsKICAgICAgICByZXR1cm4gcmVnZW5lcmF0b3JSdW50aW1lLndyYXAoZnVuY3Rpb24gX2NhbGxlZTQ0JChfY29udGV4dDQ0KSB7CiAgICAgICAgICB3aGlsZSAoMSkgewogICAgICAgICAgICBzd2l0Y2ggKF9jb250ZXh0NDQucHJldiA9IF9jb250ZXh0NDQubmV4dCkgewogICAgICAgICAgICAgIGNhc2UgMDoKICAgICAgICAgICAgICAgIGNvbnRleHQgPSBfYXJnczQ0Lmxlbmd0aCA+IDAgJiYgX2FyZ3M0NFswXSAhPT0gdW5kZWZpbmVkID8gX2FyZ3M0NFswXSA6IHt9OwogICAgICAgICAgICAgICAgZGF0YSA9IF9hcmdzNDQubGVuZ3RoID4gMSAmJiBfYXJnczQ0WzFdICE9PSB1bmRlZmluZWQgPyBfYXJnczQ0WzFdIDoge307CiAgICAgICAgICAgICAgICBpc2xvYWRpbmcgPSBfYXJnczQ0Lmxlbmd0aCA+IDIgPyBfYXJnczQ0WzJdIDogdW5kZWZpbmVkOwogICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0NDQuYWJydXB0KCJyZXR1cm4iLCBIdHRwLmdldEluc3RhbmNlKCkuZ2V0KCIvd2Zjb3JlLyIuY29uY2F0KHRoaXMuU1lTVEVNTkFNRSwgIi1hcHAtIikuY29uY2F0KHRoaXMuQVBQTkFNRSwgIi8iKS5jb25jYXQodGhpcy5BUFBERU5BTUUsICIvcHJvY2Vzcy1kZWZpbml0aW9ucy1ub2RlcyIpKSk7CgogICAgICAgICAgICAgIGNhc2UgNDoKICAgICAgICAgICAgICBjYXNlICJlbmQiOgogICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0NDQuc3RvcCgpOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSwgX2NhbGxlZTQ0LCB0aGlzKTsKICAgICAgfSkpOwoKICAgICAgZnVuY3Rpb24gV0ZHZXRXRlN0ZXAoKSB7CiAgICAgICAgcmV0dXJuIF9XRkdldFdGU3RlcC5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwogICAgICB9CgogICAgICByZXR1cm4gV0ZHZXRXRlN0ZXA7CiAgICB9KCkKICAgIC8qKg0KICAgICAqIEdldFdGTGlua+aOpeWPo+aWueazlSjmoLnmja7kuJrliqHkuLvplK7lkozlvZPliY3mraXpqqTojrflj5bmk43kvZzot6/lvoQpDQogICAgICoNCiAgICAgKiBAcGFyYW0geyp9IFtjb250ZXh0PXt9XQ0KICAgICAqIEBwYXJhbSB7Kn0gW2RhdGE9e31dDQogICAgICogQHBhcmFtIHtib29sZWFufSBbaXNsb2FkaW5nXQ0KICAgICAqIEByZXR1cm5zIHtQcm9taXNlPGFueT59DQogICAgICogQG1lbWJlcm9mIEVudGl0eVNlcnZpY2UNCiAgICAgKi8KCiAgfSwgewogICAga2V5OiAiR2V0V0ZMaW5rIiwKICAgIHZhbHVlOiBmdW5jdGlvbiAoKSB7CiAgICAgIHZhciBfR2V0V0ZMaW5rID0gX2FzeW5jVG9HZW5lcmF0b3IoCiAgICAgIC8qI19fUFVSRV9fKi8KICAgICAgcmVnZW5lcmF0b3JSdW50aW1lLm1hcmsoZnVuY3Rpb24gX2NhbGxlZTQ1KCkgewogICAgICAgIHZhciBjb250ZXh0LAogICAgICAgICAgICBkYXRhLAogICAgICAgICAgICBpc2xvYWRpbmcsCiAgICAgICAgICAgIF9hcmdzNDUgPSBhcmd1bWVudHM7CiAgICAgICAgcmV0dXJuIHJlZ2VuZXJhdG9yUnVudGltZS53cmFwKGZ1bmN0aW9uIF9jYWxsZWU0NSQoX2NvbnRleHQ0NSkgewogICAgICAgICAgd2hpbGUgKDEpIHsKICAgICAgICAgICAgc3dpdGNoIChfY29udGV4dDQ1LnByZXYgPSBfY29udGV4dDQ1Lm5leHQpIHsKICAgICAgICAgICAgICBjYXNlIDA6CiAgICAgICAgICAgICAgICBjb250ZXh0ID0gX2FyZ3M0NS5sZW5ndGggPiAwICYmIF9hcmdzNDVbMF0gIT09IHVuZGVmaW5lZCA/IF9hcmdzNDVbMF0gOiB7fTsKICAgICAgICAgICAgICAgIGRhdGEgPSBfYXJnczQ1Lmxlbmd0aCA+IDEgJiYgX2FyZ3M0NVsxXSAhPT0gdW5kZWZpbmVkID8gX2FyZ3M0NVsxXSA6IHt9OwogICAgICAgICAgICAgICAgaXNsb2FkaW5nID0gX2FyZ3M0NS5sZW5ndGggPiAyID8gX2FyZ3M0NVsyXSA6IHVuZGVmaW5lZDsKICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDQ1LmFicnVwdCgicmV0dXJuIiwgSHR0cC5nZXRJbnN0YW5jZSgpLmdldCgiL3dmY29yZS8iLmNvbmNhdCh0aGlzLlNZU1RFTU5BTUUsICItYXBwLSIpLmNvbmNhdCh0aGlzLkFQUE5BTUUsICIvIikuY29uY2F0KHRoaXMuQVBQREVOQU1FLCAiLyIpLmNvbmNhdChjb250ZXh0W3RoaXMuQVBQTFlERUtFWV0sICIvdXNlcnRhc2tzLyIpLmNvbmNhdChkYXRhWyd0YXNrRGVmaW5pdGlvbktleSddLCAiL3dheXMiKSkpOwoKICAgICAgICAgICAgICBjYXNlIDQ6CiAgICAgICAgICAgICAgY2FzZSAiZW5kIjoKICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDQ1LnN0b3AoKTsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0sIF9jYWxsZWU0NSwgdGhpcyk7CiAgICAgIH0pKTsKCiAgICAgIGZ1bmN0aW9uIEdldFdGTGluaygpIHsKICAgICAgICByZXR1cm4gX0dldFdGTGluay5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwogICAgICB9CgogICAgICByZXR1cm4gR2V0V0ZMaW5rOwogICAgfSgpCiAgICAvKioNCiAgICAgKiBHZXRXRkhpc3RvcnnmjqXlj6Pmlrnms5Uo5qC55o2u5Lia5Yqh5Li76ZSu6I635Y+W5bel5L2c5rWB56iL6K6w5b2VKQ0KICAgICAqDQogICAgICogQHBhcmFtIHsqfSBbY29udGV4dD17fV0NCiAgICAgKiBAcGFyYW0geyp9IFtkYXRhPXt9XQ0KICAgICAqIEBwYXJhbSB7Ym9vbGVhbn0gW2lzbG9hZGluZ10NCiAgICAgKiBAcmV0dXJucyB7UHJvbWlzZTxhbnk+fQ0KICAgICAqIEBtZW1iZXJvZiBFbnRpdHlTZXJ2aWNlDQogICAgICovCgogIH0sIHsKICAgIGtleTogIkdldFdGSGlzdG9yeSIsCiAgICB2YWx1ZTogZnVuY3Rpb24gKCkgewogICAgICB2YXIgX0dldFdGSGlzdG9yeSA9IF9hc3luY1RvR2VuZXJhdG9yKAogICAgICAvKiNfX1BVUkVfXyovCiAgICAgIHJlZ2VuZXJhdG9yUnVudGltZS5tYXJrKGZ1bmN0aW9uIF9jYWxsZWU0NigpIHsKICAgICAgICB2YXIgY29udGV4dCwKICAgICAgICAgICAgZGF0YSwKICAgICAgICAgICAgaXNsb2FkaW5nLAogICAgICAgICAgICBfYXJnczQ2ID0gYXJndW1lbnRzOwogICAgICAgIHJldHVybiByZWdlbmVyYXRvclJ1bnRpbWUud3JhcChmdW5jdGlvbiBfY2FsbGVlNDYkKF9jb250ZXh0NDYpIHsKICAgICAgICAgIHdoaWxlICgxKSB7CiAgICAgICAgICAgIHN3aXRjaCAoX2NvbnRleHQ0Ni5wcmV2ID0gX2NvbnRleHQ0Ni5uZXh0KSB7CiAgICAgICAgICAgICAgY2FzZSAwOgogICAgICAgICAgICAgICAgY29udGV4dCA9IF9hcmdzNDYubGVuZ3RoID4gMCAmJiBfYXJnczQ2WzBdICE9PSB1bmRlZmluZWQgPyBfYXJnczQ2WzBdIDoge307CiAgICAgICAgICAgICAgICBkYXRhID0gX2FyZ3M0Ni5sZW5ndGggPiAxICYmIF9hcmdzNDZbMV0gIT09IHVuZGVmaW5lZCA/IF9hcmdzNDZbMV0gOiB7fTsKICAgICAgICAgICAgICAgIGlzbG9hZGluZyA9IF9hcmdzNDYubGVuZ3RoID4gMiA/IF9hcmdzNDZbMl0gOiB1bmRlZmluZWQ7CiAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQ0Ni5hYnJ1cHQoInJldHVybiIsIEh0dHAuZ2V0SW5zdGFuY2UoKS5nZXQoIi93ZmNvcmUvIi5jb25jYXQodGhpcy5TWVNURU1OQU1FLCAiLWFwcC0iKS5jb25jYXQodGhpcy5BUFBOQU1FLCAiLyIpLmNvbmNhdCh0aGlzLkFQUERFTkFNRSwgIi8iKS5jb25jYXQoY29udGV4dFt0aGlzLkFQUExZREVLRVldLCAiL3Byb2Nlc3MtaW5zdGFuY2VzL2FsbHMvaGlzdG9yeSIpKSk7CgogICAgICAgICAgICAgIGNhc2UgNDoKICAgICAgICAgICAgICBjYXNlICJlbmQiOgogICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0NDYuc3RvcCgpOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSwgX2NhbGxlZTQ2LCB0aGlzKTsKICAgICAgfSkpOwoKICAgICAgZnVuY3Rpb24gR2V0V0ZIaXN0b3J5KCkgewogICAgICAgIHJldHVybiBfR2V0V0ZIaXN0b3J5LmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7CiAgICAgIH0KCiAgICAgIHJldHVybiBHZXRXRkhpc3Rvcnk7CiAgICB9KCkKICAgIC8qKg0KICAgICAqIFdGU3VibWl05o6l5Y+j5pa55rOVDQogICAgICoNCiAgICAgKiBAcGFyYW0geyp9IFtjb250ZXh0PXt9XQ0KICAgICAqIEBwYXJhbSB7Kn0gW2RhdGE9e31dDQogICAgICogQHBhcmFtIHtib29sZWFufSBbaXNsb2FkaW5nXQ0KICAgICAqIEBwYXJhbSB7Kn0gW2xvY2FsZGF0YV0NCiAgICAgKiBAcmV0dXJucyB7UHJvbWlzZTxhbnk+fQ0KICAgICAqIEBtZW1iZXJvZiBFbnRpdHlTZXJ2aWNlDQogICAgICovCgogIH0sIHsKICAgIGtleTogIldGU3VibWl0IiwKICAgIHZhbHVlOiBmdW5jdGlvbiAoKSB7CiAgICAgIHZhciBfV0ZTdWJtaXQgPSBfYXN5bmNUb0dlbmVyYXRvcigKICAgICAgLyojX19QVVJFX18qLwogICAgICByZWdlbmVyYXRvclJ1bnRpbWUubWFyayhmdW5jdGlvbiBfY2FsbGVlNDcoKSB7CiAgICAgICAgdmFyIGNvbnRleHQsCiAgICAgICAgICAgIGRhdGEsCiAgICAgICAgICAgIGlzbG9hZGluZywKICAgICAgICAgICAgbG9jYWxkYXRhLAogICAgICAgICAgICByZXF1ZXN0RGF0YSwKICAgICAgICAgICAgX3JlcXVlc3REYXRhMiwKICAgICAgICAgICAgX2FyZ3M0NyA9IGFyZ3VtZW50czsKCiAgICAgICAgcmV0dXJuIHJlZ2VuZXJhdG9yUnVudGltZS53cmFwKGZ1bmN0aW9uIF9jYWxsZWU0NyQoX2NvbnRleHQ0NykgewogICAgICAgICAgd2hpbGUgKDEpIHsKICAgICAgICAgICAgc3dpdGNoIChfY29udGV4dDQ3LnByZXYgPSBfY29udGV4dDQ3Lm5leHQpIHsKICAgICAgICAgICAgICBjYXNlIDA6CiAgICAgICAgICAgICAgICBjb250ZXh0ID0gX2FyZ3M0Ny5sZW5ndGggPiAwICYmIF9hcmdzNDdbMF0gIT09IHVuZGVmaW5lZCA/IF9hcmdzNDdbMF0gOiB7fTsKICAgICAgICAgICAgICAgIGRhdGEgPSBfYXJnczQ3Lmxlbmd0aCA+IDEgJiYgX2FyZ3M0N1sxXSAhPT0gdW5kZWZpbmVkID8gX2FyZ3M0N1sxXSA6IHt9OwogICAgICAgICAgICAgICAgaXNsb2FkaW5nID0gX2FyZ3M0Ny5sZW5ndGggPiAyID8gX2FyZ3M0N1syXSA6IHVuZGVmaW5lZDsKICAgICAgICAgICAgICAgIGxvY2FsZGF0YSA9IF9hcmdzNDcubGVuZ3RoID4gMyA/IF9hcmdzNDdbM10gOiB1bmRlZmluZWQ7CgogICAgICAgICAgICAgICAgaWYgKCEobG9jYWxkYXRhICYmIE9iamVjdC5rZXlzKGxvY2FsZGF0YSkubGVuZ3RoID4gMCkpIHsKICAgICAgICAgICAgICAgICAgX2NvbnRleHQ0Ny5uZXh0ID0gMTI7CiAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIHJlcXVlc3REYXRhID0ge307CgogICAgICAgICAgICAgICAgaWYgKGRhdGEudmlld3BhcmFtcykgewogICAgICAgICAgICAgICAgICBkZWxldGUgZGF0YS52aWV3cGFyYW1zOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIE9iamVjdC5hc3NpZ24ocmVxdWVzdERhdGEsIHsKICAgICAgICAgICAgICAgICAgYWN0aXZlZGF0YTogZGF0YQogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICBPYmplY3QuYXNzaWduKHJlcXVlc3REYXRhLCBsb2NhbGRhdGEpOwogICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0NDcuYWJydXB0KCJyZXR1cm4iLCBIdHRwLmdldEluc3RhbmNlKCkucG9zdCgiL3dmY29yZS8iLmNvbmNhdCh0aGlzLlNZU1RFTU5BTUUsICItYXBwLSIpLmNvbmNhdCh0aGlzLkFQUE5BTUUsICIvIikuY29uY2F0KHRoaXMuQVBQREVOQU1FLCAiLyIpLmNvbmNhdChkYXRhW3RoaXMuQVBQREVLRVldLCAiL3Rhc2tzLyIpLmNvbmNhdChsb2NhbGRhdGFbJ3Rhc2tJZCddKSwgcmVxdWVzdERhdGEsIGlzbG9hZGluZykpOwoKICAgICAgICAgICAgICBjYXNlIDEyOgogICAgICAgICAgICAgICAgX3JlcXVlc3REYXRhMiA9IHt9OwoKICAgICAgICAgICAgICAgIGlmIChkYXRhLnNyZndmbWVtbykgewogICAgICAgICAgICAgICAgICBfcmVxdWVzdERhdGEyLnNyZndmbWVtbyA9IEpTT04ucGFyc2UoSlNPTi5zdHJpbmdpZnkoZGF0YSkpLnNyZndmbWVtbzsKICAgICAgICAgICAgICAgICAgZGVsZXRlIGRhdGEuc3Jmd2ZtZW1vOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIGlmIChkYXRhLnZpZXdwYXJhbXMpIHsKICAgICAgICAgICAgICAgICAgZGVsZXRlIGRhdGEudmlld3BhcmFtczsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBPYmplY3QuYXNzaWduKF9yZXF1ZXN0RGF0YTIsIHsKICAgICAgICAgICAgICAgICAgd2ZkYXRhOiBkYXRhCiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIE9iamVjdC5hc3NpZ24oX3JlcXVlc3REYXRhMiwgewogICAgICAgICAgICAgICAgICBvcGRhdGE6IHsKICAgICAgICAgICAgICAgICAgICBzcmZ3ZmlhdGFnOiBjb250ZXh0LnNyZndmaWF0YWcsCiAgICAgICAgICAgICAgICAgICAgc3Jmd2ZzdGVwOiBjb250ZXh0LnNyZndmc3RlcAogICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDQ3LmFicnVwdCgicmV0dXJuIiwgSHR0cC5nZXRJbnN0YW5jZSgpLnBvc3QoIi8iLmNvbmNhdCh0aGlzLkFQUERFTkFNRSwgIi8iKS5jb25jYXQoZGF0YVt0aGlzLkFQUERFS0VZXSwgIi93ZnN1Ym1pdCIpLCBfcmVxdWVzdERhdGEyLCBpc2xvYWRpbmcpKTsKCiAgICAgICAgICAgICAgY2FzZSAxODoKICAgICAgICAgICAgICBjYXNlICJlbmQiOgogICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0NDcuc3RvcCgpOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSwgX2NhbGxlZTQ3LCB0aGlzKTsKICAgICAgfSkpOwoKICAgICAgZnVuY3Rpb24gV0ZTdWJtaXQoKSB7CiAgICAgICAgcmV0dXJuIF9XRlN1Ym1pdC5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwogICAgICB9CgogICAgICByZXR1cm4gV0ZTdWJtaXQ7CiAgICB9KCkKICAgIC8qKg0KICAgICAqIFdGR2V0UHJveHlEYXRh5o6l5Y+j5pa55rOVDQogICAgICoNCiAgICAgKiBAcGFyYW0geyp9IFtjb250ZXh0PXt9XQ0KICAgICAqIEBwYXJhbSB7Kn0gW2RhdGE9e31dDQogICAgICogQHBhcmFtIHtib29sZWFufSBbaXNsb2FkaW5nXQ0KICAgICAqIEByZXR1cm5zIHtQcm9taXNlPGFueT59DQogICAgICogQG1lbWJlcm9mIEVudGl0eVNlcnZpY2UNCiAgICAgKi8KCiAgfSwgewogICAga2V5OiAiV0ZHZXRQcm94eURhdGEiLAogICAgdmFsdWU6IGZ1bmN0aW9uICgpIHsKICAgICAgdmFyIF9XRkdldFByb3h5RGF0YSA9IF9hc3luY1RvR2VuZXJhdG9yKAogICAgICAvKiNfX1BVUkVfXyovCiAgICAgIHJlZ2VuZXJhdG9yUnVudGltZS5tYXJrKGZ1bmN0aW9uIF9jYWxsZWU0OCgpIHsKICAgICAgICB2YXIgY29udGV4dCwKICAgICAgICAgICAgZGF0YSwKICAgICAgICAgICAgaXNsb2FkaW5nLAogICAgICAgICAgICBfYXJnczQ4ID0gYXJndW1lbnRzOwogICAgICAgIHJldHVybiByZWdlbmVyYXRvclJ1bnRpbWUud3JhcChmdW5jdGlvbiBfY2FsbGVlNDgkKF9jb250ZXh0NDgpIHsKICAgICAgICAgIHdoaWxlICgxKSB7CiAgICAgICAgICAgIHN3aXRjaCAoX2NvbnRleHQ0OC5wcmV2ID0gX2NvbnRleHQ0OC5uZXh0KSB7CiAgICAgICAgICAgICAgY2FzZSAwOgogICAgICAgICAgICAgICAgY29udGV4dCA9IF9hcmdzNDgubGVuZ3RoID4gMCAmJiBfYXJnczQ4WzBdICE9PSB1bmRlZmluZWQgPyBfYXJnczQ4WzBdIDoge307CiAgICAgICAgICAgICAgICBkYXRhID0gX2FyZ3M0OC5sZW5ndGggPiAxICYmIF9hcmdzNDhbMV0gIT09IHVuZGVmaW5lZCA/IF9hcmdzNDhbMV0gOiB7fTsKICAgICAgICAgICAgICAgIGlzbG9hZGluZyA9IF9hcmdzNDgubGVuZ3RoID4gMiA/IF9hcmdzNDhbMl0gOiB1bmRlZmluZWQ7CiAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQ0OC5hYnJ1cHQoInJldHVybiIsIEh0dHAuZ2V0SW5zdGFuY2UoKS5nZXQoIi8iLmNvbmNhdCh0aGlzLkFQUERFTkFNRSwgIi8iKS5jb25jYXQoY29udGV4dFt0aGlzLkFQUExZREVLRVldLCAiL3dmZ2V0cHJveHlkYXRhIiksIGRhdGEsIGlzbG9hZGluZykpOwoKICAgICAgICAgICAgICBjYXNlIDQ6CiAgICAgICAgICAgICAgY2FzZSAiZW5kIjoKICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDQ4LnN0b3AoKTsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0sIF9jYWxsZWU0OCwgdGhpcyk7CiAgICAgIH0pKTsKCiAgICAgIGZ1bmN0aW9uIFdGR2V0UHJveHlEYXRhKCkgewogICAgICAgIHJldHVybiBfV0ZHZXRQcm94eURhdGEuYXBwbHkodGhpcywgYXJndW1lbnRzKTsKICAgICAgfQoKICAgICAgcmV0dXJuIFdGR2V0UHJveHlEYXRhOwogICAgfSgpCiAgICAvKioNCiAgICAgKiDmtYvor5XmlbDmja7mmK/lkKblnKjlt6XkvZzmtYHkuK0NCiAgICAgKg0KICAgICAqIEBwYXJhbSBjb250ZXh0DQogICAgICogQHBhcmFtIGRhdGENCiAgICAgKiBAcGFyYW0gaXNsb2FkaW5nDQogICAgICovCgogIH0sIHsKICAgIGtleTogInRlc3REYXRhSW5XRiIsCiAgICB2YWx1ZTogZnVuY3Rpb24gKCkgewogICAgICB2YXIgX3Rlc3REYXRhSW5XRiA9IF9hc3luY1RvR2VuZXJhdG9yKAogICAgICAvKiNfX1BVUkVfXyovCiAgICAgIHJlZ2VuZXJhdG9yUnVudGltZS5tYXJrKGZ1bmN0aW9uIF9jYWxsZWU0OSgpIHsKICAgICAgICB2YXIgY29udGV4dCwKICAgICAgICAgICAgZGF0YSwKICAgICAgICAgICAgaXNsb2FkaW5nLAogICAgICAgICAgICBfYXJnczQ5ID0gYXJndW1lbnRzOwogICAgICAgIHJldHVybiByZWdlbmVyYXRvclJ1bnRpbWUud3JhcChmdW5jdGlvbiBfY2FsbGVlNDkkKF9jb250ZXh0NDkpIHsKICAgICAgICAgIHdoaWxlICgxKSB7CiAgICAgICAgICAgIHN3aXRjaCAoX2NvbnRleHQ0OS5wcmV2ID0gX2NvbnRleHQ0OS5uZXh0KSB7CiAgICAgICAgICAgICAgY2FzZSAwOgogICAgICAgICAgICAgICAgY29udGV4dCA9IF9hcmdzNDkubGVuZ3RoID4gMCAmJiBfYXJnczQ5WzBdICE9PSB1bmRlZmluZWQgPyBfYXJnczQ5WzBdIDoge307CiAgICAgICAgICAgICAgICBkYXRhID0gX2FyZ3M0OS5sZW5ndGggPiAxICYmIF9hcmdzNDlbMV0gIT09IHVuZGVmaW5lZCA/IF9hcmdzNDlbMV0gOiB7fTsKICAgICAgICAgICAgICAgIGlzbG9hZGluZyA9IF9hcmdzNDkubGVuZ3RoID4gMiA/IF9hcmdzNDlbMl0gOiB1bmRlZmluZWQ7CgogICAgICAgICAgICAgICAgaWYgKCEoIWNvbnRleHQuc3RhdGVGaWVsZCB8fCAhY29udGV4dC5zdGF0ZVZhbHVlKSkgewogICAgICAgICAgICAgICAgICBfY29udGV4dDQ5Lm5leHQgPSA1OwogICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQ0OS5hYnJ1cHQoInJldHVybiIsIGZhbHNlKTsKCiAgICAgICAgICAgICAgY2FzZSA1OgogICAgICAgICAgICAgICAgaWYgKCEoY29udGV4dC5zdGF0ZVZhbHVlID09IGRhdGFbY29udGV4dC5zdGF0ZUZpZWxkXSkpIHsKICAgICAgICAgICAgICAgICAgX2NvbnRleHQ0OS5uZXh0ID0gNzsKICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0NDkuYWJydXB0KCJyZXR1cm4iLCB0cnVlKTsKCiAgICAgICAgICAgICAgY2FzZSA3OgogICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0NDkuYWJydXB0KCJyZXR1cm4iLCBmYWxzZSk7CgogICAgICAgICAgICAgIGNhc2UgODoKICAgICAgICAgICAgICBjYXNlICJlbmQiOgogICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0NDkuc3RvcCgpOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSwgX2NhbGxlZTQ5KTsKICAgICAgfSkpOwoKICAgICAgZnVuY3Rpb24gdGVzdERhdGFJbldGKCkgewogICAgICAgIHJldHVybiBfdGVzdERhdGFJbldGLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7CiAgICAgIH0KCiAgICAgIHJldHVybiB0ZXN0RGF0YUluV0Y7CiAgICB9KCkKICAgIC8qKg0KICAgICAqIOa1i+ivleW9k+WJjeeUqOaIt+aYr+WQpuaPkOS6pOi/h+W3peS9nOa1gQ0KICAgICAqDQogICAgICogQHBhcmFtIGNvbnRleHQNCiAgICAgKiBAcGFyYW0gZGF0YQ0KICAgICAqIEBwYXJhbSBpc2xvYWRpbmcNCiAgICAgKi8KCiAgfSwgewogICAga2V5OiAidGVzdFVzZXJXRlN1Ym1pdCIsCiAgICB2YWx1ZTogZnVuY3Rpb24gKCkgewogICAgICB2YXIgX3Rlc3RVc2VyV0ZTdWJtaXQgPSBfYXN5bmNUb0dlbmVyYXRvcigKICAgICAgLyojX19QVVJFX18qLwogICAgICByZWdlbmVyYXRvclJ1bnRpbWUubWFyayhmdW5jdGlvbiBfY2FsbGVlNTAoKSB7CiAgICAgICAgdmFyIGNvbnRleHQsCiAgICAgICAgICAgIGRhdGEsCiAgICAgICAgICAgIGlzbG9hZGluZywKICAgICAgICAgICAgX2FyZ3M1MCA9IGFyZ3VtZW50czsKICAgICAgICByZXR1cm4gcmVnZW5lcmF0b3JSdW50aW1lLndyYXAoZnVuY3Rpb24gX2NhbGxlZTUwJChfY29udGV4dDUwKSB7CiAgICAgICAgICB3aGlsZSAoMSkgewogICAgICAgICAgICBzd2l0Y2ggKF9jb250ZXh0NTAucHJldiA9IF9jb250ZXh0NTAubmV4dCkgewogICAgICAgICAgICAgIGNhc2UgMDoKICAgICAgICAgICAgICAgIGNvbnRleHQgPSBfYXJnczUwLmxlbmd0aCA+IDAgJiYgX2FyZ3M1MFswXSAhPT0gdW5kZWZpbmVkID8gX2FyZ3M1MFswXSA6IHt9OwogICAgICAgICAgICAgICAgZGF0YSA9IF9hcmdzNTAubGVuZ3RoID4gMSAmJiBfYXJnczUwWzFdICE9PSB1bmRlZmluZWQgPyBfYXJnczUwWzFdIDoge307CiAgICAgICAgICAgICAgICBpc2xvYWRpbmcgPSBfYXJnczUwLmxlbmd0aCA+IDIgPyBfYXJnczUwWzJdIDogdW5kZWZpbmVkOwogICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0NTAuYWJydXB0KCJyZXR1cm4iLCB0cnVlKTsKCiAgICAgICAgICAgICAgY2FzZSA0OgogICAgICAgICAgICAgIGNhc2UgImVuZCI6CiAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQ1MC5zdG9wKCk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9LCBfY2FsbGVlNTApOwogICAgICB9KSk7CgogICAgICBmdW5jdGlvbiB0ZXN0VXNlcldGU3VibWl0KCkgewogICAgICAgIHJldHVybiBfdGVzdFVzZXJXRlN1Ym1pdC5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwogICAgICB9CgogICAgICByZXR1cm4gdGVzdFVzZXJXRlN1Ym1pdDsKICAgIH0oKQogICAgLyoqDQogICAgICog5rWL6K+V5b2T5YmN55So5oi35piv5ZCm5a2Y5Zyo5b6F5Yqe5YiX6KGoDQogICAgICoNCiAgICAgKiBAcGFyYW0gY29udGV4dA0KICAgICAqIEBwYXJhbSBkYXRhDQogICAgICogQHBhcmFtIGlzbG9hZGluZw0KICAgICAqLwoKICB9LCB7CiAgICBrZXk6ICJ0ZXN0VXNlckV4aXN0V29ya2xpc3QiLAogICAgdmFsdWU6IGZ1bmN0aW9uICgpIHsKICAgICAgdmFyIF90ZXN0VXNlckV4aXN0V29ya2xpc3QgPSBfYXN5bmNUb0dlbmVyYXRvcigKICAgICAgLyojX19QVVJFX18qLwogICAgICByZWdlbmVyYXRvclJ1bnRpbWUubWFyayhmdW5jdGlvbiBfY2FsbGVlNTEoKSB7CiAgICAgICAgdmFyIGNvbnRleHQsCiAgICAgICAgICAgIGRhdGEsCiAgICAgICAgICAgIGlzbG9hZGluZywKICAgICAgICAgICAgcmVxdWVzdERhdGEsCiAgICAgICAgICAgIF9hcmdzNTEgPSBhcmd1bWVudHM7CiAgICAgICAgcmV0dXJuIHJlZ2VuZXJhdG9yUnVudGltZS53cmFwKGZ1bmN0aW9uIF9jYWxsZWU1MSQoX2NvbnRleHQ1MSkgewogICAgICAgICAgd2hpbGUgKDEpIHsKICAgICAgICAgICAgc3dpdGNoIChfY29udGV4dDUxLnByZXYgPSBfY29udGV4dDUxLm5leHQpIHsKICAgICAgICAgICAgICBjYXNlIDA6CiAgICAgICAgICAgICAgICBjb250ZXh0ID0gX2FyZ3M1MS5sZW5ndGggPiAwICYmIF9hcmdzNTFbMF0gIT09IHVuZGVmaW5lZCA/IF9hcmdzNTFbMF0gOiB7fTsKICAgICAgICAgICAgICAgIGRhdGEgPSBfYXJnczUxLmxlbmd0aCA+IDEgJiYgX2FyZ3M1MVsxXSAhPT0gdW5kZWZpbmVkID8gX2FyZ3M1MVsxXSA6IHt9OwogICAgICAgICAgICAgICAgaXNsb2FkaW5nID0gX2FyZ3M1MS5sZW5ndGggPiAyID8gX2FyZ3M1MVsyXSA6IHVuZGVmaW5lZDsKICAgICAgICAgICAgICAgIHJlcXVlc3REYXRhID0ge307CiAgICAgICAgICAgICAgICBPYmplY3QuYXNzaWduKHJlcXVlc3REYXRhLCB7CiAgICAgICAgICAgICAgICAgIHdmZGF0YTogZGF0YQogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQ1MS5hYnJ1cHQoInJldHVybiIsIEh0dHAuZ2V0SW5zdGFuY2UoKS5wb3N0KCIvIi5jb25jYXQodGhpcy5BUFBERU5BTUUsICIvIikuY29uY2F0KGRhdGFbdGhpcy5BUFBERUtFWV0sICIvdGVzdHVzZXJleGlzdHdvcmtsaXN0IiksIHJlcXVlc3REYXRhLCBpc2xvYWRpbmcpKTsKCiAgICAgICAgICAgICAgY2FzZSA2OgogICAgICAgICAgICAgIGNhc2UgImVuZCI6CiAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQ1MS5zdG9wKCk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9LCBfY2FsbGVlNTEsIHRoaXMpOwogICAgICB9KSk7CgogICAgICBmdW5jdGlvbiB0ZXN0VXNlckV4aXN0V29ya2xpc3QoKSB7CiAgICAgICAgcmV0dXJuIF90ZXN0VXNlckV4aXN0V29ya2xpc3QuYXBwbHkodGhpcywgYXJndW1lbnRzKTsKICAgICAgfQoKICAgICAgcmV0dXJuIHRlc3RVc2VyRXhpc3RXb3JrbGlzdDsKICAgIH0oKQogICAgLyoqDQogICAgICog6I635Y+W5omA5pyJ5bqU55So5pWw5o2uDQogICAgICoNCiAgICAgKiBAcGFyYW0gY29udGV4dA0KICAgICAqIEBwYXJhbSBkYXRhDQogICAgICogQHBhcmFtIGlzbG9hZGluZw0KICAgICAqLwoKICB9LCB7CiAgICBrZXk6ICJnZXRBbGxBcHAiLAogICAgdmFsdWU6IGZ1bmN0aW9uICgpIHsKICAgICAgdmFyIF9nZXRBbGxBcHAgPSBfYXN5bmNUb0dlbmVyYXRvcigKICAgICAgLyojX19QVVJFX18qLwogICAgICByZWdlbmVyYXRvclJ1bnRpbWUubWFyayhmdW5jdGlvbiBfY2FsbGVlNTIoKSB7CiAgICAgICAgdmFyIGNvbnRleHQsCiAgICAgICAgICAgIGRhdGEsCiAgICAgICAgICAgIGlzbG9hZGluZywKICAgICAgICAgICAgX2FyZ3M1MiA9IGFyZ3VtZW50czsKICAgICAgICByZXR1cm4gcmVnZW5lcmF0b3JSdW50aW1lLndyYXAoZnVuY3Rpb24gX2NhbGxlZTUyJChfY29udGV4dDUyKSB7CiAgICAgICAgICB3aGlsZSAoMSkgewogICAgICAgICAgICBzd2l0Y2ggKF9jb250ZXh0NTIucHJldiA9IF9jb250ZXh0NTIubmV4dCkgewogICAgICAgICAgICAgIGNhc2UgMDoKICAgICAgICAgICAgICAgIGNvbnRleHQgPSBfYXJnczUyLmxlbmd0aCA+IDAgJiYgX2FyZ3M1MlswXSAhPT0gdW5kZWZpbmVkID8gX2FyZ3M1MlswXSA6IHt9OwogICAgICAgICAgICAgICAgZGF0YSA9IF9hcmdzNTIubGVuZ3RoID4gMSAmJiBfYXJnczUyWzFdICE9PSB1bmRlZmluZWQgPyBfYXJnczUyWzFdIDoge307CiAgICAgICAgICAgICAgICBpc2xvYWRpbmcgPSBfYXJnczUyLmxlbmd0aCA+IDIgPyBfYXJnczUyWzJdIDogdW5kZWZpbmVkOwogICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0NTIuYWJydXB0KCJyZXR1cm4iLCBIdHRwLmdldEluc3RhbmNlKCkuZ2V0KCJ1YWEvYWNjZXNzLWNlbnRlci9hcHAtc3dpdGNoZXIvZGVmYXVsdCIsIGRhdGEsIGlzbG9hZGluZykpOwoKICAgICAgICAgICAgICBjYXNlIDQ6CiAgICAgICAgICAgICAgY2FzZSAiZW5kIjoKICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDUyLnN0b3AoKTsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0sIF9jYWxsZWU1Mik7CiAgICAgIH0pKTsKCiAgICAgIGZ1bmN0aW9uIGdldEFsbEFwcCgpIHsKICAgICAgICByZXR1cm4gX2dldEFsbEFwcC5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwogICAgICB9CgogICAgICByZXR1cm4gZ2V0QWxsQXBwOwogICAgfSgpCiAgICAvKioNCiAgICAgKiDmm7TmlrDlt7LpgInmi6nnmoTlupTnlKgNCiAgICAgKg0KICAgICAqIEBwYXJhbSBjb250ZXh0DQogICAgICogQHBhcmFtIGRhdGENCiAgICAgKiBAcGFyYW0gaXNsb2FkaW5nDQogICAgICovCgogIH0sIHsKICAgIGtleTogInVwZGF0ZUNob29zZUFwcCIsCiAgICB2YWx1ZTogZnVuY3Rpb24gKCkgewogICAgICB2YXIgX3VwZGF0ZUNob29zZUFwcCA9IF9hc3luY1RvR2VuZXJhdG9yKAogICAgICAvKiNfX1BVUkVfXyovCiAgICAgIHJlZ2VuZXJhdG9yUnVudGltZS5tYXJrKGZ1bmN0aW9uIF9jYWxsZWU1MygpIHsKICAgICAgICB2YXIgY29udGV4dCwKICAgICAgICAgICAgZGF0YSwKICAgICAgICAgICAgaXNsb2FkaW5nLAogICAgICAgICAgICBfYXJnczUzID0gYXJndW1lbnRzOwogICAgICAgIHJldHVybiByZWdlbmVyYXRvclJ1bnRpbWUud3JhcChmdW5jdGlvbiBfY2FsbGVlNTMkKF9jb250ZXh0NTMpIHsKICAgICAgICAgIHdoaWxlICgxKSB7CiAgICAgICAgICAgIHN3aXRjaCAoX2NvbnRleHQ1My5wcmV2ID0gX2NvbnRleHQ1My5uZXh0KSB7CiAgICAgICAgICAgICAgY2FzZSAwOgogICAgICAgICAgICAgICAgY29udGV4dCA9IF9hcmdzNTMubGVuZ3RoID4gMCAmJiBfYXJnczUzWzBdICE9PSB1bmRlZmluZWQgPyBfYXJnczUzWzBdIDoge307CiAgICAgICAgICAgICAgICBkYXRhID0gX2FyZ3M1My5sZW5ndGggPiAxICYmIF9hcmdzNTNbMV0gIT09IHVuZGVmaW5lZCA/IF9hcmdzNTNbMV0gOiB7fTsKICAgICAgICAgICAgICAgIGlzbG9hZGluZyA9IF9hcmdzNTMubGVuZ3RoID4gMiA/IF9hcmdzNTNbMl0gOiB1bmRlZmluZWQ7CiAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQ1My5hYnJ1cHQoInJldHVybiIsIEh0dHAuZ2V0SW5zdGFuY2UoKS5wdXQoInVhYS9hY2Nlc3MtY2VudGVyL2FwcC1zd2l0Y2hlci9kZWZhdWx0IiwgZGF0YSwgaXNsb2FkaW5nKSk7CgogICAgICAgICAgICAgIGNhc2UgNDoKICAgICAgICAgICAgICBjYXNlICJlbmQiOgogICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0NTMuc3RvcCgpOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSwgX2NhbGxlZTUzKTsKICAgICAgfSkpOwoKICAgICAgZnVuY3Rpb24gdXBkYXRlQ2hvb3NlQXBwKCkgewogICAgICAgIHJldHVybiBfdXBkYXRlQ2hvb3NlQXBwLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7CiAgICAgIH0KCiAgICAgIHJldHVybiB1cGRhdGVDaG9vc2VBcHA7CiAgICB9KCkKICB9XSk7CgogIHJldHVybiBFbnRpdHlTZXJ2aWNlOwp9KCk7CgpleHBvcnQgeyBFbnRpdHlTZXJ2aWNlIGFzIGRlZmF1bHQgfTs="},null]}
{"remainingRequest":"F:\\crod项目\\人事管理系统2\\iBizEHR\\app_EHRPim\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!F:\\crod项目\\人事管理系统2\\iBizEHR\\app_EHRPim\\src\\widgets\\pim-person\\org-person-age-chart\\org-person-age-chart-base.vue?vue&type=script&lang=tsx&","dependencies":[{"path":"F:\\crod项目\\人事管理系统2\\iBizEHR\\app_EHRPim\\src\\widgets\\pim-person\\org-person-age-chart\\org-person-age-chart-base.vue","mtime":1630509411893},{"path":"F:\\crod项目\\人事管理系统2\\iBizEHR\\app_EHRPim\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1630511852775},{"path":"F:\\crod项目\\人事管理系统2\\iBizEHR\\app_EHRPim\\node_modules\\thread-loader\\dist\\cjs.js","mtime":1630511853252},{"path":"F:\\crod项目\\人事管理系统2\\iBizEHR\\app_EHRPim\\node_modules\\babel-loader\\lib\\index.js","mtime":1630511852747},{"path":"F:\\crod项目\\人事管理系统2\\iBizEHR\\app_EHRPim\\node_modules\\ts-loader\\index.js","mtime":1630511985412},{"path":"F:\\crod项目\\人事管理系统2\\iBizEHR\\app_EHRPim\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1630511852775},{"path":"F:\\crod项目\\人事管理系统2\\iBizEHR\\app_EHRPim\\node_modules\\vue-loader\\lib\\index.js","mtime":1630512070338}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:CgoKCgoKCgoKaW1wb3J0IHsgVnVlLCBDb21wb25lbnQsIFByb3AsIFByb3ZpZGUsIEVtaXQsIFdhdGNoLCBNb2RlbCxJbmplY3QgfSBmcm9tICd2dWUtcHJvcGVydHktZGVjb3JhdG9yJzsKaW1wb3J0IHsgQ3JlYXRlRWxlbWVudCB9IGZyb20gJ3Z1ZSc7CmltcG9ydCB7IFN1YmplY3QsIFN1YnNjcmlwdGlvbiB9IGZyb20gJ3J4anMnOwppbXBvcnQgeyBDb250cm9sSW50ZXJmYWNlIH0gZnJvbSAnQC9pbnRlcmZhY2UvY29udHJvbCc7CmltcG9ydCB7IFVJQWN0aW9uVG9vbCxVdGlsIH0gZnJvbSAnQC91dGlscyc7CmltcG9ydCBOYXZEYXRhU2VydmljZSBmcm9tICdAL3NlcnZpY2UvYXBwL25hdmRhdGEtc2VydmljZSc7CmltcG9ydCBQaW1QZXJzb25TZXJ2aWNlIGZyb20gJ0Avc2VydmljZS9waW0tcGVyc29uL3BpbS1wZXJzb24tc2VydmljZSc7CmltcG9ydCBPcmdQZXJzb25BZ2VTZXJ2aWNlIGZyb20gJy4vb3JnLXBlcnNvbi1hZ2UtY2hhcnQtc2VydmljZSc7CgppbXBvcnQgZWNoYXJ0cyBmcm9tICdlY2hhcnRzJzsKaW1wb3J0IG1vbWVudCBmcm9tICJtb21lbnQiOyAKaW1wb3J0IENvZGVMaXN0U2VydmljZSBmcm9tICJAc2VydmljZS9hcHAvY29kZWxpc3Qtc2VydmljZSI7CmltcG9ydCB7IENoYXJ0RGF0YVNldEZpZWxkLENoYXJ0TGluZVNlcmllcyxDaGFydEZ1bm5lbFNlcmllcyxDaGFydFBpZVNlcmllcyxDaGFydEJhclNlcmllcyxDaGFydFJhZGFyU2VyaWVzfSBmcm9tICdAL21vZGVsL2NoYXJ0LWRldGFpbCc7CgoKQENvbXBvbmVudCh7CiAgICBjb21wb25lbnRzOiB7CiAgICAgIAogICAgfQp9KQpleHBvcnQgZGVmYXVsdCBjbGFzcyBPcmdQZXJzb25BZ2VCYXNlIGV4dGVuZHMgVnVlIGltcGxlbWVudHMgQ29udHJvbEludGVyZmFjZSB7CgogICAgLyoqCiAgICAgKiDlkI3np7AKICAgICAqCiAgICAgKiBAdHlwZSB7c3RyaW5nfQogICAgICogQG1lbWJlcm9mIE9yZ1BlcnNvbkFnZUJhc2UKICAgICAqLwogICAgQFByb3AoKSBwdWJsaWMgbmFtZT86IHN0cmluZzsKCiAgICAvKioKICAgICAqIOinhuWbvumAmuiur+WvueixoQogICAgICoKICAgICAqIEB0eXBlIHtTdWJqZWN0PFZpZXdTdGF0ZT59CiAgICAgKiBAbWVtYmVyb2YgT3JnUGVyc29uQWdlQmFzZQogICAgICovCiAgICBAUHJvcCgpIHB1YmxpYyB2aWV3U3RhdGUhOiBTdWJqZWN0PFZpZXdTdGF0ZT47CgogICAgLyoqCiAgICAgKiDlupTnlKjkuIrkuIvmlocKICAgICAqCiAgICAgKiBAdHlwZSB7Kn0KICAgICAqIEBtZW1iZXJvZiBPcmdQZXJzb25BZ2VCYXNlCiAgICAgKi8KICAgIEBQcm9wKCkgcHVibGljIGNvbnRleHQ6IGFueTsKCiAgICAvKioKICAgICAqIOinhuWbvuWPguaVsAogICAgICoKICAgICAqIEB0eXBlIHsqfQogICAgICogQG1lbWJlcm9mIE9yZ1BlcnNvbkFnZUJhc2UKICAgICAqLwogICAgQFByb3AoKSBwdWJsaWMgdmlld3BhcmFtczogYW55OwoKICAgIC8qKgogICAgICog6KeG5Zu+54q25oCB5LqL5Lu2CiAgICAgKgogICAgICogQHB1YmxpYwogICAgICogQHR5cGUgeyhTdWJzY3JpcHRpb24gfCB1bmRlZmluZWQpfQogICAgICogQG1lbWJlcm9mIE9yZ1BlcnNvbkFnZUJhc2UKICAgICAqLwogICAgcHVibGljIHZpZXdTdGF0ZUV2ZW50OiBTdWJzY3JpcHRpb24gfCB1bmRlZmluZWQ7CgogICAgLyoqCiAgICAgKiDojrflj5bpg6jku7bnsbvlnosKICAgICAqCiAgICAgKiBAcmV0dXJucyB7c3RyaW5nfQogICAgICogQG1lbWJlcm9mIE9yZ1BlcnNvbkFnZUJhc2UKICAgICAqLwogICAgcHVibGljIGdldENvbnRyb2xUeXBlKCk6IHN0cmluZyB7CiAgICAgICAgcmV0dXJuICdDSEFSVCcKICAgIH0KCgoKICAgIC8qKgogICAgICog5bu65p6E6YOo5Lu25pyN5Yqh5a+56LGhCiAgICAgKgogICAgICogQHR5cGUge09yZ1BlcnNvbkFnZVNlcnZpY2V9CiAgICAgKiBAbWVtYmVyb2YgT3JnUGVyc29uQWdlQmFzZQogICAgICovCiAgICBwdWJsaWMgc2VydmljZTogT3JnUGVyc29uQWdlU2VydmljZSA9IG5ldyBPcmdQZXJzb25BZ2VTZXJ2aWNlKHsgJHN0b3JlOiB0aGlzLiRzdG9yZSB9KTsKCiAgICAvKioKICAgICAqIOWunuS9k+acjeWKoeWvueixoQogICAgICoKICAgICAqIEB0eXBlIHtQaW1QZXJzb25TZXJ2aWNlfQogICAgICogQG1lbWJlcm9mIE9yZ1BlcnNvbkFnZUJhc2UKICAgICAqLwogICAgcHVibGljIGFwcEVudGl0eVNlcnZpY2U6IFBpbVBlcnNvblNlcnZpY2UgPSBuZXcgUGltUGVyc29uU2VydmljZSh7ICRzdG9yZTogdGhpcy4kc3RvcmUgfSk7CiAgICAKCgogICAgLyoqCiAgICAgKiDlhbPpl63op4blm74KICAgICAqCiAgICAgKiBAcGFyYW0ge2FueX0gYXJncwogICAgICogQG1lbWJlcm9mIE9yZ1BlcnNvbkFnZUJhc2UKICAgICAqLwogICAgcHVibGljIGNsb3NlVmlldyhhcmdzOiBhbnkpOiB2b2lkIHsKICAgICAgICBsZXQgX3RoaXM6IGFueSA9IHRoaXM7CiAgICAgICAgX3RoaXMuJGVtaXQoJ2Nsb3NldmlldycsIFthcmdzXSk7CiAgICB9CgogICAgLyoqCiAgICAgKiAg6K6h5pWw5Zmo5Yi35pawCiAgICAgKgogICAgICogQG1lbWJlcm9mIE9yZ1BlcnNvbkFnZUJhc2UKICAgICAqLwogICAgcHVibGljIGNvdW50ZXJSZWZyZXNoKCl7CiAgICAgICAgY29uc3QgX3RoaXM6YW55ID10aGlzOwogICAgICAgIGlmKF90aGlzLmNvdW50ZXJTZXJ2aWNlQXJyYXkgJiYgX3RoaXMuY291bnRlclNlcnZpY2VBcnJheS5sZW5ndGggPjApewogICAgICAgICAgICBfdGhpcy5jb3VudGVyU2VydmljZUFycmF5LmZvckVhY2goKGl0ZW06YW55KSA9PnsKICAgICAgICAgICAgICAgIGlmKGl0ZW0ucmVmcmVzaERhdGEgJiYgaXRlbS5yZWZyZXNoRGF0YSBpbnN0YW5jZW9mIEZ1bmN0aW9uKXsKICAgICAgICAgICAgICAgICAgICBpdGVtLnJlZnJlc2hEYXRhKCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0pCiAgICAgICAgfQogICAgfQoKCiAgICAvKioKICAgICAqIOiOt+WPluWkmumhueaVsOaNrgogICAgICoKICAgICAqIEByZXR1cm5zIHthbnlbXX0KICAgICAqIEBtZW1iZXJvZiBPcmdQZXJzb25BZ2VCYXNlCiAgICAgKi8KICAgIHB1YmxpYyBnZXREYXRhcygpOiBhbnlbXSB7CiAgICAgICAgcmV0dXJuIFtdOwogICAgfQoKICAgIC8qKgogICAgICog6I635Y+W5Y2V6aG55qCRCiAgICAgKgogICAgICogQHJldHVybnMgeyp9CiAgICAgKiBAbWVtYmVyb2YgT3JnUGVyc29uQWdlQmFzZQogICAgICovCiAgICBwdWJsaWMgZ2V0RGF0YSgpOiBhbnkgewogICAgICAgIHJldHVybiBudWxsOwogICAgfQoKICAgIC8qKgogICAgICog5pi+56S65aSE55CG5o+Q56S6CiAgICAgKgogICAgICogQHR5cGUge2Jvb2xlYW59CiAgICAgKiBAbWVtYmVyb2YgT3JnUGVyc29uQWdlQmFzZQogICAgICovCiAgICBAUHJvcCh7IGRlZmF1bHQ6IHRydWUgfSkgcHVibGljIHNob3dCdXN5SW5kaWNhdG9yITogYm9vbGVhbjsKCiAgICAvKioKICAgICAqIOmDqOS7tuihjOS4ui0tZmV0Y2gKICAgICAqCiAgICAgKiBAdHlwZSB7c3RyaW5nfQogICAgICogQG1lbWJlcm9mIE9yZ1BlcnNvbkFnZUJhc2UKICAgICAqLwogICAgQFByb3AoKSBwdWJsaWMgZmV0Y2hBY3Rpb24hOiBzdHJpbmc7ICAKCiAgICAvKioKICAgICogVnVl5aOw5piO5ZGo5pyfKOe7hOS7tuWIneWni+WMluWujOavlSkKICAgICoKICAgICogQG1lbWJlcm9mIE9yZ1BlcnNvbkFnZUJhc2UKICAgICovCiAgICBwdWJsaWMgY3JlYXRlZCgpIHsKICAgICAgICAgdGhpcy5hZnRlckNyZWF0ZWQoKTsgICAgIAogICAgfQoKICAgIC8qKgogICAgKiDmiafooYxjcmVhdGVk5ZCO55qE6YC76L6RCiAgICAqCiAgICAqIEBtZW1iZXJvZiBPcmdQZXJzb25BZ2VCYXNlCiAgICAqLwogICAgcHVibGljIGFmdGVyQ3JlYXRlZCgpewogICAgICAgIGlmICh0aGlzLnZpZXdTdGF0ZSkgewogICAgICAgICAgICB0aGlzLnZpZXdTdGF0ZUV2ZW50ID0gdGhpcy52aWV3U3RhdGUuc3Vic2NyaWJlKCh7IHRhZywgYWN0aW9uLCBkYXRhIH0pID0+IHsKICAgICAgICAgICAgICAgIGlmICghT2JqZWN0LmlzKHRhZywgdGhpcy5uYW1lKSkgewogICAgICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGlmIChPYmplY3QuaXMoJ2xvYWQnLCBhY3Rpb24pKSB7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5sb2FkKGRhdGEpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9KTsKICAgICAgICB9ICAKICAgIH0KCiAgICAvKioKICAgICAqIHZ1ZSDnlJ/lkb3lkajmnJ8KICAgICAqCiAgICAgKiBAbWVtYmVyb2YgT3JnUGVyc29uQWdlQmFzZQogICAgICovCiAgICBwdWJsaWMgZGVzdHJveWVkKCkgewogICAgICAgIHRoaXMuYWZ0ZXJEZXN0cm95KCk7CiAgICB9CgogICAgLyoqCiAgICAgKiDmiafooYxkZXN0cm95ZWTlkI7nmoTpgLvovpEKICAgICAqCiAgICAgKiBAbWVtYmVyb2YgT3JnUGVyc29uQWdlQmFzZQogICAgICovCiAgICBwdWJsaWMgYWZ0ZXJEZXN0cm95KCkgewogICAgICAgIGlmICh0aGlzLnZpZXdTdGF0ZUV2ZW50KSB7CiAgICAgICAgICAgIHRoaXMudmlld1N0YXRlRXZlbnQudW5zdWJzY3JpYmUoKTsKICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiDmmK/lkKbml6DmlbDmja4KICAgICAqCiAgICAgKiBAcHVibGljCiAgICAgKiBAdHlwZSB7Ym9vbGVhbn0KICAgICAqIEBtZW1iZXJvZiBEYl9zeXNwb3J0bGV0NF9jaGFydEJhc2UKICAgICAqLwogICAgcHVibGljIGlzTm9EYXRhOiBib29sZWFuICA9IGZhbHNlOwoKICAgIC8qKgogICAgICog5Zu+6KGoZGl257uR5a6a55qEaWQKICAgICAqCiAgICAgKiBAdHlwZSB7fQogICAgICogQG1lbWJlcm9mIERiX3N5c3BvcnRsZXQ0X2NoYXJ0QmFzZQogICAgICovICAgCiAgICBwdWJsaWMgY2hhcnRJZDpzdHJpbmcgPSB0aGlzLiR1dGlsLmNyZWF0ZVVVSUQoKTsKCiAgICAvKioKICAgICAqIGVjaGFydHPlm77ooajlr7nosaEKICAgICAqCiAgICAgKiBAdHlwZSB7fQogICAgICogQG1lbWJlcm9mIERiX3N5c3BvcnRsZXQ0X2NoYXJ0QmFzZQogICAgICovICAgCiAgICBwdWJsaWMgbXlDaGFydDphbnk7CgogICAgLyoqCiAgICAgKiDku6PnoIHooajmnI3liqHlr7nosaEKICAgICAqCiAgICAgKiBAdHlwZSB7Q29kZUxpc3RTZXJ2aWNlfQogICAgICogQG1lbWJlcm9mIERiX3N5c3BvcnRsZXQ0X2NoYXJ0QmFzZQogICAgICovICAKICAgIHB1YmxpYyBjb2RlTGlzdFNlcnZpY2U6Q29kZUxpc3RTZXJ2aWNlID0gbmV3IENvZGVMaXN0U2VydmljZSh7ICRzdG9yZTogdGhpcy4kc3RvcmUgfSk7CgogICAgLyoqCiAgICAgKiDluo/liJfmqKHlnosKICAgICAqCiAgICAgKiBAdHlwZSB7fQogICAgICogQG1lbWJlcm9mIERiX3N5c3BvcnRsZXQ0X2NoYXJ0QmFzZQogICAgICovCiAgICBwdWJsaWMgIHNlcmllc01vZGVsOmFueSA9IHsKICAgICAgICBvcmdwZXJzb25hZ2VmdW5uZWw6bmV3IENoYXJ0RnVubmVsU2VyaWVzKHsKICAgIG5hbWU6J29yZ3BlcnNvbmFnZWZ1bm5lbCcsCiAgICAKICAgIAogICAgY2F0ZWdvckZpZWxkOidhZ2V0eXBlJywKICAgIGNhdGVnb3JDb2RlTGlzdDp7dHlwZTonU1RBVElDJyx0YWc6J0VockNvZGVMaXN0MDA1NicsZW1wdHljb2RlOidlbXB0eScsZW1wdHl0ZXh0OifmnKrlrprkuYknfSwKICAgIAogICAgdmFsdWVGaWVsZDonY291bnRudW0nLAogICAgc2VyaWVzVmFsdWVzOltdLAogICAgc2VyaWVzSW5kZXg6MCwKICAgIGRhdGE6W10sCiAgICBzZXJpZXNNYXA6e30sCiAgICBkYXRhU2V0RmllbGRzOlsKICAgIHtuYW1lOiJhZ2V0eXBlIixjb2RlbGlzdDp7dHlwZToiU1RBVElDIix0YWc6IkVockNvZGVMaXN0MDA1NiIsZW1wdHljb2RlOidlbXB0eScsZW1wdHl0ZXh0OifmnKrlrprkuYknfSxpc0dyb3VwRmllbGQ6dHJ1ZSxncm91cE1vZGU6IkNPREVMSVNUIn0sCiAgICB7bmFtZToiY291bnRudW0iLGNvZGVsaXN0Om51bGwsaXNHcm91cEZpZWxkOmZhbHNlLGdyb3VwTW9kZToiIn0KICAgIF0sCiAgICBlY3hPYmplY3Q6ewogICAgICAgIGxhYmVsOnsKICAgICAgICAgICAgc2hvdzogdHJ1ZSwKICAgICAgICAgICAgcG9zaXRpb246ICdpbnNpZGUnCiAgICAgICAgfSwKICAgICAgICBsYWJlbExpbmU6ewogICAgICAgICAgICBsZW5ndGg6IDEwLAogICAgICAgICAgICBsaW5lU3R5bGU6IHsKICAgICAgICAgICAgICAgIHdpZHRoOiAxLAogICAgICAgICAgICAgICAgdHlwZTogJ3NvbGlkJwogICAgICAgICAgICB9CiAgICAgICAgfSwKICAgICAgICBpdGVtU3R5bGU6ewogICAgICAgICAgICBib3JkZXJDb2xvcjogJyNmZmYnLAogICAgICAgICAgICBib3JkZXJXaWR0aDogMQogICAgICAgIH0sCiAgICAgICAgZW1waGFzaXM6ewogICAgICAgICAgICBsYWJlbDogewogICAgICAgICAgICAgICAgZm9udFNpemU6IDIwCiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9LAogICAgZWNPYmplY3Q6ewogICAgICAgIGxhYmVsOntwb3NpdGlvbjogInJpZ2h0Iixmb3JtYXR0ZXI6J3tifSB7QGNvdW50bnVtfeS6uid9LAogICAgICAgIHJpZ2h0OiczMCUnLAogICAgICAgIHdpZHRoOic3MCUnLAogICAgICAgIGxhYmVsTGluZTp7bGVuZ3RoOiA0MH0sCiAgICAgICAgbGVmdDoxMCwKICAgIH0sCiAgICBzZXJpZXNUZW1wOnsKICAgICAgICB0eXBlOidmdW5uZWwnLAogICAgfSwKICAgIGJhc2VPcHRpb246ewogICAgfSwKICAgIHNlcmllc0xheW91dEJ5OiJjb2x1bW4iCiAgICB9KQoKICAgIH07CgogICAgLyoqCiAgICAgKiDlm77ooajoh6rlrprkuYnlj4LmlbDpm4blkIgKICAgICAqCiAgICAgKiBAbWVtYmVyb2YgRGJfc3lzcG9ydGxldDRfY2hhcnRCYXNlCiAgICAgKi8gICAKICAgIHB1YmxpYyBjaGFydFVzZXJQYXJhbXM6YW55ID17CiAgICAgICAgY29sb3I6WycjNjY0MmZmJywnIzAwZmZhYicsJyNGRkFFN0EnLCcjNDA3NkUxJywnIzQyQjNGRicsJyM4NUIzRkYnLCcjQTFGRkZGJ10KICAgIH07CgogICAgLyoqCiAgICAgKiDlm77ooajln7rnoYDliqjmgIHmqKHlnosKICAgICAqCiAgICAgKiBAbWVtYmVyb2YgRGJfc3lzcG9ydGxldDRfY2hhcnRCYXNlCiAgICAgKi8gIAogICAgcHVibGljIGNoYXJ0QmFzZU9QdGlvbjphbnkgPSB7fTsKCiAgICAvKioKICAgICAqIOWIneWni+WMluWbvuihqOaJgOmcgOWPguaVsAogICAgICoKICAgICAqIEB0eXBlIHt9CiAgICAgKiBAbWVtYmVyb2YgRGJfc3lzcG9ydGxldDRfY2hhcnRCYXNlCiAgICAgKi8gICAKICAgIHB1YmxpYyBjaGFydE9wdGlvbjphbnkgPSB7CiAgICAgICAgdGl0bGU6ewogICAgICAgICAgICBzaG93OnRydWUgLAogICAgICAgICAgICB0ZXh0OiflubTpvoTliIbluIMnLAogICAgICAgICAgICBzdWJ0ZXh0OicnCiAgICAgICAgfSwKICAgICAgICBsZWdlbmQ6ewogICAgICAgICAgICBzaG93OmZhbHNlCiAgICAgICAgfSwKICAgICAgICB0b29sdGlwOnsKICAgICAgICAgICAgc2hvdzp0cnVlCiAgICAgICAgfSwKICAgICAgICBkYXRhc2V0OltdLAogICAgICAgIHNlcmllczpbCiAgICAgICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgIGlkOidvcmdwZXJzb25hZ2VmdW5uZWwnLA0KICAgICAgICAgICAgbmFtZTon5bm06b6E5YiG5biDJywNCiAgICAgICAgICAgIHR5cGU6J2Z1bm5lbCcsDQogICAgICAgICAgICBkYXRhc2V0SW5kZXg6MCwNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgc2VyaWVzTGF5b3V0Qnk6ImNvbHVtbiIsDQogICAgICAgICAgICBlbmNvZGU6ew0KICAgICAgICAgICAgICAgIGl0ZW1OYW1lOiJhZ2V0eXBlIiwNCiAgICAgICAgICAgICAgICB2YWx1ZToiY291bnRudW0iDQogICAgICAgICAgICB9fQ0KICAgICAgICBdCiAgICB9OwoKICAgIC8qKgogICAgICog5Yi35pawCiAgICAgKgogICAgICogQHBhcmFtIHsqfSBbb3B0PXt9XQogICAgICogQG1lbWJlcm9mIERiX3N5c3BvcnRsZXQ0X2NoYXJ0QmFzZQogICAgICovCiAgICBwdWJsaWMgcmVmcmVzaChvcHQ6IGFueSA9IHt9KSB7CiAgICAgICAgdGhpcy5sb2FkKG9wdCk7CiAgICB9CgogICAgLyoqCiAgICAgKiDojrflj5blm77ooajmlbDmja4KICAgICAqIAogICAgICogQHJldHVybnMgeyp9IAogICAgICogQG1lbWJlcm9mIERiX3N5c3BvcnRsZXQ0X2NoYXJ0QmFzZQogICAgICovCiAgICBwdWJsaWMgbG9hZChvcHQ/OmFueSkgewogICAgICAgIGxldCBfdGhpcyA9IHRoaXM7CiAgICAgICAgY29uc3QgYXJnOiBhbnkgPSB7IC4uLm9wdCB9OwogICAgICAgIGNvbnN0IHBhcmVudGRhdGE6IGFueSA9IHt9OwogICAgICAgIHRoaXMuJGVtaXQoJ2JlZm9yZWxvYWQnLCBwYXJlbnRkYXRhKTsKICAgICAgICBPYmplY3QuYXNzaWduKGFyZywgcGFyZW50ZGF0YSk7CiAgICAgICAgT2JqZWN0LmFzc2lnbihhcmcse3ZpZXdwYXJhbXM6dGhpcy52aWV3cGFyYW1zLHBhZ2U6MCxzaXplOjEwMDB9KTsKICAgICAgICB0aGlzLnNlcnZpY2Uuc2VhcmNoKHRoaXMuZmV0Y2hBY3Rpb24sSlNPTi5wYXJzZShKU09OLnN0cmluZ2lmeSh0aGlzLmNvbnRleHQpKSxhcmcsdGhpcy5zaG93QnVzeUluZGljYXRvcikudGhlbigocmVzKSA9PiB7CiAgICAgICAgICAgIGlmIChyZXMpIHsKICAgICAgICAgICAgICAgdGhpcy50cmFuc2Zvcm1Ub0Jhc2ljQ2hhcnRTZXREYXRhKHJlcy5kYXRhLChjb2RlbGlzdDphbnkpID0+e190aGlzLmRyYXdDaGFydHMoY29kZWxpc3QpfSk7CiAgICAgICAgICAgIH0KICAgICAgICB9KS5jYXRjaCgoZXJyb3IpID0+IHsKICAgICAgICAgICAgY29uc29sZS5lcnJvcihlcnJvcik7CiAgICAgICAgfSk7CiAgICB9CgogICAgLyoqCiAgICAgKiDnu5jliLblm77ooagKICAgICAqIAogICAgICogQHJldHVybnMgeyp9IAogICAgICogQG1lbWJlcm9mIERiX3N5c3BvcnRsZXQ0X2NoYXJ0QmFzZQogICAgICovCiAgICBwdWJsaWMgZHJhd0NoYXJ0cyhjb2RlbGlzdDphbnkpewogICAgICAgIGlmKCF0aGlzLm15Q2hhcnQpewogICAgICAgICAgbGV0IGVsZW1lbnQ6YW55ID0gIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKHRoaXMuY2hhcnRJZCk7CiAgICAgICAgICB0aGlzLm15Q2hhcnQgPSBlY2hhcnRzLmluaXQoZWxlbWVudCk7CiAgICAgICAgfQogICAgICAgIGxldCBfY2hhcnRPcHRpb24gPSB0aGlzLmhhbmRsZUNoYXJ0T1B0aW9uKGNvZGVsaXN0KTsKICAgICAgICBjb25zb2xlLmxvZyhfY2hhcnRPcHRpb24pOwogICAgICAgIHRoaXMubXlDaGFydC5zZXRPcHRpb24oX2NoYXJ0T3B0aW9uKTsKICAgICAgICB0aGlzLm15Q2hhcnQucmVzaXplKCk7CiAgICB9CgogICAgLyoqCiAgICAgKiDlpITnkIblm77ooajlj4LmlbAKICAgICAqIAogICAgICogQG1lbWJlcm9mIERiX3N5c3BvcnRsZXQ0X2NoYXJ0QmFzZQogICAgICovCiAgICBwdWJsaWMgaGFuZGxlQ2hhcnRPUHRpb24oYWxsY29kZWxpc3Q6YW55KXsKICAgICAgICBsZXQgX2NoYXJ0T3B0aW9uOmFueSA9IEpTT04ucGFyc2UoSlNPTi5zdHJpbmdpZnkodGhpcy5jaGFydE9wdGlvbikpOwogICAgICAgIGlmKE9iamVjdC5rZXlzKHRoaXMuc2VyaWVzTW9kZWwpLmxlbmd0aCA+IDApewogICAgICAgICAgICBsZXQgdGVtcERhdGFTb3VyY2VNYXA6TWFwPHN0cmluZyxhbnk+ID0gbmV3IE1hcCgpOwogICAgICAgICAgICBmb3IobGV0IGk9MDtpPE9iamVjdC5rZXlzKHRoaXMuc2VyaWVzTW9kZWwpLmxlbmd0aDtpKyspewogICAgICAgICAgICAgICAgT2JqZWN0LnZhbHVlcyh0aGlzLnNlcmllc01vZGVsKS5mb3JFYWNoKChzZXJpZXN2YWx1ZTphbnkpID0+ewogICAgICAgICAgICAgICAgICAgIGlmKHNlcmllc3ZhbHVlLnNlcmllc0luZGV4ID09PSBpKXsKICAgICAgICAgICAgICAgICAgICAgICAgdGVtcERhdGFTb3VyY2VNYXAuc2V0KHNlcmllc3ZhbHVlLm5hbWUsc2VyaWVzdmFsdWUuZGF0YSk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgfQogICAgICAgICAgICBpZih0ZW1wRGF0YVNvdXJjZU1hcC5zaXplID4gMCl7CiAgICAgICAgICAgICAgICB0ZW1wRGF0YVNvdXJjZU1hcC5mb3JFYWNoKChpdGVtOmFueSkgPT57CiAgICAgICAgICAgICAgICAgICAgX2NoYXJ0T3B0aW9uLmRhdGFzZXQucHVzaCh7J3NvdXJjZSc6aXRlbX0pOwogICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgfQogICAgICAgICAgICBPYmplY3Qua2V5cyh0aGlzLnNlcmllc01vZGVsKS5mb3JFYWNoKChzZXJpZXNOYW1lOnN0cmluZykgPT57CiAgICAgICAgICAgICAgICBpZihfY2hhcnRPcHRpb24gJiYgX2NoYXJ0T3B0aW9uLnNlcmllcy5sZW5ndGggPiAwKXsKICAgICAgICAgICAgICAgICAgICBfY2hhcnRPcHRpb24uc2VyaWVzLmZvckVhY2goKGl0ZW06YW55KSA9PnsKICAgICAgICAgICAgICAgICAgICAgICAgaWYodGhpcy5zZXJpZXNNb2RlbFtzZXJpZXNOYW1lXS5lY3hPYmplY3QgJiYgT2JqZWN0LmlzKHNlcmllc05hbWUsaXRlbS5pZCkpewogICAgICAgICAgICAgICAgICAgICAgICAgICAgaXRlbSA9IFV0aWwuZGVlcE9iamVjdE1lcmdlKGl0ZW0sdGhpcy5zZXJpZXNNb2RlbFtzZXJpZXNOYW1lXS5lY3hPYmplY3QpOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIGlmKHRoaXMuc2VyaWVzTW9kZWxbc2VyaWVzTmFtZV0uYmFzZU9wdGlvbiAmJiBPYmplY3Qua2V5cyh0aGlzLnNlcmllc01vZGVsW3Nlcmllc05hbWVdLmJhc2VPcHRpb24pLmxlbmd0aCA+IDAgICYmIE9iamVjdC5pcyhzZXJpZXNOYW1lLGl0ZW0uaWQpKXsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGl0ZW0gPSBVdGlsLmRlZXBPYmplY3RNZXJnZShpdGVtLHRoaXMuc2VyaWVzTW9kZWxbc2VyaWVzTmFtZV0uYmFzZU9wdGlvbik7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgaWYodGhpcy5zZXJpZXNNb2RlbFtzZXJpZXNOYW1lXS5lY09iamVjdCAmJiBPYmplY3QuaXMoc2VyaWVzTmFtZSxpdGVtLmlkKSl7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpdGVtID0gVXRpbC5kZWVwT2JqZWN0TWVyZ2UoaXRlbSx0aGlzLnNlcmllc01vZGVsW3Nlcmllc05hbWVdLmVjT2JqZWN0KTsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAvL+iuvue9ruWkmuW6j+WIlwogICAgICAgICAgICAgICAgbGV0IHRlbXBTZXJpZXM6YW55ID0gdGhpcy5zZXJpZXNNb2RlbFtzZXJpZXNOYW1lXTsKICAgICAgICAgICAgICAgIC8vIOmdnumbt+i+vuWbvgogICAgICAgICAgICAgICAgaWYodGVtcFNlcmllcyAmJiB0ZW1wU2VyaWVzLnNlcmllc0lkRmllbGQgJiYgdGVtcFNlcmllcy5zZXJpZXNWYWx1ZXMubGVuZ3RoID4gMCAmJiAhT2JqZWN0LmlzKHRlbXBTZXJpZXMudHlwZSwncmFkYXInKSl7CiAgICAgICAgICAgICAgICAgICAgY29uc3QgcmV0dXJuSW5kZXg6bnVtYmVyID0gX2NoYXJ0T3B0aW9uLnNlcmllcy5maW5kSW5kZXgoKGl0ZW06YW55KSA9PnsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIE9iamVjdC5pcyhpdGVtLmlkLHNlcmllc05hbWUpOwogICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgICAgX2NoYXJ0T3B0aW9uLnNlcmllcy5zcGxpY2UocmV0dXJuSW5kZXgsMSk7CiAgICAgICAgICAgICAgICAgICAgbGV0IHRlbXBTZXJpZXNBcnJheTpBcnJheTxhbnk+ID0gW107CiAgICAgICAgICAgICAgICAgICAgdGVtcFNlcmllcy5zZXJpZXNWYWx1ZXMuZm9yRWFjaCgoc2VyaWVzdmFsdWVJdGVtOmFueSkgPT57CiAgICAgICAgICAgICAgICAgICAgICAgIGxldCB0ZW1wU2VyaWVzVGVtcDphbnkgPSBKU09OLnBhcnNlKEpTT04uc3RyaW5naWZ5KHRlbXBTZXJpZXMuc2VyaWVzVGVtcCkpOwogICAgICAgICAgICAgICAgICAgICAgICBPYmplY3QuYXNzaWduKHRlbXBTZXJpZXNUZW1wLHtuYW1lOnRlbXBTZXJpZXMuc2VyaWVzTWFwW3Nlcmllc3ZhbHVlSXRlbV0sZGF0YXNldEluZGV4OnRlbXBTZXJpZXMuc2VyaWVzSW5kZXgsZW5jb2RlOnt4OnRlbXBTZXJpZXMuY2F0ZWdvckZpZWxkLHk6YCR7c2VyaWVzdmFsdWVJdGVtfWB9fSk7CiAgICAgICAgICAgICAgICAgICAgICAgIF9jaGFydE9wdGlvbi5zZXJpZXMucHVzaCh0ZW1wU2VyaWVzVGVtcCk7CiAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSkKICAgICAgICB9CiAgICAgICAgaWYoT2JqZWN0LmtleXModGhpcy5jaGFydEJhc2VPUHRpb24pLmxlbmd0aCA+IDApewogICAgICAgICAgICBPYmplY3QuYXNzaWduKF9jaGFydE9wdGlvbix0aGlzLmNoYXJ0QmFzZU9QdGlvbik7CiAgICAgICAgfQogICAgICAgIGlmKE9iamVjdC5rZXlzKHRoaXMuY2hhcnRVc2VyUGFyYW1zKS5sZW5ndGggPjApewogICAgICAgICAgICBPYmplY3QuYXNzaWduKF9jaGFydE9wdGlvbix0aGlzLmNoYXJ0VXNlclBhcmFtcyk7CiAgICAgICAgfQogICAgICAgIHJldHVybiBfY2hhcnRPcHRpb247CiAgICB9CgogICAgLyoqCiAgICAgKiDlrp7kvZPmlbDmja7pm4bovazljJbkuLrlm77ooajmlbDmja7pm4YKICAgICAqIAogICAgICogMS7ojrflj5blm77ooajmiYDmnInku6PnoIHooajlgLwKICAgICAqIDIu5p+l6K+i6ZuG5ZCI5pig5bCE5Zu+6KGo5pWw5o2u6ZuGCiAgICAgKiAzLuihpeWFqOWbvuihqOaVsOaNrumbhgogICAgICogNC7lm77ooajmlbDmja7pm4bliIbnu4TmsYLlkowKICAgICAqIDUu5o6S5bqP5Zu+6KGo5pWw5o2u6ZuGCiAgICAgKiAKICAgICAqIEBwYXJhbSB7Kn0gZGF0YSDlrp7kvZPmlbDmja7pm4YKICAgICAqIEBwYXJhbSB7RnVuY3Rpb259IGNhbGxiYWNrIOWbnuiwgwogICAgICogQG1lbWJlcm9mIERiX3N5c3BvcnRsZXQ0X2NoYXJ0QmFzZQogICAgICovCiAgICBwdWJsaWMgYXN5bmMgdHJhbnNmb3JtVG9CYXNpY0NoYXJ0U2V0RGF0YShkYXRhOmFueSxjYWxsYmFjazpGdW5jdGlvbil7CiAgICAgICAgaWYoIWRhdGEgfHwgIUFycmF5LmlzQXJyYXkoZGF0YSkgfHwgZGF0YS5sZW5ndGggPT09IDApewogICAgICAgICAgICB0aGlzLmlzTm9EYXRhID0gdHJ1ZTsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KICAgICAgICB0aGlzLmlzTm9EYXRhID0gZmFsc2U7CiAgICAgICAgLy/ojrflj5bku6PnoIHooajlgLwKICAgICAgICBsZXQgYWxsQ29kZUxpc3Q6YW55ID0gYXdhaXQgdGhpcy5nZXRDaGFydEFsbENvZGVMaXN0KCk7CiAgICAgICAgaWYoT2JqZWN0LnZhbHVlcyh0aGlzLnNlcmllc01vZGVsKS5sZW5ndGggPiAwKXsKICAgICAgICAgICAgT2JqZWN0LnZhbHVlcyh0aGlzLnNlcmllc01vZGVsKS5mb3JFYWNoKChzaW5nbGVTZXJpZXM6YW55LGluZGV4Om51bWJlcikgPT57CiAgICAgICAgICAgICAgICAvLyDlgLzlsZ7mgKfkuLpzcmZjb3VudOiuvue9rntzcmZjb3VudDoxfeWIsGRhdGEKICAgICAgICAgICAgICAgIGxldCB2YWx1ZUZpZWxkID0gc2luZ2xlU2VyaWVzLmRhdGFTZXRGaWVsZHMuZmluZCgoZGF0YXNldEZpZWxkOmFueSkgPT57CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGRhdGFzZXRGaWVsZC5uYW1lID09PSBzaW5nbGVTZXJpZXMudmFsdWVGaWVsZDsKICAgICAgICAgICAgICAgIH0pOyAKICAgICAgICAgICAgICAgIGlmKHZhbHVlRmllbGQgJiYgdmFsdWVGaWVsZC5uYW1lICYmIE9iamVjdC5pcyh2YWx1ZUZpZWxkLm5hbWUsInNyZmNvdW50IikpewogICAgICAgICAgICAgICAgICAgIGRhdGEuZm9yRWFjaCgoc2luZ2xlRGF0YTphbnkpID0+ewogICAgICAgICAgICAgICAgICAgICAgICBPYmplY3QuYXNzaWduKHNpbmdsZURhdGEse3NyZmNvdW50OjF9KTsKICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgLy8g5YiG57uE5bGe5oCnCiAgICAgICAgICAgICAgICBsZXQgZ3JvdXBGaWVsZCA9IHNpbmdsZVNlcmllcy5kYXRhU2V0RmllbGRzLmZpbmQoKGRhdGFzZXRGaWVsZDphbnkpID0+ewogICAgICAgICAgICAgICAgICAgIHJldHVybiBkYXRhc2V0RmllbGQubmFtZSA9PT0gc2luZ2xlU2VyaWVzLmNhdGVnb3JGaWVsZDsKICAgICAgICAgICAgICAgIH0pOyAKICAgICAgICAgICAgICAgIGxldCB0ZW1wQ2hhcnRTZXREYXRhOkFycmF5PGFueT4gPSBbXTsKICAgICAgICAgICAgICAgIGxldCB0ZW1wU2VyaWVzVmFsdWVzOk1hcDxzdHJpbmcsYW55PiA9IG5ldyBNYXAoKTsKICAgICAgICAgICAgICAgIGRhdGEuZm9yRWFjaCgoaXRlbTphbnkpID0+ewogICAgICAgICAgICAgICAgICAgIGxldCB0ZW1wQ2hhcnRTZXREYXRhSXRlbTphbnkgPSB7fTsKICAgICAgICAgICAgICAgICAgICAvLyDluo/liJflsZ7mgKfkuI3lrZjlnKgKICAgICAgICAgICAgICAgICAgICBpZighc2luZ2xlU2VyaWVzLnNlcmllc0lkRmllbGQpewogICAgICAgICAgICAgICAgICAgICAgICBPYmplY3QuYXNzaWduKHRlbXBDaGFydFNldERhdGFJdGVtLHtuYW1lOnNpbmdsZVNlcmllcy5uYW1lfSk7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmKHNpbmdsZVNlcmllcy5kYXRhU2V0RmllbGRzICYmIHNpbmdsZVNlcmllcy5kYXRhU2V0RmllbGRzLmxlbmd0aCA+MCl7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzaW5nbGVTZXJpZXMuZGF0YVNldEZpZWxkcy5mb3JFYWNoKChzaW5nbGVEYXRhU2V0RmllbGQ6YW55KSA9PnsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmhhbmRsZVNpbmdsZURhdGFTZXRGaWVsZChpdGVtLHNpbmdsZURhdGFTZXRGaWVsZCxhbGxDb2RlTGlzdCx0ZW1wQ2hhcnRTZXREYXRhSXRlbSxncm91cEZpZWxkKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9ZWxzZXsKICAgICAgICAgICAgICAgICAgICAgICAgLy8g5bqP5YiX5bGe5oCn5a2Y5Zyo5pe2CiAgICAgICAgICAgICAgICAgICAgICAgIC8vIOW6j+WIl+S7o+eggeihqOWtmOWcqOaXtiznv7vor5F0ZW1wU2VyaWVzVmFsdWVz55qE6ZSu5YC85a+5CiAgICAgICAgICAgICAgICAgICAgICAgIGlmKHNpbmdsZVNlcmllcy5zZXJpZXNDb2RlTGlzdCl7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBzZXJpZXNDb2RlTGlzdDpNYXA8c3RyaW5nLGFueT4gPSBhbGxDb2RlTGlzdC5nZXQoc2luZ2xlU2VyaWVzLnNlcmllc0NvZGVMaXN0LnRhZyk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsZXQgdGVtcFNlcmllc1ZhbHVlSXRlbSA9IHRlbXBTZXJpZXNWYWx1ZXMuZ2V0KHNlcmllc0NvZGVMaXN0LmdldChpdGVtW3NpbmdsZVNlcmllcy5zZXJpZXNJZEZpZWxkXSkpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYoIXRlbXBTZXJpZXNWYWx1ZUl0ZW0pewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRlbXBTZXJpZXNWYWx1ZXMuc2V0KHNlcmllc0NvZGVMaXN0LmdldChpdGVtW3NpbmdsZVNlcmllcy5zZXJpZXNJZEZpZWxkXSksc2VyaWVzQ29kZUxpc3QuZ2V0KGl0ZW1bc2luZ2xlU2VyaWVzLnNlcmllc0lkRmllbGRdKSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIH1lbHNlewogICAgICAgICAgICAgICAgICAgICAgICAgICAgbGV0IHRlbXBTZXJpZXNWYWx1ZUl0ZW0gPSB0ZW1wU2VyaWVzVmFsdWVzLmdldChpdGVtW3NpbmdsZVNlcmllcy5zZXJpZXNJZEZpZWxkXSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZighdGVtcFNlcmllc1ZhbHVlSXRlbSl7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGVtcFNlcmllc1ZhbHVlcy5zZXQoaXRlbVtzaW5nbGVTZXJpZXMuc2VyaWVzSWRGaWVsZF0saXRlbVtzaW5nbGVTZXJpZXMuc2VyaWVzTmFtZUZpZWxkXSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgT2JqZWN0LmFzc2lnbih0ZW1wQ2hhcnRTZXREYXRhSXRlbSx7bmFtZTppdGVtW3NpbmdsZVNlcmllcy5zZXJpZXNJZEZpZWxkXX0pOwogICAgICAgICAgICAgICAgICAgICAgICBpZihzaW5nbGVTZXJpZXMuZGF0YVNldEZpZWxkcyAmJiBzaW5nbGVTZXJpZXMuZGF0YVNldEZpZWxkcy5sZW5ndGggPjApewogICAgICAgICAgICAgICAgICAgICAgICAgICAgc2luZ2xlU2VyaWVzLmRhdGFTZXRGaWVsZHMuZm9yRWFjaCgoc2luZ2xlRGF0YVNldEZpZWxkOmFueSkgPT57CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5oYW5kbGVTaW5nbGVEYXRhU2V0RmllbGQoaXRlbSxzaW5nbGVEYXRhU2V0RmllbGQsYWxsQ29kZUxpc3QsdGVtcENoYXJ0U2V0RGF0YUl0ZW0sZ3JvdXBGaWVsZCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIHRlbXBDaGFydFNldERhdGEucHVzaCh0ZW1wQ2hhcnRTZXREYXRhSXRlbSk7CiAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgLy8g6KGl5YWo5pWw5o2u6ZuG5ZCICiAgICAgICAgICAgICAgICB0aGlzLmNvbXBsZXRlRGF0YVNldCh0ZW1wQ2hhcnRTZXREYXRhLHNpbmdsZVNlcmllcyxhbGxDb2RlTGlzdCk7CiAgICAgICAgICAgICAgICAvLyDluo/liJfku6PnoIHooajlrZjlnKjml7Ys6KGl5YWo5bqP5YiXCiAgICAgICAgICAgICAgICBpZihzaW5nbGVTZXJpZXMuc2VyaWVzQ29kZUxpc3QpewogICAgICAgICAgICAgICAgICAgIGNvbnN0IHNlcmllc0NvZGVMaXN0Ok1hcDxzdHJpbmcsYW55PiA9IGFsbENvZGVMaXN0LmdldChzaW5nbGVTZXJpZXMuc2VyaWVzQ29kZUxpc3QudGFnKTsKICAgICAgICAgICAgICAgICAgICB0ZW1wU2VyaWVzVmFsdWVzID0gbmV3IE1hcCgpOwogICAgICAgICAgICAgICAgICAgIHNlcmllc0NvZGVMaXN0LmZvckVhY2goKGl0ZW06YW55KSA9PnsKICAgICAgICAgICAgICAgICAgICAgICAgdGVtcFNlcmllc1ZhbHVlcy5zZXQoaXRlbSxpdGVtKTsKICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgc2luZ2xlU2VyaWVzLnNlcmllc1ZhbHVlcyA9IFsuLi50ZW1wU2VyaWVzVmFsdWVzLmtleXMoKV07CiAgICAgICAgICAgICAgICBsZXQgdGVtcFNlcmllc01hcE9iajphbnkgPSB7fTsKICAgICAgICAgICAgICAgIHRlbXBTZXJpZXNWYWx1ZXMuZm9yRWFjaCgodmFsdWU6YW55LGtleTphbnkpID0+ewogICAgICAgICAgICAgICAgICAgIHRlbXBTZXJpZXNNYXBPYmpba2V5XSA9IHZhbHVlOwogICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgIHNpbmdsZVNlcmllcy5zZXJpZXNNYXAgPSB0ZW1wU2VyaWVzTWFwT2JqOwogICAgICAgICAgICAgICAgbGV0IGNhbGxiYWNrRnVuY3Rpb246YW55ID0gKGluZGV4ID09PSAoT2JqZWN0LnZhbHVlcyh0aGlzLnNlcmllc01vZGVsKS5sZW5ndGggLSAxKSk/Y2FsbGJhY2s6bnVsbDsKICAgICAgICAgICAgICAgIHRoaXMudHJhbnNmb3JtVG9DaGFydFNlcmllc0RhdGFTZXQodGVtcENoYXJ0U2V0RGF0YSxzaW5nbGVTZXJpZXMsY2FsbGJhY2tGdW5jdGlvbixhbGxDb2RlTGlzdCk7CiAgICAgICAgICAgIH0pCiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICog5p6E5bu65Zu+6KGo5bqP5YiX5pWw5o2u6ZuG5ZCICiAgICAgKiAKICAgICAqIDEu5YiG57uE5rGC5ZKMCiAgICAgKiAyLuaOkuW6j+axguWSjOaVsOe7hAogICAgICogCiAgICAgKiBAcGFyYW0ge0FycmF5PGFueT59IGRhdGEg5Lyg5YWl5pWw5o2uCiAgICAgKiBAcGFyYW0ge0FycmF5PGFueT59IGl0ZW0g5Y2V5Liq5bqP5YiXCiAgICAgKiBAcGFyYW0ge0FycmF5PGFueT59IGNhbGxiYWNrIOWbnuiwgwogICAgICogQHBhcmFtIHsqfSBhbGxDb2RlTGlzdCDmiYDmnInku6PnoIHooagKICAgICAqIAogICAgICogQG1lbWJlcm9mIERiX3N5c3BvcnRsZXQ0X2NoYXJ0QmFzZQogICAgICovCiAgICBwdWJsaWMgdHJhbnNmb3JtVG9DaGFydFNlcmllc0RhdGFTZXQoZGF0YTphbnksaXRlbTphbnksY2FsbGJhY2s6RnVuY3Rpb24sYWxsQ29kZUxpc3Q6YW55KTphbnl7CiAgICAgICAgaWYoaXRlbS5zZXJpZXNJZEZpZWxkKXsKICAgICAgICAgICAgLy8g5aSa5bqP5YiXCiAgICAgICAgICAgIGxldCBncm91cEZpZWxkID0gaXRlbS5kYXRhU2V0RmllbGRzLmZpbHRlcigoZGF0YXNldEZpZWxkOmFueSkgPT57CiAgICAgICAgICAgICAgICByZXR1cm4gZGF0YXNldEZpZWxkLm5hbWUgPT09IGl0ZW0uY2F0ZWdvckZpZWxkOwogICAgICAgICAgICB9KTsKICAgICAgICAgICAgbGV0IHRlbXBHcm91cEZpZWxkOkFycmF5PGFueT4gPSBncm91cEZpZWxkLm1hcCgoaXRlbTphbnkpID0+ewogICAgICAgICAgICAgICAgcmV0dXJuIGl0ZW0ubmFtZTsKICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIGxldCBzZXJpZXNGaWVsZCA9IGl0ZW0uZGF0YVNldEZpZWxkcy5maWx0ZXIoKGRhdGFzZXRGaWVsZDphbnkpID0+ewogICAgICAgICAgICAgICAgcmV0dXJuIGRhdGFzZXRGaWVsZC5uYW1lID09PSBpdGVtLnNlcmllc0lkRmllbGQ7CiAgICAgICAgICAgIH0pOwogICAgICAgICAgICBsZXQgdGVtcFNlcmllc0ZpZWxkOkFycmF5PGFueT4gPSBzZXJpZXNGaWVsZC5tYXAoKGl0ZW06YW55KSA9PnsKICAgICAgICAgICAgICAgIHJldHVybiBpdGVtLm5hbWU7CiAgICAgICAgICAgIH0pOwogICAgICAgICAgICBsZXQgdmFsdWVGaWVsZCA9IGl0ZW0uZGF0YVNldEZpZWxkcy5maWx0ZXIoKGRhdGFzZXRGaWVsZDphbnkpID0+ewogICAgICAgICAgICAgICAgcmV0dXJuIGRhdGFzZXRGaWVsZC5uYW1lID09PSBpdGVtLnZhbHVlRmllbGQ7CiAgICAgICAgICAgIH0pOwogICAgICAgICAgICBsZXQgdGVtcFZhbHVlRmllbGQ6QXJyYXk8YW55PiA9IHZhbHVlRmllbGQubWFwKChpdGVtOmFueSkgPT57CiAgICAgICAgICAgICAgICByZXR1cm4gaXRlbS5uYW1lOwogICAgICAgICAgICB9KTsKICAgICAgICAgICAgaXRlbS5kYXRhID0gdGhpcy5ncm91cEFuZEFkZCh0ZW1wR3JvdXBGaWVsZCx0ZW1wU2VyaWVzRmllbGQsdGVtcFZhbHVlRmllbGQsZGF0YSxpdGVtLGdyb3VwRmllbGQsYWxsQ29kZUxpc3QpOwogICAgICAgIH1lbHNlewogICAgICAgICAgICAvL+WNleW6j+WIlwogICAgICAgICAgICBsZXQgZ3JvdXBGaWVsZCA9IGl0ZW0uZGF0YVNldEZpZWxkcy5maWx0ZXIoKGRhdGFzZXRGaWVsZDphbnkpID0+ewogICAgICAgICAgICAgICAgcmV0dXJuIGRhdGFzZXRGaWVsZC5uYW1lID09PSBpdGVtLmNhdGVnb3JGaWVsZDsKICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIGxldCB0ZW1wR3JvdXBGaWVsZDpBcnJheTxhbnk+ID0gZ3JvdXBGaWVsZC5tYXAoKGl0ZW06YW55KSA9PnsKICAgICAgICAgICAgICAgIHJldHVybiBpdGVtLm5hbWU7CiAgICAgICAgICAgIH0pCiAgICAgICAgICAgIGxldCB2YWx1ZUZpZWxkID0gaXRlbS5kYXRhU2V0RmllbGRzLmZpbHRlcigoZGF0YXNldEZpZWxkOmFueSkgPT57CiAgICAgICAgICAgICAgICByZXR1cm4gZGF0YXNldEZpZWxkLm5hbWUgPT09IGl0ZW0udmFsdWVGaWVsZDsKICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIGxldCB0ZW1wVmFsdWVGaWVsZDpBcnJheTxhbnk+ID0gdmFsdWVGaWVsZC5tYXAoKGl0ZW06YW55KSA9PnsKICAgICAgICAgICAgICAgIHJldHVybiBpdGVtLm5hbWU7CiAgICAgICAgICAgIH0pCiAgICAgICAgICAgIGl0ZW0uZGF0YSA9IHRoaXMuZ3JvdXBBbmRBZGQodGVtcEdyb3VwRmllbGQsW10sdGVtcFZhbHVlRmllbGQsZGF0YSxpdGVtLGdyb3VwRmllbGQsYWxsQ29kZUxpc3QpOwogICAgICAgIH0KICAgICAgICBpZihjYWxsYmFjayAmJiBjYWxsYmFjayBpbnN0YW5jZW9mIEZ1bmN0aW9uKXsKICAgICAgICAgICAgY2FsbGJhY2soYWxsQ29kZUxpc3QpOwogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIOWIhue7hOWSjOaxguWSjCAgCiAgICAgKiBAcGFyYW0ge0FycmF5PGFueT59IGdyb3VwRmllbGQg5YiG57uE5bGe5oCnCiAgICAgKiBAcGFyYW0ge0FycmF5PGFueT59IGdyb3VwRmllbGQg5YC85bGe5oCnCiAgICAgKiBAcGFyYW0ge0FycmF5PGFueT59IGRhdGEg5Lyg5YWl5pWw5o2uCiAgICAgKiBAcGFyYW0geyp9IGdyb3VwRmllbGRNb2RlbCDliIbnu4TlsZ7mgKfmqKHlnosKICAgICAqIEBwYXJhbSB7Kn0gYWxsQ29kZUxpc3Qg5omA5pyJ5Luj56CB6KGoCiAgICAgKiAKICAgICAqIEBtZW1iZXJvZiBEYl9zeXNwb3J0bGV0NF9jaGFydEJhc2UKICAgICAqLwogICAgcHVibGljIGdyb3VwQW5kQWRkKGdyb3VwRmllbGQ6QXJyYXk8YW55PixzZXJpZXNGaWVsZDpBcnJheTxhbnk+LHZhbHVlRmllbGQ6QXJyYXk8YW55PixkYXRhOmFueSxpdGVtOmFueSxncm91cEZpZWxkTW9kZWw6YW55LGFsbENvZGVMaXN0OmFueSl7CiAgICAgICAgbGV0IHRlbXBNYXA6TWFwPHN0cmluZyxhbnk+ID0gbmV3IE1hcCgpOwogICAgICAgIGxldCBncm91cE1vZGU6c3RyaW5nID0gZ3JvdXBGaWVsZE1vZGVsWzBdLmdyb3VwTW9kZTsKICAgICAgICBsZXQgZ3JvdXBLZXlTdHI6c3RyaW5nID0gIiI7CiAgICAgICAgZGF0YS5mb3JFYWNoKChpdGVtOmFueSkgPT57CiAgICAgICAgICAgIGxldCB0ZW1wR3JvdXBGaWVsZDpzdHJpbmcgPSBncm91cEZpZWxkWzBdOwogICAgICAgICAgICBncm91cEtleVN0ciA9IGl0ZW1bdGVtcEdyb3VwRmllbGRdOwogICAgICAgICAgICBsZXQgdGVtcE1hcEl0ZW06YW55ID0gdGVtcE1hcC5nZXQoZ3JvdXBLZXlTdHIpOwogICAgICAgICAgICBpZih0ZW1wTWFwSXRlbSl7CiAgICAgICAgICAgICAgICB0ZW1wTWFwSXRlbS5wdXNoKGl0ZW0pOwogICAgICAgICAgICAgICAgdGVtcE1hcC5zZXQoZ3JvdXBLZXlTdHIsdGVtcE1hcEl0ZW0pOwogICAgICAgICAgICB9ZWxzZXsKICAgICAgICAgICAgICAgIHRlbXBNYXAuc2V0KGdyb3VwS2V5U3RyLFtpdGVtXSk7CiAgICAgICAgICAgIH0KICAgICAgICB9KQogICAgICAgIC8vIOWkhOeQhuWkmuW6j+WIlwogICAgICAgIGlmKHNlcmllc0ZpZWxkLmxlbmd0aCA+IDAgJiYgdGVtcE1hcC5zaXplID4gMCl7CiAgICAgICAgICAgIGxldCB0ZW1wU2VyaWVzRmllbGQ6c3RyaW5nID0gc2VyaWVzRmllbGRbMF07CiAgICAgICAgICAgIHRlbXBNYXAuZm9yRWFjaCgoaXRlbTphbnksa2V5OnN0cmluZykgPT57CiAgICAgICAgICAgICAgICBsZXQgdGVtcEl0ZW1NYXA6TWFwPHN0cmluZyxhbnk+ID0gbmV3IE1hcCgpOwogICAgICAgICAgICAgICAgaXRlbS5mb3JFYWNoKChzaW5nbGVJdGVtOmFueSk9PnsKICAgICAgICAgICAgICAgICAgICBsZXQgc2VyaWVzVmFsdWVBcnJheTphbnkgPSB0ZW1wSXRlbU1hcC5nZXQoc2luZ2xlSXRlbVt0ZW1wU2VyaWVzRmllbGRdKTsKICAgICAgICAgICAgICAgICAgICBpZihzZXJpZXNWYWx1ZUFycmF5KXsKICAgICAgICAgICAgICAgICAgICAgICAgc2VyaWVzVmFsdWVBcnJheS5wdXNoKHNpbmdsZUl0ZW0pOwogICAgICAgICAgICAgICAgICAgICAgICB0ZW1wSXRlbU1hcC5zZXQoc2luZ2xlSXRlbVt0ZW1wU2VyaWVzRmllbGRdLHNlcmllc1ZhbHVlQXJyYXkpOwogICAgICAgICAgICAgICAgICAgIH1lbHNlewogICAgICAgICAgICAgICAgICAgICAgICB0ZW1wSXRlbU1hcC5zZXQoc2luZ2xlSXRlbVt0ZW1wU2VyaWVzRmllbGRdLFtzaW5nbGVJdGVtXSk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgIHRlbXBNYXAuc2V0KGtleSx0ZW1wSXRlbU1hcCk7CiAgICAgICAgICAgIH0pOwogICAgICAgIH0KICAgICAgICBsZXQgcmV0dXJuQXJyYXk6QXJyYXk8YW55PiA9IFtdOwogICAgICAgIGlmKHNlcmllc0ZpZWxkLmxlbmd0aCA9PSAwKXsKICAgICAgICAgICAgLy/ljZXluo/liJcKICAgICAgICAgICAgdGVtcE1hcC5mb3JFYWNoKCh0ZW1wSXRlbTphbnkpID0+ewogICAgICAgICAgICAgICAgaWYodGVtcEl0ZW0ubGVuZ3RoID4wKXsKICAgICAgICAgICAgICAgICAgICBsZXQgY3VyT2JqZWN0OmFueSA9IHt9OwogICAgICAgICAgICAgICAgICAgIGxldCB2YWx1ZVJlc3VsdDpudW1iZXIgPSAwOwogICAgICAgICAgICAgICAgICAgIGxldCBjYXRlZ29yUmVzdWx0OmFueTsKICAgICAgICAgICAgICAgICAgICB0ZW1wSXRlbS5mb3JFYWNoKChzaW5nbGVJdGVtOmFueSkgPT57CiAgICAgICAgICAgICAgICAgICAgICAgIGNhdGVnb3JSZXN1bHQgPSBzaW5nbGVJdGVtW2dyb3VwRmllbGRbMF1dOwogICAgICAgICAgICAgICAgICAgICAgICB2YWx1ZVJlc3VsdCArPSBzaW5nbGVJdGVtW3ZhbHVlRmllbGRbMF1dOwogICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KGN1ck9iamVjdCwgZ3JvdXBGaWVsZFswXSwgewogICAgICAgICAgICAgICAgICAgICAgICB2YWx1ZTogY2F0ZWdvclJlc3VsdCwKICAgICAgICAgICAgICAgICAgICAgICAgd3JpdGFibGUgOiB0cnVlLAogICAgICAgICAgICAgICAgICAgICAgICBlbnVtZXJhYmxlIDogdHJ1ZSwKICAgICAgICAgICAgICAgICAgICAgICAgY29uZmlndXJhYmxlIDogdHJ1ZQogICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShjdXJPYmplY3QsIHZhbHVlRmllbGRbMF0sIHsKICAgICAgICAgICAgICAgICAgICAgICAgdmFsdWU6IHZhbHVlUmVzdWx0LAogICAgICAgICAgICAgICAgICAgICAgICB3cml0YWJsZSA6IHRydWUsCiAgICAgICAgICAgICAgICAgICAgICAgIGVudW1lcmFibGUgOiB0cnVlLAogICAgICAgICAgICAgICAgICAgICAgICBjb25maWd1cmFibGUgOiB0cnVlCiAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuQXJyYXkucHVzaChjdXJPYmplY3QpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9KQogICAgICAgIH1lbHNlewogICAgICAgICAgICAvLyDlpJrluo/liJcKICAgICAgICAgICAgbGV0IHNlcmllc1ZhbHVlc0FycmF5OkFycmF5PGFueT4gPSBpdGVtLnNlcmllc1ZhbHVlczsKICAgICAgICAgICAgdGVtcE1hcC5mb3JFYWNoKChncm91cEl0ZW06YW55LGdyb3VwS2V5OnN0cmluZykgPT57CiAgICAgICAgICAgICAgICAvL+axguWSjAogICAgICAgICAgICAgICAgbGV0IGN1ck9iamVjdDphbnkgPSB7fTsKICAgICAgICAgICAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShjdXJPYmplY3QsIGdyb3VwRmllbGRbMF0sIHsKICAgICAgICAgICAgICAgICAgICB2YWx1ZTogZ3JvdXBLZXksCiAgICAgICAgICAgICAgICAgICAgd3JpdGFibGUgOiB0cnVlLAogICAgICAgICAgICAgICAgICAgIGVudW1lcmFibGUgOiB0cnVlLAogICAgICAgICAgICAgICAgICAgIGNvbmZpZ3VyYWJsZSA6IHRydWUKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgc2VyaWVzVmFsdWVzQXJyYXkuZm9yRWFjaCgoc2VyaWVzVmFsdWVJdGVtOmFueSkgPT57CiAgICAgICAgICAgICAgICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KGN1ck9iamVjdCwgc2VyaWVzVmFsdWVJdGVtLCB7CiAgICAgICAgICAgICAgICAgICAgICAgIHZhbHVlOiAwLAogICAgICAgICAgICAgICAgICAgICAgICB3cml0YWJsZSA6IHRydWUsCiAgICAgICAgICAgICAgICAgICAgICAgIGVudW1lcmFibGUgOiB0cnVlLAogICAgICAgICAgICAgICAgICAgICAgICBjb25maWd1cmFibGUgOiB0cnVlCiAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIGdyb3VwSXRlbS5mb3JFYWNoKChzZXJpZXNJdGVtOmFueSxzZXJpZXNLZXk6c3RyaW5nKSA9PnsKICAgICAgICAgICAgICAgICAgICBsZXQgc2VyaWVzTnVtOm51bWJlciA9IDA7CiAgICAgICAgICAgICAgICAgICAgc2VyaWVzSXRlbS5mb3JFYWNoKChkYXRhSXRlbTphbnkpID0+ewogICAgICAgICAgICAgICAgICAgICAgICBzZXJpZXNOdW0gKz0gZGF0YUl0ZW1bdmFsdWVGaWVsZFswXV07CiAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICAgICBjdXJPYmplY3Rbc2VyaWVzS2V5XSA9IHNlcmllc051bTsgCiAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgcmV0dXJuQXJyYXkucHVzaChjdXJPYmplY3QpOwogICAgICAgICAgICB9KQogICAgICAgIH0KICAgICAgICAvLyDooaXlhajnqbrnmb3liIbnsbsKICAgICAgICBpZihyZXR1cm5BcnJheS5sZW5ndGggPjApewogICAgICAgICAgICBsZXQgZW1wdHlUZXh0ID0gKGdyb3VwRmllbGRNb2RlbFswXSAmJiBncm91cEZpZWxkTW9kZWxbMF0uY29kZUxpc3QpP2dyb3VwRmllbGRNb2RlbFswXS5jb2RlTGlzdC5lbXB0eXRleHQ6IuacquWumuS5iSI7CiAgICAgICAgICAgIHJldHVybkFycmF5LmZvckVhY2goKGl0ZW06YW55KSA9PnsKICAgICAgICAgICAgICAgIGlmKCFpdGVtW2dyb3VwRmllbGRbMF1dKXsKICAgICAgICAgICAgICAgICAgICBpdGVtW2dyb3VwRmllbGRbMF1dID0gZW1wdHlUZXh0OwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9KQogICAgICAgIH0KICAgICAgICByZXR1cm5BcnJheSA9IHRoaXMuc29ydFJldHVybkFycmF5KHJldHVybkFycmF5LGdyb3VwRmllbGRNb2RlbCxhbGxDb2RlTGlzdCk7CiAgICAgICAgLy8g6Zu36L6+5Zu+5pWw5o2u5qC85byP5aSE55CGCiAgICAgICAgaWYoT2JqZWN0LmlzKGl0ZW0udHlwZSwncmFkYXInKSAmJiByZXR1cm5BcnJheS5sZW5ndGggPjApewogICAgICAgICAgICBsZXQgdGVtcFJldHVybkFycmF5OkFycmF5PGFueT4gPSBbXTsKICAgICAgICAgICAgbGV0IHNlcmllc1ZhbHVlczpBcnJheTxhbnk+ID0gaXRlbS5zZXJpZXNWYWx1ZXM7CiAgICAgICAgICAgIGlmKHNlcmllc1ZhbHVlcyAmJiBzZXJpZXNWYWx1ZXMubGVuZ3RoID4wKXsKICAgICAgICAgICAgICAgIHNlcmllc1ZhbHVlcy5mb3JFYWNoKChzaW5nbGVTZXJpZXNOYW1lOmFueSkgPT57CiAgICAgICAgICAgICAgICAgICAgbGV0IHNpbmdsZVNlcmllc09iajphbnkgPSB7fTsKICAgICAgICAgICAgICAgICAgICByZXR1cm5BcnJheS5mb3JFYWNoKChpdGVtOmFueSkgPT57CiAgICAgICAgICAgICAgICAgICAgICAgIE9iamVjdC5hc3NpZ24oc2luZ2xlU2VyaWVzT2JqLHtbaXRlbVtncm91cEZpZWxkWzBdXV06aXRlbVtzaW5nbGVTZXJpZXNOYW1lXX0pOwogICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgICAgT2JqZWN0LmFzc2lnbihzaW5nbGVTZXJpZXNPYmose3R5cGU6c2luZ2xlU2VyaWVzTmFtZX0pOwogICAgICAgICAgICAgICAgICAgIHRlbXBSZXR1cm5BcnJheS5wdXNoKHNpbmdsZVNlcmllc09iaik7CiAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybkFycmF5ID0gdGVtcFJldHVybkFycmF5OwogICAgICAgIH0KICAgICAgICBjb25zb2xlLmxvZyhKU09OLnN0cmluZ2lmeShyZXR1cm5BcnJheSkpOwogICAgICAgIHJldHVybiByZXR1cm5BcnJheTsKICAgIH0KCiAgICAvKioKICAgICAqIOaOkuW6j+aVsOe7hAogICAgICogCiAgICAgKiBAcGFyYW0ge0FycmF5PGFueT59IGFyciDkvKDlhaXmlbDnu4QKICAgICAqIEBwYXJhbSB7Kn0gZ3JvdXBGaWVsZCDliIbnu4TlsZ7mgKcKICAgICAqIEBwYXJhbSB7Kn0gYWxsQ29kZUxpc3Qg5omA5pyJ5Luj56CB6KGoCiAgICAgKiAKICAgICAqIEBtZW1iZXJvZiBEYl9zeXNwb3J0bGV0NF9jaGFydEJhc2UKICAgICAqLwogICAgcHVibGljIHNvcnRSZXR1cm5BcnJheShhcnI6QXJyYXk8YW55Pixncm91cEZpZWxkOmFueSxhbGxDb2RlTGlzdDphbnkpewogICAgICAgIGxldCByZXR1cm5BcnJheTpBcnJheTxhbnk+ID0gW107CiAgICAgICAgLy8gdG9kbwogICAgICAgIC8vIOWIhue7hOWxnuaAp+acieS7o+eggeihqOeahOaDheWGtSjmnIDlkI7miafooYwpCiAgICAgICAgaWYoZ3JvdXBGaWVsZFswXS5jb2RlbGlzdCl7CiAgICAgICAgICAgIGxldCBjdXJDb2RlTGlzdDpNYXA8bnVtYmVyLGFueT4gPSBhbGxDb2RlTGlzdC5nZXQoZ3JvdXBGaWVsZFswXS5jb2RlbGlzdC50YWcpOwogICAgICAgICAgICBjdXJDb2RlTGlzdC5mb3JFYWNoKChjb2RlbGlzdDphbnkpID0+ewogICAgICAgICAgICAgICAgYXJyLmZvckVhY2goKGl0ZW06YW55KSA9PnsKICAgICAgICAgICAgICAgICAgICBpZihPYmplY3QuaXMoaXRlbVtncm91cEZpZWxkWzBdLm5hbWVdLGNvZGVsaXN0KSl7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybkFycmF5LnB1c2goaXRlbSk7CiAgICAgICAgICAgICAgICAgICAgICAgIGl0ZW0uaGFzdXNlZCA9IHRydWU7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgfSkKICAgICAgICAgICAgYXJyLmZvckVhY2goKGl0ZW06YW55LGluZGV4Om51bWJlcikgPT57CiAgICAgICAgICAgICAgICBpZighaXRlbS5oYXN1c2VkKXsKICAgICAgICAgICAgICAgICAgICByZXR1cm5BcnJheS5wdXNoKGl0ZW0pOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9KQogICAgICAgICAgICByZXR1cm5BcnJheS5mb3JFYWNoKChpdGVtOmFueSkgPT57CiAgICAgICAgICAgICAgICBkZWxldGUgaXRlbS5oYXN1c2VkOwogICAgICAgICAgICB9KQogICAgICAgIH1lbHNlewogICAgICAgICAgICAvLyDliIbnu4TkuLrlubTku70KICAgICAgICAgICAgaWYoT2JqZWN0LmlzKGdyb3VwRmllbGRbMF0uZ3JvdXBNb2RlLCJZRUFSIikpewogICAgICAgICAgICAgICAgcmV0dXJuQXJyYXkgPSBhcnIuc29ydCgoYTphbnksIGI6YW55KSA9PiB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIE51bWJlcihhW2dyb3VwRmllbGRbMF0ubmFtZV0pIC0gTnVtYmVyKGJbZ3JvdXBGaWVsZFswXS5uYW1lXSk7CiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfWVsc2UgaWYoT2JqZWN0LmlzKGdyb3VwRmllbGRbMF0uZ3JvdXBNb2RlLCJRVUFSVEVSIikpewogICAgICAgICAgICAgICAgcmV0dXJuQXJyYXkgPSB0aGlzLmhhbmRsZVNvcnRHcm91cERhdGEoYXJyLGdyb3VwRmllbGQsIuWto+W6piIpOwogICAgICAgICAgICB9ZWxzZSBpZihPYmplY3QuaXMoZ3JvdXBGaWVsZFswXS5ncm91cE1vZGUsIk1PTlRIIikpewogICAgICAgICAgICAgICAgcmV0dXJuQXJyYXkgPSB0aGlzLmhhbmRsZVNvcnRHcm91cERhdGEoYXJyLGdyb3VwRmllbGQsIuaciCIpOwogICAgICAgICAgICB9ZWxzZSBpZihPYmplY3QuaXMoZ3JvdXBGaWVsZFswXS5ncm91cE1vZGUsIllFQVJXRUVLIikpewogICAgICAgICAgICAgICAgcmV0dXJuQXJyYXkgPSB0aGlzLmhhbmRsZVNvcnRHcm91cERhdGEoYXJyLGdyb3VwRmllbGQsIuWRqCIpOwogICAgICAgICAgICB9ZWxzZSBpZihPYmplY3QuaXMoZ3JvdXBGaWVsZFswXS5ncm91cE1vZGUsIkRBWSIpKXsKICAgICAgICAgICAgICAgIHJldHVybkFycmF5ID0gYXJyLnNvcnQoKGE6YW55LCBiOmFueSkgPT4gewogICAgICAgICAgICAgICAgICAgIHJldHVybiBtb21lbnQoYVtncm91cEZpZWxkWzBdLm5hbWVdKS51bml4KCkgLSBtb21lbnQoYltncm91cEZpZWxkWzBdLm5hbWVdKS51bml4KCk7CiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfWVsc2V7CiAgICAgICAgICAgICAgICBsZXQgZ3JvdXBGaWVsZE5hbWU6c3RyaW5nID0gZ3JvdXBGaWVsZFswXS5uYW1lOwogICAgICAgICAgICAgICAgbGV0IGlzQ29udmVydDpib29sZWFuID0gdHJ1ZTsKICAgICAgICAgICAgICAgIGFyci5mb3JFYWNoKChpdGVtOmFueSkgPT57CiAgICAgICAgICAgICAgICAgICAgaWYoaXNOYU4oaXRlbVtncm91cEZpZWxkTmFtZV0pKXsKICAgICAgICAgICAgICAgICAgICAgICAgaXNDb252ZXJ0ID0gZmFsc2U7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgIGlmKGlzQ29udmVydCl7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuQXJyYXkgPSBhcnIuc29ydCgoYTphbnksIGI6YW55KSA9PiB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBhW2dyb3VwRmllbGROYW1lXSAtIGJbZ3JvdXBGaWVsZE5hbWVdOwogICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgfWVsc2V7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuQXJyYXkgPSBhcnI7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgcmV0dXJuIHJldHVybkFycmF5OwogICAgfQoKICAgIC8qKgogICAgICog5o6S5bqP5YiG57uE5qih5byP5LiL55qE5pWw5o2uCiAgICAgKiAKICAgICAqIEBwYXJhbSB7QXJyYXk8YW55Pn0gYXJyIOS8oOWFpeaVsOaNrgogICAgICogQHBhcmFtIHtBcnJheTxhbnk+fSBncm91cEZpZWxkIOWIhue7hOWxnuaApwogICAgICogQHBhcmFtIHtBcnJheTxhbnk+fSBsYWJlbCBsYWJlbOagh+etvgogICAgICogCiAgICAgKiBAbWVtYmVyb2YgRGJfc3lzcG9ydGxldDRfY2hhcnRCYXNlCiAgICAgKi8KICAgIHB1YmxpYyBoYW5kbGVTb3J0R3JvdXBEYXRhKGFycjpBcnJheTxhbnk+LGdyb3VwRmllbGQ6YW55LGxhYmVsOnN0cmluZyl7CiAgICAgICAgYXJyLmZvckVhY2goKGl0ZW06YW55KSA9PnsKICAgICAgICAgICAgbGV0IHNvcnRGaWVsZFZhbHVlOkFycmF5PGFueT4gPSBpdGVtW2dyb3VwRmllbGRbMF0ubmFtZV0uc3BsaXQoIi0iKTsKICAgICAgICAgICAgT2JqZWN0LmFzc2lnbihpdGVtLHtzb3J0RmllbGQ6TnVtYmVyKHNvcnRGaWVsZFZhbHVlWzBdKSoxMDAwMCtOdW1iZXIoc29ydEZpZWxkVmFsdWVbMV0pfSk7CiAgICAgICAgICAgIGl0ZW1bZ3JvdXBGaWVsZFswXS5uYW1lXSA9IHNvcnRGaWVsZFZhbHVlWzBdKyLlubQiK3NvcnRGaWVsZFZhbHVlWzFdK2xhYmVsOwogICAgICAgIH0pCiAgICAgICAgYXJyLnNvcnQoKGE6YW55LCBiOmFueSkgPT4gewogICAgICAgICAgICByZXR1cm4gTnVtYmVyKGEuc29ydEZpZWxkKSAtIE51bWJlcihiLnNvcnRGaWVsZCk7CiAgICAgICAgfSk7CiAgICAgICAgYXJyLmZvckVhY2goKGl0ZW06YW55KSA9PnsKICAgICAgICAgICAgZGVsZXRlIGl0ZW0uc29ydEZpZWxkOwogICAgICAgIH0pCiAgICAgICAgcmV0dXJuIGFycjsKICAgIH0KCiAgICAvKioKICAgICAqIOihpeWFqOaVsOaNrumbhgogICAgICogCiAgICAgKiBAcGFyYW0ge0FycmF5PGFueT59IGRhdGEg5Lyg5YWl5pWw5o2uCiAgICAgKiBAcGFyYW0ge0FycmF5PGFueT59IGl0ZW0g5Y2V5Liq5bqP5YiXCiAgICAgKiBAcGFyYW0ge0FycmF5PGFueT59IGFsbENvZGVMaXN0IOaJgOacieeahOS7o+eggeihqAogICAgICogCiAgICAgKiBAbWVtYmVyb2YgRGJfc3lzcG9ydGxldDRfY2hhcnRCYXNlCiAgICAgKi8KICAgIHB1YmxpYyBjb21wbGV0ZURhdGFTZXQoZGF0YTphbnksaXRlbTphbnksYWxsQ29kZUxpc3Q6YW55KXsKICAgICAgICAvLyDliIbnu4TlsZ7mgKcKICAgICAgICBsZXQgZ3JvdXBGaWVsZCA9IGl0ZW0uZGF0YVNldEZpZWxkcy5maW5kKChkYXRhc2V0RmllbGQ6YW55KSA9PnsKICAgICAgICAgICAgcmV0dXJuIGRhdGFzZXRGaWVsZC5uYW1lID09PSBpdGVtLmNhdGVnb3JGaWVsZDsKICAgICAgICB9KTsKICAgICAgICBpZihPYmplY3QuaXMoZ3JvdXBGaWVsZC5ncm91cE1vZGUsIiIpKXsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KICAgICAgICAvL+WIhue7hOaooeW8j+S4uuS7o+eggeihqO+8iOihpeWAvO+8iQogICAgICAgIGlmKE9iamVjdC5pcyhncm91cEZpZWxkLmdyb3VwTW9kZSwnQ09ERUxJU1QnKSl7CiAgICAgICAgICAgIHRoaXMuY29tcGxldGVDb2RlTGlzdChkYXRhLGl0ZW0sYWxsQ29kZUxpc3QpOwogICAgICAgIH0KICAgICAgICAvL+WIhue7hOaooeW8j+S4uuW5tC/lraPluqYv5pyI5Lu977yI5pyA5aSn5YC877yM5pyA5bCP5YC877yM5YiG57uE77yM6KGl5YC877yJCiAgICAgICAgaWYoT2JqZWN0LmlzKGdyb3VwRmllbGQuZ3JvdXBNb2RlLCJZRUFSIikgfHwgT2JqZWN0LmlzKGdyb3VwRmllbGQuZ3JvdXBNb2RlLCJRVUFSVEVSIikgfHwgT2JqZWN0LmlzKGdyb3VwRmllbGQuZ3JvdXBNb2RlLCJNT05USCIpIHx8IE9iamVjdC5pcyhncm91cEZpZWxkLmdyb3VwTW9kZSwiWUVBUldFRUsiKSAgfHwgT2JqZWN0LmlzKGdyb3VwRmllbGQuZ3JvdXBNb2RlLCJEQVkiKSl7CiAgICAgICAgICAgIHRoaXMuaGFuZGxlVGltZURhdGEoZGF0YSxpdGVtLGFsbENvZGVMaXN0LGdyb3VwRmllbGQpOwogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIOiOt+WPluacgOWkp+WAvOacgOWwj+WAvAogICAgICogCiAgICAgKiBAcGFyYW0ge0FycmF5PGFueT59IHRlbXBUaW1lQXJyYXkg5Lyg5YWl5pWw5o2uCiAgICAgKiAKICAgICAqIEBtZW1iZXJvZiBEYl9zeXNwb3J0bGV0NF9jaGFydEJhc2UKICAgICAqLwogICAgcHVibGljICBnZXRSYW5nZURhdGEodGVtcFRpbWVBcnJheTpBcnJheTxhbnk+KXsKICAgICAgICB0ZW1wVGltZUFycmF5LmZvckVhY2goKGl0ZW06YW55KSA9PnsKICAgICAgICAgICAgbGV0IHRlbXBQYXJhbXM6QXJyYXk8YW55PiA9IGl0ZW0uX2kuc3BsaXQoIi0iKTsKICAgICAgICAgICAgaXRlbS5zb3J0RmllbGQgPSBOdW1iZXIodGVtcFBhcmFtc1swXSArIHRlbXBQYXJhbXNbMV0pOwogICAgICAgIH0pCiAgICAgICAgdGVtcFRpbWVBcnJheS5zb3J0KChhOmFueSwgYjphbnkpID0+IHsKICAgICAgICAgICAgcmV0dXJuIE51bWJlcihhLnNvcnRGaWVsZCkgLSBOdW1iZXIoYi5zb3J0RmllbGQpOwogICAgICAgIH0pOwogICAgICAgIHRlbXBUaW1lQXJyYXkuZm9yRWFjaCgoaXRlbTphbnkpID0+ewogICAgICAgICAgICBkZWxldGUgaXRlbS5zb3J0RmllbGQ7CiAgICAgICAgfSkKICAgICAgICByZXR1cm4gdGVtcFRpbWVBcnJheTsKICAgIH0KCiAgIC8qKgogICAgICog6KGl5YWo5pe26Ze057G75Z6L5pWw5o2u6ZuGCiAgICAgKiAKICAgICAqIEBwYXJhbSB7QXJyYXk8YW55Pn0gZGF0YSDkvKDlhaXmlbDmja4KICAgICAqIEBwYXJhbSB7QXJyYXk8YW55Pn0gaXRlbSDljZXkuKrluo/liJcKICAgICAqIEBwYXJhbSB7QXJyYXk8YW55Pn0gYWxsQ29kZUxpc3Qg5omA5pyJ55qE5Luj56CB6KGoCiAgICAgKiBAcGFyYW0ge0FycmF5PGFueT59IGdyb3VwRmllbGQg5YiG57uE5bGe5oCnCiAgICAgKiAKICAgICAqIEBtZW1iZXJvZiBEYl9zeXNwb3J0bGV0NF9jaGFydEJhc2UKICAgICAqLwogICAgcHVibGljIGhhbmRsZVRpbWVEYXRhKGRhdGE6YW55LGl0ZW06YW55LGFsbENvZGVMaXN0OmFueSxncm91cEZpZWxkOmFueSl7CiAgICAgICAgbGV0IHZhbHVlRmllbGQgPSBpdGVtLmRhdGFTZXRGaWVsZHMuZmluZCgoZGF0YXNldEZpZWxkOmFueSkgPT57CiAgICAgICAgICAgIHJldHVybiBkYXRhc2V0RmllbGQubmFtZSA9PT0gaXRlbS52YWx1ZUZpZWxkOwogICAgICAgIH0pOwogICAgICAgIGxldCBncm91cE1vZGU6c3RyaW5nID0gZ3JvdXBGaWVsZC5ncm91cE1vZGU7CiAgICAgICAgLy8g5o6S5bqP5pWw5o2u77yM5om+5Yiw5pyA5aSn5YC844CB5pyA5bCP5YC8CiAgICAgICAgbGV0IHRlbXBUaW1lQXJyYXk6QXJyYXk8YW55PiA9IFtdOwogICAgICAgIGlmKGRhdGEgJiYgZGF0YS5sZW5ndGggPjApewogICAgICAgICAgICBkYXRhLmZvckVhY2goKGRhdGFJdGVtOmFueSkgPT57CiAgICAgICAgICAgICAgICAvLyDliKTmlq3ml7bpl7TnsbvlnovmmK/lkKbkuLrnqbrvvIzkuLrnqbrkuI3lpITnkIYKICAgICAgICAgICAgICAgIGlmKGRhdGFJdGVtW2dyb3VwRmllbGQubmFtZV0pewogICAgICAgICAgICAgICAgICAgIHRlbXBUaW1lQXJyYXkucHVzaChtb21lbnQoZGF0YUl0ZW1bZ3JvdXBGaWVsZC5uYW1lXSkpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9KQogICAgICAgIH0KICAgICAgICBsZXQgbWF4VGltZTphbnk7CiAgICAgICAgbGV0IG1pblRpbWU6YW55OwogICAgICAgIGlmKE9iamVjdC5pcyhncm91cE1vZGUsIllFQVIiKSB8fCBPYmplY3QuaXMoZ3JvdXBNb2RlLCJEQVkiKSl7CiAgICAgICAgICAgIG1heFRpbWUgPSBtb21lbnQubWF4KHRlbXBUaW1lQXJyYXkpOwogICAgICAgICAgICBtaW5UaW1lID0gbW9tZW50Lm1pbih0ZW1wVGltZUFycmF5KTsKICAgICAgICB9CiAgICAgICAgaWYoT2JqZWN0LmlzKGdyb3VwTW9kZSwiUVVBUlRFUiIpKXsKICAgICAgICAgICAgdGVtcFRpbWVBcnJheSA9IHRoaXMuZ2V0UmFuZ2VEYXRhKHRlbXBUaW1lQXJyYXkpOwogICAgICAgICAgICBtaW5UaW1lID0gbW9tZW50KCkueWVhcigodGVtcFRpbWVBcnJheVswXS5faS5zcGxpdCgiLSIpKVswXSkucXVhcnRlcnMoKHRlbXBUaW1lQXJyYXlbMF0uX2kuc3BsaXQoIi0iKSlbMV0pOwogICAgICAgICAgICBtYXhUaW1lID0gbW9tZW50KCkueWVhcigodGVtcFRpbWVBcnJheVt0ZW1wVGltZUFycmF5Lmxlbmd0aCAtIDFdLl9pLnNwbGl0KCItIikpWzBdKS5xdWFydGVycygodGVtcFRpbWVBcnJheVt0ZW1wVGltZUFycmF5Lmxlbmd0aCAtIDFdLl9pLnNwbGl0KCItIikpWzFdKTsKICAgICAgICB9CiAgICAgICAgaWYoT2JqZWN0LmlzKGdyb3VwTW9kZSwiTU9OVEgiKSl7CiAgICAgICAgICAgIHRlbXBUaW1lQXJyYXkgPSB0aGlzLmdldFJhbmdlRGF0YSh0ZW1wVGltZUFycmF5KTsKICAgICAgICAgICAgbWluVGltZSA9IG1vbWVudCgpLnllYXIoKHRlbXBUaW1lQXJyYXlbMF0uX2kuc3BsaXQoIi0iKSlbMF0pLm1vbnRoKCh0ZW1wVGltZUFycmF5WzBdLl9pLnNwbGl0KCItIikpWzFdKTsKICAgICAgICAgICAgbWF4VGltZSA9IG1vbWVudCgpLnllYXIoKHRlbXBUaW1lQXJyYXlbdGVtcFRpbWVBcnJheS5sZW5ndGggLSAxXS5faS5zcGxpdCgiLSIpKVswXSkubW9udGgoKHRlbXBUaW1lQXJyYXlbdGVtcFRpbWVBcnJheS5sZW5ndGggLSAxXS5faS5zcGxpdCgiLSIpKVsxXSk7CiAgICAgICAgfQogICAgICAgIGlmKE9iamVjdC5pcyhncm91cE1vZGUsIllFQVJXRUVLIikpewogICAgICAgICAgICB0ZW1wVGltZUFycmF5ID0gdGhpcy5nZXRSYW5nZURhdGEodGVtcFRpbWVBcnJheSk7CiAgICAgICAgICAgIG1pblRpbWUgPSBtb21lbnQoKS55ZWFyKCh0ZW1wVGltZUFycmF5WzBdLl9pLnNwbGl0KCItIikpWzBdKS53ZWVrKCh0ZW1wVGltZUFycmF5WzBdLl9pLnNwbGl0KCItIikpWzFdKTsKICAgICAgICAgICAgbWF4VGltZSA9IG1vbWVudCgpLnllYXIoKHRlbXBUaW1lQXJyYXlbdGVtcFRpbWVBcnJheS5sZW5ndGggLSAxXS5faS5zcGxpdCgiLSIpKVswXSkud2VlaygodGVtcFRpbWVBcnJheVt0ZW1wVGltZUFycmF5Lmxlbmd0aCAtIDFdLl9pLnNwbGl0KCItIikpWzFdKTsKICAgICAgICB9CiAgICAgICAgbGV0IHRpbWVGcmFnbWVudEFycmF5OkFycmF5PGFueT4gPSBbXTsKICAgICAgICBsZXQgdGVtcEdyb3VucERhdGE6TWFwPHN0cmluZyxhbnk+ID0gbmV3IE1hcCgpOwogICAgICAgIC8vIOaXtumXtOWIhuautQogICAgICAgIC8vZ3JvdXBNb2Rl5Li6IllFQVIiCiAgICAgICAgaWYoT2JqZWN0LmlzKGdyb3VwTW9kZSwiWUVBUiIpKXsKICAgICAgICAgICAgbGV0IGN1clRpbWU6YW55ID0gbWluVGltZTsKICAgICAgICAgICAgd2hpbGUoY3VyVGltZSl7CiAgICAgICAgICAgICAgICBpZihjdXJUaW1lLmlzU2FtZU9yQmVmb3JlKG1heFRpbWUpKXsKICAgICAgICAgICAgICAgICAgICBsZXQgdGVtcGN1clRpbWU6YW55ID0gY3VyVGltZS5jbG9uZSgpOwogICAgICAgICAgICAgICAgICAgIHRpbWVGcmFnbWVudEFycmF5LnB1c2godGVtcGN1clRpbWUueWVhcigpLnRvU3RyaW5nKCkpOwogICAgICAgICAgICAgICAgICAgIGN1clRpbWUgPSB0ZW1wY3VyVGltZS5jbG9uZSgpLmFkZCgxLCAneWVhcnMnKTsKICAgICAgICAgICAgICAgIH1lbHNlewogICAgICAgICAgICAgICAgICAgIGN1clRpbWUgPSBudWxsOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIC8vZ3JvdXBNb2Rl5Li6IlFVQVJURVIiCiAgICAgICAgaWYoT2JqZWN0LmlzKGdyb3VwTW9kZSwiUVVBUlRFUiIpKXsKICAgICAgICAgICAgbGV0IGN1clRpbWU6YW55ID0gbWluVGltZTsKICAgICAgICAgICAgd2hpbGUoY3VyVGltZSl7CiAgICAgICAgICAgICAgICBpZihjdXJUaW1lLmlzU2FtZU9yQmVmb3JlKG1heFRpbWUpKXsKICAgICAgICAgICAgICAgICAgICBsZXQgdGVtcGN1clRpbWU6YW55ID0gY3VyVGltZS5jbG9uZSgpOwogICAgICAgICAgICAgICAgICAgIHRpbWVGcmFnbWVudEFycmF5LnB1c2godGVtcGN1clRpbWUueWVhcigpLnRvU3RyaW5nKCkrIi0iK3RlbXBjdXJUaW1lLnF1YXJ0ZXIoKS50b1N0cmluZygpKTsKICAgICAgICAgICAgICAgICAgICBjdXJUaW1lID0gdGVtcGN1clRpbWUuY2xvbmUoKS5hZGQoMSwgJ3F1YXJ0ZXJzJyk7CiAgICAgICAgICAgICAgICB9ZWxzZXsKICAgICAgICAgICAgICAgICAgICBjdXJUaW1lID0gbnVsbDsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICAvL2dyb3VwTW9kZeS4uiJNT05USCIKICAgICAgICBpZihPYmplY3QuaXMoZ3JvdXBNb2RlLCJNT05USCIpKXsKICAgICAgICAgICAgbGV0IGN1clRpbWU6YW55ID0gbWluVGltZTsKICAgICAgICAgICAgd2hpbGUoY3VyVGltZSl7CiAgICAgICAgICAgICAgICBpZihjdXJUaW1lLmlzU2FtZU9yQmVmb3JlKG1heFRpbWUpKXsKICAgICAgICAgICAgICAgICAgICBsZXQgdGVtcGN1clRpbWU6YW55ID0gY3VyVGltZS5jbG9uZSgpOwogICAgICAgICAgICAgICAgICAgIHRpbWVGcmFnbWVudEFycmF5LnB1c2godGVtcGN1clRpbWUueWVhcigpLnRvU3RyaW5nKCkrIi0iK3RlbXBjdXJUaW1lLm1vbnRoKCkudG9TdHJpbmcoKSk7CiAgICAgICAgICAgICAgICAgICAgY3VyVGltZSA9IHRlbXBjdXJUaW1lLmNsb25lKCkuYWRkKDEsICdtb250aHMnKTsKICAgICAgICAgICAgICAgIH1lbHNlewogICAgICAgICAgICAgICAgICAgIGN1clRpbWUgPSBudWxsOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIC8vZ3JvdXBNb2Rl5Li6IllFQVJXRUVLIgogICAgICAgIGlmKE9iamVjdC5pcyhncm91cE1vZGUsIllFQVJXRUVLIikpewogICAgICAgICAgICBsZXQgY3VyVGltZTphbnkgPSBtaW5UaW1lOwogICAgICAgICAgICB3aGlsZShjdXJUaW1lKXsKICAgICAgICAgICAgICAgIGlmKGN1clRpbWUuaXNTYW1lT3JCZWZvcmUobWF4VGltZSkpewogICAgICAgICAgICAgICAgICAgIGxldCB0ZW1wY3VyVGltZTphbnkgPSBjdXJUaW1lLmNsb25lKCk7CiAgICAgICAgICAgICAgICAgICAgdGltZUZyYWdtZW50QXJyYXkucHVzaCh0ZW1wY3VyVGltZS55ZWFyKCkudG9TdHJpbmcoKSsiLSIrdGVtcGN1clRpbWUud2VlaygpLnRvU3RyaW5nKCkpOwogICAgICAgICAgICAgICAgICAgIGN1clRpbWUgPSB0ZW1wY3VyVGltZS5jbG9uZSgpLmFkZCgxLCAnd2Vla3MnKTsKICAgICAgICAgICAgICAgIH1lbHNlewogICAgICAgICAgICAgICAgICAgIGN1clRpbWUgPSBudWxsOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIC8vZ3JvdXBNb2Rl5Li6IkRBWSIKICAgICAgICBpZihPYmplY3QuaXMoZ3JvdXBNb2RlLCJEQVkiKSl7CiAgICAgICAgICAgIGxldCBjdXJUaW1lOmFueSA9IG1pblRpbWU7CiAgICAgICAgICAgIHdoaWxlKGN1clRpbWUpewogICAgICAgICAgICAgICAgaWYoY3VyVGltZS5pc1NhbWVPckJlZm9yZShtYXhUaW1lKSl7CiAgICAgICAgICAgICAgICAgICAgbGV0IHRlbXBjdXJUaW1lOmFueSA9IGN1clRpbWUuY2xvbmUoKTsKICAgICAgICAgICAgICAgICAgICB0aW1lRnJhZ21lbnRBcnJheS5wdXNoKHRlbXBjdXJUaW1lLmZvcm1hdCgnWVlZWS1NTS1ERCcpKTsKICAgICAgICAgICAgICAgICAgICBjdXJUaW1lID0gdGVtcGN1clRpbWUuY2xvbmUoKS5hZGQoMSwgJ2RheXMnKTsKICAgICAgICAgICAgICAgIH1lbHNlewogICAgICAgICAgICAgICAgICAgIGN1clRpbWUgPSBudWxsOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIGRhdGEuZm9yRWFjaCgoaXRlbTphbnkpID0+ewogICAgICAgICAgICBsZXQgdGVtcEtleVN0cjpzdHJpbmcgPSBpdGVtW2dyb3VwRmllbGQubmFtZV07CiAgICAgICAgICAgIGxldCB0ZW1wR3JvdW5wSXRlbTphbnkgPSB0ZW1wR3JvdW5wRGF0YS5nZXQodGVtcEtleVN0cik7CiAgICAgICAgICAgIGlmKCF0ZW1wR3JvdW5wSXRlbSl7CiAgICAgICAgICAgICAgICB0ZW1wR3JvdW5wRGF0YS5zZXQodGVtcEtleVN0cixpdGVtKTsKICAgICAgICAgICAgfQogICAgICAgIH0pCiAgICAgICAgdGltZUZyYWdtZW50QXJyYXkuZm9yRWFjaCgodGltZUZyYWdtZW50OmFueSkgPT57CiAgICAgICAgICAgIGlmKCF0ZW1wR3JvdW5wRGF0YS5nZXQodGltZUZyYWdtZW50KSl7CiAgICAgICAgICAgICAgICBsZXQgY29weVRlbXA6YW55ID0gSlNPTi5wYXJzZShKU09OLnN0cmluZ2lmeShkYXRhWzBdKSk7CiAgICAgICAgICAgICAgICBsZXQgY3VyT2JqOmFueSA9IHt9OwogICAgICAgICAgICAgICAgY3VyT2JqW2dyb3VwRmllbGQubmFtZV0gPSB0aW1lRnJhZ21lbnQ7CiAgICAgICAgICAgICAgICBjdXJPYmpbdmFsdWVGaWVsZC5uYW1lXSA9IDA7CiAgICAgICAgICAgICAgICBPYmplY3QuYXNzaWduKGNvcHlUZW1wLGN1ck9iaik7CiAgICAgICAgICAgICAgICBkYXRhLnB1c2goY29weVRlbXApOwogICAgICAgICAgICB9CiAgICAgICAgfSkKICAgIH0KCiAgICAvKioKICAgICAqIOihpeWFqOS7o+eggeihqAogICAgICogCiAgICAgKiBAcGFyYW0ge0FycmF5PGFueT59IGRhdGEg5Lyg5YWl5pWw5o2uCiAgICAgKiBAcGFyYW0ge0FycmF5PGFueT59IGl0ZW0g5Y2V5Liq5bqP5YiXCiAgICAgKiBAcGFyYW0ge0FycmF5PGFueT59IGFsbENvZGVMaXN0IOaJgOacieeahOS7o+eggeihqAogICAgICogCiAgICAgKiBAbWVtYmVyb2YgRGJfc3lzcG9ydGxldDRfY2hhcnRCYXNlCiAgICAgKi8KICAgIHB1YmxpYyAgY29tcGxldGVDb2RlTGlzdChkYXRhOmFueSxpdGVtOmFueSxhbGxDb2RlTGlzdDphbnkpewogICAgICAgIGxldCBncm91cEZpZWxkID0gaXRlbS5kYXRhU2V0RmllbGRzLmZpbmQoKGRhdGFzZXRGaWVsZDphbnkpID0+ewogICAgICAgICAgICByZXR1cm4gZGF0YXNldEZpZWxkLm5hbWUgPT09IGl0ZW0uY2F0ZWdvckZpZWxkOwogICAgICAgIH0pOwogICAgICAgIGlmKCFncm91cEZpZWxkLmNvZGVsaXN0KXsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KICAgICAgICBsZXQgdmFsdWVGaWVsZCA9IGl0ZW0uZGF0YVNldEZpZWxkcy5maW5kKChkYXRhc2V0RmllbGQ6YW55KSA9PnsKICAgICAgICAgICAgcmV0dXJuIGRhdGFzZXRGaWVsZC5uYW1lID09PSBpdGVtLnZhbHVlRmllbGQ7CiAgICAgICAgfSk7CiAgICAgICAgbGV0IGN1ckNvZGVMaXN0Ok1hcDxudW1iZXIsYW55PiA9IGFsbENvZGVMaXN0LmdldChncm91cEZpZWxkLmNvZGVsaXN0LnRhZyk7CiAgICAgICAgLy8g5a+55YiG57G75a6e546w5YiG57uECiAgICAgICAgbGV0IHRlbXBHcm91bnBEYXRhOk1hcDxzdHJpbmcsYW55PiA9IG5ldyBNYXAoKTsKICAgICAgICBkYXRhLmZvckVhY2goKGl0ZW06YW55KSA9PnsKICAgICAgICAgICAgbGV0IHRlbXBHcm91bnBJdGVtOmFueSA9IHRlbXBHcm91bnBEYXRhLmdldChpdGVtW2dyb3VwRmllbGQubmFtZSsnX3NyZnZhbHVlJ10pOwogICAgICAgICAgICBpZighdGVtcEdyb3VucEl0ZW0pewogICAgICAgICAgICAgICAgdGVtcEdyb3VucERhdGEuc2V0KGl0ZW1bZ3JvdXBGaWVsZC5uYW1lKydfc3JmdmFsdWUnXSxpdGVtKTsKICAgICAgICAgICAgfQogICAgICAgIH0pCiAgICAgICAgaWYoY3VyQ29kZUxpc3Quc2l6ZSAhPT0gdGVtcEdyb3VucERhdGEuc2l6ZSl7CiAgICAgICAgICAgIGN1ckNvZGVMaXN0LmZvckVhY2goKHRleHQ6YW55LHZhbHVlOmFueSkgPT57CiAgICAgICAgICAgICAgICBpZighdGVtcEdyb3VucERhdGEuZ2V0KHZhbHVlKSl7CiAgICAgICAgICAgICAgICAgICAgbGV0IGNvcHlUZW1wOmFueSA9IEpTT04ucGFyc2UoSlNPTi5zdHJpbmdpZnkoZGF0YVswXSkpOwogICAgICAgICAgICAgICAgICAgIGxldCBjdXJPYmo6YW55ID0ge307CiAgICAgICAgICAgICAgICAgICAgY3VyT2JqW2dyb3VwRmllbGQubmFtZSsnX3NyZnZhbHVlJ10gPSB2YWx1ZTsKICAgICAgICAgICAgICAgICAgICBjdXJPYmpbZ3JvdXBGaWVsZC5uYW1lXSA9IHRleHQ7CiAgICAgICAgICAgICAgICAgICAgY3VyT2JqW3ZhbHVlRmllbGQubmFtZV0gPSAwOwogICAgICAgICAgICAgICAgICAgIE9iamVjdC5hc3NpZ24oY29weVRlbXAsY3VyT2JqKTsKICAgICAgICAgICAgICAgICAgICBkYXRhLnB1c2goY29weVRlbXApOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9KQogICAgICAgIH0gIAogICAgfQoKICAgIC8qKgogICAgICog5aSE55CG5Y2V5Liq5bGe5oCnCiAgICAgKiAKICAgICAqIEBwYXJhbSB7Kn0gaW5wdXQg6L6T5YWl5YC8CiAgICAgKiBAcGFyYW0geyp9IGZpZWxkIOWxnuaAp+WAvAogICAgICogQHBhcmFtIHsqfSBhbGxDb2RlTGlzdCDmiYDmnInku6PnoIHooagKICAgICAqIEBwYXJhbSB7Kn0gcmVzdWx0IOe7k+aenOWAvAogICAgICogCiAgICAgKiBAbWVtYmVyb2YgRGJfc3lzcG9ydGxldDRfY2hhcnRCYXNlCiAgICAgKi8KICAgIHB1YmxpYyBoYW5kbGVTaW5nbGVEYXRhU2V0RmllbGQoaW5wdXQ6YW55LGZpZWxkOmFueSxhbGxDb2RlTGlzdDphbnkscmVzdWx0OmFueSxncm91cEZpZWxkOmFueSl7CiAgICAgICAgbGV0IHRlbXBGaWVsZE9iajphbnkgPSB7fTsKICAgICAgICAvL+WtmOWcqOS7o+eggeihqOeahOaDheWGtSjoh6rliqjovazljJblgLwpCiAgICAgICAgaWYoZmllbGQuY29kZWxpc3QpewogICAgICAgICAgICAvL+iOt+WPluS7o+eggeihqAogICAgICAgICAgICBsZXQgY3VyQ29kZUxpc3Q6TWFwPG51bWJlcixhbnk+ID0gYWxsQ29kZUxpc3QuZ2V0KGZpZWxkLmNvZGVsaXN0LnRhZyk7CiAgICAgICAgICAgIHRlbXBGaWVsZE9ialtmaWVsZC5uYW1lXSA9IGN1ckNvZGVMaXN0LmdldChpbnB1dFtmaWVsZC5uYW1lXSk7CiAgICAgICAgICAgIHRlbXBGaWVsZE9ialtmaWVsZC5uYW1lKydfc3JmdmFsdWUnXSA9IGlucHV0W2ZpZWxkLm5hbWVdOwogICAgICAgIH1lbHNlewogICAgICAgICAgICAgLy8g5LiN5a2Y5Zyo5Luj56CB6KGo55qE5oOF5Ya1CiAgICAgICAgICAgIGlmKGdyb3VwRmllbGQgJiYgT2JqZWN0LmlzKGdyb3VwRmllbGQubmFtZSxmaWVsZC5uYW1lKSl7CiAgICAgICAgICAgICAgICBpZihPYmplY3QuaXMoZ3JvdXBGaWVsZC5ncm91cE1vZGUsIllFQVIiKSApewogICAgICAgICAgICAgICAgICAgIHRlbXBGaWVsZE9ialtmaWVsZC5uYW1lXSA9IG1vbWVudChpbnB1dFtmaWVsZC5uYW1lXSkueWVhcigpLnRvU3RyaW5nKCk7CiAgICAgICAgICAgICAgICB9ZWxzZSBpZihPYmplY3QuaXMoZ3JvdXBGaWVsZC5ncm91cE1vZGUsIlFVQVJURVIiKSApewogICAgICAgICAgICAgICAgICAgIHRlbXBGaWVsZE9ialtmaWVsZC5uYW1lXSA9IG1vbWVudChpbnB1dFtmaWVsZC5uYW1lXSkueWVhcigpLnRvU3RyaW5nKCkrIi0iK21vbWVudChpbnB1dFtmaWVsZC5uYW1lXSkucXVhcnRlcnMoKS50b1N0cmluZygpOwogICAgICAgICAgICAgICAgfWVsc2UgaWYoT2JqZWN0LmlzKGdyb3VwRmllbGQuZ3JvdXBNb2RlLCJNT05USCIpICl7CiAgICAgICAgICAgICAgICAgICAgdGVtcEZpZWxkT2JqW2ZpZWxkLm5hbWVdID0gbW9tZW50KGlucHV0W2ZpZWxkLm5hbWVdKS55ZWFyKCkudG9TdHJpbmcoKSsiLSIrbW9tZW50KGlucHV0W2ZpZWxkLm5hbWVdKS5tb250aCgpLnRvU3RyaW5nKCk7CiAgICAgICAgICAgICAgICB9ZWxzZSBpZihPYmplY3QuaXMoZ3JvdXBGaWVsZC5ncm91cE1vZGUsIllFQVJXRUVLIikgKXsKICAgICAgICAgICAgICAgICAgICB0ZW1wRmllbGRPYmpbZmllbGQubmFtZV0gPSBtb21lbnQoaW5wdXRbZmllbGQubmFtZV0pLnllYXIoKS50b1N0cmluZygpKyItIittb21lbnQoaW5wdXRbZmllbGQubmFtZV0pLndlZWsoKS50b1N0cmluZygpOwogICAgICAgICAgICAgICAgfWVsc2UgaWYoT2JqZWN0LmlzKGdyb3VwRmllbGQuZ3JvdXBNb2RlLCJEQVkiKSApewogICAgICAgICAgICAgICAgICAgIHRlbXBGaWVsZE9ialtmaWVsZC5uYW1lXSA9IG1vbWVudChpbnB1dFtmaWVsZC5uYW1lXSkuZm9ybWF0KCJZWVlZLU1NLUREIik7CiAgICAgICAgICAgICAgICB9ZWxzZXsKICAgICAgICAgICAgICAgICAgICB0ZW1wRmllbGRPYmpbZmllbGQubmFtZV0gPSBpbnB1dFtmaWVsZC5uYW1lXTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfWVsc2V7CiAgICAgICAgICAgICAgICB0ZW1wRmllbGRPYmpbZmllbGQubmFtZV0gPSBpbnB1dFtmaWVsZC5uYW1lXQogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIE9iamVjdC5hc3NpZ24ocmVzdWx0LHRlbXBGaWVsZE9iaik7CiAgICB9CgogICAgLyoqCiAgICAgKiDojrflj5blm77ooajmiYDpnIDku6PnoIHooagKICAgICAqIAogICAgICogQG1lbWJlcm9mIERiX3N5c3BvcnRsZXQ0X2NoYXJ0QmFzZQogICAgICovCiAgICBwdWJsaWMgZ2V0Q2hhcnRBbGxDb2RlTGlzdCgpOlByb21pc2U8YW55PnsKICAgICAgICByZXR1cm4gbmV3IFByb21pc2UoKHJlc29sdmU6YW55LHJlamVjdDphbnkpID0+ewogICAgICAgICAgICBsZXQgY29kZUxpc3RNYXA6TWFwPHN0cmluZyxhbnk+ID0gbmV3IE1hcCgpOwogICAgICAgICAgICBpZihPYmplY3QudmFsdWVzKHRoaXMuc2VyaWVzTW9kZWwpLmxlbmd0aCA+MCl7CiAgICAgICAgICAgICAgICBsZXQgdGVtcEZsYWc6Ym9vbGVhbiA9IHRydWU7CiAgICAgICAgICAgICAgICBPYmplY3QudmFsdWVzKHRoaXMuc2VyaWVzTW9kZWwpLmZvckVhY2goKHNpbmdsZVNlcmllczphbnkpID0+ewogICAgICAgICAgICAgICAgICAgIGlmKHNpbmdsZVNlcmllcy5kYXRhU2V0RmllbGRzICYmIHNpbmdsZVNlcmllcy5kYXRhU2V0RmllbGRzLmxlbmd0aCA+MCl7CiAgICAgICAgICAgICAgICAgICAgICAgIGxldCBwcm9taXNlQXJyYXk6QXJyYXk8YW55PiA9IFtdOwogICAgICAgICAgICAgICAgICAgICAgICBsZXQgcHJvbWlzZUtleUFycmF5OkFycmF5PGFueT4gPSBbXTsKICAgICAgICAgICAgICAgICAgICAgICAgc2luZ2xlU2VyaWVzLmRhdGFTZXRGaWVsZHMuZm9yRWFjaCgoc2luZ2xlRGF0YVNldEZpZWxkOmFueSxpbmRleDphbnkpID0+ewogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYoc2luZ2xlRGF0YVNldEZpZWxkLmNvZGVsaXN0KXsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0ZW1wRmxhZyA9IGZhbHNlOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmKCFjb2RlTGlzdE1hcC5nZXQoc2luZ2xlRGF0YVNldEZpZWxkLmNvZGVsaXN0LnRhZykpewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwcm9taXNlQXJyYXkucHVzaCh0aGlzLmdldENvZGVMaXN0KHNpbmdsZURhdGFTZXRGaWVsZC5jb2RlbGlzdCkpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwcm9taXNlS2V5QXJyYXkucHVzaChzaW5nbGVEYXRhU2V0RmllbGQuY29kZWxpc3QudGFnKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgUHJvbWlzZS5hbGwocHJvbWlzZUFycmF5KS50aGVuKChyZXN1bHQ6YW55KSA9PnsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmKHJlc3VsdCAmJiByZXN1bHQubGVuZ3RoID4wKXsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXN1bHQuZm9yRWFjaCgoY29kZUxpc3Q6YW55KSA9PnsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbGV0IHRlbXBDb2RlTGlzdE1hcDpNYXA8bnVtYmVyLGFueT4gPSBuZXcgTWFwKCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmKGNvZGVMaXN0Lmxlbmd0aCA+MCl7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb2RlTGlzdC5mb3JFYWNoKChjb2RlTGlzdEl0ZW06YW55KSA9PnsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0ZW1wQ29kZUxpc3RNYXAuc2V0KGNvZGVMaXN0SXRlbS52YWx1ZSxjb2RlTGlzdEl0ZW0udGV4dCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvZGVMaXN0TWFwLnNldChzaW5nbGVEYXRhU2V0RmllbGQuY29kZWxpc3QudGFnLHRlbXBDb2RlTGlzdE1hcCk7ICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZShjb2RlTGlzdE1hcCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICBpZih0ZW1wRmxhZyl7cmVzb2x2ZShjb2RlTGlzdE1hcCk7fQogICAgICAgICAgICB9ZWxzZXsKICAgICAgICAgICAgICAgIHJlc29sdmUoY29kZUxpc3RNYXApOwogICAgICAgICAgICB9CiAgICAgICAgfSkKICAgIH0KCiAgICAvKioKICAgICAqIOiOt+WPluS7o+eggeihqAogICAgICogCiAgICAgKiBAcmV0dXJucyB7UHJvbWlzZTxhbnk+fSAKICAgICAqIEBtZW1iZXJvZiBEYl9zeXNwb3J0bGV0NF9jaGFydEJhc2UKICAgICAqLwogICAgcHVibGljIGdldENvZGVMaXN0KGNvZGVMaXN0T2JqZWN0OmFueSk6UHJvbWlzZTxhbnk+ewogICAgICAgIHJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZTphbnkscmVqZWN0OmFueSkgPT57CiAgICAgICAgICAgIGlmKGNvZGVMaXN0T2JqZWN0LnRhZyAmJiBPYmplY3QuaXMoY29kZUxpc3RPYmplY3QudHlwZSwiU1RBVElDIikpewogICAgICAgICAgICAgICAgY29uc3QgY29kZWxpc3QgPSB0aGlzLiRzdG9yZS5nZXR0ZXJzLmdldENvZGVMaXN0KGNvZGVMaXN0T2JqZWN0LnRhZyk7CiAgICAgICAgICAgICAgICBpZiAoY29kZWxpc3QpIHsKICAgICAgICAgICAgICAgICAgICByZXNvbHZlKFsuLi5KU09OLnBhcnNlKEpTT04uc3RyaW5naWZ5KGNvZGVsaXN0Lml0ZW1zKSldKTsKICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coYC0tLS0ke2NvZGVMaXN0T2JqZWN0LnRhZ30tLS0t5Luj56CB6KGo5LiN5a2Y5ZyoYCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH1lbHNlIGlmKGNvZGVMaXN0T2JqZWN0LnRhZyAmJiBPYmplY3QuaXMoY29kZUxpc3RPYmplY3QudHlwZSwiRFlOQU1JQyIpKXsKICAgICAgICAgICAgICAgIHRoaXMuY29kZUxpc3RTZXJ2aWNlLmdldEl0ZW1zKGNvZGVMaXN0T2JqZWN0LnRhZykudGhlbigocmVzOmFueSkgPT4gewogICAgICAgICAgICAgICAgICAgIHJlc29sdmUocmVzKTsKICAgICAgICAgICAgICAgIH0pLmNhdGNoKChlcnJvcjphbnkpID0+IHsKICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhgLS0tLSR7Y29kZUxpc3RPYmplY3QudGFnfS0tLS3ku6PnoIHooajkuI3lrZjlnKhgKTsKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9CiAgICAgICAgfSkKICAgIH0KCgp9Cg=="},null]}
{"remainingRequest":"F:\\crod项目\\人事管理系统2\\iBizEHR\\app_EHRPim\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!F:\\crod项目\\人事管理系统2\\iBizEHR\\app_EHRPim\\src\\widgets\\pim-person\\org-person-org-type-chart\\org-person-org-type-chart-base.vue?vue&type=script&lang=tsx&","dependencies":[{"path":"F:\\crod项目\\人事管理系统2\\iBizEHR\\app_EHRPim\\src\\widgets\\pim-person\\org-person-org-type-chart\\org-person-org-type-chart-base.vue","mtime":1630509411905},{"path":"F:\\crod项目\\人事管理系统2\\iBizEHR\\app_EHRPim\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1630511852775},{"path":"F:\\crod项目\\人事管理系统2\\iBizEHR\\app_EHRPim\\node_modules\\thread-loader\\dist\\cjs.js","mtime":1630511853252},{"path":"F:\\crod项目\\人事管理系统2\\iBizEHR\\app_EHRPim\\node_modules\\babel-loader\\lib\\index.js","mtime":1630511852747},{"path":"F:\\crod项目\\人事管理系统2\\iBizEHR\\app_EHRPim\\node_modules\\ts-loader\\index.js","mtime":1630511985412},{"path":"F:\\crod项目\\人事管理系统2\\iBizEHR\\app_EHRPim\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1630511852775},{"path":"F:\\crod项目\\人事管理系统2\\iBizEHR\\app_EHRPim\\node_modules\\vue-loader\\lib\\index.js","mtime":1630512070338}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:CgoKCgoKCgoKaW1wb3J0IHsgVnVlLCBDb21wb25lbnQsIFByb3AsIFByb3ZpZGUsIEVtaXQsIFdhdGNoLCBNb2RlbCxJbmplY3QgfSBmcm9tICd2dWUtcHJvcGVydHktZGVjb3JhdG9yJzsKaW1wb3J0IHsgQ3JlYXRlRWxlbWVudCB9IGZyb20gJ3Z1ZSc7CmltcG9ydCB7IFN1YmplY3QsIFN1YnNjcmlwdGlvbiB9IGZyb20gJ3J4anMnOwppbXBvcnQgeyBDb250cm9sSW50ZXJmYWNlIH0gZnJvbSAnQC9pbnRlcmZhY2UvY29udHJvbCc7CmltcG9ydCB7IFVJQWN0aW9uVG9vbCxVdGlsIH0gZnJvbSAnQC91dGlscyc7CmltcG9ydCBOYXZEYXRhU2VydmljZSBmcm9tICdAL3NlcnZpY2UvYXBwL25hdmRhdGEtc2VydmljZSc7CmltcG9ydCBQaW1QZXJzb25TZXJ2aWNlIGZyb20gJ0Avc2VydmljZS9waW0tcGVyc29uL3BpbS1wZXJzb24tc2VydmljZSc7CmltcG9ydCBPcmdQZXJzb25PcmdUeXBlU2VydmljZSBmcm9tICcuL29yZy1wZXJzb24tb3JnLXR5cGUtY2hhcnQtc2VydmljZSc7CgppbXBvcnQgZWNoYXJ0cyBmcm9tICdlY2hhcnRzJzsKaW1wb3J0IG1vbWVudCBmcm9tICJtb21lbnQiOyAKaW1wb3J0IENvZGVMaXN0U2VydmljZSBmcm9tICJAc2VydmljZS9hcHAvY29kZWxpc3Qtc2VydmljZSI7CmltcG9ydCB7IENoYXJ0RGF0YVNldEZpZWxkLENoYXJ0TGluZVNlcmllcyxDaGFydEZ1bm5lbFNlcmllcyxDaGFydFBpZVNlcmllcyxDaGFydEJhclNlcmllcyxDaGFydFJhZGFyU2VyaWVzfSBmcm9tICdAL21vZGVsL2NoYXJ0LWRldGFpbCc7CgoKQENvbXBvbmVudCh7CiAgICBjb21wb25lbnRzOiB7CiAgICAgIAogICAgfQp9KQpleHBvcnQgZGVmYXVsdCBjbGFzcyBPcmdQZXJzb25PcmdUeXBlQmFzZSBleHRlbmRzIFZ1ZSBpbXBsZW1lbnRzIENvbnRyb2xJbnRlcmZhY2UgewoKICAgIC8qKgogICAgICog5ZCN56ewCiAgICAgKgogICAgICogQHR5cGUge3N0cmluZ30KICAgICAqIEBtZW1iZXJvZiBPcmdQZXJzb25PcmdUeXBlQmFzZQogICAgICovCiAgICBAUHJvcCgpIHB1YmxpYyBuYW1lPzogc3RyaW5nOwoKICAgIC8qKgogICAgICog6KeG5Zu+6YCa6K6v5a+56LGhCiAgICAgKgogICAgICogQHR5cGUge1N1YmplY3Q8Vmlld1N0YXRlPn0KICAgICAqIEBtZW1iZXJvZiBPcmdQZXJzb25PcmdUeXBlQmFzZQogICAgICovCiAgICBAUHJvcCgpIHB1YmxpYyB2aWV3U3RhdGUhOiBTdWJqZWN0PFZpZXdTdGF0ZT47CgogICAgLyoqCiAgICAgKiDlupTnlKjkuIrkuIvmlocKICAgICAqCiAgICAgKiBAdHlwZSB7Kn0KICAgICAqIEBtZW1iZXJvZiBPcmdQZXJzb25PcmdUeXBlQmFzZQogICAgICovCiAgICBAUHJvcCgpIHB1YmxpYyBjb250ZXh0OiBhbnk7CgogICAgLyoqCiAgICAgKiDop4blm77lj4LmlbAKICAgICAqCiAgICAgKiBAdHlwZSB7Kn0KICAgICAqIEBtZW1iZXJvZiBPcmdQZXJzb25PcmdUeXBlQmFzZQogICAgICovCiAgICBAUHJvcCgpIHB1YmxpYyB2aWV3cGFyYW1zOiBhbnk7CgogICAgLyoqCiAgICAgKiDop4blm77nirbmgIHkuovku7YKICAgICAqCiAgICAgKiBAcHVibGljCiAgICAgKiBAdHlwZSB7KFN1YnNjcmlwdGlvbiB8IHVuZGVmaW5lZCl9CiAgICAgKiBAbWVtYmVyb2YgT3JnUGVyc29uT3JnVHlwZUJhc2UKICAgICAqLwogICAgcHVibGljIHZpZXdTdGF0ZUV2ZW50OiBTdWJzY3JpcHRpb24gfCB1bmRlZmluZWQ7CgogICAgLyoqCiAgICAgKiDojrflj5bpg6jku7bnsbvlnosKICAgICAqCiAgICAgKiBAcmV0dXJucyB7c3RyaW5nfQogICAgICogQG1lbWJlcm9mIE9yZ1BlcnNvbk9yZ1R5cGVCYXNlCiAgICAgKi8KICAgIHB1YmxpYyBnZXRDb250cm9sVHlwZSgpOiBzdHJpbmcgewogICAgICAgIHJldHVybiAnQ0hBUlQnCiAgICB9CgoKCiAgICAvKioKICAgICAqIOW7uuaehOmDqOS7tuacjeWKoeWvueixoQogICAgICoKICAgICAqIEB0eXBlIHtPcmdQZXJzb25PcmdUeXBlU2VydmljZX0KICAgICAqIEBtZW1iZXJvZiBPcmdQZXJzb25PcmdUeXBlQmFzZQogICAgICovCiAgICBwdWJsaWMgc2VydmljZTogT3JnUGVyc29uT3JnVHlwZVNlcnZpY2UgPSBuZXcgT3JnUGVyc29uT3JnVHlwZVNlcnZpY2UoeyAkc3RvcmU6IHRoaXMuJHN0b3JlIH0pOwoKICAgIC8qKgogICAgICog5a6e5L2T5pyN5Yqh5a+56LGhCiAgICAgKgogICAgICogQHR5cGUge1BpbVBlcnNvblNlcnZpY2V9CiAgICAgKiBAbWVtYmVyb2YgT3JnUGVyc29uT3JnVHlwZUJhc2UKICAgICAqLwogICAgcHVibGljIGFwcEVudGl0eVNlcnZpY2U6IFBpbVBlcnNvblNlcnZpY2UgPSBuZXcgUGltUGVyc29uU2VydmljZSh7ICRzdG9yZTogdGhpcy4kc3RvcmUgfSk7CiAgICAKCgogICAgLyoqCiAgICAgKiDlhbPpl63op4blm74KICAgICAqCiAgICAgKiBAcGFyYW0ge2FueX0gYXJncwogICAgICogQG1lbWJlcm9mIE9yZ1BlcnNvbk9yZ1R5cGVCYXNlCiAgICAgKi8KICAgIHB1YmxpYyBjbG9zZVZpZXcoYXJnczogYW55KTogdm9pZCB7CiAgICAgICAgbGV0IF90aGlzOiBhbnkgPSB0aGlzOwogICAgICAgIF90aGlzLiRlbWl0KCdjbG9zZXZpZXcnLCBbYXJnc10pOwogICAgfQoKICAgIC8qKgogICAgICogIOiuoeaVsOWZqOWIt+aWsAogICAgICoKICAgICAqIEBtZW1iZXJvZiBPcmdQZXJzb25PcmdUeXBlQmFzZQogICAgICovCiAgICBwdWJsaWMgY291bnRlclJlZnJlc2goKXsKICAgICAgICBjb25zdCBfdGhpczphbnkgPXRoaXM7CiAgICAgICAgaWYoX3RoaXMuY291bnRlclNlcnZpY2VBcnJheSAmJiBfdGhpcy5jb3VudGVyU2VydmljZUFycmF5Lmxlbmd0aCA+MCl7CiAgICAgICAgICAgIF90aGlzLmNvdW50ZXJTZXJ2aWNlQXJyYXkuZm9yRWFjaCgoaXRlbTphbnkpID0+ewogICAgICAgICAgICAgICAgaWYoaXRlbS5yZWZyZXNoRGF0YSAmJiBpdGVtLnJlZnJlc2hEYXRhIGluc3RhbmNlb2YgRnVuY3Rpb24pewogICAgICAgICAgICAgICAgICAgIGl0ZW0ucmVmcmVzaERhdGEoKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSkKICAgICAgICB9CiAgICB9CgoKICAgIC8qKgogICAgICog6I635Y+W5aSa6aG55pWw5o2uCiAgICAgKgogICAgICogQHJldHVybnMge2FueVtdfQogICAgICogQG1lbWJlcm9mIE9yZ1BlcnNvbk9yZ1R5cGVCYXNlCiAgICAgKi8KICAgIHB1YmxpYyBnZXREYXRhcygpOiBhbnlbXSB7CiAgICAgICAgcmV0dXJuIFtdOwogICAgfQoKICAgIC8qKgogICAgICog6I635Y+W5Y2V6aG55qCRCiAgICAgKgogICAgICogQHJldHVybnMgeyp9CiAgICAgKiBAbWVtYmVyb2YgT3JnUGVyc29uT3JnVHlwZUJhc2UKICAgICAqLwogICAgcHVibGljIGdldERhdGEoKTogYW55IHsKICAgICAgICByZXR1cm4gbnVsbDsKICAgIH0KCiAgICAvKioKICAgICAqIOaYvuekuuWkhOeQhuaPkOekugogICAgICoKICAgICAqIEB0eXBlIHtib29sZWFufQogICAgICogQG1lbWJlcm9mIE9yZ1BlcnNvbk9yZ1R5cGVCYXNlCiAgICAgKi8KICAgIEBQcm9wKHsgZGVmYXVsdDogdHJ1ZSB9KSBwdWJsaWMgc2hvd0J1c3lJbmRpY2F0b3IhOiBib29sZWFuOwoKICAgIC8qKgogICAgICog6YOo5Lu26KGM5Li6LS1mZXRjaAogICAgICoKICAgICAqIEB0eXBlIHtzdHJpbmd9CiAgICAgKiBAbWVtYmVyb2YgT3JnUGVyc29uT3JnVHlwZUJhc2UKICAgICAqLwogICAgQFByb3AoKSBwdWJsaWMgZmV0Y2hBY3Rpb24hOiBzdHJpbmc7ICAKCiAgICAvKioKICAgICogVnVl5aOw5piO5ZGo5pyfKOe7hOS7tuWIneWni+WMluWujOavlSkKICAgICoKICAgICogQG1lbWJlcm9mIE9yZ1BlcnNvbk9yZ1R5cGVCYXNlCiAgICAqLwogICAgcHVibGljIGNyZWF0ZWQoKSB7CiAgICAgICAgIHRoaXMuYWZ0ZXJDcmVhdGVkKCk7ICAgICAKICAgIH0KCiAgICAvKioKICAgICog5omn6KGMY3JlYXRlZOWQjueahOmAu+i+kQogICAgKgogICAgKiBAbWVtYmVyb2YgT3JnUGVyc29uT3JnVHlwZUJhc2UKICAgICovCiAgICBwdWJsaWMgYWZ0ZXJDcmVhdGVkKCl7CiAgICAgICAgaWYgKHRoaXMudmlld1N0YXRlKSB7CiAgICAgICAgICAgIHRoaXMudmlld1N0YXRlRXZlbnQgPSB0aGlzLnZpZXdTdGF0ZS5zdWJzY3JpYmUoKHsgdGFnLCBhY3Rpb24sIGRhdGEgfSkgPT4gewogICAgICAgICAgICAgICAgaWYgKCFPYmplY3QuaXModGFnLCB0aGlzLm5hbWUpKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgaWYgKE9iamVjdC5pcygnbG9hZCcsIGFjdGlvbikpIHsKICAgICAgICAgICAgICAgICAgICB0aGlzLmxvYWQoZGF0YSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0pOwogICAgICAgIH0gIAogICAgfQoKICAgIC8qKgogICAgICogdnVlIOeUn+WRveWRqOacnwogICAgICoKICAgICAqIEBtZW1iZXJvZiBPcmdQZXJzb25PcmdUeXBlQmFzZQogICAgICovCiAgICBwdWJsaWMgZGVzdHJveWVkKCkgewogICAgICAgIHRoaXMuYWZ0ZXJEZXN0cm95KCk7CiAgICB9CgogICAgLyoqCiAgICAgKiDmiafooYxkZXN0cm95ZWTlkI7nmoTpgLvovpEKICAgICAqCiAgICAgKiBAbWVtYmVyb2YgT3JnUGVyc29uT3JnVHlwZUJhc2UKICAgICAqLwogICAgcHVibGljIGFmdGVyRGVzdHJveSgpIHsKICAgICAgICBpZiAodGhpcy52aWV3U3RhdGVFdmVudCkgewogICAgICAgICAgICB0aGlzLnZpZXdTdGF0ZUV2ZW50LnVuc3Vic2NyaWJlKCk7CiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICog5piv5ZCm5peg5pWw5o2uCiAgICAgKgogICAgICogQHB1YmxpYwogICAgICogQHR5cGUge2Jvb2xlYW59CiAgICAgKiBAbWVtYmVyb2YgUG9ydGxldF9PcmdQZXJzb25PcmdUeXBlUGllX2NoYXJ0QmFzZQogICAgICovCiAgICBwdWJsaWMgaXNOb0RhdGE6IGJvb2xlYW4gID0gZmFsc2U7CgogICAgLyoqCiAgICAgKiDlm77ooahkaXbnu5HlrprnmoRpZAogICAgICoKICAgICAqIEB0eXBlIHt9CiAgICAgKiBAbWVtYmVyb2YgUG9ydGxldF9PcmdQZXJzb25PcmdUeXBlUGllX2NoYXJ0QmFzZQogICAgICovICAgCiAgICBwdWJsaWMgY2hhcnRJZDpzdHJpbmcgPSB0aGlzLiR1dGlsLmNyZWF0ZVVVSUQoKTsKCiAgICAvKioKICAgICAqIGVjaGFydHPlm77ooajlr7nosaEKICAgICAqCiAgICAgKiBAdHlwZSB7fQogICAgICogQG1lbWJlcm9mIFBvcnRsZXRfT3JnUGVyc29uT3JnVHlwZVBpZV9jaGFydEJhc2UKICAgICAqLyAgIAogICAgcHVibGljIG15Q2hhcnQ6YW55OwoKICAgIC8qKgogICAgICog5Luj56CB6KGo5pyN5Yqh5a+56LGhCiAgICAgKgogICAgICogQHR5cGUge0NvZGVMaXN0U2VydmljZX0KICAgICAqIEBtZW1iZXJvZiBQb3J0bGV0X09yZ1BlcnNvbk9yZ1R5cGVQaWVfY2hhcnRCYXNlCiAgICAgKi8gIAogICAgcHVibGljIGNvZGVMaXN0U2VydmljZTpDb2RlTGlzdFNlcnZpY2UgPSBuZXcgQ29kZUxpc3RTZXJ2aWNlKHsgJHN0b3JlOiB0aGlzLiRzdG9yZSB9KTsKCiAgICAvKioKICAgICAqIOW6j+WIl+aooeWeiwogICAgICoKICAgICAqIEB0eXBlIHt9CiAgICAgKiBAbWVtYmVyb2YgUG9ydGxldF9PcmdQZXJzb25PcmdUeXBlUGllX2NoYXJ0QmFzZQogICAgICovCiAgICBwdWJsaWMgIHNlcmllc01vZGVsOmFueSA9IHsKICAgICAgICBvcmdwZXJzb25vcmd0eXBlcGllOm5ldyBDaGFydFBpZVNlcmllcyh7CiAgICBuYW1lOidvcmdwZXJzb25vcmd0eXBlcGllJywKICAgIAogICAgCiAgICBjYXRlZ29yRmllbGQ6J29ybXR5cGUnLAogICAgY2F0ZWdvckNvZGVMaXN0Ont0eXBlOidTVEFUSUMnLHRhZzonRWhyQ29kZUxpc3QwMDgzJyxlbXB0eWNvZGU6J2VtcHR5JyxlbXB0eXRleHQ6J+acquWumuS5iSd9LAogICAgCiAgICB2YWx1ZUZpZWxkOidjb3VudG51bScsCiAgICBzZXJpZXNWYWx1ZXM6W10sCiAgICBzZXJpZXNJbmRleDowLAogICAgZGF0YTpbXSwKICAgIHNlcmllc01hcDp7fSwKICAgIGRhdGFTZXRGaWVsZHM6WwogICAge25hbWU6Im9ybXR5cGUiLGNvZGVsaXN0Ont0eXBlOiJTVEFUSUMiLHRhZzoiRWhyQ29kZUxpc3QwMDgzIixlbXB0eWNvZGU6J2VtcHR5JyxlbXB0eXRleHQ6J+acquWumuS5iSd9LGlzR3JvdXBGaWVsZDp0cnVlLGdyb3VwTW9kZToiQ09ERUxJU1QifSwKICAgIHtuYW1lOiJjb3VudG51bSIsY29kZWxpc3Q6bnVsbCxpc0dyb3VwRmllbGQ6ZmFsc2UsZ3JvdXBNb2RlOiIifQogICAgXSwKICAgIGVjeE9iamVjdDp7CiAgICAgICAgbGFiZWw6ewogICAgICAgICAgICBzaG93OiB0cnVlLAogICAgICAgICAgICBwb3NpdGlvbjogJ291dHNpZGUnLAogICAgICAgIH0sCiAgICAgICAgbGFiZWxMaW5lOnsKICAgICAgICAgICAgc2hvdzogdHJ1ZSwKICAgICAgICAgICAgbGVuZ3RoOiAxMCwKICAgICAgICAgICAgbGluZVN0eWxlOiB7CiAgICAgICAgICAgICAgICB3aWR0aDogMSwKICAgICAgICAgICAgICAgIHR5cGU6ICdzb2xpZCcKICAgICAgICAgICAgfQogICAgICAgIH0sCiAgICAgICAgaXRlbVN0eWxlOnsKICAgICAgICAgICAgYm9yZGVyQ29sb3I6ICcjZmZmJywKICAgICAgICAgICAgYm9yZGVyV2lkdGg6IDEKICAgICAgICB9LAogICAgICAgIGVtcGhhc2lzOnsKICAgICAgICAgICAgbGFiZWw6IHsKICAgICAgICAgICAgICAgIGZvbnRTaXplOiAyMAogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfSwKICAgIGVjT2JqZWN0OnsKICAgICAgICBsYWJlbDp7Zm9ybWF0dGVyOiJ7Yn06IHtAY291bnRudW195Lq6In0sCiAgICAgICAgcmFkaXVzOlsnNTAlJywgJzcwJSddLAogICAgICAgIGxlZ2VuZDp7Zm9ybWF0dGVyOiJ7YX06IHtAY291bnRudW195Lq6In0sCiAgICB9LAogICAgc2VyaWVzVGVtcDp7CiAgICAgICAgdHlwZToncGllJywKICAgIH0sCiAgICBiYXNlT3B0aW9uOnsKICAgIH0sCiAgICBzZXJpZXNMYXlvdXRCeToiY29sdW1uIgogICAgfSkKCiAgICB9OwoKICAgIC8qKgogICAgICog5Zu+6KGo6Ieq5a6a5LmJ5Y+C5pWw6ZuG5ZCICiAgICAgKgogICAgICogQG1lbWJlcm9mIFBvcnRsZXRfT3JnUGVyc29uT3JnVHlwZVBpZV9jaGFydEJhc2UKICAgICAqLyAgIAogICAgcHVibGljIGNoYXJ0VXNlclBhcmFtczphbnkgPXsKICAgICAgICBsZWdlbmQ6e3Nob3c6IHRydWUsbGVmdDoibGVmdCIsdG9wOiI3NSUiLG9yaWVudDogJ3ZlcnRpY2FsJyx9LAogICAgICAgIGNvbG9yOlsiI2Y2OWY1NCIsIiMwMGZmYTkiLCIjYWEwMGZmIiwiIzg4NGJmZiIsJyM0MkIzRkYnLCcjODVCM0ZGJywnI0ExRkZGRiddCiAgICB9OwoKICAgIC8qKgogICAgICog5Zu+6KGo5Z+656GA5Yqo5oCB5qih5Z6LCiAgICAgKgogICAgICogQG1lbWJlcm9mIFBvcnRsZXRfT3JnUGVyc29uT3JnVHlwZVBpZV9jaGFydEJhc2UKICAgICAqLyAgCiAgICBwdWJsaWMgY2hhcnRCYXNlT1B0aW9uOmFueSA9IHt9OwoKICAgIC8qKgogICAgICog5Yid5aeL5YyW5Zu+6KGo5omA6ZyA5Y+C5pWwCiAgICAgKgogICAgICogQHR5cGUge30KICAgICAqIEBtZW1iZXJvZiBQb3J0bGV0X09yZ1BlcnNvbk9yZ1R5cGVQaWVfY2hhcnRCYXNlCiAgICAgKi8gICAKICAgIHB1YmxpYyBjaGFydE9wdGlvbjphbnkgPSB7CiAgICAgICAgdGl0bGU6ewogICAgICAgICAgICBzaG93OnRydWUgLAogICAgICAgICAgICB0ZXh0OifmnLrlhbPkuI7pobnnm67kurrlkZgnLAogICAgICAgICAgICBzdWJ0ZXh0OicnCiAgICAgICAgfSwKICAgICAgICBsZWdlbmQ6ewogICAgICAgICAgICBzaG93OmZhbHNlCiAgICAgICAgfSwKICAgICAgICB0b29sdGlwOnsKICAgICAgICAgICAgc2hvdzp0cnVlCiAgICAgICAgfSwKICAgICAgICBkYXRhc2V0OltdLAogICAgICAgIHNlcmllczpbCiAgICAgICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgIGlkOidvcmdwZXJzb25vcmd0eXBlcGllJywNCiAgICAgICAgICAgIG5hbWU6J+acuuWFs+S4jumhueebruS6uuWRmCcsDQogICAgICAgICAgICB0eXBlOidwaWUnLA0KICAgICAgICAgICAgZGF0YXNldEluZGV4OjAsDQogICAgICAgICAgICANCiAgICAgICAgICAgIHNlcmllc0xheW91dEJ5OiJjb2x1bW4iLA0KICAgICAgICAgICAgZW5jb2RlOnsNCiAgICAgICAgICAgICAgICBpdGVtTmFtZToib3JtdHlwZSIsDQogICAgICAgICAgICAgICAgdmFsdWU6ImNvdW50bnVtIg0KICAgICAgICAgICAgfX0NCiAgICAgICAgXQogICAgfTsKCiAgICAvKioKICAgICAqIOWIt+aWsAogICAgICoKICAgICAqIEBwYXJhbSB7Kn0gW29wdD17fV0KICAgICAqIEBtZW1iZXJvZiBQb3J0bGV0X09yZ1BlcnNvbk9yZ1R5cGVQaWVfY2hhcnRCYXNlCiAgICAgKi8KICAgIHB1YmxpYyByZWZyZXNoKG9wdDogYW55ID0ge30pIHsKICAgICAgICB0aGlzLmxvYWQob3B0KTsKICAgIH0KCiAgICAvKioKICAgICAqIOiOt+WPluWbvuihqOaVsOaNrgogICAgICogCiAgICAgKiBAcmV0dXJucyB7Kn0gCiAgICAgKiBAbWVtYmVyb2YgUG9ydGxldF9PcmdQZXJzb25PcmdUeXBlUGllX2NoYXJ0QmFzZQogICAgICovCiAgICBwdWJsaWMgbG9hZChvcHQ/OmFueSkgewogICAgICAgIGxldCBfdGhpcyA9IHRoaXM7CiAgICAgICAgY29uc3QgYXJnOiBhbnkgPSB7IC4uLm9wdCB9OwogICAgICAgIGNvbnN0IHBhcmVudGRhdGE6IGFueSA9IHt9OwogICAgICAgIHRoaXMuJGVtaXQoJ2JlZm9yZWxvYWQnLCBwYXJlbnRkYXRhKTsKICAgICAgICBPYmplY3QuYXNzaWduKGFyZywgcGFyZW50ZGF0YSk7CiAgICAgICAgT2JqZWN0LmFzc2lnbihhcmcse3ZpZXdwYXJhbXM6dGhpcy52aWV3cGFyYW1zLHBhZ2U6MCxzaXplOjEwMDB9KTsKICAgICAgICB0aGlzLnNlcnZpY2Uuc2VhcmNoKHRoaXMuZmV0Y2hBY3Rpb24sSlNPTi5wYXJzZShKU09OLnN0cmluZ2lmeSh0aGlzLmNvbnRleHQpKSxhcmcsdGhpcy5zaG93QnVzeUluZGljYXRvcikudGhlbigocmVzKSA9PiB7CiAgICAgICAgICAgIGlmIChyZXMpIHsKICAgICAgICAgICAgICAgdGhpcy50cmFuc2Zvcm1Ub0Jhc2ljQ2hhcnRTZXREYXRhKHJlcy5kYXRhLChjb2RlbGlzdDphbnkpID0+e190aGlzLmRyYXdDaGFydHMoY29kZWxpc3QpfSk7CiAgICAgICAgICAgIH0KICAgICAgICB9KS5jYXRjaCgoZXJyb3IpID0+IHsKICAgICAgICAgICAgY29uc29sZS5lcnJvcihlcnJvcik7CiAgICAgICAgfSk7CiAgICB9CgogICAgLyoqCiAgICAgKiDnu5jliLblm77ooagKICAgICAqIAogICAgICogQHJldHVybnMgeyp9IAogICAgICogQG1lbWJlcm9mIFBvcnRsZXRfT3JnUGVyc29uT3JnVHlwZVBpZV9jaGFydEJhc2UKICAgICAqLwogICAgcHVibGljIGRyYXdDaGFydHMoY29kZWxpc3Q6YW55KXsKICAgICAgICBpZighdGhpcy5teUNoYXJ0KXsKICAgICAgICAgIGxldCBlbGVtZW50OmFueSA9ICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCh0aGlzLmNoYXJ0SWQpOwogICAgICAgICAgdGhpcy5teUNoYXJ0ID0gZWNoYXJ0cy5pbml0KGVsZW1lbnQpOwogICAgICAgIH0KICAgICAgICBsZXQgX2NoYXJ0T3B0aW9uID0gdGhpcy5oYW5kbGVDaGFydE9QdGlvbihjb2RlbGlzdCk7CiAgICAgICAgY29uc29sZS5sb2coX2NoYXJ0T3B0aW9uKTsKICAgICAgICB0aGlzLm15Q2hhcnQuc2V0T3B0aW9uKF9jaGFydE9wdGlvbik7CiAgICAgICAgdGhpcy5teUNoYXJ0LnJlc2l6ZSgpOwogICAgfQoKICAgIC8qKgogICAgICog5aSE55CG5Zu+6KGo5Y+C5pWwCiAgICAgKiAKICAgICAqIEBtZW1iZXJvZiBQb3J0bGV0X09yZ1BlcnNvbk9yZ1R5cGVQaWVfY2hhcnRCYXNlCiAgICAgKi8KICAgIHB1YmxpYyBoYW5kbGVDaGFydE9QdGlvbihhbGxjb2RlbGlzdDphbnkpewogICAgICAgIGxldCBfY2hhcnRPcHRpb246YW55ID0gSlNPTi5wYXJzZShKU09OLnN0cmluZ2lmeSh0aGlzLmNoYXJ0T3B0aW9uKSk7CiAgICAgICAgaWYoT2JqZWN0LmtleXModGhpcy5zZXJpZXNNb2RlbCkubGVuZ3RoID4gMCl7CiAgICAgICAgICAgIGxldCB0ZW1wRGF0YVNvdXJjZU1hcDpNYXA8c3RyaW5nLGFueT4gPSBuZXcgTWFwKCk7CiAgICAgICAgICAgIGZvcihsZXQgaT0wO2k8T2JqZWN0LmtleXModGhpcy5zZXJpZXNNb2RlbCkubGVuZ3RoO2krKyl7CiAgICAgICAgICAgICAgICBPYmplY3QudmFsdWVzKHRoaXMuc2VyaWVzTW9kZWwpLmZvckVhY2goKHNlcmllc3ZhbHVlOmFueSkgPT57CiAgICAgICAgICAgICAgICAgICAgaWYoc2VyaWVzdmFsdWUuc2VyaWVzSW5kZXggPT09IGkpewogICAgICAgICAgICAgICAgICAgICAgICB0ZW1wRGF0YVNvdXJjZU1hcC5zZXQoc2VyaWVzdmFsdWUubmFtZSxzZXJpZXN2YWx1ZS5kYXRhKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmKHRlbXBEYXRhU291cmNlTWFwLnNpemUgPiAwKXsKICAgICAgICAgICAgICAgIHRlbXBEYXRhU291cmNlTWFwLmZvckVhY2goKGl0ZW06YW55KSA9PnsKICAgICAgICAgICAgICAgICAgICBfY2hhcnRPcHRpb24uZGF0YXNldC5wdXNoKHsnc291cmNlJzppdGVtfSk7CiAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICB9CiAgICAgICAgICAgIE9iamVjdC5rZXlzKHRoaXMuc2VyaWVzTW9kZWwpLmZvckVhY2goKHNlcmllc05hbWU6c3RyaW5nKSA9PnsKICAgICAgICAgICAgICAgIGlmKF9jaGFydE9wdGlvbiAmJiBfY2hhcnRPcHRpb24uc2VyaWVzLmxlbmd0aCA+IDApewogICAgICAgICAgICAgICAgICAgIF9jaGFydE9wdGlvbi5zZXJpZXMuZm9yRWFjaCgoaXRlbTphbnkpID0+ewogICAgICAgICAgICAgICAgICAgICAgICBpZih0aGlzLnNlcmllc01vZGVsW3Nlcmllc05hbWVdLmVjeE9iamVjdCAmJiBPYmplY3QuaXMoc2VyaWVzTmFtZSxpdGVtLmlkKSl7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpdGVtID0gVXRpbC5kZWVwT2JqZWN0TWVyZ2UoaXRlbSx0aGlzLnNlcmllc01vZGVsW3Nlcmllc05hbWVdLmVjeE9iamVjdCk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgaWYodGhpcy5zZXJpZXNNb2RlbFtzZXJpZXNOYW1lXS5iYXNlT3B0aW9uICYmIE9iamVjdC5rZXlzKHRoaXMuc2VyaWVzTW9kZWxbc2VyaWVzTmFtZV0uYmFzZU9wdGlvbikubGVuZ3RoID4gMCAgJiYgT2JqZWN0LmlzKHNlcmllc05hbWUsaXRlbS5pZCkpewogICAgICAgICAgICAgICAgICAgICAgICAgICAgaXRlbSA9IFV0aWwuZGVlcE9iamVjdE1lcmdlKGl0ZW0sdGhpcy5zZXJpZXNNb2RlbFtzZXJpZXNOYW1lXS5iYXNlT3B0aW9uKTsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICBpZih0aGlzLnNlcmllc01vZGVsW3Nlcmllc05hbWVdLmVjT2JqZWN0ICYmIE9iamVjdC5pcyhzZXJpZXNOYW1lLGl0ZW0uaWQpKXsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGl0ZW0gPSBVdGlsLmRlZXBPYmplY3RNZXJnZShpdGVtLHRoaXMuc2VyaWVzTW9kZWxbc2VyaWVzTmFtZV0uZWNPYmplY3QpOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIC8v6K6+572u5aSa5bqP5YiXCiAgICAgICAgICAgICAgICBsZXQgdGVtcFNlcmllczphbnkgPSB0aGlzLnNlcmllc01vZGVsW3Nlcmllc05hbWVdOwogICAgICAgICAgICAgICAgLy8g6Z2e6Zu36L6+5Zu+CiAgICAgICAgICAgICAgICBpZih0ZW1wU2VyaWVzICYmIHRlbXBTZXJpZXMuc2VyaWVzSWRGaWVsZCAmJiB0ZW1wU2VyaWVzLnNlcmllc1ZhbHVlcy5sZW5ndGggPiAwICYmICFPYmplY3QuaXModGVtcFNlcmllcy50eXBlLCdyYWRhcicpKXsKICAgICAgICAgICAgICAgICAgICBjb25zdCByZXR1cm5JbmRleDpudW1iZXIgPSBfY2hhcnRPcHRpb24uc2VyaWVzLmZpbmRJbmRleCgoaXRlbTphbnkpID0+ewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gT2JqZWN0LmlzKGl0ZW0uaWQsc2VyaWVzTmFtZSk7CiAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICAgICBfY2hhcnRPcHRpb24uc2VyaWVzLnNwbGljZShyZXR1cm5JbmRleCwxKTsKICAgICAgICAgICAgICAgICAgICBsZXQgdGVtcFNlcmllc0FycmF5OkFycmF5PGFueT4gPSBbXTsKICAgICAgICAgICAgICAgICAgICB0ZW1wU2VyaWVzLnNlcmllc1ZhbHVlcy5mb3JFYWNoKChzZXJpZXN2YWx1ZUl0ZW06YW55KSA9PnsKICAgICAgICAgICAgICAgICAgICAgICAgbGV0IHRlbXBTZXJpZXNUZW1wOmFueSA9IEpTT04ucGFyc2UoSlNPTi5zdHJpbmdpZnkodGVtcFNlcmllcy5zZXJpZXNUZW1wKSk7CiAgICAgICAgICAgICAgICAgICAgICAgIE9iamVjdC5hc3NpZ24odGVtcFNlcmllc1RlbXAse25hbWU6dGVtcFNlcmllcy5zZXJpZXNNYXBbc2VyaWVzdmFsdWVJdGVtXSxkYXRhc2V0SW5kZXg6dGVtcFNlcmllcy5zZXJpZXNJbmRleCxlbmNvZGU6e3g6dGVtcFNlcmllcy5jYXRlZ29yRmllbGQseTpgJHtzZXJpZXN2YWx1ZUl0ZW19YH19KTsKICAgICAgICAgICAgICAgICAgICAgICAgX2NoYXJ0T3B0aW9uLnNlcmllcy5wdXNoKHRlbXBTZXJpZXNUZW1wKTsKICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9KQogICAgICAgIH0KICAgICAgICBpZihPYmplY3Qua2V5cyh0aGlzLmNoYXJ0QmFzZU9QdGlvbikubGVuZ3RoID4gMCl7CiAgICAgICAgICAgIE9iamVjdC5hc3NpZ24oX2NoYXJ0T3B0aW9uLHRoaXMuY2hhcnRCYXNlT1B0aW9uKTsKICAgICAgICB9CiAgICAgICAgaWYoT2JqZWN0LmtleXModGhpcy5jaGFydFVzZXJQYXJhbXMpLmxlbmd0aCA+MCl7CiAgICAgICAgICAgIE9iamVjdC5hc3NpZ24oX2NoYXJ0T3B0aW9uLHRoaXMuY2hhcnRVc2VyUGFyYW1zKTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIF9jaGFydE9wdGlvbjsKICAgIH0KCiAgICAvKioKICAgICAqIOWunuS9k+aVsOaNrumbhui9rOWMluS4uuWbvuihqOaVsOaNrumbhgogICAgICogCiAgICAgKiAxLuiOt+WPluWbvuihqOaJgOacieS7o+eggeihqOWAvAogICAgICogMi7mn6Xor6Lpm4blkIjmmKDlsITlm77ooajmlbDmja7pm4YKICAgICAqIDMu6KGl5YWo5Zu+6KGo5pWw5o2u6ZuGCiAgICAgKiA0LuWbvuihqOaVsOaNrumbhuWIhue7hOaxguWSjAogICAgICogNS7mjpLluo/lm77ooajmlbDmja7pm4YKICAgICAqIAogICAgICogQHBhcmFtIHsqfSBkYXRhIOWunuS9k+aVsOaNrumbhgogICAgICogQHBhcmFtIHtGdW5jdGlvbn0gY2FsbGJhY2sg5Zue6LCDCiAgICAgKiBAbWVtYmVyb2YgUG9ydGxldF9PcmdQZXJzb25PcmdUeXBlUGllX2NoYXJ0QmFzZQogICAgICovCiAgICBwdWJsaWMgYXN5bmMgdHJhbnNmb3JtVG9CYXNpY0NoYXJ0U2V0RGF0YShkYXRhOmFueSxjYWxsYmFjazpGdW5jdGlvbil7CiAgICAgICAgaWYoIWRhdGEgfHwgIUFycmF5LmlzQXJyYXkoZGF0YSkgfHwgZGF0YS5sZW5ndGggPT09IDApewogICAgICAgICAgICB0aGlzLmlzTm9EYXRhID0gdHJ1ZTsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KICAgICAgICB0aGlzLmlzTm9EYXRhID0gZmFsc2U7CiAgICAgICAgLy/ojrflj5bku6PnoIHooajlgLwKICAgICAgICBsZXQgYWxsQ29kZUxpc3Q6YW55ID0gYXdhaXQgdGhpcy5nZXRDaGFydEFsbENvZGVMaXN0KCk7CiAgICAgICAgaWYoT2JqZWN0LnZhbHVlcyh0aGlzLnNlcmllc01vZGVsKS5sZW5ndGggPiAwKXsKICAgICAgICAgICAgT2JqZWN0LnZhbHVlcyh0aGlzLnNlcmllc01vZGVsKS5mb3JFYWNoKChzaW5nbGVTZXJpZXM6YW55LGluZGV4Om51bWJlcikgPT57CiAgICAgICAgICAgICAgICAvLyDlgLzlsZ7mgKfkuLpzcmZjb3VudOiuvue9rntzcmZjb3VudDoxfeWIsGRhdGEKICAgICAgICAgICAgICAgIGxldCB2YWx1ZUZpZWxkID0gc2luZ2xlU2VyaWVzLmRhdGFTZXRGaWVsZHMuZmluZCgoZGF0YXNldEZpZWxkOmFueSkgPT57CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGRhdGFzZXRGaWVsZC5uYW1lID09PSBzaW5nbGVTZXJpZXMudmFsdWVGaWVsZDsKICAgICAgICAgICAgICAgIH0pOyAKICAgICAgICAgICAgICAgIGlmKHZhbHVlRmllbGQgJiYgdmFsdWVGaWVsZC5uYW1lICYmIE9iamVjdC5pcyh2YWx1ZUZpZWxkLm5hbWUsInNyZmNvdW50IikpewogICAgICAgICAgICAgICAgICAgIGRhdGEuZm9yRWFjaCgoc2luZ2xlRGF0YTphbnkpID0+ewogICAgICAgICAgICAgICAgICAgICAgICBPYmplY3QuYXNzaWduKHNpbmdsZURhdGEse3NyZmNvdW50OjF9KTsKICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgLy8g5YiG57uE5bGe5oCnCiAgICAgICAgICAgICAgICBsZXQgZ3JvdXBGaWVsZCA9IHNpbmdsZVNlcmllcy5kYXRhU2V0RmllbGRzLmZpbmQoKGRhdGFzZXRGaWVsZDphbnkpID0+ewogICAgICAgICAgICAgICAgICAgIHJldHVybiBkYXRhc2V0RmllbGQubmFtZSA9PT0gc2luZ2xlU2VyaWVzLmNhdGVnb3JGaWVsZDsKICAgICAgICAgICAgICAgIH0pOyAKICAgICAgICAgICAgICAgIGxldCB0ZW1wQ2hhcnRTZXREYXRhOkFycmF5PGFueT4gPSBbXTsKICAgICAgICAgICAgICAgIGxldCB0ZW1wU2VyaWVzVmFsdWVzOk1hcDxzdHJpbmcsYW55PiA9IG5ldyBNYXAoKTsKICAgICAgICAgICAgICAgIGRhdGEuZm9yRWFjaCgoaXRlbTphbnkpID0+ewogICAgICAgICAgICAgICAgICAgIGxldCB0ZW1wQ2hhcnRTZXREYXRhSXRlbTphbnkgPSB7fTsKICAgICAgICAgICAgICAgICAgICAvLyDluo/liJflsZ7mgKfkuI3lrZjlnKgKICAgICAgICAgICAgICAgICAgICBpZighc2luZ2xlU2VyaWVzLnNlcmllc0lkRmllbGQpewogICAgICAgICAgICAgICAgICAgICAgICBPYmplY3QuYXNzaWduKHRlbXBDaGFydFNldERhdGFJdGVtLHtuYW1lOnNpbmdsZVNlcmllcy5uYW1lfSk7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmKHNpbmdsZVNlcmllcy5kYXRhU2V0RmllbGRzICYmIHNpbmdsZVNlcmllcy5kYXRhU2V0RmllbGRzLmxlbmd0aCA+MCl7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzaW5nbGVTZXJpZXMuZGF0YVNldEZpZWxkcy5mb3JFYWNoKChzaW5nbGVEYXRhU2V0RmllbGQ6YW55KSA9PnsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmhhbmRsZVNpbmdsZURhdGFTZXRGaWVsZChpdGVtLHNpbmdsZURhdGFTZXRGaWVsZCxhbGxDb2RlTGlzdCx0ZW1wQ2hhcnRTZXREYXRhSXRlbSxncm91cEZpZWxkKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9ZWxzZXsKICAgICAgICAgICAgICAgICAgICAgICAgLy8g5bqP5YiX5bGe5oCn5a2Y5Zyo5pe2CiAgICAgICAgICAgICAgICAgICAgICAgIC8vIOW6j+WIl+S7o+eggeihqOWtmOWcqOaXtiznv7vor5F0ZW1wU2VyaWVzVmFsdWVz55qE6ZSu5YC85a+5CiAgICAgICAgICAgICAgICAgICAgICAgIGlmKHNpbmdsZVNlcmllcy5zZXJpZXNDb2RlTGlzdCl7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBzZXJpZXNDb2RlTGlzdDpNYXA8c3RyaW5nLGFueT4gPSBhbGxDb2RlTGlzdC5nZXQoc2luZ2xlU2VyaWVzLnNlcmllc0NvZGVMaXN0LnRhZyk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsZXQgdGVtcFNlcmllc1ZhbHVlSXRlbSA9IHRlbXBTZXJpZXNWYWx1ZXMuZ2V0KHNlcmllc0NvZGVMaXN0LmdldChpdGVtW3NpbmdsZVNlcmllcy5zZXJpZXNJZEZpZWxkXSkpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYoIXRlbXBTZXJpZXNWYWx1ZUl0ZW0pewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRlbXBTZXJpZXNWYWx1ZXMuc2V0KHNlcmllc0NvZGVMaXN0LmdldChpdGVtW3NpbmdsZVNlcmllcy5zZXJpZXNJZEZpZWxkXSksc2VyaWVzQ29kZUxpc3QuZ2V0KGl0ZW1bc2luZ2xlU2VyaWVzLnNlcmllc0lkRmllbGRdKSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIH1lbHNlewogICAgICAgICAgICAgICAgICAgICAgICAgICAgbGV0IHRlbXBTZXJpZXNWYWx1ZUl0ZW0gPSB0ZW1wU2VyaWVzVmFsdWVzLmdldChpdGVtW3NpbmdsZVNlcmllcy5zZXJpZXNJZEZpZWxkXSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZighdGVtcFNlcmllc1ZhbHVlSXRlbSl7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGVtcFNlcmllc1ZhbHVlcy5zZXQoaXRlbVtzaW5nbGVTZXJpZXMuc2VyaWVzSWRGaWVsZF0saXRlbVtzaW5nbGVTZXJpZXMuc2VyaWVzTmFtZUZpZWxkXSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgT2JqZWN0LmFzc2lnbih0ZW1wQ2hhcnRTZXREYXRhSXRlbSx7bmFtZTppdGVtW3NpbmdsZVNlcmllcy5zZXJpZXNJZEZpZWxkXX0pOwogICAgICAgICAgICAgICAgICAgICAgICBpZihzaW5nbGVTZXJpZXMuZGF0YVNldEZpZWxkcyAmJiBzaW5nbGVTZXJpZXMuZGF0YVNldEZpZWxkcy5sZW5ndGggPjApewogICAgICAgICAgICAgICAgICAgICAgICAgICAgc2luZ2xlU2VyaWVzLmRhdGFTZXRGaWVsZHMuZm9yRWFjaCgoc2luZ2xlRGF0YVNldEZpZWxkOmFueSkgPT57CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5oYW5kbGVTaW5nbGVEYXRhU2V0RmllbGQoaXRlbSxzaW5nbGVEYXRhU2V0RmllbGQsYWxsQ29kZUxpc3QsdGVtcENoYXJ0U2V0RGF0YUl0ZW0sZ3JvdXBGaWVsZCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIHRlbXBDaGFydFNldERhdGEucHVzaCh0ZW1wQ2hhcnRTZXREYXRhSXRlbSk7CiAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgLy8g6KGl5YWo5pWw5o2u6ZuG5ZCICiAgICAgICAgICAgICAgICB0aGlzLmNvbXBsZXRlRGF0YVNldCh0ZW1wQ2hhcnRTZXREYXRhLHNpbmdsZVNlcmllcyxhbGxDb2RlTGlzdCk7CiAgICAgICAgICAgICAgICAvLyDluo/liJfku6PnoIHooajlrZjlnKjml7Ys6KGl5YWo5bqP5YiXCiAgICAgICAgICAgICAgICBpZihzaW5nbGVTZXJpZXMuc2VyaWVzQ29kZUxpc3QpewogICAgICAgICAgICAgICAgICAgIGNvbnN0IHNlcmllc0NvZGVMaXN0Ok1hcDxzdHJpbmcsYW55PiA9IGFsbENvZGVMaXN0LmdldChzaW5nbGVTZXJpZXMuc2VyaWVzQ29kZUxpc3QudGFnKTsKICAgICAgICAgICAgICAgICAgICB0ZW1wU2VyaWVzVmFsdWVzID0gbmV3IE1hcCgpOwogICAgICAgICAgICAgICAgICAgIHNlcmllc0NvZGVMaXN0LmZvckVhY2goKGl0ZW06YW55KSA9PnsKICAgICAgICAgICAgICAgICAgICAgICAgdGVtcFNlcmllc1ZhbHVlcy5zZXQoaXRlbSxpdGVtKTsKICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgc2luZ2xlU2VyaWVzLnNlcmllc1ZhbHVlcyA9IFsuLi50ZW1wU2VyaWVzVmFsdWVzLmtleXMoKV07CiAgICAgICAgICAgICAgICBsZXQgdGVtcFNlcmllc01hcE9iajphbnkgPSB7fTsKICAgICAgICAgICAgICAgIHRlbXBTZXJpZXNWYWx1ZXMuZm9yRWFjaCgodmFsdWU6YW55LGtleTphbnkpID0+ewogICAgICAgICAgICAgICAgICAgIHRlbXBTZXJpZXNNYXBPYmpba2V5XSA9IHZhbHVlOwogICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgIHNpbmdsZVNlcmllcy5zZXJpZXNNYXAgPSB0ZW1wU2VyaWVzTWFwT2JqOwogICAgICAgICAgICAgICAgbGV0IGNhbGxiYWNrRnVuY3Rpb246YW55ID0gKGluZGV4ID09PSAoT2JqZWN0LnZhbHVlcyh0aGlzLnNlcmllc01vZGVsKS5sZW5ndGggLSAxKSk/Y2FsbGJhY2s6bnVsbDsKICAgICAgICAgICAgICAgIHRoaXMudHJhbnNmb3JtVG9DaGFydFNlcmllc0RhdGFTZXQodGVtcENoYXJ0U2V0RGF0YSxzaW5nbGVTZXJpZXMsY2FsbGJhY2tGdW5jdGlvbixhbGxDb2RlTGlzdCk7CiAgICAgICAgICAgIH0pCiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICog5p6E5bu65Zu+6KGo5bqP5YiX5pWw5o2u6ZuG5ZCICiAgICAgKiAKICAgICAqIDEu5YiG57uE5rGC5ZKMCiAgICAgKiAyLuaOkuW6j+axguWSjOaVsOe7hAogICAgICogCiAgICAgKiBAcGFyYW0ge0FycmF5PGFueT59IGRhdGEg5Lyg5YWl5pWw5o2uCiAgICAgKiBAcGFyYW0ge0FycmF5PGFueT59IGl0ZW0g5Y2V5Liq5bqP5YiXCiAgICAgKiBAcGFyYW0ge0FycmF5PGFueT59IGNhbGxiYWNrIOWbnuiwgwogICAgICogQHBhcmFtIHsqfSBhbGxDb2RlTGlzdCDmiYDmnInku6PnoIHooagKICAgICAqIAogICAgICogQG1lbWJlcm9mIFBvcnRsZXRfT3JnUGVyc29uT3JnVHlwZVBpZV9jaGFydEJhc2UKICAgICAqLwogICAgcHVibGljIHRyYW5zZm9ybVRvQ2hhcnRTZXJpZXNEYXRhU2V0KGRhdGE6YW55LGl0ZW06YW55LGNhbGxiYWNrOkZ1bmN0aW9uLGFsbENvZGVMaXN0OmFueSk6YW55ewogICAgICAgIGlmKGl0ZW0uc2VyaWVzSWRGaWVsZCl7CiAgICAgICAgICAgIC8vIOWkmuW6j+WIlwogICAgICAgICAgICBsZXQgZ3JvdXBGaWVsZCA9IGl0ZW0uZGF0YVNldEZpZWxkcy5maWx0ZXIoKGRhdGFzZXRGaWVsZDphbnkpID0+ewogICAgICAgICAgICAgICAgcmV0dXJuIGRhdGFzZXRGaWVsZC5uYW1lID09PSBpdGVtLmNhdGVnb3JGaWVsZDsKICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIGxldCB0ZW1wR3JvdXBGaWVsZDpBcnJheTxhbnk+ID0gZ3JvdXBGaWVsZC5tYXAoKGl0ZW06YW55KSA9PnsKICAgICAgICAgICAgICAgIHJldHVybiBpdGVtLm5hbWU7CiAgICAgICAgICAgIH0pOwogICAgICAgICAgICBsZXQgc2VyaWVzRmllbGQgPSBpdGVtLmRhdGFTZXRGaWVsZHMuZmlsdGVyKChkYXRhc2V0RmllbGQ6YW55KSA9PnsKICAgICAgICAgICAgICAgIHJldHVybiBkYXRhc2V0RmllbGQubmFtZSA9PT0gaXRlbS5zZXJpZXNJZEZpZWxkOwogICAgICAgICAgICB9KTsKICAgICAgICAgICAgbGV0IHRlbXBTZXJpZXNGaWVsZDpBcnJheTxhbnk+ID0gc2VyaWVzRmllbGQubWFwKChpdGVtOmFueSkgPT57CiAgICAgICAgICAgICAgICByZXR1cm4gaXRlbS5uYW1lOwogICAgICAgICAgICB9KTsKICAgICAgICAgICAgbGV0IHZhbHVlRmllbGQgPSBpdGVtLmRhdGFTZXRGaWVsZHMuZmlsdGVyKChkYXRhc2V0RmllbGQ6YW55KSA9PnsKICAgICAgICAgICAgICAgIHJldHVybiBkYXRhc2V0RmllbGQubmFtZSA9PT0gaXRlbS52YWx1ZUZpZWxkOwogICAgICAgICAgICB9KTsKICAgICAgICAgICAgbGV0IHRlbXBWYWx1ZUZpZWxkOkFycmF5PGFueT4gPSB2YWx1ZUZpZWxkLm1hcCgoaXRlbTphbnkpID0+ewogICAgICAgICAgICAgICAgcmV0dXJuIGl0ZW0ubmFtZTsKICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIGl0ZW0uZGF0YSA9IHRoaXMuZ3JvdXBBbmRBZGQodGVtcEdyb3VwRmllbGQsdGVtcFNlcmllc0ZpZWxkLHRlbXBWYWx1ZUZpZWxkLGRhdGEsaXRlbSxncm91cEZpZWxkLGFsbENvZGVMaXN0KTsKICAgICAgICB9ZWxzZXsKICAgICAgICAgICAgLy/ljZXluo/liJcKICAgICAgICAgICAgbGV0IGdyb3VwRmllbGQgPSBpdGVtLmRhdGFTZXRGaWVsZHMuZmlsdGVyKChkYXRhc2V0RmllbGQ6YW55KSA9PnsKICAgICAgICAgICAgICAgIHJldHVybiBkYXRhc2V0RmllbGQubmFtZSA9PT0gaXRlbS5jYXRlZ29yRmllbGQ7CiAgICAgICAgICAgIH0pOwogICAgICAgICAgICBsZXQgdGVtcEdyb3VwRmllbGQ6QXJyYXk8YW55PiA9IGdyb3VwRmllbGQubWFwKChpdGVtOmFueSkgPT57CiAgICAgICAgICAgICAgICByZXR1cm4gaXRlbS5uYW1lOwogICAgICAgICAgICB9KQogICAgICAgICAgICBsZXQgdmFsdWVGaWVsZCA9IGl0ZW0uZGF0YVNldEZpZWxkcy5maWx0ZXIoKGRhdGFzZXRGaWVsZDphbnkpID0+ewogICAgICAgICAgICAgICAgcmV0dXJuIGRhdGFzZXRGaWVsZC5uYW1lID09PSBpdGVtLnZhbHVlRmllbGQ7CiAgICAgICAgICAgIH0pOwogICAgICAgICAgICBsZXQgdGVtcFZhbHVlRmllbGQ6QXJyYXk8YW55PiA9IHZhbHVlRmllbGQubWFwKChpdGVtOmFueSkgPT57CiAgICAgICAgICAgICAgICByZXR1cm4gaXRlbS5uYW1lOwogICAgICAgICAgICB9KQogICAgICAgICAgICBpdGVtLmRhdGEgPSB0aGlzLmdyb3VwQW5kQWRkKHRlbXBHcm91cEZpZWxkLFtdLHRlbXBWYWx1ZUZpZWxkLGRhdGEsaXRlbSxncm91cEZpZWxkLGFsbENvZGVMaXN0KTsKICAgICAgICB9CiAgICAgICAgaWYoY2FsbGJhY2sgJiYgY2FsbGJhY2sgaW5zdGFuY2VvZiBGdW5jdGlvbil7CiAgICAgICAgICAgIGNhbGxiYWNrKGFsbENvZGVMaXN0KTsKICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiDliIbnu4TlkozmsYLlkowgIAogICAgICogQHBhcmFtIHtBcnJheTxhbnk+fSBncm91cEZpZWxkIOWIhue7hOWxnuaApwogICAgICogQHBhcmFtIHtBcnJheTxhbnk+fSBncm91cEZpZWxkIOWAvOWxnuaApwogICAgICogQHBhcmFtIHtBcnJheTxhbnk+fSBkYXRhIOS8oOWFpeaVsOaNrgogICAgICogQHBhcmFtIHsqfSBncm91cEZpZWxkTW9kZWwg5YiG57uE5bGe5oCn5qih5Z6LCiAgICAgKiBAcGFyYW0geyp9IGFsbENvZGVMaXN0IOaJgOacieS7o+eggeihqAogICAgICogCiAgICAgKiBAbWVtYmVyb2YgUG9ydGxldF9PcmdQZXJzb25PcmdUeXBlUGllX2NoYXJ0QmFzZQogICAgICovCiAgICBwdWJsaWMgZ3JvdXBBbmRBZGQoZ3JvdXBGaWVsZDpBcnJheTxhbnk+LHNlcmllc0ZpZWxkOkFycmF5PGFueT4sdmFsdWVGaWVsZDpBcnJheTxhbnk+LGRhdGE6YW55LGl0ZW06YW55LGdyb3VwRmllbGRNb2RlbDphbnksYWxsQ29kZUxpc3Q6YW55KXsKICAgICAgICBsZXQgdGVtcE1hcDpNYXA8c3RyaW5nLGFueT4gPSBuZXcgTWFwKCk7CiAgICAgICAgbGV0IGdyb3VwTW9kZTpzdHJpbmcgPSBncm91cEZpZWxkTW9kZWxbMF0uZ3JvdXBNb2RlOwogICAgICAgIGxldCBncm91cEtleVN0cjpzdHJpbmcgPSAiIjsKICAgICAgICBkYXRhLmZvckVhY2goKGl0ZW06YW55KSA9PnsKICAgICAgICAgICAgbGV0IHRlbXBHcm91cEZpZWxkOnN0cmluZyA9IGdyb3VwRmllbGRbMF07CiAgICAgICAgICAgIGdyb3VwS2V5U3RyID0gaXRlbVt0ZW1wR3JvdXBGaWVsZF07CiAgICAgICAgICAgIGxldCB0ZW1wTWFwSXRlbTphbnkgPSB0ZW1wTWFwLmdldChncm91cEtleVN0cik7CiAgICAgICAgICAgIGlmKHRlbXBNYXBJdGVtKXsKICAgICAgICAgICAgICAgIHRlbXBNYXBJdGVtLnB1c2goaXRlbSk7CiAgICAgICAgICAgICAgICB0ZW1wTWFwLnNldChncm91cEtleVN0cix0ZW1wTWFwSXRlbSk7CiAgICAgICAgICAgIH1lbHNlewogICAgICAgICAgICAgICAgdGVtcE1hcC5zZXQoZ3JvdXBLZXlTdHIsW2l0ZW1dKTsKICAgICAgICAgICAgfQogICAgICAgIH0pCiAgICAgICAgLy8g5aSE55CG5aSa5bqP5YiXCiAgICAgICAgaWYoc2VyaWVzRmllbGQubGVuZ3RoID4gMCAmJiB0ZW1wTWFwLnNpemUgPiAwKXsKICAgICAgICAgICAgbGV0IHRlbXBTZXJpZXNGaWVsZDpzdHJpbmcgPSBzZXJpZXNGaWVsZFswXTsKICAgICAgICAgICAgdGVtcE1hcC5mb3JFYWNoKChpdGVtOmFueSxrZXk6c3RyaW5nKSA9PnsKICAgICAgICAgICAgICAgIGxldCB0ZW1wSXRlbU1hcDpNYXA8c3RyaW5nLGFueT4gPSBuZXcgTWFwKCk7CiAgICAgICAgICAgICAgICBpdGVtLmZvckVhY2goKHNpbmdsZUl0ZW06YW55KT0+ewogICAgICAgICAgICAgICAgICAgIGxldCBzZXJpZXNWYWx1ZUFycmF5OmFueSA9IHRlbXBJdGVtTWFwLmdldChzaW5nbGVJdGVtW3RlbXBTZXJpZXNGaWVsZF0pOwogICAgICAgICAgICAgICAgICAgIGlmKHNlcmllc1ZhbHVlQXJyYXkpewogICAgICAgICAgICAgICAgICAgICAgICBzZXJpZXNWYWx1ZUFycmF5LnB1c2goc2luZ2xlSXRlbSk7CiAgICAgICAgICAgICAgICAgICAgICAgIHRlbXBJdGVtTWFwLnNldChzaW5nbGVJdGVtW3RlbXBTZXJpZXNGaWVsZF0sc2VyaWVzVmFsdWVBcnJheSk7CiAgICAgICAgICAgICAgICAgICAgfWVsc2V7CiAgICAgICAgICAgICAgICAgICAgICAgIHRlbXBJdGVtTWFwLnNldChzaW5nbGVJdGVtW3RlbXBTZXJpZXNGaWVsZF0sW3NpbmdsZUl0ZW1dKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgdGVtcE1hcC5zZXQoa2V5LHRlbXBJdGVtTWFwKTsKICAgICAgICAgICAgfSk7CiAgICAgICAgfQogICAgICAgIGxldCByZXR1cm5BcnJheTpBcnJheTxhbnk+ID0gW107CiAgICAgICAgaWYoc2VyaWVzRmllbGQubGVuZ3RoID09IDApewogICAgICAgICAgICAvL+WNleW6j+WIlwogICAgICAgICAgICB0ZW1wTWFwLmZvckVhY2goKHRlbXBJdGVtOmFueSkgPT57CiAgICAgICAgICAgICAgICBpZih0ZW1wSXRlbS5sZW5ndGggPjApewogICAgICAgICAgICAgICAgICAgIGxldCBjdXJPYmplY3Q6YW55ID0ge307CiAgICAgICAgICAgICAgICAgICAgbGV0IHZhbHVlUmVzdWx0Om51bWJlciA9IDA7CiAgICAgICAgICAgICAgICAgICAgbGV0IGNhdGVnb3JSZXN1bHQ6YW55OwogICAgICAgICAgICAgICAgICAgIHRlbXBJdGVtLmZvckVhY2goKHNpbmdsZUl0ZW06YW55KSA9PnsKICAgICAgICAgICAgICAgICAgICAgICAgY2F0ZWdvclJlc3VsdCA9IHNpbmdsZUl0ZW1bZ3JvdXBGaWVsZFswXV07CiAgICAgICAgICAgICAgICAgICAgICAgIHZhbHVlUmVzdWx0ICs9IHNpbmdsZUl0ZW1bdmFsdWVGaWVsZFswXV07CiAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkoY3VyT2JqZWN0LCBncm91cEZpZWxkWzBdLCB7CiAgICAgICAgICAgICAgICAgICAgICAgIHZhbHVlOiBjYXRlZ29yUmVzdWx0LAogICAgICAgICAgICAgICAgICAgICAgICB3cml0YWJsZSA6IHRydWUsCiAgICAgICAgICAgICAgICAgICAgICAgIGVudW1lcmFibGUgOiB0cnVlLAogICAgICAgICAgICAgICAgICAgICAgICBjb25maWd1cmFibGUgOiB0cnVlCiAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KGN1ck9iamVjdCwgdmFsdWVGaWVsZFswXSwgewogICAgICAgICAgICAgICAgICAgICAgICB2YWx1ZTogdmFsdWVSZXN1bHQsCiAgICAgICAgICAgICAgICAgICAgICAgIHdyaXRhYmxlIDogdHJ1ZSwKICAgICAgICAgICAgICAgICAgICAgICAgZW51bWVyYWJsZSA6IHRydWUsCiAgICAgICAgICAgICAgICAgICAgICAgIGNvbmZpZ3VyYWJsZSA6IHRydWUKICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICByZXR1cm5BcnJheS5wdXNoKGN1ck9iamVjdCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0pCiAgICAgICAgfWVsc2V7CiAgICAgICAgICAgIC8vIOWkmuW6j+WIlwogICAgICAgICAgICBsZXQgc2VyaWVzVmFsdWVzQXJyYXk6QXJyYXk8YW55PiA9IGl0ZW0uc2VyaWVzVmFsdWVzOwogICAgICAgICAgICB0ZW1wTWFwLmZvckVhY2goKGdyb3VwSXRlbTphbnksZ3JvdXBLZXk6c3RyaW5nKSA9PnsKICAgICAgICAgICAgICAgIC8v5rGC5ZKMCiAgICAgICAgICAgICAgICBsZXQgY3VyT2JqZWN0OmFueSA9IHt9OwogICAgICAgICAgICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KGN1ck9iamVjdCwgZ3JvdXBGaWVsZFswXSwgewogICAgICAgICAgICAgICAgICAgIHZhbHVlOiBncm91cEtleSwKICAgICAgICAgICAgICAgICAgICB3cml0YWJsZSA6IHRydWUsCiAgICAgICAgICAgICAgICAgICAgZW51bWVyYWJsZSA6IHRydWUsCiAgICAgICAgICAgICAgICAgICAgY29uZmlndXJhYmxlIDogdHJ1ZQogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICBzZXJpZXNWYWx1ZXNBcnJheS5mb3JFYWNoKChzZXJpZXNWYWx1ZUl0ZW06YW55KSA9PnsKICAgICAgICAgICAgICAgICAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkoY3VyT2JqZWN0LCBzZXJpZXNWYWx1ZUl0ZW0sIHsKICAgICAgICAgICAgICAgICAgICAgICAgdmFsdWU6IDAsCiAgICAgICAgICAgICAgICAgICAgICAgIHdyaXRhYmxlIDogdHJ1ZSwKICAgICAgICAgICAgICAgICAgICAgICAgZW51bWVyYWJsZSA6IHRydWUsCiAgICAgICAgICAgICAgICAgICAgICAgIGNvbmZpZ3VyYWJsZSA6IHRydWUKICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgZ3JvdXBJdGVtLmZvckVhY2goKHNlcmllc0l0ZW06YW55LHNlcmllc0tleTpzdHJpbmcpID0+ewogICAgICAgICAgICAgICAgICAgIGxldCBzZXJpZXNOdW06bnVtYmVyID0gMDsKICAgICAgICAgICAgICAgICAgICBzZXJpZXNJdGVtLmZvckVhY2goKGRhdGFJdGVtOmFueSkgPT57CiAgICAgICAgICAgICAgICAgICAgICAgIHNlcmllc051bSArPSBkYXRhSXRlbVt2YWx1ZUZpZWxkWzBdXTsKICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgICAgIGN1ck9iamVjdFtzZXJpZXNLZXldID0gc2VyaWVzTnVtOyAKICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICByZXR1cm5BcnJheS5wdXNoKGN1ck9iamVjdCk7CiAgICAgICAgICAgIH0pCiAgICAgICAgfQogICAgICAgIC8vIOihpeWFqOepuueZveWIhuexuwogICAgICAgIGlmKHJldHVybkFycmF5Lmxlbmd0aCA+MCl7CiAgICAgICAgICAgIGxldCBlbXB0eVRleHQgPSAoZ3JvdXBGaWVsZE1vZGVsWzBdICYmIGdyb3VwRmllbGRNb2RlbFswXS5jb2RlTGlzdCk/Z3JvdXBGaWVsZE1vZGVsWzBdLmNvZGVMaXN0LmVtcHR5dGV4dDoi5pyq5a6a5LmJIjsKICAgICAgICAgICAgcmV0dXJuQXJyYXkuZm9yRWFjaCgoaXRlbTphbnkpID0+ewogICAgICAgICAgICAgICAgaWYoIWl0ZW1bZ3JvdXBGaWVsZFswXV0pewogICAgICAgICAgICAgICAgICAgIGl0ZW1bZ3JvdXBGaWVsZFswXV0gPSBlbXB0eVRleHQ7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0pCiAgICAgICAgfQogICAgICAgIHJldHVybkFycmF5ID0gdGhpcy5zb3J0UmV0dXJuQXJyYXkocmV0dXJuQXJyYXksZ3JvdXBGaWVsZE1vZGVsLGFsbENvZGVMaXN0KTsKICAgICAgICAvLyDpm7fovr7lm77mlbDmja7moLzlvI/lpITnkIYKICAgICAgICBpZihPYmplY3QuaXMoaXRlbS50eXBlLCdyYWRhcicpICYmIHJldHVybkFycmF5Lmxlbmd0aCA+MCl7CiAgICAgICAgICAgIGxldCB0ZW1wUmV0dXJuQXJyYXk6QXJyYXk8YW55PiA9IFtdOwogICAgICAgICAgICBsZXQgc2VyaWVzVmFsdWVzOkFycmF5PGFueT4gPSBpdGVtLnNlcmllc1ZhbHVlczsKICAgICAgICAgICAgaWYoc2VyaWVzVmFsdWVzICYmIHNlcmllc1ZhbHVlcy5sZW5ndGggPjApewogICAgICAgICAgICAgICAgc2VyaWVzVmFsdWVzLmZvckVhY2goKHNpbmdsZVNlcmllc05hbWU6YW55KSA9PnsKICAgICAgICAgICAgICAgICAgICBsZXQgc2luZ2xlU2VyaWVzT2JqOmFueSA9IHt9OwogICAgICAgICAgICAgICAgICAgIHJldHVybkFycmF5LmZvckVhY2goKGl0ZW06YW55KSA9PnsKICAgICAgICAgICAgICAgICAgICAgICAgT2JqZWN0LmFzc2lnbihzaW5nbGVTZXJpZXNPYmose1tpdGVtW2dyb3VwRmllbGRbMF1dXTppdGVtW3NpbmdsZVNlcmllc05hbWVdfSk7CiAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICAgICBPYmplY3QuYXNzaWduKHNpbmdsZVNlcmllc09iaix7dHlwZTpzaW5nbGVTZXJpZXNOYW1lfSk7CiAgICAgICAgICAgICAgICAgICAgdGVtcFJldHVybkFycmF5LnB1c2goc2luZ2xlU2VyaWVzT2JqKTsKICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuQXJyYXkgPSB0ZW1wUmV0dXJuQXJyYXk7CiAgICAgICAgfQogICAgICAgIGNvbnNvbGUubG9nKEpTT04uc3RyaW5naWZ5KHJldHVybkFycmF5KSk7CiAgICAgICAgcmV0dXJuIHJldHVybkFycmF5OwogICAgfQoKICAgIC8qKgogICAgICog5o6S5bqP5pWw57uECiAgICAgKiAKICAgICAqIEBwYXJhbSB7QXJyYXk8YW55Pn0gYXJyIOS8oOWFpeaVsOe7hAogICAgICogQHBhcmFtIHsqfSBncm91cEZpZWxkIOWIhue7hOWxnuaApwogICAgICogQHBhcmFtIHsqfSBhbGxDb2RlTGlzdCDmiYDmnInku6PnoIHooagKICAgICAqIAogICAgICogQG1lbWJlcm9mIFBvcnRsZXRfT3JnUGVyc29uT3JnVHlwZVBpZV9jaGFydEJhc2UKICAgICAqLwogICAgcHVibGljIHNvcnRSZXR1cm5BcnJheShhcnI6QXJyYXk8YW55Pixncm91cEZpZWxkOmFueSxhbGxDb2RlTGlzdDphbnkpewogICAgICAgIGxldCByZXR1cm5BcnJheTpBcnJheTxhbnk+ID0gW107CiAgICAgICAgLy8gdG9kbwogICAgICAgIC8vIOWIhue7hOWxnuaAp+acieS7o+eggeihqOeahOaDheWGtSjmnIDlkI7miafooYwpCiAgICAgICAgaWYoZ3JvdXBGaWVsZFswXS5jb2RlbGlzdCl7CiAgICAgICAgICAgIGxldCBjdXJDb2RlTGlzdDpNYXA8bnVtYmVyLGFueT4gPSBhbGxDb2RlTGlzdC5nZXQoZ3JvdXBGaWVsZFswXS5jb2RlbGlzdC50YWcpOwogICAgICAgICAgICBjdXJDb2RlTGlzdC5mb3JFYWNoKChjb2RlbGlzdDphbnkpID0+ewogICAgICAgICAgICAgICAgYXJyLmZvckVhY2goKGl0ZW06YW55KSA9PnsKICAgICAgICAgICAgICAgICAgICBpZihPYmplY3QuaXMoaXRlbVtncm91cEZpZWxkWzBdLm5hbWVdLGNvZGVsaXN0KSl7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybkFycmF5LnB1c2goaXRlbSk7CiAgICAgICAgICAgICAgICAgICAgICAgIGl0ZW0uaGFzdXNlZCA9IHRydWU7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgfSkKICAgICAgICAgICAgYXJyLmZvckVhY2goKGl0ZW06YW55LGluZGV4Om51bWJlcikgPT57CiAgICAgICAgICAgICAgICBpZighaXRlbS5oYXN1c2VkKXsKICAgICAgICAgICAgICAgICAgICByZXR1cm5BcnJheS5wdXNoKGl0ZW0pOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9KQogICAgICAgICAgICByZXR1cm5BcnJheS5mb3JFYWNoKChpdGVtOmFueSkgPT57CiAgICAgICAgICAgICAgICBkZWxldGUgaXRlbS5oYXN1c2VkOwogICAgICAgICAgICB9KQogICAgICAgIH1lbHNlewogICAgICAgICAgICAvLyDliIbnu4TkuLrlubTku70KICAgICAgICAgICAgaWYoT2JqZWN0LmlzKGdyb3VwRmllbGRbMF0uZ3JvdXBNb2RlLCJZRUFSIikpewogICAgICAgICAgICAgICAgcmV0dXJuQXJyYXkgPSBhcnIuc29ydCgoYTphbnksIGI6YW55KSA9PiB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIE51bWJlcihhW2dyb3VwRmllbGRbMF0ubmFtZV0pIC0gTnVtYmVyKGJbZ3JvdXBGaWVsZFswXS5uYW1lXSk7CiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfWVsc2UgaWYoT2JqZWN0LmlzKGdyb3VwRmllbGRbMF0uZ3JvdXBNb2RlLCJRVUFSVEVSIikpewogICAgICAgICAgICAgICAgcmV0dXJuQXJyYXkgPSB0aGlzLmhhbmRsZVNvcnRHcm91cERhdGEoYXJyLGdyb3VwRmllbGQsIuWto+W6piIpOwogICAgICAgICAgICB9ZWxzZSBpZihPYmplY3QuaXMoZ3JvdXBGaWVsZFswXS5ncm91cE1vZGUsIk1PTlRIIikpewogICAgICAgICAgICAgICAgcmV0dXJuQXJyYXkgPSB0aGlzLmhhbmRsZVNvcnRHcm91cERhdGEoYXJyLGdyb3VwRmllbGQsIuaciCIpOwogICAgICAgICAgICB9ZWxzZSBpZihPYmplY3QuaXMoZ3JvdXBGaWVsZFswXS5ncm91cE1vZGUsIllFQVJXRUVLIikpewogICAgICAgICAgICAgICAgcmV0dXJuQXJyYXkgPSB0aGlzLmhhbmRsZVNvcnRHcm91cERhdGEoYXJyLGdyb3VwRmllbGQsIuWRqCIpOwogICAgICAgICAgICB9ZWxzZSBpZihPYmplY3QuaXMoZ3JvdXBGaWVsZFswXS5ncm91cE1vZGUsIkRBWSIpKXsKICAgICAgICAgICAgICAgIHJldHVybkFycmF5ID0gYXJyLnNvcnQoKGE6YW55LCBiOmFueSkgPT4gewogICAgICAgICAgICAgICAgICAgIHJldHVybiBtb21lbnQoYVtncm91cEZpZWxkWzBdLm5hbWVdKS51bml4KCkgLSBtb21lbnQoYltncm91cEZpZWxkWzBdLm5hbWVdKS51bml4KCk7CiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfWVsc2V7CiAgICAgICAgICAgICAgICBsZXQgZ3JvdXBGaWVsZE5hbWU6c3RyaW5nID0gZ3JvdXBGaWVsZFswXS5uYW1lOwogICAgICAgICAgICAgICAgbGV0IGlzQ29udmVydDpib29sZWFuID0gdHJ1ZTsKICAgICAgICAgICAgICAgIGFyci5mb3JFYWNoKChpdGVtOmFueSkgPT57CiAgICAgICAgICAgICAgICAgICAgaWYoaXNOYU4oaXRlbVtncm91cEZpZWxkTmFtZV0pKXsKICAgICAgICAgICAgICAgICAgICAgICAgaXNDb252ZXJ0ID0gZmFsc2U7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgIGlmKGlzQ29udmVydCl7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuQXJyYXkgPSBhcnIuc29ydCgoYTphbnksIGI6YW55KSA9PiB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBhW2dyb3VwRmllbGROYW1lXSAtIGJbZ3JvdXBGaWVsZE5hbWVdOwogICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgfWVsc2V7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuQXJyYXkgPSBhcnI7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgcmV0dXJuIHJldHVybkFycmF5OwogICAgfQoKICAgIC8qKgogICAgICog5o6S5bqP5YiG57uE5qih5byP5LiL55qE5pWw5o2uCiAgICAgKiAKICAgICAqIEBwYXJhbSB7QXJyYXk8YW55Pn0gYXJyIOS8oOWFpeaVsOaNrgogICAgICogQHBhcmFtIHtBcnJheTxhbnk+fSBncm91cEZpZWxkIOWIhue7hOWxnuaApwogICAgICogQHBhcmFtIHtBcnJheTxhbnk+fSBsYWJlbCBsYWJlbOagh+etvgogICAgICogCiAgICAgKiBAbWVtYmVyb2YgUG9ydGxldF9PcmdQZXJzb25PcmdUeXBlUGllX2NoYXJ0QmFzZQogICAgICovCiAgICBwdWJsaWMgaGFuZGxlU29ydEdyb3VwRGF0YShhcnI6QXJyYXk8YW55Pixncm91cEZpZWxkOmFueSxsYWJlbDpzdHJpbmcpewogICAgICAgIGFyci5mb3JFYWNoKChpdGVtOmFueSkgPT57CiAgICAgICAgICAgIGxldCBzb3J0RmllbGRWYWx1ZTpBcnJheTxhbnk+ID0gaXRlbVtncm91cEZpZWxkWzBdLm5hbWVdLnNwbGl0KCItIik7CiAgICAgICAgICAgIE9iamVjdC5hc3NpZ24oaXRlbSx7c29ydEZpZWxkOk51bWJlcihzb3J0RmllbGRWYWx1ZVswXSkqMTAwMDArTnVtYmVyKHNvcnRGaWVsZFZhbHVlWzFdKX0pOwogICAgICAgICAgICBpdGVtW2dyb3VwRmllbGRbMF0ubmFtZV0gPSBzb3J0RmllbGRWYWx1ZVswXSsi5bm0Iitzb3J0RmllbGRWYWx1ZVsxXStsYWJlbDsKICAgICAgICB9KQogICAgICAgIGFyci5zb3J0KChhOmFueSwgYjphbnkpID0+IHsKICAgICAgICAgICAgcmV0dXJuIE51bWJlcihhLnNvcnRGaWVsZCkgLSBOdW1iZXIoYi5zb3J0RmllbGQpOwogICAgICAgIH0pOwogICAgICAgIGFyci5mb3JFYWNoKChpdGVtOmFueSkgPT57CiAgICAgICAgICAgIGRlbGV0ZSBpdGVtLnNvcnRGaWVsZDsKICAgICAgICB9KQogICAgICAgIHJldHVybiBhcnI7CiAgICB9CgogICAgLyoqCiAgICAgKiDooaXlhajmlbDmja7pm4YKICAgICAqIAogICAgICogQHBhcmFtIHtBcnJheTxhbnk+fSBkYXRhIOS8oOWFpeaVsOaNrgogICAgICogQHBhcmFtIHtBcnJheTxhbnk+fSBpdGVtIOWNleS4quW6j+WIlwogICAgICogQHBhcmFtIHtBcnJheTxhbnk+fSBhbGxDb2RlTGlzdCDmiYDmnInnmoTku6PnoIHooagKICAgICAqIAogICAgICogQG1lbWJlcm9mIFBvcnRsZXRfT3JnUGVyc29uT3JnVHlwZVBpZV9jaGFydEJhc2UKICAgICAqLwogICAgcHVibGljIGNvbXBsZXRlRGF0YVNldChkYXRhOmFueSxpdGVtOmFueSxhbGxDb2RlTGlzdDphbnkpewogICAgICAgIC8vIOWIhue7hOWxnuaApwogICAgICAgIGxldCBncm91cEZpZWxkID0gaXRlbS5kYXRhU2V0RmllbGRzLmZpbmQoKGRhdGFzZXRGaWVsZDphbnkpID0+ewogICAgICAgICAgICByZXR1cm4gZGF0YXNldEZpZWxkLm5hbWUgPT09IGl0ZW0uY2F0ZWdvckZpZWxkOwogICAgICAgIH0pOwogICAgICAgIGlmKE9iamVjdC5pcyhncm91cEZpZWxkLmdyb3VwTW9kZSwiIikpewogICAgICAgICAgICByZXR1cm47CiAgICAgICAgfQogICAgICAgIC8v5YiG57uE5qih5byP5Li65Luj56CB6KGo77yI6KGl5YC877yJCiAgICAgICAgaWYoT2JqZWN0LmlzKGdyb3VwRmllbGQuZ3JvdXBNb2RlLCdDT0RFTElTVCcpKXsKICAgICAgICAgICAgdGhpcy5jb21wbGV0ZUNvZGVMaXN0KGRhdGEsaXRlbSxhbGxDb2RlTGlzdCk7CiAgICAgICAgfQogICAgICAgIC8v5YiG57uE5qih5byP5Li65bm0L+Wto+W6pi/mnIjku73vvIjmnIDlpKflgLzvvIzmnIDlsI/lgLzvvIzliIbnu4TvvIzooaXlgLzvvIkKICAgICAgICBpZihPYmplY3QuaXMoZ3JvdXBGaWVsZC5ncm91cE1vZGUsIllFQVIiKSB8fCBPYmplY3QuaXMoZ3JvdXBGaWVsZC5ncm91cE1vZGUsIlFVQVJURVIiKSB8fCBPYmplY3QuaXMoZ3JvdXBGaWVsZC5ncm91cE1vZGUsIk1PTlRIIikgfHwgT2JqZWN0LmlzKGdyb3VwRmllbGQuZ3JvdXBNb2RlLCJZRUFSV0VFSyIpICB8fCBPYmplY3QuaXMoZ3JvdXBGaWVsZC5ncm91cE1vZGUsIkRBWSIpKXsKICAgICAgICAgICAgdGhpcy5oYW5kbGVUaW1lRGF0YShkYXRhLGl0ZW0sYWxsQ29kZUxpc3QsZ3JvdXBGaWVsZCk7CiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICog6I635Y+W5pyA5aSn5YC85pyA5bCP5YC8CiAgICAgKiAKICAgICAqIEBwYXJhbSB7QXJyYXk8YW55Pn0gdGVtcFRpbWVBcnJheSDkvKDlhaXmlbDmja4KICAgICAqIAogICAgICogQG1lbWJlcm9mIFBvcnRsZXRfT3JnUGVyc29uT3JnVHlwZVBpZV9jaGFydEJhc2UKICAgICAqLwogICAgcHVibGljICBnZXRSYW5nZURhdGEodGVtcFRpbWVBcnJheTpBcnJheTxhbnk+KXsKICAgICAgICB0ZW1wVGltZUFycmF5LmZvckVhY2goKGl0ZW06YW55KSA9PnsKICAgICAgICAgICAgbGV0IHRlbXBQYXJhbXM6QXJyYXk8YW55PiA9IGl0ZW0uX2kuc3BsaXQoIi0iKTsKICAgICAgICAgICAgaXRlbS5zb3J0RmllbGQgPSBOdW1iZXIodGVtcFBhcmFtc1swXSArIHRlbXBQYXJhbXNbMV0pOwogICAgICAgIH0pCiAgICAgICAgdGVtcFRpbWVBcnJheS5zb3J0KChhOmFueSwgYjphbnkpID0+IHsKICAgICAgICAgICAgcmV0dXJuIE51bWJlcihhLnNvcnRGaWVsZCkgLSBOdW1iZXIoYi5zb3J0RmllbGQpOwogICAgICAgIH0pOwogICAgICAgIHRlbXBUaW1lQXJyYXkuZm9yRWFjaCgoaXRlbTphbnkpID0+ewogICAgICAgICAgICBkZWxldGUgaXRlbS5zb3J0RmllbGQ7CiAgICAgICAgfSkKICAgICAgICByZXR1cm4gdGVtcFRpbWVBcnJheTsKICAgIH0KCiAgIC8qKgogICAgICog6KGl5YWo5pe26Ze057G75Z6L5pWw5o2u6ZuGCiAgICAgKiAKICAgICAqIEBwYXJhbSB7QXJyYXk8YW55Pn0gZGF0YSDkvKDlhaXmlbDmja4KICAgICAqIEBwYXJhbSB7QXJyYXk8YW55Pn0gaXRlbSDljZXkuKrluo/liJcKICAgICAqIEBwYXJhbSB7QXJyYXk8YW55Pn0gYWxsQ29kZUxpc3Qg5omA5pyJ55qE5Luj56CB6KGoCiAgICAgKiBAcGFyYW0ge0FycmF5PGFueT59IGdyb3VwRmllbGQg5YiG57uE5bGe5oCnCiAgICAgKiAKICAgICAqIEBtZW1iZXJvZiBQb3J0bGV0X09yZ1BlcnNvbk9yZ1R5cGVQaWVfY2hhcnRCYXNlCiAgICAgKi8KICAgIHB1YmxpYyBoYW5kbGVUaW1lRGF0YShkYXRhOmFueSxpdGVtOmFueSxhbGxDb2RlTGlzdDphbnksZ3JvdXBGaWVsZDphbnkpewogICAgICAgIGxldCB2YWx1ZUZpZWxkID0gaXRlbS5kYXRhU2V0RmllbGRzLmZpbmQoKGRhdGFzZXRGaWVsZDphbnkpID0+ewogICAgICAgICAgICByZXR1cm4gZGF0YXNldEZpZWxkLm5hbWUgPT09IGl0ZW0udmFsdWVGaWVsZDsKICAgICAgICB9KTsKICAgICAgICBsZXQgZ3JvdXBNb2RlOnN0cmluZyA9IGdyb3VwRmllbGQuZ3JvdXBNb2RlOwogICAgICAgIC8vIOaOkuW6j+aVsOaNru+8jOaJvuWIsOacgOWkp+WAvOOAgeacgOWwj+WAvAogICAgICAgIGxldCB0ZW1wVGltZUFycmF5OkFycmF5PGFueT4gPSBbXTsKICAgICAgICBpZihkYXRhICYmIGRhdGEubGVuZ3RoID4wKXsKICAgICAgICAgICAgZGF0YS5mb3JFYWNoKChkYXRhSXRlbTphbnkpID0+ewogICAgICAgICAgICAgICAgLy8g5Yik5pat5pe26Ze057G75Z6L5piv5ZCm5Li656m677yM5Li656m65LiN5aSE55CGCiAgICAgICAgICAgICAgICBpZihkYXRhSXRlbVtncm91cEZpZWxkLm5hbWVdKXsKICAgICAgICAgICAgICAgICAgICB0ZW1wVGltZUFycmF5LnB1c2gobW9tZW50KGRhdGFJdGVtW2dyb3VwRmllbGQubmFtZV0pKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSkKICAgICAgICB9CiAgICAgICAgbGV0IG1heFRpbWU6YW55OwogICAgICAgIGxldCBtaW5UaW1lOmFueTsKICAgICAgICBpZihPYmplY3QuaXMoZ3JvdXBNb2RlLCJZRUFSIikgfHwgT2JqZWN0LmlzKGdyb3VwTW9kZSwiREFZIikpewogICAgICAgICAgICBtYXhUaW1lID0gbW9tZW50Lm1heCh0ZW1wVGltZUFycmF5KTsKICAgICAgICAgICAgbWluVGltZSA9IG1vbWVudC5taW4odGVtcFRpbWVBcnJheSk7CiAgICAgICAgfQogICAgICAgIGlmKE9iamVjdC5pcyhncm91cE1vZGUsIlFVQVJURVIiKSl7CiAgICAgICAgICAgIHRlbXBUaW1lQXJyYXkgPSB0aGlzLmdldFJhbmdlRGF0YSh0ZW1wVGltZUFycmF5KTsKICAgICAgICAgICAgbWluVGltZSA9IG1vbWVudCgpLnllYXIoKHRlbXBUaW1lQXJyYXlbMF0uX2kuc3BsaXQoIi0iKSlbMF0pLnF1YXJ0ZXJzKCh0ZW1wVGltZUFycmF5WzBdLl9pLnNwbGl0KCItIikpWzFdKTsKICAgICAgICAgICAgbWF4VGltZSA9IG1vbWVudCgpLnllYXIoKHRlbXBUaW1lQXJyYXlbdGVtcFRpbWVBcnJheS5sZW5ndGggLSAxXS5faS5zcGxpdCgiLSIpKVswXSkucXVhcnRlcnMoKHRlbXBUaW1lQXJyYXlbdGVtcFRpbWVBcnJheS5sZW5ndGggLSAxXS5faS5zcGxpdCgiLSIpKVsxXSk7CiAgICAgICAgfQogICAgICAgIGlmKE9iamVjdC5pcyhncm91cE1vZGUsIk1PTlRIIikpewogICAgICAgICAgICB0ZW1wVGltZUFycmF5ID0gdGhpcy5nZXRSYW5nZURhdGEodGVtcFRpbWVBcnJheSk7CiAgICAgICAgICAgIG1pblRpbWUgPSBtb21lbnQoKS55ZWFyKCh0ZW1wVGltZUFycmF5WzBdLl9pLnNwbGl0KCItIikpWzBdKS5tb250aCgodGVtcFRpbWVBcnJheVswXS5faS5zcGxpdCgiLSIpKVsxXSk7CiAgICAgICAgICAgIG1heFRpbWUgPSBtb21lbnQoKS55ZWFyKCh0ZW1wVGltZUFycmF5W3RlbXBUaW1lQXJyYXkubGVuZ3RoIC0gMV0uX2kuc3BsaXQoIi0iKSlbMF0pLm1vbnRoKCh0ZW1wVGltZUFycmF5W3RlbXBUaW1lQXJyYXkubGVuZ3RoIC0gMV0uX2kuc3BsaXQoIi0iKSlbMV0pOwogICAgICAgIH0KICAgICAgICBpZihPYmplY3QuaXMoZ3JvdXBNb2RlLCJZRUFSV0VFSyIpKXsKICAgICAgICAgICAgdGVtcFRpbWVBcnJheSA9IHRoaXMuZ2V0UmFuZ2VEYXRhKHRlbXBUaW1lQXJyYXkpOwogICAgICAgICAgICBtaW5UaW1lID0gbW9tZW50KCkueWVhcigodGVtcFRpbWVBcnJheVswXS5faS5zcGxpdCgiLSIpKVswXSkud2VlaygodGVtcFRpbWVBcnJheVswXS5faS5zcGxpdCgiLSIpKVsxXSk7CiAgICAgICAgICAgIG1heFRpbWUgPSBtb21lbnQoKS55ZWFyKCh0ZW1wVGltZUFycmF5W3RlbXBUaW1lQXJyYXkubGVuZ3RoIC0gMV0uX2kuc3BsaXQoIi0iKSlbMF0pLndlZWsoKHRlbXBUaW1lQXJyYXlbdGVtcFRpbWVBcnJheS5sZW5ndGggLSAxXS5faS5zcGxpdCgiLSIpKVsxXSk7CiAgICAgICAgfQogICAgICAgIGxldCB0aW1lRnJhZ21lbnRBcnJheTpBcnJheTxhbnk+ID0gW107CiAgICAgICAgbGV0IHRlbXBHcm91bnBEYXRhOk1hcDxzdHJpbmcsYW55PiA9IG5ldyBNYXAoKTsKICAgICAgICAvLyDml7bpl7TliIbmrrUKICAgICAgICAvL2dyb3VwTW9kZeS4uiJZRUFSIgogICAgICAgIGlmKE9iamVjdC5pcyhncm91cE1vZGUsIllFQVIiKSl7CiAgICAgICAgICAgIGxldCBjdXJUaW1lOmFueSA9IG1pblRpbWU7CiAgICAgICAgICAgIHdoaWxlKGN1clRpbWUpewogICAgICAgICAgICAgICAgaWYoY3VyVGltZS5pc1NhbWVPckJlZm9yZShtYXhUaW1lKSl7CiAgICAgICAgICAgICAgICAgICAgbGV0IHRlbXBjdXJUaW1lOmFueSA9IGN1clRpbWUuY2xvbmUoKTsKICAgICAgICAgICAgICAgICAgICB0aW1lRnJhZ21lbnRBcnJheS5wdXNoKHRlbXBjdXJUaW1lLnllYXIoKS50b1N0cmluZygpKTsKICAgICAgICAgICAgICAgICAgICBjdXJUaW1lID0gdGVtcGN1clRpbWUuY2xvbmUoKS5hZGQoMSwgJ3llYXJzJyk7CiAgICAgICAgICAgICAgICB9ZWxzZXsKICAgICAgICAgICAgICAgICAgICBjdXJUaW1lID0gbnVsbDsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICAvL2dyb3VwTW9kZeS4uiJRVUFSVEVSIgogICAgICAgIGlmKE9iamVjdC5pcyhncm91cE1vZGUsIlFVQVJURVIiKSl7CiAgICAgICAgICAgIGxldCBjdXJUaW1lOmFueSA9IG1pblRpbWU7CiAgICAgICAgICAgIHdoaWxlKGN1clRpbWUpewogICAgICAgICAgICAgICAgaWYoY3VyVGltZS5pc1NhbWVPckJlZm9yZShtYXhUaW1lKSl7CiAgICAgICAgICAgICAgICAgICAgbGV0IHRlbXBjdXJUaW1lOmFueSA9IGN1clRpbWUuY2xvbmUoKTsKICAgICAgICAgICAgICAgICAgICB0aW1lRnJhZ21lbnRBcnJheS5wdXNoKHRlbXBjdXJUaW1lLnllYXIoKS50b1N0cmluZygpKyItIit0ZW1wY3VyVGltZS5xdWFydGVyKCkudG9TdHJpbmcoKSk7CiAgICAgICAgICAgICAgICAgICAgY3VyVGltZSA9IHRlbXBjdXJUaW1lLmNsb25lKCkuYWRkKDEsICdxdWFydGVycycpOwogICAgICAgICAgICAgICAgfWVsc2V7CiAgICAgICAgICAgICAgICAgICAgY3VyVGltZSA9IG51bGw7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgLy9ncm91cE1vZGXkuLoiTU9OVEgiCiAgICAgICAgaWYoT2JqZWN0LmlzKGdyb3VwTW9kZSwiTU9OVEgiKSl7CiAgICAgICAgICAgIGxldCBjdXJUaW1lOmFueSA9IG1pblRpbWU7CiAgICAgICAgICAgIHdoaWxlKGN1clRpbWUpewogICAgICAgICAgICAgICAgaWYoY3VyVGltZS5pc1NhbWVPckJlZm9yZShtYXhUaW1lKSl7CiAgICAgICAgICAgICAgICAgICAgbGV0IHRlbXBjdXJUaW1lOmFueSA9IGN1clRpbWUuY2xvbmUoKTsKICAgICAgICAgICAgICAgICAgICB0aW1lRnJhZ21lbnRBcnJheS5wdXNoKHRlbXBjdXJUaW1lLnllYXIoKS50b1N0cmluZygpKyItIit0ZW1wY3VyVGltZS5tb250aCgpLnRvU3RyaW5nKCkpOwogICAgICAgICAgICAgICAgICAgIGN1clRpbWUgPSB0ZW1wY3VyVGltZS5jbG9uZSgpLmFkZCgxLCAnbW9udGhzJyk7CiAgICAgICAgICAgICAgICB9ZWxzZXsKICAgICAgICAgICAgICAgICAgICBjdXJUaW1lID0gbnVsbDsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICAvL2dyb3VwTW9kZeS4uiJZRUFSV0VFSyIKICAgICAgICBpZihPYmplY3QuaXMoZ3JvdXBNb2RlLCJZRUFSV0VFSyIpKXsKICAgICAgICAgICAgbGV0IGN1clRpbWU6YW55ID0gbWluVGltZTsKICAgICAgICAgICAgd2hpbGUoY3VyVGltZSl7CiAgICAgICAgICAgICAgICBpZihjdXJUaW1lLmlzU2FtZU9yQmVmb3JlKG1heFRpbWUpKXsKICAgICAgICAgICAgICAgICAgICBsZXQgdGVtcGN1clRpbWU6YW55ID0gY3VyVGltZS5jbG9uZSgpOwogICAgICAgICAgICAgICAgICAgIHRpbWVGcmFnbWVudEFycmF5LnB1c2godGVtcGN1clRpbWUueWVhcigpLnRvU3RyaW5nKCkrIi0iK3RlbXBjdXJUaW1lLndlZWsoKS50b1N0cmluZygpKTsKICAgICAgICAgICAgICAgICAgICBjdXJUaW1lID0gdGVtcGN1clRpbWUuY2xvbmUoKS5hZGQoMSwgJ3dlZWtzJyk7CiAgICAgICAgICAgICAgICB9ZWxzZXsKICAgICAgICAgICAgICAgICAgICBjdXJUaW1lID0gbnVsbDsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICAvL2dyb3VwTW9kZeS4uiJEQVkiCiAgICAgICAgaWYoT2JqZWN0LmlzKGdyb3VwTW9kZSwiREFZIikpewogICAgICAgICAgICBsZXQgY3VyVGltZTphbnkgPSBtaW5UaW1lOwogICAgICAgICAgICB3aGlsZShjdXJUaW1lKXsKICAgICAgICAgICAgICAgIGlmKGN1clRpbWUuaXNTYW1lT3JCZWZvcmUobWF4VGltZSkpewogICAgICAgICAgICAgICAgICAgIGxldCB0ZW1wY3VyVGltZTphbnkgPSBjdXJUaW1lLmNsb25lKCk7CiAgICAgICAgICAgICAgICAgICAgdGltZUZyYWdtZW50QXJyYXkucHVzaCh0ZW1wY3VyVGltZS5mb3JtYXQoJ1lZWVktTU0tREQnKSk7CiAgICAgICAgICAgICAgICAgICAgY3VyVGltZSA9IHRlbXBjdXJUaW1lLmNsb25lKCkuYWRkKDEsICdkYXlzJyk7CiAgICAgICAgICAgICAgICB9ZWxzZXsKICAgICAgICAgICAgICAgICAgICBjdXJUaW1lID0gbnVsbDsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBkYXRhLmZvckVhY2goKGl0ZW06YW55KSA9PnsKICAgICAgICAgICAgbGV0IHRlbXBLZXlTdHI6c3RyaW5nID0gaXRlbVtncm91cEZpZWxkLm5hbWVdOwogICAgICAgICAgICBsZXQgdGVtcEdyb3VucEl0ZW06YW55ID0gdGVtcEdyb3VucERhdGEuZ2V0KHRlbXBLZXlTdHIpOwogICAgICAgICAgICBpZighdGVtcEdyb3VucEl0ZW0pewogICAgICAgICAgICAgICAgdGVtcEdyb3VucERhdGEuc2V0KHRlbXBLZXlTdHIsaXRlbSk7CiAgICAgICAgICAgIH0KICAgICAgICB9KQogICAgICAgIHRpbWVGcmFnbWVudEFycmF5LmZvckVhY2goKHRpbWVGcmFnbWVudDphbnkpID0+ewogICAgICAgICAgICBpZighdGVtcEdyb3VucERhdGEuZ2V0KHRpbWVGcmFnbWVudCkpewogICAgICAgICAgICAgICAgbGV0IGNvcHlUZW1wOmFueSA9IEpTT04ucGFyc2UoSlNPTi5zdHJpbmdpZnkoZGF0YVswXSkpOwogICAgICAgICAgICAgICAgbGV0IGN1ck9iajphbnkgPSB7fTsKICAgICAgICAgICAgICAgIGN1ck9ialtncm91cEZpZWxkLm5hbWVdID0gdGltZUZyYWdtZW50OwogICAgICAgICAgICAgICAgY3VyT2JqW3ZhbHVlRmllbGQubmFtZV0gPSAwOwogICAgICAgICAgICAgICAgT2JqZWN0LmFzc2lnbihjb3B5VGVtcCxjdXJPYmopOwogICAgICAgICAgICAgICAgZGF0YS5wdXNoKGNvcHlUZW1wKTsKICAgICAgICAgICAgfQogICAgICAgIH0pCiAgICB9CgogICAgLyoqCiAgICAgKiDooaXlhajku6PnoIHooagKICAgICAqIAogICAgICogQHBhcmFtIHtBcnJheTxhbnk+fSBkYXRhIOS8oOWFpeaVsOaNrgogICAgICogQHBhcmFtIHtBcnJheTxhbnk+fSBpdGVtIOWNleS4quW6j+WIlwogICAgICogQHBhcmFtIHtBcnJheTxhbnk+fSBhbGxDb2RlTGlzdCDmiYDmnInnmoTku6PnoIHooagKICAgICAqIAogICAgICogQG1lbWJlcm9mIFBvcnRsZXRfT3JnUGVyc29uT3JnVHlwZVBpZV9jaGFydEJhc2UKICAgICAqLwogICAgcHVibGljICBjb21wbGV0ZUNvZGVMaXN0KGRhdGE6YW55LGl0ZW06YW55LGFsbENvZGVMaXN0OmFueSl7CiAgICAgICAgbGV0IGdyb3VwRmllbGQgPSBpdGVtLmRhdGFTZXRGaWVsZHMuZmluZCgoZGF0YXNldEZpZWxkOmFueSkgPT57CiAgICAgICAgICAgIHJldHVybiBkYXRhc2V0RmllbGQubmFtZSA9PT0gaXRlbS5jYXRlZ29yRmllbGQ7CiAgICAgICAgfSk7CiAgICAgICAgaWYoIWdyb3VwRmllbGQuY29kZWxpc3QpewogICAgICAgICAgICByZXR1cm47CiAgICAgICAgfQogICAgICAgIGxldCB2YWx1ZUZpZWxkID0gaXRlbS5kYXRhU2V0RmllbGRzLmZpbmQoKGRhdGFzZXRGaWVsZDphbnkpID0+ewogICAgICAgICAgICByZXR1cm4gZGF0YXNldEZpZWxkLm5hbWUgPT09IGl0ZW0udmFsdWVGaWVsZDsKICAgICAgICB9KTsKICAgICAgICBsZXQgY3VyQ29kZUxpc3Q6TWFwPG51bWJlcixhbnk+ID0gYWxsQ29kZUxpc3QuZ2V0KGdyb3VwRmllbGQuY29kZWxpc3QudGFnKTsKICAgICAgICAvLyDlr7nliIbnsbvlrp7njrDliIbnu4QKICAgICAgICBsZXQgdGVtcEdyb3VucERhdGE6TWFwPHN0cmluZyxhbnk+ID0gbmV3IE1hcCgpOwogICAgICAgIGRhdGEuZm9yRWFjaCgoaXRlbTphbnkpID0+ewogICAgICAgICAgICBsZXQgdGVtcEdyb3VucEl0ZW06YW55ID0gdGVtcEdyb3VucERhdGEuZ2V0KGl0ZW1bZ3JvdXBGaWVsZC5uYW1lKydfc3JmdmFsdWUnXSk7CiAgICAgICAgICAgIGlmKCF0ZW1wR3JvdW5wSXRlbSl7CiAgICAgICAgICAgICAgICB0ZW1wR3JvdW5wRGF0YS5zZXQoaXRlbVtncm91cEZpZWxkLm5hbWUrJ19zcmZ2YWx1ZSddLGl0ZW0pOwogICAgICAgICAgICB9CiAgICAgICAgfSkKICAgICAgICBpZihjdXJDb2RlTGlzdC5zaXplICE9PSB0ZW1wR3JvdW5wRGF0YS5zaXplKXsKICAgICAgICAgICAgY3VyQ29kZUxpc3QuZm9yRWFjaCgodGV4dDphbnksdmFsdWU6YW55KSA9PnsKICAgICAgICAgICAgICAgIGlmKCF0ZW1wR3JvdW5wRGF0YS5nZXQodmFsdWUpKXsKICAgICAgICAgICAgICAgICAgICBsZXQgY29weVRlbXA6YW55ID0gSlNPTi5wYXJzZShKU09OLnN0cmluZ2lmeShkYXRhWzBdKSk7CiAgICAgICAgICAgICAgICAgICAgbGV0IGN1ck9iajphbnkgPSB7fTsKICAgICAgICAgICAgICAgICAgICBjdXJPYmpbZ3JvdXBGaWVsZC5uYW1lKydfc3JmdmFsdWUnXSA9IHZhbHVlOwogICAgICAgICAgICAgICAgICAgIGN1ck9ialtncm91cEZpZWxkLm5hbWVdID0gdGV4dDsKICAgICAgICAgICAgICAgICAgICBjdXJPYmpbdmFsdWVGaWVsZC5uYW1lXSA9IDA7CiAgICAgICAgICAgICAgICAgICAgT2JqZWN0LmFzc2lnbihjb3B5VGVtcCxjdXJPYmopOwogICAgICAgICAgICAgICAgICAgIGRhdGEucHVzaChjb3B5VGVtcCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0pCiAgICAgICAgfSAgCiAgICB9CgogICAgLyoqCiAgICAgKiDlpITnkIbljZXkuKrlsZ7mgKcKICAgICAqIAogICAgICogQHBhcmFtIHsqfSBpbnB1dCDovpPlhaXlgLwKICAgICAqIEBwYXJhbSB7Kn0gZmllbGQg5bGe5oCn5YC8CiAgICAgKiBAcGFyYW0geyp9IGFsbENvZGVMaXN0IOaJgOacieS7o+eggeihqAogICAgICogQHBhcmFtIHsqfSByZXN1bHQg57uT5p6c5YC8CiAgICAgKiAKICAgICAqIEBtZW1iZXJvZiBQb3J0bGV0X09yZ1BlcnNvbk9yZ1R5cGVQaWVfY2hhcnRCYXNlCiAgICAgKi8KICAgIHB1YmxpYyBoYW5kbGVTaW5nbGVEYXRhU2V0RmllbGQoaW5wdXQ6YW55LGZpZWxkOmFueSxhbGxDb2RlTGlzdDphbnkscmVzdWx0OmFueSxncm91cEZpZWxkOmFueSl7CiAgICAgICAgbGV0IHRlbXBGaWVsZE9iajphbnkgPSB7fTsKICAgICAgICAvL+WtmOWcqOS7o+eggeihqOeahOaDheWGtSjoh6rliqjovazljJblgLwpCiAgICAgICAgaWYoZmllbGQuY29kZWxpc3QpewogICAgICAgICAgICAvL+iOt+WPluS7o+eggeihqAogICAgICAgICAgICBsZXQgY3VyQ29kZUxpc3Q6TWFwPG51bWJlcixhbnk+ID0gYWxsQ29kZUxpc3QuZ2V0KGZpZWxkLmNvZGVsaXN0LnRhZyk7CiAgICAgICAgICAgIHRlbXBGaWVsZE9ialtmaWVsZC5uYW1lXSA9IGN1ckNvZGVMaXN0LmdldChpbnB1dFtmaWVsZC5uYW1lXSk7CiAgICAgICAgICAgIHRlbXBGaWVsZE9ialtmaWVsZC5uYW1lKydfc3JmdmFsdWUnXSA9IGlucHV0W2ZpZWxkLm5hbWVdOwogICAgICAgIH1lbHNlewogICAgICAgICAgICAgLy8g5LiN5a2Y5Zyo5Luj56CB6KGo55qE5oOF5Ya1CiAgICAgICAgICAgIGlmKGdyb3VwRmllbGQgJiYgT2JqZWN0LmlzKGdyb3VwRmllbGQubmFtZSxmaWVsZC5uYW1lKSl7CiAgICAgICAgICAgICAgICBpZihPYmplY3QuaXMoZ3JvdXBGaWVsZC5ncm91cE1vZGUsIllFQVIiKSApewogICAgICAgICAgICAgICAgICAgIHRlbXBGaWVsZE9ialtmaWVsZC5uYW1lXSA9IG1vbWVudChpbnB1dFtmaWVsZC5uYW1lXSkueWVhcigpLnRvU3RyaW5nKCk7CiAgICAgICAgICAgICAgICB9ZWxzZSBpZihPYmplY3QuaXMoZ3JvdXBGaWVsZC5ncm91cE1vZGUsIlFVQVJURVIiKSApewogICAgICAgICAgICAgICAgICAgIHRlbXBGaWVsZE9ialtmaWVsZC5uYW1lXSA9IG1vbWVudChpbnB1dFtmaWVsZC5uYW1lXSkueWVhcigpLnRvU3RyaW5nKCkrIi0iK21vbWVudChpbnB1dFtmaWVsZC5uYW1lXSkucXVhcnRlcnMoKS50b1N0cmluZygpOwogICAgICAgICAgICAgICAgfWVsc2UgaWYoT2JqZWN0LmlzKGdyb3VwRmllbGQuZ3JvdXBNb2RlLCJNT05USCIpICl7CiAgICAgICAgICAgICAgICAgICAgdGVtcEZpZWxkT2JqW2ZpZWxkLm5hbWVdID0gbW9tZW50KGlucHV0W2ZpZWxkLm5hbWVdKS55ZWFyKCkudG9TdHJpbmcoKSsiLSIrbW9tZW50KGlucHV0W2ZpZWxkLm5hbWVdKS5tb250aCgpLnRvU3RyaW5nKCk7CiAgICAgICAgICAgICAgICB9ZWxzZSBpZihPYmplY3QuaXMoZ3JvdXBGaWVsZC5ncm91cE1vZGUsIllFQVJXRUVLIikgKXsKICAgICAgICAgICAgICAgICAgICB0ZW1wRmllbGRPYmpbZmllbGQubmFtZV0gPSBtb21lbnQoaW5wdXRbZmllbGQubmFtZV0pLnllYXIoKS50b1N0cmluZygpKyItIittb21lbnQoaW5wdXRbZmllbGQubmFtZV0pLndlZWsoKS50b1N0cmluZygpOwogICAgICAgICAgICAgICAgfWVsc2UgaWYoT2JqZWN0LmlzKGdyb3VwRmllbGQuZ3JvdXBNb2RlLCJEQVkiKSApewogICAgICAgICAgICAgICAgICAgIHRlbXBGaWVsZE9ialtmaWVsZC5uYW1lXSA9IG1vbWVudChpbnB1dFtmaWVsZC5uYW1lXSkuZm9ybWF0KCJZWVlZLU1NLUREIik7CiAgICAgICAgICAgICAgICB9ZWxzZXsKICAgICAgICAgICAgICAgICAgICB0ZW1wRmllbGRPYmpbZmllbGQubmFtZV0gPSBpbnB1dFtmaWVsZC5uYW1lXTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfWVsc2V7CiAgICAgICAgICAgICAgICB0ZW1wRmllbGRPYmpbZmllbGQubmFtZV0gPSBpbnB1dFtmaWVsZC5uYW1lXQogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIE9iamVjdC5hc3NpZ24ocmVzdWx0LHRlbXBGaWVsZE9iaik7CiAgICB9CgogICAgLyoqCiAgICAgKiDojrflj5blm77ooajmiYDpnIDku6PnoIHooagKICAgICAqIAogICAgICogQG1lbWJlcm9mIFBvcnRsZXRfT3JnUGVyc29uT3JnVHlwZVBpZV9jaGFydEJhc2UKICAgICAqLwogICAgcHVibGljIGdldENoYXJ0QWxsQ29kZUxpc3QoKTpQcm9taXNlPGFueT57CiAgICAgICAgcmV0dXJuIG5ldyBQcm9taXNlKChyZXNvbHZlOmFueSxyZWplY3Q6YW55KSA9PnsKICAgICAgICAgICAgbGV0IGNvZGVMaXN0TWFwOk1hcDxzdHJpbmcsYW55PiA9IG5ldyBNYXAoKTsKICAgICAgICAgICAgaWYoT2JqZWN0LnZhbHVlcyh0aGlzLnNlcmllc01vZGVsKS5sZW5ndGggPjApewogICAgICAgICAgICAgICAgbGV0IHRlbXBGbGFnOmJvb2xlYW4gPSB0cnVlOwogICAgICAgICAgICAgICAgT2JqZWN0LnZhbHVlcyh0aGlzLnNlcmllc01vZGVsKS5mb3JFYWNoKChzaW5nbGVTZXJpZXM6YW55KSA9PnsKICAgICAgICAgICAgICAgICAgICBpZihzaW5nbGVTZXJpZXMuZGF0YVNldEZpZWxkcyAmJiBzaW5nbGVTZXJpZXMuZGF0YVNldEZpZWxkcy5sZW5ndGggPjApewogICAgICAgICAgICAgICAgICAgICAgICBsZXQgcHJvbWlzZUFycmF5OkFycmF5PGFueT4gPSBbXTsKICAgICAgICAgICAgICAgICAgICAgICAgbGV0IHByb21pc2VLZXlBcnJheTpBcnJheTxhbnk+ID0gW107CiAgICAgICAgICAgICAgICAgICAgICAgIHNpbmdsZVNlcmllcy5kYXRhU2V0RmllbGRzLmZvckVhY2goKHNpbmdsZURhdGFTZXRGaWVsZDphbnksaW5kZXg6YW55KSA9PnsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmKHNpbmdsZURhdGFTZXRGaWVsZC5jb2RlbGlzdCl7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGVtcEZsYWcgPSBmYWxzZTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZighY29kZUxpc3RNYXAuZ2V0KHNpbmdsZURhdGFTZXRGaWVsZC5jb2RlbGlzdC50YWcpKXsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcHJvbWlzZUFycmF5LnB1c2godGhpcy5nZXRDb2RlTGlzdChzaW5nbGVEYXRhU2V0RmllbGQuY29kZWxpc3QpKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcHJvbWlzZUtleUFycmF5LnB1c2goc2luZ2xlRGF0YVNldEZpZWxkLmNvZGVsaXN0LnRhZyk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFByb21pc2UuYWxsKHByb21pc2VBcnJheSkudGhlbigocmVzdWx0OmFueSkgPT57CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZihyZXN1bHQgJiYgcmVzdWx0Lmxlbmd0aCA+MCl7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVzdWx0LmZvckVhY2goKGNvZGVMaXN0OmFueSkgPT57CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxldCB0ZW1wQ29kZUxpc3RNYXA6TWFwPG51bWJlcixhbnk+ID0gbmV3IE1hcCgpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZihjb2RlTGlzdC5sZW5ndGggPjApewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29kZUxpc3QuZm9yRWFjaCgoY29kZUxpc3RJdGVtOmFueSkgPT57CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGVtcENvZGVMaXN0TWFwLnNldChjb2RlTGlzdEl0ZW0udmFsdWUsY29kZUxpc3RJdGVtLnRleHQpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb2RlTGlzdE1hcC5zZXQoc2luZ2xlRGF0YVNldEZpZWxkLmNvZGVsaXN0LnRhZyx0ZW1wQ29kZUxpc3RNYXApOyAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlc29sdmUoY29kZUxpc3RNYXApOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgaWYodGVtcEZsYWcpe3Jlc29sdmUoY29kZUxpc3RNYXApO30KICAgICAgICAgICAgfWVsc2V7CiAgICAgICAgICAgICAgICByZXNvbHZlKGNvZGVMaXN0TWFwKTsKICAgICAgICAgICAgfQogICAgICAgIH0pCiAgICB9CgogICAgLyoqCiAgICAgKiDojrflj5bku6PnoIHooagKICAgICAqIAogICAgICogQHJldHVybnMge1Byb21pc2U8YW55Pn0gCiAgICAgKiBAbWVtYmVyb2YgUG9ydGxldF9PcmdQZXJzb25PcmdUeXBlUGllX2NoYXJ0QmFzZQogICAgICovCiAgICBwdWJsaWMgZ2V0Q29kZUxpc3QoY29kZUxpc3RPYmplY3Q6YW55KTpQcm9taXNlPGFueT57CiAgICAgICAgcmV0dXJuIG5ldyBQcm9taXNlKChyZXNvbHZlOmFueSxyZWplY3Q6YW55KSA9PnsKICAgICAgICAgICAgaWYoY29kZUxpc3RPYmplY3QudGFnICYmIE9iamVjdC5pcyhjb2RlTGlzdE9iamVjdC50eXBlLCJTVEFUSUMiKSl7CiAgICAgICAgICAgICAgICBjb25zdCBjb2RlbGlzdCA9IHRoaXMuJHN0b3JlLmdldHRlcnMuZ2V0Q29kZUxpc3QoY29kZUxpc3RPYmplY3QudGFnKTsKICAgICAgICAgICAgICAgIGlmIChjb2RlbGlzdCkgewogICAgICAgICAgICAgICAgICAgIHJlc29sdmUoWy4uLkpTT04ucGFyc2UoSlNPTi5zdHJpbmdpZnkoY29kZWxpc3QuaXRlbXMpKV0pOwogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhgLS0tLSR7Y29kZUxpc3RPYmplY3QudGFnfS0tLS3ku6PnoIHooajkuI3lrZjlnKhgKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfWVsc2UgaWYoY29kZUxpc3RPYmplY3QudGFnICYmIE9iamVjdC5pcyhjb2RlTGlzdE9iamVjdC50eXBlLCJEWU5BTUlDIikpewogICAgICAgICAgICAgICAgdGhpcy5jb2RlTGlzdFNlcnZpY2UuZ2V0SXRlbXMoY29kZUxpc3RPYmplY3QudGFnKS50aGVuKChyZXM6YW55KSA9PiB7CiAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZShyZXMpOwogICAgICAgICAgICAgICAgfSkuY2F0Y2goKGVycm9yOmFueSkgPT4gewogICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKGAtLS0tJHtjb2RlTGlzdE9iamVjdC50YWd9LS0tLeS7o+eggeihqOS4jeWtmOWcqGApOwogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH0KICAgICAgICB9KQogICAgfQoKCn0K"},null]}
{"remainingRequest":"F:\\crod项目\\人事管理系统2\\iBizEHR\\app_EHRPim\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!F:\\crod项目\\人事管理系统2\\iBizEHR\\app_EHRPim\\src\\widgets\\trm-train-person\\main-grid\\main-grid-base.vue?vue&type=script&lang=tsx&","dependencies":[{"path":"F:\\crod项目\\人事管理系统2\\iBizEHR\\app_EHRPim\\src\\widgets\\trm-train-person\\main-grid\\main-grid-base.vue","mtime":1630509413808},{"path":"F:\\crod项目\\人事管理系统2\\iBizEHR\\app_EHRPim\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1630511852775},{"path":"F:\\crod项目\\人事管理系统2\\iBizEHR\\app_EHRPim\\node_modules\\thread-loader\\dist\\cjs.js","mtime":1630511853252},{"path":"F:\\crod项目\\人事管理系统2\\iBizEHR\\app_EHRPim\\node_modules\\babel-loader\\lib\\index.js","mtime":1630511852747},{"path":"F:\\crod项目\\人事管理系统2\\iBizEHR\\app_EHRPim\\node_modules\\ts-loader\\index.js","mtime":1630511985412},{"path":"F:\\crod项目\\人事管理系统2\\iBizEHR\\app_EHRPim\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1630511852775},{"path":"F:\\crod项目\\人事管理系统2\\iBizEHR\\app_EHRPim\\node_modules\\vue-loader\\lib\\index.js","mtime":1630512070338}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:CgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgppbXBvcnQgeyBWdWUsIENvbXBvbmVudCwgUHJvcCwgUHJvdmlkZSwgRW1pdCwgV2F0Y2gsIE1vZGVsLEluamVjdCB9IGZyb20gJ3Z1ZS1wcm9wZXJ0eS1kZWNvcmF0b3InOwppbXBvcnQgeyBDcmVhdGVFbGVtZW50IH0gZnJvbSAndnVlJzsKaW1wb3J0IHsgU3ViamVjdCwgU3Vic2NyaXB0aW9uIH0gZnJvbSAncnhqcyc7CmltcG9ydCB7IENvbnRyb2xJbnRlcmZhY2UgfSBmcm9tICdAL2ludGVyZmFjZS9jb250cm9sJzsKaW1wb3J0IHsgVUlBY3Rpb25Ub29sLFV0aWwgfSBmcm9tICdAL3V0aWxzJzsKaW1wb3J0IE5hdkRhdGFTZXJ2aWNlIGZyb20gJ0Avc2VydmljZS9hcHAvbmF2ZGF0YS1zZXJ2aWNlJzsKaW1wb3J0IFRybVRyYWluUGVyc29uU2VydmljZSBmcm9tICdAL3NlcnZpY2UvdHJtLXRyYWluLXBlcnNvbi90cm0tdHJhaW4tcGVyc29uLXNlcnZpY2UnOwppbXBvcnQgTWFpblNlcnZpY2UgZnJvbSAnLi9tYWluLWdyaWQtc2VydmljZSc7CgppbXBvcnQgQ29kZUxpc3RTZXJ2aWNlIGZyb20gIkBzZXJ2aWNlL2FwcC9jb2RlbGlzdC1zZXJ2aWNlIjsKaW1wb3J0IHsgRm9ybUl0ZW1Nb2RlbCB9IGZyb20gJ0AvbW9kZWwvZm9ybS1kZXRhaWwnOwoKCkBDb21wb25lbnQoewogICAgY29tcG9uZW50czogewogICAgICAKICAgIH0KfSkKZXhwb3J0IGRlZmF1bHQgY2xhc3MgTWFpbkJhc2UgZXh0ZW5kcyBWdWUgaW1wbGVtZW50cyBDb250cm9sSW50ZXJmYWNlIHsKCiAgICAvKioKICAgICAqIOWQjeensAogICAgICoKICAgICAqIEB0eXBlIHtzdHJpbmd9CiAgICAgKiBAbWVtYmVyb2YgTWFpbkJhc2UKICAgICAqLwogICAgQFByb3AoKSBwdWJsaWMgbmFtZT86IHN0cmluZzsKCiAgICAvKioKICAgICAqIOinhuWbvumAmuiur+WvueixoQogICAgICoKICAgICAqIEB0eXBlIHtTdWJqZWN0PFZpZXdTdGF0ZT59CiAgICAgKiBAbWVtYmVyb2YgTWFpbkJhc2UKICAgICAqLwogICAgQFByb3AoKSBwdWJsaWMgdmlld1N0YXRlITogU3ViamVjdDxWaWV3U3RhdGU+OwoKICAgIC8qKgogICAgICog5bqU55So5LiK5LiL5paHCiAgICAgKgogICAgICogQHR5cGUgeyp9CiAgICAgKiBAbWVtYmVyb2YgTWFpbkJhc2UKICAgICAqLwogICAgQFByb3AoKSBwdWJsaWMgY29udGV4dDogYW55OwoKICAgIC8qKgogICAgICog6KeG5Zu+5Y+C5pWwCiAgICAgKgogICAgICogQHR5cGUgeyp9CiAgICAgKiBAbWVtYmVyb2YgTWFpbkJhc2UKICAgICAqLwogICAgQFByb3AoKSBwdWJsaWMgdmlld3BhcmFtczogYW55OwoKICAgIC8qKgogICAgICog6KeG5Zu+54q25oCB5LqL5Lu2CiAgICAgKgogICAgICogQHB1YmxpYwogICAgICogQHR5cGUgeyhTdWJzY3JpcHRpb24gfCB1bmRlZmluZWQpfQogICAgICogQG1lbWJlcm9mIE1haW5CYXNlCiAgICAgKi8KICAgIHB1YmxpYyB2aWV3U3RhdGVFdmVudDogU3Vic2NyaXB0aW9uIHwgdW5kZWZpbmVkOwoKICAgIC8qKgogICAgICog6I635Y+W6YOo5Lu257G75Z6LCiAgICAgKgogICAgICogQHJldHVybnMge3N0cmluZ30KICAgICAqIEBtZW1iZXJvZiBNYWluQmFzZQogICAgICovCiAgICBwdWJsaWMgZ2V0Q29udHJvbFR5cGUoKTogc3RyaW5nIHsKICAgICAgICByZXR1cm4gJ0dSSUQnCiAgICB9CgoKCiAgICAvKioKICAgICAqIOiuoeaVsOWZqOacjeWKoeWvueixoembhuWQiAogICAgICoKICAgICAqIEB0eXBlIHtBcnJheTwqPn0KICAgICAqIEBtZW1iZXJvZiBNYWluQmFzZQogICAgICovICAgIAogICAgcHVibGljIGNvdW50ZXJTZXJ2aWNlQXJyYXk6QXJyYXk8YW55PiA9IFtdOwoKICAgIC8qKgogICAgICog5bu65p6E6YOo5Lu25pyN5Yqh5a+56LGhCiAgICAgKgogICAgICogQHR5cGUge01haW5TZXJ2aWNlfQogICAgICogQG1lbWJlcm9mIE1haW5CYXNlCiAgICAgKi8KICAgIHB1YmxpYyBzZXJ2aWNlOiBNYWluU2VydmljZSA9IG5ldyBNYWluU2VydmljZSh7ICRzdG9yZTogdGhpcy4kc3RvcmUgfSk7CgogICAgLyoqCiAgICAgKiDlrp7kvZPmnI3liqHlr7nosaEKICAgICAqCiAgICAgKiBAdHlwZSB7VHJtVHJhaW5QZXJzb25TZXJ2aWNlfQogICAgICogQG1lbWJlcm9mIE1haW5CYXNlCiAgICAgKi8KICAgIHB1YmxpYyBhcHBFbnRpdHlTZXJ2aWNlOiBUcm1UcmFpblBlcnNvblNlcnZpY2UgPSBuZXcgVHJtVHJhaW5QZXJzb25TZXJ2aWNlKHsgJHN0b3JlOiB0aGlzLiRzdG9yZSB9KTsKICAgIAoKCiAgICAvKioKICAgICAqIOWFs+mXreinhuWbvgogICAgICoKICAgICAqIEBwYXJhbSB7YW55fSBhcmdzCiAgICAgKiBAbWVtYmVyb2YgTWFpbkJhc2UKICAgICAqLwogICAgcHVibGljIGNsb3NlVmlldyhhcmdzOiBhbnkpOiB2b2lkIHsKICAgICAgICBsZXQgX3RoaXM6IGFueSA9IHRoaXM7CiAgICAgICAgX3RoaXMuJGVtaXQoJ2Nsb3NldmlldycsIFthcmdzXSk7CiAgICB9CgogICAgLyoqCiAgICAgKiAg6K6h5pWw5Zmo5Yi35pawCiAgICAgKgogICAgICogQG1lbWJlcm9mIE1haW5CYXNlCiAgICAgKi8KICAgIHB1YmxpYyBjb3VudGVyUmVmcmVzaCgpewogICAgICAgIGNvbnN0IF90aGlzOmFueSA9dGhpczsKICAgICAgICBpZihfdGhpcy5jb3VudGVyU2VydmljZUFycmF5ICYmIF90aGlzLmNvdW50ZXJTZXJ2aWNlQXJyYXkubGVuZ3RoID4wKXsKICAgICAgICAgICAgX3RoaXMuY291bnRlclNlcnZpY2VBcnJheS5mb3JFYWNoKChpdGVtOmFueSkgPT57CiAgICAgICAgICAgICAgICBpZihpdGVtLnJlZnJlc2hEYXRhICYmIGl0ZW0ucmVmcmVzaERhdGEgaW5zdGFuY2VvZiBGdW5jdGlvbil7CiAgICAgICAgICAgICAgICAgICAgaXRlbS5yZWZyZXNoRGF0YSgpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9KQogICAgICAgIH0KICAgIH0KCgogICAgLyoqCiAgICAgKiDku6PnoIHooajmnI3liqHlr7nosaEKICAgICAqCiAgICAgKiBAdHlwZSB7Q29kZUxpc3RTZXJ2aWNlfQogICAgICogQG1lbWJlcm9mIE1haW5CYXNlCiAgICAgKi8gIAogICAgcHVibGljIGNvZGVMaXN0U2VydmljZTpDb2RlTGlzdFNlcnZpY2UgPSBuZXcgQ29kZUxpc3RTZXJ2aWNlKHsgJHN0b3JlOiB0aGlzLiRzdG9yZSB9KTsKCiAgICAvKioKICAgICAqIOiOt+WPluWkmumhueaVsOaNrgogICAgICoKICAgICAqIEByZXR1cm5zIHthbnlbXX0KICAgICAqIEBtZW1iZXJvZiBNYWluQmFzZQogICAgICovCiAgICBwdWJsaWMgZ2V0RGF0YXMoKTogYW55W10gewogICAgICAgIHJldHVybiB0aGlzLnNlbGVjdGlvbnM7CiAgICB9CgogICAgLyoqCiAgICAgKiDojrflj5bljZXpobnmoJEKICAgICAqCiAgICAgKiBAcmV0dXJucyB7Kn0KICAgICAqIEBtZW1iZXJvZiBNYWluQmFzZQogICAgICovCiAgICBwdWJsaWMgZ2V0RGF0YSgpOiBhbnkgewogICAgICAgIHJldHVybiB0aGlzLnNlbGVjdGlvbnNbMF07CiAgICB9CgogICAgLyoqCiAgICAgKiDmiZPlvIDmlrDlu7rmlbDmja7op4blm74KICAgICAqCiAgICAgKiBAdHlwZSB7YW55fQogICAgICogQG1lbWJlcm9mIE1haW5CYXNlCiAgICAgKi8KICAgIEBQcm9wKCkgcHVibGljIG5ld2RhdGE6IGFueTsKICAgIC8qKgogICAgICog5omT5byA57yW6L6R5pWw5o2u6KeG5Zu+CiAgICAgKgogICAgICogQHR5cGUge2FueX0KICAgICAqIEBtZW1iZXJvZiBNYWluQmFzZQogICAgICovCiAgICBAUHJvcCgpIHB1YmxpYyBvcGVuZGF0YTogYW55OwoKICAgIC8qKgogICAgICog5pi+56S65aSE55CG5o+Q56S6CiAgICAgKgogICAgICogQHR5cGUge2Jvb2xlYW59CiAgICAgKiBAbWVtYmVyb2YgTWFpbkJhc2UKICAgICAqLwogICAgQFByb3AoeyBkZWZhdWx0OiB0cnVlIH0pIHB1YmxpYyBzaG93QnVzeUluZGljYXRvcj86IGJvb2xlYW47CgogICAgLyoqCiAgICAgKiDpg6jku7booYzkuLotLXVwZGF0ZQogICAgICoKICAgICAqIEB0eXBlIHtzdHJpbmd9CiAgICAgKiBAbWVtYmVyb2YgTWFpbkJhc2UKICAgICAqLwogICAgQFByb3AoKSBwdWJsaWMgdXBkYXRlQWN0aW9uITogc3RyaW5nOwogICAgCiAgICAvKioKICAgICAqIOmDqOS7tuihjOS4ui0tZmV0Y2gKICAgICAqCiAgICAgKiBAdHlwZSB7c3RyaW5nfQogICAgICogQG1lbWJlcm9mIE1haW5CYXNlCiAgICAgKi8KICAgIEBQcm9wKCkgcHVibGljIGZldGNoQWN0aW9uITogc3RyaW5nOwogICAgCiAgICAvKioKICAgICAqIOmDqOS7tuihjOS4ui0tcmVtb3ZlCiAgICAgKgogICAgICogQHR5cGUge3N0cmluZ30KICAgICAqIEBtZW1iZXJvZiBNYWluQmFzZQogICAgICovCiAgICBAUHJvcCgpIHB1YmxpYyByZW1vdmVBY3Rpb24hOiBzdHJpbmc7CiAgICAKICAgIC8qKgogICAgICog6YOo5Lu26KGM5Li6LS1sb2FkCiAgICAgKgogICAgICogQHR5cGUge3N0cmluZ30KICAgICAqIEBtZW1iZXJvZiBNYWluQmFzZQogICAgICovCiAgICBAUHJvcCgpIHB1YmxpYyBsb2FkQWN0aW9uITogc3RyaW5nOwogICAgCiAgICAvKioKICAgICAqIOmDqOS7tuihjOS4ui0tbG9hZGRyYWZ0CiAgICAgKgogICAgICogQHR5cGUge3N0cmluZ30KICAgICAqIEBtZW1iZXJvZiBNYWluQmFzZQogICAgICovCiAgICBAUHJvcCgpIHB1YmxpYyBsb2FkZHJhZnRBY3Rpb24hOiBzdHJpbmc7CiAgICAKICAgIC8qKgogICAgICog6YOo5Lu26KGM5Li6LS1jcmVhdGUKICAgICAqCiAgICAgKiBAdHlwZSB7c3RyaW5nfQogICAgICogQG1lbWJlcm9mIE1haW5CYXNlCiAgICAgKi8KICAgIEBQcm9wKCkgcHVibGljIGNyZWF0ZUFjdGlvbiE6IHN0cmluZzsKCiAgICAvKioKICAgICAqIOW9k+WJjemhtQogICAgICoKICAgICAqIEB0eXBlIHtudW1iZXJ9CiAgICAgKiBAbWVtYmVyb2YgTWFpbkJhc2UKICAgICAqLwogICAgcHVibGljIGN1clBhZ2U6IG51bWJlciA9IDE7CgogICAgLyoqCiAgICAgKiDmlbDmja4KICAgICAqCiAgICAgKiBAdHlwZSB7YW55W119CiAgICAgKiBAbWVtYmVyb2YgTWFpbkJhc2UKICAgICAqLwogICAgcHVibGljIGl0ZW1zOiBhbnlbXSA9IFtdOwoKICAgIC8qKgogICAgICog5piv5ZCm5pSv5oyB5YiG6aG1CiAgICAgKgogICAgICogQHR5cGUge2Jvb2xlYW59CiAgICAgKiBAbWVtYmVyb2YgTWFpbkJhc2UKICAgICAqLwogICAgcHVibGljIGlzRW5hYmxlUGFnaW5nQmFyOiBib29sZWFuID0gdHJ1ZTsKCiAgICAvKioKICAgICAqIOaYr+WQpuemgeeUqOaOkuW6jwogICAgICoKICAgICAqIEB0eXBlIHtib29sZWFufQogICAgICogQG1lbWJlcm9mIE1haW5CYXNlCiAgICAgKi8KICAgIHB1YmxpYyBpc05vU29ydDogYm9vbGVhbiA9IGZhbHNlOwoKICAgIC8qKgogICAgICog5o6S5bqP5pa55ZCRCiAgICAgKgogICAgICogQHR5cGUge3N0cmluZ30KICAgICAqIEBtZW1iZXJvZiBNYWluQmFzZQogICAgICovCiAgICBwdWJsaWMgbWlub3JTb3J0RGlyOiBzdHJpbmcgPSAnJzsKCiAgICAvKioKICAgICAqIOaOkuW6j+Wtl+autQogICAgICoKICAgICAqIEB0eXBlIHtzdHJpbmd9CiAgICAgKiBAbWVtYmVyb2YgTWFpbkJhc2UKICAgICAqLwogICAgcHVibGljIG1pbm9yU29ydFBTREVGOiBzdHJpbmcgPSAnJzsKCiAgICAvKioKICAgICAqIOWIhumhteadoeaVsAogICAgICoKICAgICAqIEB0eXBlIHtudW1iZXJ9CiAgICAgKiBAbWVtYmVyb2YgTWFpbkJhc2UKICAgICAqLwogICAgcHVibGljIGxpbWl0OiBudW1iZXIgPSAyMDsKCiAgICAvKioKICAgICAqIOaYr+WQpuaYvuekuuagh+mimAogICAgICoKICAgICAqIEB0eXBlIHtib29sZWFufQogICAgICogQG1lbWJlcm9mIE1haW5CYXNlCiAgICAgKi8KICAgIHB1YmxpYyBpc0hpZGVIZWFkZXI6IGJvb2xlYW4gPSBmYWxzZTsKCiAgICAvKioKICAgICAqIOaYr+WQpum7mOiupOmAieS4reesrOS4gOadoeaVsOaNrgogICAgICoKICAgICAqIEB0eXBlIHtib29sZWFufQogICAgICogQG1lbWJlcm9mIE1haW5CYXNlCiAgICAgKi8KICAgIEBQcm9wKHsgZGVmYXVsdDogZmFsc2UgfSkgcHVibGljIGlzU2VsZWN0Rmlyc3REZWZhdWx0ITogYm9vbGVhbjsKCiAgICAvKioKICAgICAqIOaYr+WQpuWNlemAiQogICAgICoKICAgICAqIEB0eXBlIHtib29sZWFufQogICAgICogQG1lbWJlcm9mIE1haW5CYXNlCiAgICAgKi8KICAgIEBQcm9wKCkgcHVibGljIGlzU2luZ2xlU2VsZWN0PzogYm9vbGVhbjsKCiAgICAvKioKICAgICAqIOmAieS4reaVsOaNruWtl+espuS4sgogICAgICoKICAgICAqIEB0eXBlIHtzdHJpbmd9CiAgICAgKiBAbWVtYmVyb2YgTWFpbkJhc2UKICAgICAqLwogICAgQFByb3AoKSBwdWJsaWMgc2VsZWN0ZWREYXRhPzogc3RyaW5nOwoKICAgIC8qKgogICAgICog6YCJ5Lit5YC85Y+Y5YyWCiAgICAgKgogICAgICogQHBhcmFtIHsqfSBuZXdWYWwKICAgICAqIEBwYXJhbSB7Kn0gb2xkVmFsCiAgICAgKiBAbWVtYmVyb2YgTWFpbkJhc2UKICAgICAqLwogICAgQFdhdGNoKCdzZWxlY3RlZERhdGEnKQogICAgcHVibGljIG9uVmFsdWVDaGFuZ2UobmV3VmFsOiBhbnksIG9sZFZhbDogYW55KSB7CiAgICAgICAgdGhpcy5zZWxlY3Rpb25zID0gW107CiAgICAgICAgaWYodGhpcy5zZWxlY3RlZERhdGEpewogICAgICAgICAgICBjb25zdCByZWZzOiBhbnkgPSB0aGlzLiRyZWZzOwogICAgICAgICAgICBpZiAocmVmcy5tdWx0aXBsZVRhYmxlKSB7CiAgICAgICAgICAgICAgICByZWZzLm11bHRpcGxlVGFibGUuY2xlYXJTZWxlY3Rpb24oKTsKICAgICAgICAgICAgICAgIEpTT04ucGFyc2UodGhpcy5zZWxlY3RlZERhdGEpLmZvckVhY2goKHNlbGVjdGlvbjphbnkpPT57CiAgICAgICAgICAgICAgICAgICAgbGV0IHNlbGVjdGVkSXRlbSA9IHRoaXMuaXRlbXMuZmluZCgoaXRlbTphbnkpPT57CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBPYmplY3QuaXMoaXRlbS5zcmZrZXksIHNlbGVjdGlvbi5zcmZrZXkpOwogICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgIGlmKHNlbGVjdGVkSXRlbSl7CiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMucm93Q2xpY2soc2VsZWN0ZWRJdGVtKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIOihqOagvOihjOaVsOaNrum7mOiupOa/gOa0u+aooeW8jwogICAgICogMCDkuI3mv4DmtLsKICAgICAqIDEg5Y2V5Ye75r+A5rS7CiAgICAgKiAyIOWPjOWHu+a/gOa0uwogICAgICoKICAgICAqIEB0eXBlIHsobnVtYmVyIHwgMCB8IDEgfCAyKX0KICAgICAqIEBtZW1iZXJvZiBNYWluQmFzZQogICAgICovCiAgICBAUHJvcCh7ZGVmYXVsdDogMn0pIHB1YmxpYyBncmlkUm93QWN0aXZlTW9kZSE6IG51bWJlcjsKCiAgICAvKioKICAgICAqIOaYr+WQpuW8gOWQr+ihjOe8lui+kQogICAgICoKICAgICAqIEB0eXBlIHtib29sZWFufQogICAgICogQG1lbWJlcm9mIE1haW5CYXNlCiAgICAgKi8KICAgIEBQcm9wKHtkZWZhdWx0OiBmYWxzZX0pIHB1YmxpYyBpc09wZW5FZGl0ITogYm9vbGVhbjsKCiAgICAvKioKICAgICAqIOWunumZheaYr+WQpuW8gOWQr+ihjOe8lui+kQogICAgICoKICAgICAqIEB0eXBlIHtib29sZWFufQogICAgICogQG1lbWJlcm9mIE1haW5CYXNlCiAgICAgKi8KICAgIHB1YmxpYyBhY3R1YWxJc09wZW5FZGl0OiBib29sZWFuID0gdGhpcy5pc09wZW5FZGl0OwoKICAgIC8qKgogICAgICog5oC75p2h5pWwCiAgICAgKgogICAgICogQHR5cGUge251bWJlcn0KICAgICAqIEBtZW1iZXJvZiBNYWluQmFzZQogICAgICovCiAgICBwdWJsaWMgdG90YWxyb3c6IG51bWJlciA9IDA7CgogICAgLyoqCiAgICAgKiDpgInkuK3ooYzmlbDmja4KICAgICAqCiAgICAgKiBAdHlwZSB7YW55W119CiAgICAgKiBAbWVtYmVyb2YgTWFpbgogICAgICovCiAgICBwdWJsaWMgc2VsZWN0aW9uczogYW55W10gPSBbXTsKCiAgICAvKioKICAgICAqIOaLpuaIquihjOmAieS4rQogICAgICoKICAgICAqIEB0eXBlIHtib29sZWFufQogICAgICogQG1lbWJlcm9mIE1haW4KICAgICAqLwogICAgcHVibGljIHN0b3BSb3dDbGljazogYm9vbGVhbiA9IGZhbHNlOwoKCgoKICAgIC8qKgogICAgICog6KGo5qC85piv5ZCm5pi+56S6CiAgICAgKgogICAgICogQHR5cGUge2Jvb2xlYW59CiAgICAgKiBAbWVtYmVyb2YgTWFpbkJhc2UKICAgICAqLwogICAgcHVibGljIGlzRGlzcGxheTpib29sZWFuID0gdHJ1ZTsKCiAgICAvKioKICAgICAqIOmDqOS7tuWIt+aWsAogICAgICoKICAgICAqIEBwYXJhbSB7YW55W119IGFyZ3MKICAgICAqIEBtZW1iZXJvZiBNYWluQmFzZQogICAgICovCiAgICBwdWJsaWMgcmVmcmVzaChhcmdzOiBhbnlbXSk6IHZvaWQgewogICAgICAgIHRoaXMubG9hZCgpOwogICAgfQoKICAgIC8qKgogICAgKiDpgInpobnmoYbliJflrr0KICAgICoKICAgICogQHR5cGUge251bWJlcn0KICAgICogQG1lbWJlcm9mIEFwcEluZGV4CiAgICAqLwogICAgcHVibGljIGNoZWNrYm94Q29sV2lkdGg6IG51bWJlciA9IDM0OwoKICAgIC8qKgogICAgICog5piv5ZCm5YWB6K645ouW5Yqo5YiX5a69CiAgICAgKgogICAgICogQHR5cGUge2Jvb2xlYW59CiAgICAgKiBAbWVtYmVyb2YgQXBwRW1iZWRQaWNrZXIKICAgICAqLwogICAgcHVibGljIGlzRHJhZ2VuZENvbDogYm9vbGVhbiA9IGZhbHNlOwoKICAgIC8qKgogICAgICog5omA5pyJ5YiX5oiQ5ZGYCiAgICAgKgogICAgICogQHR5cGUge2FueVtdfQogICAgICogQG1lbWJlcm9mIE1haW5CYXNlCiAgICAgKi8KICAgIHB1YmxpYyBhbGxDb2x1bW5zOiBhbnlbXSA9IFsKICAgICAgICB7CiAgICAgICAgICAgIG5hbWU6ICdweGJqJywKICAgICAgICAgICAgbGFiZWw6ICfln7norq3nj63nuqcnLAogICAgICAgICAgICBsYW5ndGFnOiAnZW50aXRpZXMudHJtdHJhaW5wZXJzb24ubWFpbl9ncmlkLmNvbHVtbnMucHhiaicsCiAgICAgICAgICAgIHNob3c6IHRydWUsCiAgICAgICAgICAgIHV0aWw6ICdweCcKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgbmFtZTogJ3RyYWluYmVnaW4nLAogICAgICAgICAgICBsYWJlbDogJ+WfueiureW8gOWni+aXtumXtCcsCiAgICAgICAgICAgIGxhbmd0YWc6ICdlbnRpdGllcy50cm10cmFpbnBlcnNvbi5tYWluX2dyaWQuY29sdW1ucy50cmFpbmJlZ2luJywKICAgICAgICAgICAgc2hvdzogdHJ1ZSwKICAgICAgICAgICAgdXRpbDogJ3B4JwogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICBuYW1lOiAndHJhaW5lbmQnLAogICAgICAgICAgICBsYWJlbDogJ+Wfueiuree7k+adn+aXtumXtCcsCiAgICAgICAgICAgIGxhbmd0YWc6ICdlbnRpdGllcy50cm10cmFpbnBlcnNvbi5tYWluX2dyaWQuY29sdW1ucy50cmFpbmVuZCcsCiAgICAgICAgICAgIHNob3c6IHRydWUsCiAgICAgICAgICAgIHV0aWw6ICdweCcKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgbmFtZTogJ3B4a2MnLAogICAgICAgICAgICBsYWJlbDogJ+WfueiureivvueoiycsCiAgICAgICAgICAgIGxhbmd0YWc6ICdlbnRpdGllcy50cm10cmFpbnBlcnNvbi5tYWluX2dyaWQuY29sdW1ucy5weGtjJywKICAgICAgICAgICAgc2hvdzogdHJ1ZSwKICAgICAgICAgICAgdXRpbDogJ3B4JwogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICBuYW1lOiAncHhqZycsCiAgICAgICAgICAgIGxhYmVsOiAn5Z+56K6t5py65p6EJywKICAgICAgICAgICAgbGFuZ3RhZzogJ2VudGl0aWVzLnRybXRyYWlucGVyc29uLm1haW5fZ3JpZC5jb2x1bW5zLnB4amcnLAogICAgICAgICAgICBzaG93OiB0cnVlLAogICAgICAgICAgICB1dGlsOiAncHgnCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgIG5hbWU6ICd0cmFpbnJlcycsCiAgICAgICAgICAgIGxhYmVsOiAn5Z+56K6t57uT5p6cJywKICAgICAgICAgICAgbGFuZ3RhZzogJ2VudGl0aWVzLnRybXRyYWlucGVyc29uLm1haW5fZ3JpZC5jb2x1bW5zLnRyYWlucmVzJywKICAgICAgICAgICAgc2hvdzogdHJ1ZSwKICAgICAgICAgICAgdXRpbDogJ3B4JwogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICBuYW1lOiAnZnMnLAogICAgICAgICAgICBsYWJlbDogJ+WIhuaVsCcsCiAgICAgICAgICAgIGxhbmd0YWc6ICdlbnRpdGllcy50cm10cmFpbnBlcnNvbi5tYWluX2dyaWQuY29sdW1ucy5mcycsCiAgICAgICAgICAgIHNob3c6IHRydWUsCiAgICAgICAgICAgIHV0aWw6ICdweCcKICAgICAgICB9LAogICAgXQoKICAgIC8qKgogICAgICog6KGo5qC85qih5Z6L6ZuG5ZCICiAgICAgKgogICAgICogQHR5cGUgeyp9CiAgICAgKiBAbWVtYmVyb2YgTWFpbkJhc2UKICAgICAqLwogICAgcHVibGljIGdyaWRJdGVtc01vZGVsOiBhbnlbXSA9IFtdOwoKICAgIC8qKgogICAgICog6I635Y+W6KGo5qC86KGM5qih5Z6LCiAgICAgKgogICAgICogQHR5cGUgeyp9CiAgICAgKiBAbWVtYmVyb2YgTWFpbkJhc2UKICAgICAqLwogICAgcHVibGljIGdldEdyaWRSb3dNb2RlbCgpewogICAgICAgIHJldHVybiB7CiAgICAgICAgICBzcmZrZXk6IG5ldyBGb3JtSXRlbU1vZGVsKCksCiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICog5bGe5oCn5YC86KeE5YiZCiAgICAgKgogICAgICogQHR5cGUgeyp9CiAgICAgKiBAbWVtYmVyb2YgTWFpbkJhc2UKICAgICAqLwogICAgcHVibGljIHJ1bGVzOiBhbnkgPSB7CiAgICAgICAgc3Jma2V5OiBbCiAgICAgICAgICAgICB7IHJlcXVpcmVkOiBmYWxzZSwgdmFsaWRhdG9yOiAocnVsZTphbnksIHZhbHVlOmFueSwgY2FsbGJhY2s6YW55KSA9PiB7IHJldHVybiAocnVsZS5yZXF1aXJlZCAmJiAodmFsdWUgPT09IG51bGwgfHwgdmFsdWUgPT09IHVuZGVmaW5lZCB8fCB2YWx1ZSA9PT0gIiIpKSA/IGZhbHNlIDogdHJ1ZTt9LCBtZXNzYWdlOiAn5Z+56K6t5Lq65ZGY5qCH6K+GIOWAvOS4jeiDveS4uuepuicsIHRyaWdnZXI6ICdjaGFuZ2UnIH0sCiAgICAgICAgICAgIHsgcmVxdWlyZWQ6IGZhbHNlLCB2YWxpZGF0b3I6IChydWxlOmFueSwgdmFsdWU6YW55LCBjYWxsYmFjazphbnkpID0+IHsgcmV0dXJuIChydWxlLnJlcXVpcmVkICYmICh2YWx1ZSA9PT0gbnVsbCB8fCB2YWx1ZSA9PT0gdW5kZWZpbmVkIHx8IHZhbHVlID09PSAiIikpID8gZmFsc2UgOiB0cnVlO30sIG1lc3NhZ2U6ICfln7norq3kurrlkZjmoIfor4Yg5YC85LiN6IO95Li656m6JywgdHJpZ2dlcjogJ2JsdXInIH0sCiAgICAgICAgXSwKICAgIH0KCiAgICAvKioKICAgICAqIOihqOagvOihjOe8lui+kemhueagoemqjAogICAgICoKICAgICAqIEBwYXJhbSB7c3RyaW5nfSBwcm9wZXJ0eSDlsZ7mgKflkI0KICAgICAqIEBwYXJhbSB7Kn0gZGF0YSDooYzmlbDmja4KICAgICAqIEBwYXJhbSB7bnVtYmVyfSByb3dJbmRleCDooYzntKLlvJUKICAgICAqIEByZXR1cm5zIFByb21pc2U8YW55PgogICAgICogCiAgICAgKiBAbWVtYmVyb2YgTWFpbkJhc2UKICAgICAqLwogICAgcHVibGljIHZhbGlkYXRlKHByb3BlcnR5OnN0cmluZywgZGF0YTphbnksIHJvd0luZGV4Om51bWJlcik6UHJvbWlzZTxhbnk+ewogICAgICAgIHJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZSwgcmVqZWN0KSA9PiB7CiAgICAgICAgICAgIHRoaXMuJHV0aWwudmFsaWRhdGVJdGVtKHByb3BlcnR5LGRhdGEsdGhpcy5ydWxlcykudGhlbigoKT0+ewogICAgICAgICAgICAgICAgdGhpcy5ncmlkSXRlbXNNb2RlbFtyb3dJbmRleF1bcHJvcGVydHldLnNldEVycm9yKG51bGwpOwogICAgICAgICAgICAgICAgcmVzb2x2ZSh0cnVlKTsKICAgICAgICAgICAgfSkuY2F0Y2goKHsgZXJyb3JzLCBmaWVsZHMgfSkgPT4gewogICAgICAgICAgICAgICAgdGhpcy5ncmlkSXRlbXNNb2RlbFtyb3dJbmRleF1bcHJvcGVydHldLnNldEVycm9yKGVycm9yc1swXS5tZXNzYWdlKTsKICAgICAgICAgICAgICAgIHJlc29sdmUoZmFsc2UpOwogICAgICAgICAgICB9KTsKICAgICAgICB9KTsKICAgIH0KCiAgICAvKioKICAgICAqIOagoemqjOaJgOacieS/ruaUuei/h+eahOe8lui+kemhuQogICAgICoKICAgICAqIEByZXR1cm5zIFByb21pc2U8YW55PgogICAgICogQG1lbWJlcm9mIE1haW5CYXNlCiAgICAgKi8KICAgIHB1YmxpYyBhc3luYyB2YWxpZGF0ZUFsbCgpewogICAgICAgIGxldCB2YWxpZGF0ZVN0YXRlID0gdHJ1ZTsKICAgICAgICBsZXQgaW5kZXggPSAtMTsKICAgICAgICBmb3IobGV0IGl0ZW0gb2YgdGhpcy5pdGVtcyl7CiAgICAgICAgICBpbmRleCsrOwogICAgICAgICAgaWYoaXRlbS5yb3dEYXRhU3RhdGUgPT09ICJjcmVhdGUiIHx8IGl0ZW0ucm93RGF0YVN0YXRlID09PSAidXBkYXRlIil7CiAgICAgICAgICAgIGZvcihsZXQgcHJvcGVydHkgb2YgT2JqZWN0LmtleXModGhpcy5ydWxlcykpewogICAgICAgICAgICAgIGlmKCFhd2FpdCB0aGlzLnZhbGlkYXRlKHByb3BlcnR5LGl0ZW0saW5kZXgpKXsKICAgICAgICAgICAgICAgIHZhbGlkYXRlU3RhdGUgPSBmYWxzZTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgcmV0dXJuIHZhbGlkYXRlU3RhdGU7CiAgICB9CgogICAgLyoqCiAgICAgKiDooajmoLzmlbDmja7liqDovb0KICAgICAqCiAgICAgKiBAcGFyYW0geyp9IFthcmc9e31dCiAgICAgKiBAbWVtYmVyb2YgTWFpbkJhc2UKICAgICAqLwogICAgcHVibGljIGxvYWQob3B0OiBhbnkgPSB7fSwgcGFnZVJlc2V0OiBib29sZWFuID0gZmFsc2UpOiB2b2lkIHsKICAgICAgICBpZighdGhpcy5mZXRjaEFjdGlvbil7CiAgICAgICAgICAgIHRoaXMuJE5vdGljZS5lcnJvcih7IHRpdGxlOiAn6ZSZ6K+vJywgZGVzYzogJ1RSTVRSSUFOUEVSU09OR3JpZFZpZXfop4blm77ooajmoLxmZXRjaEFjdGlvbuWPguaVsOacqumFjee9ricgfSk7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICB9CiAgICAgICAgaWYocGFnZVJlc2V0KXsKICAgICAgICAgICAgdGhpcy5jdXJQYWdlID0gMTsKICAgICAgICB9CiAgICAgICAgY29uc3QgYXJnOiBhbnkgPSB7Li4ub3B0fTsKICAgICAgICBjb25zdCBwYWdlOiBhbnkgPSB7fTsKICAgICAgICBpZiAodGhpcy5pc0VuYWJsZVBhZ2luZ0JhcikgewogICAgICAgICAgICBPYmplY3QuYXNzaWduKHBhZ2UsIHsgcGFnZTogdGhpcy5jdXJQYWdlLTEsIHNpemU6IHRoaXMubGltaXQgfSk7CiAgICAgICAgfQogICAgICAgIC8vIOiuvue9ruaOkuW6jwogICAgICAgIGlmICghdGhpcy5pc05vU29ydCAmJiAhT2JqZWN0LmlzKHRoaXMubWlub3JTb3J0RGlyLCAnJykgJiYgIU9iamVjdC5pcyh0aGlzLm1pbm9yU29ydFBTREVGLCAnJykpIHsKICAgICAgICAgICAgY29uc3Qgc29ydDogc3RyaW5nID0gdGhpcy5taW5vclNvcnRQU0RFRisiLCIrdGhpcy5taW5vclNvcnREaXI7CiAgICAgICAgICAgIE9iamVjdC5hc3NpZ24ocGFnZSwgeyBzb3J0OiBzb3J0IH0pOwogICAgICAgIH0KICAgICAgICBPYmplY3QuYXNzaWduKGFyZywgcGFnZSk7CiAgICAgICAgY29uc3QgcGFyZW50ZGF0YTogYW55ID0ge307CiAgICAgICAgdGhpcy4kZW1pdCgnYmVmb3JlbG9hZCcsIHBhcmVudGRhdGEpOwogICAgICAgIE9iamVjdC5hc3NpZ24oYXJnLCBwYXJlbnRkYXRhKTsKICAgICAgICBsZXQgdGVtcFZpZXdQYXJhbXM6YW55ID0gcGFyZW50ZGF0YS52aWV3cGFyYW1zP3BhcmVudGRhdGEudmlld3BhcmFtczp7fTsKICAgICAgICBPYmplY3QuYXNzaWduKHRlbXBWaWV3UGFyYW1zLEpTT04ucGFyc2UoSlNPTi5zdHJpbmdpZnkodGhpcy52aWV3cGFyYW1zKSkpOwogICAgICAgIE9iamVjdC5hc3NpZ24oYXJnLHt2aWV3cGFyYW1zOnRlbXBWaWV3UGFyYW1zfSk7CiAgICAgICAgY29uc3QgcG9zdDogUHJvbWlzZTxhbnk+ID0gdGhpcy5zZXJ2aWNlLnNlYXJjaCh0aGlzLmZldGNoQWN0aW9uLEpTT04ucGFyc2UoSlNPTi5zdHJpbmdpZnkodGhpcy5jb250ZXh0KSksIGFyZywgdGhpcy5zaG93QnVzeUluZGljYXRvcik7CiAgICAgICAgcG9zdC50aGVuKChyZXNwb25zZTogYW55KSA9PiB7CiAgICAgICAgICAgIGlmICghcmVzcG9uc2Uuc3RhdHVzIHx8IHJlc3BvbnNlLnN0YXR1cyAhPT0gMjAwKSB7CiAgICAgICAgICAgICAgICBpZiAocmVzcG9uc2UuZXJyb3JNZXNzYWdlKSB7CiAgICAgICAgICAgICAgICAgICAgdGhpcy4kTm90aWNlLmVycm9yKHsgdGl0bGU6ICfplJnor68nLCBkZXNjOiByZXNwb25zZS5lcnJvck1lc3NhZ2UgfSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgIH0KICAgICAgICAgICAgY29uc3QgZGF0YTogYW55ID0gcmVzcG9uc2UuZGF0YTsKICAgICAgICAgICAgdGhpcy50b3RhbHJvdyA9IHJlc3BvbnNlLnRvdGFsOwogICAgICAgICAgICB0aGlzLml0ZW1zID0gSlNPTi5wYXJzZShKU09OLnN0cmluZ2lmeShkYXRhKSk7CiAgICAgICAgICAgIC8vIOa4heepunNlbGVjdGlvbnMsZ3JpZEl0ZW1zTW9kZWwKICAgICAgICAgICAgdGhpcy5zZWxlY3Rpb25zID0gW107CiAgICAgICAgICAgIHRoaXMuZ3JpZEl0ZW1zTW9kZWwgPSBbXTsKICAgICAgICAgICAgdGhpcy5pdGVtcy5mb3JFYWNoKCgpPT57dGhpcy5ncmlkSXRlbXNNb2RlbC5wdXNoKHRoaXMuZ2V0R3JpZFJvd01vZGVsKCkpfSk7CiAgICAgICAgICAgIHRoaXMuJGVtaXQoJ2xvYWQnLCB0aGlzLml0ZW1zKTsKICAgICAgICAgICAgLy8g6K6+572u6buY6K6k6YCJ5LitCiAgICAgICAgICAgIGxldCBfdGhpcyA9IHRoaXM7CiAgICAgICAgICAgIHNldFRpbWVvdXQoKCkgPT4gewogICAgICAgICAgICAgICAgaWYoX3RoaXMuaXNTZWxlY3RGaXJzdERlZmF1bHQpewogICAgICAgICAgICAgICAgICBfdGhpcy5yb3dDbGljayhfdGhpcy5pdGVtc1swXSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBpZihfdGhpcy5zZWxlY3RlZERhdGEpewogICAgICAgICAgICAgICAgICAgIGNvbnN0IHJlZnM6IGFueSA9IF90aGlzLiRyZWZzOwogICAgICAgICAgICAgICAgICAgIGlmIChyZWZzLm11bHRpcGxlVGFibGUpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmVmcy5tdWx0aXBsZVRhYmxlLmNsZWFyU2VsZWN0aW9uKCk7CiAgICAgICAgICAgICAgICAgICAgICAgIEpTT04ucGFyc2UoX3RoaXMuc2VsZWN0ZWREYXRhKS5mb3JFYWNoKChzZWxlY3Rpb246YW55KT0+ewogICAgICAgICAgICAgICAgICAgICAgICAgICAgbGV0IHNlbGVjdGVkSXRlbSA9IF90aGlzLml0ZW1zLmZpbmQoKGl0ZW06YW55KT0+ewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBPYmplY3QuaXMoaXRlbS5zcmZrZXksIHNlbGVjdGlvbi5zcmZrZXkpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZihzZWxlY3RlZEl0ZW0pewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIF90aGlzLnJvd0NsaWNrKHNlbGVjdGVkSXRlbSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSwgMzAwKTsKICAgICAgICB9KS5jYXRjaCgocmVzcG9uc2U6IGFueSkgPT4gewogICAgICAgICAgICBpZiAocmVzcG9uc2UgJiYgcmVzcG9uc2Uuc3RhdHVzID09PSA0MDEpIHsKICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgfQogICAgICAgICAgICB0aGlzLiROb3RpY2UuZXJyb3IoeyB0aXRsZTogJ+mUmeivrycsIGRlc2M6IHJlc3BvbnNlLmVycm9yTWVzc2FnZSB9KTsKICAgICAgICB9KTsKICAgIH0KCiAgICAvKioKICAgICAqIOWIoOmZpAogICAgICoKICAgICAqIEBwYXJhbSB7YW55W119IGRhdGFzCiAgICAgKiBAcmV0dXJucyB7UHJvbWlzZTxhbnk+fQogICAgICogQG1lbWJlcm9mIE1haW5CYXNlCiAgICAgKi8KICAgIHB1YmxpYyBhc3luYyByZW1vdmUoZGF0YXM6IGFueVtdKTogUHJvbWlzZTxhbnk+IHsKICAgICAgICBpZighdGhpcy5yZW1vdmVBY3Rpb24pewogICAgICAgICAgICB0aGlzLiROb3RpY2UuZXJyb3IoeyB0aXRsZTogJ+mUmeivrycsIGRlc2M6ICdUUk1UUklBTlBFUlNPTkdyaWRWaWV36KeG5Zu+6KGo5qC8cmVtb3ZlQWN0aW9u5Y+C5pWw5pyq6YWN572uJyB9KTsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KICAgICAgICBsZXQgX2RhdGFzOmFueVtdID0gW107CiAgICAgICAgZGF0YXMuZm9yRWFjaCgocmVjb3JkOiBhbnksIGluZGV4OiBudW1iZXIpID0+IHsKICAgICAgICAgICAgaWYgKE9iamVjdC5pcyhyZWNvcmQuc3JmdWYsIjAiKSkgewogICAgICAgICAgICAgICAgdGhpcy5pdGVtcy5zb21lKCh2YWw6IGFueSwgbnVtOiBudW1iZXIpID0+ewogICAgICAgICAgICAgICAgICAgIGlmKEpTT04uc3RyaW5naWZ5KHZhbCkgPT0gSlNPTi5zdHJpbmdpZnkocmVjb3JkKSl7CiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuaXRlbXMuc3BsaWNlKG51bSwxKTsKICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5ncmlkSXRlbXNNb2RlbC5zcGxpY2UobnVtLDEpOwogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9KTsgCiAgICAgICAgICAgIH1lbHNlewogICAgICAgICAgICAgICBfZGF0YXMucHVzaChkYXRhc1tpbmRleF0pOwogICAgICAgICAgICB9CiAgICAgICAgfSk7CiAgICAgICAgaWYgKF9kYXRhcy5sZW5ndGggPT09IDApIHsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KICAgICAgICBsZXQgZGF0YUluZm8gPSAnJzsKICAgICAgICBfZGF0YXMuZm9yRWFjaCgocmVjb3JkOiBhbnksIGluZGV4OiBudW1iZXIpID0+IHsKICAgICAgICAgICAgbGV0IHNyZm1ham9ydGV4dCA9IHJlY29yZC50cm10cmlhbnBlcnNvbm5hbWU7CiAgICAgICAgICAgIGlmIChpbmRleCA8IDUpIHsKICAgICAgICAgICAgICAgIGlmICghT2JqZWN0LmlzKGRhdGFJbmZvLCAnJykpIHsKICAgICAgICAgICAgICAgICAgICBkYXRhSW5mbyArPSAn44CBJzsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGRhdGFJbmZvICs9IHNyZm1ham9ydGV4dDsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICAgICAgfQogICAgICAgIH0pOwoKICAgICAgICBpZiAoX2RhdGFzLmxlbmd0aCA8IDUpIHsKICAgICAgICAgICAgZGF0YUluZm8gPSBkYXRhSW5mbyArICcg5YWxJyArIF9kYXRhcy5sZW5ndGggKyAn5p2h5pWw5o2uJzsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBkYXRhSW5mbyA9IGRhdGFJbmZvICsgJy4uLicgKyAnIOWFsScgKyBfZGF0YXMubGVuZ3RoICsgJ+adoeaVsOaNric7CiAgICAgICAgfQoKICAgICAgICBjb25zdCByZW1vdmVEYXRhID0gKCkgPT4gewogICAgICAgICAgICBsZXQga2V5czogYW55W10gPSBbXTsKICAgICAgICAgICAgX2RhdGFzLmZvckVhY2goKGRhdGE6IGFueSkgPT4gewogICAgICAgICAgICAgICAga2V5cy5wdXNoKGRhdGEuc3Jma2V5KTsKICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIGxldCBfcmVtb3ZlQWN0aW9uID0ga2V5cy5sZW5ndGggPiAxID8gJ3JlbW92ZUJhdGNoJyA6IHRoaXMucmVtb3ZlQWN0aW9uIDsKICAgICAgICAgICAgbGV0IF9rZXlzID0ga2V5cy5sZW5ndGggPiAxID8ga2V5cyA6IGtleXNbMF0gOwogICAgICAgICAgICBjb25zdCBjb250ZXh0OmFueSA9IEpTT04ucGFyc2UoSlNPTi5zdHJpbmdpZnkodGhpcy5jb250ZXh0KSk7CiAgICAgICAgICAgIGNvbnN0IHBvc3Q6IFByb21pc2U8YW55PiA9IHRoaXMuc2VydmljZS5kZWxldGUoX3JlbW92ZUFjdGlvbixPYmplY3QuYXNzaWduKGNvbnRleHQseyB0cm10cmFpbnBlcnNvbjogX2tleXMgfSksT2JqZWN0LmFzc2lnbih7IHRybXRyYWlucGVyc29uOiBfa2V5cyB9LHt2aWV3cGFyYW1zOnRoaXMudmlld3BhcmFtc30pLCB0aGlzLnNob3dCdXN5SW5kaWNhdG9yKTsKICAgICAgICAgICAgcmV0dXJuIG5ldyBQcm9taXNlKChyZXNvbHZlOiBhbnksIHJlamVjdDogYW55KSA9PiB7CiAgICAgICAgICAgICAgICBwb3N0LnRoZW4oKHJlc3BvbnNlOiBhbnkpID0+IHsKICAgICAgICAgICAgICAgICAgICBpZiAoIXJlc3BvbnNlIHx8IHJlc3BvbnNlLnN0YXR1cyAhPT0gMjAwKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuJE5vdGljZS5lcnJvcih7IHRpdGxlOiAnJywgZGVzYzogJ+WIoOmZpOaVsOaNruWksei0pSwnICsgcmVzcG9uc2UuaW5mbyB9KTsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuJE5vdGljZS5zdWNjZXNzKHsgdGl0bGU6ICcnLCBkZXNjOiAn5Yig6Zmk5oiQ5YqfIScgfSk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIC8v5Yig6ZmkaXRlbXPkuK3lt7LliKDpmaTnmoTpobkKICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyh0aGlzLml0ZW1zKTsKICAgICAgICAgICAgICAgICAgICBfZGF0YXMuZm9yRWFjaCgoZGF0YTogYW55KSA9PiB7CiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuaXRlbXMuc29tZSgoaXRlbTphbnksaW5kZXg6bnVtYmVyKT0+ewogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYoT2JqZWN0LmlzKGl0ZW0uc3Jma2V5LGRhdGEuc3Jma2V5KSl7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5pdGVtcy5zcGxpY2UoaW5kZXgsMSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5ncmlkSXRlbXNNb2RlbC5zcGxpY2UoaW5kZXgsMSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgIHRoaXMudG90YWxyb3cgLT0gX2RhdGFzLmxlbmd0aDsKICAgICAgICAgICAgICAgICAgICB0aGlzLiRlbWl0KCdyZW1vdmUnLCBudWxsKTsKICAgICAgICAgICAgICAgICAgICB0aGlzLnNlbGVjdGlvbnMgPSBbXTsKICAgICAgICAgICAgICAgICAgICByZXNvbHZlKHJlc3BvbnNlKTsKICAgICAgICAgICAgICAgIH0pLmNhdGNoKChyZXNwb25zZTogYW55KSA9PiB7CiAgICAgICAgICAgICAgICAgICAgaWYgKHJlc3BvbnNlICYmIHJlc3BvbnNlLnN0YXR1cyA9PT0gNDAxKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgaWYgKCFyZXNwb25zZSB8fCAhcmVzcG9uc2Uuc3RhdHVzIHx8ICFyZXNwb25zZS5kYXRhKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuJE5vdGljZS5lcnJvcih7IHRpdGxlOiAn6ZSZ6K+vJywgZGVzYzogJ+ezu+e7n+W8guW4uCcgfSk7CiAgICAgICAgICAgICAgICAgICAgICAgIHJlamVjdChyZXNwb25zZSk7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgcmVqZWN0KHJlc3BvbnNlKTsKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9KTsKICAgICAgICB9CgogICAgICAgIGRhdGFJbmZvID0gZGF0YUluZm8ucmVwbGFjZSgvW251bGxdL2csICcnKS5yZXBsYWNlKC9bdW5kZWZpbmVkXS9nLCAnJyk7CiAgICAgICAgdGhpcy4kTW9kYWwuY29uZmlybSh7CiAgICAgICAgICAgIHRpdGxlOiAn6K2m5ZGKJywKICAgICAgICAgICAgY29udGVudDogJ+ehruiupOimgeWIoOmZpCAnICsgZGF0YUluZm8gKyAn77yM5Yig6Zmk5pON5L2c5bCG5LiN5Y+v5oGi5aSN77yfJywKICAgICAgICAgICAgb25PazogKCkgPT4gewogICAgICAgICAgICAgICAgcmVtb3ZlRGF0YSgpOwogICAgICAgICAgICB9LAogICAgICAgICAgICBvbkNhbmNlbDogKCkgPT4geyB9CiAgICAgICAgfSk7CiAgICAgICAgcmV0dXJuIHJlbW92ZURhdGE7CiAgICB9CgoKICAgIC8qKgogICAgICog5om56YeP5re75YqgCiAgICAgKgogICAgICogQHBhcmFtIHsqfSBbYXJnPXt9XQogICAgICogQG1lbWJlcm9mIE1haW5CYXNlCiAgICAgKi8KICAgIHB1YmxpYyBhZGRCYXRjaChhcmc6IGFueSA9IHt9KTogdm9pZCB7CiAgICAgICAgaWYoIXRoaXMuZmV0Y2hBY3Rpb24pewogICAgICAgICAgICB0aGlzLiROb3RpY2UuZXJyb3IoeyB0aXRsZTogJ+mUmeivrycsIGRlc2M6ICdUUk1UUklBTlBFUlNPTkdyaWRWaWV36KeG5Zu+6KGo5qC8ZmV0Y2hBY3Rpb27lj4LmlbDmnKrphY3nva4nIH0pOwogICAgICAgICAgICByZXR1cm47CiAgICAgICAgfQogICAgICAgIGlmKCFhcmcpewogICAgICAgICAgICBhcmcgPSB7fTsKICAgICAgICB9CiAgICAgICAgY29uc29sZS5lcnJvcigi5om56YeP5re75Yqg5pyq5a6e546wIik7CiAgICB9CgogICAgLyoqCiAgICAgKiDmlbDmja7lr7zlhaUKICAgICAqCiAgICAgKiBAcGFyYW0geyp9IGRhdGEKICAgICAqIEBtZW1iZXJvZiBNYWluQmFzZQogICAgICovCiAgICAgcHVibGljIGltcG9ydEV4Y2VsKGRhdGE6YW55ID17fSk6dm9pZHsKICAgICAgICAvL+WvvOWFpWV4Y2VsCiAgICAgICAgY29uc3QgaW1wb3J0RGF0YU1vZGVsOmFueSA9ewogICAgICAgIH0KICAgICAgICBpZihPYmplY3Qua2V5cyhpbXBvcnREYXRhTW9kZWwpLmxlbmd0aCA9PSAwKXsKICAgICAgICAgICAgdGhpcy4kTm90aWNlLndhcm5pbmcoeyAndGl0bGUnOiAodGhpcy4kdCgiYXBwLnV0aWx2aWV3Lndhcm5pbmciKSBhcyBzdHJpbmcpLCAnZGVzYyc6ICh0aGlzLiR0KCJhcHAudXRpbHZpZXcuaW5mbyIpIGFzIHN0cmluZykgfSk7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICB9CiAgICAgICAgY29uc3QgdmlldzphbnkgPXsKICAgICAgICAgICAgdmlld25hbWU6ICdhcHAtZGF0YS11cGxvYWQnLAogICAgICAgICAgICB0aXRsZTogdGhpcy4kdCgiYXBwLnV0aWx2aWV3LmltcG9ydHZpZXciKSwKICAgICAgICAgICAgd2lkdGg6IDkwMCwKICAgICAgICAgICAgaGVpZ2h0OiA3MDAKICAgICAgICB9CiAgICAgICAgbGV0IGNvbnRhaW5lcjogU3ViamVjdDxhbnk+ID0gdGhpcy4kYXBwbW9kYWwub3Blbk1vZGFsKHZpZXcsIEpTT04ucGFyc2UoSlNPTi5zdHJpbmdpZnkodGhpcy5jb250ZXh0KSksIGltcG9ydERhdGFNb2RlbCk7CiAgICAgICAgY29udGFpbmVyLnN1YnNjcmliZSgocmVzdWx0OiBhbnkpID0+IHsKICAgICAgICAgIGlmKE9iamVjdC5pcyhyZXN1bHQucmV0LCdPSycpKXsKICAgICAgICAgICAgdGhpcy5yZWZyZXNoKHJlc3VsdC5kYXRhcyk7CiAgICAgICAgICB9CiAgICAgIH0pOwogICAgfQoKCiAgICAvKioKICAgICAqIOaVsOaNruWvvOWHugogICAgICoKICAgICAqIEBwYXJhbSB7Kn0gZGF0YQogICAgICogQG1lbWJlcm9mIE1haW5CYXNlCiAgICAgKi8KICAgIHB1YmxpYyBleHBvcnRFeGNlbChkYXRhOiBhbnkgPSB7fSk6IHZvaWQgewogICAgICAgIC8vIOWvvOWHukV4Y2VsCiAgICAgICAgY29uc3QgZG9FeHBvcnQgPSBhc3luYyAoX2RhdGE6YW55KSA9PiB7CiAgICAgICAgICAgIGNvbnN0IHRIZWFkZXI6IEFycmF5PGFueT4gPSBbXTsKICAgICAgICAgICAgY29uc3QgZmlsdGVyVmFsOiBBcnJheTxhbnk+ID0gW107CiAgICAgICAgICAgIHRoaXMuYWxsQ29sdW1ucy5mb3JFYWNoKChpdGVtOiBhbnkpID0+IHsKICAgICAgICAgICAgICBpdGVtLnNob3cgJiYgaXRlbS5sYWJlbCA/IHRIZWFkZXIucHVzaCh0aGlzLiR0KGl0ZW0ubGFuZ3RhZykpIDogIiI7CiAgICAgICAgICAgICAgaXRlbS5zaG93ICYmIGl0ZW0ubmFtZSA/IGZpbHRlclZhbC5wdXNoKGl0ZW0ubmFtZSkgOiAiIjsKICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIGNvbnN0IGRhdGEgPSBhd2FpdCB0aGlzLmZvcm1hdEV4Y2VsRGF0YShmaWx0ZXJWYWwsIF9kYXRhKTsKICAgICAgICAgICAgdGhpcy4kZXhwb3J0LmV4cG9ydEV4Y2VsKCkudGhlbigoZXhjZWw6YW55KT0+ewogICAgICAgICAgICAgICAgZXhjZWwuZXhwb3J0X2pzb25fdG9fZXhjZWwoewogICAgICAgICAgICAgICAgICBoZWFkZXI6IHRIZWFkZXIsIC8v6KGo5aS0IOW/heWhqwogICAgICAgICAgICAgICAgICBkYXRhLCAvL+WFt+S9k+aVsOaNriDlv4XloasKICAgICAgICAgICAgICAgICAgZmlsZW5hbWU6ICLln7norq3orrDlvZXooagiLCAvL+mdnuW/heWhqwogICAgICAgICAgICAgICAgICBhdXRvV2lkdGg6IHRydWUsIC8v6Z2e5b+F5aGrCiAgICAgICAgICAgICAgICAgIGJvb2tUeXBlOiAieGxzeCIgLy/pnZ7lv4XloasKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9KTsgCiAgICAgICAgfTsKICAgICAgICBjb25zdCBwYWdlOiBhbnkgPSB7fTsKICAgICAgICAvLyDorr7nva5wYWdl77yMc2l6ZQogICAgICAgIGlmIChPYmplY3QuaXMoZGF0YS50eXBlLCAnbWF4Um93Q291bnQnKSkgewogICAgICAgICAgICBPYmplY3QuYXNzaWduKHBhZ2UsIHsgcGFnZTogMCwgc2l6ZTogZGF0YS5tYXhSb3dDb3VudCB9KTsKICAgICAgICB9IGVsc2UgaWYgKE9iamVjdC5pcyhkYXRhLnR5cGUsICdhY3RpdmF0ZWRQYWdlJykpIHsKICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgIGRvRXhwb3J0KEpTT04ucGFyc2UoSlNPTi5zdHJpbmdpZnkodGhpcy5pdGVtcykpKTsKICAgICAgICAgICAgfSBjYXRjaCAoZXJyb3IpIHsKICAgICAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoZXJyb3IpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICB9CiAgICAgICAgLy8g6K6+572u5o6S5bqPCiAgICAgICAgaWYgKCF0aGlzLmlzTm9Tb3J0ICYmICFPYmplY3QuaXModGhpcy5taW5vclNvcnREaXIsICcnKSAmJiAhT2JqZWN0LmlzKHRoaXMubWlub3JTb3J0UFNERUYsICcnKSkgewogICAgICAgICAgY29uc3Qgc29ydDogc3RyaW5nID0gdGhpcy5taW5vclNvcnRQU0RFRisiLCIrdGhpcy5taW5vclNvcnREaXI7CiAgICAgICAgICAgIE9iamVjdC5hc3NpZ24ocGFnZSwgeyBzb3J0OiBzb3J0IH0pOwogICAgICAgIH0KICAgICAgICBjb25zdCBhcmc6IGFueSA9IHt9OwogICAgICAgIE9iamVjdC5hc3NpZ24oYXJnLCBwYWdlKTsKICAgICAgICAvLyDojrflj5ZxdWVyeSzmkJzntKLooajljZXvvIx2aWV3cGFyYW1z562J54i25pWw5o2uCiAgICAgICAgY29uc3QgcGFyZW50ZGF0YTogYW55ID0ge307CiAgICAgICAgdGhpcy4kZW1pdCgnYmVmb3JlbG9hZCcsIHBhcmVudGRhdGEpOwogICAgICAgIE9iamVjdC5hc3NpZ24oYXJnLCBwYXJlbnRkYXRhKTsKICAgICAgICBjb25zdCBwb3N0OiBQcm9taXNlPGFueT4gPSB0aGlzLnNlcnZpY2Uuc2VhcmNoKHRoaXMuZmV0Y2hBY3Rpb24sSlNPTi5wYXJzZShKU09OLnN0cmluZ2lmeSh0aGlzLmNvbnRleHQpKSwgYXJnLCB0aGlzLnNob3dCdXN5SW5kaWNhdG9yKTsKICAgICAgICBwb3N0LnRoZW4oKHJlc3BvbnNlOiBhbnkpID0+IHsKICAgICAgICAgICAgaWYgKCFyZXNwb25zZSB8fCByZXNwb25zZS5zdGF0dXMgIT09IDIwMCkgewogICAgICAgICAgICAgICAgdGhpcy4kTm90aWNlLmVycm9yKHsgdGl0bGU6ICcnLCBkZXNjOiAn5pWw5o2u5a+85Ye65aSx6LSlLCcgKyByZXNwb25zZS5pbmZvIH0pOwogICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICBkb0V4cG9ydChKU09OLnBhcnNlKEpTT04uc3RyaW5naWZ5KHJlc3BvbnNlLmRhdGEpKSk7CiAgICAgICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7CiAgICAgICAgICAgICAgICBjb25zb2xlLmVycm9yKGVycm9yKTsKICAgICAgICAgICAgfQogICAgICAgIH0pLmNhdGNoKChyZXNwb25zZTogYW55KSA9PiB7CiAgICAgICAgICAgIGlmIChyZXNwb25zZSAmJiByZXNwb25zZS5zdGF0dXMgPT09IDQwMSkgewogICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHRoaXMuJE5vdGljZS5lcnJvcih7IHRpdGxlOiAnJywgZGVzYzogJ+aVsOaNruWvvOWHuuWksei0pScgfSk7CiAgICAgICAgfSk7CiAgICB9CgoKICAgIC8qKgogICAgICog5a+85Ye65pWw5o2u5qC85byP5YyWCiAgICAgKiAKICAgICAqIEBwYXJhbSB7Kn0gZmlsdGVyVmFsCiAgICAgKiBAcGFyYW0geyp9IGpzb25EYXRhCiAgICAgKiBAcmV0dXJucyB7W119CiAgICAgKiBAbWVtYmVyb2YgTWFpbkJhc2UKICAgICAqLwogICAgcHVibGljIGFzeW5jIGZvcm1hdEV4Y2VsRGF0YShmaWx0ZXJWYWw6YW55LCBqc29uRGF0YTphbnkpIHsKICAgICAgICBsZXQgY29kZWxpc3RDb2x1bW5zOkFycmF5PGFueT4gPSBbCiAgICAgICAgXTsKICAgICAgICBsZXQgX3RoaXMgPSB0aGlzOwogICAgICAgIGZvciAoY29uc3QgY29kZWxpc3Qgb2YgY29kZWxpc3RDb2x1bW5zKSB7CiAgICAgICAgICAvLyDliqjmgIHku6PnoIHooajlpITnkIYKICAgICAgICAgIGlmIChPYmplY3QuaXMoY29kZWxpc3QuY29kZWxpc3RUeXBlLCAiRFlOQU1JQyIpKSB7CiAgICAgICAgICAgICAgbGV0IGl0ZW1zID0gYXdhaXQgX3RoaXMuY29kZUxpc3RTZXJ2aWNlLmdldEl0ZW1zKGNvZGVsaXN0LnNyZmtleSk7CiAgICAgICAgICAgICAganNvbkRhdGEuZm9yRWFjaCgocm93OmFueSk9PnsKICAgICAgICAgICAgICAgICAgcm93W2NvZGVsaXN0Lm5hbWVdID0gX3RoaXMuZ2V0Q29kZWxpc3RWYWx1ZShpdGVtcywgcm93W2NvZGVsaXN0Lm5hbWVdLCBjb2RlbGlzdCk7CiAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAvLyDpnZnmgIHlpITnkIYKICAgICAgICAgIH0gZWxzZSBpZihPYmplY3QuaXMoY29kZWxpc3QuY29kZWxpc3RUeXBlLCAiU1RBVElDIikpewogICAgICAgICAgICAgIGxldCBpdGVtcyA9IGF3YWl0IF90aGlzLiRzdG9yZS5nZXR0ZXJzLmdldENvZGVMaXN0SXRlbXMoY29kZWxpc3Quc3Jma2V5KTsKICAgICAgICAgICAgICBqc29uRGF0YS5mb3JFYWNoKChyb3c6YW55KT0+ewogICAgICAgICAgICAgICAgICByb3dbY29kZWxpc3QubmFtZV0gPSBfdGhpcy5nZXRDb2RlbGlzdFZhbHVlKGl0ZW1zLCByb3dbY29kZWxpc3QubmFtZV0sIGNvZGVsaXN0KTsKICAgICAgICAgICAgICB9KTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgcmV0dXJuIGpzb25EYXRhLm1hcCgodjphbnkpID0+IGZpbHRlclZhbC5tYXAoKGo6YW55KSA9PiB2W2pdKSkKICAgIH0gICAKCgogICAgLyoqCiAgICAgKiDop6PmnpDku6PnoIHooajlkox2bGF1Ze+8jOiuvue9rml0ZW1zCiAgICAgKgogICAgICogQHB1YmxpYwogICAgICogQHBhcmFtIHthbnlbXX0gaXRlbXMg5Luj56CB6KGo5pWw5o2uCiAgICAgKiBAcGFyYW0geyp9IHZhbHVlCiAgICAgKiBAcmV0dXJucyB7Kn0KICAgICAqIEBtZW1iZXJvZiBNYWluQmFzZQogICAgICovCiAgICBwdWJsaWMgZ2V0Q29kZWxpc3RWYWx1ZShpdGVtczogYW55W10sIHZhbHVlOiBhbnksIGNvZGVsaXN0OiBhbnksKXsKICAgICAgICBpZighdmFsdWUpewogICAgICAgICAgICByZXR1cm4gdGhpcy4kdCgnY29kZWxpc3QuJytjb2RlbGlzdC5zcmZrZXkrJy5lbXB0eScpOwogICAgICAgIH0KICAgICAgICBpZiAoaXRlbXMpIHsKICAgICAgICAgICAgbGV0IHJlc3VsdDphbnkgPSBbXTsKICAgICAgICAgICAgaWYoT2JqZWN0LmlzKGNvZGVsaXN0LnJlbmRlck1vZGUsIm51bWJlciIpKXsKICAgICAgICAgICAgICAgIGl0ZW1zLm1hcCgoX2l0ZW06IGFueSwgaW5kZXg6IG51bWJlcik9PnsKICAgICAgICAgICAgICAgICAgICBjb25zdCBuVmFsdWUgPSBwYXJzZUludCgodmFsdWUgYXMgYW55KSwgMTApOwogICAgICAgICAgICAgICAgICAgIGNvbnN0IGNvZGV2YWx1ZSA9IF9pdGVtLnZhbHVlOwogICAgICAgICAgICAgICAgICAgIGlmKChwYXJzZUludChjb2RldmFsdWUsIDEwKSAmIG5WYWx1ZSkgPiAwKXsKICAgICAgICAgICAgICAgICAgICAgICAgcmVzdWx0LnB1c2goX2l0ZW0pOwogICAgICAgICAgICAgICAgICAgIH0gCiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfSBlbHNlIGlmKE9iamVjdC5pcyhjb2RlbGlzdC5yZW5kZXJNb2RlLCJzdHJpbmciKSl7CiAgICAgICAgICAgICAgICBjb25zdCBhcnJheVZhbHVlOiBBcnJheTxhbnk+ID0gKHZhbHVlIGFzIGFueSkuc3BsaXQoY29kZWxpc3QudmFsdWVTZXBhcmF0b3IpOwogICAgICAgICAgICAgICAgYXJyYXlWYWx1ZS5tYXAoKHZhbHVlOiBhbnksIGluZGV4OiBudW1iZXIpID0+IHsKICAgICAgICAgICAgICAgICAgICByZXN1bHQucHVzaChbXSk7CiAgICAgICAgICAgICAgICAgICAgbGV0IHZhbHVlczogYW55W10gPSBPYmplY3QuaXModGhpcy4kdXRpbC50eXBlT2YodmFsdWUpLCAnbnVtYmVyJykgPyBbdmFsdWVdIDogWy4uLih2YWx1ZSBhcyBhbnkpLnNwbGl0KGNvZGVsaXN0LnZhbHVlU2VwYXJhdG9yKV07CiAgICAgICAgICAgICAgICAgICAgdmFsdWVzLm1hcCgodmFsOmFueSAsbnVtOiBudW1iZXIpPT57CiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGl0ZW0gPSB0aGlzLmdldEl0ZW0oaXRlbXMsIHZhbCwgY29kZWxpc3QpOyAKICAgICAgICAgICAgICAgICAgICAgICAgaWYoaXRlbSl7CiAgICAgICAgICAgICAgICAgICAgICAgICAgcmVzdWx0W2luZGV4XS5wdXNoKGl0ZW0pOwogICAgICAgICAgICAgICAgICAgICAgICB9IAogICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBsZXQgdmFsdWVzOiBhbnlbXSA9IE9iamVjdC5pcyh0aGlzLiR1dGlsLnR5cGVPZih2YWx1ZSksICdudW1iZXInKSA/IFt2YWx1ZV0gOiBbLi4uKHZhbHVlIGFzIGFueSkuc3BsaXQoY29kZWxpc3QudmFsdWVTZXBhcmF0b3IpXTsKICAgICAgICAgICAgICAgIHZhbHVlcy5tYXAoKHZhbHVlOmFueSAsaW5kZXg6IG51bWJlcik9PnsKICAgICAgICAgICAgICAgICAgICBjb25zdCBpdGVtID0gdGhpcy5nZXRJdGVtKGl0ZW1zLCB2YWx1ZSwgY29kZWxpc3QpOyAKICAgICAgICAgICAgICAgICAgICBpZihpdGVtKXsKICAgICAgICAgICAgICAgICAgICAgIHJlc3VsdC5wdXNoKGl0ZW0pOwogICAgICAgICAgICAgICAgICAgIH0gCiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfQogICAgICAgICAgICAvLyDorr7nva5pdGVtcwogICAgICAgICAgICBpZihyZXN1bHQubGVuZ3RoICE9IDApewogICAgICAgICAgICAgIHJldHVybiByZXN1bHQuam9pbihjb2RlbGlzdC52YWx1ZVNlcGFyYXRvcik7CiAgICAgICAgICAgIH1lbHNlewogICAgICAgICAgICAgIHJldHVybiB2YWx1ZTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIOiOt+WPluS7o+eggemhuQogICAgICoKICAgICAqIEBwdWJsaWMKICAgICAqIEBwYXJhbSB7YW55W119IGl0ZW1zCiAgICAgKiBAcGFyYW0geyp9IHZhbHVlCiAgICAgKiBAcmV0dXJucyB7Kn0KICAgICAqIEBtZW1iZXJvZiBNYWluQmFzZQogICAgICovCiAgICBwdWJsaWMgZ2V0SXRlbShpdGVtczogYW55W10sIHZhbHVlOiBhbnksIGNvZGVsaXN0OiBhbnkpOiBhbnkgewogICAgICAgIGNvbnN0IGFycjogQXJyYXk8YW55PiA9IGl0ZW1zLmZpbHRlcihpdGVtID0+IHtyZXR1cm4gaXRlbS52YWx1ZSA9PSB2YWx1ZX0pOwogICAgICAgIGlmIChhcnIubGVuZ3RoICE9PSAxKSB7CiAgICAgICAgICAgIHJldHVybiB1bmRlZmluZWQ7CiAgICAgICAgfQogICAgICAgIGlmKE9iamVjdC5pcyhjb2RlbGlzdC5jb2RlbGlzdFR5cGUsJ1NUQVRJQycpKXsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuJHQoJ2NvZGVsaXN0LicrY29kZWxpc3Quc3Jma2V5KycuJythcnJbMF0udmFsdWUpOwogICAgICAgIH1lbHNlewogICAgICAgICAgICByZXR1cm4gYXJyWzBdLnRleHQ7CiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICog55Sf5ZG95ZGo5pyfCiAgICAgKgogICAgICogQG1lbWJlcm9mIE1haW5CYXNlCiAgICAgKi8KICAgIHB1YmxpYyBjcmVhdGVkKCk6IHZvaWQgewogICAgICAgIHRoaXMuYWZ0ZXJDcmVhdGVkKCk7CiAgICB9CgogICAgLyoqCiAgICAgKiDmiafooYxjcmVhdGVk5ZCO55qE6YC76L6RCiAgICAgKgogICAgICogIEBtZW1iZXJvZiBNYWluQmFzZQogICAgICovICAgIAogICAgcHVibGljIGFmdGVyQ3JlYXRlZCgpewogICAgICAgIHRoaXMuc2V0Q29sU3RhdGUoKTsKICAgICAgICBpZiAodGhpcy52aWV3U3RhdGUpIHsKICAgICAgICAgICAgdGhpcy52aWV3U3RhdGVFdmVudCA9IHRoaXMudmlld1N0YXRlLnN1YnNjcmliZSgoeyB0YWcsIGFjdGlvbiwgZGF0YSB9KSA9PiB7CiAgICAgICAgICAgICAgICBpZiAoIU9iamVjdC5pcyh0YWcsIHRoaXMubmFtZSkpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBpZiAoT2JqZWN0LmlzKCdsb2FkJywgYWN0aW9uKSkgewogICAgICAgICAgICAgICAgICAgIHRoaXMubG9hZChkYXRhKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGlmIChPYmplY3QuaXMoJ3JlbW92ZScsIGFjdGlvbikpIHsKICAgICAgICAgICAgICAgICAgICB0aGlzLnJlbW92ZShkYXRhKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGlmIChPYmplY3QuaXMoJ3NhdmUnLCBhY3Rpb24pKSB7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5zYXZlKGRhdGEpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9KTsKICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiB2dWUg55Sf5ZG95ZGo5pyfCiAgICAgKgogICAgICogQG1lbWJlcm9mIE1haW5CYXNlCiAgICAgKi8KICAgIHB1YmxpYyBkZXN0cm95ZWQoKSB7CiAgICAgICAgdGhpcy5hZnRlckRlc3Ryb3koKTsKICAgIH0KCiAgICAvKioKICAgICAqIOaJp+ihjGRlc3Ryb3llZOWQjueahOmAu+i+kQogICAgICoKICAgICAqIEBtZW1iZXJvZiBNYWluQmFzZQogICAgICovCiAgICBwdWJsaWMgYWZ0ZXJEZXN0cm95KCkgewogICAgICAgIGlmICh0aGlzLnZpZXdTdGF0ZUV2ZW50KSB7CiAgICAgICAgICAgIHRoaXMudmlld1N0YXRlRXZlbnQudW5zdWJzY3JpYmUoKTsKICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiDojrflj5bpgInkuK3ooYzog6HmlbDmja4KICAgICAqCiAgICAgKiBAcmV0dXJucyB7YW55W119CiAgICAgKiBAbWVtYmVyb2YgTWFpbkJhc2UKICAgICAqLwogICAgcHVibGljIGdldFNlbGVjdGlvbigpOiBhbnlbXSB7CiAgICAgICAgcmV0dXJuIHRoaXMuc2VsZWN0aW9uczsKICAgIH0KCiAgICAvKioKICAgICAqIOihjOWPjOWHu+S6i+S7tgogICAgICoKICAgICAqIEBwYXJhbSB7Kn0gJGV2ZW50CiAgICAgKiBAcmV0dXJucyB7dm9pZH0KICAgICAqIEBtZW1iZXJvZiBNYWluQmFzZQogICAgICovCiAgICBwdWJsaWMgcm93REJMQ2xpY2soJGV2ZW50OiBhbnkpOiB2b2lkIHsKICAgICAgICBpZiAoISRldmVudCB8fCB0aGlzLmFjdHVhbElzT3BlbkVkaXQgfHwgT2JqZWN0LmlzKHRoaXMuZ3JpZFJvd0FjdGl2ZU1vZGUsMCkpIHsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KICAgICAgICB0aGlzLnNlbGVjdGlvbnMgPSBbXTsKICAgICAgICB0aGlzLnNlbGVjdGlvbnMucHVzaChKU09OLnBhcnNlKEpTT04uc3RyaW5naWZ5KCRldmVudCkpKTsKCiAgICAgICAgY29uc3QgcmVmczogYW55ID0gdGhpcy4kcmVmczsKICAgICAgICBpZiAocmVmcy5tdWx0aXBsZVRhYmxlKSB7CiAgICAgICAgICAgIHJlZnMubXVsdGlwbGVUYWJsZS5jbGVhclNlbGVjdGlvbigpOwogICAgICAgICAgICByZWZzLm11bHRpcGxlVGFibGUudG9nZ2xlUm93U2VsZWN0aW9uKCRldmVudCk7CiAgICAgICAgfQoKICAgICAgICB0aGlzLiRlbWl0KCdyb3dkYmxjbGljaycsIHRoaXMuc2VsZWN0aW9ucyk7CiAgICAgICAgdGhpcy4kZW1pdCgnc2VsZWN0aW9uY2hhbmdlJywgdGhpcy5zZWxlY3Rpb25zKTsKICAgIH0KCiAgICAvKioKICAgICAqIOWkjemAieahhuaVsOaNrumAieS4rQogICAgICoKICAgICAqIEBwYXJhbSB7Kn0gJGV2ZW50CiAgICAgKiBAcmV0dXJucyB7dm9pZH0KICAgICAqIEBtZW1iZXJvZiBNYWluQmFzZQogICAgICovCiAgICBwdWJsaWMgc2VsZWN0KCRldmVudDogYW55KTogdm9pZCB7CiAgICAgICAgaWYgKCEkZXZlbnQpIHsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KICAgICAgICB0aGlzLnNlbGVjdGlvbnMgPSBbXTsKICAgICAgICB0aGlzLnNlbGVjdGlvbnMgPSBbLi4uSlNPTi5wYXJzZShKU09OLnN0cmluZ2lmeSgkZXZlbnQpKV07CiAgICAgICAgdGhpcy4kZW1pdCgnc2VsZWN0aW9uY2hhbmdlJywgdGhpcy5zZWxlY3Rpb25zKTsKICAgIH0KCiAgICAvKioKICAgICAqIOWkjemAieahhuaVsOaNruWFqOmDqOmAieS4rQogICAgICoKICAgICAqIEBwYXJhbSB7Kn0gJGV2ZW50CiAgICAgKiBAbWVtYmVyb2YgTWFpbkJhc2UKICAgICAqLwogICAgcHVibGljIHNlbGVjdEFsbCgkZXZlbnQ6IGFueSk6IHZvaWQgewogICAgICAgIGlmICghJGV2ZW50KSB7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICB9CiAgICAgICAgdGhpcy5zZWxlY3Rpb25zID0gW107CiAgICAgICAgdGhpcy5zZWxlY3Rpb25zID0gWy4uLkpTT04ucGFyc2UoSlNPTi5zdHJpbmdpZnkoJGV2ZW50KSldOwogICAgICAgIHRoaXMuJGVtaXQoJ3NlbGVjdGlvbmNoYW5nZScsIHRoaXMuc2VsZWN0aW9ucyk7CiAgICB9CgogICAgCiAgICAvKioKICAgICAqIOihjOWNleWHu+mAieS4rQogICAgICoKICAgICAqIEBwYXJhbSB7Kn0gJGV2ZW50CiAgICAgKiBAcmV0dXJucyB7dm9pZH0KICAgICAqIEBtZW1iZXJvZiBNYWluQmFzZQogICAgICovCiAgICBwdWJsaWMgcm93Q2xpY2soJGV2ZW50OiBhbnksIGlmQWx3YXlzOiBib29sZWFuID0gZmFsc2UpOiB2b2lkIHsKICAgICAgICBpZiAoIWlmQWx3YXlzICYmICghJGV2ZW50IHx8IHRoaXMuYWN0dWFsSXNPcGVuRWRpdCkpIHsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KICAgICAgICBpZih0aGlzLnN0b3BSb3dDbGljaykgewogICAgICAgICAgICB0aGlzLnN0b3BSb3dDbGljayA9IGZhbHNlOwogICAgICAgICAgICByZXR1cm47CiAgICAgICAgfQogICAgICAgIGlmKHRoaXMuaXNTaW5nbGVTZWxlY3QpewogICAgICAgICAgICB0aGlzLnNlbGVjdGlvbnMgPSBbXTsKICAgICAgICB9CiAgICAgICAgLy8g5bey6YCJ5Lit5YiZ5Yig6Zmk77yM5rKh6YCJ5Lit5YiZ5re75YqgCiAgICAgICAgbGV0IHNlbGVjdEluZGV4ID0gdGhpcy5zZWxlY3Rpb25zLmZpbmRJbmRleCgoaXRlbTphbnkpPT57CiAgICAgICAgICAgIHJldHVybiBPYmplY3QuaXMoaXRlbS50cm10cmlhbnBlcnNvbiwkZXZlbnQudHJtdHJpYW5wZXJzb24pOwogICAgICAgIH0pOwogICAgICAgIGlmIChPYmplY3QuaXMoc2VsZWN0SW5kZXgsLTEpKXsKICAgICAgICAgIHRoaXMuc2VsZWN0aW9ucy5wdXNoKEpTT04ucGFyc2UoSlNPTi5zdHJpbmdpZnkoJGV2ZW50KSkpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICB0aGlzLnNlbGVjdGlvbnMuc3BsaWNlKHNlbGVjdEluZGV4LDEpOwogICAgICAgIH0KCiAgICAgICAgY29uc3QgcmVmczogYW55ID0gdGhpcy4kcmVmczsKICAgICAgICBpZiAocmVmcy5tdWx0aXBsZVRhYmxlKSB7CiAgICAgICAgICAgIGlmKHRoaXMuaXNTaW5nbGVTZWxlY3QpewogICAgICAgICAgICAgICAgcmVmcy5tdWx0aXBsZVRhYmxlLmNsZWFyU2VsZWN0aW9uKCk7CiAgICAgICAgICAgICAgICByZWZzLm11bHRpcGxlVGFibGUuc2V0Q3VycmVudFJvdygkZXZlbnQpOwogICAgICAgICAgICB9ZWxzZXsKICAgICAgICAgICAgICAgIHJlZnMubXVsdGlwbGVUYWJsZS50b2dnbGVSb3dTZWxlY3Rpb24oJGV2ZW50KTsgCiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIHRoaXMuJGVtaXQoJ3NlbGVjdGlvbmNoYW5nZScsIHRoaXMuc2VsZWN0aW9ucyk7CiAgICB9CgoKICAgIC8qKgogICAgICog6aG16Z2i5Y+Y5YyWCiAgICAgKgogICAgICogQHBhcmFtIHsqfSAkZXZlbnQKICAgICAqIEByZXR1cm5zIHt2b2lkfQogICAgICogQG1lbWJlcm9mIE1haW5CYXNlCiAgICAgKi8KICAgIHB1YmxpYyBwYWdlT25DaGFuZ2UoJGV2ZW50OiBhbnkpOiB2b2lkIHsKICAgICAgICBpZiAoISRldmVudCkgewogICAgICAgICAgICByZXR1cm47CiAgICAgICAgfQogICAgICAgIGlmICgkZXZlbnQgPT09IHRoaXMuY3VyUGFnZSkgewogICAgICAgICAgICByZXR1cm47CiAgICAgICAgfQogICAgICAgIHRoaXMuY3VyUGFnZSA9ICRldmVudDsKICAgICAgICB0aGlzLmxvYWQoe30pOwogICAgfQoKICAgIC8qKgogICAgICog5YiG6aG15p2h5pWw5Y+Y5YyWCiAgICAgKgogICAgICogQHBhcmFtIHsqfSAkZXZlbnQKICAgICAqIEByZXR1cm5zIHt2b2lkfQogICAgICogQG1lbWJlcm9mIE1haW5CYXNlCiAgICAgKi8KICAgIHB1YmxpYyBvblBhZ2VTaXplQ2hhbmdlKCRldmVudDogYW55KTogdm9pZCB7CiAgICAgICAgaWYgKCEkZXZlbnQpIHsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KICAgICAgICBpZiAoJGV2ZW50ID09PSB0aGlzLmxpbWl0KSB7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICB9CiAgICAgICAgdGhpcy5saW1pdCA9ICRldmVudDsKICAgICAgICBpZiAodGhpcy5jdXJQYWdlID09PSAxKSB7CiAgICAgICAgICAgIHRoaXMubG9hZCh7fSk7CiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICog5YiG6aG15Yi35pawCiAgICAgKgogICAgICogQG1lbWJlcm9mIE1haW5CYXNlCiAgICAgKi8KICAgIHB1YmxpYyBwYWdlUmVmcmVzaCgpOiB2b2lkIHsKICAgICAgICB0aGlzLmxvYWQoe30pOwogICAgfQoKICAgIC8qKgogICAgICog5o6S5bqP5Y+Y5YyWCiAgICAgKgogICAgICogQHBhcmFtIHt7IGNvbHVtbjogYW55LCBwcm9wOiBhbnksIG9yZGVyOiBhbnkgfX0geyBjb2x1bW4sIHByb3AsIG9yZGVyIH0KICAgICAqIEBtZW1iZXJvZiBNYWluQmFzZQogICAgICovCiAgICBwdWJsaWMgb25Tb3J0Q2hhbmdlKHsgY29sdW1uLCBwcm9wLCBvcmRlciB9OiB7IGNvbHVtbjogYW55LCBwcm9wOiBhbnksIG9yZGVyOiBhbnkgfSk6IHZvaWQgewogICAgICAgIGNvbnN0IGRpciA9IE9iamVjdC5pcyhvcmRlciwgJ2FzY2VuZGluZycpID8gJ2FzYycgOiBPYmplY3QuaXMob3JkZXIsICdkZXNjZW5kaW5nJykgPyAnZGVzYycgOiAnJzsKICAgICAgICBpZiAoT2JqZWN0LmlzKGRpciwgdGhpcy5taW5vclNvcnREaXIpICYmIE9iamVjdC5pcyh0aGlzLm1pbm9yU29ydFBTREVGLCBwcm9wKSkgewogICAgICAgICAgICByZXR1cm47CiAgICAgICAgfQogICAgICAgIHRoaXMubWlub3JTb3J0RGlyID0gZGlyOwogICAgICAgIHRoaXMubWlub3JTb3J0UFNERUYgPSBwcm9wID8gcHJvcCA6ICcnOwogICAgICAgIHRoaXMubG9hZCh7fSk7CiAgICB9CgogICAgLyoqCiAgICAgKiDooajmoLzooYzpgInkuK3moLflvI8KICAgICAqCiAgICAgKiBAcGFyYW0ge3sgcm93OiBhbnksIHJvd0luZGV4OiBhbnkgfX0geyByb3csIHJvd0luZGV4IH0KICAgICAqIEByZXR1cm5zIHtzdHJpbmd9CiAgICAgKiBAbWVtYmVyb2YgTWFpbkJhc2UKICAgICAqLwogICAgcHVibGljIG9uUm93Q2xhc3NOYW1lKHsgcm93LCByb3dJbmRleCB9OiB7IHJvdzogYW55LCByb3dJbmRleDogYW55IH0pOiBzdHJpbmcgewogICAgICAgIGNvbnN0IGluZGV4ID0gdGhpcy5zZWxlY3Rpb25zLmZpbmRJbmRleCgoc2VsZWN0OiBhbnkpID0+IE9iamVjdC5pcyhzZWxlY3Quc3Jma2V5LCByb3cuc3Jma2V5KSk7CiAgICAgICAgcmV0dXJuIGluZGV4ICE9PSAtMSA/ICdncmlkLXJvdy1zZWxlY3QnIDogJyc7CiAgICB9CgoKCiAgICAvKioKICAgICAqIOeVjOmdouihjOS4ugogICAgICoKICAgICAqIEBwYXJhbSB7Kn0gcm93CiAgICAgKiBAcGFyYW0geyp9IHRhZwogICAgICogQHBhcmFtIHsqfSAkZXZlbnQKICAgICAqIEBtZW1iZXJvZiBNYWluQmFzZQogICAgICovCglwdWJsaWMgdWlBY3Rpb24ocm93OiBhbnksIHRhZzogYW55LCAkZXZlbnQ6IGFueSkgewogICAgICAgIC8vIHRoaXMucm93Q2xpY2socm93LCB0cnVlKTsKICAgICAgICAkZXZlbnQuc3RvcFByb3BhZ2F0aW9uKCk7CiAgICB9CgogICAgLyoqCiAgICAgKiDorr7nva7liJfnirbmgIEKICAgICAqCiAgICAgKiBAbWVtYmVyb2YgTWFpbkJhc2UKICAgICAqLwogICAgcHVibGljIHNldENvbFN0YXRlKCkgewoJCWNvbnN0IF9kYXRhOiBhbnkgPSBsb2NhbFN0b3JhZ2UuZ2V0SXRlbSgndHJtdHJpYW5wZXJzb25fbWFpbl9ncmlkJyk7CgkJaWYgKF9kYXRhKSB7CgkJCWxldCBjb2x1bW5zID0gSlNPTi5wYXJzZShfZGF0YSk7CgkJCWNvbHVtbnMuZm9yRWFjaCgoY29sOiBhbnkpID0+IHsKCQkJCWxldCBjb2x1bW4gPSB0aGlzLmFsbENvbHVtbnMuZmluZCgoaXRlbSkgPT4gT2JqZWN0LmlzKGNvbC5uYW1lLCBpdGVtLm5hbWUpKTsKCQkJCWlmIChjb2x1bW4pIHsKCQkJCQlPYmplY3QuYXNzaWduKGNvbHVtbiwgY29sKTsKCQkJCX0KCQkJfSk7CgkJfQogICAgfQoKICAgIC8qKgogICAgICog5YiX5Y+Y5YyWCiAgICAgKgogICAgICogQG1lbWJlcm9mIE1haW5CYXNlCiAgICAgKi8KICAgIHB1YmxpYyBvbkNvbENoYW5nZSgpIHsKICAgICAgICBsb2NhbFN0b3JhZ2Uuc2V0SXRlbSgndHJtdHJpYW5wZXJzb25fbWFpbl9ncmlkJywgSlNPTi5zdHJpbmdpZnkodGhpcy5hbGxDb2x1bW5zKSk7CiAgICB9CgogICAgLyoqCiAgICAgKiDojrflj5bliJfnirbmgIEKICAgICAqCiAgICAgKiBAcGFyYW0ge3N0cmluZ30gbmFtZQogICAgICogQHJldHVybnMge2Jvb2xlYW59CiAgICAgKiBAbWVtYmVyb2YgTWFpbkJhc2UKICAgICAqLwogICAgcHVibGljIGdldENvbHVtblN0YXRlKG5hbWU6IHN0cmluZyk6IGJvb2xlYW4gewogICAgICAgIGxldCBjb2x1bW4gPSB0aGlzLmFsbENvbHVtbnMuZmluZCgoY29sOiBhbnkpID0+CiAgICAgICAgICAgIE9iamVjdC5pcyhuYW1lLCBjb2wubmFtZSkKICAgICAgICApOwogICAgICAgIHJldHVybiBjb2x1bW4uc2hvdyA/IHRydWUgOiBmYWxzZTsKICAgIH0KCiAgICAvKioKICAgICAqIOihqOagvOWIl+aYr+WQpuiHqumAguW6lOW4g+WxgAogICAgICoKICAgICAqIEByZWFkb25seQogICAgICogQHR5cGUge2Jvb2xlYW59CiAgICAgKiBAbWVtYmVyb2YgTWFpbkJhc2UKICAgICAqLwogICAgZ2V0IGFkYXB0aXZlU3RhdGUoKTogYm9vbGVhbiB7CiAgICAgICAgcmV0dXJuICF0aGlzLmFsbENvbHVtbnMuZmluZCgoY29sdW1uOiBhbnkpID0+IGNvbHVtbi5zaG93ICYmIE9iamVjdC5pcyhjb2x1bW4udXRpbCwgJ1NUQVInKSk7CiAgICB9CgogICAgLyoqCiAgICAgKiDkv53lrZgKICAgICAqCiAgICAgKiBAcGFyYW0geyp9ICRldmVudAogICAgICogQHJldHVybnMge1Byb21pc2U8YW55Pn0KICAgICAqIEBtZW1iZXJvZiBNYWluQmFzZQogICAgICovCiAgICBwdWJsaWMgYXN5bmMgc2F2ZShhcmdzOiBhbnlbXSwgcGFyYW1zPzogYW55LCAkZXZlbnQ/OiBhbnksIHhEYXRhPzogYW55KXsKICAgICAgICBsZXQgX3RoaXMgPSB0aGlzOwogICAgICAgIGlmKCFhd2FpdCB0aGlzLnZhbGlkYXRlQWxsKCkpewogICAgICAgICAgICB0aGlzLiROb3RpY2UuZXJyb3IoeyB0aXRsZTogJ+mUmeivrycsIGRlc2M6ICflgLzop4TliJnmoKHpqozlvILluLgnIH0pOwogICAgICAgICAgICByZXR1cm4gW107CiAgICAgICAgfQogICAgICAgIGxldCBzdWNjZXNzSXRlbXM6YW55ID0gW107CiAgICAgICAgbGV0IGVycm9ySXRlbXM6YW55ID0gW107CiAgICAgICAgbGV0IGVycm9yTWVzc2FnZTphbnkgPSBbXTsKICAgICAgICBmb3IgKGNvbnN0IGl0ZW0gb2YgX3RoaXMuaXRlbXMpIHsKICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgIGlmKE9iamVjdC5pcyhpdGVtLnJvd0RhdGFTdGF0ZSwgJ2NyZWF0ZScpKXsKICAgICAgICAgICAgICAgICAgICBpZighdGhpcy5jcmVhdGVBY3Rpb24pewogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLiROb3RpY2UuZXJyb3IoeyB0aXRsZTogJ+mUmeivrycsIGRlc2M6ICdUUk1UUklBTlBFUlNPTkdyaWRWaWV36KeG5Zu+6KGo5qC8Y3JlYXRlQWN0aW9u5Y+C5pWw5pyq6YWN572uJyB9KTsKICAgICAgICAgICAgICAgICAgICB9ZWxzZXsKICAgICAgICAgICAgICAgICAgICAgIE9iamVjdC5hc3NpZ24oaXRlbSx7dmlld3BhcmFtczp0aGlzLnZpZXdwYXJhbXN9KTsKICAgICAgICAgICAgICAgICAgICAgIGxldCByZXNwb25zZSA9IGF3YWl0IHRoaXMuc2VydmljZS5hZGQodGhpcy5jcmVhdGVBY3Rpb24sIEpTT04ucGFyc2UoSlNPTi5zdHJpbmdpZnkodGhpcy5jb250ZXh0KSksaXRlbSwgdGhpcy5zaG93QnVzeUluZGljYXRvcik7CiAgICAgICAgICAgICAgICAgICAgICBzdWNjZXNzSXRlbXMucHVzaChKU09OLnBhcnNlKEpTT04uc3RyaW5naWZ5KHJlc3BvbnNlLmRhdGEpKSk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfWVsc2UgaWYoT2JqZWN0LmlzKGl0ZW0ucm93RGF0YVN0YXRlLCAndXBkYXRlJykpewogICAgICAgICAgICAgICAgICAgIGlmKCF0aGlzLnVwZGF0ZUFjdGlvbil7CiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuJE5vdGljZS5lcnJvcih7IHRpdGxlOiAn6ZSZ6K+vJywgZGVzYzogJ1RSTVRSSUFOUEVSU09OR3JpZFZpZXfop4blm77ooajmoLx1cGRhdGVBY3Rpb27lj4LmlbDmnKrphY3nva4nIH0pOwogICAgICAgICAgICAgICAgICAgIH1lbHNlewogICAgICAgICAgICAgICAgICAgICAgICBPYmplY3QuYXNzaWduKGl0ZW0se3ZpZXdwYXJhbXM6dGhpcy52aWV3cGFyYW1zfSk7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmKGl0ZW0udHJtdHJhaW5wZXJzb24pewogICAgICAgICAgICAgICAgICAgICAgICAgICAgT2JqZWN0LmFzc2lnbih0aGlzLmNvbnRleHQse3RybXRyYWlucGVyc29uOml0ZW0udHJtdHJhaW5wZXJzb259KTsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICBsZXQgcmVzcG9uc2UgPSBhd2FpdCB0aGlzLnNlcnZpY2UuYWRkKHRoaXMudXBkYXRlQWN0aW9uLEpTT04ucGFyc2UoSlNPTi5zdHJpbmdpZnkodGhpcy5jb250ZXh0KSksaXRlbSwgdGhpcy5zaG93QnVzeUluZGljYXRvcik7CiAgICAgICAgICAgICAgICAgICAgICAgIHN1Y2Nlc3NJdGVtcy5wdXNoKEpTT04ucGFyc2UoSlNPTi5zdHJpbmdpZnkocmVzcG9uc2UuZGF0YSkpKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7CiAgICAgICAgICAgICAgICBlcnJvckl0ZW1zLnB1c2goSlNPTi5wYXJzZShKU09OLnN0cmluZ2lmeShpdGVtKSkpOwogICAgICAgICAgICAgICAgZXJyb3JNZXNzYWdlLnB1c2goZXJyb3IpOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIHRoaXMuJGVtaXQoJ3NhdmUnLCBzdWNjZXNzSXRlbXMpOwogICAgICAgIHRoaXMucmVmcmVzaChbXSk7CiAgICAgICAgaWYoZXJyb3JJdGVtcy5sZW5ndGggPT09IDApewogICAgICAgICAgICB0aGlzLiROb3RpY2Uuc3VjY2Vzcyh7IHRpdGxlOiAnJywgZGVzYzogJ+S/neWtmOaIkOWKnyEnIH0pOwogICAgICAgIH1lbHNlewogICAgICAgICAgZXJyb3JJdGVtcy5mb3JFYWNoKChpdGVtOmFueSxpbmRleDpudW1iZXIpPT57CiAgICAgICAgICAgIHRoaXMuJE5vdGljZS5lcnJvcih7IHRpdGxlOiAn5L+d5a2Y5aSx6LSlJywgZGVzYzogaXRlbS5tYWpvcmVudGl0eW5hbWUrJ+S/neWtmOWksei0pe+8gScgfSk7CiAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoZXJyb3JNZXNzYWdlW2luZGV4XSk7CiAgICAgICAgICB9KTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIHN1Y2Nlc3NJdGVtczsKICAgIH0KCiAgICAvKioKICAgICAqIOaWsOW7uuihjAogICAgICoKICAgICAqIEBwYXJhbSB7Kn0gJGV2ZW50CiAgICAgKiBAcmV0dXJucyB7dm9pZH0KICAgICAqIEBtZW1iZXJvZiBNYWluQmFzZQogICAgICovCiAgICBwdWJsaWMgbmV3Um93KGFyZ3M6IGFueVtdLCBwYXJhbXM/OiBhbnksICRldmVudD86IGFueSwgeERhdGE/OiBhbnkpOiB2b2lkIHsKICAgICAgICBpZighdGhpcy5sb2FkZHJhZnRBY3Rpb24pewogICAgICAgICAgICB0aGlzLiROb3RpY2UuZXJyb3IoeyB0aXRsZTogJ+mUmeivrycsIGRlc2M6ICdUUk1UUklBTlBFUlNPTkdyaWRWaWV36KeG5Zu+6KGo5qC8bG9hZGRyYWZ0QWN0aW9u5Y+C5pWw5pyq6YWN572uJyB9KTsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KICAgICAgICBsZXQgX3RoaXMgPSB0aGlzOwogICAgICAgIE9iamVjdC5hc3NpZ24oYXJnc1swXSx7dmlld3BhcmFtczp0aGlzLnZpZXdwYXJhbXN9KTsKICAgICAgICBsZXQgcG9zdDogUHJvbWlzZTxhbnk+ID0gdGhpcy5zZXJ2aWNlLmxvYWREcmFmdCh0aGlzLmxvYWRkcmFmdEFjdGlvbiwgSlNPTi5wYXJzZShKU09OLnN0cmluZ2lmeSh0aGlzLmNvbnRleHQpKSwgYXJnc1swXSwgdGhpcy5zaG93QnVzeUluZGljYXRvcik7CiAgICAgICAgcG9zdC50aGVuKChyZXNwb25zZTogYW55KSA9PiB7CiAgICAgICAgICAgIGlmICghcmVzcG9uc2Uuc3RhdHVzIHx8IHJlc3BvbnNlLnN0YXR1cyAhPT0gMjAwKSB7CiAgICAgICAgICAgICAgICBpZiAocmVzcG9uc2UuZXJyb3JNZXNzYWdlKSB7CiAgICAgICAgICAgICAgICAgICAgdGhpcy4kTm90aWNlLmVycm9yKHsgdGl0bGU6ICfplJnor68nLCBkZXNjOiByZXNwb25zZS5lcnJvck1lc3NhZ2UgfSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgIH0KICAgICAgICAgICAgY29uc3QgZGF0YSA9IHJlc3BvbnNlLmRhdGE7CiAgICAgICAgICAgIHRoaXMuY3JlYXRlRGVmYXVsdChkYXRhKTsKICAgICAgICAgICAgZGF0YS5yb3dEYXRhU3RhdGUgPSAiY3JlYXRlIjsKICAgICAgICAgICAgX3RoaXMuaXRlbXMucHVzaChkYXRhKTsKICAgICAgICAgICAgX3RoaXMuZ3JpZEl0ZW1zTW9kZWwucHVzaChfdGhpcy5nZXRHcmlkUm93TW9kZWwoKSk7CiAgICAgICAgfSkuY2F0Y2goKHJlc3BvbnNlOiBhbnkpID0+IHsKICAgICAgICAgICAgaWYgKHJlc3BvbnNlICYmIHJlc3BvbnNlLnN0YXR1cyA9PT0gNDAxKSB7CiAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKCFyZXNwb25zZSB8fCAhcmVzcG9uc2Uuc3RhdHVzIHx8ICFyZXNwb25zZS5kYXRhKSB7CiAgICAgICAgICAgICAgICB0aGlzLiROb3RpY2UuZXJyb3IoeyB0aXRsZTogJ+mUmeivrycsIGRlc2M6ICfns7vnu5/lvILluLgnIH0pOwogICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICB9CiAgICAgICAgfSk7CiAgICB9CgogICAgLyoqCiAgICAgKiDooajmoLznvJbovpHpobnlgLzlj5jmm7QKICAgICAqICAKICAgICAqIEBwYXJhbSByb3cg6KGM5pWw5o2uCiAgICAgKiBAcGFyYW0ge3sgbmFtZTogc3RyaW5nLCB2YWx1ZTogYW55IH19ICRldmVudAogICAgICogQHJldHVybnMge3ZvaWR9CiAgICAgKiBAbWVtYmVyb2YgTWFpbkJhc2UKICAgICAqLwogICAgcHVibGljIG9uR3JpZEl0ZW1WYWx1ZUNoYW5nZShyb3c6IGFueSwkZXZlbnQ6IHsgbmFtZTogc3RyaW5nLCB2YWx1ZTogYW55IH0scm93SW5kZXg6IG51bWJlcik6IHZvaWQgewogICAgICAgIGlmICghJGV2ZW50KSB7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICB9CiAgICAgICAgaWYgKCEkZXZlbnQubmFtZSB8fCBPYmplY3QuaXMoJGV2ZW50Lm5hbWUsICcnKSB8fCAhcm93Lmhhc093blByb3BlcnR5KCRldmVudC5uYW1lKSkgewogICAgICAgICAgICByZXR1cm47CiAgICAgICAgfQogICAgICAgIHJvd1skZXZlbnQubmFtZV0gPSAkZXZlbnQudmFsdWU7CiAgICAgICAgdGhpcy5ncmlkRWRpdEl0ZW1DaGFuZ2Uocm93LCAkZXZlbnQubmFtZSwgJGV2ZW50LnZhbHVlLCByb3dJbmRleCk7CiAgICB9CgogICAgLyoqCiAgICAgKiDooajmoLznvJbovpHpobnlgLzlj5jljJYKICAgICAqCiAgICAgKiBAcHVibGljCiAgICAgKiBAcGFyYW0gcm93IOihjOaVsOaNrgogICAgICogQHBhcmFtIHByb3BlcnR5IOWIl+e8lui+kemhueWQjQogICAgICogQHBhcmFtIHJvdyDliJfnvJbovpHpobnlgLwKICAgICAqIEByZXR1cm5zIHt2b2lkfQogICAgICogQG1lbWJlcm9mIE1haW5CYXNlCiAgICAgKi8KICAgIHB1YmxpYyBncmlkRWRpdEl0ZW1DaGFuZ2Uocm93OiBhbnksIHByb3BlcnR5OiBzdHJpbmcsIHZhbHVlOiBhbnksIHJvd0luZGV4OiBudW1iZXIpewogICAgICAgIHJvdy5yb3dEYXRhU3RhdGUgPSByb3cucm93RGF0YVN0YXRlID8gcm93LnJvd0RhdGFTdGF0ZSA6ICJ1cGRhdGUiIDsKICAgICAgICB0aGlzLnZhbGlkYXRlKHByb3BlcnR5LHJvdyxyb3dJbmRleCk7CiAgICB9CgogICAgLyoqCiAgICAgKiDooajmoLznvJbovpHpobnmm7TmlrAKICAgICAqCiAgICAgKiBAcGFyYW0ge3N0cmluZ30gbW9kZSDnlYzpnaLooYzkuLrlkI3np7AKICAgICAqIEBwYXJhbSB7Kn0gW2RhdGE9e31dIOivt+axguaVsOaNrgogICAgICogQHBhcmFtIHtzdHJpbmdbXX0gdXBkYXRlRGV0YWlscyDmm7TmlrDpobkKICAgICAqIEBwYXJhbSB7Ym9vbGVhbn0gW3Nob3dsb2FkaW5nXSDmmK/lkKbmmL7npLrliqDovb3nirbmgIEKICAgICAqIEByZXR1cm5zIHt2b2lkfQogICAgICogQG1lbWJlcm9mIE1haW5CYXNlCiAgICAgKi8KICAgIHB1YmxpYyB1cGRhdGVHcmlkRWRpdEl0ZW0obW9kZTogc3RyaW5nLCBkYXRhOiBhbnkgPSB7fSwgdXBkYXRlRGV0YWlsczogc3RyaW5nW10sIHNob3dsb2FkaW5nPzogYm9vbGVhbik6IHZvaWQgewogICAgICAgIGlmICghbW9kZSB8fCAobW9kZSAmJiBPYmplY3QuaXMobW9kZSwgJycpKSkgewogICAgICAgICAgICByZXR1cm47CiAgICAgICAgfQogICAgICAgIGNvbnN0IGFyZzogYW55ID0gSlNPTi5wYXJzZShKU09OLnN0cmluZ2lmeShkYXRhKSk7CiAgICAgICAgT2JqZWN0LmFzc2lnbihhcmcse3ZpZXdwYXJhbXM6dGhpcy52aWV3cGFyYW1zfSk7CiAgICAgICAgY29uc3QgcG9zdDogUHJvbWlzZTxhbnk+ID0gdGhpcy5zZXJ2aWNlLmZyb250TG9naWMobW9kZSxKU09OLnBhcnNlKEpTT04uc3RyaW5naWZ5KHRoaXMuY29udGV4dCkpLGFyZywgc2hvd2xvYWRpbmcpOwogICAgICAgIHBvc3QudGhlbigocmVzcG9uc2U6IGFueSkgPT4gewogICAgICAgICAgICBpZiAoIXJlc3BvbnNlIHx8IHJlc3BvbnNlLnN0YXR1cyAhPT0gMjAwKSB7CiAgICAgICAgICAgICAgICB0aGlzLiROb3RpY2UuZXJyb3IoeyB0aXRsZTogJ+mUmeivrycsIGRlc2M6ICfooajljZXpobnmm7TmlrDlpLHotKUnIH0pOwogICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGNvbnN0IF9kYXRhOiBhbnkgPSByZXNwb25zZS5kYXRhOwogICAgICAgICAgICBpZighX2RhdGEpewogICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHVwZGF0ZURldGFpbHMuZm9yRWFjaCgobmFtZTogc3RyaW5nKSA9PiB7CiAgICAgICAgICAgICAgICBpZiAoIV9kYXRhLmhhc093blByb3BlcnR5KG5hbWUpKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgZGF0YVtuYW1lXSA9IF9kYXRhW25hbWVdOwogICAgICAgICAgICB9KTsKICAgICAgICB9KS5jYXRjaCgocmVzcG9uc2U6IGFueSkgPT4gewogICAgICAgICAgICBpZiAocmVzcG9uc2UgJiYgcmVzcG9uc2Uuc3RhdHVzID09PSA0MDEpIHsKICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAoIXJlc3BvbnNlIHx8ICFyZXNwb25zZS5zdGF0dXMgfHwgIXJlc3BvbnNlLmRhdGEpIHsKICAgICAgICAgICAgICAgIHRoaXMuJE5vdGljZS5lcnJvcih7IHRpdGxlOiAn6ZSZ6K+vJywgZGVzYzogJ+ezu+e7n+W8guW4uCcgfSk7CiAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgIH0KICAgICAgICB9KTsKICAgIH0KCiAgICAvKioKICAgICAqIOiOt+WPluWvueW6lOihjGNsYXNzCiAgICAgKgogICAgICogQHBhcmFtIHsqfSAkYXJncyByb3cg6KGM5pWw5o2u77yMcm93SW5kZXgg6KGM57Si5byVCiAgICAgKiBAcmV0dXJucyB7dm9pZH0KICAgICAqIEBtZW1iZXJvZiBNYWluQmFzZQogICAgICovCiAgICBwdWJsaWMgZ2V0Um93Q2xhc3NOYW1lKGFyZ3M6e3JvdzogYW55LHJvd0luZGV4OiBudW1iZXJ9KXsKICAgICAgICBsZXQgaXNTZWxlY3RlZCA9IHRoaXMuc2VsZWN0aW9ucy5zb21lKChpdGVtOmFueSk9PnsKICAgICAgICAgICAgcmV0dXJuIE9iamVjdC5pcyhpdGVtLnRybXRyYWlucGVyc29uLGFyZ3Mucm93LnRybXRyYWlucGVyc29uKTsKICAgICAgICB9KTsKICAgICAgICByZXR1cm4gaXNTZWxlY3RlZCA/ICJncmlkLXNlbGVjdGVkLXJvdyIgOiAiIjsKICAgIH0KCiAgICAvKioKICAgICAqIOiOt+WPluWvueW6lOWIl2NsYXNzCiAgICAgKgogICAgICogQHBhcmFtIHsqfSAkYXJncyByb3cg6KGM5pWw5o2u77yMY29sdW1uIOWIl+aVsOaNru+8jHJvd0luZGV4IOihjOe0ouW8le+8jOWIl+e0ouW8lQogICAgICogQHJldHVybnMge3ZvaWR9CiAgICAgKiBAbWVtYmVyb2YgTWFpbkJhc2UKICAgICAqLwogICAgcHVibGljIGdldENlbGxDbGFzc05hbWUoYXJnczp7cm93OiBhbnksIGNvbHVtbjogYW55LCByb3dJbmRleDogbnVtYmVyLCBjb2x1bW5JbmRleDpudW1iZXJ9KXsKICAgICAgICBsZXQgaGFzUm93RWRpdDphbnkgPSB7CiAgICAgICAgICAncHhiaic6ZmFsc2UsCiAgICAgICAgICAndHJhaW5iZWdpbic6ZmFsc2UsCiAgICAgICAgICAndHJhaW5lbmQnOmZhbHNlLAogICAgICAgICAgJ3B4a2MnOmZhbHNlLAogICAgICAgICAgJ3B4amcnOmZhbHNlLAogICAgICAgICAgJ3RyYWlucmVzJzpmYWxzZSwKICAgICAgICAgICdmcyc6ZmFsc2UsCiAgICAgICAgfQogICAgICAgIHJldHVybiAoIGhhc1Jvd0VkaXRbYXJncy5jb2x1bW4ucHJvcGVydHldICYmIHRoaXMuYWN0dWFsSXNPcGVuRWRpdCApID8gImVkaXQtY2VsbCIgOiAiaW5mby1jZWxsIjsKICAgIH0KCiAgICAvKioKICAgICAqIOaWsOW7uum7mOiupOWAvAogICAgICogQHBhcmFtIHsqfSAgcm93IOihjOaVsOaNrgogICAgICogQG1lbWJlcm9mIE1haW5CYXNlCiAgICAgKi8KICAgIHB1YmxpYyBjcmVhdGVEZWZhdWx0KHJvdzogYW55KXsgICAgICAgICAgICAgICAgICAgIAogICAgfQp9Cg=="},null]}
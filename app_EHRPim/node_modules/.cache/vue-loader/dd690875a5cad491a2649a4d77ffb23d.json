{"remainingRequest":"F:\\crod项目\\人事管理系统2\\iBizEHR\\app_EHRPim\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!F:\\crod项目\\人事管理系统2\\iBizEHR\\app_EHRPim\\src\\widgets\\pim-education\\org-edu-pie-chart\\org-edu-pie-chart-base.vue?vue&type=script&lang=tsx&","dependencies":[{"path":"F:\\crod项目\\人事管理系统2\\iBizEHR\\app_EHRPim\\src\\widgets\\pim-education\\org-edu-pie-chart\\org-edu-pie-chart-base.vue","mtime":1630509411545},{"path":"F:\\crod项目\\人事管理系统2\\iBizEHR\\app_EHRPim\\node_modules\\babel-loader\\lib\\index.js","mtime":1630511852747},{"path":"F:\\crod项目\\人事管理系统2\\iBizEHR\\app_EHRPim\\node_modules\\ts-loader\\index.js","mtime":1630511985412},{"path":"F:\\crod项目\\人事管理系统2\\iBizEHR\\app_EHRPim\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1630511852775},{"path":"F:\\crod项目\\人事管理系统2\\iBizEHR\\app_EHRPim\\node_modules\\vue-loader\\lib\\index.js","mtime":1630512070338}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:CgoKCgoKCgoKaW1wb3J0IHsgVnVlLCBDb21wb25lbnQsIFByb3AsIFByb3ZpZGUsIEVtaXQsIFdhdGNoLCBNb2RlbCxJbmplY3QgfSBmcm9tICd2dWUtcHJvcGVydHktZGVjb3JhdG9yJzsKaW1wb3J0IHsgQ3JlYXRlRWxlbWVudCB9IGZyb20gJ3Z1ZSc7CmltcG9ydCB7IFN1YmplY3QsIFN1YnNjcmlwdGlvbiB9IGZyb20gJ3J4anMnOwppbXBvcnQgeyBDb250cm9sSW50ZXJmYWNlIH0gZnJvbSAnQC9pbnRlcmZhY2UvY29udHJvbCc7CmltcG9ydCB7IFVJQWN0aW9uVG9vbCxVdGlsIH0gZnJvbSAnQC91dGlscyc7CmltcG9ydCBOYXZEYXRhU2VydmljZSBmcm9tICdAL3NlcnZpY2UvYXBwL25hdmRhdGEtc2VydmljZSc7CmltcG9ydCBQaW1FZHVjYXRpb25TZXJ2aWNlIGZyb20gJ0Avc2VydmljZS9waW0tZWR1Y2F0aW9uL3BpbS1lZHVjYXRpb24tc2VydmljZSc7CmltcG9ydCBPcmdFZHVQaWVTZXJ2aWNlIGZyb20gJy4vb3JnLWVkdS1waWUtY2hhcnQtc2VydmljZSc7CgppbXBvcnQgZWNoYXJ0cyBmcm9tICdlY2hhcnRzJzsKaW1wb3J0IG1vbWVudCBmcm9tICJtb21lbnQiOyAKaW1wb3J0IENvZGVMaXN0U2VydmljZSBmcm9tICJAc2VydmljZS9hcHAvY29kZWxpc3Qtc2VydmljZSI7CmltcG9ydCB7IENoYXJ0RGF0YVNldEZpZWxkLENoYXJ0TGluZVNlcmllcyxDaGFydEZ1bm5lbFNlcmllcyxDaGFydFBpZVNlcmllcyxDaGFydEJhclNlcmllcyxDaGFydFJhZGFyU2VyaWVzfSBmcm9tICdAL21vZGVsL2NoYXJ0LWRldGFpbCc7CgoKQENvbXBvbmVudCh7CiAgICBjb21wb25lbnRzOiB7CiAgICAgIAogICAgfQp9KQpleHBvcnQgZGVmYXVsdCBjbGFzcyBPcmdFZHVQaWVCYXNlIGV4dGVuZHMgVnVlIGltcGxlbWVudHMgQ29udHJvbEludGVyZmFjZSB7CgogICAgLyoqCiAgICAgKiDlkI3np7AKICAgICAqCiAgICAgKiBAdHlwZSB7c3RyaW5nfQogICAgICogQG1lbWJlcm9mIE9yZ0VkdVBpZUJhc2UKICAgICAqLwogICAgQFByb3AoKSBwdWJsaWMgbmFtZT86IHN0cmluZzsKCiAgICAvKioKICAgICAqIOinhuWbvumAmuiur+WvueixoQogICAgICoKICAgICAqIEB0eXBlIHtTdWJqZWN0PFZpZXdTdGF0ZT59CiAgICAgKiBAbWVtYmVyb2YgT3JnRWR1UGllQmFzZQogICAgICovCiAgICBAUHJvcCgpIHB1YmxpYyB2aWV3U3RhdGUhOiBTdWJqZWN0PFZpZXdTdGF0ZT47CgogICAgLyoqCiAgICAgKiDlupTnlKjkuIrkuIvmlocKICAgICAqCiAgICAgKiBAdHlwZSB7Kn0KICAgICAqIEBtZW1iZXJvZiBPcmdFZHVQaWVCYXNlCiAgICAgKi8KICAgIEBQcm9wKCkgcHVibGljIGNvbnRleHQ6IGFueTsKCiAgICAvKioKICAgICAqIOinhuWbvuWPguaVsAogICAgICoKICAgICAqIEB0eXBlIHsqfQogICAgICogQG1lbWJlcm9mIE9yZ0VkdVBpZUJhc2UKICAgICAqLwogICAgQFByb3AoKSBwdWJsaWMgdmlld3BhcmFtczogYW55OwoKICAgIC8qKgogICAgICog6KeG5Zu+54q25oCB5LqL5Lu2CiAgICAgKgogICAgICogQHB1YmxpYwogICAgICogQHR5cGUgeyhTdWJzY3JpcHRpb24gfCB1bmRlZmluZWQpfQogICAgICogQG1lbWJlcm9mIE9yZ0VkdVBpZUJhc2UKICAgICAqLwogICAgcHVibGljIHZpZXdTdGF0ZUV2ZW50OiBTdWJzY3JpcHRpb24gfCB1bmRlZmluZWQ7CgogICAgLyoqCiAgICAgKiDojrflj5bpg6jku7bnsbvlnosKICAgICAqCiAgICAgKiBAcmV0dXJucyB7c3RyaW5nfQogICAgICogQG1lbWJlcm9mIE9yZ0VkdVBpZUJhc2UKICAgICAqLwogICAgcHVibGljIGdldENvbnRyb2xUeXBlKCk6IHN0cmluZyB7CiAgICAgICAgcmV0dXJuICdDSEFSVCcKICAgIH0KCgoKICAgIC8qKgogICAgICog5bu65p6E6YOo5Lu25pyN5Yqh5a+56LGhCiAgICAgKgogICAgICogQHR5cGUge09yZ0VkdVBpZVNlcnZpY2V9CiAgICAgKiBAbWVtYmVyb2YgT3JnRWR1UGllQmFzZQogICAgICovCiAgICBwdWJsaWMgc2VydmljZTogT3JnRWR1UGllU2VydmljZSA9IG5ldyBPcmdFZHVQaWVTZXJ2aWNlKHsgJHN0b3JlOiB0aGlzLiRzdG9yZSB9KTsKCiAgICAvKioKICAgICAqIOWunuS9k+acjeWKoeWvueixoQogICAgICoKICAgICAqIEB0eXBlIHtQaW1FZHVjYXRpb25TZXJ2aWNlfQogICAgICogQG1lbWJlcm9mIE9yZ0VkdVBpZUJhc2UKICAgICAqLwogICAgcHVibGljIGFwcEVudGl0eVNlcnZpY2U6IFBpbUVkdWNhdGlvblNlcnZpY2UgPSBuZXcgUGltRWR1Y2F0aW9uU2VydmljZSh7ICRzdG9yZTogdGhpcy4kc3RvcmUgfSk7CiAgICAKCgogICAgLyoqCiAgICAgKiDlhbPpl63op4blm74KICAgICAqCiAgICAgKiBAcGFyYW0ge2FueX0gYXJncwogICAgICogQG1lbWJlcm9mIE9yZ0VkdVBpZUJhc2UKICAgICAqLwogICAgcHVibGljIGNsb3NlVmlldyhhcmdzOiBhbnkpOiB2b2lkIHsKICAgICAgICBsZXQgX3RoaXM6IGFueSA9IHRoaXM7CiAgICAgICAgX3RoaXMuJGVtaXQoJ2Nsb3NldmlldycsIFthcmdzXSk7CiAgICB9CgogICAgLyoqCiAgICAgKiAg6K6h5pWw5Zmo5Yi35pawCiAgICAgKgogICAgICogQG1lbWJlcm9mIE9yZ0VkdVBpZUJhc2UKICAgICAqLwogICAgcHVibGljIGNvdW50ZXJSZWZyZXNoKCl7CiAgICAgICAgY29uc3QgX3RoaXM6YW55ID10aGlzOwogICAgICAgIGlmKF90aGlzLmNvdW50ZXJTZXJ2aWNlQXJyYXkgJiYgX3RoaXMuY291bnRlclNlcnZpY2VBcnJheS5sZW5ndGggPjApewogICAgICAgICAgICBfdGhpcy5jb3VudGVyU2VydmljZUFycmF5LmZvckVhY2goKGl0ZW06YW55KSA9PnsKICAgICAgICAgICAgICAgIGlmKGl0ZW0ucmVmcmVzaERhdGEgJiYgaXRlbS5yZWZyZXNoRGF0YSBpbnN0YW5jZW9mIEZ1bmN0aW9uKXsKICAgICAgICAgICAgICAgICAgICBpdGVtLnJlZnJlc2hEYXRhKCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0pCiAgICAgICAgfQogICAgfQoKCiAgICAvKioKICAgICAqIOiOt+WPluWkmumhueaVsOaNrgogICAgICoKICAgICAqIEByZXR1cm5zIHthbnlbXX0KICAgICAqIEBtZW1iZXJvZiBPcmdFZHVQaWVCYXNlCiAgICAgKi8KICAgIHB1YmxpYyBnZXREYXRhcygpOiBhbnlbXSB7CiAgICAgICAgcmV0dXJuIFtdOwogICAgfQoKICAgIC8qKgogICAgICog6I635Y+W5Y2V6aG55qCRCiAgICAgKgogICAgICogQHJldHVybnMgeyp9CiAgICAgKiBAbWVtYmVyb2YgT3JnRWR1UGllQmFzZQogICAgICovCiAgICBwdWJsaWMgZ2V0RGF0YSgpOiBhbnkgewogICAgICAgIHJldHVybiBudWxsOwogICAgfQoKICAgIC8qKgogICAgICog5pi+56S65aSE55CG5o+Q56S6CiAgICAgKgogICAgICogQHR5cGUge2Jvb2xlYW59CiAgICAgKiBAbWVtYmVyb2YgT3JnRWR1UGllQmFzZQogICAgICovCiAgICBAUHJvcCh7IGRlZmF1bHQ6IHRydWUgfSkgcHVibGljIHNob3dCdXN5SW5kaWNhdG9yITogYm9vbGVhbjsKCiAgICAvKioKICAgICAqIOmDqOS7tuihjOS4ui0tZmV0Y2gKICAgICAqCiAgICAgKiBAdHlwZSB7c3RyaW5nfQogICAgICogQG1lbWJlcm9mIE9yZ0VkdVBpZUJhc2UKICAgICAqLwogICAgQFByb3AoKSBwdWJsaWMgZmV0Y2hBY3Rpb24hOiBzdHJpbmc7ICAKCiAgICAvKioKICAgICogVnVl5aOw5piO5ZGo5pyfKOe7hOS7tuWIneWni+WMluWujOavlSkKICAgICoKICAgICogQG1lbWJlcm9mIE9yZ0VkdVBpZUJhc2UKICAgICovCiAgICBwdWJsaWMgY3JlYXRlZCgpIHsKICAgICAgICAgdGhpcy5hZnRlckNyZWF0ZWQoKTsgICAgIAogICAgfQoKICAgIC8qKgogICAgKiDmiafooYxjcmVhdGVk5ZCO55qE6YC76L6RCiAgICAqCiAgICAqIEBtZW1iZXJvZiBPcmdFZHVQaWVCYXNlCiAgICAqLwogICAgcHVibGljIGFmdGVyQ3JlYXRlZCgpewogICAgICAgIGlmICh0aGlzLnZpZXdTdGF0ZSkgewogICAgICAgICAgICB0aGlzLnZpZXdTdGF0ZUV2ZW50ID0gdGhpcy52aWV3U3RhdGUuc3Vic2NyaWJlKCh7IHRhZywgYWN0aW9uLCBkYXRhIH0pID0+IHsKICAgICAgICAgICAgICAgIGlmICghT2JqZWN0LmlzKHRhZywgdGhpcy5uYW1lKSkgewogICAgICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGlmIChPYmplY3QuaXMoJ2xvYWQnLCBhY3Rpb24pKSB7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5sb2FkKGRhdGEpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9KTsKICAgICAgICB9ICAKICAgIH0KCiAgICAvKioKICAgICAqIHZ1ZSDnlJ/lkb3lkajmnJ8KICAgICAqCiAgICAgKiBAbWVtYmVyb2YgT3JnRWR1UGllQmFzZQogICAgICovCiAgICBwdWJsaWMgZGVzdHJveWVkKCkgewogICAgICAgIHRoaXMuYWZ0ZXJEZXN0cm95KCk7CiAgICB9CgogICAgLyoqCiAgICAgKiDmiafooYxkZXN0cm95ZWTlkI7nmoTpgLvovpEKICAgICAqCiAgICAgKiBAbWVtYmVyb2YgT3JnRWR1UGllQmFzZQogICAgICovCiAgICBwdWJsaWMgYWZ0ZXJEZXN0cm95KCkgewogICAgICAgIGlmICh0aGlzLnZpZXdTdGF0ZUV2ZW50KSB7CiAgICAgICAgICAgIHRoaXMudmlld1N0YXRlRXZlbnQudW5zdWJzY3JpYmUoKTsKICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiDmmK/lkKbml6DmlbDmja4KICAgICAqCiAgICAgKiBAcHVibGljCiAgICAgKiBAdHlwZSB7Ym9vbGVhbn0KICAgICAqIEBtZW1iZXJvZiBEYl9zeXNwb3J0bGV0M19jaGFydEJhc2UKICAgICAqLwogICAgcHVibGljIGlzTm9EYXRhOiBib29sZWFuICA9IGZhbHNlOwoKICAgIC8qKgogICAgICog5Zu+6KGoZGl257uR5a6a55qEaWQKICAgICAqCiAgICAgKiBAdHlwZSB7fQogICAgICogQG1lbWJlcm9mIERiX3N5c3BvcnRsZXQzX2NoYXJ0QmFzZQogICAgICovICAgCiAgICBwdWJsaWMgY2hhcnRJZDpzdHJpbmcgPSB0aGlzLiR1dGlsLmNyZWF0ZVVVSUQoKTsKCiAgICAvKioKICAgICAqIGVjaGFydHPlm77ooajlr7nosaEKICAgICAqCiAgICAgKiBAdHlwZSB7fQogICAgICogQG1lbWJlcm9mIERiX3N5c3BvcnRsZXQzX2NoYXJ0QmFzZQogICAgICovICAgCiAgICBwdWJsaWMgbXlDaGFydDphbnk7CgogICAgLyoqCiAgICAgKiDku6PnoIHooajmnI3liqHlr7nosaEKICAgICAqCiAgICAgKiBAdHlwZSB7Q29kZUxpc3RTZXJ2aWNlfQogICAgICogQG1lbWJlcm9mIERiX3N5c3BvcnRsZXQzX2NoYXJ0QmFzZQogICAgICovICAKICAgIHB1YmxpYyBjb2RlTGlzdFNlcnZpY2U6Q29kZUxpc3RTZXJ2aWNlID0gbmV3IENvZGVMaXN0U2VydmljZSh7ICRzdG9yZTogdGhpcy4kc3RvcmUgfSk7CgogICAgLyoqCiAgICAgKiDluo/liJfmqKHlnosKICAgICAqCiAgICAgKiBAdHlwZSB7fQogICAgICogQG1lbWJlcm9mIERiX3N5c3BvcnRsZXQzX2NoYXJ0QmFzZQogICAgICovCiAgICBwdWJsaWMgIHNlcmllc01vZGVsOmFueSA9IHsKICAgICAgICBwaWU6bmV3IENoYXJ0UGllU2VyaWVzKHsKICAgIG5hbWU6J3BpZScsCiAgICAKICAgIAogICAgY2F0ZWdvckZpZWxkOidoaWdoZXN0ZGVncmVlJywKICAgIGNhdGVnb3JDb2RlTGlzdDp7dHlwZTonU1RBVElDJyx0YWc6J0VockNvZGVMaXN0MDIzNicsZW1wdHljb2RlOidlbXB0eScsZW1wdHl0ZXh0OifmnKrlrprkuYknfSwKICAgIAogICAgdmFsdWVGaWVsZDonY291bnRudW0nLAogICAgc2VyaWVzVmFsdWVzOltdLAogICAgc2VyaWVzSW5kZXg6MCwKICAgIGRhdGE6W10sCiAgICBzZXJpZXNNYXA6e30sCiAgICBkYXRhU2V0RmllbGRzOlsKICAgIHtuYW1lOiJoaWdoZXN0ZGVncmVlIixjb2RlbGlzdDp7dHlwZToiU1RBVElDIix0YWc6IkVockNvZGVMaXN0MDIzNiIsZW1wdHljb2RlOidlbXB0eScsZW1wdHl0ZXh0OifmnKrlrprkuYknfSxpc0dyb3VwRmllbGQ6dHJ1ZSxncm91cE1vZGU6IkNPREVMSVNUIn0sCiAgICB7bmFtZToiY291bnRudW0iLGNvZGVsaXN0Om51bGwsaXNHcm91cEZpZWxkOmZhbHNlLGdyb3VwTW9kZToiIn0KICAgIF0sCiAgICBlY3hPYmplY3Q6ewogICAgICAgIGxhYmVsOnsKICAgICAgICAgICAgc2hvdzogdHJ1ZSwKICAgICAgICAgICAgcG9zaXRpb246ICdvdXRzaWRlJywKICAgICAgICB9LAogICAgICAgIGxhYmVsTGluZTp7CiAgICAgICAgICAgIHNob3c6IHRydWUsCiAgICAgICAgICAgIGxlbmd0aDogMTAsCiAgICAgICAgICAgIGxpbmVTdHlsZTogewogICAgICAgICAgICAgICAgd2lkdGg6IDEsCiAgICAgICAgICAgICAgICB0eXBlOiAnc29saWQnCiAgICAgICAgICAgIH0KICAgICAgICB9LAogICAgICAgIGl0ZW1TdHlsZTp7CiAgICAgICAgICAgIGJvcmRlckNvbG9yOiAnI2ZmZicsCiAgICAgICAgICAgIGJvcmRlcldpZHRoOiAxCiAgICAgICAgfSwKICAgICAgICBlbXBoYXNpczp7CiAgICAgICAgICAgIGxhYmVsOiB7CiAgICAgICAgICAgICAgICBmb250U2l6ZTogMjAKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0sCiAgICBlY09iamVjdDp7CiAgICAgICAgbGFiZWw6e2Zvcm1hdHRlcjone2J9OntkfeS6uid9LAogICAgICAgIHJpZ2h0OicxNSUnLAogICAgICAgIHRvcDonMTAlJywKICAgICAgICBsZWZ0OiczMCUnLAogICAgfSwKICAgIHNlcmllc1RlbXA6ewogICAgICAgIHR5cGU6J3BpZScsCiAgICB9LAogICAgYmFzZU9wdGlvbjp7CiAgICB9LAogICAgc2VyaWVzTGF5b3V0Qnk6ImNvbHVtbiIKICAgIH0pCgogICAgfTsKCiAgICAvKioKICAgICAqIOWbvuihqOiHquWumuS5ieWPguaVsOmbhuWQiAogICAgICoKICAgICAqIEBtZW1iZXJvZiBEYl9zeXNwb3J0bGV0M19jaGFydEJhc2UKICAgICAqLyAgIAogICAgcHVibGljIGNoYXJ0VXNlclBhcmFtczphbnkgPXsKICAgICAgICB0b29sdGlwOnsgZm9ybWF0dGVyOid7YX08YnIgLz57Yn06e2R9J30sCiAgICAgICAgbGVnZW5kOnsgc2hvdzp0cnVlLGxlZnQ6JzUlJyx0b3A6JzM1JScsb3JpZW50Oid2ZXJ0aWNhbCd9LAogICAgICAgIGNvbG9yOlsnIzg4NmZlYycsJyMwNDA0ZjYnLCAnIzhCQzM0QScsICcjMjVmYWQzJywgJyM5MWM3YWUnLCcjNzQ5ZjgzJywgICcjY2E4NjIyJywgJyNiZGEyOWEnLCcjNmU3MDc0JywgJyM1NDY1NzAnLCAnI2M0Y2NkMyddCiAgICB9OwoKICAgIC8qKgogICAgICog5Zu+6KGo5Z+656GA5Yqo5oCB5qih5Z6LCiAgICAgKgogICAgICogQG1lbWJlcm9mIERiX3N5c3BvcnRsZXQzX2NoYXJ0QmFzZQogICAgICovICAKICAgIHB1YmxpYyBjaGFydEJhc2VPUHRpb246YW55ID0ge307CgogICAgLyoqCiAgICAgKiDliJ3lp4vljJblm77ooajmiYDpnIDlj4LmlbAKICAgICAqCiAgICAgKiBAdHlwZSB7fQogICAgICogQG1lbWJlcm9mIERiX3N5c3BvcnRsZXQzX2NoYXJ0QmFzZQogICAgICovICAgCiAgICBwdWJsaWMgY2hhcnRPcHRpb246YW55ID0gewogICAgICAgIHRpdGxlOnsKICAgICAgICAgICAgc2hvdzp0cnVlICwKICAgICAgICAgICAgdGV4dDon5a2m5Y6G5YiG5biDJywKICAgICAgICAgICAgc3VidGV4dDonJwogICAgICAgIH0sCiAgICAgICAgbGVnZW5kOnsKICAgICAgICAgICAgc2hvdzpmYWxzZQogICAgICAgIH0sCiAgICAgICAgdG9vbHRpcDp7CiAgICAgICAgICAgIHNob3c6dHJ1ZQogICAgICAgIH0sCiAgICAgICAgZGF0YXNldDpbXSwKICAgICAgICBzZXJpZXM6WwogICAgICAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICBpZDoncGllJywNCiAgICAgICAgICAgIG5hbWU6J+WtpuWOhuWIhuW4gycsDQogICAgICAgICAgICB0eXBlOidwaWUnLA0KICAgICAgICAgICAgZGF0YXNldEluZGV4OjAsDQogICAgICAgICAgICANCiAgICAgICAgICAgIHNlcmllc0xheW91dEJ5OiJjb2x1bW4iLA0KICAgICAgICAgICAgZW5jb2RlOnsNCiAgICAgICAgICAgICAgICBpdGVtTmFtZToiaGlnaGVzdGRlZ3JlZSIsDQogICAgICAgICAgICAgICAgdmFsdWU6ImNvdW50bnVtIg0KICAgICAgICAgICAgfX0NCiAgICAgICAgXQogICAgfTsKCiAgICAvKioKICAgICAqIOWIt+aWsAogICAgICoKICAgICAqIEBwYXJhbSB7Kn0gW29wdD17fV0KICAgICAqIEBtZW1iZXJvZiBEYl9zeXNwb3J0bGV0M19jaGFydEJhc2UKICAgICAqLwogICAgcHVibGljIHJlZnJlc2gob3B0OiBhbnkgPSB7fSkgewogICAgICAgIHRoaXMubG9hZChvcHQpOwogICAgfQoKICAgIC8qKgogICAgICog6I635Y+W5Zu+6KGo5pWw5o2uCiAgICAgKiAKICAgICAqIEByZXR1cm5zIHsqfSAKICAgICAqIEBtZW1iZXJvZiBEYl9zeXNwb3J0bGV0M19jaGFydEJhc2UKICAgICAqLwogICAgcHVibGljIGxvYWQob3B0PzphbnkpIHsKICAgICAgICBsZXQgX3RoaXMgPSB0aGlzOwogICAgICAgIGNvbnN0IGFyZzogYW55ID0geyAuLi5vcHQgfTsKICAgICAgICBjb25zdCBwYXJlbnRkYXRhOiBhbnkgPSB7fTsKICAgICAgICB0aGlzLiRlbWl0KCdiZWZvcmVsb2FkJywgcGFyZW50ZGF0YSk7CiAgICAgICAgT2JqZWN0LmFzc2lnbihhcmcsIHBhcmVudGRhdGEpOwogICAgICAgIE9iamVjdC5hc3NpZ24oYXJnLHt2aWV3cGFyYW1zOnRoaXMudmlld3BhcmFtcyxwYWdlOjAsc2l6ZToxMDAwfSk7CiAgICAgICAgdGhpcy5zZXJ2aWNlLnNlYXJjaCh0aGlzLmZldGNoQWN0aW9uLEpTT04ucGFyc2UoSlNPTi5zdHJpbmdpZnkodGhpcy5jb250ZXh0KSksYXJnLHRoaXMuc2hvd0J1c3lJbmRpY2F0b3IpLnRoZW4oKHJlcykgPT4gewogICAgICAgICAgICBpZiAocmVzKSB7CiAgICAgICAgICAgICAgIHRoaXMudHJhbnNmb3JtVG9CYXNpY0NoYXJ0U2V0RGF0YShyZXMuZGF0YSwoY29kZWxpc3Q6YW55KSA9PntfdGhpcy5kcmF3Q2hhcnRzKGNvZGVsaXN0KX0pOwogICAgICAgICAgICB9CiAgICAgICAgfSkuY2F0Y2goKGVycm9yKSA9PiB7CiAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoZXJyb3IpOwogICAgICAgIH0pOwogICAgfQoKICAgIC8qKgogICAgICog57uY5Yi25Zu+6KGoCiAgICAgKiAKICAgICAqIEByZXR1cm5zIHsqfSAKICAgICAqIEBtZW1iZXJvZiBEYl9zeXNwb3J0bGV0M19jaGFydEJhc2UKICAgICAqLwogICAgcHVibGljIGRyYXdDaGFydHMoY29kZWxpc3Q6YW55KXsKICAgICAgICBpZighdGhpcy5teUNoYXJ0KXsKICAgICAgICAgIGxldCBlbGVtZW50OmFueSA9ICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCh0aGlzLmNoYXJ0SWQpOwogICAgICAgICAgdGhpcy5teUNoYXJ0ID0gZWNoYXJ0cy5pbml0KGVsZW1lbnQpOwogICAgICAgIH0KICAgICAgICBsZXQgX2NoYXJ0T3B0aW9uID0gdGhpcy5oYW5kbGVDaGFydE9QdGlvbihjb2RlbGlzdCk7CiAgICAgICAgY29uc29sZS5sb2coX2NoYXJ0T3B0aW9uKTsKICAgICAgICB0aGlzLm15Q2hhcnQuc2V0T3B0aW9uKF9jaGFydE9wdGlvbik7CiAgICAgICAgdGhpcy5teUNoYXJ0LnJlc2l6ZSgpOwogICAgfQoKICAgIC8qKgogICAgICog5aSE55CG5Zu+6KGo5Y+C5pWwCiAgICAgKiAKICAgICAqIEBtZW1iZXJvZiBEYl9zeXNwb3J0bGV0M19jaGFydEJhc2UKICAgICAqLwogICAgcHVibGljIGhhbmRsZUNoYXJ0T1B0aW9uKGFsbGNvZGVsaXN0OmFueSl7CiAgICAgICAgbGV0IF9jaGFydE9wdGlvbjphbnkgPSBKU09OLnBhcnNlKEpTT04uc3RyaW5naWZ5KHRoaXMuY2hhcnRPcHRpb24pKTsKICAgICAgICBpZihPYmplY3Qua2V5cyh0aGlzLnNlcmllc01vZGVsKS5sZW5ndGggPiAwKXsKICAgICAgICAgICAgbGV0IHRlbXBEYXRhU291cmNlTWFwOk1hcDxzdHJpbmcsYW55PiA9IG5ldyBNYXAoKTsKICAgICAgICAgICAgZm9yKGxldCBpPTA7aTxPYmplY3Qua2V5cyh0aGlzLnNlcmllc01vZGVsKS5sZW5ndGg7aSsrKXsKICAgICAgICAgICAgICAgIE9iamVjdC52YWx1ZXModGhpcy5zZXJpZXNNb2RlbCkuZm9yRWFjaCgoc2VyaWVzdmFsdWU6YW55KSA9PnsKICAgICAgICAgICAgICAgICAgICBpZihzZXJpZXN2YWx1ZS5zZXJpZXNJbmRleCA9PT0gaSl7CiAgICAgICAgICAgICAgICAgICAgICAgIHRlbXBEYXRhU291cmNlTWFwLnNldChzZXJpZXN2YWx1ZS5uYW1lLHNlcmllc3ZhbHVlLmRhdGEpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYodGVtcERhdGFTb3VyY2VNYXAuc2l6ZSA+IDApewogICAgICAgICAgICAgICAgdGVtcERhdGFTb3VyY2VNYXAuZm9yRWFjaCgoaXRlbTphbnkpID0+ewogICAgICAgICAgICAgICAgICAgIF9jaGFydE9wdGlvbi5kYXRhc2V0LnB1c2goeydzb3VyY2UnOml0ZW19KTsKICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgIH0KICAgICAgICAgICAgT2JqZWN0LmtleXModGhpcy5zZXJpZXNNb2RlbCkuZm9yRWFjaCgoc2VyaWVzTmFtZTpzdHJpbmcpID0+ewogICAgICAgICAgICAgICAgaWYoX2NoYXJ0T3B0aW9uICYmIF9jaGFydE9wdGlvbi5zZXJpZXMubGVuZ3RoID4gMCl7CiAgICAgICAgICAgICAgICAgICAgX2NoYXJ0T3B0aW9uLnNlcmllcy5mb3JFYWNoKChpdGVtOmFueSkgPT57CiAgICAgICAgICAgICAgICAgICAgICAgIGlmKHRoaXMuc2VyaWVzTW9kZWxbc2VyaWVzTmFtZV0uZWN4T2JqZWN0ICYmIE9iamVjdC5pcyhzZXJpZXNOYW1lLGl0ZW0uaWQpKXsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGl0ZW0gPSBVdGlsLmRlZXBPYmplY3RNZXJnZShpdGVtLHRoaXMuc2VyaWVzTW9kZWxbc2VyaWVzTmFtZV0uZWN4T2JqZWN0KTsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICBpZih0aGlzLnNlcmllc01vZGVsW3Nlcmllc05hbWVdLmJhc2VPcHRpb24gJiYgT2JqZWN0LmtleXModGhpcy5zZXJpZXNNb2RlbFtzZXJpZXNOYW1lXS5iYXNlT3B0aW9uKS5sZW5ndGggPiAwICAmJiBPYmplY3QuaXMoc2VyaWVzTmFtZSxpdGVtLmlkKSl7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpdGVtID0gVXRpbC5kZWVwT2JqZWN0TWVyZ2UoaXRlbSx0aGlzLnNlcmllc01vZGVsW3Nlcmllc05hbWVdLmJhc2VPcHRpb24pOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIGlmKHRoaXMuc2VyaWVzTW9kZWxbc2VyaWVzTmFtZV0uZWNPYmplY3QgJiYgT2JqZWN0LmlzKHNlcmllc05hbWUsaXRlbS5pZCkpewogICAgICAgICAgICAgICAgICAgICAgICAgICAgaXRlbSA9IFV0aWwuZGVlcE9iamVjdE1lcmdlKGl0ZW0sdGhpcy5zZXJpZXNNb2RlbFtzZXJpZXNOYW1lXS5lY09iamVjdCk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgLy/orr7nva7lpJrluo/liJcKICAgICAgICAgICAgICAgIGxldCB0ZW1wU2VyaWVzOmFueSA9IHRoaXMuc2VyaWVzTW9kZWxbc2VyaWVzTmFtZV07CiAgICAgICAgICAgICAgICAvLyDpnZ7pm7fovr7lm74KICAgICAgICAgICAgICAgIGlmKHRlbXBTZXJpZXMgJiYgdGVtcFNlcmllcy5zZXJpZXNJZEZpZWxkICYmIHRlbXBTZXJpZXMuc2VyaWVzVmFsdWVzLmxlbmd0aCA+IDAgJiYgIU9iamVjdC5pcyh0ZW1wU2VyaWVzLnR5cGUsJ3JhZGFyJykpewogICAgICAgICAgICAgICAgICAgIGNvbnN0IHJldHVybkluZGV4Om51bWJlciA9IF9jaGFydE9wdGlvbi5zZXJpZXMuZmluZEluZGV4KChpdGVtOmFueSkgPT57CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBPYmplY3QuaXMoaXRlbS5pZCxzZXJpZXNOYW1lKTsKICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgICAgIF9jaGFydE9wdGlvbi5zZXJpZXMuc3BsaWNlKHJldHVybkluZGV4LDEpOwogICAgICAgICAgICAgICAgICAgIGxldCB0ZW1wU2VyaWVzQXJyYXk6QXJyYXk8YW55PiA9IFtdOwogICAgICAgICAgICAgICAgICAgIHRlbXBTZXJpZXMuc2VyaWVzVmFsdWVzLmZvckVhY2goKHNlcmllc3ZhbHVlSXRlbTphbnkpID0+ewogICAgICAgICAgICAgICAgICAgICAgICBsZXQgdGVtcFNlcmllc1RlbXA6YW55ID0gSlNPTi5wYXJzZShKU09OLnN0cmluZ2lmeSh0ZW1wU2VyaWVzLnNlcmllc1RlbXApKTsKICAgICAgICAgICAgICAgICAgICAgICAgT2JqZWN0LmFzc2lnbih0ZW1wU2VyaWVzVGVtcCx7bmFtZTp0ZW1wU2VyaWVzLnNlcmllc01hcFtzZXJpZXN2YWx1ZUl0ZW1dLGRhdGFzZXRJbmRleDp0ZW1wU2VyaWVzLnNlcmllc0luZGV4LGVuY29kZTp7eDp0ZW1wU2VyaWVzLmNhdGVnb3JGaWVsZCx5OmAke3Nlcmllc3ZhbHVlSXRlbX1gfX0pOwogICAgICAgICAgICAgICAgICAgICAgICBfY2hhcnRPcHRpb24uc2VyaWVzLnB1c2godGVtcFNlcmllc1RlbXApOwogICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0pCiAgICAgICAgfQogICAgICAgIGlmKE9iamVjdC5rZXlzKHRoaXMuY2hhcnRCYXNlT1B0aW9uKS5sZW5ndGggPiAwKXsKICAgICAgICAgICAgT2JqZWN0LmFzc2lnbihfY2hhcnRPcHRpb24sdGhpcy5jaGFydEJhc2VPUHRpb24pOwogICAgICAgIH0KICAgICAgICBpZihPYmplY3Qua2V5cyh0aGlzLmNoYXJ0VXNlclBhcmFtcykubGVuZ3RoID4wKXsKICAgICAgICAgICAgT2JqZWN0LmFzc2lnbihfY2hhcnRPcHRpb24sdGhpcy5jaGFydFVzZXJQYXJhbXMpOwogICAgICAgIH0KICAgICAgICByZXR1cm4gX2NoYXJ0T3B0aW9uOwogICAgfQoKICAgIC8qKgogICAgICog5a6e5L2T5pWw5o2u6ZuG6L2s5YyW5Li65Zu+6KGo5pWw5o2u6ZuGCiAgICAgKiAKICAgICAqIDEu6I635Y+W5Zu+6KGo5omA5pyJ5Luj56CB6KGo5YC8CiAgICAgKiAyLuafpeivoumbhuWQiOaYoOWwhOWbvuihqOaVsOaNrumbhgogICAgICogMy7ooaXlhajlm77ooajmlbDmja7pm4YKICAgICAqIDQu5Zu+6KGo5pWw5o2u6ZuG5YiG57uE5rGC5ZKMCiAgICAgKiA1LuaOkuW6j+WbvuihqOaVsOaNrumbhgogICAgICogCiAgICAgKiBAcGFyYW0geyp9IGRhdGEg5a6e5L2T5pWw5o2u6ZuGCiAgICAgKiBAcGFyYW0ge0Z1bmN0aW9ufSBjYWxsYmFjayDlm57osIMKICAgICAqIEBtZW1iZXJvZiBEYl9zeXNwb3J0bGV0M19jaGFydEJhc2UKICAgICAqLwogICAgcHVibGljIGFzeW5jIHRyYW5zZm9ybVRvQmFzaWNDaGFydFNldERhdGEoZGF0YTphbnksY2FsbGJhY2s6RnVuY3Rpb24pewogICAgICAgIGlmKCFkYXRhIHx8ICFBcnJheS5pc0FycmF5KGRhdGEpIHx8IGRhdGEubGVuZ3RoID09PSAwKXsKICAgICAgICAgICAgdGhpcy5pc05vRGF0YSA9IHRydWU7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICB9CiAgICAgICAgdGhpcy5pc05vRGF0YSA9IGZhbHNlOwogICAgICAgIC8v6I635Y+W5Luj56CB6KGo5YC8CiAgICAgICAgbGV0IGFsbENvZGVMaXN0OmFueSA9IGF3YWl0IHRoaXMuZ2V0Q2hhcnRBbGxDb2RlTGlzdCgpOwogICAgICAgIGlmKE9iamVjdC52YWx1ZXModGhpcy5zZXJpZXNNb2RlbCkubGVuZ3RoID4gMCl7CiAgICAgICAgICAgIE9iamVjdC52YWx1ZXModGhpcy5zZXJpZXNNb2RlbCkuZm9yRWFjaCgoc2luZ2xlU2VyaWVzOmFueSxpbmRleDpudW1iZXIpID0+ewogICAgICAgICAgICAgICAgLy8g5YC85bGe5oCn5Li6c3JmY291bnTorr7nva57c3JmY291bnQ6MX3liLBkYXRhCiAgICAgICAgICAgICAgICBsZXQgdmFsdWVGaWVsZCA9IHNpbmdsZVNlcmllcy5kYXRhU2V0RmllbGRzLmZpbmQoKGRhdGFzZXRGaWVsZDphbnkpID0+ewogICAgICAgICAgICAgICAgICAgIHJldHVybiBkYXRhc2V0RmllbGQubmFtZSA9PT0gc2luZ2xlU2VyaWVzLnZhbHVlRmllbGQ7CiAgICAgICAgICAgICAgICB9KTsgCiAgICAgICAgICAgICAgICBpZih2YWx1ZUZpZWxkICYmIHZhbHVlRmllbGQubmFtZSAmJiBPYmplY3QuaXModmFsdWVGaWVsZC5uYW1lLCJzcmZjb3VudCIpKXsKICAgICAgICAgICAgICAgICAgICBkYXRhLmZvckVhY2goKHNpbmdsZURhdGE6YW55KSA9PnsKICAgICAgICAgICAgICAgICAgICAgICAgT2JqZWN0LmFzc2lnbihzaW5nbGVEYXRhLHtzcmZjb3VudDoxfSk7CiAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIC8vIOWIhue7hOWxnuaApwogICAgICAgICAgICAgICAgbGV0IGdyb3VwRmllbGQgPSBzaW5nbGVTZXJpZXMuZGF0YVNldEZpZWxkcy5maW5kKChkYXRhc2V0RmllbGQ6YW55KSA9PnsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gZGF0YXNldEZpZWxkLm5hbWUgPT09IHNpbmdsZVNlcmllcy5jYXRlZ29yRmllbGQ7CiAgICAgICAgICAgICAgICB9KTsgCiAgICAgICAgICAgICAgICBsZXQgdGVtcENoYXJ0U2V0RGF0YTpBcnJheTxhbnk+ID0gW107CiAgICAgICAgICAgICAgICBsZXQgdGVtcFNlcmllc1ZhbHVlczpNYXA8c3RyaW5nLGFueT4gPSBuZXcgTWFwKCk7CiAgICAgICAgICAgICAgICBkYXRhLmZvckVhY2goKGl0ZW06YW55KSA9PnsKICAgICAgICAgICAgICAgICAgICBsZXQgdGVtcENoYXJ0U2V0RGF0YUl0ZW06YW55ID0ge307CiAgICAgICAgICAgICAgICAgICAgLy8g5bqP5YiX5bGe5oCn5LiN5a2Y5ZyoCiAgICAgICAgICAgICAgICAgICAgaWYoIXNpbmdsZVNlcmllcy5zZXJpZXNJZEZpZWxkKXsKICAgICAgICAgICAgICAgICAgICAgICAgT2JqZWN0LmFzc2lnbih0ZW1wQ2hhcnRTZXREYXRhSXRlbSx7bmFtZTpzaW5nbGVTZXJpZXMubmFtZX0pOwogICAgICAgICAgICAgICAgICAgICAgICBpZihzaW5nbGVTZXJpZXMuZGF0YVNldEZpZWxkcyAmJiBzaW5nbGVTZXJpZXMuZGF0YVNldEZpZWxkcy5sZW5ndGggPjApewogICAgICAgICAgICAgICAgICAgICAgICAgICAgc2luZ2xlU2VyaWVzLmRhdGFTZXRGaWVsZHMuZm9yRWFjaCgoc2luZ2xlRGF0YVNldEZpZWxkOmFueSkgPT57CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5oYW5kbGVTaW5nbGVEYXRhU2V0RmllbGQoaXRlbSxzaW5nbGVEYXRhU2V0RmllbGQsYWxsQ29kZUxpc3QsdGVtcENoYXJ0U2V0RGF0YUl0ZW0sZ3JvdXBGaWVsZCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfWVsc2V7CiAgICAgICAgICAgICAgICAgICAgICAgIC8vIOW6j+WIl+WxnuaAp+WtmOWcqOaXtgogICAgICAgICAgICAgICAgICAgICAgICAvLyDluo/liJfku6PnoIHooajlrZjlnKjml7Ys57+76K+RdGVtcFNlcmllc1ZhbHVlc+eahOmUruWAvOWvuQogICAgICAgICAgICAgICAgICAgICAgICBpZihzaW5nbGVTZXJpZXMuc2VyaWVzQ29kZUxpc3QpewogICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3Qgc2VyaWVzQ29kZUxpc3Q6TWFwPHN0cmluZyxhbnk+ID0gYWxsQ29kZUxpc3QuZ2V0KHNpbmdsZVNlcmllcy5zZXJpZXNDb2RlTGlzdC50YWcpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgbGV0IHRlbXBTZXJpZXNWYWx1ZUl0ZW0gPSB0ZW1wU2VyaWVzVmFsdWVzLmdldChzZXJpZXNDb2RlTGlzdC5nZXQoaXRlbVtzaW5nbGVTZXJpZXMuc2VyaWVzSWRGaWVsZF0pKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmKCF0ZW1wU2VyaWVzVmFsdWVJdGVtKXsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0ZW1wU2VyaWVzVmFsdWVzLnNldChzZXJpZXNDb2RlTGlzdC5nZXQoaXRlbVtzaW5nbGVTZXJpZXMuc2VyaWVzSWRGaWVsZF0pLHNlcmllc0NvZGVMaXN0LmdldChpdGVtW3NpbmdsZVNlcmllcy5zZXJpZXNJZEZpZWxkXSkpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICB9ZWxzZXsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxldCB0ZW1wU2VyaWVzVmFsdWVJdGVtID0gdGVtcFNlcmllc1ZhbHVlcy5nZXQoaXRlbVtzaW5nbGVTZXJpZXMuc2VyaWVzSWRGaWVsZF0pOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYoIXRlbXBTZXJpZXNWYWx1ZUl0ZW0pewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRlbXBTZXJpZXNWYWx1ZXMuc2V0KGl0ZW1bc2luZ2xlU2VyaWVzLnNlcmllc0lkRmllbGRdLGl0ZW1bc2luZ2xlU2VyaWVzLnNlcmllc05hbWVGaWVsZF0pOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIE9iamVjdC5hc3NpZ24odGVtcENoYXJ0U2V0RGF0YUl0ZW0se25hbWU6aXRlbVtzaW5nbGVTZXJpZXMuc2VyaWVzSWRGaWVsZF19KTsKICAgICAgICAgICAgICAgICAgICAgICAgaWYoc2luZ2xlU2VyaWVzLmRhdGFTZXRGaWVsZHMgJiYgc2luZ2xlU2VyaWVzLmRhdGFTZXRGaWVsZHMubGVuZ3RoID4wKXsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNpbmdsZVNlcmllcy5kYXRhU2V0RmllbGRzLmZvckVhY2goKHNpbmdsZURhdGFTZXRGaWVsZDphbnkpID0+ewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuaGFuZGxlU2luZ2xlRGF0YVNldEZpZWxkKGl0ZW0sc2luZ2xlRGF0YVNldEZpZWxkLGFsbENvZGVMaXN0LHRlbXBDaGFydFNldERhdGFJdGVtLGdyb3VwRmllbGQpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB0ZW1wQ2hhcnRTZXREYXRhLnB1c2godGVtcENoYXJ0U2V0RGF0YUl0ZW0pOwogICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgIC8vIOihpeWFqOaVsOaNrumbhuWQiAogICAgICAgICAgICAgICAgdGhpcy5jb21wbGV0ZURhdGFTZXQodGVtcENoYXJ0U2V0RGF0YSxzaW5nbGVTZXJpZXMsYWxsQ29kZUxpc3QpOwogICAgICAgICAgICAgICAgLy8g5bqP5YiX5Luj56CB6KGo5a2Y5Zyo5pe2LOihpeWFqOW6j+WIlwogICAgICAgICAgICAgICAgaWYoc2luZ2xlU2VyaWVzLnNlcmllc0NvZGVMaXN0KXsKICAgICAgICAgICAgICAgICAgICBjb25zdCBzZXJpZXNDb2RlTGlzdDpNYXA8c3RyaW5nLGFueT4gPSBhbGxDb2RlTGlzdC5nZXQoc2luZ2xlU2VyaWVzLnNlcmllc0NvZGVMaXN0LnRhZyk7CiAgICAgICAgICAgICAgICAgICAgdGVtcFNlcmllc1ZhbHVlcyA9IG5ldyBNYXAoKTsKICAgICAgICAgICAgICAgICAgICBzZXJpZXNDb2RlTGlzdC5mb3JFYWNoKChpdGVtOmFueSkgPT57CiAgICAgICAgICAgICAgICAgICAgICAgIHRlbXBTZXJpZXNWYWx1ZXMuc2V0KGl0ZW0saXRlbSk7CiAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHNpbmdsZVNlcmllcy5zZXJpZXNWYWx1ZXMgPSBbLi4udGVtcFNlcmllc1ZhbHVlcy5rZXlzKCldOwogICAgICAgICAgICAgICAgbGV0IHRlbXBTZXJpZXNNYXBPYmo6YW55ID0ge307CiAgICAgICAgICAgICAgICB0ZW1wU2VyaWVzVmFsdWVzLmZvckVhY2goKHZhbHVlOmFueSxrZXk6YW55KSA9PnsKICAgICAgICAgICAgICAgICAgICB0ZW1wU2VyaWVzTWFwT2JqW2tleV0gPSB2YWx1ZTsKICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICBzaW5nbGVTZXJpZXMuc2VyaWVzTWFwID0gdGVtcFNlcmllc01hcE9iajsKICAgICAgICAgICAgICAgIGxldCBjYWxsYmFja0Z1bmN0aW9uOmFueSA9IChpbmRleCA9PT0gKE9iamVjdC52YWx1ZXModGhpcy5zZXJpZXNNb2RlbCkubGVuZ3RoIC0gMSkpP2NhbGxiYWNrOm51bGw7CiAgICAgICAgICAgICAgICB0aGlzLnRyYW5zZm9ybVRvQ2hhcnRTZXJpZXNEYXRhU2V0KHRlbXBDaGFydFNldERhdGEsc2luZ2xlU2VyaWVzLGNhbGxiYWNrRnVuY3Rpb24sYWxsQ29kZUxpc3QpOwogICAgICAgICAgICB9KQogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIOaehOW7uuWbvuihqOW6j+WIl+aVsOaNrumbhuWQiAogICAgICogCiAgICAgKiAxLuWIhue7hOaxguWSjAogICAgICogMi7mjpLluo/msYLlkozmlbDnu4QKICAgICAqIAogICAgICogQHBhcmFtIHtBcnJheTxhbnk+fSBkYXRhIOS8oOWFpeaVsOaNrgogICAgICogQHBhcmFtIHtBcnJheTxhbnk+fSBpdGVtIOWNleS4quW6j+WIlwogICAgICogQHBhcmFtIHtBcnJheTxhbnk+fSBjYWxsYmFjayDlm57osIMKICAgICAqIEBwYXJhbSB7Kn0gYWxsQ29kZUxpc3Qg5omA5pyJ5Luj56CB6KGoCiAgICAgKiAKICAgICAqIEBtZW1iZXJvZiBEYl9zeXNwb3J0bGV0M19jaGFydEJhc2UKICAgICAqLwogICAgcHVibGljIHRyYW5zZm9ybVRvQ2hhcnRTZXJpZXNEYXRhU2V0KGRhdGE6YW55LGl0ZW06YW55LGNhbGxiYWNrOkZ1bmN0aW9uLGFsbENvZGVMaXN0OmFueSk6YW55ewogICAgICAgIGlmKGl0ZW0uc2VyaWVzSWRGaWVsZCl7CiAgICAgICAgICAgIC8vIOWkmuW6j+WIlwogICAgICAgICAgICBsZXQgZ3JvdXBGaWVsZCA9IGl0ZW0uZGF0YVNldEZpZWxkcy5maWx0ZXIoKGRhdGFzZXRGaWVsZDphbnkpID0+ewogICAgICAgICAgICAgICAgcmV0dXJuIGRhdGFzZXRGaWVsZC5uYW1lID09PSBpdGVtLmNhdGVnb3JGaWVsZDsKICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIGxldCB0ZW1wR3JvdXBGaWVsZDpBcnJheTxhbnk+ID0gZ3JvdXBGaWVsZC5tYXAoKGl0ZW06YW55KSA9PnsKICAgICAgICAgICAgICAgIHJldHVybiBpdGVtLm5hbWU7CiAgICAgICAgICAgIH0pOwogICAgICAgICAgICBsZXQgc2VyaWVzRmllbGQgPSBpdGVtLmRhdGFTZXRGaWVsZHMuZmlsdGVyKChkYXRhc2V0RmllbGQ6YW55KSA9PnsKICAgICAgICAgICAgICAgIHJldHVybiBkYXRhc2V0RmllbGQubmFtZSA9PT0gaXRlbS5zZXJpZXNJZEZpZWxkOwogICAgICAgICAgICB9KTsKICAgICAgICAgICAgbGV0IHRlbXBTZXJpZXNGaWVsZDpBcnJheTxhbnk+ID0gc2VyaWVzRmllbGQubWFwKChpdGVtOmFueSkgPT57CiAgICAgICAgICAgICAgICByZXR1cm4gaXRlbS5uYW1lOwogICAgICAgICAgICB9KTsKICAgICAgICAgICAgbGV0IHZhbHVlRmllbGQgPSBpdGVtLmRhdGFTZXRGaWVsZHMuZmlsdGVyKChkYXRhc2V0RmllbGQ6YW55KSA9PnsKICAgICAgICAgICAgICAgIHJldHVybiBkYXRhc2V0RmllbGQubmFtZSA9PT0gaXRlbS52YWx1ZUZpZWxkOwogICAgICAgICAgICB9KTsKICAgICAgICAgICAgbGV0IHRlbXBWYWx1ZUZpZWxkOkFycmF5PGFueT4gPSB2YWx1ZUZpZWxkLm1hcCgoaXRlbTphbnkpID0+ewogICAgICAgICAgICAgICAgcmV0dXJuIGl0ZW0ubmFtZTsKICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIGl0ZW0uZGF0YSA9IHRoaXMuZ3JvdXBBbmRBZGQodGVtcEdyb3VwRmllbGQsdGVtcFNlcmllc0ZpZWxkLHRlbXBWYWx1ZUZpZWxkLGRhdGEsaXRlbSxncm91cEZpZWxkLGFsbENvZGVMaXN0KTsKICAgICAgICB9ZWxzZXsKICAgICAgICAgICAgLy/ljZXluo/liJcKICAgICAgICAgICAgbGV0IGdyb3VwRmllbGQgPSBpdGVtLmRhdGFTZXRGaWVsZHMuZmlsdGVyKChkYXRhc2V0RmllbGQ6YW55KSA9PnsKICAgICAgICAgICAgICAgIHJldHVybiBkYXRhc2V0RmllbGQubmFtZSA9PT0gaXRlbS5jYXRlZ29yRmllbGQ7CiAgICAgICAgICAgIH0pOwogICAgICAgICAgICBsZXQgdGVtcEdyb3VwRmllbGQ6QXJyYXk8YW55PiA9IGdyb3VwRmllbGQubWFwKChpdGVtOmFueSkgPT57CiAgICAgICAgICAgICAgICByZXR1cm4gaXRlbS5uYW1lOwogICAgICAgICAgICB9KQogICAgICAgICAgICBsZXQgdmFsdWVGaWVsZCA9IGl0ZW0uZGF0YVNldEZpZWxkcy5maWx0ZXIoKGRhdGFzZXRGaWVsZDphbnkpID0+ewogICAgICAgICAgICAgICAgcmV0dXJuIGRhdGFzZXRGaWVsZC5uYW1lID09PSBpdGVtLnZhbHVlRmllbGQ7CiAgICAgICAgICAgIH0pOwogICAgICAgICAgICBsZXQgdGVtcFZhbHVlRmllbGQ6QXJyYXk8YW55PiA9IHZhbHVlRmllbGQubWFwKChpdGVtOmFueSkgPT57CiAgICAgICAgICAgICAgICByZXR1cm4gaXRlbS5uYW1lOwogICAgICAgICAgICB9KQogICAgICAgICAgICBpdGVtLmRhdGEgPSB0aGlzLmdyb3VwQW5kQWRkKHRlbXBHcm91cEZpZWxkLFtdLHRlbXBWYWx1ZUZpZWxkLGRhdGEsaXRlbSxncm91cEZpZWxkLGFsbENvZGVMaXN0KTsKICAgICAgICB9CiAgICAgICAgaWYoY2FsbGJhY2sgJiYgY2FsbGJhY2sgaW5zdGFuY2VvZiBGdW5jdGlvbil7CiAgICAgICAgICAgIGNhbGxiYWNrKGFsbENvZGVMaXN0KTsKICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiDliIbnu4TlkozmsYLlkowgIAogICAgICogQHBhcmFtIHtBcnJheTxhbnk+fSBncm91cEZpZWxkIOWIhue7hOWxnuaApwogICAgICogQHBhcmFtIHtBcnJheTxhbnk+fSBncm91cEZpZWxkIOWAvOWxnuaApwogICAgICogQHBhcmFtIHtBcnJheTxhbnk+fSBkYXRhIOS8oOWFpeaVsOaNrgogICAgICogQHBhcmFtIHsqfSBncm91cEZpZWxkTW9kZWwg5YiG57uE5bGe5oCn5qih5Z6LCiAgICAgKiBAcGFyYW0geyp9IGFsbENvZGVMaXN0IOaJgOacieS7o+eggeihqAogICAgICogCiAgICAgKiBAbWVtYmVyb2YgRGJfc3lzcG9ydGxldDNfY2hhcnRCYXNlCiAgICAgKi8KICAgIHB1YmxpYyBncm91cEFuZEFkZChncm91cEZpZWxkOkFycmF5PGFueT4sc2VyaWVzRmllbGQ6QXJyYXk8YW55Pix2YWx1ZUZpZWxkOkFycmF5PGFueT4sZGF0YTphbnksaXRlbTphbnksZ3JvdXBGaWVsZE1vZGVsOmFueSxhbGxDb2RlTGlzdDphbnkpewogICAgICAgIGxldCB0ZW1wTWFwOk1hcDxzdHJpbmcsYW55PiA9IG5ldyBNYXAoKTsKICAgICAgICBsZXQgZ3JvdXBNb2RlOnN0cmluZyA9IGdyb3VwRmllbGRNb2RlbFswXS5ncm91cE1vZGU7CiAgICAgICAgbGV0IGdyb3VwS2V5U3RyOnN0cmluZyA9ICIiOwogICAgICAgIGRhdGEuZm9yRWFjaCgoaXRlbTphbnkpID0+ewogICAgICAgICAgICBsZXQgdGVtcEdyb3VwRmllbGQ6c3RyaW5nID0gZ3JvdXBGaWVsZFswXTsKICAgICAgICAgICAgZ3JvdXBLZXlTdHIgPSBpdGVtW3RlbXBHcm91cEZpZWxkXTsKICAgICAgICAgICAgbGV0IHRlbXBNYXBJdGVtOmFueSA9IHRlbXBNYXAuZ2V0KGdyb3VwS2V5U3RyKTsKICAgICAgICAgICAgaWYodGVtcE1hcEl0ZW0pewogICAgICAgICAgICAgICAgdGVtcE1hcEl0ZW0ucHVzaChpdGVtKTsKICAgICAgICAgICAgICAgIHRlbXBNYXAuc2V0KGdyb3VwS2V5U3RyLHRlbXBNYXBJdGVtKTsKICAgICAgICAgICAgfWVsc2V7CiAgICAgICAgICAgICAgICB0ZW1wTWFwLnNldChncm91cEtleVN0cixbaXRlbV0pOwogICAgICAgICAgICB9CiAgICAgICAgfSkKICAgICAgICAvLyDlpITnkIblpJrluo/liJcKICAgICAgICBpZihzZXJpZXNGaWVsZC5sZW5ndGggPiAwICYmIHRlbXBNYXAuc2l6ZSA+IDApewogICAgICAgICAgICBsZXQgdGVtcFNlcmllc0ZpZWxkOnN0cmluZyA9IHNlcmllc0ZpZWxkWzBdOwogICAgICAgICAgICB0ZW1wTWFwLmZvckVhY2goKGl0ZW06YW55LGtleTpzdHJpbmcpID0+ewogICAgICAgICAgICAgICAgbGV0IHRlbXBJdGVtTWFwOk1hcDxzdHJpbmcsYW55PiA9IG5ldyBNYXAoKTsKICAgICAgICAgICAgICAgIGl0ZW0uZm9yRWFjaCgoc2luZ2xlSXRlbTphbnkpPT57CiAgICAgICAgICAgICAgICAgICAgbGV0IHNlcmllc1ZhbHVlQXJyYXk6YW55ID0gdGVtcEl0ZW1NYXAuZ2V0KHNpbmdsZUl0ZW1bdGVtcFNlcmllc0ZpZWxkXSk7CiAgICAgICAgICAgICAgICAgICAgaWYoc2VyaWVzVmFsdWVBcnJheSl7CiAgICAgICAgICAgICAgICAgICAgICAgIHNlcmllc1ZhbHVlQXJyYXkucHVzaChzaW5nbGVJdGVtKTsKICAgICAgICAgICAgICAgICAgICAgICAgdGVtcEl0ZW1NYXAuc2V0KHNpbmdsZUl0ZW1bdGVtcFNlcmllc0ZpZWxkXSxzZXJpZXNWYWx1ZUFycmF5KTsKICAgICAgICAgICAgICAgICAgICB9ZWxzZXsKICAgICAgICAgICAgICAgICAgICAgICAgdGVtcEl0ZW1NYXAuc2V0KHNpbmdsZUl0ZW1bdGVtcFNlcmllc0ZpZWxkXSxbc2luZ2xlSXRlbV0pOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICB0ZW1wTWFwLnNldChrZXksdGVtcEl0ZW1NYXApOwogICAgICAgICAgICB9KTsKICAgICAgICB9CiAgICAgICAgbGV0IHJldHVybkFycmF5OkFycmF5PGFueT4gPSBbXTsKICAgICAgICBpZihzZXJpZXNGaWVsZC5sZW5ndGggPT0gMCl7CiAgICAgICAgICAgIC8v5Y2V5bqP5YiXCiAgICAgICAgICAgIHRlbXBNYXAuZm9yRWFjaCgodGVtcEl0ZW06YW55KSA9PnsKICAgICAgICAgICAgICAgIGlmKHRlbXBJdGVtLmxlbmd0aCA+MCl7CiAgICAgICAgICAgICAgICAgICAgbGV0IGN1ck9iamVjdDphbnkgPSB7fTsKICAgICAgICAgICAgICAgICAgICBsZXQgdmFsdWVSZXN1bHQ6bnVtYmVyID0gMDsKICAgICAgICAgICAgICAgICAgICBsZXQgY2F0ZWdvclJlc3VsdDphbnk7CiAgICAgICAgICAgICAgICAgICAgdGVtcEl0ZW0uZm9yRWFjaCgoc2luZ2xlSXRlbTphbnkpID0+ewogICAgICAgICAgICAgICAgICAgICAgICBjYXRlZ29yUmVzdWx0ID0gc2luZ2xlSXRlbVtncm91cEZpZWxkWzBdXTsKICAgICAgICAgICAgICAgICAgICAgICAgdmFsdWVSZXN1bHQgKz0gc2luZ2xlSXRlbVt2YWx1ZUZpZWxkWzBdXTsKICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShjdXJPYmplY3QsIGdyb3VwRmllbGRbMF0sIHsKICAgICAgICAgICAgICAgICAgICAgICAgdmFsdWU6IGNhdGVnb3JSZXN1bHQsCiAgICAgICAgICAgICAgICAgICAgICAgIHdyaXRhYmxlIDogdHJ1ZSwKICAgICAgICAgICAgICAgICAgICAgICAgZW51bWVyYWJsZSA6IHRydWUsCiAgICAgICAgICAgICAgICAgICAgICAgIGNvbmZpZ3VyYWJsZSA6IHRydWUKICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkoY3VyT2JqZWN0LCB2YWx1ZUZpZWxkWzBdLCB7CiAgICAgICAgICAgICAgICAgICAgICAgIHZhbHVlOiB2YWx1ZVJlc3VsdCwKICAgICAgICAgICAgICAgICAgICAgICAgd3JpdGFibGUgOiB0cnVlLAogICAgICAgICAgICAgICAgICAgICAgICBlbnVtZXJhYmxlIDogdHJ1ZSwKICAgICAgICAgICAgICAgICAgICAgICAgY29uZmlndXJhYmxlIDogdHJ1ZQogICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgIHJldHVybkFycmF5LnB1c2goY3VyT2JqZWN0KTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSkKICAgICAgICB9ZWxzZXsKICAgICAgICAgICAgLy8g5aSa5bqP5YiXCiAgICAgICAgICAgIGxldCBzZXJpZXNWYWx1ZXNBcnJheTpBcnJheTxhbnk+ID0gaXRlbS5zZXJpZXNWYWx1ZXM7CiAgICAgICAgICAgIHRlbXBNYXAuZm9yRWFjaCgoZ3JvdXBJdGVtOmFueSxncm91cEtleTpzdHJpbmcpID0+ewogICAgICAgICAgICAgICAgLy/msYLlkowKICAgICAgICAgICAgICAgIGxldCBjdXJPYmplY3Q6YW55ID0ge307CiAgICAgICAgICAgICAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkoY3VyT2JqZWN0LCBncm91cEZpZWxkWzBdLCB7CiAgICAgICAgICAgICAgICAgICAgdmFsdWU6IGdyb3VwS2V5LAogICAgICAgICAgICAgICAgICAgIHdyaXRhYmxlIDogdHJ1ZSwKICAgICAgICAgICAgICAgICAgICBlbnVtZXJhYmxlIDogdHJ1ZSwKICAgICAgICAgICAgICAgICAgICBjb25maWd1cmFibGUgOiB0cnVlCiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIHNlcmllc1ZhbHVlc0FycmF5LmZvckVhY2goKHNlcmllc1ZhbHVlSXRlbTphbnkpID0+ewogICAgICAgICAgICAgICAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShjdXJPYmplY3QsIHNlcmllc1ZhbHVlSXRlbSwgewogICAgICAgICAgICAgICAgICAgICAgICB2YWx1ZTogMCwKICAgICAgICAgICAgICAgICAgICAgICAgd3JpdGFibGUgOiB0cnVlLAogICAgICAgICAgICAgICAgICAgICAgICBlbnVtZXJhYmxlIDogdHJ1ZSwKICAgICAgICAgICAgICAgICAgICAgICAgY29uZmlndXJhYmxlIDogdHJ1ZQogICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICBncm91cEl0ZW0uZm9yRWFjaCgoc2VyaWVzSXRlbTphbnksc2VyaWVzS2V5OnN0cmluZykgPT57CiAgICAgICAgICAgICAgICAgICAgbGV0IHNlcmllc051bTpudW1iZXIgPSAwOwogICAgICAgICAgICAgICAgICAgIHNlcmllc0l0ZW0uZm9yRWFjaCgoZGF0YUl0ZW06YW55KSA9PnsKICAgICAgICAgICAgICAgICAgICAgICAgc2VyaWVzTnVtICs9IGRhdGFJdGVtW3ZhbHVlRmllbGRbMF1dOwogICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgICAgY3VyT2JqZWN0W3Nlcmllc0tleV0gPSBzZXJpZXNOdW07IAogICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgIHJldHVybkFycmF5LnB1c2goY3VyT2JqZWN0KTsKICAgICAgICAgICAgfSkKICAgICAgICB9CiAgICAgICAgLy8g6KGl5YWo56m655m95YiG57G7CiAgICAgICAgaWYocmV0dXJuQXJyYXkubGVuZ3RoID4wKXsKICAgICAgICAgICAgbGV0IGVtcHR5VGV4dCA9IChncm91cEZpZWxkTW9kZWxbMF0gJiYgZ3JvdXBGaWVsZE1vZGVsWzBdLmNvZGVMaXN0KT9ncm91cEZpZWxkTW9kZWxbMF0uY29kZUxpc3QuZW1wdHl0ZXh0OiLmnKrlrprkuYkiOwogICAgICAgICAgICByZXR1cm5BcnJheS5mb3JFYWNoKChpdGVtOmFueSkgPT57CiAgICAgICAgICAgICAgICBpZighaXRlbVtncm91cEZpZWxkWzBdXSl7CiAgICAgICAgICAgICAgICAgICAgaXRlbVtncm91cEZpZWxkWzBdXSA9IGVtcHR5VGV4dDsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSkKICAgICAgICB9CiAgICAgICAgcmV0dXJuQXJyYXkgPSB0aGlzLnNvcnRSZXR1cm5BcnJheShyZXR1cm5BcnJheSxncm91cEZpZWxkTW9kZWwsYWxsQ29kZUxpc3QpOwogICAgICAgIC8vIOmbt+i+vuWbvuaVsOaNruagvOW8j+WkhOeQhgogICAgICAgIGlmKE9iamVjdC5pcyhpdGVtLnR5cGUsJ3JhZGFyJykgJiYgcmV0dXJuQXJyYXkubGVuZ3RoID4wKXsKICAgICAgICAgICAgbGV0IHRlbXBSZXR1cm5BcnJheTpBcnJheTxhbnk+ID0gW107CiAgICAgICAgICAgIGxldCBzZXJpZXNWYWx1ZXM6QXJyYXk8YW55PiA9IGl0ZW0uc2VyaWVzVmFsdWVzOwogICAgICAgICAgICBpZihzZXJpZXNWYWx1ZXMgJiYgc2VyaWVzVmFsdWVzLmxlbmd0aCA+MCl7CiAgICAgICAgICAgICAgICBzZXJpZXNWYWx1ZXMuZm9yRWFjaCgoc2luZ2xlU2VyaWVzTmFtZTphbnkpID0+ewogICAgICAgICAgICAgICAgICAgIGxldCBzaW5nbGVTZXJpZXNPYmo6YW55ID0ge307CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuQXJyYXkuZm9yRWFjaCgoaXRlbTphbnkpID0+ewogICAgICAgICAgICAgICAgICAgICAgICBPYmplY3QuYXNzaWduKHNpbmdsZVNlcmllc09iaix7W2l0ZW1bZ3JvdXBGaWVsZFswXV1dOml0ZW1bc2luZ2xlU2VyaWVzTmFtZV19KTsKICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgICAgIE9iamVjdC5hc3NpZ24oc2luZ2xlU2VyaWVzT2JqLHt0eXBlOnNpbmdsZVNlcmllc05hbWV9KTsKICAgICAgICAgICAgICAgICAgICB0ZW1wUmV0dXJuQXJyYXkucHVzaChzaW5nbGVTZXJpZXNPYmopOwogICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm5BcnJheSA9IHRlbXBSZXR1cm5BcnJheTsKICAgICAgICB9CiAgICAgICAgY29uc29sZS5sb2coSlNPTi5zdHJpbmdpZnkocmV0dXJuQXJyYXkpKTsKICAgICAgICByZXR1cm4gcmV0dXJuQXJyYXk7CiAgICB9CgogICAgLyoqCiAgICAgKiDmjpLluo/mlbDnu4QKICAgICAqIAogICAgICogQHBhcmFtIHtBcnJheTxhbnk+fSBhcnIg5Lyg5YWl5pWw57uECiAgICAgKiBAcGFyYW0geyp9IGdyb3VwRmllbGQg5YiG57uE5bGe5oCnCiAgICAgKiBAcGFyYW0geyp9IGFsbENvZGVMaXN0IOaJgOacieS7o+eggeihqAogICAgICogCiAgICAgKiBAbWVtYmVyb2YgRGJfc3lzcG9ydGxldDNfY2hhcnRCYXNlCiAgICAgKi8KICAgIHB1YmxpYyBzb3J0UmV0dXJuQXJyYXkoYXJyOkFycmF5PGFueT4sZ3JvdXBGaWVsZDphbnksYWxsQ29kZUxpc3Q6YW55KXsKICAgICAgICBsZXQgcmV0dXJuQXJyYXk6QXJyYXk8YW55PiA9IFtdOwogICAgICAgIC8vIHRvZG8KICAgICAgICAvLyDliIbnu4TlsZ7mgKfmnInku6PnoIHooajnmoTmg4XlhrUo5pyA5ZCO5omn6KGMKQogICAgICAgIGlmKGdyb3VwRmllbGRbMF0uY29kZWxpc3QpewogICAgICAgICAgICBsZXQgY3VyQ29kZUxpc3Q6TWFwPG51bWJlcixhbnk+ID0gYWxsQ29kZUxpc3QuZ2V0KGdyb3VwRmllbGRbMF0uY29kZWxpc3QudGFnKTsKICAgICAgICAgICAgY3VyQ29kZUxpc3QuZm9yRWFjaCgoY29kZWxpc3Q6YW55KSA9PnsKICAgICAgICAgICAgICAgIGFyci5mb3JFYWNoKChpdGVtOmFueSkgPT57CiAgICAgICAgICAgICAgICAgICAgaWYoT2JqZWN0LmlzKGl0ZW1bZ3JvdXBGaWVsZFswXS5uYW1lXSxjb2RlbGlzdCkpewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm5BcnJheS5wdXNoKGl0ZW0pOwogICAgICAgICAgICAgICAgICAgICAgICBpdGVtLmhhc3VzZWQgPSB0cnVlOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgIH0pCiAgICAgICAgICAgIGFyci5mb3JFYWNoKChpdGVtOmFueSxpbmRleDpudW1iZXIpID0+ewogICAgICAgICAgICAgICAgaWYoIWl0ZW0uaGFzdXNlZCl7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuQXJyYXkucHVzaChpdGVtKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSkKICAgICAgICAgICAgcmV0dXJuQXJyYXkuZm9yRWFjaCgoaXRlbTphbnkpID0+ewogICAgICAgICAgICAgICAgZGVsZXRlIGl0ZW0uaGFzdXNlZDsKICAgICAgICAgICAgfSkKICAgICAgICB9ZWxzZXsKICAgICAgICAgICAgLy8g5YiG57uE5Li65bm05Lu9CiAgICAgICAgICAgIGlmKE9iamVjdC5pcyhncm91cEZpZWxkWzBdLmdyb3VwTW9kZSwiWUVBUiIpKXsKICAgICAgICAgICAgICAgIHJldHVybkFycmF5ID0gYXJyLnNvcnQoKGE6YW55LCBiOmFueSkgPT4gewogICAgICAgICAgICAgICAgICAgIHJldHVybiBOdW1iZXIoYVtncm91cEZpZWxkWzBdLm5hbWVdKSAtIE51bWJlcihiW2dyb3VwRmllbGRbMF0ubmFtZV0pOwogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH1lbHNlIGlmKE9iamVjdC5pcyhncm91cEZpZWxkWzBdLmdyb3VwTW9kZSwiUVVBUlRFUiIpKXsKICAgICAgICAgICAgICAgIHJldHVybkFycmF5ID0gdGhpcy5oYW5kbGVTb3J0R3JvdXBEYXRhKGFycixncm91cEZpZWxkLCLlraPluqYiKTsKICAgICAgICAgICAgfWVsc2UgaWYoT2JqZWN0LmlzKGdyb3VwRmllbGRbMF0uZ3JvdXBNb2RlLCJNT05USCIpKXsKICAgICAgICAgICAgICAgIHJldHVybkFycmF5ID0gdGhpcy5oYW5kbGVTb3J0R3JvdXBEYXRhKGFycixncm91cEZpZWxkLCLmnIgiKTsKICAgICAgICAgICAgfWVsc2UgaWYoT2JqZWN0LmlzKGdyb3VwRmllbGRbMF0uZ3JvdXBNb2RlLCJZRUFSV0VFSyIpKXsKICAgICAgICAgICAgICAgIHJldHVybkFycmF5ID0gdGhpcy5oYW5kbGVTb3J0R3JvdXBEYXRhKGFycixncm91cEZpZWxkLCLlkagiKTsKICAgICAgICAgICAgfWVsc2UgaWYoT2JqZWN0LmlzKGdyb3VwRmllbGRbMF0uZ3JvdXBNb2RlLCJEQVkiKSl7CiAgICAgICAgICAgICAgICByZXR1cm5BcnJheSA9IGFyci5zb3J0KChhOmFueSwgYjphbnkpID0+IHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gbW9tZW50KGFbZ3JvdXBGaWVsZFswXS5uYW1lXSkudW5peCgpIC0gbW9tZW50KGJbZ3JvdXBGaWVsZFswXS5uYW1lXSkudW5peCgpOwogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH1lbHNlewogICAgICAgICAgICAgICAgbGV0IGdyb3VwRmllbGROYW1lOnN0cmluZyA9IGdyb3VwRmllbGRbMF0ubmFtZTsKICAgICAgICAgICAgICAgIGxldCBpc0NvbnZlcnQ6Ym9vbGVhbiA9IHRydWU7CiAgICAgICAgICAgICAgICBhcnIuZm9yRWFjaCgoaXRlbTphbnkpID0+ewogICAgICAgICAgICAgICAgICAgIGlmKGlzTmFOKGl0ZW1bZ3JvdXBGaWVsZE5hbWVdKSl7CiAgICAgICAgICAgICAgICAgICAgICAgIGlzQ29udmVydCA9IGZhbHNlOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICBpZihpc0NvbnZlcnQpewogICAgICAgICAgICAgICAgICAgIHJldHVybkFycmF5ID0gYXJyLnNvcnQoKGE6YW55LCBiOmFueSkgPT4gewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gYVtncm91cEZpZWxkTmFtZV0gLSBiW2dyb3VwRmllbGROYW1lXTsKICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIH1lbHNlewogICAgICAgICAgICAgICAgICAgIHJldHVybkFycmF5ID0gYXJyOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIHJldHVybiByZXR1cm5BcnJheTsKICAgIH0KCiAgICAvKioKICAgICAqIOaOkuW6j+WIhue7hOaooeW8j+S4i+eahOaVsOaNrgogICAgICogCiAgICAgKiBAcGFyYW0ge0FycmF5PGFueT59IGFyciDkvKDlhaXmlbDmja4KICAgICAqIEBwYXJhbSB7QXJyYXk8YW55Pn0gZ3JvdXBGaWVsZCDliIbnu4TlsZ7mgKcKICAgICAqIEBwYXJhbSB7QXJyYXk8YW55Pn0gbGFiZWwgbGFiZWzmoIfnrb4KICAgICAqIAogICAgICogQG1lbWJlcm9mIERiX3N5c3BvcnRsZXQzX2NoYXJ0QmFzZQogICAgICovCiAgICBwdWJsaWMgaGFuZGxlU29ydEdyb3VwRGF0YShhcnI6QXJyYXk8YW55Pixncm91cEZpZWxkOmFueSxsYWJlbDpzdHJpbmcpewogICAgICAgIGFyci5mb3JFYWNoKChpdGVtOmFueSkgPT57CiAgICAgICAgICAgIGxldCBzb3J0RmllbGRWYWx1ZTpBcnJheTxhbnk+ID0gaXRlbVtncm91cEZpZWxkWzBdLm5hbWVdLnNwbGl0KCItIik7CiAgICAgICAgICAgIE9iamVjdC5hc3NpZ24oaXRlbSx7c29ydEZpZWxkOk51bWJlcihzb3J0RmllbGRWYWx1ZVswXSkqMTAwMDArTnVtYmVyKHNvcnRGaWVsZFZhbHVlWzFdKX0pOwogICAgICAgICAgICBpdGVtW2dyb3VwRmllbGRbMF0ubmFtZV0gPSBzb3J0RmllbGRWYWx1ZVswXSsi5bm0Iitzb3J0RmllbGRWYWx1ZVsxXStsYWJlbDsKICAgICAgICB9KQogICAgICAgIGFyci5zb3J0KChhOmFueSwgYjphbnkpID0+IHsKICAgICAgICAgICAgcmV0dXJuIE51bWJlcihhLnNvcnRGaWVsZCkgLSBOdW1iZXIoYi5zb3J0RmllbGQpOwogICAgICAgIH0pOwogICAgICAgIGFyci5mb3JFYWNoKChpdGVtOmFueSkgPT57CiAgICAgICAgICAgIGRlbGV0ZSBpdGVtLnNvcnRGaWVsZDsKICAgICAgICB9KQogICAgICAgIHJldHVybiBhcnI7CiAgICB9CgogICAgLyoqCiAgICAgKiDooaXlhajmlbDmja7pm4YKICAgICAqIAogICAgICogQHBhcmFtIHtBcnJheTxhbnk+fSBkYXRhIOS8oOWFpeaVsOaNrgogICAgICogQHBhcmFtIHtBcnJheTxhbnk+fSBpdGVtIOWNleS4quW6j+WIlwogICAgICogQHBhcmFtIHtBcnJheTxhbnk+fSBhbGxDb2RlTGlzdCDmiYDmnInnmoTku6PnoIHooagKICAgICAqIAogICAgICogQG1lbWJlcm9mIERiX3N5c3BvcnRsZXQzX2NoYXJ0QmFzZQogICAgICovCiAgICBwdWJsaWMgY29tcGxldGVEYXRhU2V0KGRhdGE6YW55LGl0ZW06YW55LGFsbENvZGVMaXN0OmFueSl7CiAgICAgICAgLy8g5YiG57uE5bGe5oCnCiAgICAgICAgbGV0IGdyb3VwRmllbGQgPSBpdGVtLmRhdGFTZXRGaWVsZHMuZmluZCgoZGF0YXNldEZpZWxkOmFueSkgPT57CiAgICAgICAgICAgIHJldHVybiBkYXRhc2V0RmllbGQubmFtZSA9PT0gaXRlbS5jYXRlZ29yRmllbGQ7CiAgICAgICAgfSk7CiAgICAgICAgaWYoT2JqZWN0LmlzKGdyb3VwRmllbGQuZ3JvdXBNb2RlLCIiKSl7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICB9CiAgICAgICAgLy/liIbnu4TmqKHlvI/kuLrku6PnoIHooajvvIjooaXlgLzvvIkKICAgICAgICBpZihPYmplY3QuaXMoZ3JvdXBGaWVsZC5ncm91cE1vZGUsJ0NPREVMSVNUJykpewogICAgICAgICAgICB0aGlzLmNvbXBsZXRlQ29kZUxpc3QoZGF0YSxpdGVtLGFsbENvZGVMaXN0KTsKICAgICAgICB9CiAgICAgICAgLy/liIbnu4TmqKHlvI/kuLrlubQv5a2j5bqmL+aciOS7ve+8iOacgOWkp+WAvO+8jOacgOWwj+WAvO+8jOWIhue7hO+8jOihpeWAvO+8iQogICAgICAgIGlmKE9iamVjdC5pcyhncm91cEZpZWxkLmdyb3VwTW9kZSwiWUVBUiIpIHx8IE9iamVjdC5pcyhncm91cEZpZWxkLmdyb3VwTW9kZSwiUVVBUlRFUiIpIHx8IE9iamVjdC5pcyhncm91cEZpZWxkLmdyb3VwTW9kZSwiTU9OVEgiKSB8fCBPYmplY3QuaXMoZ3JvdXBGaWVsZC5ncm91cE1vZGUsIllFQVJXRUVLIikgIHx8IE9iamVjdC5pcyhncm91cEZpZWxkLmdyb3VwTW9kZSwiREFZIikpewogICAgICAgICAgICB0aGlzLmhhbmRsZVRpbWVEYXRhKGRhdGEsaXRlbSxhbGxDb2RlTGlzdCxncm91cEZpZWxkKTsKICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiDojrflj5bmnIDlpKflgLzmnIDlsI/lgLwKICAgICAqIAogICAgICogQHBhcmFtIHtBcnJheTxhbnk+fSB0ZW1wVGltZUFycmF5IOS8oOWFpeaVsOaNrgogICAgICogCiAgICAgKiBAbWVtYmVyb2YgRGJfc3lzcG9ydGxldDNfY2hhcnRCYXNlCiAgICAgKi8KICAgIHB1YmxpYyAgZ2V0UmFuZ2VEYXRhKHRlbXBUaW1lQXJyYXk6QXJyYXk8YW55Pil7CiAgICAgICAgdGVtcFRpbWVBcnJheS5mb3JFYWNoKChpdGVtOmFueSkgPT57CiAgICAgICAgICAgIGxldCB0ZW1wUGFyYW1zOkFycmF5PGFueT4gPSBpdGVtLl9pLnNwbGl0KCItIik7CiAgICAgICAgICAgIGl0ZW0uc29ydEZpZWxkID0gTnVtYmVyKHRlbXBQYXJhbXNbMF0gKyB0ZW1wUGFyYW1zWzFdKTsKICAgICAgICB9KQogICAgICAgIHRlbXBUaW1lQXJyYXkuc29ydCgoYTphbnksIGI6YW55KSA9PiB7CiAgICAgICAgICAgIHJldHVybiBOdW1iZXIoYS5zb3J0RmllbGQpIC0gTnVtYmVyKGIuc29ydEZpZWxkKTsKICAgICAgICB9KTsKICAgICAgICB0ZW1wVGltZUFycmF5LmZvckVhY2goKGl0ZW06YW55KSA9PnsKICAgICAgICAgICAgZGVsZXRlIGl0ZW0uc29ydEZpZWxkOwogICAgICAgIH0pCiAgICAgICAgcmV0dXJuIHRlbXBUaW1lQXJyYXk7CiAgICB9CgogICAvKioKICAgICAqIOihpeWFqOaXtumXtOexu+Wei+aVsOaNrumbhgogICAgICogCiAgICAgKiBAcGFyYW0ge0FycmF5PGFueT59IGRhdGEg5Lyg5YWl5pWw5o2uCiAgICAgKiBAcGFyYW0ge0FycmF5PGFueT59IGl0ZW0g5Y2V5Liq5bqP5YiXCiAgICAgKiBAcGFyYW0ge0FycmF5PGFueT59IGFsbENvZGVMaXN0IOaJgOacieeahOS7o+eggeihqAogICAgICogQHBhcmFtIHtBcnJheTxhbnk+fSBncm91cEZpZWxkIOWIhue7hOWxnuaApwogICAgICogCiAgICAgKiBAbWVtYmVyb2YgRGJfc3lzcG9ydGxldDNfY2hhcnRCYXNlCiAgICAgKi8KICAgIHB1YmxpYyBoYW5kbGVUaW1lRGF0YShkYXRhOmFueSxpdGVtOmFueSxhbGxDb2RlTGlzdDphbnksZ3JvdXBGaWVsZDphbnkpewogICAgICAgIGxldCB2YWx1ZUZpZWxkID0gaXRlbS5kYXRhU2V0RmllbGRzLmZpbmQoKGRhdGFzZXRGaWVsZDphbnkpID0+ewogICAgICAgICAgICByZXR1cm4gZGF0YXNldEZpZWxkLm5hbWUgPT09IGl0ZW0udmFsdWVGaWVsZDsKICAgICAgICB9KTsKICAgICAgICBsZXQgZ3JvdXBNb2RlOnN0cmluZyA9IGdyb3VwRmllbGQuZ3JvdXBNb2RlOwogICAgICAgIC8vIOaOkuW6j+aVsOaNru+8jOaJvuWIsOacgOWkp+WAvOOAgeacgOWwj+WAvAogICAgICAgIGxldCB0ZW1wVGltZUFycmF5OkFycmF5PGFueT4gPSBbXTsKICAgICAgICBpZihkYXRhICYmIGRhdGEubGVuZ3RoID4wKXsKICAgICAgICAgICAgZGF0YS5mb3JFYWNoKChkYXRhSXRlbTphbnkpID0+ewogICAgICAgICAgICAgICAgLy8g5Yik5pat5pe26Ze057G75Z6L5piv5ZCm5Li656m677yM5Li656m65LiN5aSE55CGCiAgICAgICAgICAgICAgICBpZihkYXRhSXRlbVtncm91cEZpZWxkLm5hbWVdKXsKICAgICAgICAgICAgICAgICAgICB0ZW1wVGltZUFycmF5LnB1c2gobW9tZW50KGRhdGFJdGVtW2dyb3VwRmllbGQubmFtZV0pKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSkKICAgICAgICB9CiAgICAgICAgbGV0IG1heFRpbWU6YW55OwogICAgICAgIGxldCBtaW5UaW1lOmFueTsKICAgICAgICBpZihPYmplY3QuaXMoZ3JvdXBNb2RlLCJZRUFSIikgfHwgT2JqZWN0LmlzKGdyb3VwTW9kZSwiREFZIikpewogICAgICAgICAgICBtYXhUaW1lID0gbW9tZW50Lm1heCh0ZW1wVGltZUFycmF5KTsKICAgICAgICAgICAgbWluVGltZSA9IG1vbWVudC5taW4odGVtcFRpbWVBcnJheSk7CiAgICAgICAgfQogICAgICAgIGlmKE9iamVjdC5pcyhncm91cE1vZGUsIlFVQVJURVIiKSl7CiAgICAgICAgICAgIHRlbXBUaW1lQXJyYXkgPSB0aGlzLmdldFJhbmdlRGF0YSh0ZW1wVGltZUFycmF5KTsKICAgICAgICAgICAgbWluVGltZSA9IG1vbWVudCgpLnllYXIoKHRlbXBUaW1lQXJyYXlbMF0uX2kuc3BsaXQoIi0iKSlbMF0pLnF1YXJ0ZXJzKCh0ZW1wVGltZUFycmF5WzBdLl9pLnNwbGl0KCItIikpWzFdKTsKICAgICAgICAgICAgbWF4VGltZSA9IG1vbWVudCgpLnllYXIoKHRlbXBUaW1lQXJyYXlbdGVtcFRpbWVBcnJheS5sZW5ndGggLSAxXS5faS5zcGxpdCgiLSIpKVswXSkucXVhcnRlcnMoKHRlbXBUaW1lQXJyYXlbdGVtcFRpbWVBcnJheS5sZW5ndGggLSAxXS5faS5zcGxpdCgiLSIpKVsxXSk7CiAgICAgICAgfQogICAgICAgIGlmKE9iamVjdC5pcyhncm91cE1vZGUsIk1PTlRIIikpewogICAgICAgICAgICB0ZW1wVGltZUFycmF5ID0gdGhpcy5nZXRSYW5nZURhdGEodGVtcFRpbWVBcnJheSk7CiAgICAgICAgICAgIG1pblRpbWUgPSBtb21lbnQoKS55ZWFyKCh0ZW1wVGltZUFycmF5WzBdLl9pLnNwbGl0KCItIikpWzBdKS5tb250aCgodGVtcFRpbWVBcnJheVswXS5faS5zcGxpdCgiLSIpKVsxXSk7CiAgICAgICAgICAgIG1heFRpbWUgPSBtb21lbnQoKS55ZWFyKCh0ZW1wVGltZUFycmF5W3RlbXBUaW1lQXJyYXkubGVuZ3RoIC0gMV0uX2kuc3BsaXQoIi0iKSlbMF0pLm1vbnRoKCh0ZW1wVGltZUFycmF5W3RlbXBUaW1lQXJyYXkubGVuZ3RoIC0gMV0uX2kuc3BsaXQoIi0iKSlbMV0pOwogICAgICAgIH0KICAgICAgICBpZihPYmplY3QuaXMoZ3JvdXBNb2RlLCJZRUFSV0VFSyIpKXsKICAgICAgICAgICAgdGVtcFRpbWVBcnJheSA9IHRoaXMuZ2V0UmFuZ2VEYXRhKHRlbXBUaW1lQXJyYXkpOwogICAgICAgICAgICBtaW5UaW1lID0gbW9tZW50KCkueWVhcigodGVtcFRpbWVBcnJheVswXS5faS5zcGxpdCgiLSIpKVswXSkud2VlaygodGVtcFRpbWVBcnJheVswXS5faS5zcGxpdCgiLSIpKVsxXSk7CiAgICAgICAgICAgIG1heFRpbWUgPSBtb21lbnQoKS55ZWFyKCh0ZW1wVGltZUFycmF5W3RlbXBUaW1lQXJyYXkubGVuZ3RoIC0gMV0uX2kuc3BsaXQoIi0iKSlbMF0pLndlZWsoKHRlbXBUaW1lQXJyYXlbdGVtcFRpbWVBcnJheS5sZW5ndGggLSAxXS5faS5zcGxpdCgiLSIpKVsxXSk7CiAgICAgICAgfQogICAgICAgIGxldCB0aW1lRnJhZ21lbnRBcnJheTpBcnJheTxhbnk+ID0gW107CiAgICAgICAgbGV0IHRlbXBHcm91bnBEYXRhOk1hcDxzdHJpbmcsYW55PiA9IG5ldyBNYXAoKTsKICAgICAgICAvLyDml7bpl7TliIbmrrUKICAgICAgICAvL2dyb3VwTW9kZeS4uiJZRUFSIgogICAgICAgIGlmKE9iamVjdC5pcyhncm91cE1vZGUsIllFQVIiKSl7CiAgICAgICAgICAgIGxldCBjdXJUaW1lOmFueSA9IG1pblRpbWU7CiAgICAgICAgICAgIHdoaWxlKGN1clRpbWUpewogICAgICAgICAgICAgICAgaWYoY3VyVGltZS5pc1NhbWVPckJlZm9yZShtYXhUaW1lKSl7CiAgICAgICAgICAgICAgICAgICAgbGV0IHRlbXBjdXJUaW1lOmFueSA9IGN1clRpbWUuY2xvbmUoKTsKICAgICAgICAgICAgICAgICAgICB0aW1lRnJhZ21lbnRBcnJheS5wdXNoKHRlbXBjdXJUaW1lLnllYXIoKS50b1N0cmluZygpKTsKICAgICAgICAgICAgICAgICAgICBjdXJUaW1lID0gdGVtcGN1clRpbWUuY2xvbmUoKS5hZGQoMSwgJ3llYXJzJyk7CiAgICAgICAgICAgICAgICB9ZWxzZXsKICAgICAgICAgICAgICAgICAgICBjdXJUaW1lID0gbnVsbDsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICAvL2dyb3VwTW9kZeS4uiJRVUFSVEVSIgogICAgICAgIGlmKE9iamVjdC5pcyhncm91cE1vZGUsIlFVQVJURVIiKSl7CiAgICAgICAgICAgIGxldCBjdXJUaW1lOmFueSA9IG1pblRpbWU7CiAgICAgICAgICAgIHdoaWxlKGN1clRpbWUpewogICAgICAgICAgICAgICAgaWYoY3VyVGltZS5pc1NhbWVPckJlZm9yZShtYXhUaW1lKSl7CiAgICAgICAgICAgICAgICAgICAgbGV0IHRlbXBjdXJUaW1lOmFueSA9IGN1clRpbWUuY2xvbmUoKTsKICAgICAgICAgICAgICAgICAgICB0aW1lRnJhZ21lbnRBcnJheS5wdXNoKHRlbXBjdXJUaW1lLnllYXIoKS50b1N0cmluZygpKyItIit0ZW1wY3VyVGltZS5xdWFydGVyKCkudG9TdHJpbmcoKSk7CiAgICAgICAgICAgICAgICAgICAgY3VyVGltZSA9IHRlbXBjdXJUaW1lLmNsb25lKCkuYWRkKDEsICdxdWFydGVycycpOwogICAgICAgICAgICAgICAgfWVsc2V7CiAgICAgICAgICAgICAgICAgICAgY3VyVGltZSA9IG51bGw7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgLy9ncm91cE1vZGXkuLoiTU9OVEgiCiAgICAgICAgaWYoT2JqZWN0LmlzKGdyb3VwTW9kZSwiTU9OVEgiKSl7CiAgICAgICAgICAgIGxldCBjdXJUaW1lOmFueSA9IG1pblRpbWU7CiAgICAgICAgICAgIHdoaWxlKGN1clRpbWUpewogICAgICAgICAgICAgICAgaWYoY3VyVGltZS5pc1NhbWVPckJlZm9yZShtYXhUaW1lKSl7CiAgICAgICAgICAgICAgICAgICAgbGV0IHRlbXBjdXJUaW1lOmFueSA9IGN1clRpbWUuY2xvbmUoKTsKICAgICAgICAgICAgICAgICAgICB0aW1lRnJhZ21lbnRBcnJheS5wdXNoKHRlbXBjdXJUaW1lLnllYXIoKS50b1N0cmluZygpKyItIit0ZW1wY3VyVGltZS5tb250aCgpLnRvU3RyaW5nKCkpOwogICAgICAgICAgICAgICAgICAgIGN1clRpbWUgPSB0ZW1wY3VyVGltZS5jbG9uZSgpLmFkZCgxLCAnbW9udGhzJyk7CiAgICAgICAgICAgICAgICB9ZWxzZXsKICAgICAgICAgICAgICAgICAgICBjdXJUaW1lID0gbnVsbDsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICAvL2dyb3VwTW9kZeS4uiJZRUFSV0VFSyIKICAgICAgICBpZihPYmplY3QuaXMoZ3JvdXBNb2RlLCJZRUFSV0VFSyIpKXsKICAgICAgICAgICAgbGV0IGN1clRpbWU6YW55ID0gbWluVGltZTsKICAgICAgICAgICAgd2hpbGUoY3VyVGltZSl7CiAgICAgICAgICAgICAgICBpZihjdXJUaW1lLmlzU2FtZU9yQmVmb3JlKG1heFRpbWUpKXsKICAgICAgICAgICAgICAgICAgICBsZXQgdGVtcGN1clRpbWU6YW55ID0gY3VyVGltZS5jbG9uZSgpOwogICAgICAgICAgICAgICAgICAgIHRpbWVGcmFnbWVudEFycmF5LnB1c2godGVtcGN1clRpbWUueWVhcigpLnRvU3RyaW5nKCkrIi0iK3RlbXBjdXJUaW1lLndlZWsoKS50b1N0cmluZygpKTsKICAgICAgICAgICAgICAgICAgICBjdXJUaW1lID0gdGVtcGN1clRpbWUuY2xvbmUoKS5hZGQoMSwgJ3dlZWtzJyk7CiAgICAgICAgICAgICAgICB9ZWxzZXsKICAgICAgICAgICAgICAgICAgICBjdXJUaW1lID0gbnVsbDsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICAvL2dyb3VwTW9kZeS4uiJEQVkiCiAgICAgICAgaWYoT2JqZWN0LmlzKGdyb3VwTW9kZSwiREFZIikpewogICAgICAgICAgICBsZXQgY3VyVGltZTphbnkgPSBtaW5UaW1lOwogICAgICAgICAgICB3aGlsZShjdXJUaW1lKXsKICAgICAgICAgICAgICAgIGlmKGN1clRpbWUuaXNTYW1lT3JCZWZvcmUobWF4VGltZSkpewogICAgICAgICAgICAgICAgICAgIGxldCB0ZW1wY3VyVGltZTphbnkgPSBjdXJUaW1lLmNsb25lKCk7CiAgICAgICAgICAgICAgICAgICAgdGltZUZyYWdtZW50QXJyYXkucHVzaCh0ZW1wY3VyVGltZS5mb3JtYXQoJ1lZWVktTU0tREQnKSk7CiAgICAgICAgICAgICAgICAgICAgY3VyVGltZSA9IHRlbXBjdXJUaW1lLmNsb25lKCkuYWRkKDEsICdkYXlzJyk7CiAgICAgICAgICAgICAgICB9ZWxzZXsKICAgICAgICAgICAgICAgICAgICBjdXJUaW1lID0gbnVsbDsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBkYXRhLmZvckVhY2goKGl0ZW06YW55KSA9PnsKICAgICAgICAgICAgbGV0IHRlbXBLZXlTdHI6c3RyaW5nID0gaXRlbVtncm91cEZpZWxkLm5hbWVdOwogICAgICAgICAgICBsZXQgdGVtcEdyb3VucEl0ZW06YW55ID0gdGVtcEdyb3VucERhdGEuZ2V0KHRlbXBLZXlTdHIpOwogICAgICAgICAgICBpZighdGVtcEdyb3VucEl0ZW0pewogICAgICAgICAgICAgICAgdGVtcEdyb3VucERhdGEuc2V0KHRlbXBLZXlTdHIsaXRlbSk7CiAgICAgICAgICAgIH0KICAgICAgICB9KQogICAgICAgIHRpbWVGcmFnbWVudEFycmF5LmZvckVhY2goKHRpbWVGcmFnbWVudDphbnkpID0+ewogICAgICAgICAgICBpZighdGVtcEdyb3VucERhdGEuZ2V0KHRpbWVGcmFnbWVudCkpewogICAgICAgICAgICAgICAgbGV0IGNvcHlUZW1wOmFueSA9IEpTT04ucGFyc2UoSlNPTi5zdHJpbmdpZnkoZGF0YVswXSkpOwogICAgICAgICAgICAgICAgbGV0IGN1ck9iajphbnkgPSB7fTsKICAgICAgICAgICAgICAgIGN1ck9ialtncm91cEZpZWxkLm5hbWVdID0gdGltZUZyYWdtZW50OwogICAgICAgICAgICAgICAgY3VyT2JqW3ZhbHVlRmllbGQubmFtZV0gPSAwOwogICAgICAgICAgICAgICAgT2JqZWN0LmFzc2lnbihjb3B5VGVtcCxjdXJPYmopOwogICAgICAgICAgICAgICAgZGF0YS5wdXNoKGNvcHlUZW1wKTsKICAgICAgICAgICAgfQogICAgICAgIH0pCiAgICB9CgogICAgLyoqCiAgICAgKiDooaXlhajku6PnoIHooagKICAgICAqIAogICAgICogQHBhcmFtIHtBcnJheTxhbnk+fSBkYXRhIOS8oOWFpeaVsOaNrgogICAgICogQHBhcmFtIHtBcnJheTxhbnk+fSBpdGVtIOWNleS4quW6j+WIlwogICAgICogQHBhcmFtIHtBcnJheTxhbnk+fSBhbGxDb2RlTGlzdCDmiYDmnInnmoTku6PnoIHooagKICAgICAqIAogICAgICogQG1lbWJlcm9mIERiX3N5c3BvcnRsZXQzX2NoYXJ0QmFzZQogICAgICovCiAgICBwdWJsaWMgIGNvbXBsZXRlQ29kZUxpc3QoZGF0YTphbnksaXRlbTphbnksYWxsQ29kZUxpc3Q6YW55KXsKICAgICAgICBsZXQgZ3JvdXBGaWVsZCA9IGl0ZW0uZGF0YVNldEZpZWxkcy5maW5kKChkYXRhc2V0RmllbGQ6YW55KSA9PnsKICAgICAgICAgICAgcmV0dXJuIGRhdGFzZXRGaWVsZC5uYW1lID09PSBpdGVtLmNhdGVnb3JGaWVsZDsKICAgICAgICB9KTsKICAgICAgICBpZighZ3JvdXBGaWVsZC5jb2RlbGlzdCl7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICB9CiAgICAgICAgbGV0IHZhbHVlRmllbGQgPSBpdGVtLmRhdGFTZXRGaWVsZHMuZmluZCgoZGF0YXNldEZpZWxkOmFueSkgPT57CiAgICAgICAgICAgIHJldHVybiBkYXRhc2V0RmllbGQubmFtZSA9PT0gaXRlbS52YWx1ZUZpZWxkOwogICAgICAgIH0pOwogICAgICAgIGxldCBjdXJDb2RlTGlzdDpNYXA8bnVtYmVyLGFueT4gPSBhbGxDb2RlTGlzdC5nZXQoZ3JvdXBGaWVsZC5jb2RlbGlzdC50YWcpOwogICAgICAgIC8vIOWvueWIhuexu+WunueOsOWIhue7hAogICAgICAgIGxldCB0ZW1wR3JvdW5wRGF0YTpNYXA8c3RyaW5nLGFueT4gPSBuZXcgTWFwKCk7CiAgICAgICAgZGF0YS5mb3JFYWNoKChpdGVtOmFueSkgPT57CiAgICAgICAgICAgIGxldCB0ZW1wR3JvdW5wSXRlbTphbnkgPSB0ZW1wR3JvdW5wRGF0YS5nZXQoaXRlbVtncm91cEZpZWxkLm5hbWUrJ19zcmZ2YWx1ZSddKTsKICAgICAgICAgICAgaWYoIXRlbXBHcm91bnBJdGVtKXsKICAgICAgICAgICAgICAgIHRlbXBHcm91bnBEYXRhLnNldChpdGVtW2dyb3VwRmllbGQubmFtZSsnX3NyZnZhbHVlJ10saXRlbSk7CiAgICAgICAgICAgIH0KICAgICAgICB9KQogICAgICAgIGlmKGN1ckNvZGVMaXN0LnNpemUgIT09IHRlbXBHcm91bnBEYXRhLnNpemUpewogICAgICAgICAgICBjdXJDb2RlTGlzdC5mb3JFYWNoKCh0ZXh0OmFueSx2YWx1ZTphbnkpID0+ewogICAgICAgICAgICAgICAgaWYoIXRlbXBHcm91bnBEYXRhLmdldCh2YWx1ZSkpewogICAgICAgICAgICAgICAgICAgIGxldCBjb3B5VGVtcDphbnkgPSBKU09OLnBhcnNlKEpTT04uc3RyaW5naWZ5KGRhdGFbMF0pKTsKICAgICAgICAgICAgICAgICAgICBsZXQgY3VyT2JqOmFueSA9IHt9OwogICAgICAgICAgICAgICAgICAgIGN1ck9ialtncm91cEZpZWxkLm5hbWUrJ19zcmZ2YWx1ZSddID0gdmFsdWU7CiAgICAgICAgICAgICAgICAgICAgY3VyT2JqW2dyb3VwRmllbGQubmFtZV0gPSB0ZXh0OwogICAgICAgICAgICAgICAgICAgIGN1ck9ialt2YWx1ZUZpZWxkLm5hbWVdID0gMDsKICAgICAgICAgICAgICAgICAgICBPYmplY3QuYXNzaWduKGNvcHlUZW1wLGN1ck9iaik7CiAgICAgICAgICAgICAgICAgICAgZGF0YS5wdXNoKGNvcHlUZW1wKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSkKICAgICAgICB9ICAKICAgIH0KCiAgICAvKioKICAgICAqIOWkhOeQhuWNleS4quWxnuaApwogICAgICogCiAgICAgKiBAcGFyYW0geyp9IGlucHV0IOi+k+WFpeWAvAogICAgICogQHBhcmFtIHsqfSBmaWVsZCDlsZ7mgKflgLwKICAgICAqIEBwYXJhbSB7Kn0gYWxsQ29kZUxpc3Qg5omA5pyJ5Luj56CB6KGoCiAgICAgKiBAcGFyYW0geyp9IHJlc3VsdCDnu5PmnpzlgLwKICAgICAqIAogICAgICogQG1lbWJlcm9mIERiX3N5c3BvcnRsZXQzX2NoYXJ0QmFzZQogICAgICovCiAgICBwdWJsaWMgaGFuZGxlU2luZ2xlRGF0YVNldEZpZWxkKGlucHV0OmFueSxmaWVsZDphbnksYWxsQ29kZUxpc3Q6YW55LHJlc3VsdDphbnksZ3JvdXBGaWVsZDphbnkpewogICAgICAgIGxldCB0ZW1wRmllbGRPYmo6YW55ID0ge307CiAgICAgICAgLy/lrZjlnKjku6PnoIHooajnmoTmg4XlhrUo6Ieq5Yqo6L2s5YyW5YC8KQogICAgICAgIGlmKGZpZWxkLmNvZGVsaXN0KXsKICAgICAgICAgICAgLy/ojrflj5bku6PnoIHooagKICAgICAgICAgICAgbGV0IGN1ckNvZGVMaXN0Ok1hcDxudW1iZXIsYW55PiA9IGFsbENvZGVMaXN0LmdldChmaWVsZC5jb2RlbGlzdC50YWcpOwogICAgICAgICAgICB0ZW1wRmllbGRPYmpbZmllbGQubmFtZV0gPSBjdXJDb2RlTGlzdC5nZXQoaW5wdXRbZmllbGQubmFtZV0pOwogICAgICAgICAgICB0ZW1wRmllbGRPYmpbZmllbGQubmFtZSsnX3NyZnZhbHVlJ10gPSBpbnB1dFtmaWVsZC5uYW1lXTsKICAgICAgICB9ZWxzZXsKICAgICAgICAgICAgIC8vIOS4jeWtmOWcqOS7o+eggeihqOeahOaDheWGtQogICAgICAgICAgICBpZihncm91cEZpZWxkICYmIE9iamVjdC5pcyhncm91cEZpZWxkLm5hbWUsZmllbGQubmFtZSkpewogICAgICAgICAgICAgICAgaWYoT2JqZWN0LmlzKGdyb3VwRmllbGQuZ3JvdXBNb2RlLCJZRUFSIikgKXsKICAgICAgICAgICAgICAgICAgICB0ZW1wRmllbGRPYmpbZmllbGQubmFtZV0gPSBtb21lbnQoaW5wdXRbZmllbGQubmFtZV0pLnllYXIoKS50b1N0cmluZygpOwogICAgICAgICAgICAgICAgfWVsc2UgaWYoT2JqZWN0LmlzKGdyb3VwRmllbGQuZ3JvdXBNb2RlLCJRVUFSVEVSIikgKXsKICAgICAgICAgICAgICAgICAgICB0ZW1wRmllbGRPYmpbZmllbGQubmFtZV0gPSBtb21lbnQoaW5wdXRbZmllbGQubmFtZV0pLnllYXIoKS50b1N0cmluZygpKyItIittb21lbnQoaW5wdXRbZmllbGQubmFtZV0pLnF1YXJ0ZXJzKCkudG9TdHJpbmcoKTsKICAgICAgICAgICAgICAgIH1lbHNlIGlmKE9iamVjdC5pcyhncm91cEZpZWxkLmdyb3VwTW9kZSwiTU9OVEgiKSApewogICAgICAgICAgICAgICAgICAgIHRlbXBGaWVsZE9ialtmaWVsZC5uYW1lXSA9IG1vbWVudChpbnB1dFtmaWVsZC5uYW1lXSkueWVhcigpLnRvU3RyaW5nKCkrIi0iK21vbWVudChpbnB1dFtmaWVsZC5uYW1lXSkubW9udGgoKS50b1N0cmluZygpOwogICAgICAgICAgICAgICAgfWVsc2UgaWYoT2JqZWN0LmlzKGdyb3VwRmllbGQuZ3JvdXBNb2RlLCJZRUFSV0VFSyIpICl7CiAgICAgICAgICAgICAgICAgICAgdGVtcEZpZWxkT2JqW2ZpZWxkLm5hbWVdID0gbW9tZW50KGlucHV0W2ZpZWxkLm5hbWVdKS55ZWFyKCkudG9TdHJpbmcoKSsiLSIrbW9tZW50KGlucHV0W2ZpZWxkLm5hbWVdKS53ZWVrKCkudG9TdHJpbmcoKTsKICAgICAgICAgICAgICAgIH1lbHNlIGlmKE9iamVjdC5pcyhncm91cEZpZWxkLmdyb3VwTW9kZSwiREFZIikgKXsKICAgICAgICAgICAgICAgICAgICB0ZW1wRmllbGRPYmpbZmllbGQubmFtZV0gPSBtb21lbnQoaW5wdXRbZmllbGQubmFtZV0pLmZvcm1hdCgiWVlZWS1NTS1ERCIpOwogICAgICAgICAgICAgICAgfWVsc2V7CiAgICAgICAgICAgICAgICAgICAgdGVtcEZpZWxkT2JqW2ZpZWxkLm5hbWVdID0gaW5wdXRbZmllbGQubmFtZV07CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH1lbHNlewogICAgICAgICAgICAgICAgdGVtcEZpZWxkT2JqW2ZpZWxkLm5hbWVdID0gaW5wdXRbZmllbGQubmFtZV0KICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBPYmplY3QuYXNzaWduKHJlc3VsdCx0ZW1wRmllbGRPYmopOwogICAgfQoKICAgIC8qKgogICAgICog6I635Y+W5Zu+6KGo5omA6ZyA5Luj56CB6KGoCiAgICAgKiAKICAgICAqIEBtZW1iZXJvZiBEYl9zeXNwb3J0bGV0M19jaGFydEJhc2UKICAgICAqLwogICAgcHVibGljIGdldENoYXJ0QWxsQ29kZUxpc3QoKTpQcm9taXNlPGFueT57CiAgICAgICAgcmV0dXJuIG5ldyBQcm9taXNlKChyZXNvbHZlOmFueSxyZWplY3Q6YW55KSA9PnsKICAgICAgICAgICAgbGV0IGNvZGVMaXN0TWFwOk1hcDxzdHJpbmcsYW55PiA9IG5ldyBNYXAoKTsKICAgICAgICAgICAgaWYoT2JqZWN0LnZhbHVlcyh0aGlzLnNlcmllc01vZGVsKS5sZW5ndGggPjApewogICAgICAgICAgICAgICAgbGV0IHRlbXBGbGFnOmJvb2xlYW4gPSB0cnVlOwogICAgICAgICAgICAgICAgT2JqZWN0LnZhbHVlcyh0aGlzLnNlcmllc01vZGVsKS5mb3JFYWNoKChzaW5nbGVTZXJpZXM6YW55KSA9PnsKICAgICAgICAgICAgICAgICAgICBpZihzaW5nbGVTZXJpZXMuZGF0YVNldEZpZWxkcyAmJiBzaW5nbGVTZXJpZXMuZGF0YVNldEZpZWxkcy5sZW5ndGggPjApewogICAgICAgICAgICAgICAgICAgICAgICBsZXQgcHJvbWlzZUFycmF5OkFycmF5PGFueT4gPSBbXTsKICAgICAgICAgICAgICAgICAgICAgICAgbGV0IHByb21pc2VLZXlBcnJheTpBcnJheTxhbnk+ID0gW107CiAgICAgICAgICAgICAgICAgICAgICAgIHNpbmdsZVNlcmllcy5kYXRhU2V0RmllbGRzLmZvckVhY2goKHNpbmdsZURhdGFTZXRGaWVsZDphbnksaW5kZXg6YW55KSA9PnsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmKHNpbmdsZURhdGFTZXRGaWVsZC5jb2RlbGlzdCl7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGVtcEZsYWcgPSBmYWxzZTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZighY29kZUxpc3RNYXAuZ2V0KHNpbmdsZURhdGFTZXRGaWVsZC5jb2RlbGlzdC50YWcpKXsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcHJvbWlzZUFycmF5LnB1c2godGhpcy5nZXRDb2RlTGlzdChzaW5nbGVEYXRhU2V0RmllbGQuY29kZWxpc3QpKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcHJvbWlzZUtleUFycmF5LnB1c2goc2luZ2xlRGF0YVNldEZpZWxkLmNvZGVsaXN0LnRhZyk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFByb21pc2UuYWxsKHByb21pc2VBcnJheSkudGhlbigocmVzdWx0OmFueSkgPT57CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZihyZXN1bHQgJiYgcmVzdWx0Lmxlbmd0aCA+MCl7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVzdWx0LmZvckVhY2goKGNvZGVMaXN0OmFueSkgPT57CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxldCB0ZW1wQ29kZUxpc3RNYXA6TWFwPG51bWJlcixhbnk+ID0gbmV3IE1hcCgpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZihjb2RlTGlzdC5sZW5ndGggPjApewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29kZUxpc3QuZm9yRWFjaCgoY29kZUxpc3RJdGVtOmFueSkgPT57CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGVtcENvZGVMaXN0TWFwLnNldChjb2RlTGlzdEl0ZW0udmFsdWUsY29kZUxpc3RJdGVtLnRleHQpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb2RlTGlzdE1hcC5zZXQoc2luZ2xlRGF0YVNldEZpZWxkLmNvZGVsaXN0LnRhZyx0ZW1wQ29kZUxpc3RNYXApOyAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlc29sdmUoY29kZUxpc3RNYXApOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgaWYodGVtcEZsYWcpe3Jlc29sdmUoY29kZUxpc3RNYXApO30KICAgICAgICAgICAgfWVsc2V7CiAgICAgICAgICAgICAgICByZXNvbHZlKGNvZGVMaXN0TWFwKTsKICAgICAgICAgICAgfQogICAgICAgIH0pCiAgICB9CgogICAgLyoqCiAgICAgKiDojrflj5bku6PnoIHooagKICAgICAqIAogICAgICogQHJldHVybnMge1Byb21pc2U8YW55Pn0gCiAgICAgKiBAbWVtYmVyb2YgRGJfc3lzcG9ydGxldDNfY2hhcnRCYXNlCiAgICAgKi8KICAgIHB1YmxpYyBnZXRDb2RlTGlzdChjb2RlTGlzdE9iamVjdDphbnkpOlByb21pc2U8YW55PnsKICAgICAgICByZXR1cm4gbmV3IFByb21pc2UoKHJlc29sdmU6YW55LHJlamVjdDphbnkpID0+ewogICAgICAgICAgICBpZihjb2RlTGlzdE9iamVjdC50YWcgJiYgT2JqZWN0LmlzKGNvZGVMaXN0T2JqZWN0LnR5cGUsIlNUQVRJQyIpKXsKICAgICAgICAgICAgICAgIGNvbnN0IGNvZGVsaXN0ID0gdGhpcy4kc3RvcmUuZ2V0dGVycy5nZXRDb2RlTGlzdChjb2RlTGlzdE9iamVjdC50YWcpOwogICAgICAgICAgICAgICAgaWYgKGNvZGVsaXN0KSB7CiAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZShbLi4uSlNPTi5wYXJzZShKU09OLnN0cmluZ2lmeShjb2RlbGlzdC5pdGVtcykpXSk7CiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKGAtLS0tJHtjb2RlTGlzdE9iamVjdC50YWd9LS0tLeS7o+eggeihqOS4jeWtmOWcqGApOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9ZWxzZSBpZihjb2RlTGlzdE9iamVjdC50YWcgJiYgT2JqZWN0LmlzKGNvZGVMaXN0T2JqZWN0LnR5cGUsIkRZTkFNSUMiKSl7CiAgICAgICAgICAgICAgICB0aGlzLmNvZGVMaXN0U2VydmljZS5nZXRJdGVtcyhjb2RlTGlzdE9iamVjdC50YWcpLnRoZW4oKHJlczphbnkpID0+IHsKICAgICAgICAgICAgICAgICAgICByZXNvbHZlKHJlcyk7CiAgICAgICAgICAgICAgICB9KS5jYXRjaCgoZXJyb3I6YW55KSA9PiB7CiAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coYC0tLS0ke2NvZGVMaXN0T2JqZWN0LnRhZ30tLS0t5Luj56CB6KGo5LiN5a2Y5ZyoYCk7CiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfQogICAgICAgIH0pCiAgICB9CgoKfQo="},null]}
{"remainingRequest":"F:\\crod项目\\人事管理系统2\\iBizEHR\\app_EHRPim\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!F:\\crod项目\\人事管理系统2\\iBizEHR\\app_EHRPim\\src\\widgets\\pim-contract\\main-3-grid\\main-3-grid-base.vue?vue&type=script&lang=tsx&","dependencies":[{"path":"F:\\crod项目\\人事管理系统2\\iBizEHR\\app_EHRPim\\src\\widgets\\pim-contract\\main-3-grid\\main-3-grid-base.vue","mtime":1630509411441},{"path":"F:\\crod项目\\人事管理系统2\\iBizEHR\\app_EHRPim\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1630511852775},{"path":"F:\\crod项目\\人事管理系统2\\iBizEHR\\app_EHRPim\\node_modules\\thread-loader\\dist\\cjs.js","mtime":1630511853252},{"path":"F:\\crod项目\\人事管理系统2\\iBizEHR\\app_EHRPim\\node_modules\\babel-loader\\lib\\index.js","mtime":1630511852747},{"path":"F:\\crod项目\\人事管理系统2\\iBizEHR\\app_EHRPim\\node_modules\\ts-loader\\index.js","mtime":1630511985412},{"path":"F:\\crod项目\\人事管理系统2\\iBizEHR\\app_EHRPim\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1630511852775},{"path":"F:\\crod项目\\人事管理系统2\\iBizEHR\\app_EHRPim\\node_modules\\vue-loader\\lib\\index.js","mtime":1630512070338}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:CgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgppbXBvcnQgeyBWdWUsIENvbXBvbmVudCwgUHJvcCwgUHJvdmlkZSwgRW1pdCwgV2F0Y2gsIE1vZGVsLEluamVjdCB9IGZyb20gJ3Z1ZS1wcm9wZXJ0eS1kZWNvcmF0b3InOwppbXBvcnQgeyBDcmVhdGVFbGVtZW50IH0gZnJvbSAndnVlJzsKaW1wb3J0IHsgU3ViamVjdCwgU3Vic2NyaXB0aW9uIH0gZnJvbSAncnhqcyc7CmltcG9ydCB7IENvbnRyb2xJbnRlcmZhY2UgfSBmcm9tICdAL2ludGVyZmFjZS9jb250cm9sJzsKaW1wb3J0IHsgVUlBY3Rpb25Ub29sLFV0aWwgfSBmcm9tICdAL3V0aWxzJzsKaW1wb3J0IE5hdkRhdGFTZXJ2aWNlIGZyb20gJ0Avc2VydmljZS9hcHAvbmF2ZGF0YS1zZXJ2aWNlJzsKaW1wb3J0IFBpbUNvbnRyYWN0U2VydmljZSBmcm9tICdAL3NlcnZpY2UvcGltLWNvbnRyYWN0L3BpbS1jb250cmFjdC1zZXJ2aWNlJzsKaW1wb3J0IE1haW5fM1NlcnZpY2UgZnJvbSAnLi9tYWluLTMtZ3JpZC1zZXJ2aWNlJzsKCmltcG9ydCBDb2RlTGlzdFNlcnZpY2UgZnJvbSAiQHNlcnZpY2UvYXBwL2NvZGVsaXN0LXNlcnZpY2UiOwppbXBvcnQgeyBGb3JtSXRlbU1vZGVsIH0gZnJvbSAnQC9tb2RlbC9mb3JtLWRldGFpbCc7CgoKQENvbXBvbmVudCh7CiAgICBjb21wb25lbnRzOiB7CiAgICAgIAogICAgfQp9KQpleHBvcnQgZGVmYXVsdCBjbGFzcyBNYWluXzNCYXNlIGV4dGVuZHMgVnVlIGltcGxlbWVudHMgQ29udHJvbEludGVyZmFjZSB7CgogICAgLyoqCiAgICAgKiDlkI3np7AKICAgICAqCiAgICAgKiBAdHlwZSB7c3RyaW5nfQogICAgICogQG1lbWJlcm9mIE1haW5fM0Jhc2UKICAgICAqLwogICAgQFByb3AoKSBwdWJsaWMgbmFtZT86IHN0cmluZzsKCiAgICAvKioKICAgICAqIOinhuWbvumAmuiur+WvueixoQogICAgICoKICAgICAqIEB0eXBlIHtTdWJqZWN0PFZpZXdTdGF0ZT59CiAgICAgKiBAbWVtYmVyb2YgTWFpbl8zQmFzZQogICAgICovCiAgICBAUHJvcCgpIHB1YmxpYyB2aWV3U3RhdGUhOiBTdWJqZWN0PFZpZXdTdGF0ZT47CgogICAgLyoqCiAgICAgKiDlupTnlKjkuIrkuIvmlocKICAgICAqCiAgICAgKiBAdHlwZSB7Kn0KICAgICAqIEBtZW1iZXJvZiBNYWluXzNCYXNlCiAgICAgKi8KICAgIEBQcm9wKCkgcHVibGljIGNvbnRleHQ6IGFueTsKCiAgICAvKioKICAgICAqIOinhuWbvuWPguaVsAogICAgICoKICAgICAqIEB0eXBlIHsqfQogICAgICogQG1lbWJlcm9mIE1haW5fM0Jhc2UKICAgICAqLwogICAgQFByb3AoKSBwdWJsaWMgdmlld3BhcmFtczogYW55OwoKICAgIC8qKgogICAgICog6KeG5Zu+54q25oCB5LqL5Lu2CiAgICAgKgogICAgICogQHB1YmxpYwogICAgICogQHR5cGUgeyhTdWJzY3JpcHRpb24gfCB1bmRlZmluZWQpfQogICAgICogQG1lbWJlcm9mIE1haW5fM0Jhc2UKICAgICAqLwogICAgcHVibGljIHZpZXdTdGF0ZUV2ZW50OiBTdWJzY3JpcHRpb24gfCB1bmRlZmluZWQ7CgogICAgLyoqCiAgICAgKiDojrflj5bpg6jku7bnsbvlnosKICAgICAqCiAgICAgKiBAcmV0dXJucyB7c3RyaW5nfQogICAgICogQG1lbWJlcm9mIE1haW5fM0Jhc2UKICAgICAqLwogICAgcHVibGljIGdldENvbnRyb2xUeXBlKCk6IHN0cmluZyB7CiAgICAgICAgcmV0dXJuICdHUklEJwogICAgfQoKCgogICAgLyoqCiAgICAgKiDorqHmlbDlmajmnI3liqHlr7nosaHpm4blkIgKICAgICAqCiAgICAgKiBAdHlwZSB7QXJyYXk8Kj59CiAgICAgKiBAbWVtYmVyb2YgTWFpbl8zQmFzZQogICAgICovICAgIAogICAgcHVibGljIGNvdW50ZXJTZXJ2aWNlQXJyYXk6QXJyYXk8YW55PiA9IFtdOwoKICAgIC8qKgogICAgICog5bu65p6E6YOo5Lu25pyN5Yqh5a+56LGhCiAgICAgKgogICAgICogQHR5cGUge01haW5fM1NlcnZpY2V9CiAgICAgKiBAbWVtYmVyb2YgTWFpbl8zQmFzZQogICAgICovCiAgICBwdWJsaWMgc2VydmljZTogTWFpbl8zU2VydmljZSA9IG5ldyBNYWluXzNTZXJ2aWNlKHsgJHN0b3JlOiB0aGlzLiRzdG9yZSB9KTsKCiAgICAvKioKICAgICAqIOWunuS9k+acjeWKoeWvueixoQogICAgICoKICAgICAqIEB0eXBlIHtQaW1Db250cmFjdFNlcnZpY2V9CiAgICAgKiBAbWVtYmVyb2YgTWFpbl8zQmFzZQogICAgICovCiAgICBwdWJsaWMgYXBwRW50aXR5U2VydmljZTogUGltQ29udHJhY3RTZXJ2aWNlID0gbmV3IFBpbUNvbnRyYWN0U2VydmljZSh7ICRzdG9yZTogdGhpcy4kc3RvcmUgfSk7CiAgICAKCgogICAgLyoqCiAgICAgKiDlhbPpl63op4blm74KICAgICAqCiAgICAgKiBAcGFyYW0ge2FueX0gYXJncwogICAgICogQG1lbWJlcm9mIE1haW5fM0Jhc2UKICAgICAqLwogICAgcHVibGljIGNsb3NlVmlldyhhcmdzOiBhbnkpOiB2b2lkIHsKICAgICAgICBsZXQgX3RoaXM6IGFueSA9IHRoaXM7CiAgICAgICAgX3RoaXMuJGVtaXQoJ2Nsb3NldmlldycsIFthcmdzXSk7CiAgICB9CgogICAgLyoqCiAgICAgKiAg6K6h5pWw5Zmo5Yi35pawCiAgICAgKgogICAgICogQG1lbWJlcm9mIE1haW5fM0Jhc2UKICAgICAqLwogICAgcHVibGljIGNvdW50ZXJSZWZyZXNoKCl7CiAgICAgICAgY29uc3QgX3RoaXM6YW55ID10aGlzOwogICAgICAgIGlmKF90aGlzLmNvdW50ZXJTZXJ2aWNlQXJyYXkgJiYgX3RoaXMuY291bnRlclNlcnZpY2VBcnJheS5sZW5ndGggPjApewogICAgICAgICAgICBfdGhpcy5jb3VudGVyU2VydmljZUFycmF5LmZvckVhY2goKGl0ZW06YW55KSA9PnsKICAgICAgICAgICAgICAgIGlmKGl0ZW0ucmVmcmVzaERhdGEgJiYgaXRlbS5yZWZyZXNoRGF0YSBpbnN0YW5jZW9mIEZ1bmN0aW9uKXsKICAgICAgICAgICAgICAgICAgICBpdGVtLnJlZnJlc2hEYXRhKCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0pCiAgICAgICAgfQogICAgfQoKCiAgICAvKioKICAgICAqIOS7o+eggeihqOacjeWKoeWvueixoQogICAgICoKICAgICAqIEB0eXBlIHtDb2RlTGlzdFNlcnZpY2V9CiAgICAgKiBAbWVtYmVyb2YgTWFpbl8zQmFzZQogICAgICovICAKICAgIHB1YmxpYyBjb2RlTGlzdFNlcnZpY2U6Q29kZUxpc3RTZXJ2aWNlID0gbmV3IENvZGVMaXN0U2VydmljZSh7ICRzdG9yZTogdGhpcy4kc3RvcmUgfSk7CgogICAgLyoqCiAgICAgKiDojrflj5blpJrpobnmlbDmja4KICAgICAqCiAgICAgKiBAcmV0dXJucyB7YW55W119CiAgICAgKiBAbWVtYmVyb2YgTWFpbl8zQmFzZQogICAgICovCiAgICBwdWJsaWMgZ2V0RGF0YXMoKTogYW55W10gewogICAgICAgIHJldHVybiB0aGlzLnNlbGVjdGlvbnM7CiAgICB9CgogICAgLyoqCiAgICAgKiDojrflj5bljZXpobnmoJEKICAgICAqCiAgICAgKiBAcmV0dXJucyB7Kn0KICAgICAqIEBtZW1iZXJvZiBNYWluXzNCYXNlCiAgICAgKi8KICAgIHB1YmxpYyBnZXREYXRhKCk6IGFueSB7CiAgICAgICAgcmV0dXJuIHRoaXMuc2VsZWN0aW9uc1swXTsKICAgIH0KCiAgICAvKioKICAgICAqIOaJk+W8gOaWsOW7uuaVsOaNruinhuWbvgogICAgICoKICAgICAqIEB0eXBlIHthbnl9CiAgICAgKiBAbWVtYmVyb2YgTWFpbl8zQmFzZQogICAgICovCiAgICBAUHJvcCgpIHB1YmxpYyBuZXdkYXRhOiBhbnk7CiAgICAvKioKICAgICAqIOaJk+W8gOe8lui+keaVsOaNruinhuWbvgogICAgICoKICAgICAqIEB0eXBlIHthbnl9CiAgICAgKiBAbWVtYmVyb2YgTWFpbl8zQmFzZQogICAgICovCiAgICBAUHJvcCgpIHB1YmxpYyBvcGVuZGF0YTogYW55OwoKICAgIC8qKgogICAgICog5pi+56S65aSE55CG5o+Q56S6CiAgICAgKgogICAgICogQHR5cGUge2Jvb2xlYW59CiAgICAgKiBAbWVtYmVyb2YgTWFpbl8zQmFzZQogICAgICovCiAgICBAUHJvcCh7IGRlZmF1bHQ6IHRydWUgfSkgcHVibGljIHNob3dCdXN5SW5kaWNhdG9yPzogYm9vbGVhbjsKCiAgICAvKioKICAgICAqIOmDqOS7tuihjOS4ui0tdXBkYXRlCiAgICAgKgogICAgICogQHR5cGUge3N0cmluZ30KICAgICAqIEBtZW1iZXJvZiBNYWluXzNCYXNlCiAgICAgKi8KICAgIEBQcm9wKCkgcHVibGljIHVwZGF0ZUFjdGlvbiE6IHN0cmluZzsKICAgIAogICAgLyoqCiAgICAgKiDpg6jku7booYzkuLotLWZldGNoCiAgICAgKgogICAgICogQHR5cGUge3N0cmluZ30KICAgICAqIEBtZW1iZXJvZiBNYWluXzNCYXNlCiAgICAgKi8KICAgIEBQcm9wKCkgcHVibGljIGZldGNoQWN0aW9uITogc3RyaW5nOwogICAgCiAgICAvKioKICAgICAqIOmDqOS7tuihjOS4ui0tcmVtb3ZlCiAgICAgKgogICAgICogQHR5cGUge3N0cmluZ30KICAgICAqIEBtZW1iZXJvZiBNYWluXzNCYXNlCiAgICAgKi8KICAgIEBQcm9wKCkgcHVibGljIHJlbW92ZUFjdGlvbiE6IHN0cmluZzsKICAgIAogICAgLyoqCiAgICAgKiDpg6jku7booYzkuLotLWxvYWQKICAgICAqCiAgICAgKiBAdHlwZSB7c3RyaW5nfQogICAgICogQG1lbWJlcm9mIE1haW5fM0Jhc2UKICAgICAqLwogICAgQFByb3AoKSBwdWJsaWMgbG9hZEFjdGlvbiE6IHN0cmluZzsKICAgIAogICAgLyoqCiAgICAgKiDpg6jku7booYzkuLotLWxvYWRkcmFmdAogICAgICoKICAgICAqIEB0eXBlIHtzdHJpbmd9CiAgICAgKiBAbWVtYmVyb2YgTWFpbl8zQmFzZQogICAgICovCiAgICBAUHJvcCgpIHB1YmxpYyBsb2FkZHJhZnRBY3Rpb24hOiBzdHJpbmc7CiAgICAKICAgIC8qKgogICAgICog6YOo5Lu26KGM5Li6LS1jcmVhdGUKICAgICAqCiAgICAgKiBAdHlwZSB7c3RyaW5nfQogICAgICogQG1lbWJlcm9mIE1haW5fM0Jhc2UKICAgICAqLwogICAgQFByb3AoKSBwdWJsaWMgY3JlYXRlQWN0aW9uITogc3RyaW5nOwoKICAgIC8qKgogICAgICog5b2T5YmN6aG1CiAgICAgKgogICAgICogQHR5cGUge251bWJlcn0KICAgICAqIEBtZW1iZXJvZiBNYWluXzNCYXNlCiAgICAgKi8KICAgIHB1YmxpYyBjdXJQYWdlOiBudW1iZXIgPSAxOwoKICAgIC8qKgogICAgICog5pWw5o2uCiAgICAgKgogICAgICogQHR5cGUge2FueVtdfQogICAgICogQG1lbWJlcm9mIE1haW5fM0Jhc2UKICAgICAqLwogICAgcHVibGljIGl0ZW1zOiBhbnlbXSA9IFtdOwoKICAgIC8qKgogICAgICog5piv5ZCm5pSv5oyB5YiG6aG1CiAgICAgKgogICAgICogQHR5cGUge2Jvb2xlYW59CiAgICAgKiBAbWVtYmVyb2YgTWFpbl8zQmFzZQogICAgICovCiAgICBwdWJsaWMgaXNFbmFibGVQYWdpbmdCYXI6IGJvb2xlYW4gPSB0cnVlOwoKICAgIC8qKgogICAgICog5piv5ZCm56aB55So5o6S5bqPCiAgICAgKgogICAgICogQHR5cGUge2Jvb2xlYW59CiAgICAgKiBAbWVtYmVyb2YgTWFpbl8zQmFzZQogICAgICovCiAgICBwdWJsaWMgaXNOb1NvcnQ6IGJvb2xlYW4gPSBmYWxzZTsKCiAgICAvKioKICAgICAqIOaOkuW6j+aWueWQkQogICAgICoKICAgICAqIEB0eXBlIHtzdHJpbmd9CiAgICAgKiBAbWVtYmVyb2YgTWFpbl8zQmFzZQogICAgICovCiAgICBwdWJsaWMgbWlub3JTb3J0RGlyOiBzdHJpbmcgPSAnREVTQyc7CgogICAgLyoqCiAgICAgKiDmjpLluo/lrZfmrrUKICAgICAqCiAgICAgKiBAdHlwZSB7c3RyaW5nfQogICAgICogQG1lbWJlcm9mIE1haW5fM0Jhc2UKICAgICAqLwogICAgcHVibGljIG1pbm9yU29ydFBTREVGOiBzdHJpbmcgPSAnanNycSc7CgogICAgLyoqCiAgICAgKiDliIbpobXmnaHmlbAKICAgICAqCiAgICAgKiBAdHlwZSB7bnVtYmVyfQogICAgICogQG1lbWJlcm9mIE1haW5fM0Jhc2UKICAgICAqLwogICAgcHVibGljIGxpbWl0OiBudW1iZXIgPSAxMDA7CgogICAgLyoqCiAgICAgKiDmmK/lkKbmmL7npLrmoIfpopgKICAgICAqCiAgICAgKiBAdHlwZSB7Ym9vbGVhbn0KICAgICAqIEBtZW1iZXJvZiBNYWluXzNCYXNlCiAgICAgKi8KICAgIHB1YmxpYyBpc0hpZGVIZWFkZXI6IGJvb2xlYW4gPSBmYWxzZTsKCiAgICAvKioKICAgICAqIOaYr+WQpum7mOiupOmAieS4reesrOS4gOadoeaVsOaNrgogICAgICoKICAgICAqIEB0eXBlIHtib29sZWFufQogICAgICogQG1lbWJlcm9mIE1haW5fM0Jhc2UKICAgICAqLwogICAgQFByb3AoeyBkZWZhdWx0OiBmYWxzZSB9KSBwdWJsaWMgaXNTZWxlY3RGaXJzdERlZmF1bHQhOiBib29sZWFuOwoKICAgIC8qKgogICAgICog5piv5ZCm5Y2V6YCJCiAgICAgKgogICAgICogQHR5cGUge2Jvb2xlYW59CiAgICAgKiBAbWVtYmVyb2YgTWFpbl8zQmFzZQogICAgICovCiAgICBAUHJvcCgpIHB1YmxpYyBpc1NpbmdsZVNlbGVjdD86IGJvb2xlYW47CgogICAgLyoqCiAgICAgKiDpgInkuK3mlbDmja7lrZfnrKbkuLIKICAgICAqCiAgICAgKiBAdHlwZSB7c3RyaW5nfQogICAgICogQG1lbWJlcm9mIE1haW5fM0Jhc2UKICAgICAqLwogICAgQFByb3AoKSBwdWJsaWMgc2VsZWN0ZWREYXRhPzogc3RyaW5nOwoKICAgIC8qKgogICAgICog6YCJ5Lit5YC85Y+Y5YyWCiAgICAgKgogICAgICogQHBhcmFtIHsqfSBuZXdWYWwKICAgICAqIEBwYXJhbSB7Kn0gb2xkVmFsCiAgICAgKiBAbWVtYmVyb2YgTWFpbl8zQmFzZQogICAgICovCiAgICBAV2F0Y2goJ3NlbGVjdGVkRGF0YScpCiAgICBwdWJsaWMgb25WYWx1ZUNoYW5nZShuZXdWYWw6IGFueSwgb2xkVmFsOiBhbnkpIHsKICAgICAgICB0aGlzLnNlbGVjdGlvbnMgPSBbXTsKICAgICAgICBpZih0aGlzLnNlbGVjdGVkRGF0YSl7CiAgICAgICAgICAgIGNvbnN0IHJlZnM6IGFueSA9IHRoaXMuJHJlZnM7CiAgICAgICAgICAgIGlmIChyZWZzLm11bHRpcGxlVGFibGUpIHsKICAgICAgICAgICAgICAgIHJlZnMubXVsdGlwbGVUYWJsZS5jbGVhclNlbGVjdGlvbigpOwogICAgICAgICAgICAgICAgSlNPTi5wYXJzZSh0aGlzLnNlbGVjdGVkRGF0YSkuZm9yRWFjaCgoc2VsZWN0aW9uOmFueSk9PnsKICAgICAgICAgICAgICAgICAgICBsZXQgc2VsZWN0ZWRJdGVtID0gdGhpcy5pdGVtcy5maW5kKChpdGVtOmFueSk9PnsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIE9iamVjdC5pcyhpdGVtLnNyZmtleSwgc2VsZWN0aW9uLnNyZmtleSk7CiAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgaWYoc2VsZWN0ZWRJdGVtKXsKICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5yb3dDbGljayhzZWxlY3RlZEl0ZW0pOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICog6KGo5qC86KGM5pWw5o2u6buY6K6k5r+A5rS75qih5byPCiAgICAgKiAwIOS4jea/gOa0uwogICAgICogMSDljZXlh7vmv4DmtLsKICAgICAqIDIg5Y+M5Ye75r+A5rS7CiAgICAgKgogICAgICogQHR5cGUgeyhudW1iZXIgfCAwIHwgMSB8IDIpfQogICAgICogQG1lbWJlcm9mIE1haW5fM0Jhc2UKICAgICAqLwogICAgQFByb3Aoe2RlZmF1bHQ6IDJ9KSBwdWJsaWMgZ3JpZFJvd0FjdGl2ZU1vZGUhOiBudW1iZXI7CgogICAgLyoqCiAgICAgKiDmmK/lkKblvIDlkK/ooYznvJbovpEKICAgICAqCiAgICAgKiBAdHlwZSB7Ym9vbGVhbn0KICAgICAqIEBtZW1iZXJvZiBNYWluXzNCYXNlCiAgICAgKi8KICAgIEBQcm9wKHtkZWZhdWx0OiBmYWxzZX0pIHB1YmxpYyBpc09wZW5FZGl0ITogYm9vbGVhbjsKCiAgICAvKioKICAgICAqIOWunumZheaYr+WQpuW8gOWQr+ihjOe8lui+kQogICAgICoKICAgICAqIEB0eXBlIHtib29sZWFufQogICAgICogQG1lbWJlcm9mIE1haW5fM0Jhc2UKICAgICAqLwogICAgcHVibGljIGFjdHVhbElzT3BlbkVkaXQ6IGJvb2xlYW4gPSB0aGlzLmlzT3BlbkVkaXQ7CgogICAgLyoqCiAgICAgKiDmgLvmnaHmlbAKICAgICAqCiAgICAgKiBAdHlwZSB7bnVtYmVyfQogICAgICogQG1lbWJlcm9mIE1haW5fM0Jhc2UKICAgICAqLwogICAgcHVibGljIHRvdGFscm93OiBudW1iZXIgPSAwOwoKICAgIC8qKgogICAgICog6YCJ5Lit6KGM5pWw5o2uCiAgICAgKgogICAgICogQHR5cGUge2FueVtdfQogICAgICogQG1lbWJlcm9mIE1haW4KICAgICAqLwogICAgcHVibGljIHNlbGVjdGlvbnM6IGFueVtdID0gW107CgogICAgLyoqCiAgICAgKiDmi6bmiKrooYzpgInkuK0KICAgICAqCiAgICAgKiBAdHlwZSB7Ym9vbGVhbn0KICAgICAqIEBtZW1iZXJvZiBNYWluCiAgICAgKi8KICAgIHB1YmxpYyBzdG9wUm93Q2xpY2s6IGJvb2xlYW4gPSBmYWxzZTsKCgoKCiAgICAvKioKICAgICAqIOihqOagvOaYr+WQpuaYvuekugogICAgICoKICAgICAqIEB0eXBlIHtib29sZWFufQogICAgICogQG1lbWJlcm9mIE1haW5fM0Jhc2UKICAgICAqLwogICAgcHVibGljIGlzRGlzcGxheTpib29sZWFuID0gdHJ1ZTsKCiAgICAvKioKICAgICAqIOmDqOS7tuWIt+aWsAogICAgICoKICAgICAqIEBwYXJhbSB7YW55W119IGFyZ3MKICAgICAqIEBtZW1iZXJvZiBNYWluXzNCYXNlCiAgICAgKi8KICAgIHB1YmxpYyByZWZyZXNoKGFyZ3M6IGFueVtdKTogdm9pZCB7CiAgICAgICAgdGhpcy5sb2FkKCk7CiAgICB9CgogICAgLyoqCiAgICAqIOmAiemhueahhuWIl+WuvQogICAgKgogICAgKiBAdHlwZSB7bnVtYmVyfQogICAgKiBAbWVtYmVyb2YgQXBwSW5kZXgKICAgICovCiAgICBwdWJsaWMgY2hlY2tib3hDb2xXaWR0aDogbnVtYmVyID0gMzQ7CgogICAgLyoqCiAgICAgKiDmmK/lkKblhYHorrjmi5bliqjliJflrr0KICAgICAqCiAgICAgKiBAdHlwZSB7Ym9vbGVhbn0KICAgICAqIEBtZW1iZXJvZiBBcHBFbWJlZFBpY2tlcgogICAgICovCiAgICBwdWJsaWMgaXNEcmFnZW5kQ29sOiBib29sZWFuID0gZmFsc2U7CgogICAgLyoqCiAgICAgKiDmiYDmnInliJfmiJDlkZgKICAgICAqCiAgICAgKiBAdHlwZSB7YW55W119CiAgICAgKiBAbWVtYmVyb2YgTWFpbl8zQmFzZQogICAgICovCiAgICBwdWJsaWMgYWxsQ29sdW1uczogYW55W10gPSBbCiAgICAgICAgewogICAgICAgICAgICBuYW1lOiAnaHRiaCcsCiAgICAgICAgICAgIGxhYmVsOiAn5ZCI5ZCM57yW5Y+3JywKICAgICAgICAgICAgbGFuZ3RhZzogJ2VudGl0aWVzLnBpbWNvbnRyYWN0Lm1haW5fM19ncmlkLmNvbHVtbnMuaHRiaCcsCiAgICAgICAgICAgIHNob3c6IHRydWUsCiAgICAgICAgICAgIHV0aWw6ICdQWCcKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgbmFtZTogJ2h0bHgnLAogICAgICAgICAgICBsYWJlbDogJ+WQiOWQjOexu+WIqycsCiAgICAgICAgICAgIGxhbmd0YWc6ICdlbnRpdGllcy5waW1jb250cmFjdC5tYWluXzNfZ3JpZC5jb2x1bW5zLmh0bHgnLAogICAgICAgICAgICBzaG93OiB0cnVlLAogICAgICAgICAgICB1dGlsOiAnUFgnCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgIG5hbWU6ICdjb250cmFjdHR5cGUnLAogICAgICAgICAgICBsYWJlbDogJ+WQiOWQjOexu+WeiycsCiAgICAgICAgICAgIGxhbmd0YWc6ICdlbnRpdGllcy5waW1jb250cmFjdC5tYWluXzNfZ3JpZC5jb2x1bW5zLmNvbnRyYWN0dHlwZScsCiAgICAgICAgICAgIHNob3c6IHRydWUsCiAgICAgICAgICAgIHV0aWw6ICdQWCcKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgbmFtZTogJ3FzcnEnLAogICAgICAgICAgICBsYWJlbDogJ+i1t+Wni+aXpeacnycsCiAgICAgICAgICAgIGxhbmd0YWc6ICdlbnRpdGllcy5waW1jb250cmFjdC5tYWluXzNfZ3JpZC5jb2x1bW5zLnFzcnEnLAogICAgICAgICAgICBzaG93OiB0cnVlLAogICAgICAgICAgICB1dGlsOiAnUFgnCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgIG5hbWU6ICdqc3JxJywKICAgICAgICAgICAgbGFiZWw6ICfnu5PmnZ/ml6XmnJ8nLAogICAgICAgICAgICBsYW5ndGFnOiAnZW50aXRpZXMucGltY29udHJhY3QubWFpbl8zX2dyaWQuY29sdW1ucy5qc3JxJywKICAgICAgICAgICAgc2hvdzogdHJ1ZSwKICAgICAgICAgICAgdXRpbDogJ1BYJwogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICBuYW1lOiAnaHR6dCcsCiAgICAgICAgICAgIGxhYmVsOiAn5ZCI5ZCM54q25oCBJywKICAgICAgICAgICAgbGFuZ3RhZzogJ2VudGl0aWVzLnBpbWNvbnRyYWN0Lm1haW5fM19ncmlkLmNvbHVtbnMuaHR6dCcsCiAgICAgICAgICAgIHNob3c6IHRydWUsCiAgICAgICAgICAgIHV0aWw6ICdQWCcKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgbmFtZTogJ3N5ZHFzaicsCiAgICAgICAgICAgIGxhYmVsOiAn6K+V55So5Yiw5pyf5pe26Ze0JywKICAgICAgICAgICAgbGFuZ3RhZzogJ2VudGl0aWVzLnBpbWNvbnRyYWN0Lm1haW5fM19ncmlkLmNvbHVtbnMuc3lkcXNqJywKICAgICAgICAgICAgc2hvdzogdHJ1ZSwKICAgICAgICAgICAgdXRpbDogJ3B4JwogICAgICAgIH0sCiAgICBdCgogICAgLyoqCiAgICAgKiDooajmoLzmqKHlnovpm4blkIgKICAgICAqCiAgICAgKiBAdHlwZSB7Kn0KICAgICAqIEBtZW1iZXJvZiBNYWluXzNCYXNlCiAgICAgKi8KICAgIHB1YmxpYyBncmlkSXRlbXNNb2RlbDogYW55W10gPSBbXTsKCiAgICAvKioKICAgICAqIOiOt+WPluihqOagvOihjOaooeWeiwogICAgICoKICAgICAqIEB0eXBlIHsqfQogICAgICogQG1lbWJlcm9mIE1haW5fM0Jhc2UKICAgICAqLwogICAgcHVibGljIGdldEdyaWRSb3dNb2RlbCgpewogICAgICAgIHJldHVybiB7CiAgICAgICAgICBjb250cmFjdHR5cGU6IG5ldyBGb3JtSXRlbU1vZGVsKCksCiAgICAgICAgICBodHp0OiBuZXcgRm9ybUl0ZW1Nb2RlbCgpLAogICAgICAgICAgcGltcGVyc29uaWQ6IG5ldyBGb3JtSXRlbU1vZGVsKCksCiAgICAgICAgICBxc3JxOiBuZXcgRm9ybUl0ZW1Nb2RlbCgpLAogICAgICAgICAgaHRseDogbmV3IEZvcm1JdGVtTW9kZWwoKSwKICAgICAgICAgIGpzcnE6IG5ldyBGb3JtSXRlbU1vZGVsKCksCiAgICAgICAgICBzcmZrZXk6IG5ldyBGb3JtSXRlbU1vZGVsKCksCiAgICAgICAgICBodGJoOiBuZXcgRm9ybUl0ZW1Nb2RlbCgpLAogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIOWxnuaAp+WAvOinhOWImQogICAgICoKICAgICAqIEB0eXBlIHsqfQogICAgICogQG1lbWJlcm9mIE1haW5fM0Jhc2UKICAgICAqLwogICAgcHVibGljIHJ1bGVzOiBhbnkgPSB7CiAgICAgICAgY29udHJhY3R0eXBlOiBbCiAgICAgICAgICAgICB7IHJlcXVpcmVkOiBmYWxzZSwgdmFsaWRhdG9yOiAocnVsZTphbnksIHZhbHVlOmFueSwgY2FsbGJhY2s6YW55KSA9PiB7IHJldHVybiAocnVsZS5yZXF1aXJlZCAmJiAodmFsdWUgPT09IG51bGwgfHwgdmFsdWUgPT09IHVuZGVmaW5lZCB8fCB2YWx1ZSA9PT0gIiIpKSA/IGZhbHNlIDogdHJ1ZTt9LCBtZXNzYWdlOiAn5ZCI5ZCM57G75Z6LIOWAvOS4jeiDveS4uuepuicsIHRyaWdnZXI6ICdjaGFuZ2UnIH0sCiAgICAgICAgICAgIHsgcmVxdWlyZWQ6IGZhbHNlLCB2YWxpZGF0b3I6IChydWxlOmFueSwgdmFsdWU6YW55LCBjYWxsYmFjazphbnkpID0+IHsgcmV0dXJuIChydWxlLnJlcXVpcmVkICYmICh2YWx1ZSA9PT0gbnVsbCB8fCB2YWx1ZSA9PT0gdW5kZWZpbmVkIHx8IHZhbHVlID09PSAiIikpID8gZmFsc2UgOiB0cnVlO30sIG1lc3NhZ2U6ICflkIjlkIznsbvlnosg5YC85LiN6IO95Li656m6JywgdHJpZ2dlcjogJ2JsdXInIH0sCiAgICAgICAgXSwKICAgICAgICBodHp0OiBbCiAgICAgICAgICAgICB7IHJlcXVpcmVkOiBmYWxzZSwgdmFsaWRhdG9yOiAocnVsZTphbnksIHZhbHVlOmFueSwgY2FsbGJhY2s6YW55KSA9PiB7IHJldHVybiAocnVsZS5yZXF1aXJlZCAmJiAodmFsdWUgPT09IG51bGwgfHwgdmFsdWUgPT09IHVuZGVmaW5lZCB8fCB2YWx1ZSA9PT0gIiIpKSA/IGZhbHNlIDogdHJ1ZTt9LCBtZXNzYWdlOiAn5ZCI5ZCM54q25oCBIOWAvOS4jeiDveS4uuepuicsIHRyaWdnZXI6ICdjaGFuZ2UnIH0sCiAgICAgICAgICAgIHsgcmVxdWlyZWQ6IGZhbHNlLCB2YWxpZGF0b3I6IChydWxlOmFueSwgdmFsdWU6YW55LCBjYWxsYmFjazphbnkpID0+IHsgcmV0dXJuIChydWxlLnJlcXVpcmVkICYmICh2YWx1ZSA9PT0gbnVsbCB8fCB2YWx1ZSA9PT0gdW5kZWZpbmVkIHx8IHZhbHVlID09PSAiIikpID8gZmFsc2UgOiB0cnVlO30sIG1lc3NhZ2U6ICflkIjlkIznirbmgIEg5YC85LiN6IO95Li656m6JywgdHJpZ2dlcjogJ2JsdXInIH0sCiAgICAgICAgXSwKICAgICAgICBwaW1wZXJzb25pZDogWwogICAgICAgICAgICAgeyByZXF1aXJlZDogZmFsc2UsIHZhbGlkYXRvcjogKHJ1bGU6YW55LCB2YWx1ZTphbnksIGNhbGxiYWNrOmFueSkgPT4geyByZXR1cm4gKHJ1bGUucmVxdWlyZWQgJiYgKHZhbHVlID09PSBudWxsIHx8IHZhbHVlID09PSB1bmRlZmluZWQgfHwgdmFsdWUgPT09ICIiKSkgPyBmYWxzZSA6IHRydWU7fSwgbWVzc2FnZTogJ+S6uuWRmOS/oeaBr+agh+ivhiDlgLzkuI3og73kuLrnqbonLCB0cmlnZ2VyOiAnY2hhbmdlJyB9LAogICAgICAgICAgICB7IHJlcXVpcmVkOiBmYWxzZSwgdmFsaWRhdG9yOiAocnVsZTphbnksIHZhbHVlOmFueSwgY2FsbGJhY2s6YW55KSA9PiB7IHJldHVybiAocnVsZS5yZXF1aXJlZCAmJiAodmFsdWUgPT09IG51bGwgfHwgdmFsdWUgPT09IHVuZGVmaW5lZCB8fCB2YWx1ZSA9PT0gIiIpKSA/IGZhbHNlIDogdHJ1ZTt9LCBtZXNzYWdlOiAn5Lq65ZGY5L+h5oGv5qCH6K+GIOWAvOS4jeiDveS4uuepuicsIHRyaWdnZXI6ICdibHVyJyB9LAogICAgICAgIF0sCiAgICAgICAgcXNycTogWwogICAgICAgICAgICAgeyByZXF1aXJlZDogZmFsc2UsIHZhbGlkYXRvcjogKHJ1bGU6YW55LCB2YWx1ZTphbnksIGNhbGxiYWNrOmFueSkgPT4geyByZXR1cm4gKHJ1bGUucmVxdWlyZWQgJiYgKHZhbHVlID09PSBudWxsIHx8IHZhbHVlID09PSB1bmRlZmluZWQgfHwgdmFsdWUgPT09ICIiKSkgPyBmYWxzZSA6IHRydWU7fSwgbWVzc2FnZTogJ+i1t+Wni+aXpeacnyDlgLzkuI3og73kuLrnqbonLCB0cmlnZ2VyOiAnY2hhbmdlJyB9LAogICAgICAgICAgICB7IHJlcXVpcmVkOiBmYWxzZSwgdmFsaWRhdG9yOiAocnVsZTphbnksIHZhbHVlOmFueSwgY2FsbGJhY2s6YW55KSA9PiB7IHJldHVybiAocnVsZS5yZXF1aXJlZCAmJiAodmFsdWUgPT09IG51bGwgfHwgdmFsdWUgPT09IHVuZGVmaW5lZCB8fCB2YWx1ZSA9PT0gIiIpKSA/IGZhbHNlIDogdHJ1ZTt9LCBtZXNzYWdlOiAn6LW35aeL5pel5pyfIOWAvOS4jeiDveS4uuepuicsIHRyaWdnZXI6ICdibHVyJyB9LAogICAgICAgIF0sCiAgICAgICAgaHRseDogWwogICAgICAgICAgICAgeyByZXF1aXJlZDogZmFsc2UsIHZhbGlkYXRvcjogKHJ1bGU6YW55LCB2YWx1ZTphbnksIGNhbGxiYWNrOmFueSkgPT4geyByZXR1cm4gKHJ1bGUucmVxdWlyZWQgJiYgKHZhbHVlID09PSBudWxsIHx8IHZhbHVlID09PSB1bmRlZmluZWQgfHwgdmFsdWUgPT09ICIiKSkgPyBmYWxzZSA6IHRydWU7fSwgbWVzc2FnZTogJ+WQiOWQjOexu+WIqyDlgLzkuI3og73kuLrnqbonLCB0cmlnZ2VyOiAnY2hhbmdlJyB9LAogICAgICAgICAgICB7IHJlcXVpcmVkOiBmYWxzZSwgdmFsaWRhdG9yOiAocnVsZTphbnksIHZhbHVlOmFueSwgY2FsbGJhY2s6YW55KSA9PiB7IHJldHVybiAocnVsZS5yZXF1aXJlZCAmJiAodmFsdWUgPT09IG51bGwgfHwgdmFsdWUgPT09IHVuZGVmaW5lZCB8fCB2YWx1ZSA9PT0gIiIpKSA/IGZhbHNlIDogdHJ1ZTt9LCBtZXNzYWdlOiAn5ZCI5ZCM57G75YirIOWAvOS4jeiDveS4uuepuicsIHRyaWdnZXI6ICdibHVyJyB9LAogICAgICAgIF0sCiAgICAgICAganNycTogWwogICAgICAgICAgICAgeyByZXF1aXJlZDogZmFsc2UsIHZhbGlkYXRvcjogKHJ1bGU6YW55LCB2YWx1ZTphbnksIGNhbGxiYWNrOmFueSkgPT4geyByZXR1cm4gKHJ1bGUucmVxdWlyZWQgJiYgKHZhbHVlID09PSBudWxsIHx8IHZhbHVlID09PSB1bmRlZmluZWQgfHwgdmFsdWUgPT09ICIiKSkgPyBmYWxzZSA6IHRydWU7fSwgbWVzc2FnZTogJ+e7k+adn+aXpeacnyDlgLzkuI3og73kuLrnqbonLCB0cmlnZ2VyOiAnY2hhbmdlJyB9LAogICAgICAgICAgICB7IHJlcXVpcmVkOiBmYWxzZSwgdmFsaWRhdG9yOiAocnVsZTphbnksIHZhbHVlOmFueSwgY2FsbGJhY2s6YW55KSA9PiB7IHJldHVybiAocnVsZS5yZXF1aXJlZCAmJiAodmFsdWUgPT09IG51bGwgfHwgdmFsdWUgPT09IHVuZGVmaW5lZCB8fCB2YWx1ZSA9PT0gIiIpKSA/IGZhbHNlIDogdHJ1ZTt9LCBtZXNzYWdlOiAn57uT5p2f5pel5pyfIOWAvOS4jeiDveS4uuepuicsIHRyaWdnZXI6ICdibHVyJyB9LAogICAgICAgIF0sCiAgICAgICAgc3Jma2V5OiBbCiAgICAgICAgICAgICB7IHJlcXVpcmVkOiBmYWxzZSwgdmFsaWRhdG9yOiAocnVsZTphbnksIHZhbHVlOmFueSwgY2FsbGJhY2s6YW55KSA9PiB7IHJldHVybiAocnVsZS5yZXF1aXJlZCAmJiAodmFsdWUgPT09IG51bGwgfHwgdmFsdWUgPT09IHVuZGVmaW5lZCB8fCB2YWx1ZSA9PT0gIiIpKSA/IGZhbHNlIDogdHJ1ZTt9LCBtZXNzYWdlOiAn5ZCI5ZCM5L+h5oGv5qCH6K+GIOWAvOS4jeiDveS4uuepuicsIHRyaWdnZXI6ICdjaGFuZ2UnIH0sCiAgICAgICAgICAgIHsgcmVxdWlyZWQ6IGZhbHNlLCB2YWxpZGF0b3I6IChydWxlOmFueSwgdmFsdWU6YW55LCBjYWxsYmFjazphbnkpID0+IHsgcmV0dXJuIChydWxlLnJlcXVpcmVkICYmICh2YWx1ZSA9PT0gbnVsbCB8fCB2YWx1ZSA9PT0gdW5kZWZpbmVkIHx8IHZhbHVlID09PSAiIikpID8gZmFsc2UgOiB0cnVlO30sIG1lc3NhZ2U6ICflkIjlkIzkv6Hmga/moIfor4Yg5YC85LiN6IO95Li656m6JywgdHJpZ2dlcjogJ2JsdXInIH0sCiAgICAgICAgXSwKICAgICAgICBodGJoOiBbCiAgICAgICAgICAgICB7IHJlcXVpcmVkOiBmYWxzZSwgdmFsaWRhdG9yOiAocnVsZTphbnksIHZhbHVlOmFueSwgY2FsbGJhY2s6YW55KSA9PiB7IHJldHVybiAocnVsZS5yZXF1aXJlZCAmJiAodmFsdWUgPT09IG51bGwgfHwgdmFsdWUgPT09IHVuZGVmaW5lZCB8fCB2YWx1ZSA9PT0gIiIpKSA/IGZhbHNlIDogdHJ1ZTt9LCBtZXNzYWdlOiAn5ZCI5ZCM57yW5Y+3IOWAvOS4jeiDveS4uuepuicsIHRyaWdnZXI6ICdjaGFuZ2UnIH0sCiAgICAgICAgICAgIHsgcmVxdWlyZWQ6IGZhbHNlLCB2YWxpZGF0b3I6IChydWxlOmFueSwgdmFsdWU6YW55LCBjYWxsYmFjazphbnkpID0+IHsgcmV0dXJuIChydWxlLnJlcXVpcmVkICYmICh2YWx1ZSA9PT0gbnVsbCB8fCB2YWx1ZSA9PT0gdW5kZWZpbmVkIHx8IHZhbHVlID09PSAiIikpID8gZmFsc2UgOiB0cnVlO30sIG1lc3NhZ2U6ICflkIjlkIznvJblj7cg5YC85LiN6IO95Li656m6JywgdHJpZ2dlcjogJ2JsdXInIH0sCiAgICAgICAgXSwKICAgIH0KCiAgICAvKioKICAgICAqIOihqOagvOihjOe8lui+kemhueagoemqjAogICAgICoKICAgICAqIEBwYXJhbSB7c3RyaW5nfSBwcm9wZXJ0eSDlsZ7mgKflkI0KICAgICAqIEBwYXJhbSB7Kn0gZGF0YSDooYzmlbDmja4KICAgICAqIEBwYXJhbSB7bnVtYmVyfSByb3dJbmRleCDooYzntKLlvJUKICAgICAqIEByZXR1cm5zIFByb21pc2U8YW55PgogICAgICogCiAgICAgKiBAbWVtYmVyb2YgTWFpbl8zQmFzZQogICAgICovCiAgICBwdWJsaWMgdmFsaWRhdGUocHJvcGVydHk6c3RyaW5nLCBkYXRhOmFueSwgcm93SW5kZXg6bnVtYmVyKTpQcm9taXNlPGFueT57CiAgICAgICAgcmV0dXJuIG5ldyBQcm9taXNlKChyZXNvbHZlLCByZWplY3QpID0+IHsKICAgICAgICAgICAgdGhpcy4kdXRpbC52YWxpZGF0ZUl0ZW0ocHJvcGVydHksZGF0YSx0aGlzLnJ1bGVzKS50aGVuKCgpPT57CiAgICAgICAgICAgICAgICB0aGlzLmdyaWRJdGVtc01vZGVsW3Jvd0luZGV4XVtwcm9wZXJ0eV0uc2V0RXJyb3IobnVsbCk7CiAgICAgICAgICAgICAgICByZXNvbHZlKHRydWUpOwogICAgICAgICAgICB9KS5jYXRjaCgoeyBlcnJvcnMsIGZpZWxkcyB9KSA9PiB7CiAgICAgICAgICAgICAgICB0aGlzLmdyaWRJdGVtc01vZGVsW3Jvd0luZGV4XVtwcm9wZXJ0eV0uc2V0RXJyb3IoZXJyb3JzWzBdLm1lc3NhZ2UpOwogICAgICAgICAgICAgICAgcmVzb2x2ZShmYWxzZSk7CiAgICAgICAgICAgIH0pOwogICAgICAgIH0pOwogICAgfQoKICAgIC8qKgogICAgICog5qCh6aqM5omA5pyJ5L+u5pS56L+H55qE57yW6L6R6aG5CiAgICAgKgogICAgICogQHJldHVybnMgUHJvbWlzZTxhbnk+CiAgICAgKiBAbWVtYmVyb2YgTWFpbl8zQmFzZQogICAgICovCiAgICBwdWJsaWMgYXN5bmMgdmFsaWRhdGVBbGwoKXsKICAgICAgICBsZXQgdmFsaWRhdGVTdGF0ZSA9IHRydWU7CiAgICAgICAgbGV0IGluZGV4ID0gLTE7CiAgICAgICAgZm9yKGxldCBpdGVtIG9mIHRoaXMuaXRlbXMpewogICAgICAgICAgaW5kZXgrKzsKICAgICAgICAgIGlmKGl0ZW0ucm93RGF0YVN0YXRlID09PSAiY3JlYXRlIiB8fCBpdGVtLnJvd0RhdGFTdGF0ZSA9PT0gInVwZGF0ZSIpewogICAgICAgICAgICBmb3IobGV0IHByb3BlcnR5IG9mIE9iamVjdC5rZXlzKHRoaXMucnVsZXMpKXsKICAgICAgICAgICAgICBpZighYXdhaXQgdGhpcy52YWxpZGF0ZShwcm9wZXJ0eSxpdGVtLGluZGV4KSl7CiAgICAgICAgICAgICAgICB2YWxpZGF0ZVN0YXRlID0gZmFsc2U7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIHJldHVybiB2YWxpZGF0ZVN0YXRlOwogICAgfQoKICAgIC8qKgogICAgICog6KGo5qC85pWw5o2u5Yqg6L29CiAgICAgKgogICAgICogQHBhcmFtIHsqfSBbYXJnPXt9XQogICAgICogQG1lbWJlcm9mIE1haW5fM0Jhc2UKICAgICAqLwogICAgcHVibGljIGxvYWQob3B0OiBhbnkgPSB7fSwgcGFnZVJlc2V0OiBib29sZWFuID0gZmFsc2UpOiB2b2lkIHsKICAgICAgICBpZighdGhpcy5mZXRjaEFjdGlvbil7CiAgICAgICAgICAgIHRoaXMuJE5vdGljZS5lcnJvcih7IHRpdGxlOiAn6ZSZ6K+vJywgZGVzYzogJ1BJTUNPTlRSQUNUV1NTR3JpZFZpZXfop4blm77ooajmoLxmZXRjaEFjdGlvbuWPguaVsOacqumFjee9ricgfSk7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICB9CiAgICAgICAgaWYocGFnZVJlc2V0KXsKICAgICAgICAgICAgdGhpcy5jdXJQYWdlID0gMTsKICAgICAgICB9CiAgICAgICAgY29uc3QgYXJnOiBhbnkgPSB7Li4ub3B0fTsKICAgICAgICBjb25zdCBwYWdlOiBhbnkgPSB7fTsKICAgICAgICBpZiAodGhpcy5pc0VuYWJsZVBhZ2luZ0JhcikgewogICAgICAgICAgICBPYmplY3QuYXNzaWduKHBhZ2UsIHsgcGFnZTogdGhpcy5jdXJQYWdlLTEsIHNpemU6IHRoaXMubGltaXQgfSk7CiAgICAgICAgfQogICAgICAgIC8vIOiuvue9ruaOkuW6jwogICAgICAgIGlmICghdGhpcy5pc05vU29ydCAmJiAhT2JqZWN0LmlzKHRoaXMubWlub3JTb3J0RGlyLCAnJykgJiYgIU9iamVjdC5pcyh0aGlzLm1pbm9yU29ydFBTREVGLCAnJykpIHsKICAgICAgICAgICAgY29uc3Qgc29ydDogc3RyaW5nID0gdGhpcy5taW5vclNvcnRQU0RFRisiLCIrdGhpcy5taW5vclNvcnREaXI7CiAgICAgICAgICAgIE9iamVjdC5hc3NpZ24ocGFnZSwgeyBzb3J0OiBzb3J0IH0pOwogICAgICAgIH0KICAgICAgICBPYmplY3QuYXNzaWduKGFyZywgcGFnZSk7CiAgICAgICAgY29uc3QgcGFyZW50ZGF0YTogYW55ID0ge307CiAgICAgICAgdGhpcy4kZW1pdCgnYmVmb3JlbG9hZCcsIHBhcmVudGRhdGEpOwogICAgICAgIE9iamVjdC5hc3NpZ24oYXJnLCBwYXJlbnRkYXRhKTsKICAgICAgICBsZXQgdGVtcFZpZXdQYXJhbXM6YW55ID0gcGFyZW50ZGF0YS52aWV3cGFyYW1zP3BhcmVudGRhdGEudmlld3BhcmFtczp7fTsKICAgICAgICBPYmplY3QuYXNzaWduKHRlbXBWaWV3UGFyYW1zLEpTT04ucGFyc2UoSlNPTi5zdHJpbmdpZnkodGhpcy52aWV3cGFyYW1zKSkpOwogICAgICAgIE9iamVjdC5hc3NpZ24oYXJnLHt2aWV3cGFyYW1zOnRlbXBWaWV3UGFyYW1zfSk7CiAgICAgICAgY29uc3QgcG9zdDogUHJvbWlzZTxhbnk+ID0gdGhpcy5zZXJ2aWNlLnNlYXJjaCh0aGlzLmZldGNoQWN0aW9uLEpTT04ucGFyc2UoSlNPTi5zdHJpbmdpZnkodGhpcy5jb250ZXh0KSksIGFyZywgdGhpcy5zaG93QnVzeUluZGljYXRvcik7CiAgICAgICAgcG9zdC50aGVuKChyZXNwb25zZTogYW55KSA9PiB7CiAgICAgICAgICAgIGlmICghcmVzcG9uc2Uuc3RhdHVzIHx8IHJlc3BvbnNlLnN0YXR1cyAhPT0gMjAwKSB7CiAgICAgICAgICAgICAgICBpZiAocmVzcG9uc2UuZXJyb3JNZXNzYWdlKSB7CiAgICAgICAgICAgICAgICAgICAgdGhpcy4kTm90aWNlLmVycm9yKHsgdGl0bGU6ICfplJnor68nLCBkZXNjOiByZXNwb25zZS5lcnJvck1lc3NhZ2UgfSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgIH0KICAgICAgICAgICAgY29uc3QgZGF0YTogYW55ID0gcmVzcG9uc2UuZGF0YTsKICAgICAgICAgICAgdGhpcy50b3RhbHJvdyA9IHJlc3BvbnNlLnRvdGFsOwogICAgICAgICAgICB0aGlzLml0ZW1zID0gSlNPTi5wYXJzZShKU09OLnN0cmluZ2lmeShkYXRhKSk7CiAgICAgICAgICAgIC8vIOa4heepunNlbGVjdGlvbnMsZ3JpZEl0ZW1zTW9kZWwKICAgICAgICAgICAgdGhpcy5zZWxlY3Rpb25zID0gW107CiAgICAgICAgICAgIHRoaXMuZ3JpZEl0ZW1zTW9kZWwgPSBbXTsKICAgICAgICAgICAgdGhpcy5pdGVtcy5mb3JFYWNoKCgpPT57dGhpcy5ncmlkSXRlbXNNb2RlbC5wdXNoKHRoaXMuZ2V0R3JpZFJvd01vZGVsKCkpfSk7CiAgICAgICAgICAgIHRoaXMuJGVtaXQoJ2xvYWQnLCB0aGlzLml0ZW1zKTsKICAgICAgICAgICAgLy8g6K6+572u6buY6K6k6YCJ5LitCiAgICAgICAgICAgIGxldCBfdGhpcyA9IHRoaXM7CiAgICAgICAgICAgIHNldFRpbWVvdXQoKCkgPT4gewogICAgICAgICAgICAgICAgaWYoX3RoaXMuaXNTZWxlY3RGaXJzdERlZmF1bHQpewogICAgICAgICAgICAgICAgICBfdGhpcy5yb3dDbGljayhfdGhpcy5pdGVtc1swXSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBpZihfdGhpcy5zZWxlY3RlZERhdGEpewogICAgICAgICAgICAgICAgICAgIGNvbnN0IHJlZnM6IGFueSA9IF90aGlzLiRyZWZzOwogICAgICAgICAgICAgICAgICAgIGlmIChyZWZzLm11bHRpcGxlVGFibGUpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmVmcy5tdWx0aXBsZVRhYmxlLmNsZWFyU2VsZWN0aW9uKCk7CiAgICAgICAgICAgICAgICAgICAgICAgIEpTT04ucGFyc2UoX3RoaXMuc2VsZWN0ZWREYXRhKS5mb3JFYWNoKChzZWxlY3Rpb246YW55KT0+ewogICAgICAgICAgICAgICAgICAgICAgICAgICAgbGV0IHNlbGVjdGVkSXRlbSA9IF90aGlzLml0ZW1zLmZpbmQoKGl0ZW06YW55KT0+ewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBPYmplY3QuaXMoaXRlbS5zcmZrZXksIHNlbGVjdGlvbi5zcmZrZXkpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZihzZWxlY3RlZEl0ZW0pewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIF90aGlzLnJvd0NsaWNrKHNlbGVjdGVkSXRlbSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSwgMzAwKTsKICAgICAgICB9KS5jYXRjaCgocmVzcG9uc2U6IGFueSkgPT4gewogICAgICAgICAgICBpZiAocmVzcG9uc2UgJiYgcmVzcG9uc2Uuc3RhdHVzID09PSA0MDEpIHsKICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgfQogICAgICAgICAgICB0aGlzLiROb3RpY2UuZXJyb3IoeyB0aXRsZTogJ+mUmeivrycsIGRlc2M6IHJlc3BvbnNlLmVycm9yTWVzc2FnZSB9KTsKICAgICAgICB9KTsKICAgIH0KCiAgICAvKioKICAgICAqIOWIoOmZpAogICAgICoKICAgICAqIEBwYXJhbSB7YW55W119IGRhdGFzCiAgICAgKiBAcmV0dXJucyB7UHJvbWlzZTxhbnk+fQogICAgICogQG1lbWJlcm9mIE1haW5fM0Jhc2UKICAgICAqLwogICAgcHVibGljIGFzeW5jIHJlbW92ZShkYXRhczogYW55W10pOiBQcm9taXNlPGFueT4gewogICAgICAgIGlmKCF0aGlzLnJlbW92ZUFjdGlvbil7CiAgICAgICAgICAgIHRoaXMuJE5vdGljZS5lcnJvcih7IHRpdGxlOiAn6ZSZ6K+vJywgZGVzYzogJ1BJTUNPTlRSQUNUV1NTR3JpZFZpZXfop4blm77ooajmoLxyZW1vdmVBY3Rpb27lj4LmlbDmnKrphY3nva4nIH0pOwogICAgICAgICAgICByZXR1cm47CiAgICAgICAgfQogICAgICAgIGxldCBfZGF0YXM6YW55W10gPSBbXTsKICAgICAgICBkYXRhcy5mb3JFYWNoKChyZWNvcmQ6IGFueSwgaW5kZXg6IG51bWJlcikgPT4gewogICAgICAgICAgICBpZiAoT2JqZWN0LmlzKHJlY29yZC5zcmZ1ZiwiMCIpKSB7CiAgICAgICAgICAgICAgICB0aGlzLml0ZW1zLnNvbWUoKHZhbDogYW55LCBudW06IG51bWJlcikgPT57CiAgICAgICAgICAgICAgICAgICAgaWYoSlNPTi5zdHJpbmdpZnkodmFsKSA9PSBKU09OLnN0cmluZ2lmeShyZWNvcmQpKXsKICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5pdGVtcy5zcGxpY2UobnVtLDEpOwogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmdyaWRJdGVtc01vZGVsLnNwbGljZShudW0sMSk7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0pOyAKICAgICAgICAgICAgfWVsc2V7CiAgICAgICAgICAgICAgIF9kYXRhcy5wdXNoKGRhdGFzW2luZGV4XSk7CiAgICAgICAgICAgIH0KICAgICAgICB9KTsKICAgICAgICBpZiAoX2RhdGFzLmxlbmd0aCA9PT0gMCkgewogICAgICAgICAgICByZXR1cm47CiAgICAgICAgfQogICAgICAgIGxldCBkYXRhSW5mbyA9ICcnOwogICAgICAgIF9kYXRhcy5mb3JFYWNoKChyZWNvcmQ6IGFueSwgaW5kZXg6IG51bWJlcikgPT4gewogICAgICAgICAgICBsZXQgc3JmbWFqb3J0ZXh0ID0gcmVjb3JkLnBpbXBlcnNvbm5hbWU7CiAgICAgICAgICAgIGlmIChpbmRleCA8IDUpIHsKICAgICAgICAgICAgICAgIGlmICghT2JqZWN0LmlzKGRhdGFJbmZvLCAnJykpIHsKICAgICAgICAgICAgICAgICAgICBkYXRhSW5mbyArPSAn44CBJzsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGRhdGFJbmZvICs9IHNyZm1ham9ydGV4dDsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICAgICAgfQogICAgICAgIH0pOwoKICAgICAgICBpZiAoX2RhdGFzLmxlbmd0aCA8IDUpIHsKICAgICAgICAgICAgZGF0YUluZm8gPSBkYXRhSW5mbyArICcg5YWxJyArIF9kYXRhcy5sZW5ndGggKyAn5p2h5pWw5o2uJzsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBkYXRhSW5mbyA9IGRhdGFJbmZvICsgJy4uLicgKyAnIOWFsScgKyBfZGF0YXMubGVuZ3RoICsgJ+adoeaVsOaNric7CiAgICAgICAgfQoKICAgICAgICBjb25zdCByZW1vdmVEYXRhID0gKCkgPT4gewogICAgICAgICAgICBsZXQga2V5czogYW55W10gPSBbXTsKICAgICAgICAgICAgX2RhdGFzLmZvckVhY2goKGRhdGE6IGFueSkgPT4gewogICAgICAgICAgICAgICAga2V5cy5wdXNoKGRhdGEuc3Jma2V5KTsKICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIGxldCBfcmVtb3ZlQWN0aW9uID0ga2V5cy5sZW5ndGggPiAxID8gJ3JlbW92ZUJhdGNoJyA6IHRoaXMucmVtb3ZlQWN0aW9uIDsKICAgICAgICAgICAgbGV0IF9rZXlzID0ga2V5cy5sZW5ndGggPiAxID8ga2V5cyA6IGtleXNbMF0gOwogICAgICAgICAgICBjb25zdCBjb250ZXh0OmFueSA9IEpTT04ucGFyc2UoSlNPTi5zdHJpbmdpZnkodGhpcy5jb250ZXh0KSk7CiAgICAgICAgICAgIGNvbnN0IHBvc3Q6IFByb21pc2U8YW55PiA9IHRoaXMuc2VydmljZS5kZWxldGUoX3JlbW92ZUFjdGlvbixPYmplY3QuYXNzaWduKGNvbnRleHQseyBwaW1jb250cmFjdDogX2tleXMgfSksT2JqZWN0LmFzc2lnbih7IHBpbWNvbnRyYWN0OiBfa2V5cyB9LHt2aWV3cGFyYW1zOnRoaXMudmlld3BhcmFtc30pLCB0aGlzLnNob3dCdXN5SW5kaWNhdG9yKTsKICAgICAgICAgICAgcmV0dXJuIG5ldyBQcm9taXNlKChyZXNvbHZlOiBhbnksIHJlamVjdDogYW55KSA9PiB7CiAgICAgICAgICAgICAgICBwb3N0LnRoZW4oKHJlc3BvbnNlOiBhbnkpID0+IHsKICAgICAgICAgICAgICAgICAgICBpZiAoIXJlc3BvbnNlIHx8IHJlc3BvbnNlLnN0YXR1cyAhPT0gMjAwKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuJE5vdGljZS5lcnJvcih7IHRpdGxlOiAnJywgZGVzYzogJ+WIoOmZpOaVsOaNruWksei0pSwnICsgcmVzcG9uc2UuaW5mbyB9KTsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuJE5vdGljZS5zdWNjZXNzKHsgdGl0bGU6ICcnLCBkZXNjOiAn5Yig6Zmk5oiQ5YqfIScgfSk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIC8v5Yig6ZmkaXRlbXPkuK3lt7LliKDpmaTnmoTpobkKICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyh0aGlzLml0ZW1zKTsKICAgICAgICAgICAgICAgICAgICBfZGF0YXMuZm9yRWFjaCgoZGF0YTogYW55KSA9PiB7CiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuaXRlbXMuc29tZSgoaXRlbTphbnksaW5kZXg6bnVtYmVyKT0+ewogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYoT2JqZWN0LmlzKGl0ZW0uc3Jma2V5LGRhdGEuc3Jma2V5KSl7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5pdGVtcy5zcGxpY2UoaW5kZXgsMSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5ncmlkSXRlbXNNb2RlbC5zcGxpY2UoaW5kZXgsMSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgIHRoaXMudG90YWxyb3cgLT0gX2RhdGFzLmxlbmd0aDsKICAgICAgICAgICAgICAgICAgICB0aGlzLiRlbWl0KCdyZW1vdmUnLCBudWxsKTsKICAgICAgICAgICAgICAgICAgICB0aGlzLnNlbGVjdGlvbnMgPSBbXTsKICAgICAgICAgICAgICAgICAgICByZXNvbHZlKHJlc3BvbnNlKTsKICAgICAgICAgICAgICAgIH0pLmNhdGNoKChyZXNwb25zZTogYW55KSA9PiB7CiAgICAgICAgICAgICAgICAgICAgaWYgKHJlc3BvbnNlICYmIHJlc3BvbnNlLnN0YXR1cyA9PT0gNDAxKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgaWYgKCFyZXNwb25zZSB8fCAhcmVzcG9uc2Uuc3RhdHVzIHx8ICFyZXNwb25zZS5kYXRhKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuJE5vdGljZS5lcnJvcih7IHRpdGxlOiAn6ZSZ6K+vJywgZGVzYzogJ+ezu+e7n+W8guW4uCcgfSk7CiAgICAgICAgICAgICAgICAgICAgICAgIHJlamVjdChyZXNwb25zZSk7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgcmVqZWN0KHJlc3BvbnNlKTsKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9KTsKICAgICAgICB9CgogICAgICAgIGRhdGFJbmZvID0gZGF0YUluZm8ucmVwbGFjZSgvW251bGxdL2csICcnKS5yZXBsYWNlKC9bdW5kZWZpbmVkXS9nLCAnJyk7CiAgICAgICAgdGhpcy4kTW9kYWwuY29uZmlybSh7CiAgICAgICAgICAgIHRpdGxlOiAn6K2m5ZGKJywKICAgICAgICAgICAgY29udGVudDogJ+ehruiupOimgeWIoOmZpCAnICsgZGF0YUluZm8gKyAn77yM5Yig6Zmk5pON5L2c5bCG5LiN5Y+v5oGi5aSN77yfJywKICAgICAgICAgICAgb25PazogKCkgPT4gewogICAgICAgICAgICAgICAgcmVtb3ZlRGF0YSgpOwogICAgICAgICAgICB9LAogICAgICAgICAgICBvbkNhbmNlbDogKCkgPT4geyB9CiAgICAgICAgfSk7CiAgICAgICAgcmV0dXJuIHJlbW92ZURhdGE7CiAgICB9CgoKICAgIC8qKgogICAgICog5om56YeP5re75YqgCiAgICAgKgogICAgICogQHBhcmFtIHsqfSBbYXJnPXt9XQogICAgICogQG1lbWJlcm9mIE1haW5fM0Jhc2UKICAgICAqLwogICAgcHVibGljIGFkZEJhdGNoKGFyZzogYW55ID0ge30pOiB2b2lkIHsKICAgICAgICBpZighdGhpcy5mZXRjaEFjdGlvbil7CiAgICAgICAgICAgIHRoaXMuJE5vdGljZS5lcnJvcih7IHRpdGxlOiAn6ZSZ6K+vJywgZGVzYzogJ1BJTUNPTlRSQUNUV1NTR3JpZFZpZXfop4blm77ooajmoLxmZXRjaEFjdGlvbuWPguaVsOacqumFjee9ricgfSk7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICB9CiAgICAgICAgaWYoIWFyZyl7CiAgICAgICAgICAgIGFyZyA9IHt9OwogICAgICAgIH0KICAgICAgICBjb25zb2xlLmVycm9yKCLmibnph4/mt7vliqDmnKrlrp7njrAiKTsKICAgIH0KCiAgICAvKioKICAgICAqIOaVsOaNruWvvOWFpQogICAgICoKICAgICAqIEBwYXJhbSB7Kn0gZGF0YQogICAgICogQG1lbWJlcm9mIE1haW5fM0Jhc2UKICAgICAqLwogICAgIHB1YmxpYyBpbXBvcnRFeGNlbChkYXRhOmFueSA9e30pOnZvaWR7CiAgICAgICAgLy/lr7zlhaVleGNlbAogICAgICAgIGNvbnN0IGltcG9ydERhdGFNb2RlbDphbnkgPXsKICAgICAgICB9CiAgICAgICAgaWYoT2JqZWN0LmtleXMoaW1wb3J0RGF0YU1vZGVsKS5sZW5ndGggPT0gMCl7CiAgICAgICAgICAgIHRoaXMuJE5vdGljZS53YXJuaW5nKHsgJ3RpdGxlJzogKHRoaXMuJHQoImFwcC51dGlsdmlldy53YXJuaW5nIikgYXMgc3RyaW5nKSwgJ2Rlc2MnOiAodGhpcy4kdCgiYXBwLnV0aWx2aWV3LmluZm8iKSBhcyBzdHJpbmcpIH0pOwogICAgICAgICAgICByZXR1cm47CiAgICAgICAgfQogICAgICAgIGNvbnN0IHZpZXc6YW55ID17CiAgICAgICAgICAgIHZpZXduYW1lOiAnYXBwLWRhdGEtdXBsb2FkJywKICAgICAgICAgICAgdGl0bGU6IHRoaXMuJHQoImFwcC51dGlsdmlldy5pbXBvcnR2aWV3IiksCiAgICAgICAgICAgIHdpZHRoOiA5MDAsCiAgICAgICAgICAgIGhlaWdodDogNzAwCiAgICAgICAgfQogICAgICAgIGxldCBjb250YWluZXI6IFN1YmplY3Q8YW55PiA9IHRoaXMuJGFwcG1vZGFsLm9wZW5Nb2RhbCh2aWV3LCBKU09OLnBhcnNlKEpTT04uc3RyaW5naWZ5KHRoaXMuY29udGV4dCkpLCBpbXBvcnREYXRhTW9kZWwpOwogICAgICAgIGNvbnRhaW5lci5zdWJzY3JpYmUoKHJlc3VsdDogYW55KSA9PiB7CiAgICAgICAgICBpZihPYmplY3QuaXMocmVzdWx0LnJldCwnT0snKSl7CiAgICAgICAgICAgIHRoaXMucmVmcmVzaChyZXN1bHQuZGF0YXMpOwogICAgICAgICAgfQogICAgICB9KTsKICAgIH0KCgogICAgLyoqCiAgICAgKiDmlbDmja7lr7zlh7oKICAgICAqCiAgICAgKiBAcGFyYW0geyp9IGRhdGEKICAgICAqIEBtZW1iZXJvZiBNYWluXzNCYXNlCiAgICAgKi8KICAgIHB1YmxpYyBleHBvcnRFeGNlbChkYXRhOiBhbnkgPSB7fSk6IHZvaWQgewogICAgICAgIC8vIOWvvOWHukV4Y2VsCiAgICAgICAgY29uc3QgZG9FeHBvcnQgPSBhc3luYyAoX2RhdGE6YW55KSA9PiB7CiAgICAgICAgICAgIGNvbnN0IHRIZWFkZXI6IEFycmF5PGFueT4gPSBbXTsKICAgICAgICAgICAgY29uc3QgZmlsdGVyVmFsOiBBcnJheTxhbnk+ID0gW107CiAgICAgICAgICAgIHRoaXMuYWxsQ29sdW1ucy5mb3JFYWNoKChpdGVtOiBhbnkpID0+IHsKICAgICAgICAgICAgICBpdGVtLnNob3cgJiYgaXRlbS5sYWJlbCA/IHRIZWFkZXIucHVzaCh0aGlzLiR0KGl0ZW0ubGFuZ3RhZykpIDogIiI7CiAgICAgICAgICAgICAgaXRlbS5zaG93ICYmIGl0ZW0ubmFtZSA/IGZpbHRlclZhbC5wdXNoKGl0ZW0ubmFtZSkgOiAiIjsKICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIGNvbnN0IGRhdGEgPSBhd2FpdCB0aGlzLmZvcm1hdEV4Y2VsRGF0YShmaWx0ZXJWYWwsIF9kYXRhKTsKICAgICAgICAgICAgdGhpcy4kZXhwb3J0LmV4cG9ydEV4Y2VsKCkudGhlbigoZXhjZWw6YW55KT0+ewogICAgICAgICAgICAgICAgZXhjZWwuZXhwb3J0X2pzb25fdG9fZXhjZWwoewogICAgICAgICAgICAgICAgICBoZWFkZXI6IHRIZWFkZXIsIC8v6KGo5aS0IOW/heWhqwogICAgICAgICAgICAgICAgICBkYXRhLCAvL+WFt+S9k+aVsOaNriDlv4XloasKICAgICAgICAgICAgICAgICAgZmlsZW5hbWU6ICLlkIjlkIzkv6Hmga/ooagiLCAvL+mdnuW/heWhqwogICAgICAgICAgICAgICAgICBhdXRvV2lkdGg6IHRydWUsIC8v6Z2e5b+F5aGrCiAgICAgICAgICAgICAgICAgIGJvb2tUeXBlOiAieGxzeCIgLy/pnZ7lv4XloasKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9KTsgCiAgICAgICAgfTsKICAgICAgICBjb25zdCBwYWdlOiBhbnkgPSB7fTsKICAgICAgICAvLyDorr7nva5wYWdl77yMc2l6ZQogICAgICAgIGlmIChPYmplY3QuaXMoZGF0YS50eXBlLCAnbWF4Um93Q291bnQnKSkgewogICAgICAgICAgICBPYmplY3QuYXNzaWduKHBhZ2UsIHsgcGFnZTogMCwgc2l6ZTogZGF0YS5tYXhSb3dDb3VudCB9KTsKICAgICAgICB9IGVsc2UgaWYgKE9iamVjdC5pcyhkYXRhLnR5cGUsICdhY3RpdmF0ZWRQYWdlJykpIHsKICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgIGRvRXhwb3J0KEpTT04ucGFyc2UoSlNPTi5zdHJpbmdpZnkodGhpcy5pdGVtcykpKTsKICAgICAgICAgICAgfSBjYXRjaCAoZXJyb3IpIHsKICAgICAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoZXJyb3IpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICB9CiAgICAgICAgLy8g6K6+572u5o6S5bqPCiAgICAgICAgaWYgKCF0aGlzLmlzTm9Tb3J0ICYmICFPYmplY3QuaXModGhpcy5taW5vclNvcnREaXIsICcnKSAmJiAhT2JqZWN0LmlzKHRoaXMubWlub3JTb3J0UFNERUYsICcnKSkgewogICAgICAgICAgY29uc3Qgc29ydDogc3RyaW5nID0gdGhpcy5taW5vclNvcnRQU0RFRisiLCIrdGhpcy5taW5vclNvcnREaXI7CiAgICAgICAgICAgIE9iamVjdC5hc3NpZ24ocGFnZSwgeyBzb3J0OiBzb3J0IH0pOwogICAgICAgIH0KICAgICAgICBjb25zdCBhcmc6IGFueSA9IHt9OwogICAgICAgIE9iamVjdC5hc3NpZ24oYXJnLCBwYWdlKTsKICAgICAgICAvLyDojrflj5ZxdWVyeSzmkJzntKLooajljZXvvIx2aWV3cGFyYW1z562J54i25pWw5o2uCiAgICAgICAgY29uc3QgcGFyZW50ZGF0YTogYW55ID0ge307CiAgICAgICAgdGhpcy4kZW1pdCgnYmVmb3JlbG9hZCcsIHBhcmVudGRhdGEpOwogICAgICAgIE9iamVjdC5hc3NpZ24oYXJnLCBwYXJlbnRkYXRhKTsKICAgICAgICBjb25zdCBwb3N0OiBQcm9taXNlPGFueT4gPSB0aGlzLnNlcnZpY2Uuc2VhcmNoKHRoaXMuZmV0Y2hBY3Rpb24sSlNPTi5wYXJzZShKU09OLnN0cmluZ2lmeSh0aGlzLmNvbnRleHQpKSwgYXJnLCB0aGlzLnNob3dCdXN5SW5kaWNhdG9yKTsKICAgICAgICBwb3N0LnRoZW4oKHJlc3BvbnNlOiBhbnkpID0+IHsKICAgICAgICAgICAgaWYgKCFyZXNwb25zZSB8fCByZXNwb25zZS5zdGF0dXMgIT09IDIwMCkgewogICAgICAgICAgICAgICAgdGhpcy4kTm90aWNlLmVycm9yKHsgdGl0bGU6ICcnLCBkZXNjOiAn5pWw5o2u5a+85Ye65aSx6LSlLCcgKyByZXNwb25zZS5pbmZvIH0pOwogICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICBkb0V4cG9ydChKU09OLnBhcnNlKEpTT04uc3RyaW5naWZ5KHJlc3BvbnNlLmRhdGEpKSk7CiAgICAgICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7CiAgICAgICAgICAgICAgICBjb25zb2xlLmVycm9yKGVycm9yKTsKICAgICAgICAgICAgfQogICAgICAgIH0pLmNhdGNoKChyZXNwb25zZTogYW55KSA9PiB7CiAgICAgICAgICAgIGlmIChyZXNwb25zZSAmJiByZXNwb25zZS5zdGF0dXMgPT09IDQwMSkgewogICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHRoaXMuJE5vdGljZS5lcnJvcih7IHRpdGxlOiAnJywgZGVzYzogJ+aVsOaNruWvvOWHuuWksei0pScgfSk7CiAgICAgICAgfSk7CiAgICB9CgoKICAgIC8qKgogICAgICog5a+85Ye65pWw5o2u5qC85byP5YyWCiAgICAgKiAKICAgICAqIEBwYXJhbSB7Kn0gZmlsdGVyVmFsCiAgICAgKiBAcGFyYW0geyp9IGpzb25EYXRhCiAgICAgKiBAcmV0dXJucyB7W119CiAgICAgKiBAbWVtYmVyb2YgTWFpbl8zQmFzZQogICAgICovCiAgICBwdWJsaWMgYXN5bmMgZm9ybWF0RXhjZWxEYXRhKGZpbHRlclZhbDphbnksIGpzb25EYXRhOmFueSkgewogICAgICAgIGxldCBjb2RlbGlzdENvbHVtbnM6QXJyYXk8YW55PiA9IFsKICAgICAgICAgIHsKICAgICAgICAgICAgbmFtZTogJ2h0bHgnLAogICAgICAgICAgICBzcmZrZXk6ICdFaHJDb2RlTGlzdDAwODQnLAogICAgICAgICAgICBjb2RlbGlzdFR5cGUgOiAnRFlOQU1JQycsCiAgICAgICAgICAgIHRleHRTZXBhcmF0b3I6ICfjgIEnLAogICAgICAgICAgICByZW5kZXJNb2RlOiAnc3RyaW5nJywKICAgICAgICAgICAgdmFsdWVTZXBhcmF0b3I6ICI7IiwKICAgICAgICAgIH0sCiAgICAgICAgICB7CiAgICAgICAgICAgIG5hbWU6ICdjb250cmFjdHR5cGUnLAogICAgICAgICAgICBzcmZrZXk6ICdFaHJDb2RlTGlzdDAxMDcnLAogICAgICAgICAgICBjb2RlbGlzdFR5cGUgOiAnRFlOQU1JQycsCiAgICAgICAgICAgIHJlbmRlck1vZGU6ICdvdGhlcicsCiAgICAgICAgICAgIHRleHRTZXBhcmF0b3I6ICfjgIEnLAogICAgICAgICAgICB2YWx1ZVNlcGFyYXRvcjogJywnLAogICAgICAgICAgfSwKICAgICAgICAgIHsKICAgICAgICAgICAgbmFtZTogJ2h0enQnLAogICAgICAgICAgICBzcmZrZXk6ICdFaHJDb2RlTGlzdDAwMzAnLAogICAgICAgICAgICBjb2RlbGlzdFR5cGUgOiAnU1RBVElDJywKICAgICAgICAgICAgdGV4dFNlcGFyYXRvcjogJ+OAgScsCiAgICAgICAgICAgIHJlbmRlck1vZGU6ICdzdHJpbmcnLAogICAgICAgICAgICB2YWx1ZVNlcGFyYXRvcjogIjsiLAogICAgICAgICAgfSwKICAgICAgICBdOwogICAgICAgIGxldCBfdGhpcyA9IHRoaXM7CiAgICAgICAgZm9yIChjb25zdCBjb2RlbGlzdCBvZiBjb2RlbGlzdENvbHVtbnMpIHsKICAgICAgICAgIC8vIOWKqOaAgeS7o+eggeihqOWkhOeQhgogICAgICAgICAgaWYgKE9iamVjdC5pcyhjb2RlbGlzdC5jb2RlbGlzdFR5cGUsICJEWU5BTUlDIikpIHsKICAgICAgICAgICAgICBsZXQgaXRlbXMgPSBhd2FpdCBfdGhpcy5jb2RlTGlzdFNlcnZpY2UuZ2V0SXRlbXMoY29kZWxpc3Quc3Jma2V5KTsKICAgICAgICAgICAgICBqc29uRGF0YS5mb3JFYWNoKChyb3c6YW55KT0+ewogICAgICAgICAgICAgICAgICByb3dbY29kZWxpc3QubmFtZV0gPSBfdGhpcy5nZXRDb2RlbGlzdFZhbHVlKGl0ZW1zLCByb3dbY29kZWxpc3QubmFtZV0sIGNvZGVsaXN0KTsKICAgICAgICAgICAgICB9KTsKICAgICAgICAgIC8vIOmdmeaAgeWkhOeQhgogICAgICAgICAgfSBlbHNlIGlmKE9iamVjdC5pcyhjb2RlbGlzdC5jb2RlbGlzdFR5cGUsICJTVEFUSUMiKSl7CiAgICAgICAgICAgICAgbGV0IGl0ZW1zID0gYXdhaXQgX3RoaXMuJHN0b3JlLmdldHRlcnMuZ2V0Q29kZUxpc3RJdGVtcyhjb2RlbGlzdC5zcmZrZXkpOwogICAgICAgICAgICAgIGpzb25EYXRhLmZvckVhY2goKHJvdzphbnkpPT57CiAgICAgICAgICAgICAgICAgIHJvd1tjb2RlbGlzdC5uYW1lXSA9IF90aGlzLmdldENvZGVsaXN0VmFsdWUoaXRlbXMsIHJvd1tjb2RlbGlzdC5uYW1lXSwgY29kZWxpc3QpOwogICAgICAgICAgICAgIH0pOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgICByZXR1cm4ganNvbkRhdGEubWFwKCh2OmFueSkgPT4gZmlsdGVyVmFsLm1hcCgoajphbnkpID0+IHZbal0pKQogICAgfSAgIAoKCiAgICAvKioKICAgICAqIOino+aekOS7o+eggeihqOWSjHZsYXVl77yM6K6+572uaXRlbXMKICAgICAqCiAgICAgKiBAcHVibGljCiAgICAgKiBAcGFyYW0ge2FueVtdfSBpdGVtcyDku6PnoIHooajmlbDmja4KICAgICAqIEBwYXJhbSB7Kn0gdmFsdWUKICAgICAqIEByZXR1cm5zIHsqfQogICAgICogQG1lbWJlcm9mIE1haW5fM0Jhc2UKICAgICAqLwogICAgcHVibGljIGdldENvZGVsaXN0VmFsdWUoaXRlbXM6IGFueVtdLCB2YWx1ZTogYW55LCBjb2RlbGlzdDogYW55LCl7CiAgICAgICAgaWYoIXZhbHVlKXsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuJHQoJ2NvZGVsaXN0LicrY29kZWxpc3Quc3Jma2V5KycuZW1wdHknKTsKICAgICAgICB9CiAgICAgICAgaWYgKGl0ZW1zKSB7CiAgICAgICAgICAgIGxldCByZXN1bHQ6YW55ID0gW107CiAgICAgICAgICAgIGlmKE9iamVjdC5pcyhjb2RlbGlzdC5yZW5kZXJNb2RlLCJudW1iZXIiKSl7CiAgICAgICAgICAgICAgICBpdGVtcy5tYXAoKF9pdGVtOiBhbnksIGluZGV4OiBudW1iZXIpPT57CiAgICAgICAgICAgICAgICAgICAgY29uc3QgblZhbHVlID0gcGFyc2VJbnQoKHZhbHVlIGFzIGFueSksIDEwKTsKICAgICAgICAgICAgICAgICAgICBjb25zdCBjb2RldmFsdWUgPSBfaXRlbS52YWx1ZTsKICAgICAgICAgICAgICAgICAgICBpZigocGFyc2VJbnQoY29kZXZhbHVlLCAxMCkgJiBuVmFsdWUpID4gMCl7CiAgICAgICAgICAgICAgICAgICAgICAgIHJlc3VsdC5wdXNoKF9pdGVtKTsKICAgICAgICAgICAgICAgICAgICB9IAogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH0gZWxzZSBpZihPYmplY3QuaXMoY29kZWxpc3QucmVuZGVyTW9kZSwic3RyaW5nIikpewogICAgICAgICAgICAgICAgY29uc3QgYXJyYXlWYWx1ZTogQXJyYXk8YW55PiA9ICh2YWx1ZSBhcyBhbnkpLnNwbGl0KGNvZGVsaXN0LnZhbHVlU2VwYXJhdG9yKTsKICAgICAgICAgICAgICAgIGFycmF5VmFsdWUubWFwKCh2YWx1ZTogYW55LCBpbmRleDogbnVtYmVyKSA9PiB7CiAgICAgICAgICAgICAgICAgICAgcmVzdWx0LnB1c2goW10pOwogICAgICAgICAgICAgICAgICAgIGxldCB2YWx1ZXM6IGFueVtdID0gT2JqZWN0LmlzKHRoaXMuJHV0aWwudHlwZU9mKHZhbHVlKSwgJ251bWJlcicpID8gW3ZhbHVlXSA6IFsuLi4odmFsdWUgYXMgYW55KS5zcGxpdChjb2RlbGlzdC52YWx1ZVNlcGFyYXRvcildOwogICAgICAgICAgICAgICAgICAgIHZhbHVlcy5tYXAoKHZhbDphbnkgLG51bTogbnVtYmVyKT0+ewogICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBpdGVtID0gdGhpcy5nZXRJdGVtKGl0ZW1zLCB2YWwsIGNvZGVsaXN0KTsgCiAgICAgICAgICAgICAgICAgICAgICAgIGlmKGl0ZW0pewogICAgICAgICAgICAgICAgICAgICAgICAgIHJlc3VsdFtpbmRleF0ucHVzaChpdGVtKTsKICAgICAgICAgICAgICAgICAgICAgICAgfSAKICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgbGV0IHZhbHVlczogYW55W10gPSBPYmplY3QuaXModGhpcy4kdXRpbC50eXBlT2YodmFsdWUpLCAnbnVtYmVyJykgPyBbdmFsdWVdIDogWy4uLih2YWx1ZSBhcyBhbnkpLnNwbGl0KGNvZGVsaXN0LnZhbHVlU2VwYXJhdG9yKV07CiAgICAgICAgICAgICAgICB2YWx1ZXMubWFwKCh2YWx1ZTphbnkgLGluZGV4OiBudW1iZXIpPT57CiAgICAgICAgICAgICAgICAgICAgY29uc3QgaXRlbSA9IHRoaXMuZ2V0SXRlbShpdGVtcywgdmFsdWUsIGNvZGVsaXN0KTsgCiAgICAgICAgICAgICAgICAgICAgaWYoaXRlbSl7CiAgICAgICAgICAgICAgICAgICAgICByZXN1bHQucHVzaChpdGVtKTsKICAgICAgICAgICAgICAgICAgICB9IAogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgLy8g6K6+572uaXRlbXMKICAgICAgICAgICAgaWYocmVzdWx0Lmxlbmd0aCAhPSAwKXsKICAgICAgICAgICAgICByZXR1cm4gcmVzdWx0LmpvaW4oY29kZWxpc3QudmFsdWVTZXBhcmF0b3IpOwogICAgICAgICAgICB9ZWxzZXsKICAgICAgICAgICAgICByZXR1cm4gdmFsdWU7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiDojrflj5bku6PnoIHpobkKICAgICAqCiAgICAgKiBAcHVibGljCiAgICAgKiBAcGFyYW0ge2FueVtdfSBpdGVtcwogICAgICogQHBhcmFtIHsqfSB2YWx1ZQogICAgICogQHJldHVybnMgeyp9CiAgICAgKiBAbWVtYmVyb2YgTWFpbl8zQmFzZQogICAgICovCiAgICBwdWJsaWMgZ2V0SXRlbShpdGVtczogYW55W10sIHZhbHVlOiBhbnksIGNvZGVsaXN0OiBhbnkpOiBhbnkgewogICAgICAgIGNvbnN0IGFycjogQXJyYXk8YW55PiA9IGl0ZW1zLmZpbHRlcihpdGVtID0+IHtyZXR1cm4gaXRlbS52YWx1ZSA9PSB2YWx1ZX0pOwogICAgICAgIGlmIChhcnIubGVuZ3RoICE9PSAxKSB7CiAgICAgICAgICAgIHJldHVybiB1bmRlZmluZWQ7CiAgICAgICAgfQogICAgICAgIGlmKE9iamVjdC5pcyhjb2RlbGlzdC5jb2RlbGlzdFR5cGUsJ1NUQVRJQycpKXsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuJHQoJ2NvZGVsaXN0LicrY29kZWxpc3Quc3Jma2V5KycuJythcnJbMF0udmFsdWUpOwogICAgICAgIH1lbHNlewogICAgICAgICAgICByZXR1cm4gYXJyWzBdLnRleHQ7CiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICog55Sf5ZG95ZGo5pyfCiAgICAgKgogICAgICogQG1lbWJlcm9mIE1haW5fM0Jhc2UKICAgICAqLwogICAgcHVibGljIGNyZWF0ZWQoKTogdm9pZCB7CiAgICAgICAgdGhpcy5hZnRlckNyZWF0ZWQoKTsKICAgIH0KCiAgICAvKioKICAgICAqIOaJp+ihjGNyZWF0ZWTlkI7nmoTpgLvovpEKICAgICAqCiAgICAgKiAgQG1lbWJlcm9mIE1haW5fM0Jhc2UKICAgICAqLyAgICAKICAgIHB1YmxpYyBhZnRlckNyZWF0ZWQoKXsKICAgICAgICB0aGlzLnNldENvbFN0YXRlKCk7CiAgICAgICAgaWYgKHRoaXMudmlld1N0YXRlKSB7CiAgICAgICAgICAgIHRoaXMudmlld1N0YXRlRXZlbnQgPSB0aGlzLnZpZXdTdGF0ZS5zdWJzY3JpYmUoKHsgdGFnLCBhY3Rpb24sIGRhdGEgfSkgPT4gewogICAgICAgICAgICAgICAgaWYgKCFPYmplY3QuaXModGFnLCB0aGlzLm5hbWUpKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgaWYgKE9iamVjdC5pcygnbG9hZCcsIGFjdGlvbikpIHsKICAgICAgICAgICAgICAgICAgICB0aGlzLmxvYWQoZGF0YSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBpZiAoT2JqZWN0LmlzKCdyZW1vdmUnLCBhY3Rpb24pKSB7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5yZW1vdmUoZGF0YSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBpZiAoT2JqZWN0LmlzKCdzYXZlJywgYWN0aW9uKSkgewogICAgICAgICAgICAgICAgICAgIHRoaXMuc2F2ZShkYXRhKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSk7CiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICogdnVlIOeUn+WRveWRqOacnwogICAgICoKICAgICAqIEBtZW1iZXJvZiBNYWluXzNCYXNlCiAgICAgKi8KICAgIHB1YmxpYyBkZXN0cm95ZWQoKSB7CiAgICAgICAgdGhpcy5hZnRlckRlc3Ryb3koKTsKICAgIH0KCiAgICAvKioKICAgICAqIOaJp+ihjGRlc3Ryb3llZOWQjueahOmAu+i+kQogICAgICoKICAgICAqIEBtZW1iZXJvZiBNYWluXzNCYXNlCiAgICAgKi8KICAgIHB1YmxpYyBhZnRlckRlc3Ryb3koKSB7CiAgICAgICAgaWYgKHRoaXMudmlld1N0YXRlRXZlbnQpIHsKICAgICAgICAgICAgdGhpcy52aWV3U3RhdGVFdmVudC51bnN1YnNjcmliZSgpOwogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIOiOt+WPlumAieS4reihjOiDoeaVsOaNrgogICAgICoKICAgICAqIEByZXR1cm5zIHthbnlbXX0KICAgICAqIEBtZW1iZXJvZiBNYWluXzNCYXNlCiAgICAgKi8KICAgIHB1YmxpYyBnZXRTZWxlY3Rpb24oKTogYW55W10gewogICAgICAgIHJldHVybiB0aGlzLnNlbGVjdGlvbnM7CiAgICB9CgogICAgLyoqCiAgICAgKiDooYzlj4zlh7vkuovku7YKICAgICAqCiAgICAgKiBAcGFyYW0geyp9ICRldmVudAogICAgICogQHJldHVybnMge3ZvaWR9CiAgICAgKiBAbWVtYmVyb2YgTWFpbl8zQmFzZQogICAgICovCiAgICBwdWJsaWMgcm93REJMQ2xpY2soJGV2ZW50OiBhbnkpOiB2b2lkIHsKICAgICAgICBpZiAoISRldmVudCB8fCB0aGlzLmFjdHVhbElzT3BlbkVkaXQgfHwgT2JqZWN0LmlzKHRoaXMuZ3JpZFJvd0FjdGl2ZU1vZGUsMCkpIHsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KICAgICAgICB0aGlzLnNlbGVjdGlvbnMgPSBbXTsKICAgICAgICB0aGlzLnNlbGVjdGlvbnMucHVzaChKU09OLnBhcnNlKEpTT04uc3RyaW5naWZ5KCRldmVudCkpKTsKCiAgICAgICAgY29uc3QgcmVmczogYW55ID0gdGhpcy4kcmVmczsKICAgICAgICBpZiAocmVmcy5tdWx0aXBsZVRhYmxlKSB7CiAgICAgICAgICAgIHJlZnMubXVsdGlwbGVUYWJsZS5jbGVhclNlbGVjdGlvbigpOwogICAgICAgICAgICByZWZzLm11bHRpcGxlVGFibGUudG9nZ2xlUm93U2VsZWN0aW9uKCRldmVudCk7CiAgICAgICAgfQoKICAgICAgICB0aGlzLiRlbWl0KCdyb3dkYmxjbGljaycsIHRoaXMuc2VsZWN0aW9ucyk7CiAgICAgICAgdGhpcy4kZW1pdCgnc2VsZWN0aW9uY2hhbmdlJywgdGhpcy5zZWxlY3Rpb25zKTsKICAgIH0KCiAgICAvKioKICAgICAqIOWkjemAieahhuaVsOaNrumAieS4rQogICAgICoKICAgICAqIEBwYXJhbSB7Kn0gJGV2ZW50CiAgICAgKiBAcmV0dXJucyB7dm9pZH0KICAgICAqIEBtZW1iZXJvZiBNYWluXzNCYXNlCiAgICAgKi8KICAgIHB1YmxpYyBzZWxlY3QoJGV2ZW50OiBhbnkpOiB2b2lkIHsKICAgICAgICBpZiAoISRldmVudCkgewogICAgICAgICAgICByZXR1cm47CiAgICAgICAgfQogICAgICAgIHRoaXMuc2VsZWN0aW9ucyA9IFtdOwogICAgICAgIHRoaXMuc2VsZWN0aW9ucyA9IFsuLi5KU09OLnBhcnNlKEpTT04uc3RyaW5naWZ5KCRldmVudCkpXTsKICAgICAgICB0aGlzLiRlbWl0KCdzZWxlY3Rpb25jaGFuZ2UnLCB0aGlzLnNlbGVjdGlvbnMpOwogICAgfQoKICAgIC8qKgogICAgICog5aSN6YCJ5qGG5pWw5o2u5YWo6YOo6YCJ5LitCiAgICAgKgogICAgICogQHBhcmFtIHsqfSAkZXZlbnQKICAgICAqIEBtZW1iZXJvZiBNYWluXzNCYXNlCiAgICAgKi8KICAgIHB1YmxpYyBzZWxlY3RBbGwoJGV2ZW50OiBhbnkpOiB2b2lkIHsKICAgICAgICBpZiAoISRldmVudCkgewogICAgICAgICAgICByZXR1cm47CiAgICAgICAgfQogICAgICAgIHRoaXMuc2VsZWN0aW9ucyA9IFtdOwogICAgICAgIHRoaXMuc2VsZWN0aW9ucyA9IFsuLi5KU09OLnBhcnNlKEpTT04uc3RyaW5naWZ5KCRldmVudCkpXTsKICAgICAgICB0aGlzLiRlbWl0KCdzZWxlY3Rpb25jaGFuZ2UnLCB0aGlzLnNlbGVjdGlvbnMpOwogICAgfQoKICAgIAogICAgLyoqCiAgICAgKiDooYzljZXlh7vpgInkuK0KICAgICAqCiAgICAgKiBAcGFyYW0geyp9ICRldmVudAogICAgICogQHJldHVybnMge3ZvaWR9CiAgICAgKiBAbWVtYmVyb2YgTWFpbl8zQmFzZQogICAgICovCiAgICBwdWJsaWMgcm93Q2xpY2soJGV2ZW50OiBhbnksIGlmQWx3YXlzOiBib29sZWFuID0gZmFsc2UpOiB2b2lkIHsKICAgICAgICBpZiAoIWlmQWx3YXlzICYmICghJGV2ZW50IHx8IHRoaXMuYWN0dWFsSXNPcGVuRWRpdCkpIHsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KICAgICAgICBpZih0aGlzLnN0b3BSb3dDbGljaykgewogICAgICAgICAgICB0aGlzLnN0b3BSb3dDbGljayA9IGZhbHNlOwogICAgICAgICAgICByZXR1cm47CiAgICAgICAgfQogICAgICAgIGlmKHRoaXMuaXNTaW5nbGVTZWxlY3QpewogICAgICAgICAgICB0aGlzLnNlbGVjdGlvbnMgPSBbXTsKICAgICAgICB9CiAgICAgICAgLy8g5bey6YCJ5Lit5YiZ5Yig6Zmk77yM5rKh6YCJ5Lit5YiZ5re75YqgCiAgICAgICAgbGV0IHNlbGVjdEluZGV4ID0gdGhpcy5zZWxlY3Rpb25zLmZpbmRJbmRleCgoaXRlbTphbnkpPT57CiAgICAgICAgICAgIHJldHVybiBPYmplY3QuaXMoaXRlbS5waW1jb250cmFjdCwkZXZlbnQucGltY29udHJhY3QpOwogICAgICAgIH0pOwogICAgICAgIGlmIChPYmplY3QuaXMoc2VsZWN0SW5kZXgsLTEpKXsKICAgICAgICAgIHRoaXMuc2VsZWN0aW9ucy5wdXNoKEpTT04ucGFyc2UoSlNPTi5zdHJpbmdpZnkoJGV2ZW50KSkpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICB0aGlzLnNlbGVjdGlvbnMuc3BsaWNlKHNlbGVjdEluZGV4LDEpOwogICAgICAgIH0KCiAgICAgICAgY29uc3QgcmVmczogYW55ID0gdGhpcy4kcmVmczsKICAgICAgICBpZiAocmVmcy5tdWx0aXBsZVRhYmxlKSB7CiAgICAgICAgICAgIGlmKHRoaXMuaXNTaW5nbGVTZWxlY3QpewogICAgICAgICAgICAgICAgcmVmcy5tdWx0aXBsZVRhYmxlLmNsZWFyU2VsZWN0aW9uKCk7CiAgICAgICAgICAgICAgICByZWZzLm11bHRpcGxlVGFibGUuc2V0Q3VycmVudFJvdygkZXZlbnQpOwogICAgICAgICAgICB9ZWxzZXsKICAgICAgICAgICAgICAgIHJlZnMubXVsdGlwbGVUYWJsZS50b2dnbGVSb3dTZWxlY3Rpb24oJGV2ZW50KTsgCiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIHRoaXMuJGVtaXQoJ3NlbGVjdGlvbmNoYW5nZScsIHRoaXMuc2VsZWN0aW9ucyk7CiAgICB9CgoKICAgIC8qKgogICAgICog6aG16Z2i5Y+Y5YyWCiAgICAgKgogICAgICogQHBhcmFtIHsqfSAkZXZlbnQKICAgICAqIEByZXR1cm5zIHt2b2lkfQogICAgICogQG1lbWJlcm9mIE1haW5fM0Jhc2UKICAgICAqLwogICAgcHVibGljIHBhZ2VPbkNoYW5nZSgkZXZlbnQ6IGFueSk6IHZvaWQgewogICAgICAgIGlmICghJGV2ZW50KSB7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICB9CiAgICAgICAgaWYgKCRldmVudCA9PT0gdGhpcy5jdXJQYWdlKSB7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICB9CiAgICAgICAgdGhpcy5jdXJQYWdlID0gJGV2ZW50OwogICAgICAgIHRoaXMubG9hZCh7fSk7CiAgICB9CgogICAgLyoqCiAgICAgKiDliIbpobXmnaHmlbDlj5jljJYKICAgICAqCiAgICAgKiBAcGFyYW0geyp9ICRldmVudAogICAgICogQHJldHVybnMge3ZvaWR9CiAgICAgKiBAbWVtYmVyb2YgTWFpbl8zQmFzZQogICAgICovCiAgICBwdWJsaWMgb25QYWdlU2l6ZUNoYW5nZSgkZXZlbnQ6IGFueSk6IHZvaWQgewogICAgICAgIGlmICghJGV2ZW50KSB7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICB9CiAgICAgICAgaWYgKCRldmVudCA9PT0gdGhpcy5saW1pdCkgewogICAgICAgICAgICByZXR1cm47CiAgICAgICAgfQogICAgICAgIHRoaXMubGltaXQgPSAkZXZlbnQ7CiAgICAgICAgaWYgKHRoaXMuY3VyUGFnZSA9PT0gMSkgewogICAgICAgICAgICB0aGlzLmxvYWQoe30pOwogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIOWIhumhteWIt+aWsAogICAgICoKICAgICAqIEBtZW1iZXJvZiBNYWluXzNCYXNlCiAgICAgKi8KICAgIHB1YmxpYyBwYWdlUmVmcmVzaCgpOiB2b2lkIHsKICAgICAgICB0aGlzLmxvYWQoe30pOwogICAgfQoKICAgIC8qKgogICAgICog5o6S5bqP5Y+Y5YyWCiAgICAgKgogICAgICogQHBhcmFtIHt7IGNvbHVtbjogYW55LCBwcm9wOiBhbnksIG9yZGVyOiBhbnkgfX0geyBjb2x1bW4sIHByb3AsIG9yZGVyIH0KICAgICAqIEBtZW1iZXJvZiBNYWluXzNCYXNlCiAgICAgKi8KICAgIHB1YmxpYyBvblNvcnRDaGFuZ2UoeyBjb2x1bW4sIHByb3AsIG9yZGVyIH06IHsgY29sdW1uOiBhbnksIHByb3A6IGFueSwgb3JkZXI6IGFueSB9KTogdm9pZCB7CiAgICAgICAgY29uc3QgZGlyID0gT2JqZWN0LmlzKG9yZGVyLCAnYXNjZW5kaW5nJykgPyAnYXNjJyA6IE9iamVjdC5pcyhvcmRlciwgJ2Rlc2NlbmRpbmcnKSA/ICdkZXNjJyA6ICcnOwogICAgICAgIGlmIChPYmplY3QuaXMoZGlyLCB0aGlzLm1pbm9yU29ydERpcikgJiYgT2JqZWN0LmlzKHRoaXMubWlub3JTb3J0UFNERUYsIHByb3ApKSB7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICB9CiAgICAgICAgdGhpcy5taW5vclNvcnREaXIgPSBkaXI7CiAgICAgICAgdGhpcy5taW5vclNvcnRQU0RFRiA9IHByb3AgPyBwcm9wIDogJyc7CiAgICAgICAgdGhpcy5sb2FkKHt9KTsKICAgIH0KCiAgICAvKioKICAgICAqIOihqOagvOihjOmAieS4reagt+W8jwogICAgICoKICAgICAqIEBwYXJhbSB7eyByb3c6IGFueSwgcm93SW5kZXg6IGFueSB9fSB7IHJvdywgcm93SW5kZXggfQogICAgICogQHJldHVybnMge3N0cmluZ30KICAgICAqIEBtZW1iZXJvZiBNYWluXzNCYXNlCiAgICAgKi8KICAgIHB1YmxpYyBvblJvd0NsYXNzTmFtZSh7IHJvdywgcm93SW5kZXggfTogeyByb3c6IGFueSwgcm93SW5kZXg6IGFueSB9KTogc3RyaW5nIHsKICAgICAgICBjb25zdCBpbmRleCA9IHRoaXMuc2VsZWN0aW9ucy5maW5kSW5kZXgoKHNlbGVjdDogYW55KSA9PiBPYmplY3QuaXMoc2VsZWN0LnNyZmtleSwgcm93LnNyZmtleSkpOwogICAgICAgIHJldHVybiBpbmRleCAhPT0gLTEgPyAnZ3JpZC1yb3ctc2VsZWN0JyA6ICcnOwogICAgfQoKCgogICAgLyoqCiAgICAgKiDnlYzpnaLooYzkuLoKICAgICAqCiAgICAgKiBAcGFyYW0geyp9IHJvdwogICAgICogQHBhcmFtIHsqfSB0YWcKICAgICAqIEBwYXJhbSB7Kn0gJGV2ZW50CiAgICAgKiBAbWVtYmVyb2YgTWFpbl8zQmFzZQogICAgICovCglwdWJsaWMgdWlBY3Rpb24ocm93OiBhbnksIHRhZzogYW55LCAkZXZlbnQ6IGFueSkgewogICAgICAgIC8vIHRoaXMucm93Q2xpY2socm93LCB0cnVlKTsKICAgICAgICAkZXZlbnQuc3RvcFByb3BhZ2F0aW9uKCk7CiAgICB9CgogICAgLyoqCiAgICAgKiDorr7nva7liJfnirbmgIEKICAgICAqCiAgICAgKiBAbWVtYmVyb2YgTWFpbl8zQmFzZQogICAgICovCiAgICBwdWJsaWMgc2V0Q29sU3RhdGUoKSB7CgkJY29uc3QgX2RhdGE6IGFueSA9IGxvY2FsU3RvcmFnZS5nZXRJdGVtKCdwaW1jb250cmFjdF9tYWluXzNfZ3JpZCcpOwoJCWlmIChfZGF0YSkgewoJCQlsZXQgY29sdW1ucyA9IEpTT04ucGFyc2UoX2RhdGEpOwoJCQljb2x1bW5zLmZvckVhY2goKGNvbDogYW55KSA9PiB7CgkJCQlsZXQgY29sdW1uID0gdGhpcy5hbGxDb2x1bW5zLmZpbmQoKGl0ZW0pID0+IE9iamVjdC5pcyhjb2wubmFtZSwgaXRlbS5uYW1lKSk7CgkJCQlpZiAoY29sdW1uKSB7CgkJCQkJT2JqZWN0LmFzc2lnbihjb2x1bW4sIGNvbCk7CgkJCQl9CgkJCX0pOwoJCX0KICAgIH0KCiAgICAvKioKICAgICAqIOWIl+WPmOWMlgogICAgICoKICAgICAqIEBtZW1iZXJvZiBNYWluXzNCYXNlCiAgICAgKi8KICAgIHB1YmxpYyBvbkNvbENoYW5nZSgpIHsKICAgICAgICBsb2NhbFN0b3JhZ2Uuc2V0SXRlbSgncGltY29udHJhY3RfbWFpbl8zX2dyaWQnLCBKU09OLnN0cmluZ2lmeSh0aGlzLmFsbENvbHVtbnMpKTsKICAgIH0KCiAgICAvKioKICAgICAqIOiOt+WPluWIl+eKtuaAgQogICAgICoKICAgICAqIEBwYXJhbSB7c3RyaW5nfSBuYW1lCiAgICAgKiBAcmV0dXJucyB7Ym9vbGVhbn0KICAgICAqIEBtZW1iZXJvZiBNYWluXzNCYXNlCiAgICAgKi8KICAgIHB1YmxpYyBnZXRDb2x1bW5TdGF0ZShuYW1lOiBzdHJpbmcpOiBib29sZWFuIHsKICAgICAgICBsZXQgY29sdW1uID0gdGhpcy5hbGxDb2x1bW5zLmZpbmQoKGNvbDogYW55KSA9PgogICAgICAgICAgICBPYmplY3QuaXMobmFtZSwgY29sLm5hbWUpCiAgICAgICAgKTsKICAgICAgICByZXR1cm4gY29sdW1uLnNob3cgPyB0cnVlIDogZmFsc2U7CiAgICB9CgogICAgLyoqCiAgICAgKiDooajmoLzliJfmmK/lkKboh6rpgILlupTluIPlsYAKICAgICAqCiAgICAgKiBAcmVhZG9ubHkKICAgICAqIEB0eXBlIHtib29sZWFufQogICAgICogQG1lbWJlcm9mIE1haW5fM0Jhc2UKICAgICAqLwogICAgZ2V0IGFkYXB0aXZlU3RhdGUoKTogYm9vbGVhbiB7CiAgICAgICAgcmV0dXJuICF0aGlzLmFsbENvbHVtbnMuZmluZCgoY29sdW1uOiBhbnkpID0+IGNvbHVtbi5zaG93ICYmIE9iamVjdC5pcyhjb2x1bW4udXRpbCwgJ1NUQVInKSk7CiAgICB9CgogICAgLyoqCiAgICAgKiDkv53lrZgKICAgICAqCiAgICAgKiBAcGFyYW0geyp9ICRldmVudAogICAgICogQHJldHVybnMge1Byb21pc2U8YW55Pn0KICAgICAqIEBtZW1iZXJvZiBNYWluXzNCYXNlCiAgICAgKi8KICAgIHB1YmxpYyBhc3luYyBzYXZlKGFyZ3M6IGFueVtdLCBwYXJhbXM/OiBhbnksICRldmVudD86IGFueSwgeERhdGE/OiBhbnkpewogICAgICAgIGxldCBfdGhpcyA9IHRoaXM7CiAgICAgICAgaWYoIWF3YWl0IHRoaXMudmFsaWRhdGVBbGwoKSl7CiAgICAgICAgICAgIHRoaXMuJE5vdGljZS5lcnJvcih7IHRpdGxlOiAn6ZSZ6K+vJywgZGVzYzogJ+WAvOinhOWImeagoemqjOW8guW4uCcgfSk7CiAgICAgICAgICAgIHJldHVybiBbXTsKICAgICAgICB9CiAgICAgICAgbGV0IHN1Y2Nlc3NJdGVtczphbnkgPSBbXTsKICAgICAgICBsZXQgZXJyb3JJdGVtczphbnkgPSBbXTsKICAgICAgICBsZXQgZXJyb3JNZXNzYWdlOmFueSA9IFtdOwogICAgICAgIGZvciAoY29uc3QgaXRlbSBvZiBfdGhpcy5pdGVtcykgewogICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgaWYoT2JqZWN0LmlzKGl0ZW0ucm93RGF0YVN0YXRlLCAnY3JlYXRlJykpewogICAgICAgICAgICAgICAgICAgIGlmKCF0aGlzLmNyZWF0ZUFjdGlvbil7CiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuJE5vdGljZS5lcnJvcih7IHRpdGxlOiAn6ZSZ6K+vJywgZGVzYzogJ1BJTUNPTlRSQUNUV1NTR3JpZFZpZXfop4blm77ooajmoLxjcmVhdGVBY3Rpb27lj4LmlbDmnKrphY3nva4nIH0pOwogICAgICAgICAgICAgICAgICAgIH1lbHNlewogICAgICAgICAgICAgICAgICAgICAgT2JqZWN0LmFzc2lnbihpdGVtLHt2aWV3cGFyYW1zOnRoaXMudmlld3BhcmFtc30pOwogICAgICAgICAgICAgICAgICAgICAgbGV0IHJlc3BvbnNlID0gYXdhaXQgdGhpcy5zZXJ2aWNlLmFkZCh0aGlzLmNyZWF0ZUFjdGlvbiwgSlNPTi5wYXJzZShKU09OLnN0cmluZ2lmeSh0aGlzLmNvbnRleHQpKSxpdGVtLCB0aGlzLnNob3dCdXN5SW5kaWNhdG9yKTsKICAgICAgICAgICAgICAgICAgICAgIHN1Y2Nlc3NJdGVtcy5wdXNoKEpTT04ucGFyc2UoSlNPTi5zdHJpbmdpZnkocmVzcG9uc2UuZGF0YSkpKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9ZWxzZSBpZihPYmplY3QuaXMoaXRlbS5yb3dEYXRhU3RhdGUsICd1cGRhdGUnKSl7CiAgICAgICAgICAgICAgICAgICAgaWYoIXRoaXMudXBkYXRlQWN0aW9uKXsKICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy4kTm90aWNlLmVycm9yKHsgdGl0bGU6ICfplJnor68nLCBkZXNjOiAnUElNQ09OVFJBQ1RXU1NHcmlkVmlld+inhuWbvuihqOagvHVwZGF0ZUFjdGlvbuWPguaVsOacqumFjee9ricgfSk7CiAgICAgICAgICAgICAgICAgICAgfWVsc2V7CiAgICAgICAgICAgICAgICAgICAgICAgIE9iamVjdC5hc3NpZ24oaXRlbSx7dmlld3BhcmFtczp0aGlzLnZpZXdwYXJhbXN9KTsKICAgICAgICAgICAgICAgICAgICAgICAgaWYoaXRlbS5waW1jb250cmFjdCl7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBPYmplY3QuYXNzaWduKHRoaXMuY29udGV4dCx7cGltY29udHJhY3Q6aXRlbS5waW1jb250cmFjdH0pOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIGxldCByZXNwb25zZSA9IGF3YWl0IHRoaXMuc2VydmljZS5hZGQodGhpcy51cGRhdGVBY3Rpb24sSlNPTi5wYXJzZShKU09OLnN0cmluZ2lmeSh0aGlzLmNvbnRleHQpKSxpdGVtLCB0aGlzLnNob3dCdXN5SW5kaWNhdG9yKTsKICAgICAgICAgICAgICAgICAgICAgICAgc3VjY2Vzc0l0ZW1zLnB1c2goSlNPTi5wYXJzZShKU09OLnN0cmluZ2lmeShyZXNwb25zZS5kYXRhKSkpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSBjYXRjaCAoZXJyb3IpIHsKICAgICAgICAgICAgICAgIGVycm9ySXRlbXMucHVzaChKU09OLnBhcnNlKEpTT04uc3RyaW5naWZ5KGl0ZW0pKSk7CiAgICAgICAgICAgICAgICBlcnJvck1lc3NhZ2UucHVzaChlcnJvcik7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgdGhpcy4kZW1pdCgnc2F2ZScsIHN1Y2Nlc3NJdGVtcyk7CiAgICAgICAgdGhpcy5yZWZyZXNoKFtdKTsKICAgICAgICBpZihlcnJvckl0ZW1zLmxlbmd0aCA9PT0gMCl7CiAgICAgICAgICAgIHRoaXMuJE5vdGljZS5zdWNjZXNzKHsgdGl0bGU6ICcnLCBkZXNjOiAn5L+d5a2Y5oiQ5YqfIScgfSk7CiAgICAgICAgfWVsc2V7CiAgICAgICAgICBlcnJvckl0ZW1zLmZvckVhY2goKGl0ZW06YW55LGluZGV4Om51bWJlcik9PnsKICAgICAgICAgICAgdGhpcy4kTm90aWNlLmVycm9yKHsgdGl0bGU6ICfkv53lrZjlpLHotKUnLCBkZXNjOiBpdGVtLm1ham9yZW50aXR5bmFtZSsn5L+d5a2Y5aSx6LSl77yBJyB9KTsKICAgICAgICAgICAgY29uc29sZS5lcnJvcihlcnJvck1lc3NhZ2VbaW5kZXhdKTsKICAgICAgICAgIH0pOwogICAgICAgIH0KICAgICAgICByZXR1cm4gc3VjY2Vzc0l0ZW1zOwogICAgfQoKICAgIC8qKgogICAgICog5paw5bu66KGMCiAgICAgKgogICAgICogQHBhcmFtIHsqfSAkZXZlbnQKICAgICAqIEByZXR1cm5zIHt2b2lkfQogICAgICogQG1lbWJlcm9mIE1haW5fM0Jhc2UKICAgICAqLwogICAgcHVibGljIG5ld1JvdyhhcmdzOiBhbnlbXSwgcGFyYW1zPzogYW55LCAkZXZlbnQ/OiBhbnksIHhEYXRhPzogYW55KTogdm9pZCB7CiAgICAgICAgaWYoIXRoaXMubG9hZGRyYWZ0QWN0aW9uKXsKICAgICAgICAgICAgdGhpcy4kTm90aWNlLmVycm9yKHsgdGl0bGU6ICfplJnor68nLCBkZXNjOiAnUElNQ09OVFJBQ1RXU1NHcmlkVmlld+inhuWbvuihqOagvGxvYWRkcmFmdEFjdGlvbuWPguaVsOacqumFjee9ricgfSk7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICB9CiAgICAgICAgbGV0IF90aGlzID0gdGhpczsKICAgICAgICBPYmplY3QuYXNzaWduKGFyZ3NbMF0se3ZpZXdwYXJhbXM6dGhpcy52aWV3cGFyYW1zfSk7CiAgICAgICAgbGV0IHBvc3Q6IFByb21pc2U8YW55PiA9IHRoaXMuc2VydmljZS5sb2FkRHJhZnQodGhpcy5sb2FkZHJhZnRBY3Rpb24sIEpTT04ucGFyc2UoSlNPTi5zdHJpbmdpZnkodGhpcy5jb250ZXh0KSksIGFyZ3NbMF0sIHRoaXMuc2hvd0J1c3lJbmRpY2F0b3IpOwogICAgICAgIHBvc3QudGhlbigocmVzcG9uc2U6IGFueSkgPT4gewogICAgICAgICAgICBpZiAoIXJlc3BvbnNlLnN0YXR1cyB8fCByZXNwb25zZS5zdGF0dXMgIT09IDIwMCkgewogICAgICAgICAgICAgICAgaWYgKHJlc3BvbnNlLmVycm9yTWVzc2FnZSkgewogICAgICAgICAgICAgICAgICAgIHRoaXMuJE5vdGljZS5lcnJvcih7IHRpdGxlOiAn6ZSZ6K+vJywgZGVzYzogcmVzcG9uc2UuZXJyb3JNZXNzYWdlIH0pOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGNvbnN0IGRhdGEgPSByZXNwb25zZS5kYXRhOwogICAgICAgICAgICB0aGlzLmNyZWF0ZURlZmF1bHQoZGF0YSk7CiAgICAgICAgICAgIGRhdGEucm93RGF0YVN0YXRlID0gImNyZWF0ZSI7CiAgICAgICAgICAgIF90aGlzLml0ZW1zLnB1c2goZGF0YSk7CiAgICAgICAgICAgIF90aGlzLmdyaWRJdGVtc01vZGVsLnB1c2goX3RoaXMuZ2V0R3JpZFJvd01vZGVsKCkpOwogICAgICAgIH0pLmNhdGNoKChyZXNwb25zZTogYW55KSA9PiB7CiAgICAgICAgICAgIGlmIChyZXNwb25zZSAmJiByZXNwb25zZS5zdGF0dXMgPT09IDQwMSkgewogICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmICghcmVzcG9uc2UgfHwgIXJlc3BvbnNlLnN0YXR1cyB8fCAhcmVzcG9uc2UuZGF0YSkgewogICAgICAgICAgICAgICAgdGhpcy4kTm90aWNlLmVycm9yKHsgdGl0bGU6ICfplJnor68nLCBkZXNjOiAn57O757uf5byC5bi4JyB9KTsKICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgfQogICAgICAgIH0pOwogICAgfQoKICAgIC8qKgogICAgICog6KGo5qC857yW6L6R6aG55YC85Y+Y5pu0CiAgICAgKiAgCiAgICAgKiBAcGFyYW0gcm93IOihjOaVsOaNrgogICAgICogQHBhcmFtIHt7IG5hbWU6IHN0cmluZywgdmFsdWU6IGFueSB9fSAkZXZlbnQKICAgICAqIEByZXR1cm5zIHt2b2lkfQogICAgICogQG1lbWJlcm9mIE1haW5fM0Jhc2UKICAgICAqLwogICAgcHVibGljIG9uR3JpZEl0ZW1WYWx1ZUNoYW5nZShyb3c6IGFueSwkZXZlbnQ6IHsgbmFtZTogc3RyaW5nLCB2YWx1ZTogYW55IH0scm93SW5kZXg6IG51bWJlcik6IHZvaWQgewogICAgICAgIGlmICghJGV2ZW50KSB7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICB9CiAgICAgICAgaWYgKCEkZXZlbnQubmFtZSB8fCBPYmplY3QuaXMoJGV2ZW50Lm5hbWUsICcnKSB8fCAhcm93Lmhhc093blByb3BlcnR5KCRldmVudC5uYW1lKSkgewogICAgICAgICAgICByZXR1cm47CiAgICAgICAgfQogICAgICAgIHJvd1skZXZlbnQubmFtZV0gPSAkZXZlbnQudmFsdWU7CiAgICAgICAgdGhpcy5ncmlkRWRpdEl0ZW1DaGFuZ2Uocm93LCAkZXZlbnQubmFtZSwgJGV2ZW50LnZhbHVlLCByb3dJbmRleCk7CiAgICB9CgogICAgLyoqCiAgICAgKiDooajmoLznvJbovpHpobnlgLzlj5jljJYKICAgICAqCiAgICAgKiBAcHVibGljCiAgICAgKiBAcGFyYW0gcm93IOihjOaVsOaNrgogICAgICogQHBhcmFtIHByb3BlcnR5IOWIl+e8lui+kemhueWQjQogICAgICogQHBhcmFtIHJvdyDliJfnvJbovpHpobnlgLwKICAgICAqIEByZXR1cm5zIHt2b2lkfQogICAgICogQG1lbWJlcm9mIE1haW5fM0Jhc2UKICAgICAqLwogICAgcHVibGljIGdyaWRFZGl0SXRlbUNoYW5nZShyb3c6IGFueSwgcHJvcGVydHk6IHN0cmluZywgdmFsdWU6IGFueSwgcm93SW5kZXg6IG51bWJlcil7CiAgICAgICAgcm93LnJvd0RhdGFTdGF0ZSA9IHJvdy5yb3dEYXRhU3RhdGUgPyByb3cucm93RGF0YVN0YXRlIDogInVwZGF0ZSIgOwogICAgICAgIHRoaXMudmFsaWRhdGUocHJvcGVydHkscm93LHJvd0luZGV4KTsKICAgIH0KCiAgICAvKioKICAgICAqIOihqOagvOe8lui+kemhueabtOaWsAogICAgICoKICAgICAqIEBwYXJhbSB7c3RyaW5nfSBtb2RlIOeVjOmdouihjOS4uuWQjeensAogICAgICogQHBhcmFtIHsqfSBbZGF0YT17fV0g6K+35rGC5pWw5o2uCiAgICAgKiBAcGFyYW0ge3N0cmluZ1tdfSB1cGRhdGVEZXRhaWxzIOabtOaWsOmhuQogICAgICogQHBhcmFtIHtib29sZWFufSBbc2hvd2xvYWRpbmddIOaYr+WQpuaYvuekuuWKoOi9veeKtuaAgQogICAgICogQHJldHVybnMge3ZvaWR9CiAgICAgKiBAbWVtYmVyb2YgTWFpbl8zQmFzZQogICAgICovCiAgICBwdWJsaWMgdXBkYXRlR3JpZEVkaXRJdGVtKG1vZGU6IHN0cmluZywgZGF0YTogYW55ID0ge30sIHVwZGF0ZURldGFpbHM6IHN0cmluZ1tdLCBzaG93bG9hZGluZz86IGJvb2xlYW4pOiB2b2lkIHsKICAgICAgICBpZiAoIW1vZGUgfHwgKG1vZGUgJiYgT2JqZWN0LmlzKG1vZGUsICcnKSkpIHsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KICAgICAgICBjb25zdCBhcmc6IGFueSA9IEpTT04ucGFyc2UoSlNPTi5zdHJpbmdpZnkoZGF0YSkpOwogICAgICAgIE9iamVjdC5hc3NpZ24oYXJnLHt2aWV3cGFyYW1zOnRoaXMudmlld3BhcmFtc30pOwogICAgICAgIGNvbnN0IHBvc3Q6IFByb21pc2U8YW55PiA9IHRoaXMuc2VydmljZS5mcm9udExvZ2ljKG1vZGUsSlNPTi5wYXJzZShKU09OLnN0cmluZ2lmeSh0aGlzLmNvbnRleHQpKSxhcmcsIHNob3dsb2FkaW5nKTsKICAgICAgICBwb3N0LnRoZW4oKHJlc3BvbnNlOiBhbnkpID0+IHsKICAgICAgICAgICAgaWYgKCFyZXNwb25zZSB8fCByZXNwb25zZS5zdGF0dXMgIT09IDIwMCkgewogICAgICAgICAgICAgICAgdGhpcy4kTm90aWNlLmVycm9yKHsgdGl0bGU6ICfplJnor68nLCBkZXNjOiAn6KGo5Y2V6aG55pu05paw5aSx6LSlJyB9KTsKICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgfQogICAgICAgICAgICBjb25zdCBfZGF0YTogYW55ID0gcmVzcG9uc2UuZGF0YTsKICAgICAgICAgICAgaWYoIV9kYXRhKXsKICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgfQogICAgICAgICAgICB1cGRhdGVEZXRhaWxzLmZvckVhY2goKG5hbWU6IHN0cmluZykgPT4gewogICAgICAgICAgICAgICAgaWYgKCFfZGF0YS5oYXNPd25Qcm9wZXJ0eShuYW1lKSkgewogICAgICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGRhdGFbbmFtZV0gPSBfZGF0YVtuYW1lXTsKICAgICAgICAgICAgfSk7CiAgICAgICAgfSkuY2F0Y2goKHJlc3BvbnNlOiBhbnkpID0+IHsKICAgICAgICAgICAgaWYgKHJlc3BvbnNlICYmIHJlc3BvbnNlLnN0YXR1cyA9PT0gNDAxKSB7CiAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKCFyZXNwb25zZSB8fCAhcmVzcG9uc2Uuc3RhdHVzIHx8ICFyZXNwb25zZS5kYXRhKSB7CiAgICAgICAgICAgICAgICB0aGlzLiROb3RpY2UuZXJyb3IoeyB0aXRsZTogJ+mUmeivrycsIGRlc2M6ICfns7vnu5/lvILluLgnIH0pOwogICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICB9CiAgICAgICAgfSk7CiAgICB9CgogICAgLyoqCiAgICAgKiDojrflj5blr7nlupTooYxjbGFzcwogICAgICoKICAgICAqIEBwYXJhbSB7Kn0gJGFyZ3Mgcm93IOihjOaVsOaNru+8jHJvd0luZGV4IOihjOe0ouW8lQogICAgICogQHJldHVybnMge3ZvaWR9CiAgICAgKiBAbWVtYmVyb2YgTWFpbl8zQmFzZQogICAgICovCiAgICBwdWJsaWMgZ2V0Um93Q2xhc3NOYW1lKGFyZ3M6e3JvdzogYW55LHJvd0luZGV4OiBudW1iZXJ9KXsKICAgICAgICBsZXQgaXNTZWxlY3RlZCA9IHRoaXMuc2VsZWN0aW9ucy5zb21lKChpdGVtOmFueSk9PnsKICAgICAgICAgICAgcmV0dXJuIE9iamVjdC5pcyhpdGVtLnBpbWNvbnRyYWN0LGFyZ3Mucm93LnBpbWNvbnRyYWN0KTsKICAgICAgICB9KTsKICAgICAgICByZXR1cm4gaXNTZWxlY3RlZCA/ICJncmlkLXNlbGVjdGVkLXJvdyIgOiAiIjsKICAgIH0KCiAgICAvKioKICAgICAqIOiOt+WPluWvueW6lOWIl2NsYXNzCiAgICAgKgogICAgICogQHBhcmFtIHsqfSAkYXJncyByb3cg6KGM5pWw5o2u77yMY29sdW1uIOWIl+aVsOaNru+8jHJvd0luZGV4IOihjOe0ouW8le+8jOWIl+e0ouW8lQogICAgICogQHJldHVybnMge3ZvaWR9CiAgICAgKiBAbWVtYmVyb2YgTWFpbl8zQmFzZQogICAgICovCiAgICBwdWJsaWMgZ2V0Q2VsbENsYXNzTmFtZShhcmdzOntyb3c6IGFueSwgY29sdW1uOiBhbnksIHJvd0luZGV4OiBudW1iZXIsIGNvbHVtbkluZGV4Om51bWJlcn0pewogICAgICAgIGxldCBoYXNSb3dFZGl0OmFueSA9IHsKICAgICAgICAgICdodGJoJzpmYWxzZSwKICAgICAgICAgICdodGx4JzpmYWxzZSwKICAgICAgICAgICdjb250cmFjdHR5cGUnOmZhbHNlLAogICAgICAgICAgJ3FzcnEnOmZhbHNlLAogICAgICAgICAgJ2pzcnEnOmZhbHNlLAogICAgICAgICAgJ2h0enQnOmZhbHNlLAogICAgICAgICAgJ3N5ZHFzaic6ZmFsc2UsCiAgICAgICAgfQogICAgICAgIHJldHVybiAoIGhhc1Jvd0VkaXRbYXJncy5jb2x1bW4ucHJvcGVydHldICYmIHRoaXMuYWN0dWFsSXNPcGVuRWRpdCApID8gImVkaXQtY2VsbCIgOiAiaW5mby1jZWxsIjsKICAgIH0KCiAgICAvKioKICAgICAqIOaWsOW7uum7mOiupOWAvAogICAgICogQHBhcmFtIHsqfSAgcm93IOihjOaVsOaNrgogICAgICogQG1lbWJlcm9mIE1haW5fM0Jhc2UKICAgICAqLwogICAgcHVibGljIGNyZWF0ZURlZmF1bHQocm93OiBhbnkpeyAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgaWYgKHJvdy5oYXNPd25Qcm9wZXJ0eSgncGltcGVyc29uaWQnKSkgewogICAgICAgICAgICByb3dbJ3BpbXBlcnNvbmlkJ10gPSB0aGlzLnZpZXdwYXJhbXNbJ3NyZnBhcmVudGtleSddOwogICAgICAgIH0KICAgIH0KfQo="},null]}
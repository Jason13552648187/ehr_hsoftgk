{"remainingRequest":"F:\\crod项目\\人事管理系统2\\iBizEHR\\app_EHRPim\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!F:\\crod项目\\人事管理系统2\\iBizEHR\\app_EHRPim\\src\\widgets\\pim-language-ability\\main-grid\\main-grid-base.vue?vue&type=script&lang=tsx&","dependencies":[{"path":"F:\\crod项目\\人事管理系统2\\iBizEHR\\app_EHRPim\\src\\widgets\\pim-language-ability\\main-grid\\main-grid-base.vue","mtime":1630509411755},{"path":"F:\\crod项目\\人事管理系统2\\iBizEHR\\app_EHRPim\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1630511852775},{"path":"F:\\crod项目\\人事管理系统2\\iBizEHR\\app_EHRPim\\node_modules\\thread-loader\\dist\\cjs.js","mtime":1630511853252},{"path":"F:\\crod项目\\人事管理系统2\\iBizEHR\\app_EHRPim\\node_modules\\babel-loader\\lib\\index.js","mtime":1630511852747},{"path":"F:\\crod项目\\人事管理系统2\\iBizEHR\\app_EHRPim\\node_modules\\ts-loader\\index.js","mtime":1630511985412},{"path":"F:\\crod项目\\人事管理系统2\\iBizEHR\\app_EHRPim\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1630511852775},{"path":"F:\\crod项目\\人事管理系统2\\iBizEHR\\app_EHRPim\\node_modules\\vue-loader\\lib\\index.js","mtime":1630512070338}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:CgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKaW1wb3J0IHsgVnVlLCBDb21wb25lbnQsIFByb3AsIFByb3ZpZGUsIEVtaXQsIFdhdGNoLCBNb2RlbCxJbmplY3QgfSBmcm9tICd2dWUtcHJvcGVydHktZGVjb3JhdG9yJzsKaW1wb3J0IHsgQ3JlYXRlRWxlbWVudCB9IGZyb20gJ3Z1ZSc7CmltcG9ydCB7IFN1YmplY3QsIFN1YnNjcmlwdGlvbiB9IGZyb20gJ3J4anMnOwppbXBvcnQgeyBDb250cm9sSW50ZXJmYWNlIH0gZnJvbSAnQC9pbnRlcmZhY2UvY29udHJvbCc7CmltcG9ydCB7IFVJQWN0aW9uVG9vbCxVdGlsIH0gZnJvbSAnQC91dGlscyc7CmltcG9ydCBOYXZEYXRhU2VydmljZSBmcm9tICdAL3NlcnZpY2UvYXBwL25hdmRhdGEtc2VydmljZSc7CmltcG9ydCBQaW1MYW5ndWFnZUFiaWxpdHlTZXJ2aWNlIGZyb20gJ0Avc2VydmljZS9waW0tbGFuZ3VhZ2UtYWJpbGl0eS9waW0tbGFuZ3VhZ2UtYWJpbGl0eS1zZXJ2aWNlJzsKaW1wb3J0IE1haW5TZXJ2aWNlIGZyb20gJy4vbWFpbi1ncmlkLXNlcnZpY2UnOwoKaW1wb3J0IENvZGVMaXN0U2VydmljZSBmcm9tICJAc2VydmljZS9hcHAvY29kZWxpc3Qtc2VydmljZSI7CmltcG9ydCB7IEZvcm1JdGVtTW9kZWwgfSBmcm9tICdAL21vZGVsL2Zvcm0tZGV0YWlsJzsKCgpAQ29tcG9uZW50KHsKICAgIGNvbXBvbmVudHM6IHsKICAgICAgCiAgICB9Cn0pCmV4cG9ydCBkZWZhdWx0IGNsYXNzIE1haW5CYXNlIGV4dGVuZHMgVnVlIGltcGxlbWVudHMgQ29udHJvbEludGVyZmFjZSB7CgogICAgLyoqCiAgICAgKiDlkI3np7AKICAgICAqCiAgICAgKiBAdHlwZSB7c3RyaW5nfQogICAgICogQG1lbWJlcm9mIE1haW5CYXNlCiAgICAgKi8KICAgIEBQcm9wKCkgcHVibGljIG5hbWU/OiBzdHJpbmc7CgogICAgLyoqCiAgICAgKiDop4blm77pgJrorq/lr7nosaEKICAgICAqCiAgICAgKiBAdHlwZSB7U3ViamVjdDxWaWV3U3RhdGU+fQogICAgICogQG1lbWJlcm9mIE1haW5CYXNlCiAgICAgKi8KICAgIEBQcm9wKCkgcHVibGljIHZpZXdTdGF0ZSE6IFN1YmplY3Q8Vmlld1N0YXRlPjsKCiAgICAvKioKICAgICAqIOW6lOeUqOS4iuS4i+aWhwogICAgICoKICAgICAqIEB0eXBlIHsqfQogICAgICogQG1lbWJlcm9mIE1haW5CYXNlCiAgICAgKi8KICAgIEBQcm9wKCkgcHVibGljIGNvbnRleHQ6IGFueTsKCiAgICAvKioKICAgICAqIOinhuWbvuWPguaVsAogICAgICoKICAgICAqIEB0eXBlIHsqfQogICAgICogQG1lbWJlcm9mIE1haW5CYXNlCiAgICAgKi8KICAgIEBQcm9wKCkgcHVibGljIHZpZXdwYXJhbXM6IGFueTsKCiAgICAvKioKICAgICAqIOinhuWbvueKtuaAgeS6i+S7tgogICAgICoKICAgICAqIEBwdWJsaWMKICAgICAqIEB0eXBlIHsoU3Vic2NyaXB0aW9uIHwgdW5kZWZpbmVkKX0KICAgICAqIEBtZW1iZXJvZiBNYWluQmFzZQogICAgICovCiAgICBwdWJsaWMgdmlld1N0YXRlRXZlbnQ6IFN1YnNjcmlwdGlvbiB8IHVuZGVmaW5lZDsKCiAgICAvKioKICAgICAqIOiOt+WPlumDqOS7tuexu+WeiwogICAgICoKICAgICAqIEByZXR1cm5zIHtzdHJpbmd9CiAgICAgKiBAbWVtYmVyb2YgTWFpbkJhc2UKICAgICAqLwogICAgcHVibGljIGdldENvbnRyb2xUeXBlKCk6IHN0cmluZyB7CiAgICAgICAgcmV0dXJuICdHUklEJwogICAgfQoKCgogICAgLyoqCiAgICAgKiDorqHmlbDlmajmnI3liqHlr7nosaHpm4blkIgKICAgICAqCiAgICAgKiBAdHlwZSB7QXJyYXk8Kj59CiAgICAgKiBAbWVtYmVyb2YgTWFpbkJhc2UKICAgICAqLyAgICAKICAgIHB1YmxpYyBjb3VudGVyU2VydmljZUFycmF5OkFycmF5PGFueT4gPSBbXTsKCiAgICAvKioKICAgICAqIOW7uuaehOmDqOS7tuacjeWKoeWvueixoQogICAgICoKICAgICAqIEB0eXBlIHtNYWluU2VydmljZX0KICAgICAqIEBtZW1iZXJvZiBNYWluQmFzZQogICAgICovCiAgICBwdWJsaWMgc2VydmljZTogTWFpblNlcnZpY2UgPSBuZXcgTWFpblNlcnZpY2UoeyAkc3RvcmU6IHRoaXMuJHN0b3JlIH0pOwoKICAgIC8qKgogICAgICog5a6e5L2T5pyN5Yqh5a+56LGhCiAgICAgKgogICAgICogQHR5cGUge1BpbUxhbmd1YWdlQWJpbGl0eVNlcnZpY2V9CiAgICAgKiBAbWVtYmVyb2YgTWFpbkJhc2UKICAgICAqLwogICAgcHVibGljIGFwcEVudGl0eVNlcnZpY2U6IFBpbUxhbmd1YWdlQWJpbGl0eVNlcnZpY2UgPSBuZXcgUGltTGFuZ3VhZ2VBYmlsaXR5U2VydmljZSh7ICRzdG9yZTogdGhpcy4kc3RvcmUgfSk7CiAgICAKCgogICAgLyoqCiAgICAgKiDlhbPpl63op4blm74KICAgICAqCiAgICAgKiBAcGFyYW0ge2FueX0gYXJncwogICAgICogQG1lbWJlcm9mIE1haW5CYXNlCiAgICAgKi8KICAgIHB1YmxpYyBjbG9zZVZpZXcoYXJnczogYW55KTogdm9pZCB7CiAgICAgICAgbGV0IF90aGlzOiBhbnkgPSB0aGlzOwogICAgICAgIF90aGlzLiRlbWl0KCdjbG9zZXZpZXcnLCBbYXJnc10pOwogICAgfQoKICAgIC8qKgogICAgICogIOiuoeaVsOWZqOWIt+aWsAogICAgICoKICAgICAqIEBtZW1iZXJvZiBNYWluQmFzZQogICAgICovCiAgICBwdWJsaWMgY291bnRlclJlZnJlc2goKXsKICAgICAgICBjb25zdCBfdGhpczphbnkgPXRoaXM7CiAgICAgICAgaWYoX3RoaXMuY291bnRlclNlcnZpY2VBcnJheSAmJiBfdGhpcy5jb3VudGVyU2VydmljZUFycmF5Lmxlbmd0aCA+MCl7CiAgICAgICAgICAgIF90aGlzLmNvdW50ZXJTZXJ2aWNlQXJyYXkuZm9yRWFjaCgoaXRlbTphbnkpID0+ewogICAgICAgICAgICAgICAgaWYoaXRlbS5yZWZyZXNoRGF0YSAmJiBpdGVtLnJlZnJlc2hEYXRhIGluc3RhbmNlb2YgRnVuY3Rpb24pewogICAgICAgICAgICAgICAgICAgIGl0ZW0ucmVmcmVzaERhdGEoKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSkKICAgICAgICB9CiAgICB9CgoKICAgIC8qKgogICAgICog5Luj56CB6KGo5pyN5Yqh5a+56LGhCiAgICAgKgogICAgICogQHR5cGUge0NvZGVMaXN0U2VydmljZX0KICAgICAqIEBtZW1iZXJvZiBNYWluQmFzZQogICAgICovICAKICAgIHB1YmxpYyBjb2RlTGlzdFNlcnZpY2U6Q29kZUxpc3RTZXJ2aWNlID0gbmV3IENvZGVMaXN0U2VydmljZSh7ICRzdG9yZTogdGhpcy4kc3RvcmUgfSk7CgogICAgLyoqCiAgICAgKiDojrflj5blpJrpobnmlbDmja4KICAgICAqCiAgICAgKiBAcmV0dXJucyB7YW55W119CiAgICAgKiBAbWVtYmVyb2YgTWFpbkJhc2UKICAgICAqLwogICAgcHVibGljIGdldERhdGFzKCk6IGFueVtdIHsKICAgICAgICByZXR1cm4gdGhpcy5zZWxlY3Rpb25zOwogICAgfQoKICAgIC8qKgogICAgICog6I635Y+W5Y2V6aG55qCRCiAgICAgKgogICAgICogQHJldHVybnMgeyp9CiAgICAgKiBAbWVtYmVyb2YgTWFpbkJhc2UKICAgICAqLwogICAgcHVibGljIGdldERhdGEoKTogYW55IHsKICAgICAgICByZXR1cm4gdGhpcy5zZWxlY3Rpb25zWzBdOwogICAgfQoKICAgIC8qKgogICAgICog5omT5byA5paw5bu65pWw5o2u6KeG5Zu+CiAgICAgKgogICAgICogQHR5cGUge2FueX0KICAgICAqIEBtZW1iZXJvZiBNYWluQmFzZQogICAgICovCiAgICBAUHJvcCgpIHB1YmxpYyBuZXdkYXRhOiBhbnk7CiAgICAvKioKICAgICAqIOaJk+W8gOe8lui+keaVsOaNruinhuWbvgogICAgICoKICAgICAqIEB0eXBlIHthbnl9CiAgICAgKiBAbWVtYmVyb2YgTWFpbkJhc2UKICAgICAqLwogICAgQFByb3AoKSBwdWJsaWMgb3BlbmRhdGE6IGFueTsKCiAgICAvKioKICAgICAqIOaYvuekuuWkhOeQhuaPkOekugogICAgICoKICAgICAqIEB0eXBlIHtib29sZWFufQogICAgICogQG1lbWJlcm9mIE1haW5CYXNlCiAgICAgKi8KICAgIEBQcm9wKHsgZGVmYXVsdDogdHJ1ZSB9KSBwdWJsaWMgc2hvd0J1c3lJbmRpY2F0b3I/OiBib29sZWFuOwoKICAgIC8qKgogICAgICog6YOo5Lu26KGM5Li6LS11cGRhdGUKICAgICAqCiAgICAgKiBAdHlwZSB7c3RyaW5nfQogICAgICogQG1lbWJlcm9mIE1haW5CYXNlCiAgICAgKi8KICAgIEBQcm9wKCkgcHVibGljIHVwZGF0ZUFjdGlvbiE6IHN0cmluZzsKICAgIAogICAgLyoqCiAgICAgKiDpg6jku7booYzkuLotLWZldGNoCiAgICAgKgogICAgICogQHR5cGUge3N0cmluZ30KICAgICAqIEBtZW1iZXJvZiBNYWluQmFzZQogICAgICovCiAgICBAUHJvcCgpIHB1YmxpYyBmZXRjaEFjdGlvbiE6IHN0cmluZzsKICAgIAogICAgLyoqCiAgICAgKiDpg6jku7booYzkuLotLXJlbW92ZQogICAgICoKICAgICAqIEB0eXBlIHtzdHJpbmd9CiAgICAgKiBAbWVtYmVyb2YgTWFpbkJhc2UKICAgICAqLwogICAgQFByb3AoKSBwdWJsaWMgcmVtb3ZlQWN0aW9uITogc3RyaW5nOwogICAgCiAgICAvKioKICAgICAqIOmDqOS7tuihjOS4ui0tbG9hZAogICAgICoKICAgICAqIEB0eXBlIHtzdHJpbmd9CiAgICAgKiBAbWVtYmVyb2YgTWFpbkJhc2UKICAgICAqLwogICAgQFByb3AoKSBwdWJsaWMgbG9hZEFjdGlvbiE6IHN0cmluZzsKICAgIAogICAgLyoqCiAgICAgKiDpg6jku7booYzkuLotLWxvYWRkcmFmdAogICAgICoKICAgICAqIEB0eXBlIHtzdHJpbmd9CiAgICAgKiBAbWVtYmVyb2YgTWFpbkJhc2UKICAgICAqLwogICAgQFByb3AoKSBwdWJsaWMgbG9hZGRyYWZ0QWN0aW9uITogc3RyaW5nOwogICAgCiAgICAvKioKICAgICAqIOmDqOS7tuihjOS4ui0tY3JlYXRlCiAgICAgKgogICAgICogQHR5cGUge3N0cmluZ30KICAgICAqIEBtZW1iZXJvZiBNYWluQmFzZQogICAgICovCiAgICBAUHJvcCgpIHB1YmxpYyBjcmVhdGVBY3Rpb24hOiBzdHJpbmc7CgogICAgLyoqCiAgICAgKiDlvZPliY3pobUKICAgICAqCiAgICAgKiBAdHlwZSB7bnVtYmVyfQogICAgICogQG1lbWJlcm9mIE1haW5CYXNlCiAgICAgKi8KICAgIHB1YmxpYyBjdXJQYWdlOiBudW1iZXIgPSAxOwoKICAgIC8qKgogICAgICog5pWw5o2uCiAgICAgKgogICAgICogQHR5cGUge2FueVtdfQogICAgICogQG1lbWJlcm9mIE1haW5CYXNlCiAgICAgKi8KICAgIHB1YmxpYyBpdGVtczogYW55W10gPSBbXTsKCiAgICAvKioKICAgICAqIOaYr+WQpuaUr+aMgeWIhumhtQogICAgICoKICAgICAqIEB0eXBlIHtib29sZWFufQogICAgICogQG1lbWJlcm9mIE1haW5CYXNlCiAgICAgKi8KICAgIHB1YmxpYyBpc0VuYWJsZVBhZ2luZ0JhcjogYm9vbGVhbiA9IHRydWU7CgogICAgLyoqCiAgICAgKiDmmK/lkKbnpoHnlKjmjpLluo8KICAgICAqCiAgICAgKiBAdHlwZSB7Ym9vbGVhbn0KICAgICAqIEBtZW1iZXJvZiBNYWluQmFzZQogICAgICovCiAgICBwdWJsaWMgaXNOb1NvcnQ6IGJvb2xlYW4gPSBmYWxzZTsKCiAgICAvKioKICAgICAqIOaOkuW6j+aWueWQkQogICAgICoKICAgICAqIEB0eXBlIHtzdHJpbmd9CiAgICAgKiBAbWVtYmVyb2YgTWFpbkJhc2UKICAgICAqLwogICAgcHVibGljIG1pbm9yU29ydERpcjogc3RyaW5nID0gJ0RFU0MnOwoKICAgIC8qKgogICAgICog5o6S5bqP5a2X5q61CiAgICAgKgogICAgICogQHR5cGUge3N0cmluZ30KICAgICAqIEBtZW1iZXJvZiBNYWluQmFzZQogICAgICovCiAgICBwdWJsaWMgbWlub3JTb3J0UFNERUY6IHN0cmluZyA9ICd3eWRqaHFzaic7CgogICAgLyoqCiAgICAgKiDliIbpobXmnaHmlbAKICAgICAqCiAgICAgKiBAdHlwZSB7bnVtYmVyfQogICAgICogQG1lbWJlcm9mIE1haW5CYXNlCiAgICAgKi8KICAgIHB1YmxpYyBsaW1pdDogbnVtYmVyID0gMjA7CgogICAgLyoqCiAgICAgKiDmmK/lkKbmmL7npLrmoIfpopgKICAgICAqCiAgICAgKiBAdHlwZSB7Ym9vbGVhbn0KICAgICAqIEBtZW1iZXJvZiBNYWluQmFzZQogICAgICovCiAgICBwdWJsaWMgaXNIaWRlSGVhZGVyOiBib29sZWFuID0gZmFsc2U7CgogICAgLyoqCiAgICAgKiDmmK/lkKbpu5jorqTpgInkuK3nrKzkuIDmnaHmlbDmja4KICAgICAqCiAgICAgKiBAdHlwZSB7Ym9vbGVhbn0KICAgICAqIEBtZW1iZXJvZiBNYWluQmFzZQogICAgICovCiAgICBAUHJvcCh7IGRlZmF1bHQ6IGZhbHNlIH0pIHB1YmxpYyBpc1NlbGVjdEZpcnN0RGVmYXVsdCE6IGJvb2xlYW47CgogICAgLyoqCiAgICAgKiDmmK/lkKbljZXpgIkKICAgICAqCiAgICAgKiBAdHlwZSB7Ym9vbGVhbn0KICAgICAqIEBtZW1iZXJvZiBNYWluQmFzZQogICAgICovCiAgICBAUHJvcCgpIHB1YmxpYyBpc1NpbmdsZVNlbGVjdD86IGJvb2xlYW47CgogICAgLyoqCiAgICAgKiDpgInkuK3mlbDmja7lrZfnrKbkuLIKICAgICAqCiAgICAgKiBAdHlwZSB7c3RyaW5nfQogICAgICogQG1lbWJlcm9mIE1haW5CYXNlCiAgICAgKi8KICAgIEBQcm9wKCkgcHVibGljIHNlbGVjdGVkRGF0YT86IHN0cmluZzsKCiAgICAvKioKICAgICAqIOmAieS4reWAvOWPmOWMlgogICAgICoKICAgICAqIEBwYXJhbSB7Kn0gbmV3VmFsCiAgICAgKiBAcGFyYW0geyp9IG9sZFZhbAogICAgICogQG1lbWJlcm9mIE1haW5CYXNlCiAgICAgKi8KICAgIEBXYXRjaCgnc2VsZWN0ZWREYXRhJykKICAgIHB1YmxpYyBvblZhbHVlQ2hhbmdlKG5ld1ZhbDogYW55LCBvbGRWYWw6IGFueSkgewogICAgICAgIHRoaXMuc2VsZWN0aW9ucyA9IFtdOwogICAgICAgIGlmKHRoaXMuc2VsZWN0ZWREYXRhKXsKICAgICAgICAgICAgY29uc3QgcmVmczogYW55ID0gdGhpcy4kcmVmczsKICAgICAgICAgICAgaWYgKHJlZnMubXVsdGlwbGVUYWJsZSkgewogICAgICAgICAgICAgICAgcmVmcy5tdWx0aXBsZVRhYmxlLmNsZWFyU2VsZWN0aW9uKCk7CiAgICAgICAgICAgICAgICBKU09OLnBhcnNlKHRoaXMuc2VsZWN0ZWREYXRhKS5mb3JFYWNoKChzZWxlY3Rpb246YW55KT0+ewogICAgICAgICAgICAgICAgICAgIGxldCBzZWxlY3RlZEl0ZW0gPSB0aGlzLml0ZW1zLmZpbmQoKGl0ZW06YW55KT0+ewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gT2JqZWN0LmlzKGl0ZW0uc3Jma2V5LCBzZWxlY3Rpb24uc3Jma2V5KTsKICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICBpZihzZWxlY3RlZEl0ZW0pewogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnJvd0NsaWNrKHNlbGVjdGVkSXRlbSk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiDooajmoLzooYzmlbDmja7pu5jorqTmv4DmtLvmqKHlvI8KICAgICAqIDAg5LiN5r+A5rS7CiAgICAgKiAxIOWNleWHu+a/gOa0uwogICAgICogMiDlj4zlh7vmv4DmtLsKICAgICAqCiAgICAgKiBAdHlwZSB7KG51bWJlciB8IDAgfCAxIHwgMil9CiAgICAgKiBAbWVtYmVyb2YgTWFpbkJhc2UKICAgICAqLwogICAgQFByb3Aoe2RlZmF1bHQ6IDJ9KSBwdWJsaWMgZ3JpZFJvd0FjdGl2ZU1vZGUhOiBudW1iZXI7CgogICAgLyoqCiAgICAgKiDmmK/lkKblvIDlkK/ooYznvJbovpEKICAgICAqCiAgICAgKiBAdHlwZSB7Ym9vbGVhbn0KICAgICAqIEBtZW1iZXJvZiBNYWluQmFzZQogICAgICovCiAgICBAUHJvcCh7ZGVmYXVsdDogZmFsc2V9KSBwdWJsaWMgaXNPcGVuRWRpdCE6IGJvb2xlYW47CgogICAgLyoqCiAgICAgKiDlrp7pmYXmmK/lkKblvIDlkK/ooYznvJbovpEKICAgICAqCiAgICAgKiBAdHlwZSB7Ym9vbGVhbn0KICAgICAqIEBtZW1iZXJvZiBNYWluQmFzZQogICAgICovCiAgICBwdWJsaWMgYWN0dWFsSXNPcGVuRWRpdDogYm9vbGVhbiA9IHRoaXMuaXNPcGVuRWRpdDsKCiAgICAvKioKICAgICAqIOaAu+adoeaVsAogICAgICoKICAgICAqIEB0eXBlIHtudW1iZXJ9CiAgICAgKiBAbWVtYmVyb2YgTWFpbkJhc2UKICAgICAqLwogICAgcHVibGljIHRvdGFscm93OiBudW1iZXIgPSAwOwoKICAgIC8qKgogICAgICog6YCJ5Lit6KGM5pWw5o2uCiAgICAgKgogICAgICogQHR5cGUge2FueVtdfQogICAgICogQG1lbWJlcm9mIE1haW4KICAgICAqLwogICAgcHVibGljIHNlbGVjdGlvbnM6IGFueVtdID0gW107CgogICAgLyoqCiAgICAgKiDmi6bmiKrooYzpgInkuK0KICAgICAqCiAgICAgKiBAdHlwZSB7Ym9vbGVhbn0KICAgICAqIEBtZW1iZXJvZiBNYWluCiAgICAgKi8KICAgIHB1YmxpYyBzdG9wUm93Q2xpY2s6IGJvb2xlYW4gPSBmYWxzZTsKCgoKCiAgICAvKioKICAgICAqIOihqOagvOaYr+WQpuaYvuekugogICAgICoKICAgICAqIEB0eXBlIHtib29sZWFufQogICAgICogQG1lbWJlcm9mIE1haW5CYXNlCiAgICAgKi8KICAgIHB1YmxpYyBpc0Rpc3BsYXk6Ym9vbGVhbiA9IHRydWU7CgogICAgLyoqCiAgICAgKiDpg6jku7bliLfmlrAKICAgICAqCiAgICAgKiBAcGFyYW0ge2FueVtdfSBhcmdzCiAgICAgKiBAbWVtYmVyb2YgTWFpbkJhc2UKICAgICAqLwogICAgcHVibGljIHJlZnJlc2goYXJnczogYW55W10pOiB2b2lkIHsKICAgICAgICB0aGlzLmxvYWQoKTsKICAgIH0KCiAgICAvKioKICAgICog6YCJ6aG55qGG5YiX5a69CiAgICAqCiAgICAqIEB0eXBlIHtudW1iZXJ9CiAgICAqIEBtZW1iZXJvZiBBcHBJbmRleAogICAgKi8KICAgIHB1YmxpYyBjaGVja2JveENvbFdpZHRoOiBudW1iZXIgPSAzNDsKCiAgICAvKioKICAgICAqIOaYr+WQpuWFgeiuuOaLluWKqOWIl+WuvQogICAgICoKICAgICAqIEB0eXBlIHtib29sZWFufQogICAgICogQG1lbWJlcm9mIEFwcEVtYmVkUGlja2VyCiAgICAgKi8KICAgIHB1YmxpYyBpc0RyYWdlbmRDb2w6IGJvb2xlYW4gPSBmYWxzZTsKCiAgICAvKioKICAgICAqIOaJgOacieWIl+aIkOWRmAogICAgICoKICAgICAqIEB0eXBlIHthbnlbXX0KICAgICAqIEBtZW1iZXJvZiBNYWluQmFzZQogICAgICovCiAgICBwdWJsaWMgYWxsQ29sdW1uczogYW55W10gPSBbCiAgICAgICAgewogICAgICAgICAgICBuYW1lOiAnd3l5eicsCiAgICAgICAgICAgIGxhYmVsOiAn6K+t56eNJywKICAgICAgICAgICAgbGFuZ3RhZzogJ2VudGl0aWVzLnBpbWxhbmd1YWdlYWJpbGl0eS5tYWluX2dyaWQuY29sdW1ucy53eXl6JywKICAgICAgICAgICAgc2hvdzogdHJ1ZSwKICAgICAgICAgICAgdXRpbDogJ1BYJwogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICBuYW1lOiAnd3lkaicsCiAgICAgICAgICAgIGxhYmVsOiAn5aSW6K+t562J57qnJywKICAgICAgICAgICAgbGFuZ3RhZzogJ2VudGl0aWVzLnBpbWxhbmd1YWdlYWJpbGl0eS5tYWluX2dyaWQuY29sdW1ucy53eWRqJywKICAgICAgICAgICAgc2hvdzogdHJ1ZSwKICAgICAgICAgICAgdXRpbDogJ1BYJwogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICBuYW1lOiAnd3lkamhxc2onLAogICAgICAgICAgICBsYWJlbDogJ+Wkluivreetiee6p+iOt+WPluaXtumXtCcsCiAgICAgICAgICAgIGxhbmd0YWc6ICdlbnRpdGllcy5waW1sYW5ndWFnZWFiaWxpdHkubWFpbl9ncmlkLmNvbHVtbnMud3lkamhxc2onLAogICAgICAgICAgICBzaG93OiB0cnVlLAogICAgICAgICAgICB1dGlsOiAnUFgnCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgIG5hbWU6ICdmaicsCiAgICAgICAgICAgIGxhYmVsOiAn6ZmE5Lu2JywKICAgICAgICAgICAgbGFuZ3RhZzogJ2VudGl0aWVzLnBpbWxhbmd1YWdlYWJpbGl0eS5tYWluX2dyaWQuY29sdW1ucy5maicsCiAgICAgICAgICAgIHNob3c6IHRydWUsCiAgICAgICAgICAgIHV0aWw6ICdQWCcKICAgICAgICB9LAogICAgXQoKICAgIC8qKgogICAgICog6KGo5qC85qih5Z6L6ZuG5ZCICiAgICAgKgogICAgICogQHR5cGUgeyp9CiAgICAgKiBAbWVtYmVyb2YgTWFpbkJhc2UKICAgICAqLwogICAgcHVibGljIGdyaWRJdGVtc01vZGVsOiBhbnlbXSA9IFtdOwoKICAgIC8qKgogICAgICog6I635Y+W6KGo5qC86KGM5qih5Z6LCiAgICAgKgogICAgICogQHR5cGUgeyp9CiAgICAgKiBAbWVtYmVyb2YgTWFpbkJhc2UKICAgICAqLwogICAgcHVibGljIGdldEdyaWRSb3dNb2RlbCgpewogICAgICAgIHJldHVybiB7CiAgICAgICAgICBmajogbmV3IEZvcm1JdGVtTW9kZWwoKSwKICAgICAgICAgIHBpbXBlcnNvbmlkOiBuZXcgRm9ybUl0ZW1Nb2RlbCgpLAogICAgICAgICAgd3lkamhxc2o6IG5ldyBGb3JtSXRlbU1vZGVsKCksCiAgICAgICAgICB3eXl6OiBuZXcgRm9ybUl0ZW1Nb2RlbCgpLAogICAgICAgICAgc3Jma2V5OiBuZXcgRm9ybUl0ZW1Nb2RlbCgpLAogICAgICAgICAgd3lkajogbmV3IEZvcm1JdGVtTW9kZWwoKSwKICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiDlsZ7mgKflgLzop4TliJkKICAgICAqCiAgICAgKiBAdHlwZSB7Kn0KICAgICAqIEBtZW1iZXJvZiBNYWluQmFzZQogICAgICovCiAgICBwdWJsaWMgcnVsZXM6IGFueSA9IHsKICAgICAgICBmajogWwogICAgICAgICAgICAgeyByZXF1aXJlZDogdHJ1ZSwgdmFsaWRhdG9yOiAocnVsZTphbnksIHZhbHVlOmFueSwgY2FsbGJhY2s6YW55KSA9PiB7IHJldHVybiAocnVsZS5yZXF1aXJlZCAmJiAodmFsdWUgPT09IG51bGwgfHwgdmFsdWUgPT09IHVuZGVmaW5lZCB8fCB2YWx1ZSA9PT0gIiIpKSA/IGZhbHNlIDogdHJ1ZTt9LCBtZXNzYWdlOiAn6ZmE5Lu2IOWAvOS4jeiDveS4uuepuicsIHRyaWdnZXI6ICdjaGFuZ2UnIH0sCiAgICAgICAgICAgIHsgcmVxdWlyZWQ6IHRydWUsIHZhbGlkYXRvcjogKHJ1bGU6YW55LCB2YWx1ZTphbnksIGNhbGxiYWNrOmFueSkgPT4geyByZXR1cm4gKHJ1bGUucmVxdWlyZWQgJiYgKHZhbHVlID09PSBudWxsIHx8IHZhbHVlID09PSB1bmRlZmluZWQgfHwgdmFsdWUgPT09ICIiKSkgPyBmYWxzZSA6IHRydWU7fSwgbWVzc2FnZTogJ+mZhOS7tiDlgLzkuI3og73kuLrnqbonLCB0cmlnZ2VyOiAnYmx1cicgfSwKICAgICAgICBdLAogICAgICAgIHBpbXBlcnNvbmlkOiBbCiAgICAgICAgICAgICB7IHJlcXVpcmVkOiBmYWxzZSwgdmFsaWRhdG9yOiAocnVsZTphbnksIHZhbHVlOmFueSwgY2FsbGJhY2s6YW55KSA9PiB7IHJldHVybiAocnVsZS5yZXF1aXJlZCAmJiAodmFsdWUgPT09IG51bGwgfHwgdmFsdWUgPT09IHVuZGVmaW5lZCB8fCB2YWx1ZSA9PT0gIiIpKSA/IGZhbHNlIDogdHJ1ZTt9LCBtZXNzYWdlOiAn5Lq65ZGY5L+h5oGv5qCH6K+GIOWAvOS4jeiDveS4uuepuicsIHRyaWdnZXI6ICdjaGFuZ2UnIH0sCiAgICAgICAgICAgIHsgcmVxdWlyZWQ6IGZhbHNlLCB2YWxpZGF0b3I6IChydWxlOmFueSwgdmFsdWU6YW55LCBjYWxsYmFjazphbnkpID0+IHsgcmV0dXJuIChydWxlLnJlcXVpcmVkICYmICh2YWx1ZSA9PT0gbnVsbCB8fCB2YWx1ZSA9PT0gdW5kZWZpbmVkIHx8IHZhbHVlID09PSAiIikpID8gZmFsc2UgOiB0cnVlO30sIG1lc3NhZ2U6ICfkurrlkZjkv6Hmga/moIfor4Yg5YC85LiN6IO95Li656m6JywgdHJpZ2dlcjogJ2JsdXInIH0sCiAgICAgICAgXSwKICAgICAgICB3eWRqaHFzajogWwogICAgICAgICAgICAgeyByZXF1aXJlZDogZmFsc2UsIHZhbGlkYXRvcjogKHJ1bGU6YW55LCB2YWx1ZTphbnksIGNhbGxiYWNrOmFueSkgPT4geyByZXR1cm4gKHJ1bGUucmVxdWlyZWQgJiYgKHZhbHVlID09PSBudWxsIHx8IHZhbHVlID09PSB1bmRlZmluZWQgfHwgdmFsdWUgPT09ICIiKSkgPyBmYWxzZSA6IHRydWU7fSwgbWVzc2FnZTogJ+Wkluivreetiee6p+iOt+WPluaXtumXtCDlgLzkuI3og73kuLrnqbonLCB0cmlnZ2VyOiAnY2hhbmdlJyB9LAogICAgICAgICAgICB7IHJlcXVpcmVkOiBmYWxzZSwgdmFsaWRhdG9yOiAocnVsZTphbnksIHZhbHVlOmFueSwgY2FsbGJhY2s6YW55KSA9PiB7IHJldHVybiAocnVsZS5yZXF1aXJlZCAmJiAodmFsdWUgPT09IG51bGwgfHwgdmFsdWUgPT09IHVuZGVmaW5lZCB8fCB2YWx1ZSA9PT0gIiIpKSA/IGZhbHNlIDogdHJ1ZTt9LCBtZXNzYWdlOiAn5aSW6K+t562J57qn6I635Y+W5pe26Ze0IOWAvOS4jeiDveS4uuepuicsIHRyaWdnZXI6ICdibHVyJyB9LAogICAgICAgIF0sCiAgICAgICAgd3l5ejogWwogICAgICAgICAgICAgeyByZXF1aXJlZDogZmFsc2UsIHZhbGlkYXRvcjogKHJ1bGU6YW55LCB2YWx1ZTphbnksIGNhbGxiYWNrOmFueSkgPT4geyByZXR1cm4gKHJ1bGUucmVxdWlyZWQgJiYgKHZhbHVlID09PSBudWxsIHx8IHZhbHVlID09PSB1bmRlZmluZWQgfHwgdmFsdWUgPT09ICIiKSkgPyBmYWxzZSA6IHRydWU7fSwgbWVzc2FnZTogJ+ivreenjSDlgLzkuI3og73kuLrnqbonLCB0cmlnZ2VyOiAnY2hhbmdlJyB9LAogICAgICAgICAgICB7IHJlcXVpcmVkOiBmYWxzZSwgdmFsaWRhdG9yOiAocnVsZTphbnksIHZhbHVlOmFueSwgY2FsbGJhY2s6YW55KSA9PiB7IHJldHVybiAocnVsZS5yZXF1aXJlZCAmJiAodmFsdWUgPT09IG51bGwgfHwgdmFsdWUgPT09IHVuZGVmaW5lZCB8fCB2YWx1ZSA9PT0gIiIpKSA/IGZhbHNlIDogdHJ1ZTt9LCBtZXNzYWdlOiAn6K+t56eNIOWAvOS4jeiDveS4uuepuicsIHRyaWdnZXI6ICdibHVyJyB9LAogICAgICAgIF0sCiAgICAgICAgc3Jma2V5OiBbCiAgICAgICAgICAgICB7IHJlcXVpcmVkOiBmYWxzZSwgdmFsaWRhdG9yOiAocnVsZTphbnksIHZhbHVlOmFueSwgY2FsbGJhY2s6YW55KSA9PiB7IHJldHVybiAocnVsZS5yZXF1aXJlZCAmJiAodmFsdWUgPT09IG51bGwgfHwgdmFsdWUgPT09IHVuZGVmaW5lZCB8fCB2YWx1ZSA9PT0gIiIpKSA/IGZhbHNlIDogdHJ1ZTt9LCBtZXNzYWdlOiAn6K+t6KiA6IO95Yqb5qCH6K+GIOWAvOS4jeiDveS4uuepuicsIHRyaWdnZXI6ICdjaGFuZ2UnIH0sCiAgICAgICAgICAgIHsgcmVxdWlyZWQ6IGZhbHNlLCB2YWxpZGF0b3I6IChydWxlOmFueSwgdmFsdWU6YW55LCBjYWxsYmFjazphbnkpID0+IHsgcmV0dXJuIChydWxlLnJlcXVpcmVkICYmICh2YWx1ZSA9PT0gbnVsbCB8fCB2YWx1ZSA9PT0gdW5kZWZpbmVkIHx8IHZhbHVlID09PSAiIikpID8gZmFsc2UgOiB0cnVlO30sIG1lc3NhZ2U6ICfor63oqIDog73lipvmoIfor4Yg5YC85LiN6IO95Li656m6JywgdHJpZ2dlcjogJ2JsdXInIH0sCiAgICAgICAgXSwKICAgICAgICB3eWRqOiBbCiAgICAgICAgICAgICB7IHJlcXVpcmVkOiBmYWxzZSwgdmFsaWRhdG9yOiAocnVsZTphbnksIHZhbHVlOmFueSwgY2FsbGJhY2s6YW55KSA9PiB7IHJldHVybiAocnVsZS5yZXF1aXJlZCAmJiAodmFsdWUgPT09IG51bGwgfHwgdmFsdWUgPT09IHVuZGVmaW5lZCB8fCB2YWx1ZSA9PT0gIiIpKSA/IGZhbHNlIDogdHJ1ZTt9LCBtZXNzYWdlOiAn5aSW6K+t562J57qnIOWAvOS4jeiDveS4uuepuicsIHRyaWdnZXI6ICdjaGFuZ2UnIH0sCiAgICAgICAgICAgIHsgcmVxdWlyZWQ6IGZhbHNlLCB2YWxpZGF0b3I6IChydWxlOmFueSwgdmFsdWU6YW55LCBjYWxsYmFjazphbnkpID0+IHsgcmV0dXJuIChydWxlLnJlcXVpcmVkICYmICh2YWx1ZSA9PT0gbnVsbCB8fCB2YWx1ZSA9PT0gdW5kZWZpbmVkIHx8IHZhbHVlID09PSAiIikpID8gZmFsc2UgOiB0cnVlO30sIG1lc3NhZ2U6ICflpJbor63nrYnnuqcg5YC85LiN6IO95Li656m6JywgdHJpZ2dlcjogJ2JsdXInIH0sCiAgICAgICAgXSwKICAgIH0KCiAgICAvKioKICAgICAqIOihqOagvOihjOe8lui+kemhueagoemqjAogICAgICoKICAgICAqIEBwYXJhbSB7c3RyaW5nfSBwcm9wZXJ0eSDlsZ7mgKflkI0KICAgICAqIEBwYXJhbSB7Kn0gZGF0YSDooYzmlbDmja4KICAgICAqIEBwYXJhbSB7bnVtYmVyfSByb3dJbmRleCDooYzntKLlvJUKICAgICAqIEByZXR1cm5zIFByb21pc2U8YW55PgogICAgICogCiAgICAgKiBAbWVtYmVyb2YgTWFpbkJhc2UKICAgICAqLwogICAgcHVibGljIHZhbGlkYXRlKHByb3BlcnR5OnN0cmluZywgZGF0YTphbnksIHJvd0luZGV4Om51bWJlcik6UHJvbWlzZTxhbnk+ewogICAgICAgIHJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZSwgcmVqZWN0KSA9PiB7CiAgICAgICAgICAgIHRoaXMuJHV0aWwudmFsaWRhdGVJdGVtKHByb3BlcnR5LGRhdGEsdGhpcy5ydWxlcykudGhlbigoKT0+ewogICAgICAgICAgICAgICAgdGhpcy5ncmlkSXRlbXNNb2RlbFtyb3dJbmRleF1bcHJvcGVydHldLnNldEVycm9yKG51bGwpOwogICAgICAgICAgICAgICAgcmVzb2x2ZSh0cnVlKTsKICAgICAgICAgICAgfSkuY2F0Y2goKHsgZXJyb3JzLCBmaWVsZHMgfSkgPT4gewogICAgICAgICAgICAgICAgdGhpcy5ncmlkSXRlbXNNb2RlbFtyb3dJbmRleF1bcHJvcGVydHldLnNldEVycm9yKGVycm9yc1swXS5tZXNzYWdlKTsKICAgICAgICAgICAgICAgIHJlc29sdmUoZmFsc2UpOwogICAgICAgICAgICB9KTsKICAgICAgICB9KTsKICAgIH0KCiAgICAvKioKICAgICAqIOagoemqjOaJgOacieS/ruaUuei/h+eahOe8lui+kemhuQogICAgICoKICAgICAqIEByZXR1cm5zIFByb21pc2U8YW55PgogICAgICogQG1lbWJlcm9mIE1haW5CYXNlCiAgICAgKi8KICAgIHB1YmxpYyBhc3luYyB2YWxpZGF0ZUFsbCgpewogICAgICAgIGxldCB2YWxpZGF0ZVN0YXRlID0gdHJ1ZTsKICAgICAgICBsZXQgaW5kZXggPSAtMTsKICAgICAgICBmb3IobGV0IGl0ZW0gb2YgdGhpcy5pdGVtcyl7CiAgICAgICAgICBpbmRleCsrOwogICAgICAgICAgaWYoaXRlbS5yb3dEYXRhU3RhdGUgPT09ICJjcmVhdGUiIHx8IGl0ZW0ucm93RGF0YVN0YXRlID09PSAidXBkYXRlIil7CiAgICAgICAgICAgIGZvcihsZXQgcHJvcGVydHkgb2YgT2JqZWN0LmtleXModGhpcy5ydWxlcykpewogICAgICAgICAgICAgIGlmKCFhd2FpdCB0aGlzLnZhbGlkYXRlKHByb3BlcnR5LGl0ZW0saW5kZXgpKXsKICAgICAgICAgICAgICAgIHZhbGlkYXRlU3RhdGUgPSBmYWxzZTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgcmV0dXJuIHZhbGlkYXRlU3RhdGU7CiAgICB9CgogICAgLyoqCiAgICAgKiDooajmoLzmlbDmja7liqDovb0KICAgICAqCiAgICAgKiBAcGFyYW0geyp9IFthcmc9e31dCiAgICAgKiBAbWVtYmVyb2YgTWFpbkJhc2UKICAgICAqLwogICAgcHVibGljIGxvYWQob3B0OiBhbnkgPSB7fSwgcGFnZVJlc2V0OiBib29sZWFuID0gZmFsc2UpOiB2b2lkIHsKICAgICAgICBpZighdGhpcy5mZXRjaEFjdGlvbil7CiAgICAgICAgICAgIHRoaXMuJE5vdGljZS5lcnJvcih7IHRpdGxlOiAn6ZSZ6K+vJywgZGVzYzogJ1BJTUxBTkdVQUdFQUJJTElUWVlZTkxHcmlkVmlld+inhuWbvuihqOagvGZldGNoQWN0aW9u5Y+C5pWw5pyq6YWN572uJyB9KTsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KICAgICAgICBpZihwYWdlUmVzZXQpewogICAgICAgICAgICB0aGlzLmN1clBhZ2UgPSAxOwogICAgICAgIH0KICAgICAgICBjb25zdCBhcmc6IGFueSA9IHsuLi5vcHR9OwogICAgICAgIGNvbnN0IHBhZ2U6IGFueSA9IHt9OwogICAgICAgIGlmICh0aGlzLmlzRW5hYmxlUGFnaW5nQmFyKSB7CiAgICAgICAgICAgIE9iamVjdC5hc3NpZ24ocGFnZSwgeyBwYWdlOiB0aGlzLmN1clBhZ2UtMSwgc2l6ZTogdGhpcy5saW1pdCB9KTsKICAgICAgICB9CiAgICAgICAgLy8g6K6+572u5o6S5bqPCiAgICAgICAgaWYgKCF0aGlzLmlzTm9Tb3J0ICYmICFPYmplY3QuaXModGhpcy5taW5vclNvcnREaXIsICcnKSAmJiAhT2JqZWN0LmlzKHRoaXMubWlub3JTb3J0UFNERUYsICcnKSkgewogICAgICAgICAgICBjb25zdCBzb3J0OiBzdHJpbmcgPSB0aGlzLm1pbm9yU29ydFBTREVGKyIsIit0aGlzLm1pbm9yU29ydERpcjsKICAgICAgICAgICAgT2JqZWN0LmFzc2lnbihwYWdlLCB7IHNvcnQ6IHNvcnQgfSk7CiAgICAgICAgfQogICAgICAgIE9iamVjdC5hc3NpZ24oYXJnLCBwYWdlKTsKICAgICAgICBjb25zdCBwYXJlbnRkYXRhOiBhbnkgPSB7fTsKICAgICAgICB0aGlzLiRlbWl0KCdiZWZvcmVsb2FkJywgcGFyZW50ZGF0YSk7CiAgICAgICAgT2JqZWN0LmFzc2lnbihhcmcsIHBhcmVudGRhdGEpOwogICAgICAgIGxldCB0ZW1wVmlld1BhcmFtczphbnkgPSBwYXJlbnRkYXRhLnZpZXdwYXJhbXM/cGFyZW50ZGF0YS52aWV3cGFyYW1zOnt9OwogICAgICAgIE9iamVjdC5hc3NpZ24odGVtcFZpZXdQYXJhbXMsSlNPTi5wYXJzZShKU09OLnN0cmluZ2lmeSh0aGlzLnZpZXdwYXJhbXMpKSk7CiAgICAgICAgT2JqZWN0LmFzc2lnbihhcmcse3ZpZXdwYXJhbXM6dGVtcFZpZXdQYXJhbXN9KTsKICAgICAgICBjb25zdCBwb3N0OiBQcm9taXNlPGFueT4gPSB0aGlzLnNlcnZpY2Uuc2VhcmNoKHRoaXMuZmV0Y2hBY3Rpb24sSlNPTi5wYXJzZShKU09OLnN0cmluZ2lmeSh0aGlzLmNvbnRleHQpKSwgYXJnLCB0aGlzLnNob3dCdXN5SW5kaWNhdG9yKTsKICAgICAgICBwb3N0LnRoZW4oKHJlc3BvbnNlOiBhbnkpID0+IHsKICAgICAgICAgICAgaWYgKCFyZXNwb25zZS5zdGF0dXMgfHwgcmVzcG9uc2Uuc3RhdHVzICE9PSAyMDApIHsKICAgICAgICAgICAgICAgIGlmIChyZXNwb25zZS5lcnJvck1lc3NhZ2UpIHsKICAgICAgICAgICAgICAgICAgICB0aGlzLiROb3RpY2UuZXJyb3IoeyB0aXRsZTogJ+mUmeivrycsIGRlc2M6IHJlc3BvbnNlLmVycm9yTWVzc2FnZSB9KTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgfQogICAgICAgICAgICBjb25zdCBkYXRhOiBhbnkgPSByZXNwb25zZS5kYXRhOwogICAgICAgICAgICB0aGlzLnRvdGFscm93ID0gcmVzcG9uc2UudG90YWw7CiAgICAgICAgICAgIHRoaXMuaXRlbXMgPSBKU09OLnBhcnNlKEpTT04uc3RyaW5naWZ5KGRhdGEpKTsKICAgICAgICAgICAgLy8g5riF56m6c2VsZWN0aW9ucyxncmlkSXRlbXNNb2RlbAogICAgICAgICAgICB0aGlzLnNlbGVjdGlvbnMgPSBbXTsKICAgICAgICAgICAgdGhpcy5ncmlkSXRlbXNNb2RlbCA9IFtdOwogICAgICAgICAgICB0aGlzLml0ZW1zLmZvckVhY2goKCk9Pnt0aGlzLmdyaWRJdGVtc01vZGVsLnB1c2godGhpcy5nZXRHcmlkUm93TW9kZWwoKSl9KTsKICAgICAgICAgICAgdGhpcy4kZW1pdCgnbG9hZCcsIHRoaXMuaXRlbXMpOwogICAgICAgICAgICAvLyDorr7nva7pu5jorqTpgInkuK0KICAgICAgICAgICAgbGV0IF90aGlzID0gdGhpczsKICAgICAgICAgICAgc2V0VGltZW91dCgoKSA9PiB7CiAgICAgICAgICAgICAgICBpZihfdGhpcy5pc1NlbGVjdEZpcnN0RGVmYXVsdCl7CiAgICAgICAgICAgICAgICAgIF90aGlzLnJvd0NsaWNrKF90aGlzLml0ZW1zWzBdKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGlmKF90aGlzLnNlbGVjdGVkRGF0YSl7CiAgICAgICAgICAgICAgICAgICAgY29uc3QgcmVmczogYW55ID0gX3RoaXMuJHJlZnM7CiAgICAgICAgICAgICAgICAgICAgaWYgKHJlZnMubXVsdGlwbGVUYWJsZSkgewogICAgICAgICAgICAgICAgICAgICAgICByZWZzLm11bHRpcGxlVGFibGUuY2xlYXJTZWxlY3Rpb24oKTsKICAgICAgICAgICAgICAgICAgICAgICAgSlNPTi5wYXJzZShfdGhpcy5zZWxlY3RlZERhdGEpLmZvckVhY2goKHNlbGVjdGlvbjphbnkpPT57CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsZXQgc2VsZWN0ZWRJdGVtID0gX3RoaXMuaXRlbXMuZmluZCgoaXRlbTphbnkpPT57CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIE9iamVjdC5pcyhpdGVtLnNyZmtleSwgc2VsZWN0aW9uLnNyZmtleSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmKHNlbGVjdGVkSXRlbSl7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgX3RoaXMucm93Q2xpY2soc2VsZWN0ZWRJdGVtKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9LCAzMDApOwogICAgICAgIH0pLmNhdGNoKChyZXNwb25zZTogYW55KSA9PiB7CiAgICAgICAgICAgIGlmIChyZXNwb25zZSAmJiByZXNwb25zZS5zdGF0dXMgPT09IDQwMSkgewogICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHRoaXMuJE5vdGljZS5lcnJvcih7IHRpdGxlOiAn6ZSZ6K+vJywgZGVzYzogcmVzcG9uc2UuZXJyb3JNZXNzYWdlIH0pOwogICAgICAgIH0pOwogICAgfQoKICAgIC8qKgogICAgICog5Yig6ZmkCiAgICAgKgogICAgICogQHBhcmFtIHthbnlbXX0gZGF0YXMKICAgICAqIEByZXR1cm5zIHtQcm9taXNlPGFueT59CiAgICAgKiBAbWVtYmVyb2YgTWFpbkJhc2UKICAgICAqLwogICAgcHVibGljIGFzeW5jIHJlbW92ZShkYXRhczogYW55W10pOiBQcm9taXNlPGFueT4gewogICAgICAgIGlmKCF0aGlzLnJlbW92ZUFjdGlvbil7CiAgICAgICAgICAgIHRoaXMuJE5vdGljZS5lcnJvcih7IHRpdGxlOiAn6ZSZ6K+vJywgZGVzYzogJ1BJTUxBTkdVQUdFQUJJTElUWVlZTkxHcmlkVmlld+inhuWbvuihqOagvHJlbW92ZUFjdGlvbuWPguaVsOacqumFjee9ricgfSk7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICB9CiAgICAgICAgbGV0IF9kYXRhczphbnlbXSA9IFtdOwogICAgICAgIGRhdGFzLmZvckVhY2goKHJlY29yZDogYW55LCBpbmRleDogbnVtYmVyKSA9PiB7CiAgICAgICAgICAgIGlmIChPYmplY3QuaXMocmVjb3JkLnNyZnVmLCIwIikpIHsKICAgICAgICAgICAgICAgIHRoaXMuaXRlbXMuc29tZSgodmFsOiBhbnksIG51bTogbnVtYmVyKSA9PnsKICAgICAgICAgICAgICAgICAgICBpZihKU09OLnN0cmluZ2lmeSh2YWwpID09IEpTT04uc3RyaW5naWZ5KHJlY29yZCkpewogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLml0ZW1zLnNwbGljZShudW0sMSk7CiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuZ3JpZEl0ZW1zTW9kZWwuc3BsaWNlKG51bSwxKTsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSk7IAogICAgICAgICAgICB9ZWxzZXsKICAgICAgICAgICAgICAgX2RhdGFzLnB1c2goZGF0YXNbaW5kZXhdKTsKICAgICAgICAgICAgfQogICAgICAgIH0pOwogICAgICAgIGlmIChfZGF0YXMubGVuZ3RoID09PSAwKSB7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICB9CiAgICAgICAgbGV0IGRhdGFJbmZvID0gJyc7CiAgICAgICAgX2RhdGFzLmZvckVhY2goKHJlY29yZDogYW55LCBpbmRleDogbnVtYmVyKSA9PiB7CiAgICAgICAgICAgIGxldCBzcmZtYWpvcnRleHQgPSByZWNvcmQucGltbGFuZ3VhZ2VhYmlsaXR5bmFtZTsKICAgICAgICAgICAgaWYgKGluZGV4IDwgNSkgewogICAgICAgICAgICAgICAgaWYgKCFPYmplY3QuaXMoZGF0YUluZm8sICcnKSkgewogICAgICAgICAgICAgICAgICAgIGRhdGFJbmZvICs9ICfjgIEnOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgZGF0YUluZm8gKz0gc3JmbWFqb3J0ZXh0OwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgICAgICB9CiAgICAgICAgfSk7CgogICAgICAgIGlmIChfZGF0YXMubGVuZ3RoIDwgNSkgewogICAgICAgICAgICBkYXRhSW5mbyA9IGRhdGFJbmZvICsgJyDlhbEnICsgX2RhdGFzLmxlbmd0aCArICfmnaHmlbDmja4nOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIGRhdGFJbmZvID0gZGF0YUluZm8gKyAnLi4uJyArICcg5YWxJyArIF9kYXRhcy5sZW5ndGggKyAn5p2h5pWw5o2uJzsKICAgICAgICB9CgogICAgICAgIGNvbnN0IHJlbW92ZURhdGEgPSAoKSA9PiB7CiAgICAgICAgICAgIGxldCBrZXlzOiBhbnlbXSA9IFtdOwogICAgICAgICAgICBfZGF0YXMuZm9yRWFjaCgoZGF0YTogYW55KSA9PiB7CiAgICAgICAgICAgICAgICBrZXlzLnB1c2goZGF0YS5zcmZrZXkpOwogICAgICAgICAgICB9KTsKICAgICAgICAgICAgbGV0IF9yZW1vdmVBY3Rpb24gPSBrZXlzLmxlbmd0aCA+IDEgPyAncmVtb3ZlQmF0Y2gnIDogdGhpcy5yZW1vdmVBY3Rpb24gOwogICAgICAgICAgICBsZXQgX2tleXMgPSBrZXlzLmxlbmd0aCA+IDEgPyBrZXlzIDoga2V5c1swXSA7CiAgICAgICAgICAgIGNvbnN0IGNvbnRleHQ6YW55ID0gSlNPTi5wYXJzZShKU09OLnN0cmluZ2lmeSh0aGlzLmNvbnRleHQpKTsKICAgICAgICAgICAgY29uc3QgcG9zdDogUHJvbWlzZTxhbnk+ID0gdGhpcy5zZXJ2aWNlLmRlbGV0ZShfcmVtb3ZlQWN0aW9uLE9iamVjdC5hc3NpZ24oY29udGV4dCx7IHBpbWxhbmd1YWdlYWJpbGl0eTogX2tleXMgfSksT2JqZWN0LmFzc2lnbih7IHBpbWxhbmd1YWdlYWJpbGl0eTogX2tleXMgfSx7dmlld3BhcmFtczp0aGlzLnZpZXdwYXJhbXN9KSwgdGhpcy5zaG93QnVzeUluZGljYXRvcik7CiAgICAgICAgICAgIHJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZTogYW55LCByZWplY3Q6IGFueSkgPT4gewogICAgICAgICAgICAgICAgcG9zdC50aGVuKChyZXNwb25zZTogYW55KSA9PiB7CiAgICAgICAgICAgICAgICAgICAgaWYgKCFyZXNwb25zZSB8fCByZXNwb25zZS5zdGF0dXMgIT09IDIwMCkgewogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLiROb3RpY2UuZXJyb3IoeyB0aXRsZTogJycsIGRlc2M6ICfliKDpmaTmlbDmja7lpLHotKUsJyArIHJlc3BvbnNlLmluZm8gfSk7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLiROb3RpY2Uuc3VjY2Vzcyh7IHRpdGxlOiAnJywgZGVzYzogJ+WIoOmZpOaIkOWKnyEnIH0pOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAvL+WIoOmZpGl0ZW1z5Lit5bey5Yig6Zmk55qE6aG5CiAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2codGhpcy5pdGVtcyk7CiAgICAgICAgICAgICAgICAgICAgX2RhdGFzLmZvckVhY2goKGRhdGE6IGFueSkgPT4gewogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLml0ZW1zLnNvbWUoKGl0ZW06YW55LGluZGV4Om51bWJlcik9PnsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmKE9iamVjdC5pcyhpdGVtLnNyZmtleSxkYXRhLnNyZmtleSkpewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuaXRlbXMuc3BsaWNlKGluZGV4LDEpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuZ3JpZEl0ZW1zTW9kZWwuc3BsaWNlKGluZGV4LDEpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICB0aGlzLnRvdGFscm93IC09IF9kYXRhcy5sZW5ndGg7CiAgICAgICAgICAgICAgICAgICAgdGhpcy4kZW1pdCgncmVtb3ZlJywgbnVsbCk7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5zZWxlY3Rpb25zID0gW107CiAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZShyZXNwb25zZSk7CiAgICAgICAgICAgICAgICB9KS5jYXRjaCgocmVzcG9uc2U6IGFueSkgPT4gewogICAgICAgICAgICAgICAgICAgIGlmIChyZXNwb25zZSAmJiByZXNwb25zZS5zdGF0dXMgPT09IDQwMSkgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGlmICghcmVzcG9uc2UgfHwgIXJlc3BvbnNlLnN0YXR1cyB8fCAhcmVzcG9uc2UuZGF0YSkgewogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLiROb3RpY2UuZXJyb3IoeyB0aXRsZTogJ+mUmeivrycsIGRlc2M6ICfns7vnu5/lvILluLgnIH0pOwogICAgICAgICAgICAgICAgICAgICAgICByZWplY3QocmVzcG9uc2UpOwogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIHJlamVjdChyZXNwb25zZSk7CiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfSk7CiAgICAgICAgfQoKICAgICAgICBkYXRhSW5mbyA9IGRhdGFJbmZvLnJlcGxhY2UoL1tudWxsXS9nLCAnJykucmVwbGFjZSgvW3VuZGVmaW5lZF0vZywgJycpOwogICAgICAgIHRoaXMuJE1vZGFsLmNvbmZpcm0oewogICAgICAgICAgICB0aXRsZTogJ+itpuWRiicsCiAgICAgICAgICAgIGNvbnRlbnQ6ICfnoa7orqTopoHliKDpmaQgJyArIGRhdGFJbmZvICsgJ++8jOWIoOmZpOaTjeS9nOWwhuS4jeWPr+aBouWkje+8nycsCiAgICAgICAgICAgIG9uT2s6ICgpID0+IHsKICAgICAgICAgICAgICAgIHJlbW92ZURhdGEoKTsKICAgICAgICAgICAgfSwKICAgICAgICAgICAgb25DYW5jZWw6ICgpID0+IHsgfQogICAgICAgIH0pOwogICAgICAgIHJldHVybiByZW1vdmVEYXRhOwogICAgfQoKCiAgICAvKioKICAgICAqIOaJuemHj+a3u+WKoAogICAgICoKICAgICAqIEBwYXJhbSB7Kn0gW2FyZz17fV0KICAgICAqIEBtZW1iZXJvZiBNYWluQmFzZQogICAgICovCiAgICBwdWJsaWMgYWRkQmF0Y2goYXJnOiBhbnkgPSB7fSk6IHZvaWQgewogICAgICAgIGlmKCF0aGlzLmZldGNoQWN0aW9uKXsKICAgICAgICAgICAgdGhpcy4kTm90aWNlLmVycm9yKHsgdGl0bGU6ICfplJnor68nLCBkZXNjOiAnUElNTEFOR1VBR0VBQklMSVRZWVlOTEdyaWRWaWV36KeG5Zu+6KGo5qC8ZmV0Y2hBY3Rpb27lj4LmlbDmnKrphY3nva4nIH0pOwogICAgICAgICAgICByZXR1cm47CiAgICAgICAgfQogICAgICAgIGlmKCFhcmcpewogICAgICAgICAgICBhcmcgPSB7fTsKICAgICAgICB9CiAgICAgICAgY29uc29sZS5lcnJvcigi5om56YeP5re75Yqg5pyq5a6e546wIik7CiAgICB9CgogICAgLyoqCiAgICAgKiDmlbDmja7lr7zlhaUKICAgICAqCiAgICAgKiBAcGFyYW0geyp9IGRhdGEKICAgICAqIEBtZW1iZXJvZiBNYWluQmFzZQogICAgICovCiAgICAgcHVibGljIGltcG9ydEV4Y2VsKGRhdGE6YW55ID17fSk6dm9pZHsKICAgICAgICAvL+WvvOWFpWV4Y2VsCiAgICAgICAgY29uc3QgaW1wb3J0RGF0YU1vZGVsOmFueSA9ewogICAgICAgIH0KICAgICAgICBpZihPYmplY3Qua2V5cyhpbXBvcnREYXRhTW9kZWwpLmxlbmd0aCA9PSAwKXsKICAgICAgICAgICAgdGhpcy4kTm90aWNlLndhcm5pbmcoeyAndGl0bGUnOiAodGhpcy4kdCgiYXBwLnV0aWx2aWV3Lndhcm5pbmciKSBhcyBzdHJpbmcpLCAnZGVzYyc6ICh0aGlzLiR0KCJhcHAudXRpbHZpZXcuaW5mbyIpIGFzIHN0cmluZykgfSk7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICB9CiAgICAgICAgY29uc3QgdmlldzphbnkgPXsKICAgICAgICAgICAgdmlld25hbWU6ICdhcHAtZGF0YS11cGxvYWQnLAogICAgICAgICAgICB0aXRsZTogdGhpcy4kdCgiYXBwLnV0aWx2aWV3LmltcG9ydHZpZXciKSwKICAgICAgICAgICAgd2lkdGg6IDkwMCwKICAgICAgICAgICAgaGVpZ2h0OiA3MDAKICAgICAgICB9CiAgICAgICAgbGV0IGNvbnRhaW5lcjogU3ViamVjdDxhbnk+ID0gdGhpcy4kYXBwbW9kYWwub3Blbk1vZGFsKHZpZXcsIEpTT04ucGFyc2UoSlNPTi5zdHJpbmdpZnkodGhpcy5jb250ZXh0KSksIGltcG9ydERhdGFNb2RlbCk7CiAgICAgICAgY29udGFpbmVyLnN1YnNjcmliZSgocmVzdWx0OiBhbnkpID0+IHsKICAgICAgICAgIGlmKE9iamVjdC5pcyhyZXN1bHQucmV0LCdPSycpKXsKICAgICAgICAgICAgdGhpcy5yZWZyZXNoKHJlc3VsdC5kYXRhcyk7CiAgICAgICAgICB9CiAgICAgIH0pOwogICAgfQoKCiAgICAvKioKICAgICAqIOaVsOaNruWvvOWHugogICAgICoKICAgICAqIEBwYXJhbSB7Kn0gZGF0YQogICAgICogQG1lbWJlcm9mIE1haW5CYXNlCiAgICAgKi8KICAgIHB1YmxpYyBleHBvcnRFeGNlbChkYXRhOiBhbnkgPSB7fSk6IHZvaWQgewogICAgICAgIC8vIOWvvOWHukV4Y2VsCiAgICAgICAgY29uc3QgZG9FeHBvcnQgPSBhc3luYyAoX2RhdGE6YW55KSA9PiB7CiAgICAgICAgICAgIGNvbnN0IHRIZWFkZXI6IEFycmF5PGFueT4gPSBbXTsKICAgICAgICAgICAgY29uc3QgZmlsdGVyVmFsOiBBcnJheTxhbnk+ID0gW107CiAgICAgICAgICAgIHRoaXMuYWxsQ29sdW1ucy5mb3JFYWNoKChpdGVtOiBhbnkpID0+IHsKICAgICAgICAgICAgICBpdGVtLnNob3cgJiYgaXRlbS5sYWJlbCA/IHRIZWFkZXIucHVzaCh0aGlzLiR0KGl0ZW0ubGFuZ3RhZykpIDogIiI7CiAgICAgICAgICAgICAgaXRlbS5zaG93ICYmIGl0ZW0ubmFtZSA/IGZpbHRlclZhbC5wdXNoKGl0ZW0ubmFtZSkgOiAiIjsKICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIGNvbnN0IGRhdGEgPSBhd2FpdCB0aGlzLmZvcm1hdEV4Y2VsRGF0YShmaWx0ZXJWYWwsIF9kYXRhKTsKICAgICAgICAgICAgdGhpcy4kZXhwb3J0LmV4cG9ydEV4Y2VsKCkudGhlbigoZXhjZWw6YW55KT0+ewogICAgICAgICAgICAgICAgZXhjZWwuZXhwb3J0X2pzb25fdG9fZXhjZWwoewogICAgICAgICAgICAgICAgICBoZWFkZXI6IHRIZWFkZXIsIC8v6KGo5aS0IOW/heWhqwogICAgICAgICAgICAgICAgICBkYXRhLCAvL+WFt+S9k+aVsOaNriDlv4XloasKICAgICAgICAgICAgICAgICAgZmlsZW5hbWU6ICLor63oqIDog73lipvooagiLCAvL+mdnuW/heWhqwogICAgICAgICAgICAgICAgICBhdXRvV2lkdGg6IHRydWUsIC8v6Z2e5b+F5aGrCiAgICAgICAgICAgICAgICAgIGJvb2tUeXBlOiAieGxzeCIgLy/pnZ7lv4XloasKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9KTsgCiAgICAgICAgfTsKICAgICAgICBjb25zdCBwYWdlOiBhbnkgPSB7fTsKICAgICAgICAvLyDorr7nva5wYWdl77yMc2l6ZQogICAgICAgIGlmIChPYmplY3QuaXMoZGF0YS50eXBlLCAnbWF4Um93Q291bnQnKSkgewogICAgICAgICAgICBPYmplY3QuYXNzaWduKHBhZ2UsIHsgcGFnZTogMCwgc2l6ZTogZGF0YS5tYXhSb3dDb3VudCB9KTsKICAgICAgICB9IGVsc2UgaWYgKE9iamVjdC5pcyhkYXRhLnR5cGUsICdhY3RpdmF0ZWRQYWdlJykpIHsKICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgIGRvRXhwb3J0KEpTT04ucGFyc2UoSlNPTi5zdHJpbmdpZnkodGhpcy5pdGVtcykpKTsKICAgICAgICAgICAgfSBjYXRjaCAoZXJyb3IpIHsKICAgICAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoZXJyb3IpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICB9CiAgICAgICAgLy8g6K6+572u5o6S5bqPCiAgICAgICAgaWYgKCF0aGlzLmlzTm9Tb3J0ICYmICFPYmplY3QuaXModGhpcy5taW5vclNvcnREaXIsICcnKSAmJiAhT2JqZWN0LmlzKHRoaXMubWlub3JTb3J0UFNERUYsICcnKSkgewogICAgICAgICAgY29uc3Qgc29ydDogc3RyaW5nID0gdGhpcy5taW5vclNvcnRQU0RFRisiLCIrdGhpcy5taW5vclNvcnREaXI7CiAgICAgICAgICAgIE9iamVjdC5hc3NpZ24ocGFnZSwgeyBzb3J0OiBzb3J0IH0pOwogICAgICAgIH0KICAgICAgICBjb25zdCBhcmc6IGFueSA9IHt9OwogICAgICAgIE9iamVjdC5hc3NpZ24oYXJnLCBwYWdlKTsKICAgICAgICAvLyDojrflj5ZxdWVyeSzmkJzntKLooajljZXvvIx2aWV3cGFyYW1z562J54i25pWw5o2uCiAgICAgICAgY29uc3QgcGFyZW50ZGF0YTogYW55ID0ge307CiAgICAgICAgdGhpcy4kZW1pdCgnYmVmb3JlbG9hZCcsIHBhcmVudGRhdGEpOwogICAgICAgIE9iamVjdC5hc3NpZ24oYXJnLCBwYXJlbnRkYXRhKTsKICAgICAgICBjb25zdCBwb3N0OiBQcm9taXNlPGFueT4gPSB0aGlzLnNlcnZpY2Uuc2VhcmNoKHRoaXMuZmV0Y2hBY3Rpb24sSlNPTi5wYXJzZShKU09OLnN0cmluZ2lmeSh0aGlzLmNvbnRleHQpKSwgYXJnLCB0aGlzLnNob3dCdXN5SW5kaWNhdG9yKTsKICAgICAgICBwb3N0LnRoZW4oKHJlc3BvbnNlOiBhbnkpID0+IHsKICAgICAgICAgICAgaWYgKCFyZXNwb25zZSB8fCByZXNwb25zZS5zdGF0dXMgIT09IDIwMCkgewogICAgICAgICAgICAgICAgdGhpcy4kTm90aWNlLmVycm9yKHsgdGl0bGU6ICcnLCBkZXNjOiAn5pWw5o2u5a+85Ye65aSx6LSlLCcgKyByZXNwb25zZS5pbmZvIH0pOwogICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICBkb0V4cG9ydChKU09OLnBhcnNlKEpTT04uc3RyaW5naWZ5KHJlc3BvbnNlLmRhdGEpKSk7CiAgICAgICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7CiAgICAgICAgICAgICAgICBjb25zb2xlLmVycm9yKGVycm9yKTsKICAgICAgICAgICAgfQogICAgICAgIH0pLmNhdGNoKChyZXNwb25zZTogYW55KSA9PiB7CiAgICAgICAgICAgIGlmIChyZXNwb25zZSAmJiByZXNwb25zZS5zdGF0dXMgPT09IDQwMSkgewogICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHRoaXMuJE5vdGljZS5lcnJvcih7IHRpdGxlOiAnJywgZGVzYzogJ+aVsOaNruWvvOWHuuWksei0pScgfSk7CiAgICAgICAgfSk7CiAgICB9CgoKICAgIC8qKgogICAgICog5a+85Ye65pWw5o2u5qC85byP5YyWCiAgICAgKiAKICAgICAqIEBwYXJhbSB7Kn0gZmlsdGVyVmFsCiAgICAgKiBAcGFyYW0geyp9IGpzb25EYXRhCiAgICAgKiBAcmV0dXJucyB7W119CiAgICAgKiBAbWVtYmVyb2YgTWFpbkJhc2UKICAgICAqLwogICAgcHVibGljIGFzeW5jIGZvcm1hdEV4Y2VsRGF0YShmaWx0ZXJWYWw6YW55LCBqc29uRGF0YTphbnkpIHsKICAgICAgICBsZXQgY29kZWxpc3RDb2x1bW5zOkFycmF5PGFueT4gPSBbCiAgICAgICAgICB7CiAgICAgICAgICAgIG5hbWU6ICd3eXl6JywKICAgICAgICAgICAgc3Jma2V5OiAnRWhyQ29kZUxpc3QwMTIyJywKICAgICAgICAgICAgY29kZWxpc3RUeXBlIDogJ0RZTkFNSUMnLAogICAgICAgICAgICByZW5kZXJNb2RlOiAnb3RoZXInLAogICAgICAgICAgICB0ZXh0U2VwYXJhdG9yOiAn44CBJywKICAgICAgICAgICAgdmFsdWVTZXBhcmF0b3I6ICcsJywKICAgICAgICAgIH0sCiAgICAgICAgICB7CiAgICAgICAgICAgIG5hbWU6ICd3eWRqJywKICAgICAgICAgICAgc3Jma2V5OiAnRWhyQ29kZUxpc3QwMTQ2JywKICAgICAgICAgICAgY29kZWxpc3RUeXBlIDogJ0RZTkFNSUMnLAogICAgICAgICAgICByZW5kZXJNb2RlOiAnb3RoZXInLAogICAgICAgICAgICB0ZXh0U2VwYXJhdG9yOiAn44CBJywKICAgICAgICAgICAgdmFsdWVTZXBhcmF0b3I6ICcsJywKICAgICAgICAgIH0sCiAgICAgICAgXTsKICAgICAgICBsZXQgX3RoaXMgPSB0aGlzOwogICAgICAgIGZvciAoY29uc3QgY29kZWxpc3Qgb2YgY29kZWxpc3RDb2x1bW5zKSB7CiAgICAgICAgICAvLyDliqjmgIHku6PnoIHooajlpITnkIYKICAgICAgICAgIGlmIChPYmplY3QuaXMoY29kZWxpc3QuY29kZWxpc3RUeXBlLCAiRFlOQU1JQyIpKSB7CiAgICAgICAgICAgICAgbGV0IGl0ZW1zID0gYXdhaXQgX3RoaXMuY29kZUxpc3RTZXJ2aWNlLmdldEl0ZW1zKGNvZGVsaXN0LnNyZmtleSk7CiAgICAgICAgICAgICAganNvbkRhdGEuZm9yRWFjaCgocm93OmFueSk9PnsKICAgICAgICAgICAgICAgICAgcm93W2NvZGVsaXN0Lm5hbWVdID0gX3RoaXMuZ2V0Q29kZWxpc3RWYWx1ZShpdGVtcywgcm93W2NvZGVsaXN0Lm5hbWVdLCBjb2RlbGlzdCk7CiAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAvLyDpnZnmgIHlpITnkIYKICAgICAgICAgIH0gZWxzZSBpZihPYmplY3QuaXMoY29kZWxpc3QuY29kZWxpc3RUeXBlLCAiU1RBVElDIikpewogICAgICAgICAgICAgIGxldCBpdGVtcyA9IGF3YWl0IF90aGlzLiRzdG9yZS5nZXR0ZXJzLmdldENvZGVMaXN0SXRlbXMoY29kZWxpc3Quc3Jma2V5KTsKICAgICAgICAgICAgICBqc29uRGF0YS5mb3JFYWNoKChyb3c6YW55KT0+ewogICAgICAgICAgICAgICAgICByb3dbY29kZWxpc3QubmFtZV0gPSBfdGhpcy5nZXRDb2RlbGlzdFZhbHVlKGl0ZW1zLCByb3dbY29kZWxpc3QubmFtZV0sIGNvZGVsaXN0KTsKICAgICAgICAgICAgICB9KTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgcmV0dXJuIGpzb25EYXRhLm1hcCgodjphbnkpID0+IGZpbHRlclZhbC5tYXAoKGo6YW55KSA9PiB2W2pdKSkKICAgIH0gICAKCgogICAgLyoqCiAgICAgKiDop6PmnpDku6PnoIHooajlkox2bGF1Ze+8jOiuvue9rml0ZW1zCiAgICAgKgogICAgICogQHB1YmxpYwogICAgICogQHBhcmFtIHthbnlbXX0gaXRlbXMg5Luj56CB6KGo5pWw5o2uCiAgICAgKiBAcGFyYW0geyp9IHZhbHVlCiAgICAgKiBAcmV0dXJucyB7Kn0KICAgICAqIEBtZW1iZXJvZiBNYWluQmFzZQogICAgICovCiAgICBwdWJsaWMgZ2V0Q29kZWxpc3RWYWx1ZShpdGVtczogYW55W10sIHZhbHVlOiBhbnksIGNvZGVsaXN0OiBhbnksKXsKICAgICAgICBpZighdmFsdWUpewogICAgICAgICAgICByZXR1cm4gdGhpcy4kdCgnY29kZWxpc3QuJytjb2RlbGlzdC5zcmZrZXkrJy5lbXB0eScpOwogICAgICAgIH0KICAgICAgICBpZiAoaXRlbXMpIHsKICAgICAgICAgICAgbGV0IHJlc3VsdDphbnkgPSBbXTsKICAgICAgICAgICAgaWYoT2JqZWN0LmlzKGNvZGVsaXN0LnJlbmRlck1vZGUsIm51bWJlciIpKXsKICAgICAgICAgICAgICAgIGl0ZW1zLm1hcCgoX2l0ZW06IGFueSwgaW5kZXg6IG51bWJlcik9PnsKICAgICAgICAgICAgICAgICAgICBjb25zdCBuVmFsdWUgPSBwYXJzZUludCgodmFsdWUgYXMgYW55KSwgMTApOwogICAgICAgICAgICAgICAgICAgIGNvbnN0IGNvZGV2YWx1ZSA9IF9pdGVtLnZhbHVlOwogICAgICAgICAgICAgICAgICAgIGlmKChwYXJzZUludChjb2RldmFsdWUsIDEwKSAmIG5WYWx1ZSkgPiAwKXsKICAgICAgICAgICAgICAgICAgICAgICAgcmVzdWx0LnB1c2goX2l0ZW0pOwogICAgICAgICAgICAgICAgICAgIH0gCiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfSBlbHNlIGlmKE9iamVjdC5pcyhjb2RlbGlzdC5yZW5kZXJNb2RlLCJzdHJpbmciKSl7CiAgICAgICAgICAgICAgICBjb25zdCBhcnJheVZhbHVlOiBBcnJheTxhbnk+ID0gKHZhbHVlIGFzIGFueSkuc3BsaXQoY29kZWxpc3QudmFsdWVTZXBhcmF0b3IpOwogICAgICAgICAgICAgICAgYXJyYXlWYWx1ZS5tYXAoKHZhbHVlOiBhbnksIGluZGV4OiBudW1iZXIpID0+IHsKICAgICAgICAgICAgICAgICAgICByZXN1bHQucHVzaChbXSk7CiAgICAgICAgICAgICAgICAgICAgbGV0IHZhbHVlczogYW55W10gPSBPYmplY3QuaXModGhpcy4kdXRpbC50eXBlT2YodmFsdWUpLCAnbnVtYmVyJykgPyBbdmFsdWVdIDogWy4uLih2YWx1ZSBhcyBhbnkpLnNwbGl0KGNvZGVsaXN0LnZhbHVlU2VwYXJhdG9yKV07CiAgICAgICAgICAgICAgICAgICAgdmFsdWVzLm1hcCgodmFsOmFueSAsbnVtOiBudW1iZXIpPT57CiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGl0ZW0gPSB0aGlzLmdldEl0ZW0oaXRlbXMsIHZhbCwgY29kZWxpc3QpOyAKICAgICAgICAgICAgICAgICAgICAgICAgaWYoaXRlbSl7CiAgICAgICAgICAgICAgICAgICAgICAgICAgcmVzdWx0W2luZGV4XS5wdXNoKGl0ZW0pOwogICAgICAgICAgICAgICAgICAgICAgICB9IAogICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBsZXQgdmFsdWVzOiBhbnlbXSA9IE9iamVjdC5pcyh0aGlzLiR1dGlsLnR5cGVPZih2YWx1ZSksICdudW1iZXInKSA/IFt2YWx1ZV0gOiBbLi4uKHZhbHVlIGFzIGFueSkuc3BsaXQoY29kZWxpc3QudmFsdWVTZXBhcmF0b3IpXTsKICAgICAgICAgICAgICAgIHZhbHVlcy5tYXAoKHZhbHVlOmFueSAsaW5kZXg6IG51bWJlcik9PnsKICAgICAgICAgICAgICAgICAgICBjb25zdCBpdGVtID0gdGhpcy5nZXRJdGVtKGl0ZW1zLCB2YWx1ZSwgY29kZWxpc3QpOyAKICAgICAgICAgICAgICAgICAgICBpZihpdGVtKXsKICAgICAgICAgICAgICAgICAgICAgIHJlc3VsdC5wdXNoKGl0ZW0pOwogICAgICAgICAgICAgICAgICAgIH0gCiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfQogICAgICAgICAgICAvLyDorr7nva5pdGVtcwogICAgICAgICAgICBpZihyZXN1bHQubGVuZ3RoICE9IDApewogICAgICAgICAgICAgIHJldHVybiByZXN1bHQuam9pbihjb2RlbGlzdC52YWx1ZVNlcGFyYXRvcik7CiAgICAgICAgICAgIH1lbHNlewogICAgICAgICAgICAgIHJldHVybiB2YWx1ZTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIOiOt+WPluS7o+eggemhuQogICAgICoKICAgICAqIEBwdWJsaWMKICAgICAqIEBwYXJhbSB7YW55W119IGl0ZW1zCiAgICAgKiBAcGFyYW0geyp9IHZhbHVlCiAgICAgKiBAcmV0dXJucyB7Kn0KICAgICAqIEBtZW1iZXJvZiBNYWluQmFzZQogICAgICovCiAgICBwdWJsaWMgZ2V0SXRlbShpdGVtczogYW55W10sIHZhbHVlOiBhbnksIGNvZGVsaXN0OiBhbnkpOiBhbnkgewogICAgICAgIGNvbnN0IGFycjogQXJyYXk8YW55PiA9IGl0ZW1zLmZpbHRlcihpdGVtID0+IHtyZXR1cm4gaXRlbS52YWx1ZSA9PSB2YWx1ZX0pOwogICAgICAgIGlmIChhcnIubGVuZ3RoICE9PSAxKSB7CiAgICAgICAgICAgIHJldHVybiB1bmRlZmluZWQ7CiAgICAgICAgfQogICAgICAgIGlmKE9iamVjdC5pcyhjb2RlbGlzdC5jb2RlbGlzdFR5cGUsJ1NUQVRJQycpKXsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuJHQoJ2NvZGVsaXN0LicrY29kZWxpc3Quc3Jma2V5KycuJythcnJbMF0udmFsdWUpOwogICAgICAgIH1lbHNlewogICAgICAgICAgICByZXR1cm4gYXJyWzBdLnRleHQ7CiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICog55Sf5ZG95ZGo5pyfCiAgICAgKgogICAgICogQG1lbWJlcm9mIE1haW5CYXNlCiAgICAgKi8KICAgIHB1YmxpYyBjcmVhdGVkKCk6IHZvaWQgewogICAgICAgIHRoaXMuYWZ0ZXJDcmVhdGVkKCk7CiAgICB9CgogICAgLyoqCiAgICAgKiDmiafooYxjcmVhdGVk5ZCO55qE6YC76L6RCiAgICAgKgogICAgICogIEBtZW1iZXJvZiBNYWluQmFzZQogICAgICovICAgIAogICAgcHVibGljIGFmdGVyQ3JlYXRlZCgpewogICAgICAgIHRoaXMuc2V0Q29sU3RhdGUoKTsKICAgICAgICBpZiAodGhpcy52aWV3U3RhdGUpIHsKICAgICAgICAgICAgdGhpcy52aWV3U3RhdGVFdmVudCA9IHRoaXMudmlld1N0YXRlLnN1YnNjcmliZSgoeyB0YWcsIGFjdGlvbiwgZGF0YSB9KSA9PiB7CiAgICAgICAgICAgICAgICBpZiAoIU9iamVjdC5pcyh0YWcsIHRoaXMubmFtZSkpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBpZiAoT2JqZWN0LmlzKCdsb2FkJywgYWN0aW9uKSkgewogICAgICAgICAgICAgICAgICAgIHRoaXMubG9hZChkYXRhKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGlmIChPYmplY3QuaXMoJ3JlbW92ZScsIGFjdGlvbikpIHsKICAgICAgICAgICAgICAgICAgICB0aGlzLnJlbW92ZShkYXRhKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGlmIChPYmplY3QuaXMoJ3NhdmUnLCBhY3Rpb24pKSB7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5zYXZlKGRhdGEpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9KTsKICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiB2dWUg55Sf5ZG95ZGo5pyfCiAgICAgKgogICAgICogQG1lbWJlcm9mIE1haW5CYXNlCiAgICAgKi8KICAgIHB1YmxpYyBkZXN0cm95ZWQoKSB7CiAgICAgICAgdGhpcy5hZnRlckRlc3Ryb3koKTsKICAgIH0KCiAgICAvKioKICAgICAqIOaJp+ihjGRlc3Ryb3llZOWQjueahOmAu+i+kQogICAgICoKICAgICAqIEBtZW1iZXJvZiBNYWluQmFzZQogICAgICovCiAgICBwdWJsaWMgYWZ0ZXJEZXN0cm95KCkgewogICAgICAgIGlmICh0aGlzLnZpZXdTdGF0ZUV2ZW50KSB7CiAgICAgICAgICAgIHRoaXMudmlld1N0YXRlRXZlbnQudW5zdWJzY3JpYmUoKTsKICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiDojrflj5bpgInkuK3ooYzog6HmlbDmja4KICAgICAqCiAgICAgKiBAcmV0dXJucyB7YW55W119CiAgICAgKiBAbWVtYmVyb2YgTWFpbkJhc2UKICAgICAqLwogICAgcHVibGljIGdldFNlbGVjdGlvbigpOiBhbnlbXSB7CiAgICAgICAgcmV0dXJuIHRoaXMuc2VsZWN0aW9uczsKICAgIH0KCiAgICAvKioKICAgICAqIOihjOWPjOWHu+S6i+S7tgogICAgICoKICAgICAqIEBwYXJhbSB7Kn0gJGV2ZW50CiAgICAgKiBAcmV0dXJucyB7dm9pZH0KICAgICAqIEBtZW1iZXJvZiBNYWluQmFzZQogICAgICovCiAgICBwdWJsaWMgcm93REJMQ2xpY2soJGV2ZW50OiBhbnkpOiB2b2lkIHsKICAgICAgICBpZiAoISRldmVudCB8fCB0aGlzLmFjdHVhbElzT3BlbkVkaXQgfHwgT2JqZWN0LmlzKHRoaXMuZ3JpZFJvd0FjdGl2ZU1vZGUsMCkpIHsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KICAgICAgICB0aGlzLnNlbGVjdGlvbnMgPSBbXTsKICAgICAgICB0aGlzLnNlbGVjdGlvbnMucHVzaChKU09OLnBhcnNlKEpTT04uc3RyaW5naWZ5KCRldmVudCkpKTsKCiAgICAgICAgY29uc3QgcmVmczogYW55ID0gdGhpcy4kcmVmczsKICAgICAgICBpZiAocmVmcy5tdWx0aXBsZVRhYmxlKSB7CiAgICAgICAgICAgIHJlZnMubXVsdGlwbGVUYWJsZS5jbGVhclNlbGVjdGlvbigpOwogICAgICAgICAgICByZWZzLm11bHRpcGxlVGFibGUudG9nZ2xlUm93U2VsZWN0aW9uKCRldmVudCk7CiAgICAgICAgfQoKICAgICAgICB0aGlzLiRlbWl0KCdyb3dkYmxjbGljaycsIHRoaXMuc2VsZWN0aW9ucyk7CiAgICAgICAgdGhpcy4kZW1pdCgnc2VsZWN0aW9uY2hhbmdlJywgdGhpcy5zZWxlY3Rpb25zKTsKICAgIH0KCiAgICAvKioKICAgICAqIOWkjemAieahhuaVsOaNrumAieS4rQogICAgICoKICAgICAqIEBwYXJhbSB7Kn0gJGV2ZW50CiAgICAgKiBAcmV0dXJucyB7dm9pZH0KICAgICAqIEBtZW1iZXJvZiBNYWluQmFzZQogICAgICovCiAgICBwdWJsaWMgc2VsZWN0KCRldmVudDogYW55KTogdm9pZCB7CiAgICAgICAgaWYgKCEkZXZlbnQpIHsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KICAgICAgICB0aGlzLnNlbGVjdGlvbnMgPSBbXTsKICAgICAgICB0aGlzLnNlbGVjdGlvbnMgPSBbLi4uSlNPTi5wYXJzZShKU09OLnN0cmluZ2lmeSgkZXZlbnQpKV07CiAgICAgICAgdGhpcy4kZW1pdCgnc2VsZWN0aW9uY2hhbmdlJywgdGhpcy5zZWxlY3Rpb25zKTsKICAgIH0KCiAgICAvKioKICAgICAqIOWkjemAieahhuaVsOaNruWFqOmDqOmAieS4rQogICAgICoKICAgICAqIEBwYXJhbSB7Kn0gJGV2ZW50CiAgICAgKiBAbWVtYmVyb2YgTWFpbkJhc2UKICAgICAqLwogICAgcHVibGljIHNlbGVjdEFsbCgkZXZlbnQ6IGFueSk6IHZvaWQgewogICAgICAgIGlmICghJGV2ZW50KSB7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICB9CiAgICAgICAgdGhpcy5zZWxlY3Rpb25zID0gW107CiAgICAgICAgdGhpcy5zZWxlY3Rpb25zID0gWy4uLkpTT04ucGFyc2UoSlNPTi5zdHJpbmdpZnkoJGV2ZW50KSldOwogICAgICAgIHRoaXMuJGVtaXQoJ3NlbGVjdGlvbmNoYW5nZScsIHRoaXMuc2VsZWN0aW9ucyk7CiAgICB9CgogICAgCiAgICAvKioKICAgICAqIOihjOWNleWHu+mAieS4rQogICAgICoKICAgICAqIEBwYXJhbSB7Kn0gJGV2ZW50CiAgICAgKiBAcmV0dXJucyB7dm9pZH0KICAgICAqIEBtZW1iZXJvZiBNYWluQmFzZQogICAgICovCiAgICBwdWJsaWMgcm93Q2xpY2soJGV2ZW50OiBhbnksIGlmQWx3YXlzOiBib29sZWFuID0gZmFsc2UpOiB2b2lkIHsKICAgICAgICBpZiAoIWlmQWx3YXlzICYmICghJGV2ZW50IHx8IHRoaXMuYWN0dWFsSXNPcGVuRWRpdCkpIHsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KICAgICAgICBpZih0aGlzLnN0b3BSb3dDbGljaykgewogICAgICAgICAgICB0aGlzLnN0b3BSb3dDbGljayA9IGZhbHNlOwogICAgICAgICAgICByZXR1cm47CiAgICAgICAgfQogICAgICAgIGlmKHRoaXMuaXNTaW5nbGVTZWxlY3QpewogICAgICAgICAgICB0aGlzLnNlbGVjdGlvbnMgPSBbXTsKICAgICAgICB9CiAgICAgICAgLy8g5bey6YCJ5Lit5YiZ5Yig6Zmk77yM5rKh6YCJ5Lit5YiZ5re75YqgCiAgICAgICAgbGV0IHNlbGVjdEluZGV4ID0gdGhpcy5zZWxlY3Rpb25zLmZpbmRJbmRleCgoaXRlbTphbnkpPT57CiAgICAgICAgICAgIHJldHVybiBPYmplY3QuaXMoaXRlbS5waW1sYW5ndWFnZWFiaWxpdHksJGV2ZW50LnBpbWxhbmd1YWdlYWJpbGl0eSk7CiAgICAgICAgfSk7CiAgICAgICAgaWYgKE9iamVjdC5pcyhzZWxlY3RJbmRleCwtMSkpewogICAgICAgICAgdGhpcy5zZWxlY3Rpb25zLnB1c2goSlNPTi5wYXJzZShKU09OLnN0cmluZ2lmeSgkZXZlbnQpKSk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIHRoaXMuc2VsZWN0aW9ucy5zcGxpY2Uoc2VsZWN0SW5kZXgsMSk7CiAgICAgICAgfQoKICAgICAgICBjb25zdCByZWZzOiBhbnkgPSB0aGlzLiRyZWZzOwogICAgICAgIGlmIChyZWZzLm11bHRpcGxlVGFibGUpIHsKICAgICAgICAgICAgaWYodGhpcy5pc1NpbmdsZVNlbGVjdCl7CiAgICAgICAgICAgICAgICByZWZzLm11bHRpcGxlVGFibGUuY2xlYXJTZWxlY3Rpb24oKTsKICAgICAgICAgICAgICAgIHJlZnMubXVsdGlwbGVUYWJsZS5zZXRDdXJyZW50Um93KCRldmVudCk7CiAgICAgICAgICAgIH1lbHNlewogICAgICAgICAgICAgICAgcmVmcy5tdWx0aXBsZVRhYmxlLnRvZ2dsZVJvd1NlbGVjdGlvbigkZXZlbnQpOyAKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgdGhpcy4kZW1pdCgnc2VsZWN0aW9uY2hhbmdlJywgdGhpcy5zZWxlY3Rpb25zKTsKICAgIH0KCgogICAgLyoqCiAgICAgKiDpobXpnaLlj5jljJYKICAgICAqCiAgICAgKiBAcGFyYW0geyp9ICRldmVudAogICAgICogQHJldHVybnMge3ZvaWR9CiAgICAgKiBAbWVtYmVyb2YgTWFpbkJhc2UKICAgICAqLwogICAgcHVibGljIHBhZ2VPbkNoYW5nZSgkZXZlbnQ6IGFueSk6IHZvaWQgewogICAgICAgIGlmICghJGV2ZW50KSB7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICB9CiAgICAgICAgaWYgKCRldmVudCA9PT0gdGhpcy5jdXJQYWdlKSB7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICB9CiAgICAgICAgdGhpcy5jdXJQYWdlID0gJGV2ZW50OwogICAgICAgIHRoaXMubG9hZCh7fSk7CiAgICB9CgogICAgLyoqCiAgICAgKiDliIbpobXmnaHmlbDlj5jljJYKICAgICAqCiAgICAgKiBAcGFyYW0geyp9ICRldmVudAogICAgICogQHJldHVybnMge3ZvaWR9CiAgICAgKiBAbWVtYmVyb2YgTWFpbkJhc2UKICAgICAqLwogICAgcHVibGljIG9uUGFnZVNpemVDaGFuZ2UoJGV2ZW50OiBhbnkpOiB2b2lkIHsKICAgICAgICBpZiAoISRldmVudCkgewogICAgICAgICAgICByZXR1cm47CiAgICAgICAgfQogICAgICAgIGlmICgkZXZlbnQgPT09IHRoaXMubGltaXQpIHsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KICAgICAgICB0aGlzLmxpbWl0ID0gJGV2ZW50OwogICAgICAgIGlmICh0aGlzLmN1clBhZ2UgPT09IDEpIHsKICAgICAgICAgICAgdGhpcy5sb2FkKHt9KTsKICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiDliIbpobXliLfmlrAKICAgICAqCiAgICAgKiBAbWVtYmVyb2YgTWFpbkJhc2UKICAgICAqLwogICAgcHVibGljIHBhZ2VSZWZyZXNoKCk6IHZvaWQgewogICAgICAgIHRoaXMubG9hZCh7fSk7CiAgICB9CgogICAgLyoqCiAgICAgKiDmjpLluo/lj5jljJYKICAgICAqCiAgICAgKiBAcGFyYW0ge3sgY29sdW1uOiBhbnksIHByb3A6IGFueSwgb3JkZXI6IGFueSB9fSB7IGNvbHVtbiwgcHJvcCwgb3JkZXIgfQogICAgICogQG1lbWJlcm9mIE1haW5CYXNlCiAgICAgKi8KICAgIHB1YmxpYyBvblNvcnRDaGFuZ2UoeyBjb2x1bW4sIHByb3AsIG9yZGVyIH06IHsgY29sdW1uOiBhbnksIHByb3A6IGFueSwgb3JkZXI6IGFueSB9KTogdm9pZCB7CiAgICAgICAgY29uc3QgZGlyID0gT2JqZWN0LmlzKG9yZGVyLCAnYXNjZW5kaW5nJykgPyAnYXNjJyA6IE9iamVjdC5pcyhvcmRlciwgJ2Rlc2NlbmRpbmcnKSA/ICdkZXNjJyA6ICcnOwogICAgICAgIGlmIChPYmplY3QuaXMoZGlyLCB0aGlzLm1pbm9yU29ydERpcikgJiYgT2JqZWN0LmlzKHRoaXMubWlub3JTb3J0UFNERUYsIHByb3ApKSB7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICB9CiAgICAgICAgdGhpcy5taW5vclNvcnREaXIgPSBkaXI7CiAgICAgICAgdGhpcy5taW5vclNvcnRQU0RFRiA9IHByb3AgPyBwcm9wIDogJyc7CiAgICAgICAgdGhpcy5sb2FkKHt9KTsKICAgIH0KCiAgICAvKioKICAgICAqIOihqOagvOihjOmAieS4reagt+W8jwogICAgICoKICAgICAqIEBwYXJhbSB7eyByb3c6IGFueSwgcm93SW5kZXg6IGFueSB9fSB7IHJvdywgcm93SW5kZXggfQogICAgICogQHJldHVybnMge3N0cmluZ30KICAgICAqIEBtZW1iZXJvZiBNYWluQmFzZQogICAgICovCiAgICBwdWJsaWMgb25Sb3dDbGFzc05hbWUoeyByb3csIHJvd0luZGV4IH06IHsgcm93OiBhbnksIHJvd0luZGV4OiBhbnkgfSk6IHN0cmluZyB7CiAgICAgICAgY29uc3QgaW5kZXggPSB0aGlzLnNlbGVjdGlvbnMuZmluZEluZGV4KChzZWxlY3Q6IGFueSkgPT4gT2JqZWN0LmlzKHNlbGVjdC5zcmZrZXksIHJvdy5zcmZrZXkpKTsKICAgICAgICByZXR1cm4gaW5kZXggIT09IC0xID8gJ2dyaWQtcm93LXNlbGVjdCcgOiAnJzsKICAgIH0KCgoKICAgIC8qKgogICAgICog55WM6Z2i6KGM5Li6CiAgICAgKgogICAgICogQHBhcmFtIHsqfSByb3cKICAgICAqIEBwYXJhbSB7Kn0gdGFnCiAgICAgKiBAcGFyYW0geyp9ICRldmVudAogICAgICogQG1lbWJlcm9mIE1haW5CYXNlCiAgICAgKi8KCXB1YmxpYyB1aUFjdGlvbihyb3c6IGFueSwgdGFnOiBhbnksICRldmVudDogYW55KSB7CiAgICAgICAgLy8gdGhpcy5yb3dDbGljayhyb3csIHRydWUpOwogICAgICAgICRldmVudC5zdG9wUHJvcGFnYXRpb24oKTsKICAgIH0KCiAgICAvKioKICAgICAqIOiuvue9ruWIl+eKtuaAgQogICAgICoKICAgICAqIEBtZW1iZXJvZiBNYWluQmFzZQogICAgICovCiAgICBwdWJsaWMgc2V0Q29sU3RhdGUoKSB7CgkJY29uc3QgX2RhdGE6IGFueSA9IGxvY2FsU3RvcmFnZS5nZXRJdGVtKCdwaW1sYW5ndWFnZWFiaWxpdHlfbWFpbl9ncmlkJyk7CgkJaWYgKF9kYXRhKSB7CgkJCWxldCBjb2x1bW5zID0gSlNPTi5wYXJzZShfZGF0YSk7CgkJCWNvbHVtbnMuZm9yRWFjaCgoY29sOiBhbnkpID0+IHsKCQkJCWxldCBjb2x1bW4gPSB0aGlzLmFsbENvbHVtbnMuZmluZCgoaXRlbSkgPT4gT2JqZWN0LmlzKGNvbC5uYW1lLCBpdGVtLm5hbWUpKTsKCQkJCWlmIChjb2x1bW4pIHsKCQkJCQlPYmplY3QuYXNzaWduKGNvbHVtbiwgY29sKTsKCQkJCX0KCQkJfSk7CgkJfQogICAgfQoKICAgIC8qKgogICAgICog5YiX5Y+Y5YyWCiAgICAgKgogICAgICogQG1lbWJlcm9mIE1haW5CYXNlCiAgICAgKi8KICAgIHB1YmxpYyBvbkNvbENoYW5nZSgpIHsKICAgICAgICBsb2NhbFN0b3JhZ2Uuc2V0SXRlbSgncGltbGFuZ3VhZ2VhYmlsaXR5X21haW5fZ3JpZCcsIEpTT04uc3RyaW5naWZ5KHRoaXMuYWxsQ29sdW1ucykpOwogICAgfQoKICAgIC8qKgogICAgICog6I635Y+W5YiX54q25oCBCiAgICAgKgogICAgICogQHBhcmFtIHtzdHJpbmd9IG5hbWUKICAgICAqIEByZXR1cm5zIHtib29sZWFufQogICAgICogQG1lbWJlcm9mIE1haW5CYXNlCiAgICAgKi8KICAgIHB1YmxpYyBnZXRDb2x1bW5TdGF0ZShuYW1lOiBzdHJpbmcpOiBib29sZWFuIHsKICAgICAgICBsZXQgY29sdW1uID0gdGhpcy5hbGxDb2x1bW5zLmZpbmQoKGNvbDogYW55KSA9PgogICAgICAgICAgICBPYmplY3QuaXMobmFtZSwgY29sLm5hbWUpCiAgICAgICAgKTsKICAgICAgICByZXR1cm4gY29sdW1uLnNob3cgPyB0cnVlIDogZmFsc2U7CiAgICB9CgogICAgLyoqCiAgICAgKiDooajmoLzliJfmmK/lkKboh6rpgILlupTluIPlsYAKICAgICAqCiAgICAgKiBAcmVhZG9ubHkKICAgICAqIEB0eXBlIHtib29sZWFufQogICAgICogQG1lbWJlcm9mIE1haW5CYXNlCiAgICAgKi8KICAgIGdldCBhZGFwdGl2ZVN0YXRlKCk6IGJvb2xlYW4gewogICAgICAgIHJldHVybiAhdGhpcy5hbGxDb2x1bW5zLmZpbmQoKGNvbHVtbjogYW55KSA9PiBjb2x1bW4uc2hvdyAmJiBPYmplY3QuaXMoY29sdW1uLnV0aWwsICdTVEFSJykpOwogICAgfQoKICAgIC8qKgogICAgICog5L+d5a2YCiAgICAgKgogICAgICogQHBhcmFtIHsqfSAkZXZlbnQKICAgICAqIEByZXR1cm5zIHtQcm9taXNlPGFueT59CiAgICAgKiBAbWVtYmVyb2YgTWFpbkJhc2UKICAgICAqLwogICAgcHVibGljIGFzeW5jIHNhdmUoYXJnczogYW55W10sIHBhcmFtcz86IGFueSwgJGV2ZW50PzogYW55LCB4RGF0YT86IGFueSl7CiAgICAgICAgbGV0IF90aGlzID0gdGhpczsKICAgICAgICBpZighYXdhaXQgdGhpcy52YWxpZGF0ZUFsbCgpKXsKICAgICAgICAgICAgdGhpcy4kTm90aWNlLmVycm9yKHsgdGl0bGU6ICfplJnor68nLCBkZXNjOiAn5YC86KeE5YiZ5qCh6aqM5byC5bi4JyB9KTsKICAgICAgICAgICAgcmV0dXJuIFtdOwogICAgICAgIH0KICAgICAgICBsZXQgc3VjY2Vzc0l0ZW1zOmFueSA9IFtdOwogICAgICAgIGxldCBlcnJvckl0ZW1zOmFueSA9IFtdOwogICAgICAgIGxldCBlcnJvck1lc3NhZ2U6YW55ID0gW107CiAgICAgICAgZm9yIChjb25zdCBpdGVtIG9mIF90aGlzLml0ZW1zKSB7CiAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICBpZihPYmplY3QuaXMoaXRlbS5yb3dEYXRhU3RhdGUsICdjcmVhdGUnKSl7CiAgICAgICAgICAgICAgICAgICAgaWYoIXRoaXMuY3JlYXRlQWN0aW9uKXsKICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy4kTm90aWNlLmVycm9yKHsgdGl0bGU6ICfplJnor68nLCBkZXNjOiAnUElNTEFOR1VBR0VBQklMSVRZWVlOTEdyaWRWaWV36KeG5Zu+6KGo5qC8Y3JlYXRlQWN0aW9u5Y+C5pWw5pyq6YWN572uJyB9KTsKICAgICAgICAgICAgICAgICAgICB9ZWxzZXsKICAgICAgICAgICAgICAgICAgICAgIE9iamVjdC5hc3NpZ24oaXRlbSx7dmlld3BhcmFtczp0aGlzLnZpZXdwYXJhbXN9KTsKICAgICAgICAgICAgICAgICAgICAgIGxldCByZXNwb25zZSA9IGF3YWl0IHRoaXMuc2VydmljZS5hZGQodGhpcy5jcmVhdGVBY3Rpb24sIEpTT04ucGFyc2UoSlNPTi5zdHJpbmdpZnkodGhpcy5jb250ZXh0KSksaXRlbSwgdGhpcy5zaG93QnVzeUluZGljYXRvcik7CiAgICAgICAgICAgICAgICAgICAgICBzdWNjZXNzSXRlbXMucHVzaChKU09OLnBhcnNlKEpTT04uc3RyaW5naWZ5KHJlc3BvbnNlLmRhdGEpKSk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfWVsc2UgaWYoT2JqZWN0LmlzKGl0ZW0ucm93RGF0YVN0YXRlLCAndXBkYXRlJykpewogICAgICAgICAgICAgICAgICAgIGlmKCF0aGlzLnVwZGF0ZUFjdGlvbil7CiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuJE5vdGljZS5lcnJvcih7IHRpdGxlOiAn6ZSZ6K+vJywgZGVzYzogJ1BJTUxBTkdVQUdFQUJJTElUWVlZTkxHcmlkVmlld+inhuWbvuihqOagvHVwZGF0ZUFjdGlvbuWPguaVsOacqumFjee9ricgfSk7CiAgICAgICAgICAgICAgICAgICAgfWVsc2V7CiAgICAgICAgICAgICAgICAgICAgICAgIE9iamVjdC5hc3NpZ24oaXRlbSx7dmlld3BhcmFtczp0aGlzLnZpZXdwYXJhbXN9KTsKICAgICAgICAgICAgICAgICAgICAgICAgaWYoaXRlbS5waW1sYW5ndWFnZWFiaWxpdHkpewogICAgICAgICAgICAgICAgICAgICAgICAgICAgT2JqZWN0LmFzc2lnbih0aGlzLmNvbnRleHQse3BpbWxhbmd1YWdlYWJpbGl0eTppdGVtLnBpbWxhbmd1YWdlYWJpbGl0eX0pOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIGxldCByZXNwb25zZSA9IGF3YWl0IHRoaXMuc2VydmljZS5hZGQodGhpcy51cGRhdGVBY3Rpb24sSlNPTi5wYXJzZShKU09OLnN0cmluZ2lmeSh0aGlzLmNvbnRleHQpKSxpdGVtLCB0aGlzLnNob3dCdXN5SW5kaWNhdG9yKTsKICAgICAgICAgICAgICAgICAgICAgICAgc3VjY2Vzc0l0ZW1zLnB1c2goSlNPTi5wYXJzZShKU09OLnN0cmluZ2lmeShyZXNwb25zZS5kYXRhKSkpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSBjYXRjaCAoZXJyb3IpIHsKICAgICAgICAgICAgICAgIGVycm9ySXRlbXMucHVzaChKU09OLnBhcnNlKEpTT04uc3RyaW5naWZ5KGl0ZW0pKSk7CiAgICAgICAgICAgICAgICBlcnJvck1lc3NhZ2UucHVzaChlcnJvcik7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgdGhpcy4kZW1pdCgnc2F2ZScsIHN1Y2Nlc3NJdGVtcyk7CiAgICAgICAgdGhpcy5yZWZyZXNoKFtdKTsKICAgICAgICBpZihlcnJvckl0ZW1zLmxlbmd0aCA9PT0gMCl7CiAgICAgICAgICAgIHRoaXMuJE5vdGljZS5zdWNjZXNzKHsgdGl0bGU6ICcnLCBkZXNjOiAn5L+d5a2Y5oiQ5YqfIScgfSk7CiAgICAgICAgfWVsc2V7CiAgICAgICAgICBlcnJvckl0ZW1zLmZvckVhY2goKGl0ZW06YW55LGluZGV4Om51bWJlcik9PnsKICAgICAgICAgICAgdGhpcy4kTm90aWNlLmVycm9yKHsgdGl0bGU6ICfkv53lrZjlpLHotKUnLCBkZXNjOiBpdGVtLm1ham9yZW50aXR5bmFtZSsn5L+d5a2Y5aSx6LSl77yBJyB9KTsKICAgICAgICAgICAgY29uc29sZS5lcnJvcihlcnJvck1lc3NhZ2VbaW5kZXhdKTsKICAgICAgICAgIH0pOwogICAgICAgIH0KICAgICAgICByZXR1cm4gc3VjY2Vzc0l0ZW1zOwogICAgfQoKICAgIC8qKgogICAgICog5paw5bu66KGMCiAgICAgKgogICAgICogQHBhcmFtIHsqfSAkZXZlbnQKICAgICAqIEByZXR1cm5zIHt2b2lkfQogICAgICogQG1lbWJlcm9mIE1haW5CYXNlCiAgICAgKi8KICAgIHB1YmxpYyBuZXdSb3coYXJnczogYW55W10sIHBhcmFtcz86IGFueSwgJGV2ZW50PzogYW55LCB4RGF0YT86IGFueSk6IHZvaWQgewogICAgICAgIGlmKCF0aGlzLmxvYWRkcmFmdEFjdGlvbil7CiAgICAgICAgICAgIHRoaXMuJE5vdGljZS5lcnJvcih7IHRpdGxlOiAn6ZSZ6K+vJywgZGVzYzogJ1BJTUxBTkdVQUdFQUJJTElUWVlZTkxHcmlkVmlld+inhuWbvuihqOagvGxvYWRkcmFmdEFjdGlvbuWPguaVsOacqumFjee9ricgfSk7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICB9CiAgICAgICAgbGV0IF90aGlzID0gdGhpczsKICAgICAgICBPYmplY3QuYXNzaWduKGFyZ3NbMF0se3ZpZXdwYXJhbXM6dGhpcy52aWV3cGFyYW1zfSk7CiAgICAgICAgbGV0IHBvc3Q6IFByb21pc2U8YW55PiA9IHRoaXMuc2VydmljZS5sb2FkRHJhZnQodGhpcy5sb2FkZHJhZnRBY3Rpb24sIEpTT04ucGFyc2UoSlNPTi5zdHJpbmdpZnkodGhpcy5jb250ZXh0KSksIGFyZ3NbMF0sIHRoaXMuc2hvd0J1c3lJbmRpY2F0b3IpOwogICAgICAgIHBvc3QudGhlbigocmVzcG9uc2U6IGFueSkgPT4gewogICAgICAgICAgICBpZiAoIXJlc3BvbnNlLnN0YXR1cyB8fCByZXNwb25zZS5zdGF0dXMgIT09IDIwMCkgewogICAgICAgICAgICAgICAgaWYgKHJlc3BvbnNlLmVycm9yTWVzc2FnZSkgewogICAgICAgICAgICAgICAgICAgIHRoaXMuJE5vdGljZS5lcnJvcih7IHRpdGxlOiAn6ZSZ6K+vJywgZGVzYzogcmVzcG9uc2UuZXJyb3JNZXNzYWdlIH0pOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGNvbnN0IGRhdGEgPSByZXNwb25zZS5kYXRhOwogICAgICAgICAgICB0aGlzLmNyZWF0ZURlZmF1bHQoZGF0YSk7CiAgICAgICAgICAgIGRhdGEucm93RGF0YVN0YXRlID0gImNyZWF0ZSI7CiAgICAgICAgICAgIF90aGlzLml0ZW1zLnB1c2goZGF0YSk7CiAgICAgICAgICAgIF90aGlzLmdyaWRJdGVtc01vZGVsLnB1c2goX3RoaXMuZ2V0R3JpZFJvd01vZGVsKCkpOwogICAgICAgIH0pLmNhdGNoKChyZXNwb25zZTogYW55KSA9PiB7CiAgICAgICAgICAgIGlmIChyZXNwb25zZSAmJiByZXNwb25zZS5zdGF0dXMgPT09IDQwMSkgewogICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmICghcmVzcG9uc2UgfHwgIXJlc3BvbnNlLnN0YXR1cyB8fCAhcmVzcG9uc2UuZGF0YSkgewogICAgICAgICAgICAgICAgdGhpcy4kTm90aWNlLmVycm9yKHsgdGl0bGU6ICfplJnor68nLCBkZXNjOiAn57O757uf5byC5bi4JyB9KTsKICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgfQogICAgICAgIH0pOwogICAgfQoKICAgIC8qKgogICAgICog6KGo5qC857yW6L6R6aG55YC85Y+Y5pu0CiAgICAgKiAgCiAgICAgKiBAcGFyYW0gcm93IOihjOaVsOaNrgogICAgICogQHBhcmFtIHt7IG5hbWU6IHN0cmluZywgdmFsdWU6IGFueSB9fSAkZXZlbnQKICAgICAqIEByZXR1cm5zIHt2b2lkfQogICAgICogQG1lbWJlcm9mIE1haW5CYXNlCiAgICAgKi8KICAgIHB1YmxpYyBvbkdyaWRJdGVtVmFsdWVDaGFuZ2Uocm93OiBhbnksJGV2ZW50OiB7IG5hbWU6IHN0cmluZywgdmFsdWU6IGFueSB9LHJvd0luZGV4OiBudW1iZXIpOiB2b2lkIHsKICAgICAgICBpZiAoISRldmVudCkgewogICAgICAgICAgICByZXR1cm47CiAgICAgICAgfQogICAgICAgIGlmICghJGV2ZW50Lm5hbWUgfHwgT2JqZWN0LmlzKCRldmVudC5uYW1lLCAnJykgfHwgIXJvdy5oYXNPd25Qcm9wZXJ0eSgkZXZlbnQubmFtZSkpIHsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KICAgICAgICByb3dbJGV2ZW50Lm5hbWVdID0gJGV2ZW50LnZhbHVlOwogICAgICAgIHRoaXMuZ3JpZEVkaXRJdGVtQ2hhbmdlKHJvdywgJGV2ZW50Lm5hbWUsICRldmVudC52YWx1ZSwgcm93SW5kZXgpOwogICAgfQoKICAgIC8qKgogICAgICog6KGo5qC857yW6L6R6aG55YC85Y+Y5YyWCiAgICAgKgogICAgICogQHB1YmxpYwogICAgICogQHBhcmFtIHJvdyDooYzmlbDmja4KICAgICAqIEBwYXJhbSBwcm9wZXJ0eSDliJfnvJbovpHpobnlkI0KICAgICAqIEBwYXJhbSByb3cg5YiX57yW6L6R6aG55YC8CiAgICAgKiBAcmV0dXJucyB7dm9pZH0KICAgICAqIEBtZW1iZXJvZiBNYWluQmFzZQogICAgICovCiAgICBwdWJsaWMgZ3JpZEVkaXRJdGVtQ2hhbmdlKHJvdzogYW55LCBwcm9wZXJ0eTogc3RyaW5nLCB2YWx1ZTogYW55LCByb3dJbmRleDogbnVtYmVyKXsKICAgICAgICByb3cucm93RGF0YVN0YXRlID0gcm93LnJvd0RhdGFTdGF0ZSA/IHJvdy5yb3dEYXRhU3RhdGUgOiAidXBkYXRlIiA7CiAgICAgICAgdGhpcy52YWxpZGF0ZShwcm9wZXJ0eSxyb3cscm93SW5kZXgpOwogICAgfQoKICAgIC8qKgogICAgICog6KGo5qC857yW6L6R6aG55pu05pawCiAgICAgKgogICAgICogQHBhcmFtIHtzdHJpbmd9IG1vZGUg55WM6Z2i6KGM5Li65ZCN56ewCiAgICAgKiBAcGFyYW0geyp9IFtkYXRhPXt9XSDor7fmsYLmlbDmja4KICAgICAqIEBwYXJhbSB7c3RyaW5nW119IHVwZGF0ZURldGFpbHMg5pu05paw6aG5CiAgICAgKiBAcGFyYW0ge2Jvb2xlYW59IFtzaG93bG9hZGluZ10g5piv5ZCm5pi+56S65Yqg6L2954q25oCBCiAgICAgKiBAcmV0dXJucyB7dm9pZH0KICAgICAqIEBtZW1iZXJvZiBNYWluQmFzZQogICAgICovCiAgICBwdWJsaWMgdXBkYXRlR3JpZEVkaXRJdGVtKG1vZGU6IHN0cmluZywgZGF0YTogYW55ID0ge30sIHVwZGF0ZURldGFpbHM6IHN0cmluZ1tdLCBzaG93bG9hZGluZz86IGJvb2xlYW4pOiB2b2lkIHsKICAgICAgICBpZiAoIW1vZGUgfHwgKG1vZGUgJiYgT2JqZWN0LmlzKG1vZGUsICcnKSkpIHsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KICAgICAgICBjb25zdCBhcmc6IGFueSA9IEpTT04ucGFyc2UoSlNPTi5zdHJpbmdpZnkoZGF0YSkpOwogICAgICAgIE9iamVjdC5hc3NpZ24oYXJnLHt2aWV3cGFyYW1zOnRoaXMudmlld3BhcmFtc30pOwogICAgICAgIGNvbnN0IHBvc3Q6IFByb21pc2U8YW55PiA9IHRoaXMuc2VydmljZS5mcm9udExvZ2ljKG1vZGUsSlNPTi5wYXJzZShKU09OLnN0cmluZ2lmeSh0aGlzLmNvbnRleHQpKSxhcmcsIHNob3dsb2FkaW5nKTsKICAgICAgICBwb3N0LnRoZW4oKHJlc3BvbnNlOiBhbnkpID0+IHsKICAgICAgICAgICAgaWYgKCFyZXNwb25zZSB8fCByZXNwb25zZS5zdGF0dXMgIT09IDIwMCkgewogICAgICAgICAgICAgICAgdGhpcy4kTm90aWNlLmVycm9yKHsgdGl0bGU6ICfplJnor68nLCBkZXNjOiAn6KGo5Y2V6aG55pu05paw5aSx6LSlJyB9KTsKICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgfQogICAgICAgICAgICBjb25zdCBfZGF0YTogYW55ID0gcmVzcG9uc2UuZGF0YTsKICAgICAgICAgICAgaWYoIV9kYXRhKXsKICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgfQogICAgICAgICAgICB1cGRhdGVEZXRhaWxzLmZvckVhY2goKG5hbWU6IHN0cmluZykgPT4gewogICAgICAgICAgICAgICAgaWYgKCFfZGF0YS5oYXNPd25Qcm9wZXJ0eShuYW1lKSkgewogICAgICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGRhdGFbbmFtZV0gPSBfZGF0YVtuYW1lXTsKICAgICAgICAgICAgfSk7CiAgICAgICAgfSkuY2F0Y2goKHJlc3BvbnNlOiBhbnkpID0+IHsKICAgICAgICAgICAgaWYgKHJlc3BvbnNlICYmIHJlc3BvbnNlLnN0YXR1cyA9PT0gNDAxKSB7CiAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKCFyZXNwb25zZSB8fCAhcmVzcG9uc2Uuc3RhdHVzIHx8ICFyZXNwb25zZS5kYXRhKSB7CiAgICAgICAgICAgICAgICB0aGlzLiROb3RpY2UuZXJyb3IoeyB0aXRsZTogJ+mUmeivrycsIGRlc2M6ICfns7vnu5/lvILluLgnIH0pOwogICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICB9CiAgICAgICAgfSk7CiAgICB9CgogICAgLyoqCiAgICAgKiDojrflj5blr7nlupTooYxjbGFzcwogICAgICoKICAgICAqIEBwYXJhbSB7Kn0gJGFyZ3Mgcm93IOihjOaVsOaNru+8jHJvd0luZGV4IOihjOe0ouW8lQogICAgICogQHJldHVybnMge3ZvaWR9CiAgICAgKiBAbWVtYmVyb2YgTWFpbkJhc2UKICAgICAqLwogICAgcHVibGljIGdldFJvd0NsYXNzTmFtZShhcmdzOntyb3c6IGFueSxyb3dJbmRleDogbnVtYmVyfSl7CiAgICAgICAgbGV0IGlzU2VsZWN0ZWQgPSB0aGlzLnNlbGVjdGlvbnMuc29tZSgoaXRlbTphbnkpPT57CiAgICAgICAgICAgIHJldHVybiBPYmplY3QuaXMoaXRlbS5waW1sYW5ndWFnZWFiaWxpdHksYXJncy5yb3cucGltbGFuZ3VhZ2VhYmlsaXR5KTsKICAgICAgICB9KTsKICAgICAgICByZXR1cm4gaXNTZWxlY3RlZCA/ICJncmlkLXNlbGVjdGVkLXJvdyIgOiAiIjsKICAgIH0KCiAgICAvKioKICAgICAqIOiOt+WPluWvueW6lOWIl2NsYXNzCiAgICAgKgogICAgICogQHBhcmFtIHsqfSAkYXJncyByb3cg6KGM5pWw5o2u77yMY29sdW1uIOWIl+aVsOaNru+8jHJvd0luZGV4IOihjOe0ouW8le+8jOWIl+e0ouW8lQogICAgICogQHJldHVybnMge3ZvaWR9CiAgICAgKiBAbWVtYmVyb2YgTWFpbkJhc2UKICAgICAqLwogICAgcHVibGljIGdldENlbGxDbGFzc05hbWUoYXJnczp7cm93OiBhbnksIGNvbHVtbjogYW55LCByb3dJbmRleDogbnVtYmVyLCBjb2x1bW5JbmRleDpudW1iZXJ9KXsKICAgICAgICBsZXQgaGFzUm93RWRpdDphbnkgPSB7CiAgICAgICAgICAnd3l5eic6dHJ1ZSwKICAgICAgICAgICd3eWRqJzp0cnVlLAogICAgICAgICAgJ3d5ZGpocXNqJzp0cnVlLAogICAgICAgICAgJ2ZqJzp0cnVlLAogICAgICAgIH0KICAgICAgICByZXR1cm4gKCBoYXNSb3dFZGl0W2FyZ3MuY29sdW1uLnByb3BlcnR5XSAmJiB0aGlzLmFjdHVhbElzT3BlbkVkaXQgKSA/ICJlZGl0LWNlbGwiIDogImluZm8tY2VsbCI7CiAgICB9CgogICAgLyoqCiAgICAgKiDmlrDlu7rpu5jorqTlgLwKICAgICAqIEBwYXJhbSB7Kn0gIHJvdyDooYzmlbDmja4KICAgICAqIEBtZW1iZXJvZiBNYWluQmFzZQogICAgICovCiAgICBwdWJsaWMgY3JlYXRlRGVmYXVsdChyb3c6IGFueSl7ICAgICAgICAgICAgICAgICAgICAKICAgICAgICBpZiAocm93Lmhhc093blByb3BlcnR5KCdwaW1wZXJzb25pZCcpKSB7CiAgICAgICAgICAgIHJvd1sncGltcGVyc29uaWQnXSA9IHRoaXMudmlld3BhcmFtc1snc3JmcGFyZW50a2V5J107CiAgICAgICAgfQogICAgfQp9Cg=="},null]}
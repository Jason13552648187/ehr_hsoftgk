{"remainingRequest":"F:\\crod项目\\人事管理系统2\\iBizEHR\\app_EHRPim\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!F:\\crod项目\\人事管理系统2\\iBizEHR\\app_EHRPim\\src\\widgets\\orm-post\\gwchoice-grid\\gwchoice-grid-base.vue?vue&type=script&lang=tsx&","dependencies":[{"path":"F:\\crod项目\\人事管理系统2\\iBizEHR\\app_EHRPim\\src\\widgets\\orm-post\\gwchoice-grid\\gwchoice-grid-base.vue","mtime":1630509411113},{"path":"F:\\crod项目\\人事管理系统2\\iBizEHR\\app_EHRPim\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1630511852775},{"path":"F:\\crod项目\\人事管理系统2\\iBizEHR\\app_EHRPim\\node_modules\\thread-loader\\dist\\cjs.js","mtime":1630511853252},{"path":"F:\\crod项目\\人事管理系统2\\iBizEHR\\app_EHRPim\\node_modules\\babel-loader\\lib\\index.js","mtime":1630511852747},{"path":"F:\\crod项目\\人事管理系统2\\iBizEHR\\app_EHRPim\\node_modules\\ts-loader\\index.js","mtime":1630511985412},{"path":"F:\\crod项目\\人事管理系统2\\iBizEHR\\app_EHRPim\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1630511852775},{"path":"F:\\crod项目\\人事管理系统2\\iBizEHR\\app_EHRPim\\node_modules\\vue-loader\\lib\\index.js","mtime":1630512070338}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:CgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCmltcG9ydCB7IFZ1ZSwgQ29tcG9uZW50LCBQcm9wLCBQcm92aWRlLCBFbWl0LCBXYXRjaCwgTW9kZWwsSW5qZWN0IH0gZnJvbSAndnVlLXByb3BlcnR5LWRlY29yYXRvcic7CmltcG9ydCB7IENyZWF0ZUVsZW1lbnQgfSBmcm9tICd2dWUnOwppbXBvcnQgeyBTdWJqZWN0LCBTdWJzY3JpcHRpb24gfSBmcm9tICdyeGpzJzsKaW1wb3J0IHsgQ29udHJvbEludGVyZmFjZSB9IGZyb20gJ0AvaW50ZXJmYWNlL2NvbnRyb2wnOwppbXBvcnQgeyBVSUFjdGlvblRvb2wsVXRpbCB9IGZyb20gJ0AvdXRpbHMnOwppbXBvcnQgTmF2RGF0YVNlcnZpY2UgZnJvbSAnQC9zZXJ2aWNlL2FwcC9uYXZkYXRhLXNlcnZpY2UnOwppbXBvcnQgT3JtUG9zdFNlcnZpY2UgZnJvbSAnQC9zZXJ2aWNlL29ybS1wb3N0L29ybS1wb3N0LXNlcnZpY2UnOwppbXBvcnQgR1dDaG9pY2VTZXJ2aWNlIGZyb20gJy4vZ3djaG9pY2UtZ3JpZC1zZXJ2aWNlJzsKCmltcG9ydCBDb2RlTGlzdFNlcnZpY2UgZnJvbSAiQHNlcnZpY2UvYXBwL2NvZGVsaXN0LXNlcnZpY2UiOwppbXBvcnQgeyBGb3JtSXRlbU1vZGVsIH0gZnJvbSAnQC9tb2RlbC9mb3JtLWRldGFpbCc7CgoKQENvbXBvbmVudCh7CiAgICBjb21wb25lbnRzOiB7CiAgICAgIAogICAgfQp9KQpleHBvcnQgZGVmYXVsdCBjbGFzcyBHV0Nob2ljZUJhc2UgZXh0ZW5kcyBWdWUgaW1wbGVtZW50cyBDb250cm9sSW50ZXJmYWNlIHsKCiAgICAvKioKICAgICAqIOWQjeensAogICAgICoKICAgICAqIEB0eXBlIHtzdHJpbmd9CiAgICAgKiBAbWVtYmVyb2YgR1dDaG9pY2VCYXNlCiAgICAgKi8KICAgIEBQcm9wKCkgcHVibGljIG5hbWU/OiBzdHJpbmc7CgogICAgLyoqCiAgICAgKiDop4blm77pgJrorq/lr7nosaEKICAgICAqCiAgICAgKiBAdHlwZSB7U3ViamVjdDxWaWV3U3RhdGU+fQogICAgICogQG1lbWJlcm9mIEdXQ2hvaWNlQmFzZQogICAgICovCiAgICBAUHJvcCgpIHB1YmxpYyB2aWV3U3RhdGUhOiBTdWJqZWN0PFZpZXdTdGF0ZT47CgogICAgLyoqCiAgICAgKiDlupTnlKjkuIrkuIvmlocKICAgICAqCiAgICAgKiBAdHlwZSB7Kn0KICAgICAqIEBtZW1iZXJvZiBHV0Nob2ljZUJhc2UKICAgICAqLwogICAgQFByb3AoKSBwdWJsaWMgY29udGV4dDogYW55OwoKICAgIC8qKgogICAgICog6KeG5Zu+5Y+C5pWwCiAgICAgKgogICAgICogQHR5cGUgeyp9CiAgICAgKiBAbWVtYmVyb2YgR1dDaG9pY2VCYXNlCiAgICAgKi8KICAgIEBQcm9wKCkgcHVibGljIHZpZXdwYXJhbXM6IGFueTsKCiAgICAvKioKICAgICAqIOinhuWbvueKtuaAgeS6i+S7tgogICAgICoKICAgICAqIEBwdWJsaWMKICAgICAqIEB0eXBlIHsoU3Vic2NyaXB0aW9uIHwgdW5kZWZpbmVkKX0KICAgICAqIEBtZW1iZXJvZiBHV0Nob2ljZUJhc2UKICAgICAqLwogICAgcHVibGljIHZpZXdTdGF0ZUV2ZW50OiBTdWJzY3JpcHRpb24gfCB1bmRlZmluZWQ7CgogICAgLyoqCiAgICAgKiDojrflj5bpg6jku7bnsbvlnosKICAgICAqCiAgICAgKiBAcmV0dXJucyB7c3RyaW5nfQogICAgICogQG1lbWJlcm9mIEdXQ2hvaWNlQmFzZQogICAgICovCiAgICBwdWJsaWMgZ2V0Q29udHJvbFR5cGUoKTogc3RyaW5nIHsKICAgICAgICByZXR1cm4gJ0dSSUQnCiAgICB9CgoKCiAgICAvKioKICAgICAqIOiuoeaVsOWZqOacjeWKoeWvueixoembhuWQiAogICAgICoKICAgICAqIEB0eXBlIHtBcnJheTwqPn0KICAgICAqIEBtZW1iZXJvZiBHV0Nob2ljZUJhc2UKICAgICAqLyAgICAKICAgIHB1YmxpYyBjb3VudGVyU2VydmljZUFycmF5OkFycmF5PGFueT4gPSBbXTsKCiAgICAvKioKICAgICAqIOW7uuaehOmDqOS7tuacjeWKoeWvueixoQogICAgICoKICAgICAqIEB0eXBlIHtHV0Nob2ljZVNlcnZpY2V9CiAgICAgKiBAbWVtYmVyb2YgR1dDaG9pY2VCYXNlCiAgICAgKi8KICAgIHB1YmxpYyBzZXJ2aWNlOiBHV0Nob2ljZVNlcnZpY2UgPSBuZXcgR1dDaG9pY2VTZXJ2aWNlKHsgJHN0b3JlOiB0aGlzLiRzdG9yZSB9KTsKCiAgICAvKioKICAgICAqIOWunuS9k+acjeWKoeWvueixoQogICAgICoKICAgICAqIEB0eXBlIHtPcm1Qb3N0U2VydmljZX0KICAgICAqIEBtZW1iZXJvZiBHV0Nob2ljZUJhc2UKICAgICAqLwogICAgcHVibGljIGFwcEVudGl0eVNlcnZpY2U6IE9ybVBvc3RTZXJ2aWNlID0gbmV3IE9ybVBvc3RTZXJ2aWNlKHsgJHN0b3JlOiB0aGlzLiRzdG9yZSB9KTsKICAgIAoKCiAgICAvKioKICAgICAqIOWFs+mXreinhuWbvgogICAgICoKICAgICAqIEBwYXJhbSB7YW55fSBhcmdzCiAgICAgKiBAbWVtYmVyb2YgR1dDaG9pY2VCYXNlCiAgICAgKi8KICAgIHB1YmxpYyBjbG9zZVZpZXcoYXJnczogYW55KTogdm9pZCB7CiAgICAgICAgbGV0IF90aGlzOiBhbnkgPSB0aGlzOwogICAgICAgIF90aGlzLiRlbWl0KCdjbG9zZXZpZXcnLCBbYXJnc10pOwogICAgfQoKICAgIC8qKgogICAgICogIOiuoeaVsOWZqOWIt+aWsAogICAgICoKICAgICAqIEBtZW1iZXJvZiBHV0Nob2ljZUJhc2UKICAgICAqLwogICAgcHVibGljIGNvdW50ZXJSZWZyZXNoKCl7CiAgICAgICAgY29uc3QgX3RoaXM6YW55ID10aGlzOwogICAgICAgIGlmKF90aGlzLmNvdW50ZXJTZXJ2aWNlQXJyYXkgJiYgX3RoaXMuY291bnRlclNlcnZpY2VBcnJheS5sZW5ndGggPjApewogICAgICAgICAgICBfdGhpcy5jb3VudGVyU2VydmljZUFycmF5LmZvckVhY2goKGl0ZW06YW55KSA9PnsKICAgICAgICAgICAgICAgIGlmKGl0ZW0ucmVmcmVzaERhdGEgJiYgaXRlbS5yZWZyZXNoRGF0YSBpbnN0YW5jZW9mIEZ1bmN0aW9uKXsKICAgICAgICAgICAgICAgICAgICBpdGVtLnJlZnJlc2hEYXRhKCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0pCiAgICAgICAgfQogICAgfQoKCiAgICAvKioKICAgICAqIOS7o+eggeihqOacjeWKoeWvueixoQogICAgICoKICAgICAqIEB0eXBlIHtDb2RlTGlzdFNlcnZpY2V9CiAgICAgKiBAbWVtYmVyb2YgR1dDaG9pY2VCYXNlCiAgICAgKi8gIAogICAgcHVibGljIGNvZGVMaXN0U2VydmljZTpDb2RlTGlzdFNlcnZpY2UgPSBuZXcgQ29kZUxpc3RTZXJ2aWNlKHsgJHN0b3JlOiB0aGlzLiRzdG9yZSB9KTsKCiAgICAvKioKICAgICAqIOiOt+WPluWkmumhueaVsOaNrgogICAgICoKICAgICAqIEByZXR1cm5zIHthbnlbXX0KICAgICAqIEBtZW1iZXJvZiBHV0Nob2ljZUJhc2UKICAgICAqLwogICAgcHVibGljIGdldERhdGFzKCk6IGFueVtdIHsKICAgICAgICByZXR1cm4gdGhpcy5zZWxlY3Rpb25zOwogICAgfQoKICAgIC8qKgogICAgICog6I635Y+W5Y2V6aG55qCRCiAgICAgKgogICAgICogQHJldHVybnMgeyp9CiAgICAgKiBAbWVtYmVyb2YgR1dDaG9pY2VCYXNlCiAgICAgKi8KICAgIHB1YmxpYyBnZXREYXRhKCk6IGFueSB7CiAgICAgICAgcmV0dXJuIHRoaXMuc2VsZWN0aW9uc1swXTsKICAgIH0KCgogICAgLyoqCiAgICAgKiDmmL7npLrlpITnkIbmj5DnpLoKICAgICAqCiAgICAgKiBAdHlwZSB7Ym9vbGVhbn0KICAgICAqIEBtZW1iZXJvZiBHV0Nob2ljZUJhc2UKICAgICAqLwogICAgQFByb3AoeyBkZWZhdWx0OiB0cnVlIH0pIHB1YmxpYyBzaG93QnVzeUluZGljYXRvcj86IGJvb2xlYW47CgogICAgLyoqCiAgICAgKiDpg6jku7booYzkuLotLXVwZGF0ZQogICAgICoKICAgICAqIEB0eXBlIHtzdHJpbmd9CiAgICAgKiBAbWVtYmVyb2YgR1dDaG9pY2VCYXNlCiAgICAgKi8KICAgIEBQcm9wKCkgcHVibGljIHVwZGF0ZUFjdGlvbiE6IHN0cmluZzsKICAgIAogICAgLyoqCiAgICAgKiDpg6jku7booYzkuLotLWZldGNoCiAgICAgKgogICAgICogQHR5cGUge3N0cmluZ30KICAgICAqIEBtZW1iZXJvZiBHV0Nob2ljZUJhc2UKICAgICAqLwogICAgQFByb3AoKSBwdWJsaWMgZmV0Y2hBY3Rpb24hOiBzdHJpbmc7CiAgICAKICAgIC8qKgogICAgICog6YOo5Lu26KGM5Li6LS1yZW1vdmUKICAgICAqCiAgICAgKiBAdHlwZSB7c3RyaW5nfQogICAgICogQG1lbWJlcm9mIEdXQ2hvaWNlQmFzZQogICAgICovCiAgICBAUHJvcCgpIHB1YmxpYyByZW1vdmVBY3Rpb24hOiBzdHJpbmc7CiAgICAKICAgIC8qKgogICAgICog6YOo5Lu26KGM5Li6LS1sb2FkCiAgICAgKgogICAgICogQHR5cGUge3N0cmluZ30KICAgICAqIEBtZW1iZXJvZiBHV0Nob2ljZUJhc2UKICAgICAqLwogICAgQFByb3AoKSBwdWJsaWMgbG9hZEFjdGlvbiE6IHN0cmluZzsKICAgIAogICAgLyoqCiAgICAgKiDpg6jku7booYzkuLotLWxvYWRkcmFmdAogICAgICoKICAgICAqIEB0eXBlIHtzdHJpbmd9CiAgICAgKiBAbWVtYmVyb2YgR1dDaG9pY2VCYXNlCiAgICAgKi8KICAgIEBQcm9wKCkgcHVibGljIGxvYWRkcmFmdEFjdGlvbiE6IHN0cmluZzsKICAgIAogICAgLyoqCiAgICAgKiDpg6jku7booYzkuLotLWNyZWF0ZQogICAgICoKICAgICAqIEB0eXBlIHtzdHJpbmd9CiAgICAgKiBAbWVtYmVyb2YgR1dDaG9pY2VCYXNlCiAgICAgKi8KICAgIEBQcm9wKCkgcHVibGljIGNyZWF0ZUFjdGlvbiE6IHN0cmluZzsKCiAgICAvKioKICAgICAqIOW9k+WJjemhtQogICAgICoKICAgICAqIEB0eXBlIHtudW1iZXJ9CiAgICAgKiBAbWVtYmVyb2YgR1dDaG9pY2VCYXNlCiAgICAgKi8KICAgIHB1YmxpYyBjdXJQYWdlOiBudW1iZXIgPSAxOwoKICAgIC8qKgogICAgICog5pWw5o2uCiAgICAgKgogICAgICogQHR5cGUge2FueVtdfQogICAgICogQG1lbWJlcm9mIEdXQ2hvaWNlQmFzZQogICAgICovCiAgICBwdWJsaWMgaXRlbXM6IGFueVtdID0gW107CgogICAgLyoqCiAgICAgKiDmmK/lkKbmlK/mjIHliIbpobUKICAgICAqCiAgICAgKiBAdHlwZSB7Ym9vbGVhbn0KICAgICAqIEBtZW1iZXJvZiBHV0Nob2ljZUJhc2UKICAgICAqLwogICAgcHVibGljIGlzRW5hYmxlUGFnaW5nQmFyOiBib29sZWFuID0gdHJ1ZTsKCiAgICAvKioKICAgICAqIOaYr+WQpuemgeeUqOaOkuW6jwogICAgICoKICAgICAqIEB0eXBlIHtib29sZWFufQogICAgICogQG1lbWJlcm9mIEdXQ2hvaWNlQmFzZQogICAgICovCiAgICBwdWJsaWMgaXNOb1NvcnQ6IGJvb2xlYW4gPSBmYWxzZTsKCiAgICAvKioKICAgICAqIOaOkuW6j+aWueWQkQogICAgICoKICAgICAqIEB0eXBlIHtzdHJpbmd9CiAgICAgKiBAbWVtYmVyb2YgR1dDaG9pY2VCYXNlCiAgICAgKi8KICAgIHB1YmxpYyBtaW5vclNvcnREaXI6IHN0cmluZyA9ICdBU0MnOwoKICAgIC8qKgogICAgICog5o6S5bqP5a2X5q61CiAgICAgKgogICAgICogQHR5cGUge3N0cmluZ30KICAgICAqIEBtZW1iZXJvZiBHV0Nob2ljZUJhc2UKICAgICAqLwogICAgcHVibGljIG1pbm9yU29ydFBTREVGOiBzdHJpbmcgPSAneGgnOwoKICAgIC8qKgogICAgICog5YiG6aG15p2h5pWwCiAgICAgKgogICAgICogQHR5cGUge251bWJlcn0KICAgICAqIEBtZW1iZXJvZiBHV0Nob2ljZUJhc2UKICAgICAqLwogICAgcHVibGljIGxpbWl0OiBudW1iZXIgPSAyMDsKCiAgICAvKioKICAgICAqIOaYr+WQpuaYvuekuuagh+mimAogICAgICoKICAgICAqIEB0eXBlIHtib29sZWFufQogICAgICogQG1lbWJlcm9mIEdXQ2hvaWNlQmFzZQogICAgICovCiAgICBwdWJsaWMgaXNIaWRlSGVhZGVyOiBib29sZWFuID0gZmFsc2U7CgogICAgLyoqCiAgICAgKiDmmK/lkKbpu5jorqTpgInkuK3nrKzkuIDmnaHmlbDmja4KICAgICAqCiAgICAgKiBAdHlwZSB7Ym9vbGVhbn0KICAgICAqIEBtZW1iZXJvZiBHV0Nob2ljZUJhc2UKICAgICAqLwogICAgQFByb3AoeyBkZWZhdWx0OiBmYWxzZSB9KSBwdWJsaWMgaXNTZWxlY3RGaXJzdERlZmF1bHQhOiBib29sZWFuOwoKICAgIC8qKgogICAgICog5piv5ZCm5Y2V6YCJCiAgICAgKgogICAgICogQHR5cGUge2Jvb2xlYW59CiAgICAgKiBAbWVtYmVyb2YgR1dDaG9pY2VCYXNlCiAgICAgKi8KICAgIEBQcm9wKCkgcHVibGljIGlzU2luZ2xlU2VsZWN0PzogYm9vbGVhbjsKCiAgICAvKioKICAgICAqIOmAieS4reaVsOaNruWtl+espuS4sgogICAgICoKICAgICAqIEB0eXBlIHtzdHJpbmd9CiAgICAgKiBAbWVtYmVyb2YgR1dDaG9pY2VCYXNlCiAgICAgKi8KICAgIEBQcm9wKCkgcHVibGljIHNlbGVjdGVkRGF0YT86IHN0cmluZzsKCiAgICAvKioKICAgICAqIOmAieS4reWAvOWPmOWMlgogICAgICoKICAgICAqIEBwYXJhbSB7Kn0gbmV3VmFsCiAgICAgKiBAcGFyYW0geyp9IG9sZFZhbAogICAgICogQG1lbWJlcm9mIEdXQ2hvaWNlQmFzZQogICAgICovCiAgICBAV2F0Y2goJ3NlbGVjdGVkRGF0YScpCiAgICBwdWJsaWMgb25WYWx1ZUNoYW5nZShuZXdWYWw6IGFueSwgb2xkVmFsOiBhbnkpIHsKICAgICAgICB0aGlzLnNlbGVjdGlvbnMgPSBbXTsKICAgICAgICBpZih0aGlzLnNlbGVjdGVkRGF0YSl7CiAgICAgICAgICAgIGNvbnN0IHJlZnM6IGFueSA9IHRoaXMuJHJlZnM7CiAgICAgICAgICAgIGlmIChyZWZzLm11bHRpcGxlVGFibGUpIHsKICAgICAgICAgICAgICAgIHJlZnMubXVsdGlwbGVUYWJsZS5jbGVhclNlbGVjdGlvbigpOwogICAgICAgICAgICAgICAgSlNPTi5wYXJzZSh0aGlzLnNlbGVjdGVkRGF0YSkuZm9yRWFjaCgoc2VsZWN0aW9uOmFueSk9PnsKICAgICAgICAgICAgICAgICAgICBsZXQgc2VsZWN0ZWRJdGVtID0gdGhpcy5pdGVtcy5maW5kKChpdGVtOmFueSk9PnsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIE9iamVjdC5pcyhpdGVtLnNyZmtleSwgc2VsZWN0aW9uLnNyZmtleSk7CiAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgaWYoc2VsZWN0ZWRJdGVtKXsKICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5yb3dDbGljayhzZWxlY3RlZEl0ZW0pOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICog6KGo5qC86KGM5pWw5o2u6buY6K6k5r+A5rS75qih5byPCiAgICAgKiAwIOS4jea/gOa0uwogICAgICogMSDljZXlh7vmv4DmtLsKICAgICAqIDIg5Y+M5Ye75r+A5rS7CiAgICAgKgogICAgICogQHR5cGUgeyhudW1iZXIgfCAwIHwgMSB8IDIpfQogICAgICogQG1lbWJlcm9mIEdXQ2hvaWNlQmFzZQogICAgICovCiAgICBAUHJvcCh7ZGVmYXVsdDogMn0pIHB1YmxpYyBncmlkUm93QWN0aXZlTW9kZSE6IG51bWJlcjsKCiAgICAvKioKICAgICAqIOaYr+WQpuW8gOWQr+ihjOe8lui+kQogICAgICoKICAgICAqIEB0eXBlIHtib29sZWFufQogICAgICogQG1lbWJlcm9mIEdXQ2hvaWNlQmFzZQogICAgICovCiAgICBAUHJvcCh7ZGVmYXVsdDogZmFsc2V9KSBwdWJsaWMgaXNPcGVuRWRpdCE6IGJvb2xlYW47CgogICAgLyoqCiAgICAgKiDlrp7pmYXmmK/lkKblvIDlkK/ooYznvJbovpEKICAgICAqCiAgICAgKiBAdHlwZSB7Ym9vbGVhbn0KICAgICAqIEBtZW1iZXJvZiBHV0Nob2ljZUJhc2UKICAgICAqLwogICAgcHVibGljIGFjdHVhbElzT3BlbkVkaXQ6IGJvb2xlYW4gPSB0aGlzLmlzT3BlbkVkaXQ7CgogICAgLyoqCiAgICAgKiDmgLvmnaHmlbAKICAgICAqCiAgICAgKiBAdHlwZSB7bnVtYmVyfQogICAgICogQG1lbWJlcm9mIEdXQ2hvaWNlQmFzZQogICAgICovCiAgICBwdWJsaWMgdG90YWxyb3c6IG51bWJlciA9IDA7CgogICAgLyoqCiAgICAgKiDpgInkuK3ooYzmlbDmja4KICAgICAqCiAgICAgKiBAdHlwZSB7YW55W119CiAgICAgKiBAbWVtYmVyb2YgTWFpbgogICAgICovCiAgICBwdWJsaWMgc2VsZWN0aW9uczogYW55W10gPSBbXTsKCiAgICAvKioKICAgICAqIOaLpuaIquihjOmAieS4rQogICAgICoKICAgICAqIEB0eXBlIHtib29sZWFufQogICAgICogQG1lbWJlcm9mIE1haW4KICAgICAqLwogICAgcHVibGljIHN0b3BSb3dDbGljazogYm9vbGVhbiA9IGZhbHNlOwoKCgoKICAgIC8qKgogICAgICog6KGo5qC85piv5ZCm5pi+56S6CiAgICAgKgogICAgICogQHR5cGUge2Jvb2xlYW59CiAgICAgKiBAbWVtYmVyb2YgR1dDaG9pY2VCYXNlCiAgICAgKi8KICAgIHB1YmxpYyBpc0Rpc3BsYXk6Ym9vbGVhbiA9IHRydWU7CgogICAgLyoqCiAgICAgKiDpg6jku7bliLfmlrAKICAgICAqCiAgICAgKiBAcGFyYW0ge2FueVtdfSBhcmdzCiAgICAgKiBAbWVtYmVyb2YgR1dDaG9pY2VCYXNlCiAgICAgKi8KICAgIHB1YmxpYyByZWZyZXNoKGFyZ3M6IGFueVtdKTogdm9pZCB7CiAgICAgICAgdGhpcy5sb2FkKCk7CiAgICB9CgogICAgLyoqCiAgICAqIOmAiemhueahhuWIl+WuvQogICAgKgogICAgKiBAdHlwZSB7bnVtYmVyfQogICAgKiBAbWVtYmVyb2YgQXBwSW5kZXgKICAgICovCiAgICBwdWJsaWMgY2hlY2tib3hDb2xXaWR0aDogbnVtYmVyID0gMzQ7CgogICAgLyoqCiAgICAgKiDmmK/lkKblhYHorrjmi5bliqjliJflrr0KICAgICAqCiAgICAgKiBAdHlwZSB7Ym9vbGVhbn0KICAgICAqIEBtZW1iZXJvZiBBcHBFbWJlZFBpY2tlcgogICAgICovCiAgICBwdWJsaWMgaXNEcmFnZW5kQ29sOiBib29sZWFuID0gZmFsc2U7CgogICAgLyoqCiAgICAgKiDmiYDmnInliJfmiJDlkZgKICAgICAqCiAgICAgKiBAdHlwZSB7YW55W119CiAgICAgKiBAbWVtYmVyb2YgR1dDaG9pY2VCYXNlCiAgICAgKi8KICAgIHB1YmxpYyBhbGxDb2x1bW5zOiBhbnlbXSA9IFsKICAgICAgICB7CiAgICAgICAgICAgIG5hbWU6ICd4aCcsCiAgICAgICAgICAgIGxhYmVsOiAn5o6S5bqPJywKICAgICAgICAgICAgbGFuZ3RhZzogJ2VudGl0aWVzLm9ybXBvc3QuZ3djaG9pY2VfZ3JpZC5jb2x1bW5zLnhoJywKICAgICAgICAgICAgc2hvdzogdHJ1ZSwKICAgICAgICAgICAgdXRpbDogJ1BYJwogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICBuYW1lOiAnb3JtcG9zdG5hbWUnLAogICAgICAgICAgICBsYWJlbDogJ+Wyl+S9jeWQjeensCcsCiAgICAgICAgICAgIGxhbmd0YWc6ICdlbnRpdGllcy5vcm1wb3N0Lmd3Y2hvaWNlX2dyaWQuY29sdW1ucy5vcm1wb3N0bmFtZScsCiAgICAgICAgICAgIHNob3c6IHRydWUsCiAgICAgICAgICAgIHV0aWw6ICdQWCcKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgbmFtZTogJ3Bvc3RuYXR1cmUnLAogICAgICAgICAgICBsYWJlbDogJ+Wyl+S9jeaAp+i0qCcsCiAgICAgICAgICAgIGxhbmd0YWc6ICdlbnRpdGllcy5vcm1wb3N0Lmd3Y2hvaWNlX2dyaWQuY29sdW1ucy5wb3N0bmF0dXJlJywKICAgICAgICAgICAgc2hvdzogdHJ1ZSwKICAgICAgICAgICAgdXRpbDogJ1BYJwogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICBuYW1lOiAnY3JlYXRlbWFuJywKICAgICAgICAgICAgbGFiZWw6ICflu7rnq4vkuronLAogICAgICAgICAgICBsYW5ndGFnOiAnZW50aXRpZXMub3JtcG9zdC5nd2Nob2ljZV9ncmlkLmNvbHVtbnMuY3JlYXRlbWFuJywKICAgICAgICAgICAgc2hvdzogdHJ1ZSwKICAgICAgICAgICAgdXRpbDogJ3B4JwogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICBuYW1lOiAnY3JlYXRlZGF0ZScsCiAgICAgICAgICAgIGxhYmVsOiAn5bu656uL5pe26Ze0JywKICAgICAgICAgICAgbGFuZ3RhZzogJ2VudGl0aWVzLm9ybXBvc3QuZ3djaG9pY2VfZ3JpZC5jb2x1bW5zLmNyZWF0ZWRhdGUnLAogICAgICAgICAgICBzaG93OiB0cnVlLAogICAgICAgICAgICB1dGlsOiAnUFgnCiAgICAgICAgfSwKICAgIF0KCiAgICAvKioKICAgICAqIOihqOagvOaooeWei+mbhuWQiAogICAgICoKICAgICAqIEB0eXBlIHsqfQogICAgICogQG1lbWJlcm9mIEdXQ2hvaWNlQmFzZQogICAgICovCiAgICBwdWJsaWMgZ3JpZEl0ZW1zTW9kZWw6IGFueVtdID0gW107CgogICAgLyoqCiAgICAgKiDojrflj5booajmoLzooYzmqKHlnosKICAgICAqCiAgICAgKiBAdHlwZSB7Kn0KICAgICAqIEBtZW1iZXJvZiBHV0Nob2ljZUJhc2UKICAgICAqLwogICAgcHVibGljIGdldEdyaWRSb3dNb2RlbCgpewogICAgICAgIHJldHVybiB7CiAgICAgICAgICB4aDogbmV3IEZvcm1JdGVtTW9kZWwoKSwKICAgICAgICAgIG9ybXBvc3RuYW1lOiBuZXcgRm9ybUl0ZW1Nb2RlbCgpLAogICAgICAgICAgb3Jtb3JnaWQ6IG5ldyBGb3JtSXRlbU1vZGVsKCksCiAgICAgICAgICBzcmZrZXk6IG5ldyBGb3JtSXRlbU1vZGVsKCksCiAgICAgICAgICBvcm1vcmduYW1lOiBuZXcgRm9ybUl0ZW1Nb2RlbCgpLAogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIOWxnuaAp+WAvOinhOWImQogICAgICoKICAgICAqIEB0eXBlIHsqfQogICAgICogQG1lbWJlcm9mIEdXQ2hvaWNlQmFzZQogICAgICovCiAgICBwdWJsaWMgcnVsZXM6IGFueSA9IHsKICAgICAgICB4aDogWwogICAgICAgICAgICAgeyByZXF1aXJlZDogZmFsc2UsIHZhbGlkYXRvcjogKHJ1bGU6YW55LCB2YWx1ZTphbnksIGNhbGxiYWNrOmFueSkgPT4geyByZXR1cm4gKHJ1bGUucmVxdWlyZWQgJiYgKHZhbHVlID09PSBudWxsIHx8IHZhbHVlID09PSB1bmRlZmluZWQgfHwgdmFsdWUgPT09ICIiKSkgPyBmYWxzZSA6IHRydWU7fSwgbWVzc2FnZTogJ+aOkuW6jyDlgLzkuI3og73kuLrnqbonLCB0cmlnZ2VyOiAnY2hhbmdlJyB9LAogICAgICAgICAgICB7IHJlcXVpcmVkOiBmYWxzZSwgdmFsaWRhdG9yOiAocnVsZTphbnksIHZhbHVlOmFueSwgY2FsbGJhY2s6YW55KSA9PiB7IHJldHVybiAocnVsZS5yZXF1aXJlZCAmJiAodmFsdWUgPT09IG51bGwgfHwgdmFsdWUgPT09IHVuZGVmaW5lZCB8fCB2YWx1ZSA9PT0gIiIpKSA/IGZhbHNlIDogdHJ1ZTt9LCBtZXNzYWdlOiAn5o6S5bqPIOWAvOS4jeiDveS4uuepuicsIHRyaWdnZXI6ICdibHVyJyB9LAogICAgICAgIF0sCiAgICAgICAgb3JtcG9zdG5hbWU6IFsKICAgICAgICAgICAgIHsgcmVxdWlyZWQ6IGZhbHNlLCB2YWxpZGF0b3I6IChydWxlOmFueSwgdmFsdWU6YW55LCBjYWxsYmFjazphbnkpID0+IHsgcmV0dXJuIChydWxlLnJlcXVpcmVkICYmICh2YWx1ZSA9PT0gbnVsbCB8fCB2YWx1ZSA9PT0gdW5kZWZpbmVkIHx8IHZhbHVlID09PSAiIikpID8gZmFsc2UgOiB0cnVlO30sIG1lc3NhZ2U6ICflspfkvY3lkI3np7Ag5YC85LiN6IO95Li656m6JywgdHJpZ2dlcjogJ2NoYW5nZScgfSwKICAgICAgICAgICAgeyByZXF1aXJlZDogZmFsc2UsIHZhbGlkYXRvcjogKHJ1bGU6YW55LCB2YWx1ZTphbnksIGNhbGxiYWNrOmFueSkgPT4geyByZXR1cm4gKHJ1bGUucmVxdWlyZWQgJiYgKHZhbHVlID09PSBudWxsIHx8IHZhbHVlID09PSB1bmRlZmluZWQgfHwgdmFsdWUgPT09ICIiKSkgPyBmYWxzZSA6IHRydWU7fSwgbWVzc2FnZTogJ+Wyl+S9jeWQjeensCDlgLzkuI3og73kuLrnqbonLCB0cmlnZ2VyOiAnYmx1cicgfSwKICAgICAgICBdLAogICAgICAgIG9ybW9yZ2lkOiBbCiAgICAgICAgICAgICB7IHJlcXVpcmVkOiBmYWxzZSwgdmFsaWRhdG9yOiAocnVsZTphbnksIHZhbHVlOmFueSwgY2FsbGJhY2s6YW55KSA9PiB7IHJldHVybiAocnVsZS5yZXF1aXJlZCAmJiAodmFsdWUgPT09IG51bGwgfHwgdmFsdWUgPT09IHVuZGVmaW5lZCB8fCB2YWx1ZSA9PT0gIiIpKSA/IGZhbHNlIDogdHJ1ZTt9LCBtZXNzYWdlOiAn5YC85LiN6IO95Li656m6JywgdHJpZ2dlcjogJ2NoYW5nZScgfSwKICAgICAgICAgICAgeyByZXF1aXJlZDogZmFsc2UsIHZhbGlkYXRvcjogKHJ1bGU6YW55LCB2YWx1ZTphbnksIGNhbGxiYWNrOmFueSkgPT4geyByZXR1cm4gKHJ1bGUucmVxdWlyZWQgJiYgKHZhbHVlID09PSBudWxsIHx8IHZhbHVlID09PSB1bmRlZmluZWQgfHwgdmFsdWUgPT09ICIiKSkgPyBmYWxzZSA6IHRydWU7fSwgbWVzc2FnZTogJ+WAvOS4jeiDveS4uuepuicsIHRyaWdnZXI6ICdibHVyJyB9LAogICAgICAgIF0sCiAgICAgICAgc3Jma2V5OiBbCiAgICAgICAgICAgICB7IHJlcXVpcmVkOiBmYWxzZSwgdmFsaWRhdG9yOiAocnVsZTphbnksIHZhbHVlOmFueSwgY2FsbGJhY2s6YW55KSA9PiB7IHJldHVybiAocnVsZS5yZXF1aXJlZCAmJiAodmFsdWUgPT09IG51bGwgfHwgdmFsdWUgPT09IHVuZGVmaW5lZCB8fCB2YWx1ZSA9PT0gIiIpKSA/IGZhbHNlIDogdHJ1ZTt9LCBtZXNzYWdlOiAn5bKX5L2N5qCH6K+GIOWAvOS4jeiDveS4uuepuicsIHRyaWdnZXI6ICdjaGFuZ2UnIH0sCiAgICAgICAgICAgIHsgcmVxdWlyZWQ6IGZhbHNlLCB2YWxpZGF0b3I6IChydWxlOmFueSwgdmFsdWU6YW55LCBjYWxsYmFjazphbnkpID0+IHsgcmV0dXJuIChydWxlLnJlcXVpcmVkICYmICh2YWx1ZSA9PT0gbnVsbCB8fCB2YWx1ZSA9PT0gdW5kZWZpbmVkIHx8IHZhbHVlID09PSAiIikpID8gZmFsc2UgOiB0cnVlO30sIG1lc3NhZ2U6ICflspfkvY3moIfor4Yg5YC85LiN6IO95Li656m6JywgdHJpZ2dlcjogJ2JsdXInIH0sCiAgICAgICAgXSwKICAgICAgICBvcm1vcmduYW1lOiBbCiAgICAgICAgICAgICB7IHJlcXVpcmVkOiBmYWxzZSwgdmFsaWRhdG9yOiAocnVsZTphbnksIHZhbHVlOmFueSwgY2FsbGJhY2s6YW55KSA9PiB7IHJldHVybiAocnVsZS5yZXF1aXJlZCAmJiAodmFsdWUgPT09IG51bGwgfHwgdmFsdWUgPT09IHVuZGVmaW5lZCB8fCB2YWx1ZSA9PT0gIiIpKSA/IGZhbHNlIDogdHJ1ZTt9LCBtZXNzYWdlOiAn57uE57uHIOWAvOS4jeiDveS4uuepuicsIHRyaWdnZXI6ICdjaGFuZ2UnIH0sCiAgICAgICAgICAgIHsgcmVxdWlyZWQ6IGZhbHNlLCB2YWxpZGF0b3I6IChydWxlOmFueSwgdmFsdWU6YW55LCBjYWxsYmFjazphbnkpID0+IHsgcmV0dXJuIChydWxlLnJlcXVpcmVkICYmICh2YWx1ZSA9PT0gbnVsbCB8fCB2YWx1ZSA9PT0gdW5kZWZpbmVkIHx8IHZhbHVlID09PSAiIikpID8gZmFsc2UgOiB0cnVlO30sIG1lc3NhZ2U6ICfnu4Tnu4cg5YC85LiN6IO95Li656m6JywgdHJpZ2dlcjogJ2JsdXInIH0sCiAgICAgICAgXSwKICAgIH0KCiAgICAvKioKICAgICAqIOihqOagvOihjOe8lui+kemhueagoemqjAogICAgICoKICAgICAqIEBwYXJhbSB7c3RyaW5nfSBwcm9wZXJ0eSDlsZ7mgKflkI0KICAgICAqIEBwYXJhbSB7Kn0gZGF0YSDooYzmlbDmja4KICAgICAqIEBwYXJhbSB7bnVtYmVyfSByb3dJbmRleCDooYzntKLlvJUKICAgICAqIEByZXR1cm5zIFByb21pc2U8YW55PgogICAgICogCiAgICAgKiBAbWVtYmVyb2YgR1dDaG9pY2VCYXNlCiAgICAgKi8KICAgIHB1YmxpYyB2YWxpZGF0ZShwcm9wZXJ0eTpzdHJpbmcsIGRhdGE6YW55LCByb3dJbmRleDpudW1iZXIpOlByb21pc2U8YW55PnsKICAgICAgICByZXR1cm4gbmV3IFByb21pc2UoKHJlc29sdmUsIHJlamVjdCkgPT4gewogICAgICAgICAgICB0aGlzLiR1dGlsLnZhbGlkYXRlSXRlbShwcm9wZXJ0eSxkYXRhLHRoaXMucnVsZXMpLnRoZW4oKCk9PnsKICAgICAgICAgICAgICAgIHRoaXMuZ3JpZEl0ZW1zTW9kZWxbcm93SW5kZXhdW3Byb3BlcnR5XS5zZXRFcnJvcihudWxsKTsKICAgICAgICAgICAgICAgIHJlc29sdmUodHJ1ZSk7CiAgICAgICAgICAgIH0pLmNhdGNoKCh7IGVycm9ycywgZmllbGRzIH0pID0+IHsKICAgICAgICAgICAgICAgIHRoaXMuZ3JpZEl0ZW1zTW9kZWxbcm93SW5kZXhdW3Byb3BlcnR5XS5zZXRFcnJvcihlcnJvcnNbMF0ubWVzc2FnZSk7CiAgICAgICAgICAgICAgICByZXNvbHZlKGZhbHNlKTsKICAgICAgICAgICAgfSk7CiAgICAgICAgfSk7CiAgICB9CgogICAgLyoqCiAgICAgKiDmoKHpqozmiYDmnInkv67mlLnov4fnmoTnvJbovpHpobkKICAgICAqCiAgICAgKiBAcmV0dXJucyBQcm9taXNlPGFueT4KICAgICAqIEBtZW1iZXJvZiBHV0Nob2ljZUJhc2UKICAgICAqLwogICAgcHVibGljIGFzeW5jIHZhbGlkYXRlQWxsKCl7CiAgICAgICAgbGV0IHZhbGlkYXRlU3RhdGUgPSB0cnVlOwogICAgICAgIGxldCBpbmRleCA9IC0xOwogICAgICAgIGZvcihsZXQgaXRlbSBvZiB0aGlzLml0ZW1zKXsKICAgICAgICAgIGluZGV4Kys7CiAgICAgICAgICBpZihpdGVtLnJvd0RhdGFTdGF0ZSA9PT0gImNyZWF0ZSIgfHwgaXRlbS5yb3dEYXRhU3RhdGUgPT09ICJ1cGRhdGUiKXsKICAgICAgICAgICAgZm9yKGxldCBwcm9wZXJ0eSBvZiBPYmplY3Qua2V5cyh0aGlzLnJ1bGVzKSl7CiAgICAgICAgICAgICAgaWYoIWF3YWl0IHRoaXMudmFsaWRhdGUocHJvcGVydHksaXRlbSxpbmRleCkpewogICAgICAgICAgICAgICAgdmFsaWRhdGVTdGF0ZSA9IGZhbHNlOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0KICAgICAgICByZXR1cm4gdmFsaWRhdGVTdGF0ZTsKICAgIH0KCiAgICAvKioKICAgICAqIOihqOagvOaVsOaNruWKoOi9vQogICAgICoKICAgICAqIEBwYXJhbSB7Kn0gW2FyZz17fV0KICAgICAqIEBtZW1iZXJvZiBHV0Nob2ljZUJhc2UKICAgICAqLwogICAgcHVibGljIGxvYWQob3B0OiBhbnkgPSB7fSwgcGFnZVJlc2V0OiBib29sZWFuID0gZmFsc2UpOiB2b2lkIHsKICAgICAgICBpZighdGhpcy5mZXRjaEFjdGlvbil7CiAgICAgICAgICAgIHRoaXMuJE5vdGljZS5lcnJvcih7IHRpdGxlOiAn6ZSZ6K+vJywgZGVzYzogJ09STVBPU1RFSk9STU9SR0lEUGlja3VwR3JpZFZpZXfop4blm77ooajmoLxmZXRjaEFjdGlvbuWPguaVsOacqumFjee9ricgfSk7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICB9CiAgICAgICAgaWYocGFnZVJlc2V0KXsKICAgICAgICAgICAgdGhpcy5jdXJQYWdlID0gMTsKICAgICAgICB9CiAgICAgICAgY29uc3QgYXJnOiBhbnkgPSB7Li4ub3B0fTsKICAgICAgICBjb25zdCBwYWdlOiBhbnkgPSB7fTsKICAgICAgICBpZiAodGhpcy5pc0VuYWJsZVBhZ2luZ0JhcikgewogICAgICAgICAgICBPYmplY3QuYXNzaWduKHBhZ2UsIHsgcGFnZTogdGhpcy5jdXJQYWdlLTEsIHNpemU6IHRoaXMubGltaXQgfSk7CiAgICAgICAgfQogICAgICAgIC8vIOiuvue9ruaOkuW6jwogICAgICAgIGlmICghdGhpcy5pc05vU29ydCAmJiAhT2JqZWN0LmlzKHRoaXMubWlub3JTb3J0RGlyLCAnJykgJiYgIU9iamVjdC5pcyh0aGlzLm1pbm9yU29ydFBTREVGLCAnJykpIHsKICAgICAgICAgICAgY29uc3Qgc29ydDogc3RyaW5nID0gdGhpcy5taW5vclNvcnRQU0RFRisiLCIrdGhpcy5taW5vclNvcnREaXI7CiAgICAgICAgICAgIE9iamVjdC5hc3NpZ24ocGFnZSwgeyBzb3J0OiBzb3J0IH0pOwogICAgICAgIH0KICAgICAgICBPYmplY3QuYXNzaWduKGFyZywgcGFnZSk7CiAgICAgICAgY29uc3QgcGFyZW50ZGF0YTogYW55ID0ge307CiAgICAgICAgdGhpcy4kZW1pdCgnYmVmb3JlbG9hZCcsIHBhcmVudGRhdGEpOwogICAgICAgIE9iamVjdC5hc3NpZ24oYXJnLCBwYXJlbnRkYXRhKTsKICAgICAgICBsZXQgdGVtcFZpZXdQYXJhbXM6YW55ID0gcGFyZW50ZGF0YS52aWV3cGFyYW1zP3BhcmVudGRhdGEudmlld3BhcmFtczp7fTsKICAgICAgICBPYmplY3QuYXNzaWduKHRlbXBWaWV3UGFyYW1zLEpTT04ucGFyc2UoSlNPTi5zdHJpbmdpZnkodGhpcy52aWV3cGFyYW1zKSkpOwogICAgICAgIE9iamVjdC5hc3NpZ24oYXJnLHt2aWV3cGFyYW1zOnRlbXBWaWV3UGFyYW1zfSk7CiAgICAgICAgY29uc3QgcG9zdDogUHJvbWlzZTxhbnk+ID0gdGhpcy5zZXJ2aWNlLnNlYXJjaCh0aGlzLmZldGNoQWN0aW9uLEpTT04ucGFyc2UoSlNPTi5zdHJpbmdpZnkodGhpcy5jb250ZXh0KSksIGFyZywgdGhpcy5zaG93QnVzeUluZGljYXRvcik7CiAgICAgICAgcG9zdC50aGVuKChyZXNwb25zZTogYW55KSA9PiB7CiAgICAgICAgICAgIGlmICghcmVzcG9uc2Uuc3RhdHVzIHx8IHJlc3BvbnNlLnN0YXR1cyAhPT0gMjAwKSB7CiAgICAgICAgICAgICAgICBpZiAocmVzcG9uc2UuZXJyb3JNZXNzYWdlKSB7CiAgICAgICAgICAgICAgICAgICAgdGhpcy4kTm90aWNlLmVycm9yKHsgdGl0bGU6ICfplJnor68nLCBkZXNjOiByZXNwb25zZS5lcnJvck1lc3NhZ2UgfSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgIH0KICAgICAgICAgICAgY29uc3QgZGF0YTogYW55ID0gcmVzcG9uc2UuZGF0YTsKICAgICAgICAgICAgdGhpcy50b3RhbHJvdyA9IHJlc3BvbnNlLnRvdGFsOwogICAgICAgICAgICB0aGlzLml0ZW1zID0gSlNPTi5wYXJzZShKU09OLnN0cmluZ2lmeShkYXRhKSk7CiAgICAgICAgICAgIC8vIOa4heepunNlbGVjdGlvbnMsZ3JpZEl0ZW1zTW9kZWwKICAgICAgICAgICAgdGhpcy5zZWxlY3Rpb25zID0gW107CiAgICAgICAgICAgIHRoaXMuZ3JpZEl0ZW1zTW9kZWwgPSBbXTsKICAgICAgICAgICAgdGhpcy5pdGVtcy5mb3JFYWNoKCgpPT57dGhpcy5ncmlkSXRlbXNNb2RlbC5wdXNoKHRoaXMuZ2V0R3JpZFJvd01vZGVsKCkpfSk7CiAgICAgICAgICAgIHRoaXMuJGVtaXQoJ2xvYWQnLCB0aGlzLml0ZW1zKTsKICAgICAgICAgICAgLy8g6K6+572u6buY6K6k6YCJ5LitCiAgICAgICAgICAgIGxldCBfdGhpcyA9IHRoaXM7CiAgICAgICAgICAgIHNldFRpbWVvdXQoKCkgPT4gewogICAgICAgICAgICAgICAgaWYoX3RoaXMuaXNTZWxlY3RGaXJzdERlZmF1bHQpewogICAgICAgICAgICAgICAgICBfdGhpcy5yb3dDbGljayhfdGhpcy5pdGVtc1swXSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBpZihfdGhpcy5zZWxlY3RlZERhdGEpewogICAgICAgICAgICAgICAgICAgIGNvbnN0IHJlZnM6IGFueSA9IF90aGlzLiRyZWZzOwogICAgICAgICAgICAgICAgICAgIGlmIChyZWZzLm11bHRpcGxlVGFibGUpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmVmcy5tdWx0aXBsZVRhYmxlLmNsZWFyU2VsZWN0aW9uKCk7CiAgICAgICAgICAgICAgICAgICAgICAgIEpTT04ucGFyc2UoX3RoaXMuc2VsZWN0ZWREYXRhKS5mb3JFYWNoKChzZWxlY3Rpb246YW55KT0+ewogICAgICAgICAgICAgICAgICAgICAgICAgICAgbGV0IHNlbGVjdGVkSXRlbSA9IF90aGlzLml0ZW1zLmZpbmQoKGl0ZW06YW55KT0+ewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBPYmplY3QuaXMoaXRlbS5zcmZrZXksIHNlbGVjdGlvbi5zcmZrZXkpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZihzZWxlY3RlZEl0ZW0pewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIF90aGlzLnJvd0NsaWNrKHNlbGVjdGVkSXRlbSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSwgMzAwKTsKICAgICAgICB9KS5jYXRjaCgocmVzcG9uc2U6IGFueSkgPT4gewogICAgICAgICAgICBpZiAocmVzcG9uc2UgJiYgcmVzcG9uc2Uuc3RhdHVzID09PSA0MDEpIHsKICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgfQogICAgICAgICAgICB0aGlzLiROb3RpY2UuZXJyb3IoeyB0aXRsZTogJ+mUmeivrycsIGRlc2M6IHJlc3BvbnNlLmVycm9yTWVzc2FnZSB9KTsKICAgICAgICB9KTsKICAgIH0KCiAgICAvKioKICAgICAqIOWIoOmZpAogICAgICoKICAgICAqIEBwYXJhbSB7YW55W119IGRhdGFzCiAgICAgKiBAcmV0dXJucyB7UHJvbWlzZTxhbnk+fQogICAgICogQG1lbWJlcm9mIEdXQ2hvaWNlQmFzZQogICAgICovCiAgICBwdWJsaWMgYXN5bmMgcmVtb3ZlKGRhdGFzOiBhbnlbXSk6IFByb21pc2U8YW55PiB7CiAgICAgICAgaWYoIXRoaXMucmVtb3ZlQWN0aW9uKXsKICAgICAgICAgICAgdGhpcy4kTm90aWNlLmVycm9yKHsgdGl0bGU6ICfplJnor68nLCBkZXNjOiAnT1JNUE9TVEVKT1JNT1JHSURQaWNrdXBHcmlkVmlld+inhuWbvuihqOagvHJlbW92ZUFjdGlvbuWPguaVsOacqumFjee9ricgfSk7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICB9CiAgICAgICAgbGV0IF9kYXRhczphbnlbXSA9IFtdOwogICAgICAgIGRhdGFzLmZvckVhY2goKHJlY29yZDogYW55LCBpbmRleDogbnVtYmVyKSA9PiB7CiAgICAgICAgICAgIGlmIChPYmplY3QuaXMocmVjb3JkLnNyZnVmLCIwIikpIHsKICAgICAgICAgICAgICAgIHRoaXMuaXRlbXMuc29tZSgodmFsOiBhbnksIG51bTogbnVtYmVyKSA9PnsKICAgICAgICAgICAgICAgICAgICBpZihKU09OLnN0cmluZ2lmeSh2YWwpID09IEpTT04uc3RyaW5naWZ5KHJlY29yZCkpewogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLml0ZW1zLnNwbGljZShudW0sMSk7CiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuZ3JpZEl0ZW1zTW9kZWwuc3BsaWNlKG51bSwxKTsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSk7IAogICAgICAgICAgICB9ZWxzZXsKICAgICAgICAgICAgICAgX2RhdGFzLnB1c2goZGF0YXNbaW5kZXhdKTsKICAgICAgICAgICAgfQogICAgICAgIH0pOwogICAgICAgIGlmIChfZGF0YXMubGVuZ3RoID09PSAwKSB7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICB9CiAgICAgICAgbGV0IGRhdGFJbmZvID0gJyc7CiAgICAgICAgX2RhdGFzLmZvckVhY2goKHJlY29yZDogYW55LCBpbmRleDogbnVtYmVyKSA9PiB7CiAgICAgICAgICAgIGxldCBzcmZtYWpvcnRleHQgPSByZWNvcmQub3JtcG9zdG5hbWU7CiAgICAgICAgICAgIGlmIChpbmRleCA8IDUpIHsKICAgICAgICAgICAgICAgIGlmICghT2JqZWN0LmlzKGRhdGFJbmZvLCAnJykpIHsKICAgICAgICAgICAgICAgICAgICBkYXRhSW5mbyArPSAn44CBJzsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGRhdGFJbmZvICs9IHNyZm1ham9ydGV4dDsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICAgICAgfQogICAgICAgIH0pOwoKICAgICAgICBpZiAoX2RhdGFzLmxlbmd0aCA8IDUpIHsKICAgICAgICAgICAgZGF0YUluZm8gPSBkYXRhSW5mbyArICcg5YWxJyArIF9kYXRhcy5sZW5ndGggKyAn5p2h5pWw5o2uJzsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBkYXRhSW5mbyA9IGRhdGFJbmZvICsgJy4uLicgKyAnIOWFsScgKyBfZGF0YXMubGVuZ3RoICsgJ+adoeaVsOaNric7CiAgICAgICAgfQoKICAgICAgICBjb25zdCByZW1vdmVEYXRhID0gKCkgPT4gewogICAgICAgICAgICBsZXQga2V5czogYW55W10gPSBbXTsKICAgICAgICAgICAgX2RhdGFzLmZvckVhY2goKGRhdGE6IGFueSkgPT4gewogICAgICAgICAgICAgICAga2V5cy5wdXNoKGRhdGEuc3Jma2V5KTsKICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIGxldCBfcmVtb3ZlQWN0aW9uID0ga2V5cy5sZW5ndGggPiAxID8gJ3JlbW92ZUJhdGNoJyA6IHRoaXMucmVtb3ZlQWN0aW9uIDsKICAgICAgICAgICAgbGV0IF9rZXlzID0ga2V5cy5sZW5ndGggPiAxID8ga2V5cyA6IGtleXNbMF0gOwogICAgICAgICAgICBjb25zdCBjb250ZXh0OmFueSA9IEpTT04ucGFyc2UoSlNPTi5zdHJpbmdpZnkodGhpcy5jb250ZXh0KSk7CiAgICAgICAgICAgIGNvbnN0IHBvc3Q6IFByb21pc2U8YW55PiA9IHRoaXMuc2VydmljZS5kZWxldGUoX3JlbW92ZUFjdGlvbixPYmplY3QuYXNzaWduKGNvbnRleHQseyBvcm1wb3N0OiBfa2V5cyB9KSxPYmplY3QuYXNzaWduKHsgb3JtcG9zdDogX2tleXMgfSx7dmlld3BhcmFtczp0aGlzLnZpZXdwYXJhbXN9KSwgdGhpcy5zaG93QnVzeUluZGljYXRvcik7CiAgICAgICAgICAgIHJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZTogYW55LCByZWplY3Q6IGFueSkgPT4gewogICAgICAgICAgICAgICAgcG9zdC50aGVuKChyZXNwb25zZTogYW55KSA9PiB7CiAgICAgICAgICAgICAgICAgICAgaWYgKCFyZXNwb25zZSB8fCByZXNwb25zZS5zdGF0dXMgIT09IDIwMCkgewogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLiROb3RpY2UuZXJyb3IoeyB0aXRsZTogJycsIGRlc2M6ICfliKDpmaTmlbDmja7lpLHotKUsJyArIHJlc3BvbnNlLmluZm8gfSk7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLiROb3RpY2Uuc3VjY2Vzcyh7IHRpdGxlOiAnJywgZGVzYzogJ+WIoOmZpOaIkOWKnyEnIH0pOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAvL+WIoOmZpGl0ZW1z5Lit5bey5Yig6Zmk55qE6aG5CiAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2codGhpcy5pdGVtcyk7CiAgICAgICAgICAgICAgICAgICAgX2RhdGFzLmZvckVhY2goKGRhdGE6IGFueSkgPT4gewogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLml0ZW1zLnNvbWUoKGl0ZW06YW55LGluZGV4Om51bWJlcik9PnsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmKE9iamVjdC5pcyhpdGVtLnNyZmtleSxkYXRhLnNyZmtleSkpewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuaXRlbXMuc3BsaWNlKGluZGV4LDEpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuZ3JpZEl0ZW1zTW9kZWwuc3BsaWNlKGluZGV4LDEpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICB0aGlzLnRvdGFscm93IC09IF9kYXRhcy5sZW5ndGg7CiAgICAgICAgICAgICAgICAgICAgdGhpcy4kZW1pdCgncmVtb3ZlJywgbnVsbCk7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5zZWxlY3Rpb25zID0gW107CiAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZShyZXNwb25zZSk7CiAgICAgICAgICAgICAgICB9KS5jYXRjaCgocmVzcG9uc2U6IGFueSkgPT4gewogICAgICAgICAgICAgICAgICAgIGlmIChyZXNwb25zZSAmJiByZXNwb25zZS5zdGF0dXMgPT09IDQwMSkgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGlmICghcmVzcG9uc2UgfHwgIXJlc3BvbnNlLnN0YXR1cyB8fCAhcmVzcG9uc2UuZGF0YSkgewogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLiROb3RpY2UuZXJyb3IoeyB0aXRsZTogJ+mUmeivrycsIGRlc2M6ICfns7vnu5/lvILluLgnIH0pOwogICAgICAgICAgICAgICAgICAgICAgICByZWplY3QocmVzcG9uc2UpOwogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIHJlamVjdChyZXNwb25zZSk7CiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfSk7CiAgICAgICAgfQoKICAgICAgICBkYXRhSW5mbyA9IGRhdGFJbmZvLnJlcGxhY2UoL1tudWxsXS9nLCAnJykucmVwbGFjZSgvW3VuZGVmaW5lZF0vZywgJycpOwogICAgICAgIHRoaXMuJE1vZGFsLmNvbmZpcm0oewogICAgICAgICAgICB0aXRsZTogJ+itpuWRiicsCiAgICAgICAgICAgIGNvbnRlbnQ6ICfnoa7orqTopoHliKDpmaQgJyArIGRhdGFJbmZvICsgJ++8jOWIoOmZpOaTjeS9nOWwhuS4jeWPr+aBouWkje+8nycsCiAgICAgICAgICAgIG9uT2s6ICgpID0+IHsKICAgICAgICAgICAgICAgIHJlbW92ZURhdGEoKTsKICAgICAgICAgICAgfSwKICAgICAgICAgICAgb25DYW5jZWw6ICgpID0+IHsgfQogICAgICAgIH0pOwogICAgICAgIHJldHVybiByZW1vdmVEYXRhOwogICAgfQoKCiAgICAvKioKICAgICAqIOaJuemHj+a3u+WKoAogICAgICoKICAgICAqIEBwYXJhbSB7Kn0gW2FyZz17fV0KICAgICAqIEBtZW1iZXJvZiBHV0Nob2ljZUJhc2UKICAgICAqLwogICAgcHVibGljIGFkZEJhdGNoKGFyZzogYW55ID0ge30pOiB2b2lkIHsKICAgICAgICBpZighdGhpcy5mZXRjaEFjdGlvbil7CiAgICAgICAgICAgIHRoaXMuJE5vdGljZS5lcnJvcih7IHRpdGxlOiAn6ZSZ6K+vJywgZGVzYzogJ09STVBPU1RFSk9STU9SR0lEUGlja3VwR3JpZFZpZXfop4blm77ooajmoLxmZXRjaEFjdGlvbuWPguaVsOacqumFjee9ricgfSk7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICB9CiAgICAgICAgaWYoIWFyZyl7CiAgICAgICAgICAgIGFyZyA9IHt9OwogICAgICAgIH0KICAgICAgICBjb25zb2xlLmVycm9yKCLmibnph4/mt7vliqDmnKrlrp7njrAiKTsKICAgIH0KCiAgICAvKioKICAgICAqIOaVsOaNruWvvOWFpQogICAgICoKICAgICAqIEBwYXJhbSB7Kn0gZGF0YQogICAgICogQG1lbWJlcm9mIEdXQ2hvaWNlQmFzZQogICAgICovCiAgICAgcHVibGljIGltcG9ydEV4Y2VsKGRhdGE6YW55ID17fSk6dm9pZHsKICAgICAgICAvL+WvvOWFpWV4Y2VsCiAgICAgICAgY29uc3QgaW1wb3J0RGF0YU1vZGVsOmFueSA9ewogICAgICAgIH0KICAgICAgICBpZihPYmplY3Qua2V5cyhpbXBvcnREYXRhTW9kZWwpLmxlbmd0aCA9PSAwKXsKICAgICAgICAgICAgdGhpcy4kTm90aWNlLndhcm5pbmcoeyAndGl0bGUnOiAodGhpcy4kdCgiYXBwLnV0aWx2aWV3Lndhcm5pbmciKSBhcyBzdHJpbmcpLCAnZGVzYyc6ICh0aGlzLiR0KCJhcHAudXRpbHZpZXcuaW5mbyIpIGFzIHN0cmluZykgfSk7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICB9CiAgICAgICAgY29uc3QgdmlldzphbnkgPXsKICAgICAgICAgICAgdmlld25hbWU6ICdhcHAtZGF0YS11cGxvYWQnLAogICAgICAgICAgICB0aXRsZTogdGhpcy4kdCgiYXBwLnV0aWx2aWV3LmltcG9ydHZpZXciKSwKICAgICAgICAgICAgd2lkdGg6IDkwMCwKICAgICAgICAgICAgaGVpZ2h0OiA3MDAKICAgICAgICB9CiAgICAgICAgbGV0IGNvbnRhaW5lcjogU3ViamVjdDxhbnk+ID0gdGhpcy4kYXBwbW9kYWwub3Blbk1vZGFsKHZpZXcsIEpTT04ucGFyc2UoSlNPTi5zdHJpbmdpZnkodGhpcy5jb250ZXh0KSksIGltcG9ydERhdGFNb2RlbCk7CiAgICAgICAgY29udGFpbmVyLnN1YnNjcmliZSgocmVzdWx0OiBhbnkpID0+IHsKICAgICAgICAgIGlmKE9iamVjdC5pcyhyZXN1bHQucmV0LCdPSycpKXsKICAgICAgICAgICAgdGhpcy5yZWZyZXNoKHJlc3VsdC5kYXRhcyk7CiAgICAgICAgICB9CiAgICAgIH0pOwogICAgfQoKCiAgICAvKioKICAgICAqIOaVsOaNruWvvOWHugogICAgICoKICAgICAqIEBwYXJhbSB7Kn0gZGF0YQogICAgICogQG1lbWJlcm9mIEdXQ2hvaWNlQmFzZQogICAgICovCiAgICBwdWJsaWMgZXhwb3J0RXhjZWwoZGF0YTogYW55ID0ge30pOiB2b2lkIHsKICAgICAgICAvLyDlr7zlh7pFeGNlbAogICAgICAgIGNvbnN0IGRvRXhwb3J0ID0gYXN5bmMgKF9kYXRhOmFueSkgPT4gewogICAgICAgICAgICBjb25zdCB0SGVhZGVyOiBBcnJheTxhbnk+ID0gW107CiAgICAgICAgICAgIGNvbnN0IGZpbHRlclZhbDogQXJyYXk8YW55PiA9IFtdOwogICAgICAgICAgICB0aGlzLmFsbENvbHVtbnMuZm9yRWFjaCgoaXRlbTogYW55KSA9PiB7CiAgICAgICAgICAgICAgaXRlbS5zaG93ICYmIGl0ZW0ubGFiZWwgPyB0SGVhZGVyLnB1c2godGhpcy4kdChpdGVtLmxhbmd0YWcpKSA6ICIiOwogICAgICAgICAgICAgIGl0ZW0uc2hvdyAmJiBpdGVtLm5hbWUgPyBmaWx0ZXJWYWwucHVzaChpdGVtLm5hbWUpIDogIiI7CiAgICAgICAgICAgIH0pOwogICAgICAgICAgICBjb25zdCBkYXRhID0gYXdhaXQgdGhpcy5mb3JtYXRFeGNlbERhdGEoZmlsdGVyVmFsLCBfZGF0YSk7CiAgICAgICAgICAgIHRoaXMuJGV4cG9ydC5leHBvcnRFeGNlbCgpLnRoZW4oKGV4Y2VsOmFueSk9PnsKICAgICAgICAgICAgICAgIGV4Y2VsLmV4cG9ydF9qc29uX3RvX2V4Y2VsKHsKICAgICAgICAgICAgICAgICAgaGVhZGVyOiB0SGVhZGVyLCAvL+ihqOWktCDlv4XloasKICAgICAgICAgICAgICAgICAgZGF0YSwgLy/lhbfkvZPmlbDmja4g5b+F5aGrCiAgICAgICAgICAgICAgICAgIGZpbGVuYW1lOiAi5bKX5L2N6KGoIiwgLy/pnZ7lv4XloasKICAgICAgICAgICAgICAgICAgYXV0b1dpZHRoOiB0cnVlLCAvL+mdnuW/heWhqwogICAgICAgICAgICAgICAgICBib29rVHlwZTogInhsc3giIC8v6Z2e5b+F5aGrCiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfSk7IAogICAgICAgIH07CiAgICAgICAgY29uc3QgcGFnZTogYW55ID0ge307CiAgICAgICAgLy8g6K6+572ucGFnZe+8jHNpemUKICAgICAgICBpZiAoT2JqZWN0LmlzKGRhdGEudHlwZSwgJ21heFJvd0NvdW50JykpIHsKICAgICAgICAgICAgT2JqZWN0LmFzc2lnbihwYWdlLCB7IHBhZ2U6IDAsIHNpemU6IGRhdGEubWF4Um93Q291bnQgfSk7CiAgICAgICAgfSBlbHNlIGlmIChPYmplY3QuaXMoZGF0YS50eXBlLCAnYWN0aXZhdGVkUGFnZScpKSB7CiAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICBkb0V4cG9ydChKU09OLnBhcnNlKEpTT04uc3RyaW5naWZ5KHRoaXMuaXRlbXMpKSk7CiAgICAgICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7CiAgICAgICAgICAgICAgICBjb25zb2xlLmVycm9yKGVycm9yKTsKICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm47CiAgICAgICAgfQogICAgICAgIC8vIOiuvue9ruaOkuW6jwogICAgICAgIGlmICghdGhpcy5pc05vU29ydCAmJiAhT2JqZWN0LmlzKHRoaXMubWlub3JTb3J0RGlyLCAnJykgJiYgIU9iamVjdC5pcyh0aGlzLm1pbm9yU29ydFBTREVGLCAnJykpIHsKICAgICAgICAgIGNvbnN0IHNvcnQ6IHN0cmluZyA9IHRoaXMubWlub3JTb3J0UFNERUYrIiwiK3RoaXMubWlub3JTb3J0RGlyOwogICAgICAgICAgICBPYmplY3QuYXNzaWduKHBhZ2UsIHsgc29ydDogc29ydCB9KTsKICAgICAgICB9CiAgICAgICAgY29uc3QgYXJnOiBhbnkgPSB7fTsKICAgICAgICBPYmplY3QuYXNzaWduKGFyZywgcGFnZSk7CiAgICAgICAgLy8g6I635Y+WcXVlcnks5pCc57Si6KGo5Y2V77yMdmlld3BhcmFtc+etieeItuaVsOaNrgogICAgICAgIGNvbnN0IHBhcmVudGRhdGE6IGFueSA9IHt9OwogICAgICAgIHRoaXMuJGVtaXQoJ2JlZm9yZWxvYWQnLCBwYXJlbnRkYXRhKTsKICAgICAgICBPYmplY3QuYXNzaWduKGFyZywgcGFyZW50ZGF0YSk7CiAgICAgICAgY29uc3QgcG9zdDogUHJvbWlzZTxhbnk+ID0gdGhpcy5zZXJ2aWNlLnNlYXJjaCh0aGlzLmZldGNoQWN0aW9uLEpTT04ucGFyc2UoSlNPTi5zdHJpbmdpZnkodGhpcy5jb250ZXh0KSksIGFyZywgdGhpcy5zaG93QnVzeUluZGljYXRvcik7CiAgICAgICAgcG9zdC50aGVuKChyZXNwb25zZTogYW55KSA9PiB7CiAgICAgICAgICAgIGlmICghcmVzcG9uc2UgfHwgcmVzcG9uc2Uuc3RhdHVzICE9PSAyMDApIHsKICAgICAgICAgICAgICAgIHRoaXMuJE5vdGljZS5lcnJvcih7IHRpdGxlOiAnJywgZGVzYzogJ+aVsOaNruWvvOWHuuWksei0pSwnICsgcmVzcG9uc2UuaW5mbyB9KTsKICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgfQogICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgZG9FeHBvcnQoSlNPTi5wYXJzZShKU09OLnN0cmluZ2lmeShyZXNwb25zZS5kYXRhKSkpOwogICAgICAgICAgICB9IGNhdGNoIChlcnJvcikgewogICAgICAgICAgICAgICAgY29uc29sZS5lcnJvcihlcnJvcik7CiAgICAgICAgICAgIH0KICAgICAgICB9KS5jYXRjaCgocmVzcG9uc2U6IGFueSkgPT4gewogICAgICAgICAgICBpZiAocmVzcG9uc2UgJiYgcmVzcG9uc2Uuc3RhdHVzID09PSA0MDEpIHsKICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgfQogICAgICAgICAgICB0aGlzLiROb3RpY2UuZXJyb3IoeyB0aXRsZTogJycsIGRlc2M6ICfmlbDmja7lr7zlh7rlpLHotKUnIH0pOwogICAgICAgIH0pOwogICAgfQoKCiAgICAvKioKICAgICAqIOWvvOWHuuaVsOaNruagvOW8j+WMlgogICAgICogCiAgICAgKiBAcGFyYW0geyp9IGZpbHRlclZhbAogICAgICogQHBhcmFtIHsqfSBqc29uRGF0YQogICAgICogQHJldHVybnMge1tdfQogICAgICogQG1lbWJlcm9mIEdXQ2hvaWNlQmFzZQogICAgICovCiAgICBwdWJsaWMgYXN5bmMgZm9ybWF0RXhjZWxEYXRhKGZpbHRlclZhbDphbnksIGpzb25EYXRhOmFueSkgewogICAgICAgIGxldCBjb2RlbGlzdENvbHVtbnM6QXJyYXk8YW55PiA9IFsKICAgICAgICAgIHsKICAgICAgICAgICAgbmFtZTogJ3Bvc3RuYXR1cmUnLAogICAgICAgICAgICBzcmZrZXk6ICdFaHJDb2RlTGlzdDAxOTAnLAogICAgICAgICAgICBjb2RlbGlzdFR5cGUgOiAnU1RBVElDJywKICAgICAgICAgICAgcmVuZGVyTW9kZTogJ290aGVyJywKICAgICAgICAgICAgdGV4dFNlcGFyYXRvcjogJ+OAgScsCiAgICAgICAgICAgIHZhbHVlU2VwYXJhdG9yOiAnLCcsCiAgICAgICAgICB9LAogICAgICAgICAgewogICAgICAgICAgICBuYW1lOiAnY3JlYXRlbWFuJywKICAgICAgICAgICAgc3Jma2V5OiAnRWhyQ29kZUxpc3QwMjQ5JywKICAgICAgICAgICAgY29kZWxpc3RUeXBlIDogJ0RZTkFNSUMnLAogICAgICAgICAgICByZW5kZXJNb2RlOiAnb3RoZXInLAogICAgICAgICAgICB0ZXh0U2VwYXJhdG9yOiAn44CBJywKICAgICAgICAgICAgdmFsdWVTZXBhcmF0b3I6ICcsJywKICAgICAgICAgIH0sCiAgICAgICAgXTsKICAgICAgICBsZXQgX3RoaXMgPSB0aGlzOwogICAgICAgIGZvciAoY29uc3QgY29kZWxpc3Qgb2YgY29kZWxpc3RDb2x1bW5zKSB7CiAgICAgICAgICAvLyDliqjmgIHku6PnoIHooajlpITnkIYKICAgICAgICAgIGlmIChPYmplY3QuaXMoY29kZWxpc3QuY29kZWxpc3RUeXBlLCAiRFlOQU1JQyIpKSB7CiAgICAgICAgICAgICAgbGV0IGl0ZW1zID0gYXdhaXQgX3RoaXMuY29kZUxpc3RTZXJ2aWNlLmdldEl0ZW1zKGNvZGVsaXN0LnNyZmtleSk7CiAgICAgICAgICAgICAganNvbkRhdGEuZm9yRWFjaCgocm93OmFueSk9PnsKICAgICAgICAgICAgICAgICAgcm93W2NvZGVsaXN0Lm5hbWVdID0gX3RoaXMuZ2V0Q29kZWxpc3RWYWx1ZShpdGVtcywgcm93W2NvZGVsaXN0Lm5hbWVdLCBjb2RlbGlzdCk7CiAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAvLyDpnZnmgIHlpITnkIYKICAgICAgICAgIH0gZWxzZSBpZihPYmplY3QuaXMoY29kZWxpc3QuY29kZWxpc3RUeXBlLCAiU1RBVElDIikpewogICAgICAgICAgICAgIGxldCBpdGVtcyA9IGF3YWl0IF90aGlzLiRzdG9yZS5nZXR0ZXJzLmdldENvZGVMaXN0SXRlbXMoY29kZWxpc3Quc3Jma2V5KTsKICAgICAgICAgICAgICBqc29uRGF0YS5mb3JFYWNoKChyb3c6YW55KT0+ewogICAgICAgICAgICAgICAgICByb3dbY29kZWxpc3QubmFtZV0gPSBfdGhpcy5nZXRDb2RlbGlzdFZhbHVlKGl0ZW1zLCByb3dbY29kZWxpc3QubmFtZV0sIGNvZGVsaXN0KTsKICAgICAgICAgICAgICB9KTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgcmV0dXJuIGpzb25EYXRhLm1hcCgodjphbnkpID0+IGZpbHRlclZhbC5tYXAoKGo6YW55KSA9PiB2W2pdKSkKICAgIH0gICAKCgogICAgLyoqCiAgICAgKiDop6PmnpDku6PnoIHooajlkox2bGF1Ze+8jOiuvue9rml0ZW1zCiAgICAgKgogICAgICogQHB1YmxpYwogICAgICogQHBhcmFtIHthbnlbXX0gaXRlbXMg5Luj56CB6KGo5pWw5o2uCiAgICAgKiBAcGFyYW0geyp9IHZhbHVlCiAgICAgKiBAcmV0dXJucyB7Kn0KICAgICAqIEBtZW1iZXJvZiBHV0Nob2ljZUJhc2UKICAgICAqLwogICAgcHVibGljIGdldENvZGVsaXN0VmFsdWUoaXRlbXM6IGFueVtdLCB2YWx1ZTogYW55LCBjb2RlbGlzdDogYW55LCl7CiAgICAgICAgaWYoIXZhbHVlKXsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuJHQoJ2NvZGVsaXN0LicrY29kZWxpc3Quc3Jma2V5KycuZW1wdHknKTsKICAgICAgICB9CiAgICAgICAgaWYgKGl0ZW1zKSB7CiAgICAgICAgICAgIGxldCByZXN1bHQ6YW55ID0gW107CiAgICAgICAgICAgIGlmKE9iamVjdC5pcyhjb2RlbGlzdC5yZW5kZXJNb2RlLCJudW1iZXIiKSl7CiAgICAgICAgICAgICAgICBpdGVtcy5tYXAoKF9pdGVtOiBhbnksIGluZGV4OiBudW1iZXIpPT57CiAgICAgICAgICAgICAgICAgICAgY29uc3QgblZhbHVlID0gcGFyc2VJbnQoKHZhbHVlIGFzIGFueSksIDEwKTsKICAgICAgICAgICAgICAgICAgICBjb25zdCBjb2RldmFsdWUgPSBfaXRlbS52YWx1ZTsKICAgICAgICAgICAgICAgICAgICBpZigocGFyc2VJbnQoY29kZXZhbHVlLCAxMCkgJiBuVmFsdWUpID4gMCl7CiAgICAgICAgICAgICAgICAgICAgICAgIHJlc3VsdC5wdXNoKF9pdGVtKTsKICAgICAgICAgICAgICAgICAgICB9IAogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH0gZWxzZSBpZihPYmplY3QuaXMoY29kZWxpc3QucmVuZGVyTW9kZSwic3RyaW5nIikpewogICAgICAgICAgICAgICAgY29uc3QgYXJyYXlWYWx1ZTogQXJyYXk8YW55PiA9ICh2YWx1ZSBhcyBhbnkpLnNwbGl0KGNvZGVsaXN0LnZhbHVlU2VwYXJhdG9yKTsKICAgICAgICAgICAgICAgIGFycmF5VmFsdWUubWFwKCh2YWx1ZTogYW55LCBpbmRleDogbnVtYmVyKSA9PiB7CiAgICAgICAgICAgICAgICAgICAgcmVzdWx0LnB1c2goW10pOwogICAgICAgICAgICAgICAgICAgIGxldCB2YWx1ZXM6IGFueVtdID0gT2JqZWN0LmlzKHRoaXMuJHV0aWwudHlwZU9mKHZhbHVlKSwgJ251bWJlcicpID8gW3ZhbHVlXSA6IFsuLi4odmFsdWUgYXMgYW55KS5zcGxpdChjb2RlbGlzdC52YWx1ZVNlcGFyYXRvcildOwogICAgICAgICAgICAgICAgICAgIHZhbHVlcy5tYXAoKHZhbDphbnkgLG51bTogbnVtYmVyKT0+ewogICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBpdGVtID0gdGhpcy5nZXRJdGVtKGl0ZW1zLCB2YWwsIGNvZGVsaXN0KTsgCiAgICAgICAgICAgICAgICAgICAgICAgIGlmKGl0ZW0pewogICAgICAgICAgICAgICAgICAgICAgICAgIHJlc3VsdFtpbmRleF0ucHVzaChpdGVtKTsKICAgICAgICAgICAgICAgICAgICAgICAgfSAKICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgbGV0IHZhbHVlczogYW55W10gPSBPYmplY3QuaXModGhpcy4kdXRpbC50eXBlT2YodmFsdWUpLCAnbnVtYmVyJykgPyBbdmFsdWVdIDogWy4uLih2YWx1ZSBhcyBhbnkpLnNwbGl0KGNvZGVsaXN0LnZhbHVlU2VwYXJhdG9yKV07CiAgICAgICAgICAgICAgICB2YWx1ZXMubWFwKCh2YWx1ZTphbnkgLGluZGV4OiBudW1iZXIpPT57CiAgICAgICAgICAgICAgICAgICAgY29uc3QgaXRlbSA9IHRoaXMuZ2V0SXRlbShpdGVtcywgdmFsdWUsIGNvZGVsaXN0KTsgCiAgICAgICAgICAgICAgICAgICAgaWYoaXRlbSl7CiAgICAgICAgICAgICAgICAgICAgICByZXN1bHQucHVzaChpdGVtKTsKICAgICAgICAgICAgICAgICAgICB9IAogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgLy8g6K6+572uaXRlbXMKICAgICAgICAgICAgaWYocmVzdWx0Lmxlbmd0aCAhPSAwKXsKICAgICAgICAgICAgICByZXR1cm4gcmVzdWx0LmpvaW4oY29kZWxpc3QudmFsdWVTZXBhcmF0b3IpOwogICAgICAgICAgICB9ZWxzZXsKICAgICAgICAgICAgICByZXR1cm4gdmFsdWU7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiDojrflj5bku6PnoIHpobkKICAgICAqCiAgICAgKiBAcHVibGljCiAgICAgKiBAcGFyYW0ge2FueVtdfSBpdGVtcwogICAgICogQHBhcmFtIHsqfSB2YWx1ZQogICAgICogQHJldHVybnMgeyp9CiAgICAgKiBAbWVtYmVyb2YgR1dDaG9pY2VCYXNlCiAgICAgKi8KICAgIHB1YmxpYyBnZXRJdGVtKGl0ZW1zOiBhbnlbXSwgdmFsdWU6IGFueSwgY29kZWxpc3Q6IGFueSk6IGFueSB7CiAgICAgICAgY29uc3QgYXJyOiBBcnJheTxhbnk+ID0gaXRlbXMuZmlsdGVyKGl0ZW0gPT4ge3JldHVybiBpdGVtLnZhbHVlID09IHZhbHVlfSk7CiAgICAgICAgaWYgKGFyci5sZW5ndGggIT09IDEpIHsKICAgICAgICAgICAgcmV0dXJuIHVuZGVmaW5lZDsKICAgICAgICB9CiAgICAgICAgaWYoT2JqZWN0LmlzKGNvZGVsaXN0LmNvZGVsaXN0VHlwZSwnU1RBVElDJykpewogICAgICAgICAgICByZXR1cm4gdGhpcy4kdCgnY29kZWxpc3QuJytjb2RlbGlzdC5zcmZrZXkrJy4nK2FyclswXS52YWx1ZSk7CiAgICAgICAgfWVsc2V7CiAgICAgICAgICAgIHJldHVybiBhcnJbMF0udGV4dDsKICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiDnlJ/lkb3lkajmnJ8KICAgICAqCiAgICAgKiBAbWVtYmVyb2YgR1dDaG9pY2VCYXNlCiAgICAgKi8KICAgIHB1YmxpYyBjcmVhdGVkKCk6IHZvaWQgewogICAgICAgIHRoaXMuYWZ0ZXJDcmVhdGVkKCk7CiAgICB9CgogICAgLyoqCiAgICAgKiDmiafooYxjcmVhdGVk5ZCO55qE6YC76L6RCiAgICAgKgogICAgICogIEBtZW1iZXJvZiBHV0Nob2ljZUJhc2UKICAgICAqLyAgICAKICAgIHB1YmxpYyBhZnRlckNyZWF0ZWQoKXsKICAgICAgICB0aGlzLnNldENvbFN0YXRlKCk7CiAgICAgICAgaWYgKHRoaXMudmlld1N0YXRlKSB7CiAgICAgICAgICAgIHRoaXMudmlld1N0YXRlRXZlbnQgPSB0aGlzLnZpZXdTdGF0ZS5zdWJzY3JpYmUoKHsgdGFnLCBhY3Rpb24sIGRhdGEgfSkgPT4gewogICAgICAgICAgICAgICAgaWYgKCFPYmplY3QuaXModGFnLCB0aGlzLm5hbWUpKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgaWYgKE9iamVjdC5pcygnbG9hZCcsIGFjdGlvbikpIHsKICAgICAgICAgICAgICAgICAgICB0aGlzLmxvYWQoZGF0YSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBpZiAoT2JqZWN0LmlzKCdyZW1vdmUnLCBhY3Rpb24pKSB7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5yZW1vdmUoZGF0YSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBpZiAoT2JqZWN0LmlzKCdzYXZlJywgYWN0aW9uKSkgewogICAgICAgICAgICAgICAgICAgIHRoaXMuc2F2ZShkYXRhKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSk7CiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICogdnVlIOeUn+WRveWRqOacnwogICAgICoKICAgICAqIEBtZW1iZXJvZiBHV0Nob2ljZUJhc2UKICAgICAqLwogICAgcHVibGljIGRlc3Ryb3llZCgpIHsKICAgICAgICB0aGlzLmFmdGVyRGVzdHJveSgpOwogICAgfQoKICAgIC8qKgogICAgICog5omn6KGMZGVzdHJveWVk5ZCO55qE6YC76L6RCiAgICAgKgogICAgICogQG1lbWJlcm9mIEdXQ2hvaWNlQmFzZQogICAgICovCiAgICBwdWJsaWMgYWZ0ZXJEZXN0cm95KCkgewogICAgICAgIGlmICh0aGlzLnZpZXdTdGF0ZUV2ZW50KSB7CiAgICAgICAgICAgIHRoaXMudmlld1N0YXRlRXZlbnQudW5zdWJzY3JpYmUoKTsKICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiDojrflj5bpgInkuK3ooYzog6HmlbDmja4KICAgICAqCiAgICAgKiBAcmV0dXJucyB7YW55W119CiAgICAgKiBAbWVtYmVyb2YgR1dDaG9pY2VCYXNlCiAgICAgKi8KICAgIHB1YmxpYyBnZXRTZWxlY3Rpb24oKTogYW55W10gewogICAgICAgIHJldHVybiB0aGlzLnNlbGVjdGlvbnM7CiAgICB9CgogICAgLyoqCiAgICAgKiDooYzlj4zlh7vkuovku7YKICAgICAqCiAgICAgKiBAcGFyYW0geyp9ICRldmVudAogICAgICogQHJldHVybnMge3ZvaWR9CiAgICAgKiBAbWVtYmVyb2YgR1dDaG9pY2VCYXNlCiAgICAgKi8KICAgIHB1YmxpYyByb3dEQkxDbGljaygkZXZlbnQ6IGFueSk6IHZvaWQgewogICAgICAgIGlmICghJGV2ZW50IHx8IHRoaXMuYWN0dWFsSXNPcGVuRWRpdCB8fCBPYmplY3QuaXModGhpcy5ncmlkUm93QWN0aXZlTW9kZSwwKSkgewogICAgICAgICAgICByZXR1cm47CiAgICAgICAgfQogICAgICAgIHRoaXMuc2VsZWN0aW9ucyA9IFtdOwogICAgICAgIHRoaXMuc2VsZWN0aW9ucy5wdXNoKEpTT04ucGFyc2UoSlNPTi5zdHJpbmdpZnkoJGV2ZW50KSkpOwoKICAgICAgICBjb25zdCByZWZzOiBhbnkgPSB0aGlzLiRyZWZzOwogICAgICAgIGlmIChyZWZzLm11bHRpcGxlVGFibGUpIHsKICAgICAgICAgICAgcmVmcy5tdWx0aXBsZVRhYmxlLmNsZWFyU2VsZWN0aW9uKCk7CiAgICAgICAgICAgIHJlZnMubXVsdGlwbGVUYWJsZS50b2dnbGVSb3dTZWxlY3Rpb24oJGV2ZW50KTsKICAgICAgICB9CgogICAgICAgIHRoaXMuJGVtaXQoJ3Jvd2RibGNsaWNrJywgdGhpcy5zZWxlY3Rpb25zKTsKICAgICAgICB0aGlzLiRlbWl0KCdzZWxlY3Rpb25jaGFuZ2UnLCB0aGlzLnNlbGVjdGlvbnMpOwogICAgfQoKICAgIC8qKgogICAgICog5aSN6YCJ5qGG5pWw5o2u6YCJ5LitCiAgICAgKgogICAgICogQHBhcmFtIHsqfSAkZXZlbnQKICAgICAqIEByZXR1cm5zIHt2b2lkfQogICAgICogQG1lbWJlcm9mIEdXQ2hvaWNlQmFzZQogICAgICovCiAgICBwdWJsaWMgc2VsZWN0KCRldmVudDogYW55KTogdm9pZCB7CiAgICAgICAgaWYgKCEkZXZlbnQpIHsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KICAgICAgICB0aGlzLnNlbGVjdGlvbnMgPSBbXTsKICAgICAgICB0aGlzLnNlbGVjdGlvbnMgPSBbLi4uSlNPTi5wYXJzZShKU09OLnN0cmluZ2lmeSgkZXZlbnQpKV07CiAgICAgICAgdGhpcy4kZW1pdCgnc2VsZWN0aW9uY2hhbmdlJywgdGhpcy5zZWxlY3Rpb25zKTsKICAgIH0KCiAgICAvKioKICAgICAqIOWkjemAieahhuaVsOaNruWFqOmDqOmAieS4rQogICAgICoKICAgICAqIEBwYXJhbSB7Kn0gJGV2ZW50CiAgICAgKiBAbWVtYmVyb2YgR1dDaG9pY2VCYXNlCiAgICAgKi8KICAgIHB1YmxpYyBzZWxlY3RBbGwoJGV2ZW50OiBhbnkpOiB2b2lkIHsKICAgICAgICBpZiAoISRldmVudCkgewogICAgICAgICAgICByZXR1cm47CiAgICAgICAgfQogICAgICAgIHRoaXMuc2VsZWN0aW9ucyA9IFtdOwogICAgICAgIHRoaXMuc2VsZWN0aW9ucyA9IFsuLi5KU09OLnBhcnNlKEpTT04uc3RyaW5naWZ5KCRldmVudCkpXTsKICAgICAgICB0aGlzLiRlbWl0KCdzZWxlY3Rpb25jaGFuZ2UnLCB0aGlzLnNlbGVjdGlvbnMpOwogICAgfQoKICAgIAogICAgLyoqCiAgICAgKiDooYzljZXlh7vpgInkuK0KICAgICAqCiAgICAgKiBAcGFyYW0geyp9ICRldmVudAogICAgICogQHJldHVybnMge3ZvaWR9CiAgICAgKiBAbWVtYmVyb2YgR1dDaG9pY2VCYXNlCiAgICAgKi8KICAgIHB1YmxpYyByb3dDbGljaygkZXZlbnQ6IGFueSwgaWZBbHdheXM6IGJvb2xlYW4gPSBmYWxzZSk6IHZvaWQgewogICAgICAgIGlmICghaWZBbHdheXMgJiYgKCEkZXZlbnQgfHwgdGhpcy5hY3R1YWxJc09wZW5FZGl0KSkgewogICAgICAgICAgICByZXR1cm47CiAgICAgICAgfQogICAgICAgIGlmKHRoaXMuc3RvcFJvd0NsaWNrKSB7CiAgICAgICAgICAgIHRoaXMuc3RvcFJvd0NsaWNrID0gZmFsc2U7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICB9CiAgICAgICAgaWYodGhpcy5pc1NpbmdsZVNlbGVjdCl7CiAgICAgICAgICAgIHRoaXMuc2VsZWN0aW9ucyA9IFtdOwogICAgICAgIH0KICAgICAgICAvLyDlt7LpgInkuK3liJnliKDpmaTvvIzmsqHpgInkuK3liJnmt7vliqAKICAgICAgICBsZXQgc2VsZWN0SW5kZXggPSB0aGlzLnNlbGVjdGlvbnMuZmluZEluZGV4KChpdGVtOmFueSk9PnsKICAgICAgICAgICAgcmV0dXJuIE9iamVjdC5pcyhpdGVtLm9ybXBvc3QsJGV2ZW50Lm9ybXBvc3QpOwogICAgICAgIH0pOwogICAgICAgIGlmIChPYmplY3QuaXMoc2VsZWN0SW5kZXgsLTEpKXsKICAgICAgICAgIHRoaXMuc2VsZWN0aW9ucy5wdXNoKEpTT04ucGFyc2UoSlNPTi5zdHJpbmdpZnkoJGV2ZW50KSkpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICB0aGlzLnNlbGVjdGlvbnMuc3BsaWNlKHNlbGVjdEluZGV4LDEpOwogICAgICAgIH0KCiAgICAgICAgY29uc3QgcmVmczogYW55ID0gdGhpcy4kcmVmczsKICAgICAgICBpZiAocmVmcy5tdWx0aXBsZVRhYmxlKSB7CiAgICAgICAgICAgIGlmKHRoaXMuaXNTaW5nbGVTZWxlY3QpewogICAgICAgICAgICAgICAgcmVmcy5tdWx0aXBsZVRhYmxlLmNsZWFyU2VsZWN0aW9uKCk7CiAgICAgICAgICAgICAgICByZWZzLm11bHRpcGxlVGFibGUuc2V0Q3VycmVudFJvdygkZXZlbnQpOwogICAgICAgICAgICB9ZWxzZXsKICAgICAgICAgICAgICAgIHJlZnMubXVsdGlwbGVUYWJsZS50b2dnbGVSb3dTZWxlY3Rpb24oJGV2ZW50KTsgCiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIHRoaXMuJGVtaXQoJ3NlbGVjdGlvbmNoYW5nZScsIHRoaXMuc2VsZWN0aW9ucyk7CiAgICB9CgoKICAgIC8qKgogICAgICog6aG16Z2i5Y+Y5YyWCiAgICAgKgogICAgICogQHBhcmFtIHsqfSAkZXZlbnQKICAgICAqIEByZXR1cm5zIHt2b2lkfQogICAgICogQG1lbWJlcm9mIEdXQ2hvaWNlQmFzZQogICAgICovCiAgICBwdWJsaWMgcGFnZU9uQ2hhbmdlKCRldmVudDogYW55KTogdm9pZCB7CiAgICAgICAgaWYgKCEkZXZlbnQpIHsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KICAgICAgICBpZiAoJGV2ZW50ID09PSB0aGlzLmN1clBhZ2UpIHsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KICAgICAgICB0aGlzLmN1clBhZ2UgPSAkZXZlbnQ7CiAgICAgICAgdGhpcy5sb2FkKHt9KTsKICAgIH0KCiAgICAvKioKICAgICAqIOWIhumhteadoeaVsOWPmOWMlgogICAgICoKICAgICAqIEBwYXJhbSB7Kn0gJGV2ZW50CiAgICAgKiBAcmV0dXJucyB7dm9pZH0KICAgICAqIEBtZW1iZXJvZiBHV0Nob2ljZUJhc2UKICAgICAqLwogICAgcHVibGljIG9uUGFnZVNpemVDaGFuZ2UoJGV2ZW50OiBhbnkpOiB2b2lkIHsKICAgICAgICBpZiAoISRldmVudCkgewogICAgICAgICAgICByZXR1cm47CiAgICAgICAgfQogICAgICAgIGlmICgkZXZlbnQgPT09IHRoaXMubGltaXQpIHsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KICAgICAgICB0aGlzLmxpbWl0ID0gJGV2ZW50OwogICAgICAgIGlmICh0aGlzLmN1clBhZ2UgPT09IDEpIHsKICAgICAgICAgICAgdGhpcy5sb2FkKHt9KTsKICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiDliIbpobXliLfmlrAKICAgICAqCiAgICAgKiBAbWVtYmVyb2YgR1dDaG9pY2VCYXNlCiAgICAgKi8KICAgIHB1YmxpYyBwYWdlUmVmcmVzaCgpOiB2b2lkIHsKICAgICAgICB0aGlzLmxvYWQoe30pOwogICAgfQoKICAgIC8qKgogICAgICog5o6S5bqP5Y+Y5YyWCiAgICAgKgogICAgICogQHBhcmFtIHt7IGNvbHVtbjogYW55LCBwcm9wOiBhbnksIG9yZGVyOiBhbnkgfX0geyBjb2x1bW4sIHByb3AsIG9yZGVyIH0KICAgICAqIEBtZW1iZXJvZiBHV0Nob2ljZUJhc2UKICAgICAqLwogICAgcHVibGljIG9uU29ydENoYW5nZSh7IGNvbHVtbiwgcHJvcCwgb3JkZXIgfTogeyBjb2x1bW46IGFueSwgcHJvcDogYW55LCBvcmRlcjogYW55IH0pOiB2b2lkIHsKICAgICAgICBjb25zdCBkaXIgPSBPYmplY3QuaXMob3JkZXIsICdhc2NlbmRpbmcnKSA/ICdhc2MnIDogT2JqZWN0LmlzKG9yZGVyLCAnZGVzY2VuZGluZycpID8gJ2Rlc2MnIDogJyc7CiAgICAgICAgaWYgKE9iamVjdC5pcyhkaXIsIHRoaXMubWlub3JTb3J0RGlyKSAmJiBPYmplY3QuaXModGhpcy5taW5vclNvcnRQU0RFRiwgcHJvcCkpIHsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KICAgICAgICB0aGlzLm1pbm9yU29ydERpciA9IGRpcjsKICAgICAgICB0aGlzLm1pbm9yU29ydFBTREVGID0gcHJvcCA/IHByb3AgOiAnJzsKICAgICAgICB0aGlzLmxvYWQoe30pOwogICAgfQoKICAgIC8qKgogICAgICog6KGo5qC86KGM6YCJ5Lit5qC35byPCiAgICAgKgogICAgICogQHBhcmFtIHt7IHJvdzogYW55LCByb3dJbmRleDogYW55IH19IHsgcm93LCByb3dJbmRleCB9CiAgICAgKiBAcmV0dXJucyB7c3RyaW5nfQogICAgICogQG1lbWJlcm9mIEdXQ2hvaWNlQmFzZQogICAgICovCiAgICBwdWJsaWMgb25Sb3dDbGFzc05hbWUoeyByb3csIHJvd0luZGV4IH06IHsgcm93OiBhbnksIHJvd0luZGV4OiBhbnkgfSk6IHN0cmluZyB7CiAgICAgICAgY29uc3QgaW5kZXggPSB0aGlzLnNlbGVjdGlvbnMuZmluZEluZGV4KChzZWxlY3Q6IGFueSkgPT4gT2JqZWN0LmlzKHNlbGVjdC5zcmZrZXksIHJvdy5zcmZrZXkpKTsKICAgICAgICByZXR1cm4gaW5kZXggIT09IC0xID8gJ2dyaWQtcm93LXNlbGVjdCcgOiAnJzsKICAgIH0KCgoKICAgIC8qKgogICAgICog55WM6Z2i6KGM5Li6CiAgICAgKgogICAgICogQHBhcmFtIHsqfSByb3cKICAgICAqIEBwYXJhbSB7Kn0gdGFnCiAgICAgKiBAcGFyYW0geyp9ICRldmVudAogICAgICogQG1lbWJlcm9mIEdXQ2hvaWNlQmFzZQogICAgICovCglwdWJsaWMgdWlBY3Rpb24ocm93OiBhbnksIHRhZzogYW55LCAkZXZlbnQ6IGFueSkgewogICAgICAgIC8vIHRoaXMucm93Q2xpY2socm93LCB0cnVlKTsKICAgICAgICAkZXZlbnQuc3RvcFByb3BhZ2F0aW9uKCk7CiAgICB9CgogICAgLyoqCiAgICAgKiDorr7nva7liJfnirbmgIEKICAgICAqCiAgICAgKiBAbWVtYmVyb2YgR1dDaG9pY2VCYXNlCiAgICAgKi8KICAgIHB1YmxpYyBzZXRDb2xTdGF0ZSgpIHsKCQljb25zdCBfZGF0YTogYW55ID0gbG9jYWxTdG9yYWdlLmdldEl0ZW0oJ29ybXBvc3RfZ3djaG9pY2VfZ3JpZCcpOwoJCWlmIChfZGF0YSkgewoJCQlsZXQgY29sdW1ucyA9IEpTT04ucGFyc2UoX2RhdGEpOwoJCQljb2x1bW5zLmZvckVhY2goKGNvbDogYW55KSA9PiB7CgkJCQlsZXQgY29sdW1uID0gdGhpcy5hbGxDb2x1bW5zLmZpbmQoKGl0ZW0pID0+IE9iamVjdC5pcyhjb2wubmFtZSwgaXRlbS5uYW1lKSk7CgkJCQlpZiAoY29sdW1uKSB7CgkJCQkJT2JqZWN0LmFzc2lnbihjb2x1bW4sIGNvbCk7CgkJCQl9CgkJCX0pOwoJCX0KICAgIH0KCiAgICAvKioKICAgICAqIOWIl+WPmOWMlgogICAgICoKICAgICAqIEBtZW1iZXJvZiBHV0Nob2ljZUJhc2UKICAgICAqLwogICAgcHVibGljIG9uQ29sQ2hhbmdlKCkgewogICAgICAgIGxvY2FsU3RvcmFnZS5zZXRJdGVtKCdvcm1wb3N0X2d3Y2hvaWNlX2dyaWQnLCBKU09OLnN0cmluZ2lmeSh0aGlzLmFsbENvbHVtbnMpKTsKICAgIH0KCiAgICAvKioKICAgICAqIOiOt+WPluWIl+eKtuaAgQogICAgICoKICAgICAqIEBwYXJhbSB7c3RyaW5nfSBuYW1lCiAgICAgKiBAcmV0dXJucyB7Ym9vbGVhbn0KICAgICAqIEBtZW1iZXJvZiBHV0Nob2ljZUJhc2UKICAgICAqLwogICAgcHVibGljIGdldENvbHVtblN0YXRlKG5hbWU6IHN0cmluZyk6IGJvb2xlYW4gewogICAgICAgIGxldCBjb2x1bW4gPSB0aGlzLmFsbENvbHVtbnMuZmluZCgoY29sOiBhbnkpID0+CiAgICAgICAgICAgIE9iamVjdC5pcyhuYW1lLCBjb2wubmFtZSkKICAgICAgICApOwogICAgICAgIHJldHVybiBjb2x1bW4uc2hvdyA/IHRydWUgOiBmYWxzZTsKICAgIH0KCiAgICAvKioKICAgICAqIOihqOagvOWIl+aYr+WQpuiHqumAguW6lOW4g+WxgAogICAgICoKICAgICAqIEByZWFkb25seQogICAgICogQHR5cGUge2Jvb2xlYW59CiAgICAgKiBAbWVtYmVyb2YgR1dDaG9pY2VCYXNlCiAgICAgKi8KICAgIGdldCBhZGFwdGl2ZVN0YXRlKCk6IGJvb2xlYW4gewogICAgICAgIHJldHVybiAhdGhpcy5hbGxDb2x1bW5zLmZpbmQoKGNvbHVtbjogYW55KSA9PiBjb2x1bW4uc2hvdyAmJiBPYmplY3QuaXMoY29sdW1uLnV0aWwsICdTVEFSJykpOwogICAgfQoKICAgIC8qKgogICAgICog5L+d5a2YCiAgICAgKgogICAgICogQHBhcmFtIHsqfSAkZXZlbnQKICAgICAqIEByZXR1cm5zIHtQcm9taXNlPGFueT59CiAgICAgKiBAbWVtYmVyb2YgR1dDaG9pY2VCYXNlCiAgICAgKi8KICAgIHB1YmxpYyBhc3luYyBzYXZlKGFyZ3M6IGFueVtdLCBwYXJhbXM/OiBhbnksICRldmVudD86IGFueSwgeERhdGE/OiBhbnkpewogICAgICAgIGxldCBfdGhpcyA9IHRoaXM7CiAgICAgICAgaWYoIWF3YWl0IHRoaXMudmFsaWRhdGVBbGwoKSl7CiAgICAgICAgICAgIHRoaXMuJE5vdGljZS5lcnJvcih7IHRpdGxlOiAn6ZSZ6K+vJywgZGVzYzogJ+WAvOinhOWImeagoemqjOW8guW4uCcgfSk7CiAgICAgICAgICAgIHJldHVybiBbXTsKICAgICAgICB9CiAgICAgICAgbGV0IHN1Y2Nlc3NJdGVtczphbnkgPSBbXTsKICAgICAgICBsZXQgZXJyb3JJdGVtczphbnkgPSBbXTsKICAgICAgICBsZXQgZXJyb3JNZXNzYWdlOmFueSA9IFtdOwogICAgICAgIGZvciAoY29uc3QgaXRlbSBvZiBfdGhpcy5pdGVtcykgewogICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgaWYoT2JqZWN0LmlzKGl0ZW0ucm93RGF0YVN0YXRlLCAnY3JlYXRlJykpewogICAgICAgICAgICAgICAgICAgIGlmKCF0aGlzLmNyZWF0ZUFjdGlvbil7CiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuJE5vdGljZS5lcnJvcih7IHRpdGxlOiAn6ZSZ6K+vJywgZGVzYzogJ09STVBPU1RFSk9STU9SR0lEUGlja3VwR3JpZFZpZXfop4blm77ooajmoLxjcmVhdGVBY3Rpb27lj4LmlbDmnKrphY3nva4nIH0pOwogICAgICAgICAgICAgICAgICAgIH1lbHNlewogICAgICAgICAgICAgICAgICAgICAgT2JqZWN0LmFzc2lnbihpdGVtLHt2aWV3cGFyYW1zOnRoaXMudmlld3BhcmFtc30pOwogICAgICAgICAgICAgICAgICAgICAgbGV0IHJlc3BvbnNlID0gYXdhaXQgdGhpcy5zZXJ2aWNlLmFkZCh0aGlzLmNyZWF0ZUFjdGlvbiwgSlNPTi5wYXJzZShKU09OLnN0cmluZ2lmeSh0aGlzLmNvbnRleHQpKSxpdGVtLCB0aGlzLnNob3dCdXN5SW5kaWNhdG9yKTsKICAgICAgICAgICAgICAgICAgICAgIHN1Y2Nlc3NJdGVtcy5wdXNoKEpTT04ucGFyc2UoSlNPTi5zdHJpbmdpZnkocmVzcG9uc2UuZGF0YSkpKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9ZWxzZSBpZihPYmplY3QuaXMoaXRlbS5yb3dEYXRhU3RhdGUsICd1cGRhdGUnKSl7CiAgICAgICAgICAgICAgICAgICAgaWYoIXRoaXMudXBkYXRlQWN0aW9uKXsKICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy4kTm90aWNlLmVycm9yKHsgdGl0bGU6ICfplJnor68nLCBkZXNjOiAnT1JNUE9TVEVKT1JNT1JHSURQaWNrdXBHcmlkVmlld+inhuWbvuihqOagvHVwZGF0ZUFjdGlvbuWPguaVsOacqumFjee9ricgfSk7CiAgICAgICAgICAgICAgICAgICAgfWVsc2V7CiAgICAgICAgICAgICAgICAgICAgICAgIE9iamVjdC5hc3NpZ24oaXRlbSx7dmlld3BhcmFtczp0aGlzLnZpZXdwYXJhbXN9KTsKICAgICAgICAgICAgICAgICAgICAgICAgaWYoaXRlbS5vcm1wb3N0KXsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIE9iamVjdC5hc3NpZ24odGhpcy5jb250ZXh0LHtvcm1wb3N0Oml0ZW0ub3JtcG9zdH0pOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIGxldCByZXNwb25zZSA9IGF3YWl0IHRoaXMuc2VydmljZS5hZGQodGhpcy51cGRhdGVBY3Rpb24sSlNPTi5wYXJzZShKU09OLnN0cmluZ2lmeSh0aGlzLmNvbnRleHQpKSxpdGVtLCB0aGlzLnNob3dCdXN5SW5kaWNhdG9yKTsKICAgICAgICAgICAgICAgICAgICAgICAgc3VjY2Vzc0l0ZW1zLnB1c2goSlNPTi5wYXJzZShKU09OLnN0cmluZ2lmeShyZXNwb25zZS5kYXRhKSkpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSBjYXRjaCAoZXJyb3IpIHsKICAgICAgICAgICAgICAgIGVycm9ySXRlbXMucHVzaChKU09OLnBhcnNlKEpTT04uc3RyaW5naWZ5KGl0ZW0pKSk7CiAgICAgICAgICAgICAgICBlcnJvck1lc3NhZ2UucHVzaChlcnJvcik7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgdGhpcy4kZW1pdCgnc2F2ZScsIHN1Y2Nlc3NJdGVtcyk7CiAgICAgICAgdGhpcy5yZWZyZXNoKFtdKTsKICAgICAgICBpZihlcnJvckl0ZW1zLmxlbmd0aCA9PT0gMCl7CiAgICAgICAgICAgIHRoaXMuJE5vdGljZS5zdWNjZXNzKHsgdGl0bGU6ICcnLCBkZXNjOiAn5L+d5a2Y5oiQ5YqfIScgfSk7CiAgICAgICAgfWVsc2V7CiAgICAgICAgICBlcnJvckl0ZW1zLmZvckVhY2goKGl0ZW06YW55LGluZGV4Om51bWJlcik9PnsKICAgICAgICAgICAgdGhpcy4kTm90aWNlLmVycm9yKHsgdGl0bGU6ICfkv53lrZjlpLHotKUnLCBkZXNjOiBpdGVtLm1ham9yZW50aXR5bmFtZSsn5L+d5a2Y5aSx6LSl77yBJyB9KTsKICAgICAgICAgICAgY29uc29sZS5lcnJvcihlcnJvck1lc3NhZ2VbaW5kZXhdKTsKICAgICAgICAgIH0pOwogICAgICAgIH0KICAgICAgICByZXR1cm4gc3VjY2Vzc0l0ZW1zOwogICAgfQoKICAgIC8qKgogICAgICog5paw5bu66KGMCiAgICAgKgogICAgICogQHBhcmFtIHsqfSAkZXZlbnQKICAgICAqIEByZXR1cm5zIHt2b2lkfQogICAgICogQG1lbWJlcm9mIEdXQ2hvaWNlQmFzZQogICAgICovCiAgICBwdWJsaWMgbmV3Um93KGFyZ3M6IGFueVtdLCBwYXJhbXM/OiBhbnksICRldmVudD86IGFueSwgeERhdGE/OiBhbnkpOiB2b2lkIHsKICAgICAgICBpZighdGhpcy5sb2FkZHJhZnRBY3Rpb24pewogICAgICAgICAgICB0aGlzLiROb3RpY2UuZXJyb3IoeyB0aXRsZTogJ+mUmeivrycsIGRlc2M6ICdPUk1QT1NURUpPUk1PUkdJRFBpY2t1cEdyaWRWaWV36KeG5Zu+6KGo5qC8bG9hZGRyYWZ0QWN0aW9u5Y+C5pWw5pyq6YWN572uJyB9KTsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KICAgICAgICBsZXQgX3RoaXMgPSB0aGlzOwogICAgICAgIE9iamVjdC5hc3NpZ24oYXJnc1swXSx7dmlld3BhcmFtczp0aGlzLnZpZXdwYXJhbXN9KTsKICAgICAgICBsZXQgcG9zdDogUHJvbWlzZTxhbnk+ID0gdGhpcy5zZXJ2aWNlLmxvYWREcmFmdCh0aGlzLmxvYWRkcmFmdEFjdGlvbiwgSlNPTi5wYXJzZShKU09OLnN0cmluZ2lmeSh0aGlzLmNvbnRleHQpKSwgYXJnc1swXSwgdGhpcy5zaG93QnVzeUluZGljYXRvcik7CiAgICAgICAgcG9zdC50aGVuKChyZXNwb25zZTogYW55KSA9PiB7CiAgICAgICAgICAgIGlmICghcmVzcG9uc2Uuc3RhdHVzIHx8IHJlc3BvbnNlLnN0YXR1cyAhPT0gMjAwKSB7CiAgICAgICAgICAgICAgICBpZiAocmVzcG9uc2UuZXJyb3JNZXNzYWdlKSB7CiAgICAgICAgICAgICAgICAgICAgdGhpcy4kTm90aWNlLmVycm9yKHsgdGl0bGU6ICfplJnor68nLCBkZXNjOiByZXNwb25zZS5lcnJvck1lc3NhZ2UgfSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgIH0KICAgICAgICAgICAgY29uc3QgZGF0YSA9IHJlc3BvbnNlLmRhdGE7CiAgICAgICAgICAgIHRoaXMuY3JlYXRlRGVmYXVsdChkYXRhKTsKICAgICAgICAgICAgZGF0YS5yb3dEYXRhU3RhdGUgPSAiY3JlYXRlIjsKICAgICAgICAgICAgX3RoaXMuaXRlbXMucHVzaChkYXRhKTsKICAgICAgICAgICAgX3RoaXMuZ3JpZEl0ZW1zTW9kZWwucHVzaChfdGhpcy5nZXRHcmlkUm93TW9kZWwoKSk7CiAgICAgICAgfSkuY2F0Y2goKHJlc3BvbnNlOiBhbnkpID0+IHsKICAgICAgICAgICAgaWYgKHJlc3BvbnNlICYmIHJlc3BvbnNlLnN0YXR1cyA9PT0gNDAxKSB7CiAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKCFyZXNwb25zZSB8fCAhcmVzcG9uc2Uuc3RhdHVzIHx8ICFyZXNwb25zZS5kYXRhKSB7CiAgICAgICAgICAgICAgICB0aGlzLiROb3RpY2UuZXJyb3IoeyB0aXRsZTogJ+mUmeivrycsIGRlc2M6ICfns7vnu5/lvILluLgnIH0pOwogICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICB9CiAgICAgICAgfSk7CiAgICB9CgogICAgLyoqCiAgICAgKiDooajmoLznvJbovpHpobnlgLzlj5jmm7QKICAgICAqICAKICAgICAqIEBwYXJhbSByb3cg6KGM5pWw5o2uCiAgICAgKiBAcGFyYW0ge3sgbmFtZTogc3RyaW5nLCB2YWx1ZTogYW55IH19ICRldmVudAogICAgICogQHJldHVybnMge3ZvaWR9CiAgICAgKiBAbWVtYmVyb2YgR1dDaG9pY2VCYXNlCiAgICAgKi8KICAgIHB1YmxpYyBvbkdyaWRJdGVtVmFsdWVDaGFuZ2Uocm93OiBhbnksJGV2ZW50OiB7IG5hbWU6IHN0cmluZywgdmFsdWU6IGFueSB9LHJvd0luZGV4OiBudW1iZXIpOiB2b2lkIHsKICAgICAgICBpZiAoISRldmVudCkgewogICAgICAgICAgICByZXR1cm47CiAgICAgICAgfQogICAgICAgIGlmICghJGV2ZW50Lm5hbWUgfHwgT2JqZWN0LmlzKCRldmVudC5uYW1lLCAnJykgfHwgIXJvdy5oYXNPd25Qcm9wZXJ0eSgkZXZlbnQubmFtZSkpIHsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KICAgICAgICByb3dbJGV2ZW50Lm5hbWVdID0gJGV2ZW50LnZhbHVlOwogICAgICAgIHRoaXMuZ3JpZEVkaXRJdGVtQ2hhbmdlKHJvdywgJGV2ZW50Lm5hbWUsICRldmVudC52YWx1ZSwgcm93SW5kZXgpOwogICAgfQoKICAgIC8qKgogICAgICog6KGo5qC857yW6L6R6aG55YC85Y+Y5YyWCiAgICAgKgogICAgICogQHB1YmxpYwogICAgICogQHBhcmFtIHJvdyDooYzmlbDmja4KICAgICAqIEBwYXJhbSBwcm9wZXJ0eSDliJfnvJbovpHpobnlkI0KICAgICAqIEBwYXJhbSByb3cg5YiX57yW6L6R6aG55YC8CiAgICAgKiBAcmV0dXJucyB7dm9pZH0KICAgICAqIEBtZW1iZXJvZiBHV0Nob2ljZUJhc2UKICAgICAqLwogICAgcHVibGljIGdyaWRFZGl0SXRlbUNoYW5nZShyb3c6IGFueSwgcHJvcGVydHk6IHN0cmluZywgdmFsdWU6IGFueSwgcm93SW5kZXg6IG51bWJlcil7CiAgICAgICAgcm93LnJvd0RhdGFTdGF0ZSA9IHJvdy5yb3dEYXRhU3RhdGUgPyByb3cucm93RGF0YVN0YXRlIDogInVwZGF0ZSIgOwogICAgICAgIHRoaXMudmFsaWRhdGUocHJvcGVydHkscm93LHJvd0luZGV4KTsKICAgIH0KCiAgICAvKioKICAgICAqIOihqOagvOe8lui+kemhueabtOaWsAogICAgICoKICAgICAqIEBwYXJhbSB7c3RyaW5nfSBtb2RlIOeVjOmdouihjOS4uuWQjeensAogICAgICogQHBhcmFtIHsqfSBbZGF0YT17fV0g6K+35rGC5pWw5o2uCiAgICAgKiBAcGFyYW0ge3N0cmluZ1tdfSB1cGRhdGVEZXRhaWxzIOabtOaWsOmhuQogICAgICogQHBhcmFtIHtib29sZWFufSBbc2hvd2xvYWRpbmddIOaYr+WQpuaYvuekuuWKoOi9veeKtuaAgQogICAgICogQHJldHVybnMge3ZvaWR9CiAgICAgKiBAbWVtYmVyb2YgR1dDaG9pY2VCYXNlCiAgICAgKi8KICAgIHB1YmxpYyB1cGRhdGVHcmlkRWRpdEl0ZW0obW9kZTogc3RyaW5nLCBkYXRhOiBhbnkgPSB7fSwgdXBkYXRlRGV0YWlsczogc3RyaW5nW10sIHNob3dsb2FkaW5nPzogYm9vbGVhbik6IHZvaWQgewogICAgICAgIGlmICghbW9kZSB8fCAobW9kZSAmJiBPYmplY3QuaXMobW9kZSwgJycpKSkgewogICAgICAgICAgICByZXR1cm47CiAgICAgICAgfQogICAgICAgIGNvbnN0IGFyZzogYW55ID0gSlNPTi5wYXJzZShKU09OLnN0cmluZ2lmeShkYXRhKSk7CiAgICAgICAgT2JqZWN0LmFzc2lnbihhcmcse3ZpZXdwYXJhbXM6dGhpcy52aWV3cGFyYW1zfSk7CiAgICAgICAgY29uc3QgcG9zdDogUHJvbWlzZTxhbnk+ID0gdGhpcy5zZXJ2aWNlLmZyb250TG9naWMobW9kZSxKU09OLnBhcnNlKEpTT04uc3RyaW5naWZ5KHRoaXMuY29udGV4dCkpLGFyZywgc2hvd2xvYWRpbmcpOwogICAgICAgIHBvc3QudGhlbigocmVzcG9uc2U6IGFueSkgPT4gewogICAgICAgICAgICBpZiAoIXJlc3BvbnNlIHx8IHJlc3BvbnNlLnN0YXR1cyAhPT0gMjAwKSB7CiAgICAgICAgICAgICAgICB0aGlzLiROb3RpY2UuZXJyb3IoeyB0aXRsZTogJ+mUmeivrycsIGRlc2M6ICfooajljZXpobnmm7TmlrDlpLHotKUnIH0pOwogICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGNvbnN0IF9kYXRhOiBhbnkgPSByZXNwb25zZS5kYXRhOwogICAgICAgICAgICBpZighX2RhdGEpewogICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHVwZGF0ZURldGFpbHMuZm9yRWFjaCgobmFtZTogc3RyaW5nKSA9PiB7CiAgICAgICAgICAgICAgICBpZiAoIV9kYXRhLmhhc093blByb3BlcnR5KG5hbWUpKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgZGF0YVtuYW1lXSA9IF9kYXRhW25hbWVdOwogICAgICAgICAgICB9KTsKICAgICAgICB9KS5jYXRjaCgocmVzcG9uc2U6IGFueSkgPT4gewogICAgICAgICAgICBpZiAocmVzcG9uc2UgJiYgcmVzcG9uc2Uuc3RhdHVzID09PSA0MDEpIHsKICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAoIXJlc3BvbnNlIHx8ICFyZXNwb25zZS5zdGF0dXMgfHwgIXJlc3BvbnNlLmRhdGEpIHsKICAgICAgICAgICAgICAgIHRoaXMuJE5vdGljZS5lcnJvcih7IHRpdGxlOiAn6ZSZ6K+vJywgZGVzYzogJ+ezu+e7n+W8guW4uCcgfSk7CiAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgIH0KICAgICAgICB9KTsKICAgIH0KCiAgICAvKioKICAgICAqIOiOt+WPluWvueW6lOihjGNsYXNzCiAgICAgKgogICAgICogQHBhcmFtIHsqfSAkYXJncyByb3cg6KGM5pWw5o2u77yMcm93SW5kZXgg6KGM57Si5byVCiAgICAgKiBAcmV0dXJucyB7dm9pZH0KICAgICAqIEBtZW1iZXJvZiBHV0Nob2ljZUJhc2UKICAgICAqLwogICAgcHVibGljIGdldFJvd0NsYXNzTmFtZShhcmdzOntyb3c6IGFueSxyb3dJbmRleDogbnVtYmVyfSl7CiAgICAgICAgbGV0IGlzU2VsZWN0ZWQgPSB0aGlzLnNlbGVjdGlvbnMuc29tZSgoaXRlbTphbnkpPT57CiAgICAgICAgICAgIHJldHVybiBPYmplY3QuaXMoaXRlbS5vcm1wb3N0LGFyZ3Mucm93Lm9ybXBvc3QpOwogICAgICAgIH0pOwogICAgICAgIHJldHVybiBpc1NlbGVjdGVkID8gImdyaWQtc2VsZWN0ZWQtcm93IiA6ICIiOwogICAgfQoKICAgIC8qKgogICAgICog6I635Y+W5a+55bqU5YiXY2xhc3MKICAgICAqCiAgICAgKiBAcGFyYW0geyp9ICRhcmdzIHJvdyDooYzmlbDmja7vvIxjb2x1bW4g5YiX5pWw5o2u77yMcm93SW5kZXgg6KGM57Si5byV77yM5YiX57Si5byVCiAgICAgKiBAcmV0dXJucyB7dm9pZH0KICAgICAqIEBtZW1iZXJvZiBHV0Nob2ljZUJhc2UKICAgICAqLwogICAgcHVibGljIGdldENlbGxDbGFzc05hbWUoYXJnczp7cm93OiBhbnksIGNvbHVtbjogYW55LCByb3dJbmRleDogbnVtYmVyLCBjb2x1bW5JbmRleDpudW1iZXJ9KXsKICAgICAgICBsZXQgaGFzUm93RWRpdDphbnkgPSB7CiAgICAgICAgICAneGgnOmZhbHNlLAogICAgICAgICAgJ29ybXBvc3RuYW1lJzpmYWxzZSwKICAgICAgICAgICdwb3N0bmF0dXJlJzpmYWxzZSwKICAgICAgICAgICdjcmVhdGVtYW4nOmZhbHNlLAogICAgICAgICAgJ2NyZWF0ZWRhdGUnOmZhbHNlLAogICAgICAgIH0KICAgICAgICByZXR1cm4gKCBoYXNSb3dFZGl0W2FyZ3MuY29sdW1uLnByb3BlcnR5XSAmJiB0aGlzLmFjdHVhbElzT3BlbkVkaXQgKSA/ICJlZGl0LWNlbGwiIDogImluZm8tY2VsbCI7CiAgICB9CgogICAgLyoqCiAgICAgKiDmlrDlu7rpu5jorqTlgLwKICAgICAqIEBwYXJhbSB7Kn0gIHJvdyDooYzmlbDmja4KICAgICAqIEBtZW1iZXJvZiBHV0Nob2ljZUJhc2UKICAgICAqLwogICAgcHVibGljIGNyZWF0ZURlZmF1bHQocm93OiBhbnkpeyAgICAgICAgICAgICAgICAgICAgCiAgICB9Cn0K"},null]}
{"remainingRequest":"F:\\crod项目\\人事管理系统2\\iBizEHR\\app_EHRPim\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!F:\\crod项目\\人事管理系统2\\iBizEHR\\app_EHRPim\\src\\widgets\\pim-person\\txlxyg-grid\\txlxyg-grid-base.vue?vue&type=script&lang=tsx&","dependencies":[{"path":"F:\\crod项目\\人事管理系统2\\iBizEHR\\app_EHRPim\\src\\widgets\\pim-person\\txlxyg-grid\\txlxyg-grid-base.vue","mtime":1630509411992},{"path":"F:\\crod项目\\人事管理系统2\\iBizEHR\\app_EHRPim\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1630511852775},{"path":"F:\\crod项目\\人事管理系统2\\iBizEHR\\app_EHRPim\\node_modules\\thread-loader\\dist\\cjs.js","mtime":1630511853252},{"path":"F:\\crod项目\\人事管理系统2\\iBizEHR\\app_EHRPim\\node_modules\\babel-loader\\lib\\index.js","mtime":1630511852747},{"path":"F:\\crod项目\\人事管理系统2\\iBizEHR\\app_EHRPim\\node_modules\\ts-loader\\index.js","mtime":1630511985412},{"path":"F:\\crod项目\\人事管理系统2\\iBizEHR\\app_EHRPim\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1630511852775},{"path":"F:\\crod项目\\人事管理系统2\\iBizEHR\\app_EHRPim\\node_modules\\vue-loader\\lib\\index.js","mtime":1630512070338}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:CgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgppbXBvcnQgeyBWdWUsIENvbXBvbmVudCwgUHJvcCwgUHJvdmlkZSwgRW1pdCwgV2F0Y2gsIE1vZGVsLEluamVjdCB9IGZyb20gJ3Z1ZS1wcm9wZXJ0eS1kZWNvcmF0b3InOwppbXBvcnQgeyBDcmVhdGVFbGVtZW50IH0gZnJvbSAndnVlJzsKaW1wb3J0IHsgU3ViamVjdCwgU3Vic2NyaXB0aW9uIH0gZnJvbSAncnhqcyc7CmltcG9ydCB7IENvbnRyb2xJbnRlcmZhY2UgfSBmcm9tICdAL2ludGVyZmFjZS9jb250cm9sJzsKaW1wb3J0IHsgVUlBY3Rpb25Ub29sLFV0aWwgfSBmcm9tICdAL3V0aWxzJzsKaW1wb3J0IE5hdkRhdGFTZXJ2aWNlIGZyb20gJ0Avc2VydmljZS9hcHAvbmF2ZGF0YS1zZXJ2aWNlJzsKaW1wb3J0IFBpbVBlcnNvblNlcnZpY2UgZnJvbSAnQC9zZXJ2aWNlL3BpbS1wZXJzb24vcGltLXBlcnNvbi1zZXJ2aWNlJzsKaW1wb3J0IFRYTFhZR1NlcnZpY2UgZnJvbSAnLi90eGx4eWctZ3JpZC1zZXJ2aWNlJzsKCmltcG9ydCBDb2RlTGlzdFNlcnZpY2UgZnJvbSAiQHNlcnZpY2UvYXBwL2NvZGVsaXN0LXNlcnZpY2UiOwppbXBvcnQgeyBGb3JtSXRlbU1vZGVsIH0gZnJvbSAnQC9tb2RlbC9mb3JtLWRldGFpbCc7CgoKQENvbXBvbmVudCh7CiAgICBjb21wb25lbnRzOiB7CiAgICAgIAogICAgfQp9KQpleHBvcnQgZGVmYXVsdCBjbGFzcyBUWExYWUdCYXNlIGV4dGVuZHMgVnVlIGltcGxlbWVudHMgQ29udHJvbEludGVyZmFjZSB7CgogICAgLyoqCiAgICAgKiDlkI3np7AKICAgICAqCiAgICAgKiBAdHlwZSB7c3RyaW5nfQogICAgICogQG1lbWJlcm9mIFRYTFhZR0Jhc2UKICAgICAqLwogICAgQFByb3AoKSBwdWJsaWMgbmFtZT86IHN0cmluZzsKCiAgICAvKioKICAgICAqIOinhuWbvumAmuiur+WvueixoQogICAgICoKICAgICAqIEB0eXBlIHtTdWJqZWN0PFZpZXdTdGF0ZT59CiAgICAgKiBAbWVtYmVyb2YgVFhMWFlHQmFzZQogICAgICovCiAgICBAUHJvcCgpIHB1YmxpYyB2aWV3U3RhdGUhOiBTdWJqZWN0PFZpZXdTdGF0ZT47CgogICAgLyoqCiAgICAgKiDlupTnlKjkuIrkuIvmlocKICAgICAqCiAgICAgKiBAdHlwZSB7Kn0KICAgICAqIEBtZW1iZXJvZiBUWExYWUdCYXNlCiAgICAgKi8KICAgIEBQcm9wKCkgcHVibGljIGNvbnRleHQ6IGFueTsKCiAgICAvKioKICAgICAqIOinhuWbvuWPguaVsAogICAgICoKICAgICAqIEB0eXBlIHsqfQogICAgICogQG1lbWJlcm9mIFRYTFhZR0Jhc2UKICAgICAqLwogICAgQFByb3AoKSBwdWJsaWMgdmlld3BhcmFtczogYW55OwoKICAgIC8qKgogICAgICog6KeG5Zu+54q25oCB5LqL5Lu2CiAgICAgKgogICAgICogQHB1YmxpYwogICAgICogQHR5cGUgeyhTdWJzY3JpcHRpb24gfCB1bmRlZmluZWQpfQogICAgICogQG1lbWJlcm9mIFRYTFhZR0Jhc2UKICAgICAqLwogICAgcHVibGljIHZpZXdTdGF0ZUV2ZW50OiBTdWJzY3JpcHRpb24gfCB1bmRlZmluZWQ7CgogICAgLyoqCiAgICAgKiDojrflj5bpg6jku7bnsbvlnosKICAgICAqCiAgICAgKiBAcmV0dXJucyB7c3RyaW5nfQogICAgICogQG1lbWJlcm9mIFRYTFhZR0Jhc2UKICAgICAqLwogICAgcHVibGljIGdldENvbnRyb2xUeXBlKCk6IHN0cmluZyB7CiAgICAgICAgcmV0dXJuICdHUklEJwogICAgfQoKCgogICAgLyoqCiAgICAgKiDorqHmlbDlmajmnI3liqHlr7nosaHpm4blkIgKICAgICAqCiAgICAgKiBAdHlwZSB7QXJyYXk8Kj59CiAgICAgKiBAbWVtYmVyb2YgVFhMWFlHQmFzZQogICAgICovICAgIAogICAgcHVibGljIGNvdW50ZXJTZXJ2aWNlQXJyYXk6QXJyYXk8YW55PiA9IFtdOwoKICAgIC8qKgogICAgICog5bu65p6E6YOo5Lu25pyN5Yqh5a+56LGhCiAgICAgKgogICAgICogQHR5cGUge1RYTFhZR1NlcnZpY2V9CiAgICAgKiBAbWVtYmVyb2YgVFhMWFlHQmFzZQogICAgICovCiAgICBwdWJsaWMgc2VydmljZTogVFhMWFlHU2VydmljZSA9IG5ldyBUWExYWUdTZXJ2aWNlKHsgJHN0b3JlOiB0aGlzLiRzdG9yZSB9KTsKCiAgICAvKioKICAgICAqIOWunuS9k+acjeWKoeWvueixoQogICAgICoKICAgICAqIEB0eXBlIHtQaW1QZXJzb25TZXJ2aWNlfQogICAgICogQG1lbWJlcm9mIFRYTFhZR0Jhc2UKICAgICAqLwogICAgcHVibGljIGFwcEVudGl0eVNlcnZpY2U6IFBpbVBlcnNvblNlcnZpY2UgPSBuZXcgUGltUGVyc29uU2VydmljZSh7ICRzdG9yZTogdGhpcy4kc3RvcmUgfSk7CiAgICAKCgogICAgLyoqCiAgICAgKiDlhbPpl63op4blm74KICAgICAqCiAgICAgKiBAcGFyYW0ge2FueX0gYXJncwogICAgICogQG1lbWJlcm9mIFRYTFhZR0Jhc2UKICAgICAqLwogICAgcHVibGljIGNsb3NlVmlldyhhcmdzOiBhbnkpOiB2b2lkIHsKICAgICAgICBsZXQgX3RoaXM6IGFueSA9IHRoaXM7CiAgICAgICAgX3RoaXMuJGVtaXQoJ2Nsb3NldmlldycsIFthcmdzXSk7CiAgICB9CgogICAgLyoqCiAgICAgKiAg6K6h5pWw5Zmo5Yi35pawCiAgICAgKgogICAgICogQG1lbWJlcm9mIFRYTFhZR0Jhc2UKICAgICAqLwogICAgcHVibGljIGNvdW50ZXJSZWZyZXNoKCl7CiAgICAgICAgY29uc3QgX3RoaXM6YW55ID10aGlzOwogICAgICAgIGlmKF90aGlzLmNvdW50ZXJTZXJ2aWNlQXJyYXkgJiYgX3RoaXMuY291bnRlclNlcnZpY2VBcnJheS5sZW5ndGggPjApewogICAgICAgICAgICBfdGhpcy5jb3VudGVyU2VydmljZUFycmF5LmZvckVhY2goKGl0ZW06YW55KSA9PnsKICAgICAgICAgICAgICAgIGlmKGl0ZW0ucmVmcmVzaERhdGEgJiYgaXRlbS5yZWZyZXNoRGF0YSBpbnN0YW5jZW9mIEZ1bmN0aW9uKXsKICAgICAgICAgICAgICAgICAgICBpdGVtLnJlZnJlc2hEYXRhKCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0pCiAgICAgICAgfQogICAgfQoKCiAgICAvKioKICAgICAqIOS7o+eggeihqOacjeWKoeWvueixoQogICAgICoKICAgICAqIEB0eXBlIHtDb2RlTGlzdFNlcnZpY2V9CiAgICAgKiBAbWVtYmVyb2YgVFhMWFlHQmFzZQogICAgICovICAKICAgIHB1YmxpYyBjb2RlTGlzdFNlcnZpY2U6Q29kZUxpc3RTZXJ2aWNlID0gbmV3IENvZGVMaXN0U2VydmljZSh7ICRzdG9yZTogdGhpcy4kc3RvcmUgfSk7CgogICAgLyoqCiAgICAgKiDojrflj5blpJrpobnmlbDmja4KICAgICAqCiAgICAgKiBAcmV0dXJucyB7YW55W119CiAgICAgKiBAbWVtYmVyb2YgVFhMWFlHQmFzZQogICAgICovCiAgICBwdWJsaWMgZ2V0RGF0YXMoKTogYW55W10gewogICAgICAgIHJldHVybiB0aGlzLnNlbGVjdGlvbnM7CiAgICB9CgogICAgLyoqCiAgICAgKiDojrflj5bljZXpobnmoJEKICAgICAqCiAgICAgKiBAcmV0dXJucyB7Kn0KICAgICAqIEBtZW1iZXJvZiBUWExYWUdCYXNlCiAgICAgKi8KICAgIHB1YmxpYyBnZXREYXRhKCk6IGFueSB7CiAgICAgICAgcmV0dXJuIHRoaXMuc2VsZWN0aW9uc1swXTsKICAgIH0KCiAgICAvKioKICAgICAqIOaJk+W8gOaWsOW7uuaVsOaNruinhuWbvgogICAgICoKICAgICAqIEB0eXBlIHthbnl9CiAgICAgKiBAbWVtYmVyb2YgVFhMWFlHQmFzZQogICAgICovCiAgICBAUHJvcCgpIHB1YmxpYyBuZXdkYXRhOiBhbnk7CiAgICAvKioKICAgICAqIOaJk+W8gOe8lui+keaVsOaNruinhuWbvgogICAgICoKICAgICAqIEB0eXBlIHthbnl9CiAgICAgKiBAbWVtYmVyb2YgVFhMWFlHQmFzZQogICAgICovCiAgICBAUHJvcCgpIHB1YmxpYyBvcGVuZGF0YTogYW55OwoKICAgIC8qKgogICAgICog5pi+56S65aSE55CG5o+Q56S6CiAgICAgKgogICAgICogQHR5cGUge2Jvb2xlYW59CiAgICAgKiBAbWVtYmVyb2YgVFhMWFlHQmFzZQogICAgICovCiAgICBAUHJvcCh7IGRlZmF1bHQ6IHRydWUgfSkgcHVibGljIHNob3dCdXN5SW5kaWNhdG9yPzogYm9vbGVhbjsKCiAgICAvKioKICAgICAqIOmDqOS7tuihjOS4ui0tdXBkYXRlCiAgICAgKgogICAgICogQHR5cGUge3N0cmluZ30KICAgICAqIEBtZW1iZXJvZiBUWExYWUdCYXNlCiAgICAgKi8KICAgIEBQcm9wKCkgcHVibGljIHVwZGF0ZUFjdGlvbiE6IHN0cmluZzsKICAgIAogICAgLyoqCiAgICAgKiDpg6jku7booYzkuLotLWZldGNoCiAgICAgKgogICAgICogQHR5cGUge3N0cmluZ30KICAgICAqIEBtZW1iZXJvZiBUWExYWUdCYXNlCiAgICAgKi8KICAgIEBQcm9wKCkgcHVibGljIGZldGNoQWN0aW9uITogc3RyaW5nOwogICAgCiAgICAvKioKICAgICAqIOmDqOS7tuihjOS4ui0tcmVtb3ZlCiAgICAgKgogICAgICogQHR5cGUge3N0cmluZ30KICAgICAqIEBtZW1iZXJvZiBUWExYWUdCYXNlCiAgICAgKi8KICAgIEBQcm9wKCkgcHVibGljIHJlbW92ZUFjdGlvbiE6IHN0cmluZzsKICAgIAogICAgLyoqCiAgICAgKiDpg6jku7booYzkuLotLWxvYWQKICAgICAqCiAgICAgKiBAdHlwZSB7c3RyaW5nfQogICAgICogQG1lbWJlcm9mIFRYTFhZR0Jhc2UKICAgICAqLwogICAgQFByb3AoKSBwdWJsaWMgbG9hZEFjdGlvbiE6IHN0cmluZzsKICAgIAogICAgLyoqCiAgICAgKiDpg6jku7booYzkuLotLWxvYWRkcmFmdAogICAgICoKICAgICAqIEB0eXBlIHtzdHJpbmd9CiAgICAgKiBAbWVtYmVyb2YgVFhMWFlHQmFzZQogICAgICovCiAgICBAUHJvcCgpIHB1YmxpYyBsb2FkZHJhZnRBY3Rpb24hOiBzdHJpbmc7CiAgICAKICAgIC8qKgogICAgICog6YOo5Lu26KGM5Li6LS1jcmVhdGUKICAgICAqCiAgICAgKiBAdHlwZSB7c3RyaW5nfQogICAgICogQG1lbWJlcm9mIFRYTFhZR0Jhc2UKICAgICAqLwogICAgQFByb3AoKSBwdWJsaWMgY3JlYXRlQWN0aW9uITogc3RyaW5nOwoKICAgIC8qKgogICAgICog5b2T5YmN6aG1CiAgICAgKgogICAgICogQHR5cGUge251bWJlcn0KICAgICAqIEBtZW1iZXJvZiBUWExYWUdCYXNlCiAgICAgKi8KICAgIHB1YmxpYyBjdXJQYWdlOiBudW1iZXIgPSAxOwoKICAgIC8qKgogICAgICog5pWw5o2uCiAgICAgKgogICAgICogQHR5cGUge2FueVtdfQogICAgICogQG1lbWJlcm9mIFRYTFhZR0Jhc2UKICAgICAqLwogICAgcHVibGljIGl0ZW1zOiBhbnlbXSA9IFtdOwoKICAgIC8qKgogICAgICog5piv5ZCm5pSv5oyB5YiG6aG1CiAgICAgKgogICAgICogQHR5cGUge2Jvb2xlYW59CiAgICAgKiBAbWVtYmVyb2YgVFhMWFlHQmFzZQogICAgICovCiAgICBwdWJsaWMgaXNFbmFibGVQYWdpbmdCYXI6IGJvb2xlYW4gPSB0cnVlOwoKICAgIC8qKgogICAgICog5piv5ZCm56aB55So5o6S5bqPCiAgICAgKgogICAgICogQHR5cGUge2Jvb2xlYW59CiAgICAgKiBAbWVtYmVyb2YgVFhMWFlHQmFzZQogICAgICovCiAgICBwdWJsaWMgaXNOb1NvcnQ6IGJvb2xlYW4gPSBmYWxzZTsKCiAgICAvKioKICAgICAqIOaOkuW6j+aWueWQkQogICAgICoKICAgICAqIEB0eXBlIHtzdHJpbmd9CiAgICAgKiBAbWVtYmVyb2YgVFhMWFlHQmFzZQogICAgICovCiAgICBwdWJsaWMgbWlub3JTb3J0RGlyOiBzdHJpbmcgPSAnREVTQyc7CgogICAgLyoqCiAgICAgKiDmjpLluo/lrZfmrrUKICAgICAqCiAgICAgKiBAdHlwZSB7c3RyaW5nfQogICAgICogQG1lbWJlcm9mIFRYTFhZR0Jhc2UKICAgICAqLwogICAgcHVibGljIG1pbm9yU29ydFBTREVGOiBzdHJpbmcgPSAndHhkcSc7CgogICAgLyoqCiAgICAgKiDliIbpobXmnaHmlbAKICAgICAqCiAgICAgKiBAdHlwZSB7bnVtYmVyfQogICAgICogQG1lbWJlcm9mIFRYTFhZR0Jhc2UKICAgICAqLwogICAgcHVibGljIGxpbWl0OiBudW1iZXIgPSAxMDA7CgogICAgLyoqCiAgICAgKiDmmK/lkKbmmL7npLrmoIfpopgKICAgICAqCiAgICAgKiBAdHlwZSB7Ym9vbGVhbn0KICAgICAqIEBtZW1iZXJvZiBUWExYWUdCYXNlCiAgICAgKi8KICAgIHB1YmxpYyBpc0hpZGVIZWFkZXI6IGJvb2xlYW4gPSBmYWxzZTsKCiAgICAvKioKICAgICAqIOaYr+WQpum7mOiupOmAieS4reesrOS4gOadoeaVsOaNrgogICAgICoKICAgICAqIEB0eXBlIHtib29sZWFufQogICAgICogQG1lbWJlcm9mIFRYTFhZR0Jhc2UKICAgICAqLwogICAgQFByb3AoeyBkZWZhdWx0OiBmYWxzZSB9KSBwdWJsaWMgaXNTZWxlY3RGaXJzdERlZmF1bHQhOiBib29sZWFuOwoKICAgIC8qKgogICAgICog5piv5ZCm5Y2V6YCJCiAgICAgKgogICAgICogQHR5cGUge2Jvb2xlYW59CiAgICAgKiBAbWVtYmVyb2YgVFhMWFlHQmFzZQogICAgICovCiAgICBAUHJvcCgpIHB1YmxpYyBpc1NpbmdsZVNlbGVjdD86IGJvb2xlYW47CgogICAgLyoqCiAgICAgKiDpgInkuK3mlbDmja7lrZfnrKbkuLIKICAgICAqCiAgICAgKiBAdHlwZSB7c3RyaW5nfQogICAgICogQG1lbWJlcm9mIFRYTFhZR0Jhc2UKICAgICAqLwogICAgQFByb3AoKSBwdWJsaWMgc2VsZWN0ZWREYXRhPzogc3RyaW5nOwoKICAgIC8qKgogICAgICog6YCJ5Lit5YC85Y+Y5YyWCiAgICAgKgogICAgICogQHBhcmFtIHsqfSBuZXdWYWwKICAgICAqIEBwYXJhbSB7Kn0gb2xkVmFsCiAgICAgKiBAbWVtYmVyb2YgVFhMWFlHQmFzZQogICAgICovCiAgICBAV2F0Y2goJ3NlbGVjdGVkRGF0YScpCiAgICBwdWJsaWMgb25WYWx1ZUNoYW5nZShuZXdWYWw6IGFueSwgb2xkVmFsOiBhbnkpIHsKICAgICAgICB0aGlzLnNlbGVjdGlvbnMgPSBbXTsKICAgICAgICBpZih0aGlzLnNlbGVjdGVkRGF0YSl7CiAgICAgICAgICAgIGNvbnN0IHJlZnM6IGFueSA9IHRoaXMuJHJlZnM7CiAgICAgICAgICAgIGlmIChyZWZzLm11bHRpcGxlVGFibGUpIHsKICAgICAgICAgICAgICAgIHJlZnMubXVsdGlwbGVUYWJsZS5jbGVhclNlbGVjdGlvbigpOwogICAgICAgICAgICAgICAgSlNPTi5wYXJzZSh0aGlzLnNlbGVjdGVkRGF0YSkuZm9yRWFjaCgoc2VsZWN0aW9uOmFueSk9PnsKICAgICAgICAgICAgICAgICAgICBsZXQgc2VsZWN0ZWRJdGVtID0gdGhpcy5pdGVtcy5maW5kKChpdGVtOmFueSk9PnsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIE9iamVjdC5pcyhpdGVtLnNyZmtleSwgc2VsZWN0aW9uLnNyZmtleSk7CiAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgaWYoc2VsZWN0ZWRJdGVtKXsKICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5yb3dDbGljayhzZWxlY3RlZEl0ZW0pOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICog6KGo5qC86KGM5pWw5o2u6buY6K6k5r+A5rS75qih5byPCiAgICAgKiAwIOS4jea/gOa0uwogICAgICogMSDljZXlh7vmv4DmtLsKICAgICAqIDIg5Y+M5Ye75r+A5rS7CiAgICAgKgogICAgICogQHR5cGUgeyhudW1iZXIgfCAwIHwgMSB8IDIpfQogICAgICogQG1lbWJlcm9mIFRYTFhZR0Jhc2UKICAgICAqLwogICAgQFByb3Aoe2RlZmF1bHQ6IDJ9KSBwdWJsaWMgZ3JpZFJvd0FjdGl2ZU1vZGUhOiBudW1iZXI7CgogICAgLyoqCiAgICAgKiDmmK/lkKblvIDlkK/ooYznvJbovpEKICAgICAqCiAgICAgKiBAdHlwZSB7Ym9vbGVhbn0KICAgICAqIEBtZW1iZXJvZiBUWExYWUdCYXNlCiAgICAgKi8KICAgIEBQcm9wKHtkZWZhdWx0OiBmYWxzZX0pIHB1YmxpYyBpc09wZW5FZGl0ITogYm9vbGVhbjsKCiAgICAvKioKICAgICAqIOWunumZheaYr+WQpuW8gOWQr+ihjOe8lui+kQogICAgICoKICAgICAqIEB0eXBlIHtib29sZWFufQogICAgICogQG1lbWJlcm9mIFRYTFhZR0Jhc2UKICAgICAqLwogICAgcHVibGljIGFjdHVhbElzT3BlbkVkaXQ6IGJvb2xlYW4gPSB0aGlzLmlzT3BlbkVkaXQ7CgogICAgLyoqCiAgICAgKiDmgLvmnaHmlbAKICAgICAqCiAgICAgKiBAdHlwZSB7bnVtYmVyfQogICAgICogQG1lbWJlcm9mIFRYTFhZR0Jhc2UKICAgICAqLwogICAgcHVibGljIHRvdGFscm93OiBudW1iZXIgPSAwOwoKICAgIC8qKgogICAgICog6YCJ5Lit6KGM5pWw5o2uCiAgICAgKgogICAgICogQHR5cGUge2FueVtdfQogICAgICogQG1lbWJlcm9mIE1haW4KICAgICAqLwogICAgcHVibGljIHNlbGVjdGlvbnM6IGFueVtdID0gW107CgogICAgLyoqCiAgICAgKiDmi6bmiKrooYzpgInkuK0KICAgICAqCiAgICAgKiBAdHlwZSB7Ym9vbGVhbn0KICAgICAqIEBtZW1iZXJvZiBNYWluCiAgICAgKi8KICAgIHB1YmxpYyBzdG9wUm93Q2xpY2s6IGJvb2xlYW4gPSBmYWxzZTsKCgoKCiAgICAvKioKICAgICAqIOihqOagvOaYr+WQpuaYvuekugogICAgICoKICAgICAqIEB0eXBlIHtib29sZWFufQogICAgICogQG1lbWJlcm9mIFRYTFhZR0Jhc2UKICAgICAqLwogICAgcHVibGljIGlzRGlzcGxheTpib29sZWFuID0gdHJ1ZTsKCiAgICAvKioKICAgICAqIOmDqOS7tuWIt+aWsAogICAgICoKICAgICAqIEBwYXJhbSB7YW55W119IGFyZ3MKICAgICAqIEBtZW1iZXJvZiBUWExYWUdCYXNlCiAgICAgKi8KICAgIHB1YmxpYyByZWZyZXNoKGFyZ3M6IGFueVtdKTogdm9pZCB7CiAgICAgICAgdGhpcy5sb2FkKCk7CiAgICB9CgogICAgLyoqCiAgICAqIOmAiemhueahhuWIl+WuvQogICAgKgogICAgKiBAdHlwZSB7bnVtYmVyfQogICAgKiBAbWVtYmVyb2YgQXBwSW5kZXgKICAgICovCiAgICBwdWJsaWMgY2hlY2tib3hDb2xXaWR0aDogbnVtYmVyID0gMzQ7CgogICAgLyoqCiAgICAgKiDmmK/lkKblhYHorrjmi5bliqjliJflrr0KICAgICAqCiAgICAgKiBAdHlwZSB7Ym9vbGVhbn0KICAgICAqIEBtZW1iZXJvZiBBcHBFbWJlZFBpY2tlcgogICAgICovCiAgICBwdWJsaWMgaXNEcmFnZW5kQ29sOiBib29sZWFuID0gZmFsc2U7CgogICAgLyoqCiAgICAgKiDmiYDmnInliJfmiJDlkZgKICAgICAqCiAgICAgKiBAdHlwZSB7YW55W119CiAgICAgKiBAbWVtYmVyb2YgVFhMWFlHQmFzZQogICAgICovCiAgICBwdWJsaWMgYWxsQ29sdW1uczogYW55W10gPSBbCiAgICAgICAgewogICAgICAgICAgICBuYW1lOiAneWdiaCcsCiAgICAgICAgICAgIGxhYmVsOiAn5ZGY5bel57yW5Y+3JywKICAgICAgICAgICAgbGFuZ3RhZzogJ2VudGl0aWVzLnBpbXBlcnNvbi50eGx4eWdfZ3JpZC5jb2x1bW5zLnlnYmgnLAogICAgICAgICAgICBzaG93OiB0cnVlLAogICAgICAgICAgICB1dGlsOiAncHgnCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgIG5hbWU6ICdwaW1wZXJzb25uYW1lJywKICAgICAgICAgICAgbGFiZWw6ICflkZjlt6Xlp5PlkI0nLAogICAgICAgICAgICBsYW5ndGFnOiAnZW50aXRpZXMucGltcGVyc29uLnR4bHh5Z19ncmlkLmNvbHVtbnMucGltcGVyc29ubmFtZScsCiAgICAgICAgICAgIHNob3c6IHRydWUsCiAgICAgICAgICAgIHV0aWw6ICdweCcKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgbmFtZTogJ3hiJywKICAgICAgICAgICAgbGFiZWw6ICfmgKfliKsnLAogICAgICAgICAgICBsYW5ndGFnOiAnZW50aXRpZXMucGltcGVyc29uLnR4bHh5Z19ncmlkLmNvbHVtbnMueGInLAogICAgICAgICAgICBzaG93OiB0cnVlLAogICAgICAgICAgICB1dGlsOiAncHgnCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgIG5hbWU6ICduaicsCiAgICAgICAgICAgIGxhYmVsOiAn5bm06b6EJywKICAgICAgICAgICAgbGFuZ3RhZzogJ2VudGl0aWVzLnBpbXBlcnNvbi50eGx4eWdfZ3JpZC5jb2x1bW5zLm5qJywKICAgICAgICAgICAgc2hvdzogdHJ1ZSwKICAgICAgICAgICAgdXRpbDogJ3B4JwogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICBuYW1lOiAncG9zdGFsYWRkcmVzcycsCiAgICAgICAgICAgIGxhYmVsOiAn6YCa6K6v5Zyw5Z2AJywKICAgICAgICAgICAgbGFuZ3RhZzogJ2VudGl0aWVzLnBpbXBlcnNvbi50eGx4eWdfZ3JpZC5jb2x1bW5zLnBvc3RhbGFkZHJlc3MnLAogICAgICAgICAgICBzaG93OiB0cnVlLAogICAgICAgICAgICB1dGlsOiAncHgnCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgIG5hbWU6ICdyZXRpcGxhY2UnLAogICAgICAgICAgICBsYWJlbDogJ+mAgOS8keWcsCcsCiAgICAgICAgICAgIGxhbmd0YWc6ICdlbnRpdGllcy5waW1wZXJzb24udHhseHlnX2dyaWQuY29sdW1ucy5yZXRpcGxhY2UnLAogICAgICAgICAgICBzaG93OiB0cnVlLAogICAgICAgICAgICB1dGlsOiAncHgnCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgIG5hbWU6ICdqdGx4cicsCiAgICAgICAgICAgIGxhYmVsOiAn5a625bqt6IGU57O75Lq6JywKICAgICAgICAgICAgbGFuZ3RhZzogJ2VudGl0aWVzLnBpbXBlcnNvbi50eGx4eWdfZ3JpZC5jb2x1bW5zLmp0bHhyJywKICAgICAgICAgICAgc2hvdzogdHJ1ZSwKICAgICAgICAgICAgdXRpbDogJ3B4JwogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICBuYW1lOiAnanRseHJkaCcsCiAgICAgICAgICAgIGxhYmVsOiAn5a625bqt6IGU57O75Lq655S16K+dJywKICAgICAgICAgICAgbGFuZ3RhZzogJ2VudGl0aWVzLnBpbXBlcnNvbi50eGx4eWdfZ3JpZC5jb2x1bW5zLmp0bHhyZGgnLAogICAgICAgICAgICBzaG93OiB0cnVlLAogICAgICAgICAgICB1dGlsOiAnUFgnCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgIG5hbWU6ICd6emR6cycsCiAgICAgICAgICAgIGxhYmVsOiAn57uE57uHJywKICAgICAgICAgICAgbGFuZ3RhZzogJ2VudGl0aWVzLnBpbXBlcnNvbi50eGx4eWdfZ3JpZC5jb2x1bW5zLnp6ZHpzJywKICAgICAgICAgICAgc2hvdzogdHJ1ZSwKICAgICAgICAgICAgdXRpbDogJ3B4JwogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICBuYW1lOiAnb3Jtb3Jnc2VjdG9ybmFtZScsCiAgICAgICAgICAgIGxhYmVsOiAn6YOo6ZeoJywKICAgICAgICAgICAgbGFuZ3RhZzogJ2VudGl0aWVzLnBpbXBlcnNvbi50eGx4eWdfZ3JpZC5jb2x1bW5zLm9ybW9yZ3NlY3Rvcm5hbWUnLAogICAgICAgICAgICBzaG93OiB0cnVlLAogICAgICAgICAgICB1dGlsOiAnUFgnCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgIG5hbWU6ICdyYW5rJywKICAgICAgICAgICAgbGFiZWw6ICfogYznuqcnLAogICAgICAgICAgICBsYW5ndGFnOiAnZW50aXRpZXMucGltcGVyc29uLnR4bHh5Z19ncmlkLmNvbHVtbnMucmFuaycsCiAgICAgICAgICAgIHNob3c6IHRydWUsCiAgICAgICAgICAgIHV0aWw6ICdweCcKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgbmFtZTogJ3p3JywKICAgICAgICAgICAgbGFiZWw6ICfpgIDkvJHliY3ogYzliqEnLAogICAgICAgICAgICBsYW5ndGFnOiAnZW50aXRpZXMucGltcGVyc29uLnR4bHh5Z19ncmlkLmNvbHVtbnMuencnLAogICAgICAgICAgICBzaG93OiB0cnVlLAogICAgICAgICAgICB1dGlsOiAnUFgnCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgIG5hbWU6ICdndycsCiAgICAgICAgICAgIGxhYmVsOiAn6YCA5LyR5YmN5bKX5L2NJywKICAgICAgICAgICAgbGFuZ3RhZzogJ2VudGl0aWVzLnBpbXBlcnNvbi50eGx4eWdfZ3JpZC5jb2x1bW5zLmd3JywKICAgICAgICAgICAgc2hvdzogdHJ1ZSwKICAgICAgICAgICAgdXRpbDogJ1BYJwogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICBuYW1lOiAndHhkcScsCiAgICAgICAgICAgIGxhYmVsOiAn6YCA5LyR5pe26Ze0JywKICAgICAgICAgICAgbGFuZ3RhZzogJ2VudGl0aWVzLnBpbXBlcnNvbi50eGx4eWdfZ3JpZC5jb2x1bW5zLnR4ZHEnLAogICAgICAgICAgICBzaG93OiB0cnVlLAogICAgICAgICAgICB1dGlsOiAncHgnCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgIG5hbWU6ICdzanR4cnEnLAogICAgICAgICAgICBsYWJlbDogJ+WunumZhemAgOS8keaXtumXtCcsCiAgICAgICAgICAgIGxhbmd0YWc6ICdlbnRpdGllcy5waW1wZXJzb24udHhseHlnX2dyaWQuY29sdW1ucy5zanR4cnEnLAogICAgICAgICAgICBzaG93OiB0cnVlLAogICAgICAgICAgICB1dGlsOiAncHgnCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgIG5hbWU6ICdseGRoJywKICAgICAgICAgICAgbGFiZWw6ICfmiYvmnLrlj7fnoIEnLAogICAgICAgICAgICBsYW5ndGFnOiAnZW50aXRpZXMucGltcGVyc29uLnR4bHh5Z19ncmlkLmNvbHVtbnMubHhkaCcsCiAgICAgICAgICAgIHNob3c6IHRydWUsCiAgICAgICAgICAgIHV0aWw6ICdweCcKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgbmFtZTogJ3NwZHlsamUnLAogICAgICAgICAgICBsYWJlbDogJ+WuoeaJueeahOWFu+iAgemHkeminScsCiAgICAgICAgICAgIGxhbmd0YWc6ICdlbnRpdGllcy5waW1wZXJzb24udHhseHlnX2dyaWQuY29sdW1ucy5zcGR5bGplJywKICAgICAgICAgICAgc2hvdzogdHJ1ZSwKICAgICAgICAgICAgdXRpbDogJ1BYJwogICAgICAgIH0sCiAgICBdCgogICAgLyoqCiAgICAgKiDooajmoLzmqKHlnovpm4blkIgKICAgICAqCiAgICAgKiBAdHlwZSB7Kn0KICAgICAqIEBtZW1iZXJvZiBUWExYWUdCYXNlCiAgICAgKi8KICAgIHB1YmxpYyBncmlkSXRlbXNNb2RlbDogYW55W10gPSBbXTsKCiAgICAvKioKICAgICAqIOiOt+WPluihqOagvOihjOaooeWeiwogICAgICoKICAgICAqIEB0eXBlIHsqfQogICAgICogQG1lbWJlcm9mIFRYTFhZR0Jhc2UKICAgICAqLwogICAgcHVibGljIGdldEdyaWRSb3dNb2RlbCgpewogICAgICAgIHJldHVybiB7CiAgICAgICAgICBzcmZrZXk6IG5ldyBGb3JtSXRlbU1vZGVsKCksCiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICog5bGe5oCn5YC86KeE5YiZCiAgICAgKgogICAgICogQHR5cGUgeyp9CiAgICAgKiBAbWVtYmVyb2YgVFhMWFlHQmFzZQogICAgICovCiAgICBwdWJsaWMgcnVsZXM6IGFueSA9IHsKICAgICAgICBzcmZrZXk6IFsKICAgICAgICAgICAgIHsgcmVxdWlyZWQ6IGZhbHNlLCB2YWxpZGF0b3I6IChydWxlOmFueSwgdmFsdWU6YW55LCBjYWxsYmFjazphbnkpID0+IHsgcmV0dXJuIChydWxlLnJlcXVpcmVkICYmICh2YWx1ZSA9PT0gbnVsbCB8fCB2YWx1ZSA9PT0gdW5kZWZpbmVkIHx8IHZhbHVlID09PSAiIikpID8gZmFsc2UgOiB0cnVlO30sIG1lc3NhZ2U6ICfkurrlkZjkv6Hmga/moIfor4Yg5YC85LiN6IO95Li656m6JywgdHJpZ2dlcjogJ2NoYW5nZScgfSwKICAgICAgICAgICAgeyByZXF1aXJlZDogZmFsc2UsIHZhbGlkYXRvcjogKHJ1bGU6YW55LCB2YWx1ZTphbnksIGNhbGxiYWNrOmFueSkgPT4geyByZXR1cm4gKHJ1bGUucmVxdWlyZWQgJiYgKHZhbHVlID09PSBudWxsIHx8IHZhbHVlID09PSB1bmRlZmluZWQgfHwgdmFsdWUgPT09ICIiKSkgPyBmYWxzZSA6IHRydWU7fSwgbWVzc2FnZTogJ+S6uuWRmOS/oeaBr+agh+ivhiDlgLzkuI3og73kuLrnqbonLCB0cmlnZ2VyOiAnYmx1cicgfSwKICAgICAgICBdLAogICAgfQoKICAgIC8qKgogICAgICog6KGo5qC86KGM57yW6L6R6aG55qCh6aqMCiAgICAgKgogICAgICogQHBhcmFtIHtzdHJpbmd9IHByb3BlcnR5IOWxnuaAp+WQjQogICAgICogQHBhcmFtIHsqfSBkYXRhIOihjOaVsOaNrgogICAgICogQHBhcmFtIHtudW1iZXJ9IHJvd0luZGV4IOihjOe0ouW8lQogICAgICogQHJldHVybnMgUHJvbWlzZTxhbnk+CiAgICAgKiAKICAgICAqIEBtZW1iZXJvZiBUWExYWUdCYXNlCiAgICAgKi8KICAgIHB1YmxpYyB2YWxpZGF0ZShwcm9wZXJ0eTpzdHJpbmcsIGRhdGE6YW55LCByb3dJbmRleDpudW1iZXIpOlByb21pc2U8YW55PnsKICAgICAgICByZXR1cm4gbmV3IFByb21pc2UoKHJlc29sdmUsIHJlamVjdCkgPT4gewogICAgICAgICAgICB0aGlzLiR1dGlsLnZhbGlkYXRlSXRlbShwcm9wZXJ0eSxkYXRhLHRoaXMucnVsZXMpLnRoZW4oKCk9PnsKICAgICAgICAgICAgICAgIHRoaXMuZ3JpZEl0ZW1zTW9kZWxbcm93SW5kZXhdW3Byb3BlcnR5XS5zZXRFcnJvcihudWxsKTsKICAgICAgICAgICAgICAgIHJlc29sdmUodHJ1ZSk7CiAgICAgICAgICAgIH0pLmNhdGNoKCh7IGVycm9ycywgZmllbGRzIH0pID0+IHsKICAgICAgICAgICAgICAgIHRoaXMuZ3JpZEl0ZW1zTW9kZWxbcm93SW5kZXhdW3Byb3BlcnR5XS5zZXRFcnJvcihlcnJvcnNbMF0ubWVzc2FnZSk7CiAgICAgICAgICAgICAgICByZXNvbHZlKGZhbHNlKTsKICAgICAgICAgICAgfSk7CiAgICAgICAgfSk7CiAgICB9CgogICAgLyoqCiAgICAgKiDmoKHpqozmiYDmnInkv67mlLnov4fnmoTnvJbovpHpobkKICAgICAqCiAgICAgKiBAcmV0dXJucyBQcm9taXNlPGFueT4KICAgICAqIEBtZW1iZXJvZiBUWExYWUdCYXNlCiAgICAgKi8KICAgIHB1YmxpYyBhc3luYyB2YWxpZGF0ZUFsbCgpewogICAgICAgIGxldCB2YWxpZGF0ZVN0YXRlID0gdHJ1ZTsKICAgICAgICBsZXQgaW5kZXggPSAtMTsKICAgICAgICBmb3IobGV0IGl0ZW0gb2YgdGhpcy5pdGVtcyl7CiAgICAgICAgICBpbmRleCsrOwogICAgICAgICAgaWYoaXRlbS5yb3dEYXRhU3RhdGUgPT09ICJjcmVhdGUiIHx8IGl0ZW0ucm93RGF0YVN0YXRlID09PSAidXBkYXRlIil7CiAgICAgICAgICAgIGZvcihsZXQgcHJvcGVydHkgb2YgT2JqZWN0LmtleXModGhpcy5ydWxlcykpewogICAgICAgICAgICAgIGlmKCFhd2FpdCB0aGlzLnZhbGlkYXRlKHByb3BlcnR5LGl0ZW0saW5kZXgpKXsKICAgICAgICAgICAgICAgIHZhbGlkYXRlU3RhdGUgPSBmYWxzZTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgcmV0dXJuIHZhbGlkYXRlU3RhdGU7CiAgICB9CgogICAgLyoqCiAgICAgKiDooajmoLzmlbDmja7liqDovb0KICAgICAqCiAgICAgKiBAcGFyYW0geyp9IFthcmc9e31dCiAgICAgKiBAbWVtYmVyb2YgVFhMWFlHQmFzZQogICAgICovCiAgICBwdWJsaWMgbG9hZChvcHQ6IGFueSA9IHt9LCBwYWdlUmVzZXQ6IGJvb2xlYW4gPSBmYWxzZSk6IHZvaWQgewogICAgICAgIGlmKCF0aGlzLmZldGNoQWN0aW9uKXsKICAgICAgICAgICAgdGhpcy4kTm90aWNlLmVycm9yKHsgdGl0bGU6ICfplJnor68nLCBkZXNjOiAnUElNUEVSU09OTFRYWUdHcmlkVmlld+inhuWbvuihqOagvGZldGNoQWN0aW9u5Y+C5pWw5pyq6YWN572uJyB9KTsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KICAgICAgICBpZihwYWdlUmVzZXQpewogICAgICAgICAgICB0aGlzLmN1clBhZ2UgPSAxOwogICAgICAgIH0KICAgICAgICBjb25zdCBhcmc6IGFueSA9IHsuLi5vcHR9OwogICAgICAgIGNvbnN0IHBhZ2U6IGFueSA9IHt9OwogICAgICAgIGlmICh0aGlzLmlzRW5hYmxlUGFnaW5nQmFyKSB7CiAgICAgICAgICAgIE9iamVjdC5hc3NpZ24ocGFnZSwgeyBwYWdlOiB0aGlzLmN1clBhZ2UtMSwgc2l6ZTogdGhpcy5saW1pdCB9KTsKICAgICAgICB9CiAgICAgICAgLy8g6K6+572u5o6S5bqPCiAgICAgICAgaWYgKCF0aGlzLmlzTm9Tb3J0ICYmICFPYmplY3QuaXModGhpcy5taW5vclNvcnREaXIsICcnKSAmJiAhT2JqZWN0LmlzKHRoaXMubWlub3JTb3J0UFNERUYsICcnKSkgewogICAgICAgICAgICBjb25zdCBzb3J0OiBzdHJpbmcgPSB0aGlzLm1pbm9yU29ydFBTREVGKyIsIit0aGlzLm1pbm9yU29ydERpcjsKICAgICAgICAgICAgT2JqZWN0LmFzc2lnbihwYWdlLCB7IHNvcnQ6IHNvcnQgfSk7CiAgICAgICAgfQogICAgICAgIE9iamVjdC5hc3NpZ24oYXJnLCBwYWdlKTsKICAgICAgICBjb25zdCBwYXJlbnRkYXRhOiBhbnkgPSB7fTsKICAgICAgICB0aGlzLiRlbWl0KCdiZWZvcmVsb2FkJywgcGFyZW50ZGF0YSk7CiAgICAgICAgT2JqZWN0LmFzc2lnbihhcmcsIHBhcmVudGRhdGEpOwogICAgICAgIGxldCB0ZW1wVmlld1BhcmFtczphbnkgPSBwYXJlbnRkYXRhLnZpZXdwYXJhbXM/cGFyZW50ZGF0YS52aWV3cGFyYW1zOnt9OwogICAgICAgIE9iamVjdC5hc3NpZ24odGVtcFZpZXdQYXJhbXMsSlNPTi5wYXJzZShKU09OLnN0cmluZ2lmeSh0aGlzLnZpZXdwYXJhbXMpKSk7CiAgICAgICAgT2JqZWN0LmFzc2lnbihhcmcse3ZpZXdwYXJhbXM6dGVtcFZpZXdQYXJhbXN9KTsKICAgICAgICBjb25zdCBwb3N0OiBQcm9taXNlPGFueT4gPSB0aGlzLnNlcnZpY2Uuc2VhcmNoKHRoaXMuZmV0Y2hBY3Rpb24sSlNPTi5wYXJzZShKU09OLnN0cmluZ2lmeSh0aGlzLmNvbnRleHQpKSwgYXJnLCB0aGlzLnNob3dCdXN5SW5kaWNhdG9yKTsKICAgICAgICBwb3N0LnRoZW4oKHJlc3BvbnNlOiBhbnkpID0+IHsKICAgICAgICAgICAgaWYgKCFyZXNwb25zZS5zdGF0dXMgfHwgcmVzcG9uc2Uuc3RhdHVzICE9PSAyMDApIHsKICAgICAgICAgICAgICAgIGlmIChyZXNwb25zZS5lcnJvck1lc3NhZ2UpIHsKICAgICAgICAgICAgICAgICAgICB0aGlzLiROb3RpY2UuZXJyb3IoeyB0aXRsZTogJ+mUmeivrycsIGRlc2M6IHJlc3BvbnNlLmVycm9yTWVzc2FnZSB9KTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgfQogICAgICAgICAgICBjb25zdCBkYXRhOiBhbnkgPSByZXNwb25zZS5kYXRhOwogICAgICAgICAgICB0aGlzLnRvdGFscm93ID0gcmVzcG9uc2UudG90YWw7CiAgICAgICAgICAgIHRoaXMuaXRlbXMgPSBKU09OLnBhcnNlKEpTT04uc3RyaW5naWZ5KGRhdGEpKTsKICAgICAgICAgICAgLy8g5riF56m6c2VsZWN0aW9ucyxncmlkSXRlbXNNb2RlbAogICAgICAgICAgICB0aGlzLnNlbGVjdGlvbnMgPSBbXTsKICAgICAgICAgICAgdGhpcy5ncmlkSXRlbXNNb2RlbCA9IFtdOwogICAgICAgICAgICB0aGlzLml0ZW1zLmZvckVhY2goKCk9Pnt0aGlzLmdyaWRJdGVtc01vZGVsLnB1c2godGhpcy5nZXRHcmlkUm93TW9kZWwoKSl9KTsKICAgICAgICAgICAgdGhpcy4kZW1pdCgnbG9hZCcsIHRoaXMuaXRlbXMpOwogICAgICAgICAgICAvLyDorr7nva7pu5jorqTpgInkuK0KICAgICAgICAgICAgbGV0IF90aGlzID0gdGhpczsKICAgICAgICAgICAgc2V0VGltZW91dCgoKSA9PiB7CiAgICAgICAgICAgICAgICBpZihfdGhpcy5pc1NlbGVjdEZpcnN0RGVmYXVsdCl7CiAgICAgICAgICAgICAgICAgIF90aGlzLnJvd0NsaWNrKF90aGlzLml0ZW1zWzBdKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGlmKF90aGlzLnNlbGVjdGVkRGF0YSl7CiAgICAgICAgICAgICAgICAgICAgY29uc3QgcmVmczogYW55ID0gX3RoaXMuJHJlZnM7CiAgICAgICAgICAgICAgICAgICAgaWYgKHJlZnMubXVsdGlwbGVUYWJsZSkgewogICAgICAgICAgICAgICAgICAgICAgICByZWZzLm11bHRpcGxlVGFibGUuY2xlYXJTZWxlY3Rpb24oKTsKICAgICAgICAgICAgICAgICAgICAgICAgSlNPTi5wYXJzZShfdGhpcy5zZWxlY3RlZERhdGEpLmZvckVhY2goKHNlbGVjdGlvbjphbnkpPT57CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsZXQgc2VsZWN0ZWRJdGVtID0gX3RoaXMuaXRlbXMuZmluZCgoaXRlbTphbnkpPT57CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIE9iamVjdC5pcyhpdGVtLnNyZmtleSwgc2VsZWN0aW9uLnNyZmtleSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmKHNlbGVjdGVkSXRlbSl7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgX3RoaXMucm93Q2xpY2soc2VsZWN0ZWRJdGVtKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9LCAzMDApOwogICAgICAgIH0pLmNhdGNoKChyZXNwb25zZTogYW55KSA9PiB7CiAgICAgICAgICAgIGlmIChyZXNwb25zZSAmJiByZXNwb25zZS5zdGF0dXMgPT09IDQwMSkgewogICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHRoaXMuJE5vdGljZS5lcnJvcih7IHRpdGxlOiAn6ZSZ6K+vJywgZGVzYzogcmVzcG9uc2UuZXJyb3JNZXNzYWdlIH0pOwogICAgICAgIH0pOwogICAgfQoKICAgIC8qKgogICAgICog5Yig6ZmkCiAgICAgKgogICAgICogQHBhcmFtIHthbnlbXX0gZGF0YXMKICAgICAqIEByZXR1cm5zIHtQcm9taXNlPGFueT59CiAgICAgKiBAbWVtYmVyb2YgVFhMWFlHQmFzZQogICAgICovCiAgICBwdWJsaWMgYXN5bmMgcmVtb3ZlKGRhdGFzOiBhbnlbXSk6IFByb21pc2U8YW55PiB7CiAgICAgICAgaWYoIXRoaXMucmVtb3ZlQWN0aW9uKXsKICAgICAgICAgICAgdGhpcy4kTm90aWNlLmVycm9yKHsgdGl0bGU6ICfplJnor68nLCBkZXNjOiAnUElNUEVSU09OTFRYWUdHcmlkVmlld+inhuWbvuihqOagvHJlbW92ZUFjdGlvbuWPguaVsOacqumFjee9ricgfSk7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICB9CiAgICAgICAgbGV0IF9kYXRhczphbnlbXSA9IFtdOwogICAgICAgIGRhdGFzLmZvckVhY2goKHJlY29yZDogYW55LCBpbmRleDogbnVtYmVyKSA9PiB7CiAgICAgICAgICAgIGlmIChPYmplY3QuaXMocmVjb3JkLnNyZnVmLCIwIikpIHsKICAgICAgICAgICAgICAgIHRoaXMuaXRlbXMuc29tZSgodmFsOiBhbnksIG51bTogbnVtYmVyKSA9PnsKICAgICAgICAgICAgICAgICAgICBpZihKU09OLnN0cmluZ2lmeSh2YWwpID09IEpTT04uc3RyaW5naWZ5KHJlY29yZCkpewogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLml0ZW1zLnNwbGljZShudW0sMSk7CiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuZ3JpZEl0ZW1zTW9kZWwuc3BsaWNlKG51bSwxKTsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSk7IAogICAgICAgICAgICB9ZWxzZXsKICAgICAgICAgICAgICAgX2RhdGFzLnB1c2goZGF0YXNbaW5kZXhdKTsKICAgICAgICAgICAgfQogICAgICAgIH0pOwogICAgICAgIGlmIChfZGF0YXMubGVuZ3RoID09PSAwKSB7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICB9CiAgICAgICAgbGV0IGRhdGFJbmZvID0gJyc7CiAgICAgICAgX2RhdGFzLmZvckVhY2goKHJlY29yZDogYW55LCBpbmRleDogbnVtYmVyKSA9PiB7CiAgICAgICAgICAgIGxldCBzcmZtYWpvcnRleHQgPSByZWNvcmQucGltcGVyc29ubmFtZTsKICAgICAgICAgICAgaWYgKGluZGV4IDwgNSkgewogICAgICAgICAgICAgICAgaWYgKCFPYmplY3QuaXMoZGF0YUluZm8sICcnKSkgewogICAgICAgICAgICAgICAgICAgIGRhdGFJbmZvICs9ICfjgIEnOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgZGF0YUluZm8gKz0gc3JmbWFqb3J0ZXh0OwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgICAgICB9CiAgICAgICAgfSk7CgogICAgICAgIGlmIChfZGF0YXMubGVuZ3RoIDwgNSkgewogICAgICAgICAgICBkYXRhSW5mbyA9IGRhdGFJbmZvICsgJyDlhbEnICsgX2RhdGFzLmxlbmd0aCArICfmnaHmlbDmja4nOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIGRhdGFJbmZvID0gZGF0YUluZm8gKyAnLi4uJyArICcg5YWxJyArIF9kYXRhcy5sZW5ndGggKyAn5p2h5pWw5o2uJzsKICAgICAgICB9CgogICAgICAgIGNvbnN0IHJlbW92ZURhdGEgPSAoKSA9PiB7CiAgICAgICAgICAgIGxldCBrZXlzOiBhbnlbXSA9IFtdOwogICAgICAgICAgICBfZGF0YXMuZm9yRWFjaCgoZGF0YTogYW55KSA9PiB7CiAgICAgICAgICAgICAgICBrZXlzLnB1c2goZGF0YS5zcmZrZXkpOwogICAgICAgICAgICB9KTsKICAgICAgICAgICAgbGV0IF9yZW1vdmVBY3Rpb24gPSBrZXlzLmxlbmd0aCA+IDEgPyAncmVtb3ZlQmF0Y2gnIDogdGhpcy5yZW1vdmVBY3Rpb24gOwogICAgICAgICAgICBsZXQgX2tleXMgPSBrZXlzLmxlbmd0aCA+IDEgPyBrZXlzIDoga2V5c1swXSA7CiAgICAgICAgICAgIGNvbnN0IGNvbnRleHQ6YW55ID0gSlNPTi5wYXJzZShKU09OLnN0cmluZ2lmeSh0aGlzLmNvbnRleHQpKTsKICAgICAgICAgICAgY29uc3QgcG9zdDogUHJvbWlzZTxhbnk+ID0gdGhpcy5zZXJ2aWNlLmRlbGV0ZShfcmVtb3ZlQWN0aW9uLE9iamVjdC5hc3NpZ24oY29udGV4dCx7IHBpbXBlcnNvbjogX2tleXMgfSksT2JqZWN0LmFzc2lnbih7IHBpbXBlcnNvbjogX2tleXMgfSx7dmlld3BhcmFtczp0aGlzLnZpZXdwYXJhbXN9KSwgdGhpcy5zaG93QnVzeUluZGljYXRvcik7CiAgICAgICAgICAgIHJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZTogYW55LCByZWplY3Q6IGFueSkgPT4gewogICAgICAgICAgICAgICAgcG9zdC50aGVuKChyZXNwb25zZTogYW55KSA9PiB7CiAgICAgICAgICAgICAgICAgICAgaWYgKCFyZXNwb25zZSB8fCByZXNwb25zZS5zdGF0dXMgIT09IDIwMCkgewogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLiROb3RpY2UuZXJyb3IoeyB0aXRsZTogJycsIGRlc2M6ICfliKDpmaTmlbDmja7lpLHotKUsJyArIHJlc3BvbnNlLmluZm8gfSk7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLiROb3RpY2Uuc3VjY2Vzcyh7IHRpdGxlOiAnJywgZGVzYzogJ+WIoOmZpOaIkOWKnyEnIH0pOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAvL+WIoOmZpGl0ZW1z5Lit5bey5Yig6Zmk55qE6aG5CiAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2codGhpcy5pdGVtcyk7CiAgICAgICAgICAgICAgICAgICAgX2RhdGFzLmZvckVhY2goKGRhdGE6IGFueSkgPT4gewogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLml0ZW1zLnNvbWUoKGl0ZW06YW55LGluZGV4Om51bWJlcik9PnsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmKE9iamVjdC5pcyhpdGVtLnNyZmtleSxkYXRhLnNyZmtleSkpewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuaXRlbXMuc3BsaWNlKGluZGV4LDEpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuZ3JpZEl0ZW1zTW9kZWwuc3BsaWNlKGluZGV4LDEpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICB0aGlzLnRvdGFscm93IC09IF9kYXRhcy5sZW5ndGg7CiAgICAgICAgICAgICAgICAgICAgdGhpcy4kZW1pdCgncmVtb3ZlJywgbnVsbCk7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5zZWxlY3Rpb25zID0gW107CiAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZShyZXNwb25zZSk7CiAgICAgICAgICAgICAgICB9KS5jYXRjaCgocmVzcG9uc2U6IGFueSkgPT4gewogICAgICAgICAgICAgICAgICAgIGlmIChyZXNwb25zZSAmJiByZXNwb25zZS5zdGF0dXMgPT09IDQwMSkgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGlmICghcmVzcG9uc2UgfHwgIXJlc3BvbnNlLnN0YXR1cyB8fCAhcmVzcG9uc2UuZGF0YSkgewogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLiROb3RpY2UuZXJyb3IoeyB0aXRsZTogJ+mUmeivrycsIGRlc2M6ICfns7vnu5/lvILluLgnIH0pOwogICAgICAgICAgICAgICAgICAgICAgICByZWplY3QocmVzcG9uc2UpOwogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIHJlamVjdChyZXNwb25zZSk7CiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfSk7CiAgICAgICAgfQoKICAgICAgICBkYXRhSW5mbyA9IGRhdGFJbmZvLnJlcGxhY2UoL1tudWxsXS9nLCAnJykucmVwbGFjZSgvW3VuZGVmaW5lZF0vZywgJycpOwogICAgICAgIHRoaXMuJE1vZGFsLmNvbmZpcm0oewogICAgICAgICAgICB0aXRsZTogJ+itpuWRiicsCiAgICAgICAgICAgIGNvbnRlbnQ6ICfnoa7orqTopoHliKDpmaQgJyArIGRhdGFJbmZvICsgJ++8jOWIoOmZpOaTjeS9nOWwhuS4jeWPr+aBouWkje+8nycsCiAgICAgICAgICAgIG9uT2s6ICgpID0+IHsKICAgICAgICAgICAgICAgIHJlbW92ZURhdGEoKTsKICAgICAgICAgICAgfSwKICAgICAgICAgICAgb25DYW5jZWw6ICgpID0+IHsgfQogICAgICAgIH0pOwogICAgICAgIHJldHVybiByZW1vdmVEYXRhOwogICAgfQoKCiAgICAvKioKICAgICAqIOaJuemHj+a3u+WKoAogICAgICoKICAgICAqIEBwYXJhbSB7Kn0gW2FyZz17fV0KICAgICAqIEBtZW1iZXJvZiBUWExYWUdCYXNlCiAgICAgKi8KICAgIHB1YmxpYyBhZGRCYXRjaChhcmc6IGFueSA9IHt9KTogdm9pZCB7CiAgICAgICAgaWYoIXRoaXMuZmV0Y2hBY3Rpb24pewogICAgICAgICAgICB0aGlzLiROb3RpY2UuZXJyb3IoeyB0aXRsZTogJ+mUmeivrycsIGRlc2M6ICdQSU1QRVJTT05MVFhZR0dyaWRWaWV36KeG5Zu+6KGo5qC8ZmV0Y2hBY3Rpb27lj4LmlbDmnKrphY3nva4nIH0pOwogICAgICAgICAgICByZXR1cm47CiAgICAgICAgfQogICAgICAgIGlmKCFhcmcpewogICAgICAgICAgICBhcmcgPSB7fTsKICAgICAgICB9CiAgICAgICAgY29uc29sZS5lcnJvcigi5om56YeP5re75Yqg5pyq5a6e546wIik7CiAgICB9CgogICAgLyoqCiAgICAgKiDmlbDmja7lr7zlhaUKICAgICAqCiAgICAgKiBAcGFyYW0geyp9IGRhdGEKICAgICAqIEBtZW1iZXJvZiBUWExYWUdCYXNlCiAgICAgKi8KICAgICBwdWJsaWMgaW1wb3J0RXhjZWwoZGF0YTphbnkgPXt9KTp2b2lkewogICAgICAgIC8v5a+85YWlZXhjZWwKICAgICAgICBjb25zdCBpbXBvcnREYXRhTW9kZWw6YW55ID17CiAgICAgICAgfQogICAgICAgIGlmKE9iamVjdC5rZXlzKGltcG9ydERhdGFNb2RlbCkubGVuZ3RoID09IDApewogICAgICAgICAgICB0aGlzLiROb3RpY2Uud2FybmluZyh7ICd0aXRsZSc6ICh0aGlzLiR0KCJhcHAudXRpbHZpZXcud2FybmluZyIpIGFzIHN0cmluZyksICdkZXNjJzogKHRoaXMuJHQoImFwcC51dGlsdmlldy5pbmZvIikgYXMgc3RyaW5nKSB9KTsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KICAgICAgICBjb25zdCB2aWV3OmFueSA9ewogICAgICAgICAgICB2aWV3bmFtZTogJ2FwcC1kYXRhLXVwbG9hZCcsCiAgICAgICAgICAgIHRpdGxlOiB0aGlzLiR0KCJhcHAudXRpbHZpZXcuaW1wb3J0dmlldyIpLAogICAgICAgICAgICB3aWR0aDogOTAwLAogICAgICAgICAgICBoZWlnaHQ6IDcwMAogICAgICAgIH0KICAgICAgICBsZXQgY29udGFpbmVyOiBTdWJqZWN0PGFueT4gPSB0aGlzLiRhcHBtb2RhbC5vcGVuTW9kYWwodmlldywgSlNPTi5wYXJzZShKU09OLnN0cmluZ2lmeSh0aGlzLmNvbnRleHQpKSwgaW1wb3J0RGF0YU1vZGVsKTsKICAgICAgICBjb250YWluZXIuc3Vic2NyaWJlKChyZXN1bHQ6IGFueSkgPT4gewogICAgICAgICAgaWYoT2JqZWN0LmlzKHJlc3VsdC5yZXQsJ09LJykpewogICAgICAgICAgICB0aGlzLnJlZnJlc2gocmVzdWx0LmRhdGFzKTsKICAgICAgICAgIH0KICAgICAgfSk7CiAgICB9CgoKICAgIC8qKgogICAgICog5pWw5o2u5a+85Ye6CiAgICAgKgogICAgICogQHBhcmFtIHsqfSBkYXRhCiAgICAgKiBAbWVtYmVyb2YgVFhMWFlHQmFzZQogICAgICovCiAgICBwdWJsaWMgZXhwb3J0RXhjZWwoZGF0YTogYW55ID0ge30pOiB2b2lkIHsKICAgICAgICAvLyDlr7zlh7pFeGNlbAogICAgICAgIGNvbnN0IGRvRXhwb3J0ID0gYXN5bmMgKF9kYXRhOmFueSkgPT4gewogICAgICAgICAgICBjb25zdCB0SGVhZGVyOiBBcnJheTxhbnk+ID0gW107CiAgICAgICAgICAgIGNvbnN0IGZpbHRlclZhbDogQXJyYXk8YW55PiA9IFtdOwogICAgICAgICAgICB0aGlzLmFsbENvbHVtbnMuZm9yRWFjaCgoaXRlbTogYW55KSA9PiB7CiAgICAgICAgICAgICAgaXRlbS5zaG93ICYmIGl0ZW0ubGFiZWwgPyB0SGVhZGVyLnB1c2godGhpcy4kdChpdGVtLmxhbmd0YWcpKSA6ICIiOwogICAgICAgICAgICAgIGl0ZW0uc2hvdyAmJiBpdGVtLm5hbWUgPyBmaWx0ZXJWYWwucHVzaChpdGVtLm5hbWUpIDogIiI7CiAgICAgICAgICAgIH0pOwogICAgICAgICAgICBjb25zdCBkYXRhID0gYXdhaXQgdGhpcy5mb3JtYXRFeGNlbERhdGEoZmlsdGVyVmFsLCBfZGF0YSk7CiAgICAgICAgICAgIHRoaXMuJGV4cG9ydC5leHBvcnRFeGNlbCgpLnRoZW4oKGV4Y2VsOmFueSk9PnsKICAgICAgICAgICAgICAgIGV4Y2VsLmV4cG9ydF9qc29uX3RvX2V4Y2VsKHsKICAgICAgICAgICAgICAgICAgaGVhZGVyOiB0SGVhZGVyLCAvL+ihqOWktCDlv4XloasKICAgICAgICAgICAgICAgICAgZGF0YSwgLy/lhbfkvZPmlbDmja4g5b+F5aGrCiAgICAgICAgICAgICAgICAgIGZpbGVuYW1lOiAi5Lq65ZGY5L+h5oGv6KGoIiwgLy/pnZ7lv4XloasKICAgICAgICAgICAgICAgICAgYXV0b1dpZHRoOiB0cnVlLCAvL+mdnuW/heWhqwogICAgICAgICAgICAgICAgICBib29rVHlwZTogInhsc3giIC8v6Z2e5b+F5aGrCiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfSk7IAogICAgICAgIH07CiAgICAgICAgY29uc3QgcGFnZTogYW55ID0ge307CiAgICAgICAgLy8g6K6+572ucGFnZe+8jHNpemUKICAgICAgICBpZiAoT2JqZWN0LmlzKGRhdGEudHlwZSwgJ21heFJvd0NvdW50JykpIHsKICAgICAgICAgICAgT2JqZWN0LmFzc2lnbihwYWdlLCB7IHBhZ2U6IDAsIHNpemU6IGRhdGEubWF4Um93Q291bnQgfSk7CiAgICAgICAgfSBlbHNlIGlmIChPYmplY3QuaXMoZGF0YS50eXBlLCAnYWN0aXZhdGVkUGFnZScpKSB7CiAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICBkb0V4cG9ydChKU09OLnBhcnNlKEpTT04uc3RyaW5naWZ5KHRoaXMuaXRlbXMpKSk7CiAgICAgICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7CiAgICAgICAgICAgICAgICBjb25zb2xlLmVycm9yKGVycm9yKTsKICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm47CiAgICAgICAgfQogICAgICAgIC8vIOiuvue9ruaOkuW6jwogICAgICAgIGlmICghdGhpcy5pc05vU29ydCAmJiAhT2JqZWN0LmlzKHRoaXMubWlub3JTb3J0RGlyLCAnJykgJiYgIU9iamVjdC5pcyh0aGlzLm1pbm9yU29ydFBTREVGLCAnJykpIHsKICAgICAgICAgIGNvbnN0IHNvcnQ6IHN0cmluZyA9IHRoaXMubWlub3JTb3J0UFNERUYrIiwiK3RoaXMubWlub3JTb3J0RGlyOwogICAgICAgICAgICBPYmplY3QuYXNzaWduKHBhZ2UsIHsgc29ydDogc29ydCB9KTsKICAgICAgICB9CiAgICAgICAgY29uc3QgYXJnOiBhbnkgPSB7fTsKICAgICAgICBPYmplY3QuYXNzaWduKGFyZywgcGFnZSk7CiAgICAgICAgLy8g6I635Y+WcXVlcnks5pCc57Si6KGo5Y2V77yMdmlld3BhcmFtc+etieeItuaVsOaNrgogICAgICAgIGNvbnN0IHBhcmVudGRhdGE6IGFueSA9IHt9OwogICAgICAgIHRoaXMuJGVtaXQoJ2JlZm9yZWxvYWQnLCBwYXJlbnRkYXRhKTsKICAgICAgICBPYmplY3QuYXNzaWduKGFyZywgcGFyZW50ZGF0YSk7CiAgICAgICAgY29uc3QgcG9zdDogUHJvbWlzZTxhbnk+ID0gdGhpcy5zZXJ2aWNlLnNlYXJjaCh0aGlzLmZldGNoQWN0aW9uLEpTT04ucGFyc2UoSlNPTi5zdHJpbmdpZnkodGhpcy5jb250ZXh0KSksIGFyZywgdGhpcy5zaG93QnVzeUluZGljYXRvcik7CiAgICAgICAgcG9zdC50aGVuKChyZXNwb25zZTogYW55KSA9PiB7CiAgICAgICAgICAgIGlmICghcmVzcG9uc2UgfHwgcmVzcG9uc2Uuc3RhdHVzICE9PSAyMDApIHsKICAgICAgICAgICAgICAgIHRoaXMuJE5vdGljZS5lcnJvcih7IHRpdGxlOiAnJywgZGVzYzogJ+aVsOaNruWvvOWHuuWksei0pSwnICsgcmVzcG9uc2UuaW5mbyB9KTsKICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgfQogICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgZG9FeHBvcnQoSlNPTi5wYXJzZShKU09OLnN0cmluZ2lmeShyZXNwb25zZS5kYXRhKSkpOwogICAgICAgICAgICB9IGNhdGNoIChlcnJvcikgewogICAgICAgICAgICAgICAgY29uc29sZS5lcnJvcihlcnJvcik7CiAgICAgICAgICAgIH0KICAgICAgICB9KS5jYXRjaCgocmVzcG9uc2U6IGFueSkgPT4gewogICAgICAgICAgICBpZiAocmVzcG9uc2UgJiYgcmVzcG9uc2Uuc3RhdHVzID09PSA0MDEpIHsKICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgfQogICAgICAgICAgICB0aGlzLiROb3RpY2UuZXJyb3IoeyB0aXRsZTogJycsIGRlc2M6ICfmlbDmja7lr7zlh7rlpLHotKUnIH0pOwogICAgICAgIH0pOwogICAgfQoKCiAgICAvKioKICAgICAqIOWvvOWHuuaVsOaNruagvOW8j+WMlgogICAgICogCiAgICAgKiBAcGFyYW0geyp9IGZpbHRlclZhbAogICAgICogQHBhcmFtIHsqfSBqc29uRGF0YQogICAgICogQHJldHVybnMge1tdfQogICAgICogQG1lbWJlcm9mIFRYTFhZR0Jhc2UKICAgICAqLwogICAgcHVibGljIGFzeW5jIGZvcm1hdEV4Y2VsRGF0YShmaWx0ZXJWYWw6YW55LCBqc29uRGF0YTphbnkpIHsKICAgICAgICBsZXQgY29kZWxpc3RDb2x1bW5zOkFycmF5PGFueT4gPSBbCiAgICAgICAgICB7CiAgICAgICAgICAgIG5hbWU6ICd4YicsCiAgICAgICAgICAgIHNyZmtleTogJ0VockNvZGVMaXN0MDA3MicsCiAgICAgICAgICAgIGNvZGVsaXN0VHlwZSA6ICdEWU5BTUlDJywKICAgICAgICAgICAgcmVuZGVyTW9kZTogJ290aGVyJywKICAgICAgICAgICAgdGV4dFNlcGFyYXRvcjogJ+OAgScsCiAgICAgICAgICAgIHZhbHVlU2VwYXJhdG9yOiAnLCcsCiAgICAgICAgICB9LAogICAgICAgICAgewogICAgICAgICAgICBuYW1lOiAncmFuaycsCiAgICAgICAgICAgIHNyZmtleTogJ0VockNvZGVMaXN0MDAyNScsCiAgICAgICAgICAgIGNvZGVsaXN0VHlwZSA6ICdEWU5BTUlDJywKICAgICAgICAgICAgdGV4dFNlcGFyYXRvcjogJ+OAgScsCiAgICAgICAgICAgIHJlbmRlck1vZGU6ICdzdHJpbmcnLAogICAgICAgICAgICB2YWx1ZVNlcGFyYXRvcjogIjsiLAogICAgICAgICAgfSwKICAgICAgICAgIHsKICAgICAgICAgICAgbmFtZTogJ3p3JywKICAgICAgICAgICAgc3Jma2V5OiAnRWhyQ29kZUxpc3QwMjMzJywKICAgICAgICAgICAgY29kZWxpc3RUeXBlIDogJ0RZTkFNSUMnLAogICAgICAgICAgICB0ZXh0U2VwYXJhdG9yOiAn44CBJywKICAgICAgICAgICAgcmVuZGVyTW9kZTogJ3N0cmluZycsCiAgICAgICAgICAgIHZhbHVlU2VwYXJhdG9yOiAiOyIsCiAgICAgICAgICB9LAogICAgICAgICAgewogICAgICAgICAgICBuYW1lOiAnZ3cnLAogICAgICAgICAgICBzcmZrZXk6ICdFaHJDb2RlTGlzdDAwNTAnLAogICAgICAgICAgICBjb2RlbGlzdFR5cGUgOiAnRFlOQU1JQycsCiAgICAgICAgICAgIHRleHRTZXBhcmF0b3I6ICfjgIEnLAogICAgICAgICAgICByZW5kZXJNb2RlOiAnc3RyaW5nJywKICAgICAgICAgICAgdmFsdWVTZXBhcmF0b3I6ICI7IiwKICAgICAgICAgIH0sCiAgICAgICAgXTsKICAgICAgICBsZXQgX3RoaXMgPSB0aGlzOwogICAgICAgIGZvciAoY29uc3QgY29kZWxpc3Qgb2YgY29kZWxpc3RDb2x1bW5zKSB7CiAgICAgICAgICAvLyDliqjmgIHku6PnoIHooajlpITnkIYKICAgICAgICAgIGlmIChPYmplY3QuaXMoY29kZWxpc3QuY29kZWxpc3RUeXBlLCAiRFlOQU1JQyIpKSB7CiAgICAgICAgICAgICAgbGV0IGl0ZW1zID0gYXdhaXQgX3RoaXMuY29kZUxpc3RTZXJ2aWNlLmdldEl0ZW1zKGNvZGVsaXN0LnNyZmtleSk7CiAgICAgICAgICAgICAganNvbkRhdGEuZm9yRWFjaCgocm93OmFueSk9PnsKICAgICAgICAgICAgICAgICAgcm93W2NvZGVsaXN0Lm5hbWVdID0gX3RoaXMuZ2V0Q29kZWxpc3RWYWx1ZShpdGVtcywgcm93W2NvZGVsaXN0Lm5hbWVdLCBjb2RlbGlzdCk7CiAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAvLyDpnZnmgIHlpITnkIYKICAgICAgICAgIH0gZWxzZSBpZihPYmplY3QuaXMoY29kZWxpc3QuY29kZWxpc3RUeXBlLCAiU1RBVElDIikpewogICAgICAgICAgICAgIGxldCBpdGVtcyA9IGF3YWl0IF90aGlzLiRzdG9yZS5nZXR0ZXJzLmdldENvZGVMaXN0SXRlbXMoY29kZWxpc3Quc3Jma2V5KTsKICAgICAgICAgICAgICBqc29uRGF0YS5mb3JFYWNoKChyb3c6YW55KT0+ewogICAgICAgICAgICAgICAgICByb3dbY29kZWxpc3QubmFtZV0gPSBfdGhpcy5nZXRDb2RlbGlzdFZhbHVlKGl0ZW1zLCByb3dbY29kZWxpc3QubmFtZV0sIGNvZGVsaXN0KTsKICAgICAgICAgICAgICB9KTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgcmV0dXJuIGpzb25EYXRhLm1hcCgodjphbnkpID0+IGZpbHRlclZhbC5tYXAoKGo6YW55KSA9PiB2W2pdKSkKICAgIH0gICAKCgogICAgLyoqCiAgICAgKiDop6PmnpDku6PnoIHooajlkox2bGF1Ze+8jOiuvue9rml0ZW1zCiAgICAgKgogICAgICogQHB1YmxpYwogICAgICogQHBhcmFtIHthbnlbXX0gaXRlbXMg5Luj56CB6KGo5pWw5o2uCiAgICAgKiBAcGFyYW0geyp9IHZhbHVlCiAgICAgKiBAcmV0dXJucyB7Kn0KICAgICAqIEBtZW1iZXJvZiBUWExYWUdCYXNlCiAgICAgKi8KICAgIHB1YmxpYyBnZXRDb2RlbGlzdFZhbHVlKGl0ZW1zOiBhbnlbXSwgdmFsdWU6IGFueSwgY29kZWxpc3Q6IGFueSwpewogICAgICAgIGlmKCF2YWx1ZSl7CiAgICAgICAgICAgIHJldHVybiB0aGlzLiR0KCdjb2RlbGlzdC4nK2NvZGVsaXN0LnNyZmtleSsnLmVtcHR5Jyk7CiAgICAgICAgfQogICAgICAgIGlmIChpdGVtcykgewogICAgICAgICAgICBsZXQgcmVzdWx0OmFueSA9IFtdOwogICAgICAgICAgICBpZihPYmplY3QuaXMoY29kZWxpc3QucmVuZGVyTW9kZSwibnVtYmVyIikpewogICAgICAgICAgICAgICAgaXRlbXMubWFwKChfaXRlbTogYW55LCBpbmRleDogbnVtYmVyKT0+ewogICAgICAgICAgICAgICAgICAgIGNvbnN0IG5WYWx1ZSA9IHBhcnNlSW50KCh2YWx1ZSBhcyBhbnkpLCAxMCk7CiAgICAgICAgICAgICAgICAgICAgY29uc3QgY29kZXZhbHVlID0gX2l0ZW0udmFsdWU7CiAgICAgICAgICAgICAgICAgICAgaWYoKHBhcnNlSW50KGNvZGV2YWx1ZSwgMTApICYgblZhbHVlKSA+IDApewogICAgICAgICAgICAgICAgICAgICAgICByZXN1bHQucHVzaChfaXRlbSk7CiAgICAgICAgICAgICAgICAgICAgfSAKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9IGVsc2UgaWYoT2JqZWN0LmlzKGNvZGVsaXN0LnJlbmRlck1vZGUsInN0cmluZyIpKXsKICAgICAgICAgICAgICAgIGNvbnN0IGFycmF5VmFsdWU6IEFycmF5PGFueT4gPSAodmFsdWUgYXMgYW55KS5zcGxpdChjb2RlbGlzdC52YWx1ZVNlcGFyYXRvcik7CiAgICAgICAgICAgICAgICBhcnJheVZhbHVlLm1hcCgodmFsdWU6IGFueSwgaW5kZXg6IG51bWJlcikgPT4gewogICAgICAgICAgICAgICAgICAgIHJlc3VsdC5wdXNoKFtdKTsKICAgICAgICAgICAgICAgICAgICBsZXQgdmFsdWVzOiBhbnlbXSA9IE9iamVjdC5pcyh0aGlzLiR1dGlsLnR5cGVPZih2YWx1ZSksICdudW1iZXInKSA/IFt2YWx1ZV0gOiBbLi4uKHZhbHVlIGFzIGFueSkuc3BsaXQoY29kZWxpc3QudmFsdWVTZXBhcmF0b3IpXTsKICAgICAgICAgICAgICAgICAgICB2YWx1ZXMubWFwKCh2YWw6YW55ICxudW06IG51bWJlcik9PnsKICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgaXRlbSA9IHRoaXMuZ2V0SXRlbShpdGVtcywgdmFsLCBjb2RlbGlzdCk7IAogICAgICAgICAgICAgICAgICAgICAgICBpZihpdGVtKXsKICAgICAgICAgICAgICAgICAgICAgICAgICByZXN1bHRbaW5kZXhdLnB1c2goaXRlbSk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0gCiAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIGxldCB2YWx1ZXM6IGFueVtdID0gT2JqZWN0LmlzKHRoaXMuJHV0aWwudHlwZU9mKHZhbHVlKSwgJ251bWJlcicpID8gW3ZhbHVlXSA6IFsuLi4odmFsdWUgYXMgYW55KS5zcGxpdChjb2RlbGlzdC52YWx1ZVNlcGFyYXRvcildOwogICAgICAgICAgICAgICAgdmFsdWVzLm1hcCgodmFsdWU6YW55ICxpbmRleDogbnVtYmVyKT0+ewogICAgICAgICAgICAgICAgICAgIGNvbnN0IGl0ZW0gPSB0aGlzLmdldEl0ZW0oaXRlbXMsIHZhbHVlLCBjb2RlbGlzdCk7IAogICAgICAgICAgICAgICAgICAgIGlmKGl0ZW0pewogICAgICAgICAgICAgICAgICAgICAgcmVzdWx0LnB1c2goaXRlbSk7CiAgICAgICAgICAgICAgICAgICAgfSAKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9CiAgICAgICAgICAgIC8vIOiuvue9rml0ZW1zCiAgICAgICAgICAgIGlmKHJlc3VsdC5sZW5ndGggIT0gMCl7CiAgICAgICAgICAgICAgcmV0dXJuIHJlc3VsdC5qb2luKGNvZGVsaXN0LnZhbHVlU2VwYXJhdG9yKTsKICAgICAgICAgICAgfWVsc2V7CiAgICAgICAgICAgICAgcmV0dXJuIHZhbHVlOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICog6I635Y+W5Luj56CB6aG5CiAgICAgKgogICAgICogQHB1YmxpYwogICAgICogQHBhcmFtIHthbnlbXX0gaXRlbXMKICAgICAqIEBwYXJhbSB7Kn0gdmFsdWUKICAgICAqIEByZXR1cm5zIHsqfQogICAgICogQG1lbWJlcm9mIFRYTFhZR0Jhc2UKICAgICAqLwogICAgcHVibGljIGdldEl0ZW0oaXRlbXM6IGFueVtdLCB2YWx1ZTogYW55LCBjb2RlbGlzdDogYW55KTogYW55IHsKICAgICAgICBjb25zdCBhcnI6IEFycmF5PGFueT4gPSBpdGVtcy5maWx0ZXIoaXRlbSA9PiB7cmV0dXJuIGl0ZW0udmFsdWUgPT0gdmFsdWV9KTsKICAgICAgICBpZiAoYXJyLmxlbmd0aCAhPT0gMSkgewogICAgICAgICAgICByZXR1cm4gdW5kZWZpbmVkOwogICAgICAgIH0KICAgICAgICBpZihPYmplY3QuaXMoY29kZWxpc3QuY29kZWxpc3RUeXBlLCdTVEFUSUMnKSl7CiAgICAgICAgICAgIHJldHVybiB0aGlzLiR0KCdjb2RlbGlzdC4nK2NvZGVsaXN0LnNyZmtleSsnLicrYXJyWzBdLnZhbHVlKTsKICAgICAgICB9ZWxzZXsKICAgICAgICAgICAgcmV0dXJuIGFyclswXS50ZXh0OwogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIOeUn+WRveWRqOacnwogICAgICoKICAgICAqIEBtZW1iZXJvZiBUWExYWUdCYXNlCiAgICAgKi8KICAgIHB1YmxpYyBjcmVhdGVkKCk6IHZvaWQgewogICAgICAgIHRoaXMuYWZ0ZXJDcmVhdGVkKCk7CiAgICB9CgogICAgLyoqCiAgICAgKiDmiafooYxjcmVhdGVk5ZCO55qE6YC76L6RCiAgICAgKgogICAgICogIEBtZW1iZXJvZiBUWExYWUdCYXNlCiAgICAgKi8gICAgCiAgICBwdWJsaWMgYWZ0ZXJDcmVhdGVkKCl7CiAgICAgICAgdGhpcy5zZXRDb2xTdGF0ZSgpOwogICAgICAgIGlmICh0aGlzLnZpZXdTdGF0ZSkgewogICAgICAgICAgICB0aGlzLnZpZXdTdGF0ZUV2ZW50ID0gdGhpcy52aWV3U3RhdGUuc3Vic2NyaWJlKCh7IHRhZywgYWN0aW9uLCBkYXRhIH0pID0+IHsKICAgICAgICAgICAgICAgIGlmICghT2JqZWN0LmlzKHRhZywgdGhpcy5uYW1lKSkgewogICAgICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGlmIChPYmplY3QuaXMoJ2xvYWQnLCBhY3Rpb24pKSB7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5sb2FkKGRhdGEpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgaWYgKE9iamVjdC5pcygncmVtb3ZlJywgYWN0aW9uKSkgewogICAgICAgICAgICAgICAgICAgIHRoaXMucmVtb3ZlKGRhdGEpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgaWYgKE9iamVjdC5pcygnc2F2ZScsIGFjdGlvbikpIHsKICAgICAgICAgICAgICAgICAgICB0aGlzLnNhdmUoZGF0YSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0pOwogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIHZ1ZSDnlJ/lkb3lkajmnJ8KICAgICAqCiAgICAgKiBAbWVtYmVyb2YgVFhMWFlHQmFzZQogICAgICovCiAgICBwdWJsaWMgZGVzdHJveWVkKCkgewogICAgICAgIHRoaXMuYWZ0ZXJEZXN0cm95KCk7CiAgICB9CgogICAgLyoqCiAgICAgKiDmiafooYxkZXN0cm95ZWTlkI7nmoTpgLvovpEKICAgICAqCiAgICAgKiBAbWVtYmVyb2YgVFhMWFlHQmFzZQogICAgICovCiAgICBwdWJsaWMgYWZ0ZXJEZXN0cm95KCkgewogICAgICAgIGlmICh0aGlzLnZpZXdTdGF0ZUV2ZW50KSB7CiAgICAgICAgICAgIHRoaXMudmlld1N0YXRlRXZlbnQudW5zdWJzY3JpYmUoKTsKICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiDojrflj5bpgInkuK3ooYzog6HmlbDmja4KICAgICAqCiAgICAgKiBAcmV0dXJucyB7YW55W119CiAgICAgKiBAbWVtYmVyb2YgVFhMWFlHQmFzZQogICAgICovCiAgICBwdWJsaWMgZ2V0U2VsZWN0aW9uKCk6IGFueVtdIHsKICAgICAgICByZXR1cm4gdGhpcy5zZWxlY3Rpb25zOwogICAgfQoKICAgIC8qKgogICAgICog6KGM5Y+M5Ye75LqL5Lu2CiAgICAgKgogICAgICogQHBhcmFtIHsqfSAkZXZlbnQKICAgICAqIEByZXR1cm5zIHt2b2lkfQogICAgICogQG1lbWJlcm9mIFRYTFhZR0Jhc2UKICAgICAqLwogICAgcHVibGljIHJvd0RCTENsaWNrKCRldmVudDogYW55KTogdm9pZCB7CiAgICAgICAgaWYgKCEkZXZlbnQgfHwgdGhpcy5hY3R1YWxJc09wZW5FZGl0IHx8IE9iamVjdC5pcyh0aGlzLmdyaWRSb3dBY3RpdmVNb2RlLDApKSB7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICB9CiAgICAgICAgdGhpcy5zZWxlY3Rpb25zID0gW107CiAgICAgICAgdGhpcy5zZWxlY3Rpb25zLnB1c2goSlNPTi5wYXJzZShKU09OLnN0cmluZ2lmeSgkZXZlbnQpKSk7CgogICAgICAgIGNvbnN0IHJlZnM6IGFueSA9IHRoaXMuJHJlZnM7CiAgICAgICAgaWYgKHJlZnMubXVsdGlwbGVUYWJsZSkgewogICAgICAgICAgICByZWZzLm11bHRpcGxlVGFibGUuY2xlYXJTZWxlY3Rpb24oKTsKICAgICAgICAgICAgcmVmcy5tdWx0aXBsZVRhYmxlLnRvZ2dsZVJvd1NlbGVjdGlvbigkZXZlbnQpOwogICAgICAgIH0KCiAgICAgICAgdGhpcy4kZW1pdCgncm93ZGJsY2xpY2snLCB0aGlzLnNlbGVjdGlvbnMpOwogICAgICAgIHRoaXMuJGVtaXQoJ3NlbGVjdGlvbmNoYW5nZScsIHRoaXMuc2VsZWN0aW9ucyk7CiAgICB9CgogICAgLyoqCiAgICAgKiDlpI3pgInmoYbmlbDmja7pgInkuK0KICAgICAqCiAgICAgKiBAcGFyYW0geyp9ICRldmVudAogICAgICogQHJldHVybnMge3ZvaWR9CiAgICAgKiBAbWVtYmVyb2YgVFhMWFlHQmFzZQogICAgICovCiAgICBwdWJsaWMgc2VsZWN0KCRldmVudDogYW55KTogdm9pZCB7CiAgICAgICAgaWYgKCEkZXZlbnQpIHsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KICAgICAgICB0aGlzLnNlbGVjdGlvbnMgPSBbXTsKICAgICAgICB0aGlzLnNlbGVjdGlvbnMgPSBbLi4uSlNPTi5wYXJzZShKU09OLnN0cmluZ2lmeSgkZXZlbnQpKV07CiAgICAgICAgdGhpcy4kZW1pdCgnc2VsZWN0aW9uY2hhbmdlJywgdGhpcy5zZWxlY3Rpb25zKTsKICAgIH0KCiAgICAvKioKICAgICAqIOWkjemAieahhuaVsOaNruWFqOmDqOmAieS4rQogICAgICoKICAgICAqIEBwYXJhbSB7Kn0gJGV2ZW50CiAgICAgKiBAbWVtYmVyb2YgVFhMWFlHQmFzZQogICAgICovCiAgICBwdWJsaWMgc2VsZWN0QWxsKCRldmVudDogYW55KTogdm9pZCB7CiAgICAgICAgaWYgKCEkZXZlbnQpIHsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KICAgICAgICB0aGlzLnNlbGVjdGlvbnMgPSBbXTsKICAgICAgICB0aGlzLnNlbGVjdGlvbnMgPSBbLi4uSlNPTi5wYXJzZShKU09OLnN0cmluZ2lmeSgkZXZlbnQpKV07CiAgICAgICAgdGhpcy4kZW1pdCgnc2VsZWN0aW9uY2hhbmdlJywgdGhpcy5zZWxlY3Rpb25zKTsKICAgIH0KCiAgICAKICAgIC8qKgogICAgICog6KGM5Y2V5Ye76YCJ5LitCiAgICAgKgogICAgICogQHBhcmFtIHsqfSAkZXZlbnQKICAgICAqIEByZXR1cm5zIHt2b2lkfQogICAgICogQG1lbWJlcm9mIFRYTFhZR0Jhc2UKICAgICAqLwogICAgcHVibGljIHJvd0NsaWNrKCRldmVudDogYW55LCBpZkFsd2F5czogYm9vbGVhbiA9IGZhbHNlKTogdm9pZCB7CiAgICAgICAgaWYgKCFpZkFsd2F5cyAmJiAoISRldmVudCB8fCB0aGlzLmFjdHVhbElzT3BlbkVkaXQpKSB7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICB9CiAgICAgICAgaWYodGhpcy5zdG9wUm93Q2xpY2spIHsKICAgICAgICAgICAgdGhpcy5zdG9wUm93Q2xpY2sgPSBmYWxzZTsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KICAgICAgICBpZih0aGlzLmlzU2luZ2xlU2VsZWN0KXsKICAgICAgICAgICAgdGhpcy5zZWxlY3Rpb25zID0gW107CiAgICAgICAgfQogICAgICAgIC8vIOW3sumAieS4reWImeWIoOmZpO+8jOayoemAieS4reWImea3u+WKoAogICAgICAgIGxldCBzZWxlY3RJbmRleCA9IHRoaXMuc2VsZWN0aW9ucy5maW5kSW5kZXgoKGl0ZW06YW55KT0+ewogICAgICAgICAgICByZXR1cm4gT2JqZWN0LmlzKGl0ZW0ucGltcGVyc29uLCRldmVudC5waW1wZXJzb24pOwogICAgICAgIH0pOwogICAgICAgIGlmIChPYmplY3QuaXMoc2VsZWN0SW5kZXgsLTEpKXsKICAgICAgICAgIHRoaXMuc2VsZWN0aW9ucy5wdXNoKEpTT04ucGFyc2UoSlNPTi5zdHJpbmdpZnkoJGV2ZW50KSkpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICB0aGlzLnNlbGVjdGlvbnMuc3BsaWNlKHNlbGVjdEluZGV4LDEpOwogICAgICAgIH0KCiAgICAgICAgY29uc3QgcmVmczogYW55ID0gdGhpcy4kcmVmczsKICAgICAgICBpZiAocmVmcy5tdWx0aXBsZVRhYmxlKSB7CiAgICAgICAgICAgIGlmKHRoaXMuaXNTaW5nbGVTZWxlY3QpewogICAgICAgICAgICAgICAgcmVmcy5tdWx0aXBsZVRhYmxlLmNsZWFyU2VsZWN0aW9uKCk7CiAgICAgICAgICAgICAgICByZWZzLm11bHRpcGxlVGFibGUuc2V0Q3VycmVudFJvdygkZXZlbnQpOwogICAgICAgICAgICB9ZWxzZXsKICAgICAgICAgICAgICAgIHJlZnMubXVsdGlwbGVUYWJsZS50b2dnbGVSb3dTZWxlY3Rpb24oJGV2ZW50KTsgCiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIHRoaXMuJGVtaXQoJ3NlbGVjdGlvbmNoYW5nZScsIHRoaXMuc2VsZWN0aW9ucyk7CiAgICB9CgoKICAgIC8qKgogICAgICog6aG16Z2i5Y+Y5YyWCiAgICAgKgogICAgICogQHBhcmFtIHsqfSAkZXZlbnQKICAgICAqIEByZXR1cm5zIHt2b2lkfQogICAgICogQG1lbWJlcm9mIFRYTFhZR0Jhc2UKICAgICAqLwogICAgcHVibGljIHBhZ2VPbkNoYW5nZSgkZXZlbnQ6IGFueSk6IHZvaWQgewogICAgICAgIGlmICghJGV2ZW50KSB7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICB9CiAgICAgICAgaWYgKCRldmVudCA9PT0gdGhpcy5jdXJQYWdlKSB7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICB9CiAgICAgICAgdGhpcy5jdXJQYWdlID0gJGV2ZW50OwogICAgICAgIHRoaXMubG9hZCh7fSk7CiAgICB9CgogICAgLyoqCiAgICAgKiDliIbpobXmnaHmlbDlj5jljJYKICAgICAqCiAgICAgKiBAcGFyYW0geyp9ICRldmVudAogICAgICogQHJldHVybnMge3ZvaWR9CiAgICAgKiBAbWVtYmVyb2YgVFhMWFlHQmFzZQogICAgICovCiAgICBwdWJsaWMgb25QYWdlU2l6ZUNoYW5nZSgkZXZlbnQ6IGFueSk6IHZvaWQgewogICAgICAgIGlmICghJGV2ZW50KSB7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICB9CiAgICAgICAgaWYgKCRldmVudCA9PT0gdGhpcy5saW1pdCkgewogICAgICAgICAgICByZXR1cm47CiAgICAgICAgfQogICAgICAgIHRoaXMubGltaXQgPSAkZXZlbnQ7CiAgICAgICAgaWYgKHRoaXMuY3VyUGFnZSA9PT0gMSkgewogICAgICAgICAgICB0aGlzLmxvYWQoe30pOwogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIOWIhumhteWIt+aWsAogICAgICoKICAgICAqIEBtZW1iZXJvZiBUWExYWUdCYXNlCiAgICAgKi8KICAgIHB1YmxpYyBwYWdlUmVmcmVzaCgpOiB2b2lkIHsKICAgICAgICB0aGlzLmxvYWQoe30pOwogICAgfQoKICAgIC8qKgogICAgICog5o6S5bqP5Y+Y5YyWCiAgICAgKgogICAgICogQHBhcmFtIHt7IGNvbHVtbjogYW55LCBwcm9wOiBhbnksIG9yZGVyOiBhbnkgfX0geyBjb2x1bW4sIHByb3AsIG9yZGVyIH0KICAgICAqIEBtZW1iZXJvZiBUWExYWUdCYXNlCiAgICAgKi8KICAgIHB1YmxpYyBvblNvcnRDaGFuZ2UoeyBjb2x1bW4sIHByb3AsIG9yZGVyIH06IHsgY29sdW1uOiBhbnksIHByb3A6IGFueSwgb3JkZXI6IGFueSB9KTogdm9pZCB7CiAgICAgICAgY29uc3QgZGlyID0gT2JqZWN0LmlzKG9yZGVyLCAnYXNjZW5kaW5nJykgPyAnYXNjJyA6IE9iamVjdC5pcyhvcmRlciwgJ2Rlc2NlbmRpbmcnKSA/ICdkZXNjJyA6ICcnOwogICAgICAgIGlmIChPYmplY3QuaXMoZGlyLCB0aGlzLm1pbm9yU29ydERpcikgJiYgT2JqZWN0LmlzKHRoaXMubWlub3JTb3J0UFNERUYsIHByb3ApKSB7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICB9CiAgICAgICAgdGhpcy5taW5vclNvcnREaXIgPSBkaXI7CiAgICAgICAgdGhpcy5taW5vclNvcnRQU0RFRiA9IHByb3AgPyBwcm9wIDogJyc7CiAgICAgICAgdGhpcy5sb2FkKHt9KTsKICAgIH0KCiAgICAvKioKICAgICAqIOihqOagvOihjOmAieS4reagt+W8jwogICAgICoKICAgICAqIEBwYXJhbSB7eyByb3c6IGFueSwgcm93SW5kZXg6IGFueSB9fSB7IHJvdywgcm93SW5kZXggfQogICAgICogQHJldHVybnMge3N0cmluZ30KICAgICAqIEBtZW1iZXJvZiBUWExYWUdCYXNlCiAgICAgKi8KICAgIHB1YmxpYyBvblJvd0NsYXNzTmFtZSh7IHJvdywgcm93SW5kZXggfTogeyByb3c6IGFueSwgcm93SW5kZXg6IGFueSB9KTogc3RyaW5nIHsKICAgICAgICBjb25zdCBpbmRleCA9IHRoaXMuc2VsZWN0aW9ucy5maW5kSW5kZXgoKHNlbGVjdDogYW55KSA9PiBPYmplY3QuaXMoc2VsZWN0LnNyZmtleSwgcm93LnNyZmtleSkpOwogICAgICAgIHJldHVybiBpbmRleCAhPT0gLTEgPyAnZ3JpZC1yb3ctc2VsZWN0JyA6ICcnOwogICAgfQoKCgogICAgLyoqCiAgICAgKiDnlYzpnaLooYzkuLoKICAgICAqCiAgICAgKiBAcGFyYW0geyp9IHJvdwogICAgICogQHBhcmFtIHsqfSB0YWcKICAgICAqIEBwYXJhbSB7Kn0gJGV2ZW50CiAgICAgKiBAbWVtYmVyb2YgVFhMWFlHQmFzZQogICAgICovCglwdWJsaWMgdWlBY3Rpb24ocm93OiBhbnksIHRhZzogYW55LCAkZXZlbnQ6IGFueSkgewogICAgICAgIC8vIHRoaXMucm93Q2xpY2socm93LCB0cnVlKTsKICAgICAgICAkZXZlbnQuc3RvcFByb3BhZ2F0aW9uKCk7CiAgICB9CgogICAgLyoqCiAgICAgKiDorr7nva7liJfnirbmgIEKICAgICAqCiAgICAgKiBAbWVtYmVyb2YgVFhMWFlHQmFzZQogICAgICovCiAgICBwdWJsaWMgc2V0Q29sU3RhdGUoKSB7CgkJY29uc3QgX2RhdGE6IGFueSA9IGxvY2FsU3RvcmFnZS5nZXRJdGVtKCdwaW1wZXJzb25fdHhseHlnX2dyaWQnKTsKCQlpZiAoX2RhdGEpIHsKCQkJbGV0IGNvbHVtbnMgPSBKU09OLnBhcnNlKF9kYXRhKTsKCQkJY29sdW1ucy5mb3JFYWNoKChjb2w6IGFueSkgPT4gewoJCQkJbGV0IGNvbHVtbiA9IHRoaXMuYWxsQ29sdW1ucy5maW5kKChpdGVtKSA9PiBPYmplY3QuaXMoY29sLm5hbWUsIGl0ZW0ubmFtZSkpOwoJCQkJaWYgKGNvbHVtbikgewoJCQkJCU9iamVjdC5hc3NpZ24oY29sdW1uLCBjb2wpOwoJCQkJfQoJCQl9KTsKCQl9CiAgICB9CgogICAgLyoqCiAgICAgKiDliJflj5jljJYKICAgICAqCiAgICAgKiBAbWVtYmVyb2YgVFhMWFlHQmFzZQogICAgICovCiAgICBwdWJsaWMgb25Db2xDaGFuZ2UoKSB7CiAgICAgICAgbG9jYWxTdG9yYWdlLnNldEl0ZW0oJ3BpbXBlcnNvbl90eGx4eWdfZ3JpZCcsIEpTT04uc3RyaW5naWZ5KHRoaXMuYWxsQ29sdW1ucykpOwogICAgfQoKICAgIC8qKgogICAgICog6I635Y+W5YiX54q25oCBCiAgICAgKgogICAgICogQHBhcmFtIHtzdHJpbmd9IG5hbWUKICAgICAqIEByZXR1cm5zIHtib29sZWFufQogICAgICogQG1lbWJlcm9mIFRYTFhZR0Jhc2UKICAgICAqLwogICAgcHVibGljIGdldENvbHVtblN0YXRlKG5hbWU6IHN0cmluZyk6IGJvb2xlYW4gewogICAgICAgIGxldCBjb2x1bW4gPSB0aGlzLmFsbENvbHVtbnMuZmluZCgoY29sOiBhbnkpID0+CiAgICAgICAgICAgIE9iamVjdC5pcyhuYW1lLCBjb2wubmFtZSkKICAgICAgICApOwogICAgICAgIHJldHVybiBjb2x1bW4uc2hvdyA/IHRydWUgOiBmYWxzZTsKICAgIH0KCiAgICAvKioKICAgICAqIOihqOagvOWIl+aYr+WQpuiHqumAguW6lOW4g+WxgAogICAgICoKICAgICAqIEByZWFkb25seQogICAgICogQHR5cGUge2Jvb2xlYW59CiAgICAgKiBAbWVtYmVyb2YgVFhMWFlHQmFzZQogICAgICovCiAgICBnZXQgYWRhcHRpdmVTdGF0ZSgpOiBib29sZWFuIHsKICAgICAgICByZXR1cm4gIXRoaXMuYWxsQ29sdW1ucy5maW5kKChjb2x1bW46IGFueSkgPT4gY29sdW1uLnNob3cgJiYgT2JqZWN0LmlzKGNvbHVtbi51dGlsLCAnU1RBUicpKTsKICAgIH0KCiAgICAvKioKICAgICAqIOS/neWtmAogICAgICoKICAgICAqIEBwYXJhbSB7Kn0gJGV2ZW50CiAgICAgKiBAcmV0dXJucyB7UHJvbWlzZTxhbnk+fQogICAgICogQG1lbWJlcm9mIFRYTFhZR0Jhc2UKICAgICAqLwogICAgcHVibGljIGFzeW5jIHNhdmUoYXJnczogYW55W10sIHBhcmFtcz86IGFueSwgJGV2ZW50PzogYW55LCB4RGF0YT86IGFueSl7CiAgICAgICAgbGV0IF90aGlzID0gdGhpczsKICAgICAgICBpZighYXdhaXQgdGhpcy52YWxpZGF0ZUFsbCgpKXsKICAgICAgICAgICAgdGhpcy4kTm90aWNlLmVycm9yKHsgdGl0bGU6ICfplJnor68nLCBkZXNjOiAn5YC86KeE5YiZ5qCh6aqM5byC5bi4JyB9KTsKICAgICAgICAgICAgcmV0dXJuIFtdOwogICAgICAgIH0KICAgICAgICBsZXQgc3VjY2Vzc0l0ZW1zOmFueSA9IFtdOwogICAgICAgIGxldCBlcnJvckl0ZW1zOmFueSA9IFtdOwogICAgICAgIGxldCBlcnJvck1lc3NhZ2U6YW55ID0gW107CiAgICAgICAgZm9yIChjb25zdCBpdGVtIG9mIF90aGlzLml0ZW1zKSB7CiAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICBpZihPYmplY3QuaXMoaXRlbS5yb3dEYXRhU3RhdGUsICdjcmVhdGUnKSl7CiAgICAgICAgICAgICAgICAgICAgaWYoIXRoaXMuY3JlYXRlQWN0aW9uKXsKICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy4kTm90aWNlLmVycm9yKHsgdGl0bGU6ICfplJnor68nLCBkZXNjOiAnUElNUEVSU09OTFRYWUdHcmlkVmlld+inhuWbvuihqOagvGNyZWF0ZUFjdGlvbuWPguaVsOacqumFjee9ricgfSk7CiAgICAgICAgICAgICAgICAgICAgfWVsc2V7CiAgICAgICAgICAgICAgICAgICAgICBPYmplY3QuYXNzaWduKGl0ZW0se3ZpZXdwYXJhbXM6dGhpcy52aWV3cGFyYW1zfSk7CiAgICAgICAgICAgICAgICAgICAgICBsZXQgcmVzcG9uc2UgPSBhd2FpdCB0aGlzLnNlcnZpY2UuYWRkKHRoaXMuY3JlYXRlQWN0aW9uLCBKU09OLnBhcnNlKEpTT04uc3RyaW5naWZ5KHRoaXMuY29udGV4dCkpLGl0ZW0sIHRoaXMuc2hvd0J1c3lJbmRpY2F0b3IpOwogICAgICAgICAgICAgICAgICAgICAgc3VjY2Vzc0l0ZW1zLnB1c2goSlNPTi5wYXJzZShKU09OLnN0cmluZ2lmeShyZXNwb25zZS5kYXRhKSkpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH1lbHNlIGlmKE9iamVjdC5pcyhpdGVtLnJvd0RhdGFTdGF0ZSwgJ3VwZGF0ZScpKXsKICAgICAgICAgICAgICAgICAgICBpZighdGhpcy51cGRhdGVBY3Rpb24pewogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLiROb3RpY2UuZXJyb3IoeyB0aXRsZTogJ+mUmeivrycsIGRlc2M6ICdQSU1QRVJTT05MVFhZR0dyaWRWaWV36KeG5Zu+6KGo5qC8dXBkYXRlQWN0aW9u5Y+C5pWw5pyq6YWN572uJyB9KTsKICAgICAgICAgICAgICAgICAgICB9ZWxzZXsKICAgICAgICAgICAgICAgICAgICAgICAgT2JqZWN0LmFzc2lnbihpdGVtLHt2aWV3cGFyYW1zOnRoaXMudmlld3BhcmFtc30pOwogICAgICAgICAgICAgICAgICAgICAgICBpZihpdGVtLnBpbXBlcnNvbil7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBPYmplY3QuYXNzaWduKHRoaXMuY29udGV4dCx7cGltcGVyc29uOml0ZW0ucGltcGVyc29ufSk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgbGV0IHJlc3BvbnNlID0gYXdhaXQgdGhpcy5zZXJ2aWNlLmFkZCh0aGlzLnVwZGF0ZUFjdGlvbixKU09OLnBhcnNlKEpTT04uc3RyaW5naWZ5KHRoaXMuY29udGV4dCkpLGl0ZW0sIHRoaXMuc2hvd0J1c3lJbmRpY2F0b3IpOwogICAgICAgICAgICAgICAgICAgICAgICBzdWNjZXNzSXRlbXMucHVzaChKU09OLnBhcnNlKEpTT04uc3RyaW5naWZ5KHJlc3BvbnNlLmRhdGEpKSk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9IGNhdGNoIChlcnJvcikgewogICAgICAgICAgICAgICAgZXJyb3JJdGVtcy5wdXNoKEpTT04ucGFyc2UoSlNPTi5zdHJpbmdpZnkoaXRlbSkpKTsKICAgICAgICAgICAgICAgIGVycm9yTWVzc2FnZS5wdXNoKGVycm9yKTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICB0aGlzLiRlbWl0KCdzYXZlJywgc3VjY2Vzc0l0ZW1zKTsKICAgICAgICB0aGlzLnJlZnJlc2goW10pOwogICAgICAgIGlmKGVycm9ySXRlbXMubGVuZ3RoID09PSAwKXsKICAgICAgICAgICAgdGhpcy4kTm90aWNlLnN1Y2Nlc3MoeyB0aXRsZTogJycsIGRlc2M6ICfkv53lrZjmiJDlip8hJyB9KTsKICAgICAgICB9ZWxzZXsKICAgICAgICAgIGVycm9ySXRlbXMuZm9yRWFjaCgoaXRlbTphbnksaW5kZXg6bnVtYmVyKT0+ewogICAgICAgICAgICB0aGlzLiROb3RpY2UuZXJyb3IoeyB0aXRsZTogJ+S/neWtmOWksei0pScsIGRlc2M6IGl0ZW0ubWFqb3JlbnRpdHluYW1lKyfkv53lrZjlpLHotKXvvIEnIH0pOwogICAgICAgICAgICBjb25zb2xlLmVycm9yKGVycm9yTWVzc2FnZVtpbmRleF0pOwogICAgICAgICAgfSk7CiAgICAgICAgfQogICAgICAgIHJldHVybiBzdWNjZXNzSXRlbXM7CiAgICB9CgogICAgLyoqCiAgICAgKiDmlrDlu7rooYwKICAgICAqCiAgICAgKiBAcGFyYW0geyp9ICRldmVudAogICAgICogQHJldHVybnMge3ZvaWR9CiAgICAgKiBAbWVtYmVyb2YgVFhMWFlHQmFzZQogICAgICovCiAgICBwdWJsaWMgbmV3Um93KGFyZ3M6IGFueVtdLCBwYXJhbXM/OiBhbnksICRldmVudD86IGFueSwgeERhdGE/OiBhbnkpOiB2b2lkIHsKICAgICAgICBpZighdGhpcy5sb2FkZHJhZnRBY3Rpb24pewogICAgICAgICAgICB0aGlzLiROb3RpY2UuZXJyb3IoeyB0aXRsZTogJ+mUmeivrycsIGRlc2M6ICdQSU1QRVJTT05MVFhZR0dyaWRWaWV36KeG5Zu+6KGo5qC8bG9hZGRyYWZ0QWN0aW9u5Y+C5pWw5pyq6YWN572uJyB9KTsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KICAgICAgICBsZXQgX3RoaXMgPSB0aGlzOwogICAgICAgIE9iamVjdC5hc3NpZ24oYXJnc1swXSx7dmlld3BhcmFtczp0aGlzLnZpZXdwYXJhbXN9KTsKICAgICAgICBsZXQgcG9zdDogUHJvbWlzZTxhbnk+ID0gdGhpcy5zZXJ2aWNlLmxvYWREcmFmdCh0aGlzLmxvYWRkcmFmdEFjdGlvbiwgSlNPTi5wYXJzZShKU09OLnN0cmluZ2lmeSh0aGlzLmNvbnRleHQpKSwgYXJnc1swXSwgdGhpcy5zaG93QnVzeUluZGljYXRvcik7CiAgICAgICAgcG9zdC50aGVuKChyZXNwb25zZTogYW55KSA9PiB7CiAgICAgICAgICAgIGlmICghcmVzcG9uc2Uuc3RhdHVzIHx8IHJlc3BvbnNlLnN0YXR1cyAhPT0gMjAwKSB7CiAgICAgICAgICAgICAgICBpZiAocmVzcG9uc2UuZXJyb3JNZXNzYWdlKSB7CiAgICAgICAgICAgICAgICAgICAgdGhpcy4kTm90aWNlLmVycm9yKHsgdGl0bGU6ICfplJnor68nLCBkZXNjOiByZXNwb25zZS5lcnJvck1lc3NhZ2UgfSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgIH0KICAgICAgICAgICAgY29uc3QgZGF0YSA9IHJlc3BvbnNlLmRhdGE7CiAgICAgICAgICAgIHRoaXMuY3JlYXRlRGVmYXVsdChkYXRhKTsKICAgICAgICAgICAgZGF0YS5yb3dEYXRhU3RhdGUgPSAiY3JlYXRlIjsKICAgICAgICAgICAgX3RoaXMuaXRlbXMucHVzaChkYXRhKTsKICAgICAgICAgICAgX3RoaXMuZ3JpZEl0ZW1zTW9kZWwucHVzaChfdGhpcy5nZXRHcmlkUm93TW9kZWwoKSk7CiAgICAgICAgfSkuY2F0Y2goKHJlc3BvbnNlOiBhbnkpID0+IHsKICAgICAgICAgICAgaWYgKHJlc3BvbnNlICYmIHJlc3BvbnNlLnN0YXR1cyA9PT0gNDAxKSB7CiAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKCFyZXNwb25zZSB8fCAhcmVzcG9uc2Uuc3RhdHVzIHx8ICFyZXNwb25zZS5kYXRhKSB7CiAgICAgICAgICAgICAgICB0aGlzLiROb3RpY2UuZXJyb3IoeyB0aXRsZTogJ+mUmeivrycsIGRlc2M6ICfns7vnu5/lvILluLgnIH0pOwogICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICB9CiAgICAgICAgfSk7CiAgICB9CgogICAgLyoqCiAgICAgKiDooajmoLznvJbovpHpobnlgLzlj5jmm7QKICAgICAqICAKICAgICAqIEBwYXJhbSByb3cg6KGM5pWw5o2uCiAgICAgKiBAcGFyYW0ge3sgbmFtZTogc3RyaW5nLCB2YWx1ZTogYW55IH19ICRldmVudAogICAgICogQHJldHVybnMge3ZvaWR9CiAgICAgKiBAbWVtYmVyb2YgVFhMWFlHQmFzZQogICAgICovCiAgICBwdWJsaWMgb25HcmlkSXRlbVZhbHVlQ2hhbmdlKHJvdzogYW55LCRldmVudDogeyBuYW1lOiBzdHJpbmcsIHZhbHVlOiBhbnkgfSxyb3dJbmRleDogbnVtYmVyKTogdm9pZCB7CiAgICAgICAgaWYgKCEkZXZlbnQpIHsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KICAgICAgICBpZiAoISRldmVudC5uYW1lIHx8IE9iamVjdC5pcygkZXZlbnQubmFtZSwgJycpIHx8ICFyb3cuaGFzT3duUHJvcGVydHkoJGV2ZW50Lm5hbWUpKSB7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICB9CiAgICAgICAgcm93WyRldmVudC5uYW1lXSA9ICRldmVudC52YWx1ZTsKICAgICAgICB0aGlzLmdyaWRFZGl0SXRlbUNoYW5nZShyb3csICRldmVudC5uYW1lLCAkZXZlbnQudmFsdWUsIHJvd0luZGV4KTsKICAgIH0KCiAgICAvKioKICAgICAqIOihqOagvOe8lui+kemhueWAvOWPmOWMlgogICAgICoKICAgICAqIEBwdWJsaWMKICAgICAqIEBwYXJhbSByb3cg6KGM5pWw5o2uCiAgICAgKiBAcGFyYW0gcHJvcGVydHkg5YiX57yW6L6R6aG55ZCNCiAgICAgKiBAcGFyYW0gcm93IOWIl+e8lui+kemhueWAvAogICAgICogQHJldHVybnMge3ZvaWR9CiAgICAgKiBAbWVtYmVyb2YgVFhMWFlHQmFzZQogICAgICovCiAgICBwdWJsaWMgZ3JpZEVkaXRJdGVtQ2hhbmdlKHJvdzogYW55LCBwcm9wZXJ0eTogc3RyaW5nLCB2YWx1ZTogYW55LCByb3dJbmRleDogbnVtYmVyKXsKICAgICAgICByb3cucm93RGF0YVN0YXRlID0gcm93LnJvd0RhdGFTdGF0ZSA/IHJvdy5yb3dEYXRhU3RhdGUgOiAidXBkYXRlIiA7CiAgICAgICAgdGhpcy52YWxpZGF0ZShwcm9wZXJ0eSxyb3cscm93SW5kZXgpOwogICAgfQoKICAgIC8qKgogICAgICog6KGo5qC857yW6L6R6aG55pu05pawCiAgICAgKgogICAgICogQHBhcmFtIHtzdHJpbmd9IG1vZGUg55WM6Z2i6KGM5Li65ZCN56ewCiAgICAgKiBAcGFyYW0geyp9IFtkYXRhPXt9XSDor7fmsYLmlbDmja4KICAgICAqIEBwYXJhbSB7c3RyaW5nW119IHVwZGF0ZURldGFpbHMg5pu05paw6aG5CiAgICAgKiBAcGFyYW0ge2Jvb2xlYW59IFtzaG93bG9hZGluZ10g5piv5ZCm5pi+56S65Yqg6L2954q25oCBCiAgICAgKiBAcmV0dXJucyB7dm9pZH0KICAgICAqIEBtZW1iZXJvZiBUWExYWUdCYXNlCiAgICAgKi8KICAgIHB1YmxpYyB1cGRhdGVHcmlkRWRpdEl0ZW0obW9kZTogc3RyaW5nLCBkYXRhOiBhbnkgPSB7fSwgdXBkYXRlRGV0YWlsczogc3RyaW5nW10sIHNob3dsb2FkaW5nPzogYm9vbGVhbik6IHZvaWQgewogICAgICAgIGlmICghbW9kZSB8fCAobW9kZSAmJiBPYmplY3QuaXMobW9kZSwgJycpKSkgewogICAgICAgICAgICByZXR1cm47CiAgICAgICAgfQogICAgICAgIGNvbnN0IGFyZzogYW55ID0gSlNPTi5wYXJzZShKU09OLnN0cmluZ2lmeShkYXRhKSk7CiAgICAgICAgT2JqZWN0LmFzc2lnbihhcmcse3ZpZXdwYXJhbXM6dGhpcy52aWV3cGFyYW1zfSk7CiAgICAgICAgY29uc3QgcG9zdDogUHJvbWlzZTxhbnk+ID0gdGhpcy5zZXJ2aWNlLmZyb250TG9naWMobW9kZSxKU09OLnBhcnNlKEpTT04uc3RyaW5naWZ5KHRoaXMuY29udGV4dCkpLGFyZywgc2hvd2xvYWRpbmcpOwogICAgICAgIHBvc3QudGhlbigocmVzcG9uc2U6IGFueSkgPT4gewogICAgICAgICAgICBpZiAoIXJlc3BvbnNlIHx8IHJlc3BvbnNlLnN0YXR1cyAhPT0gMjAwKSB7CiAgICAgICAgICAgICAgICB0aGlzLiROb3RpY2UuZXJyb3IoeyB0aXRsZTogJ+mUmeivrycsIGRlc2M6ICfooajljZXpobnmm7TmlrDlpLHotKUnIH0pOwogICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGNvbnN0IF9kYXRhOiBhbnkgPSByZXNwb25zZS5kYXRhOwogICAgICAgICAgICBpZighX2RhdGEpewogICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHVwZGF0ZURldGFpbHMuZm9yRWFjaCgobmFtZTogc3RyaW5nKSA9PiB7CiAgICAgICAgICAgICAgICBpZiAoIV9kYXRhLmhhc093blByb3BlcnR5KG5hbWUpKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgZGF0YVtuYW1lXSA9IF9kYXRhW25hbWVdOwogICAgICAgICAgICB9KTsKICAgICAgICB9KS5jYXRjaCgocmVzcG9uc2U6IGFueSkgPT4gewogICAgICAgICAgICBpZiAocmVzcG9uc2UgJiYgcmVzcG9uc2Uuc3RhdHVzID09PSA0MDEpIHsKICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAoIXJlc3BvbnNlIHx8ICFyZXNwb25zZS5zdGF0dXMgfHwgIXJlc3BvbnNlLmRhdGEpIHsKICAgICAgICAgICAgICAgIHRoaXMuJE5vdGljZS5lcnJvcih7IHRpdGxlOiAn6ZSZ6K+vJywgZGVzYzogJ+ezu+e7n+W8guW4uCcgfSk7CiAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgIH0KICAgICAgICB9KTsKICAgIH0KCiAgICAvKioKICAgICAqIOiOt+WPluWvueW6lOihjGNsYXNzCiAgICAgKgogICAgICogQHBhcmFtIHsqfSAkYXJncyByb3cg6KGM5pWw5o2u77yMcm93SW5kZXgg6KGM57Si5byVCiAgICAgKiBAcmV0dXJucyB7dm9pZH0KICAgICAqIEBtZW1iZXJvZiBUWExYWUdCYXNlCiAgICAgKi8KICAgIHB1YmxpYyBnZXRSb3dDbGFzc05hbWUoYXJnczp7cm93OiBhbnkscm93SW5kZXg6IG51bWJlcn0pewogICAgICAgIGxldCBpc1NlbGVjdGVkID0gdGhpcy5zZWxlY3Rpb25zLnNvbWUoKGl0ZW06YW55KT0+ewogICAgICAgICAgICByZXR1cm4gT2JqZWN0LmlzKGl0ZW0ucGltcGVyc29uLGFyZ3Mucm93LnBpbXBlcnNvbik7CiAgICAgICAgfSk7CiAgICAgICAgcmV0dXJuIGlzU2VsZWN0ZWQgPyAiZ3JpZC1zZWxlY3RlZC1yb3ciIDogIiI7CiAgICB9CgogICAgLyoqCiAgICAgKiDojrflj5blr7nlupTliJdjbGFzcwogICAgICoKICAgICAqIEBwYXJhbSB7Kn0gJGFyZ3Mgcm93IOihjOaVsOaNru+8jGNvbHVtbiDliJfmlbDmja7vvIxyb3dJbmRleCDooYzntKLlvJXvvIzliJfntKLlvJUKICAgICAqIEByZXR1cm5zIHt2b2lkfQogICAgICogQG1lbWJlcm9mIFRYTFhZR0Jhc2UKICAgICAqLwogICAgcHVibGljIGdldENlbGxDbGFzc05hbWUoYXJnczp7cm93OiBhbnksIGNvbHVtbjogYW55LCByb3dJbmRleDogbnVtYmVyLCBjb2x1bW5JbmRleDpudW1iZXJ9KXsKICAgICAgICBsZXQgaGFzUm93RWRpdDphbnkgPSB7CiAgICAgICAgICAneWdiaCc6ZmFsc2UsCiAgICAgICAgICAncGltcGVyc29ubmFtZSc6ZmFsc2UsCiAgICAgICAgICAneGInOmZhbHNlLAogICAgICAgICAgJ25qJzpmYWxzZSwKICAgICAgICAgICdwb3N0YWxhZGRyZXNzJzpmYWxzZSwKICAgICAgICAgICdyZXRpcGxhY2UnOmZhbHNlLAogICAgICAgICAgJ2p0bHhyJzpmYWxzZSwKICAgICAgICAgICdqdGx4cmRoJzpmYWxzZSwKICAgICAgICAgICd6emR6cyc6ZmFsc2UsCiAgICAgICAgICAnb3Jtb3Jnc2VjdG9ybmFtZSc6ZmFsc2UsCiAgICAgICAgICAncmFuayc6ZmFsc2UsCiAgICAgICAgICAnencnOmZhbHNlLAogICAgICAgICAgJ2d3JzpmYWxzZSwKICAgICAgICAgICd0eGRxJzpmYWxzZSwKICAgICAgICAgICdzanR4cnEnOmZhbHNlLAogICAgICAgICAgJ2x4ZGgnOmZhbHNlLAogICAgICAgICAgJ3NwZHlsamUnOmZhbHNlLAogICAgICAgIH0KICAgICAgICByZXR1cm4gKCBoYXNSb3dFZGl0W2FyZ3MuY29sdW1uLnByb3BlcnR5XSAmJiB0aGlzLmFjdHVhbElzT3BlbkVkaXQgKSA/ICJlZGl0LWNlbGwiIDogImluZm8tY2VsbCI7CiAgICB9CgogICAgLyoqCiAgICAgKiDmlrDlu7rpu5jorqTlgLwKICAgICAqIEBwYXJhbSB7Kn0gIHJvdyDooYzmlbDmja4KICAgICAqIEBtZW1iZXJvZiBUWExYWUdCYXNlCiAgICAgKi8KICAgIHB1YmxpYyBjcmVhdGVEZWZhdWx0KHJvdzogYW55KXsgICAgICAgICAgICAgICAgICAgIAogICAgfQp9Cg=="},null]}
{"remainingRequest":"F:\\crod项目\\人事管理系统2\\iBizEHR\\app_EHRPim\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!F:\\crod项目\\人事管理系统2\\iBizEHR\\app_EHRPim\\src\\widgets\\orm-duty\\main-grid\\main-grid-base.vue?vue&type=script&lang=tsx&","dependencies":[{"path":"F:\\crod项目\\人事管理系统2\\iBizEHR\\app_EHRPim\\src\\widgets\\orm-duty\\main-grid\\main-grid-base.vue","mtime":1630509410989},{"path":"F:\\crod项目\\人事管理系统2\\iBizEHR\\app_EHRPim\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1630511852775},{"path":"F:\\crod项目\\人事管理系统2\\iBizEHR\\app_EHRPim\\node_modules\\thread-loader\\dist\\cjs.js","mtime":1630511853252},{"path":"F:\\crod项目\\人事管理系统2\\iBizEHR\\app_EHRPim\\node_modules\\babel-loader\\lib\\index.js","mtime":1630511852747},{"path":"F:\\crod项目\\人事管理系统2\\iBizEHR\\app_EHRPim\\node_modules\\ts-loader\\index.js","mtime":1630511985412},{"path":"F:\\crod项目\\人事管理系统2\\iBizEHR\\app_EHRPim\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1630511852775},{"path":"F:\\crod项目\\人事管理系统2\\iBizEHR\\app_EHRPim\\node_modules\\vue-loader\\lib\\index.js","mtime":1630512070338}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:CgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCmltcG9ydCB7IFZ1ZSwgQ29tcG9uZW50LCBQcm9wLCBQcm92aWRlLCBFbWl0LCBXYXRjaCwgTW9kZWwsSW5qZWN0IH0gZnJvbSAndnVlLXByb3BlcnR5LWRlY29yYXRvcic7CmltcG9ydCB7IENyZWF0ZUVsZW1lbnQgfSBmcm9tICd2dWUnOwppbXBvcnQgeyBTdWJqZWN0LCBTdWJzY3JpcHRpb24gfSBmcm9tICdyeGpzJzsKaW1wb3J0IHsgQ29udHJvbEludGVyZmFjZSB9IGZyb20gJ0AvaW50ZXJmYWNlL2NvbnRyb2wnOwppbXBvcnQgeyBVSUFjdGlvblRvb2wsVXRpbCB9IGZyb20gJ0AvdXRpbHMnOwppbXBvcnQgTmF2RGF0YVNlcnZpY2UgZnJvbSAnQC9zZXJ2aWNlL2FwcC9uYXZkYXRhLXNlcnZpY2UnOwppbXBvcnQgT3JtRHV0eVNlcnZpY2UgZnJvbSAnQC9zZXJ2aWNlL29ybS1kdXR5L29ybS1kdXR5LXNlcnZpY2UnOwppbXBvcnQgTWFpblNlcnZpY2UgZnJvbSAnLi9tYWluLWdyaWQtc2VydmljZSc7CgppbXBvcnQgQ29kZUxpc3RTZXJ2aWNlIGZyb20gIkBzZXJ2aWNlL2FwcC9jb2RlbGlzdC1zZXJ2aWNlIjsKaW1wb3J0IHsgRm9ybUl0ZW1Nb2RlbCB9IGZyb20gJ0AvbW9kZWwvZm9ybS1kZXRhaWwnOwoKCkBDb21wb25lbnQoewogICAgY29tcG9uZW50czogewogICAgICAKICAgIH0KfSkKZXhwb3J0IGRlZmF1bHQgY2xhc3MgTWFpbkJhc2UgZXh0ZW5kcyBWdWUgaW1wbGVtZW50cyBDb250cm9sSW50ZXJmYWNlIHsKCiAgICAvKioKICAgICAqIOWQjeensAogICAgICoKICAgICAqIEB0eXBlIHtzdHJpbmd9CiAgICAgKiBAbWVtYmVyb2YgTWFpbkJhc2UKICAgICAqLwogICAgQFByb3AoKSBwdWJsaWMgbmFtZT86IHN0cmluZzsKCiAgICAvKioKICAgICAqIOinhuWbvumAmuiur+WvueixoQogICAgICoKICAgICAqIEB0eXBlIHtTdWJqZWN0PFZpZXdTdGF0ZT59CiAgICAgKiBAbWVtYmVyb2YgTWFpbkJhc2UKICAgICAqLwogICAgQFByb3AoKSBwdWJsaWMgdmlld1N0YXRlITogU3ViamVjdDxWaWV3U3RhdGU+OwoKICAgIC8qKgogICAgICog5bqU55So5LiK5LiL5paHCiAgICAgKgogICAgICogQHR5cGUgeyp9CiAgICAgKiBAbWVtYmVyb2YgTWFpbkJhc2UKICAgICAqLwogICAgQFByb3AoKSBwdWJsaWMgY29udGV4dDogYW55OwoKICAgIC8qKgogICAgICog6KeG5Zu+5Y+C5pWwCiAgICAgKgogICAgICogQHR5cGUgeyp9CiAgICAgKiBAbWVtYmVyb2YgTWFpbkJhc2UKICAgICAqLwogICAgQFByb3AoKSBwdWJsaWMgdmlld3BhcmFtczogYW55OwoKICAgIC8qKgogICAgICog6KeG5Zu+54q25oCB5LqL5Lu2CiAgICAgKgogICAgICogQHB1YmxpYwogICAgICogQHR5cGUgeyhTdWJzY3JpcHRpb24gfCB1bmRlZmluZWQpfQogICAgICogQG1lbWJlcm9mIE1haW5CYXNlCiAgICAgKi8KICAgIHB1YmxpYyB2aWV3U3RhdGVFdmVudDogU3Vic2NyaXB0aW9uIHwgdW5kZWZpbmVkOwoKICAgIC8qKgogICAgICog6I635Y+W6YOo5Lu257G75Z6LCiAgICAgKgogICAgICogQHJldHVybnMge3N0cmluZ30KICAgICAqIEBtZW1iZXJvZiBNYWluQmFzZQogICAgICovCiAgICBwdWJsaWMgZ2V0Q29udHJvbFR5cGUoKTogc3RyaW5nIHsKICAgICAgICByZXR1cm4gJ0dSSUQnCiAgICB9CgoKCiAgICAvKioKICAgICAqIOiuoeaVsOWZqOacjeWKoeWvueixoembhuWQiAogICAgICoKICAgICAqIEB0eXBlIHtBcnJheTwqPn0KICAgICAqIEBtZW1iZXJvZiBNYWluQmFzZQogICAgICovICAgIAogICAgcHVibGljIGNvdW50ZXJTZXJ2aWNlQXJyYXk6QXJyYXk8YW55PiA9IFtdOwoKICAgIC8qKgogICAgICog5bu65p6E6YOo5Lu25pyN5Yqh5a+56LGhCiAgICAgKgogICAgICogQHR5cGUge01haW5TZXJ2aWNlfQogICAgICogQG1lbWJlcm9mIE1haW5CYXNlCiAgICAgKi8KICAgIHB1YmxpYyBzZXJ2aWNlOiBNYWluU2VydmljZSA9IG5ldyBNYWluU2VydmljZSh7ICRzdG9yZTogdGhpcy4kc3RvcmUgfSk7CgogICAgLyoqCiAgICAgKiDlrp7kvZPmnI3liqHlr7nosaEKICAgICAqCiAgICAgKiBAdHlwZSB7T3JtRHV0eVNlcnZpY2V9CiAgICAgKiBAbWVtYmVyb2YgTWFpbkJhc2UKICAgICAqLwogICAgcHVibGljIGFwcEVudGl0eVNlcnZpY2U6IE9ybUR1dHlTZXJ2aWNlID0gbmV3IE9ybUR1dHlTZXJ2aWNlKHsgJHN0b3JlOiB0aGlzLiRzdG9yZSB9KTsKICAgIAoKCiAgICAvKioKICAgICAqIOWFs+mXreinhuWbvgogICAgICoKICAgICAqIEBwYXJhbSB7YW55fSBhcmdzCiAgICAgKiBAbWVtYmVyb2YgTWFpbkJhc2UKICAgICAqLwogICAgcHVibGljIGNsb3NlVmlldyhhcmdzOiBhbnkpOiB2b2lkIHsKICAgICAgICBsZXQgX3RoaXM6IGFueSA9IHRoaXM7CiAgICAgICAgX3RoaXMuJGVtaXQoJ2Nsb3NldmlldycsIFthcmdzXSk7CiAgICB9CgogICAgLyoqCiAgICAgKiAg6K6h5pWw5Zmo5Yi35pawCiAgICAgKgogICAgICogQG1lbWJlcm9mIE1haW5CYXNlCiAgICAgKi8KICAgIHB1YmxpYyBjb3VudGVyUmVmcmVzaCgpewogICAgICAgIGNvbnN0IF90aGlzOmFueSA9dGhpczsKICAgICAgICBpZihfdGhpcy5jb3VudGVyU2VydmljZUFycmF5ICYmIF90aGlzLmNvdW50ZXJTZXJ2aWNlQXJyYXkubGVuZ3RoID4wKXsKICAgICAgICAgICAgX3RoaXMuY291bnRlclNlcnZpY2VBcnJheS5mb3JFYWNoKChpdGVtOmFueSkgPT57CiAgICAgICAgICAgICAgICBpZihpdGVtLnJlZnJlc2hEYXRhICYmIGl0ZW0ucmVmcmVzaERhdGEgaW5zdGFuY2VvZiBGdW5jdGlvbil7CiAgICAgICAgICAgICAgICAgICAgaXRlbS5yZWZyZXNoRGF0YSgpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9KQogICAgICAgIH0KICAgIH0KCgogICAgLyoqCiAgICAgKiDku6PnoIHooajmnI3liqHlr7nosaEKICAgICAqCiAgICAgKiBAdHlwZSB7Q29kZUxpc3RTZXJ2aWNlfQogICAgICogQG1lbWJlcm9mIE1haW5CYXNlCiAgICAgKi8gIAogICAgcHVibGljIGNvZGVMaXN0U2VydmljZTpDb2RlTGlzdFNlcnZpY2UgPSBuZXcgQ29kZUxpc3RTZXJ2aWNlKHsgJHN0b3JlOiB0aGlzLiRzdG9yZSB9KTsKCiAgICAvKioKICAgICAqIOiOt+WPluWkmumhueaVsOaNrgogICAgICoKICAgICAqIEByZXR1cm5zIHthbnlbXX0KICAgICAqIEBtZW1iZXJvZiBNYWluQmFzZQogICAgICovCiAgICBwdWJsaWMgZ2V0RGF0YXMoKTogYW55W10gewogICAgICAgIHJldHVybiB0aGlzLnNlbGVjdGlvbnM7CiAgICB9CgogICAgLyoqCiAgICAgKiDojrflj5bljZXpobnmoJEKICAgICAqCiAgICAgKiBAcmV0dXJucyB7Kn0KICAgICAqIEBtZW1iZXJvZiBNYWluQmFzZQogICAgICovCiAgICBwdWJsaWMgZ2V0RGF0YSgpOiBhbnkgewogICAgICAgIHJldHVybiB0aGlzLnNlbGVjdGlvbnNbMF07CiAgICB9CgoKICAgIC8qKgogICAgICog5pi+56S65aSE55CG5o+Q56S6CiAgICAgKgogICAgICogQHR5cGUge2Jvb2xlYW59CiAgICAgKiBAbWVtYmVyb2YgTWFpbkJhc2UKICAgICAqLwogICAgQFByb3AoeyBkZWZhdWx0OiB0cnVlIH0pIHB1YmxpYyBzaG93QnVzeUluZGljYXRvcj86IGJvb2xlYW47CgogICAgLyoqCiAgICAgKiDpg6jku7booYzkuLotLXVwZGF0ZQogICAgICoKICAgICAqIEB0eXBlIHtzdHJpbmd9CiAgICAgKiBAbWVtYmVyb2YgTWFpbkJhc2UKICAgICAqLwogICAgQFByb3AoKSBwdWJsaWMgdXBkYXRlQWN0aW9uITogc3RyaW5nOwogICAgCiAgICAvKioKICAgICAqIOmDqOS7tuihjOS4ui0tZmV0Y2gKICAgICAqCiAgICAgKiBAdHlwZSB7c3RyaW5nfQogICAgICogQG1lbWJlcm9mIE1haW5CYXNlCiAgICAgKi8KICAgIEBQcm9wKCkgcHVibGljIGZldGNoQWN0aW9uITogc3RyaW5nOwogICAgCiAgICAvKioKICAgICAqIOmDqOS7tuihjOS4ui0tcmVtb3ZlCiAgICAgKgogICAgICogQHR5cGUge3N0cmluZ30KICAgICAqIEBtZW1iZXJvZiBNYWluQmFzZQogICAgICovCiAgICBAUHJvcCgpIHB1YmxpYyByZW1vdmVBY3Rpb24hOiBzdHJpbmc7CiAgICAKICAgIC8qKgogICAgICog6YOo5Lu26KGM5Li6LS1sb2FkCiAgICAgKgogICAgICogQHR5cGUge3N0cmluZ30KICAgICAqIEBtZW1iZXJvZiBNYWluQmFzZQogICAgICovCiAgICBAUHJvcCgpIHB1YmxpYyBsb2FkQWN0aW9uITogc3RyaW5nOwogICAgCiAgICAvKioKICAgICAqIOmDqOS7tuihjOS4ui0tbG9hZGRyYWZ0CiAgICAgKgogICAgICogQHR5cGUge3N0cmluZ30KICAgICAqIEBtZW1iZXJvZiBNYWluQmFzZQogICAgICovCiAgICBAUHJvcCgpIHB1YmxpYyBsb2FkZHJhZnRBY3Rpb24hOiBzdHJpbmc7CiAgICAKICAgIC8qKgogICAgICog6YOo5Lu26KGM5Li6LS1jcmVhdGUKICAgICAqCiAgICAgKiBAdHlwZSB7c3RyaW5nfQogICAgICogQG1lbWJlcm9mIE1haW5CYXNlCiAgICAgKi8KICAgIEBQcm9wKCkgcHVibGljIGNyZWF0ZUFjdGlvbiE6IHN0cmluZzsKCiAgICAvKioKICAgICAqIOW9k+WJjemhtQogICAgICoKICAgICAqIEB0eXBlIHtudW1iZXJ9CiAgICAgKiBAbWVtYmVyb2YgTWFpbkJhc2UKICAgICAqLwogICAgcHVibGljIGN1clBhZ2U6IG51bWJlciA9IDE7CgogICAgLyoqCiAgICAgKiDmlbDmja4KICAgICAqCiAgICAgKiBAdHlwZSB7YW55W119CiAgICAgKiBAbWVtYmVyb2YgTWFpbkJhc2UKICAgICAqLwogICAgcHVibGljIGl0ZW1zOiBhbnlbXSA9IFtdOwoKICAgIC8qKgogICAgICog5piv5ZCm5pSv5oyB5YiG6aG1CiAgICAgKgogICAgICogQHR5cGUge2Jvb2xlYW59CiAgICAgKiBAbWVtYmVyb2YgTWFpbkJhc2UKICAgICAqLwogICAgcHVibGljIGlzRW5hYmxlUGFnaW5nQmFyOiBib29sZWFuID0gdHJ1ZTsKCiAgICAvKioKICAgICAqIOaYr+WQpuemgeeUqOaOkuW6jwogICAgICoKICAgICAqIEB0eXBlIHtib29sZWFufQogICAgICogQG1lbWJlcm9mIE1haW5CYXNlCiAgICAgKi8KICAgIHB1YmxpYyBpc05vU29ydDogYm9vbGVhbiA9IGZhbHNlOwoKICAgIC8qKgogICAgICog5o6S5bqP5pa55ZCRCiAgICAgKgogICAgICogQHR5cGUge3N0cmluZ30KICAgICAqIEBtZW1iZXJvZiBNYWluQmFzZQogICAgICovCiAgICBwdWJsaWMgbWlub3JTb3J0RGlyOiBzdHJpbmcgPSAnQVNDJzsKCiAgICAvKioKICAgICAqIOaOkuW6j+Wtl+autQogICAgICoKICAgICAqIEB0eXBlIHtzdHJpbmd9CiAgICAgKiBAbWVtYmVyb2YgTWFpbkJhc2UKICAgICAqLwogICAgcHVibGljIG1pbm9yU29ydFBTREVGOiBzdHJpbmcgPSAneGgnOwoKICAgIC8qKgogICAgICog5YiG6aG15p2h5pWwCiAgICAgKgogICAgICogQHR5cGUge251bWJlcn0KICAgICAqIEBtZW1iZXJvZiBNYWluQmFzZQogICAgICovCiAgICBwdWJsaWMgbGltaXQ6IG51bWJlciA9IDEwMDsKCiAgICAvKioKICAgICAqIOaYr+WQpuaYvuekuuagh+mimAogICAgICoKICAgICAqIEB0eXBlIHtib29sZWFufQogICAgICogQG1lbWJlcm9mIE1haW5CYXNlCiAgICAgKi8KICAgIHB1YmxpYyBpc0hpZGVIZWFkZXI6IGJvb2xlYW4gPSBmYWxzZTsKCiAgICAvKioKICAgICAqIOaYr+WQpum7mOiupOmAieS4reesrOS4gOadoeaVsOaNrgogICAgICoKICAgICAqIEB0eXBlIHtib29sZWFufQogICAgICogQG1lbWJlcm9mIE1haW5CYXNlCiAgICAgKi8KICAgIEBQcm9wKHsgZGVmYXVsdDogZmFsc2UgfSkgcHVibGljIGlzU2VsZWN0Rmlyc3REZWZhdWx0ITogYm9vbGVhbjsKCiAgICAvKioKICAgICAqIOaYr+WQpuWNlemAiQogICAgICoKICAgICAqIEB0eXBlIHtib29sZWFufQogICAgICogQG1lbWJlcm9mIE1haW5CYXNlCiAgICAgKi8KICAgIEBQcm9wKCkgcHVibGljIGlzU2luZ2xlU2VsZWN0PzogYm9vbGVhbjsKCiAgICAvKioKICAgICAqIOmAieS4reaVsOaNruWtl+espuS4sgogICAgICoKICAgICAqIEB0eXBlIHtzdHJpbmd9CiAgICAgKiBAbWVtYmVyb2YgTWFpbkJhc2UKICAgICAqLwogICAgQFByb3AoKSBwdWJsaWMgc2VsZWN0ZWREYXRhPzogc3RyaW5nOwoKICAgIC8qKgogICAgICog6YCJ5Lit5YC85Y+Y5YyWCiAgICAgKgogICAgICogQHBhcmFtIHsqfSBuZXdWYWwKICAgICAqIEBwYXJhbSB7Kn0gb2xkVmFsCiAgICAgKiBAbWVtYmVyb2YgTWFpbkJhc2UKICAgICAqLwogICAgQFdhdGNoKCdzZWxlY3RlZERhdGEnKQogICAgcHVibGljIG9uVmFsdWVDaGFuZ2UobmV3VmFsOiBhbnksIG9sZFZhbDogYW55KSB7CiAgICAgICAgdGhpcy5zZWxlY3Rpb25zID0gW107CiAgICAgICAgaWYodGhpcy5zZWxlY3RlZERhdGEpewogICAgICAgICAgICBjb25zdCByZWZzOiBhbnkgPSB0aGlzLiRyZWZzOwogICAgICAgICAgICBpZiAocmVmcy5tdWx0aXBsZVRhYmxlKSB7CiAgICAgICAgICAgICAgICByZWZzLm11bHRpcGxlVGFibGUuY2xlYXJTZWxlY3Rpb24oKTsKICAgICAgICAgICAgICAgIEpTT04ucGFyc2UodGhpcy5zZWxlY3RlZERhdGEpLmZvckVhY2goKHNlbGVjdGlvbjphbnkpPT57CiAgICAgICAgICAgICAgICAgICAgbGV0IHNlbGVjdGVkSXRlbSA9IHRoaXMuaXRlbXMuZmluZCgoaXRlbTphbnkpPT57CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBPYmplY3QuaXMoaXRlbS5zcmZrZXksIHNlbGVjdGlvbi5zcmZrZXkpOwogICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgIGlmKHNlbGVjdGVkSXRlbSl7CiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMucm93Q2xpY2soc2VsZWN0ZWRJdGVtKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIOihqOagvOihjOaVsOaNrum7mOiupOa/gOa0u+aooeW8jwogICAgICogMCDkuI3mv4DmtLsKICAgICAqIDEg5Y2V5Ye75r+A5rS7CiAgICAgKiAyIOWPjOWHu+a/gOa0uwogICAgICoKICAgICAqIEB0eXBlIHsobnVtYmVyIHwgMCB8IDEgfCAyKX0KICAgICAqIEBtZW1iZXJvZiBNYWluQmFzZQogICAgICovCiAgICBAUHJvcCh7ZGVmYXVsdDogMn0pIHB1YmxpYyBncmlkUm93QWN0aXZlTW9kZSE6IG51bWJlcjsKCiAgICAvKioKICAgICAqIOaYr+WQpuW8gOWQr+ihjOe8lui+kQogICAgICoKICAgICAqIEB0eXBlIHtib29sZWFufQogICAgICogQG1lbWJlcm9mIE1haW5CYXNlCiAgICAgKi8KICAgIEBQcm9wKHtkZWZhdWx0OiBmYWxzZX0pIHB1YmxpYyBpc09wZW5FZGl0ITogYm9vbGVhbjsKCiAgICAvKioKICAgICAqIOWunumZheaYr+WQpuW8gOWQr+ihjOe8lui+kQogICAgICoKICAgICAqIEB0eXBlIHtib29sZWFufQogICAgICogQG1lbWJlcm9mIE1haW5CYXNlCiAgICAgKi8KICAgIHB1YmxpYyBhY3R1YWxJc09wZW5FZGl0OiBib29sZWFuID0gdGhpcy5pc09wZW5FZGl0OwoKICAgIC8qKgogICAgICog5oC75p2h5pWwCiAgICAgKgogICAgICogQHR5cGUge251bWJlcn0KICAgICAqIEBtZW1iZXJvZiBNYWluQmFzZQogICAgICovCiAgICBwdWJsaWMgdG90YWxyb3c6IG51bWJlciA9IDA7CgogICAgLyoqCiAgICAgKiDpgInkuK3ooYzmlbDmja4KICAgICAqCiAgICAgKiBAdHlwZSB7YW55W119CiAgICAgKiBAbWVtYmVyb2YgTWFpbgogICAgICovCiAgICBwdWJsaWMgc2VsZWN0aW9uczogYW55W10gPSBbXTsKCiAgICAvKioKICAgICAqIOaLpuaIquihjOmAieS4rQogICAgICoKICAgICAqIEB0eXBlIHtib29sZWFufQogICAgICogQG1lbWJlcm9mIE1haW4KICAgICAqLwogICAgcHVibGljIHN0b3BSb3dDbGljazogYm9vbGVhbiA9IGZhbHNlOwoKCgoKICAgIC8qKgogICAgICog6KGo5qC85piv5ZCm5pi+56S6CiAgICAgKgogICAgICogQHR5cGUge2Jvb2xlYW59CiAgICAgKiBAbWVtYmVyb2YgTWFpbkJhc2UKICAgICAqLwogICAgcHVibGljIGlzRGlzcGxheTpib29sZWFuID0gdHJ1ZTsKCiAgICAvKioKICAgICAqIOmDqOS7tuWIt+aWsAogICAgICoKICAgICAqIEBwYXJhbSB7YW55W119IGFyZ3MKICAgICAqIEBtZW1iZXJvZiBNYWluQmFzZQogICAgICovCiAgICBwdWJsaWMgcmVmcmVzaChhcmdzOiBhbnlbXSk6IHZvaWQgewogICAgICAgIHRoaXMubG9hZCgpOwogICAgfQoKICAgIC8qKgogICAgKiDpgInpobnmoYbliJflrr0KICAgICoKICAgICogQHR5cGUge251bWJlcn0KICAgICogQG1lbWJlcm9mIEFwcEluZGV4CiAgICAqLwogICAgcHVibGljIGNoZWNrYm94Q29sV2lkdGg6IG51bWJlciA9IDM0OwoKICAgIC8qKgogICAgICog5piv5ZCm5YWB6K645ouW5Yqo5YiX5a69CiAgICAgKgogICAgICogQHR5cGUge2Jvb2xlYW59CiAgICAgKiBAbWVtYmVyb2YgQXBwRW1iZWRQaWNrZXIKICAgICAqLwogICAgcHVibGljIGlzRHJhZ2VuZENvbDogYm9vbGVhbiA9IGZhbHNlOwoKICAgIC8qKgogICAgICog5omA5pyJ5YiX5oiQ5ZGYCiAgICAgKgogICAgICogQHR5cGUge2FueVtdfQogICAgICogQG1lbWJlcm9mIE1haW5CYXNlCiAgICAgKi8KICAgIHB1YmxpYyBhbGxDb2x1bW5zOiBhbnlbXSA9IFsKICAgICAgICB7CiAgICAgICAgICAgIG5hbWU6ICd4aCcsCiAgICAgICAgICAgIGxhYmVsOiAn5o6S5bqPJywKICAgICAgICAgICAgbGFuZ3RhZzogJ2VudGl0aWVzLm9ybWR1dHkubWFpbl9ncmlkLmNvbHVtbnMueGgnLAogICAgICAgICAgICBzaG93OiB0cnVlLAogICAgICAgICAgICB1dGlsOiAnUFgnCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgIG5hbWU6ICdmZ2x4JywKICAgICAgICAgICAgbGFiZWw6ICfogYzliqHnvJbnoIEnLAogICAgICAgICAgICBsYW5ndGFnOiAnZW50aXRpZXMub3JtZHV0eS5tYWluX2dyaWQuY29sdW1ucy5mZ2x4JywKICAgICAgICAgICAgc2hvdzogdHJ1ZSwKICAgICAgICAgICAgdXRpbDogJ1BYJwogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICBuYW1lOiAnb3JtZHV0eW5hbWUnLAogICAgICAgICAgICBsYWJlbDogJ+iBjOWKoeWQjeensCcsCiAgICAgICAgICAgIGxhbmd0YWc6ICdlbnRpdGllcy5vcm1kdXR5Lm1haW5fZ3JpZC5jb2x1bW5zLm9ybWR1dHluYW1lJywKICAgICAgICAgICAgc2hvdzogdHJ1ZSwKICAgICAgICAgICAgdXRpbDogJ1BYJwogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICBuYW1lOiAndXBkYXRlbWFuJywKICAgICAgICAgICAgbGFiZWw6ICfmm7TmlrDkuronLAogICAgICAgICAgICBsYW5ndGFnOiAnZW50aXRpZXMub3JtZHV0eS5tYWluX2dyaWQuY29sdW1ucy51cGRhdGVtYW4nLAogICAgICAgICAgICBzaG93OiB0cnVlLAogICAgICAgICAgICB1dGlsOiAnUFgnCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgIG5hbWU6ICd1cGRhdGVkYXRlJywKICAgICAgICAgICAgbGFiZWw6ICfmm7TmlrDml7bpl7QnLAogICAgICAgICAgICBsYW5ndGFnOiAnZW50aXRpZXMub3JtZHV0eS5tYWluX2dyaWQuY29sdW1ucy51cGRhdGVkYXRlJywKICAgICAgICAgICAgc2hvdzogdHJ1ZSwKICAgICAgICAgICAgdXRpbDogJ1BYJwogICAgICAgIH0sCiAgICBdCgogICAgLyoqCiAgICAgKiDooajmoLzmqKHlnovpm4blkIgKICAgICAqCiAgICAgKiBAdHlwZSB7Kn0KICAgICAqIEBtZW1iZXJvZiBNYWluQmFzZQogICAgICovCiAgICBwdWJsaWMgZ3JpZEl0ZW1zTW9kZWw6IGFueVtdID0gW107CgogICAgLyoqCiAgICAgKiDojrflj5booajmoLzooYzmqKHlnosKICAgICAqCiAgICAgKiBAdHlwZSB7Kn0KICAgICAqIEBtZW1iZXJvZiBNYWluQmFzZQogICAgICovCiAgICBwdWJsaWMgZ2V0R3JpZFJvd01vZGVsKCl7CiAgICAgICAgcmV0dXJuIHsKICAgICAgICAgIHhoOiBuZXcgRm9ybUl0ZW1Nb2RlbCgpLAogICAgICAgICAgZmdseDogbmV3IEZvcm1JdGVtTW9kZWwoKSwKICAgICAgICAgIHNyZmtleTogbmV3IEZvcm1JdGVtTW9kZWwoKSwKICAgICAgICAgIG9ybWR1dHluYW1lOiBuZXcgRm9ybUl0ZW1Nb2RlbCgpLAogICAgICAgICAgendsYjogbmV3IEZvcm1JdGVtTW9kZWwoKSwKICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiDlsZ7mgKflgLzop4TliJkKICAgICAqCiAgICAgKiBAdHlwZSB7Kn0KICAgICAqIEBtZW1iZXJvZiBNYWluQmFzZQogICAgICovCiAgICBwdWJsaWMgcnVsZXM6IGFueSA9IHsKICAgICAgICB4aDogWwogICAgICAgICAgICAgeyByZXF1aXJlZDogZmFsc2UsIHZhbGlkYXRvcjogKHJ1bGU6YW55LCB2YWx1ZTphbnksIGNhbGxiYWNrOmFueSkgPT4geyByZXR1cm4gKHJ1bGUucmVxdWlyZWQgJiYgKHZhbHVlID09PSBudWxsIHx8IHZhbHVlID09PSB1bmRlZmluZWQgfHwgdmFsdWUgPT09ICIiKSkgPyBmYWxzZSA6IHRydWU7fSwgbWVzc2FnZTogJ+aOkuW6jyDlgLzkuI3og73kuLrnqbonLCB0cmlnZ2VyOiAnY2hhbmdlJyB9LAogICAgICAgICAgICB7IHJlcXVpcmVkOiBmYWxzZSwgdmFsaWRhdG9yOiAocnVsZTphbnksIHZhbHVlOmFueSwgY2FsbGJhY2s6YW55KSA9PiB7IHJldHVybiAocnVsZS5yZXF1aXJlZCAmJiAodmFsdWUgPT09IG51bGwgfHwgdmFsdWUgPT09IHVuZGVmaW5lZCB8fCB2YWx1ZSA9PT0gIiIpKSA/IGZhbHNlIDogdHJ1ZTt9LCBtZXNzYWdlOiAn5o6S5bqPIOWAvOS4jeiDveS4uuepuicsIHRyaWdnZXI6ICdibHVyJyB9LAogICAgICAgIF0sCiAgICAgICAgZmdseDogWwogICAgICAgICAgICAgeyByZXF1aXJlZDogZmFsc2UsIHZhbGlkYXRvcjogKHJ1bGU6YW55LCB2YWx1ZTphbnksIGNhbGxiYWNrOmFueSkgPT4geyByZXR1cm4gKHJ1bGUucmVxdWlyZWQgJiYgKHZhbHVlID09PSBudWxsIHx8IHZhbHVlID09PSB1bmRlZmluZWQgfHwgdmFsdWUgPT09ICIiKSkgPyBmYWxzZSA6IHRydWU7fSwgbWVzc2FnZTogJ+iBjOWKoee8lueggSDlgLzkuI3og73kuLrnqbonLCB0cmlnZ2VyOiAnY2hhbmdlJyB9LAogICAgICAgICAgICB7IHJlcXVpcmVkOiBmYWxzZSwgdmFsaWRhdG9yOiAocnVsZTphbnksIHZhbHVlOmFueSwgY2FsbGJhY2s6YW55KSA9PiB7IHJldHVybiAocnVsZS5yZXF1aXJlZCAmJiAodmFsdWUgPT09IG51bGwgfHwgdmFsdWUgPT09IHVuZGVmaW5lZCB8fCB2YWx1ZSA9PT0gIiIpKSA/IGZhbHNlIDogdHJ1ZTt9LCBtZXNzYWdlOiAn6IGM5Yqh57yW56CBIOWAvOS4jeiDveS4uuepuicsIHRyaWdnZXI6ICdibHVyJyB9LAogICAgICAgIF0sCiAgICAgICAgc3Jma2V5OiBbCiAgICAgICAgICAgICB7IHJlcXVpcmVkOiBmYWxzZSwgdmFsaWRhdG9yOiAocnVsZTphbnksIHZhbHVlOmFueSwgY2FsbGJhY2s6YW55KSA9PiB7IHJldHVybiAocnVsZS5yZXF1aXJlZCAmJiAodmFsdWUgPT09IG51bGwgfHwgdmFsdWUgPT09IHVuZGVmaW5lZCB8fCB2YWx1ZSA9PT0gIiIpKSA/IGZhbHNlIDogdHJ1ZTt9LCBtZXNzYWdlOiAn6IGM5Yqh5qCH6K+GIOWAvOS4jeiDveS4uuepuicsIHRyaWdnZXI6ICdjaGFuZ2UnIH0sCiAgICAgICAgICAgIHsgcmVxdWlyZWQ6IGZhbHNlLCB2YWxpZGF0b3I6IChydWxlOmFueSwgdmFsdWU6YW55LCBjYWxsYmFjazphbnkpID0+IHsgcmV0dXJuIChydWxlLnJlcXVpcmVkICYmICh2YWx1ZSA9PT0gbnVsbCB8fCB2YWx1ZSA9PT0gdW5kZWZpbmVkIHx8IHZhbHVlID09PSAiIikpID8gZmFsc2UgOiB0cnVlO30sIG1lc3NhZ2U6ICfogYzliqHmoIfor4Yg5YC85LiN6IO95Li656m6JywgdHJpZ2dlcjogJ2JsdXInIH0sCiAgICAgICAgXSwKICAgICAgICBvcm1kdXR5bmFtZTogWwogICAgICAgICAgICAgeyByZXF1aXJlZDogZmFsc2UsIHZhbGlkYXRvcjogKHJ1bGU6YW55LCB2YWx1ZTphbnksIGNhbGxiYWNrOmFueSkgPT4geyByZXR1cm4gKHJ1bGUucmVxdWlyZWQgJiYgKHZhbHVlID09PSBudWxsIHx8IHZhbHVlID09PSB1bmRlZmluZWQgfHwgdmFsdWUgPT09ICIiKSkgPyBmYWxzZSA6IHRydWU7fSwgbWVzc2FnZTogJ+iBjOWKoeWQjeensCDlgLzkuI3og73kuLrnqbonLCB0cmlnZ2VyOiAnY2hhbmdlJyB9LAogICAgICAgICAgICB7IHJlcXVpcmVkOiBmYWxzZSwgdmFsaWRhdG9yOiAocnVsZTphbnksIHZhbHVlOmFueSwgY2FsbGJhY2s6YW55KSA9PiB7IHJldHVybiAocnVsZS5yZXF1aXJlZCAmJiAodmFsdWUgPT09IG51bGwgfHwgdmFsdWUgPT09IHVuZGVmaW5lZCB8fCB2YWx1ZSA9PT0gIiIpKSA/IGZhbHNlIDogdHJ1ZTt9LCBtZXNzYWdlOiAn6IGM5Yqh5ZCN56ewIOWAvOS4jeiDveS4uuepuicsIHRyaWdnZXI6ICdibHVyJyB9LAogICAgICAgIF0sCiAgICAgICAgendsYjogWwogICAgICAgICAgICAgeyByZXF1aXJlZDogZmFsc2UsIHZhbGlkYXRvcjogKHJ1bGU6YW55LCB2YWx1ZTphbnksIGNhbGxiYWNrOmFueSkgPT4geyByZXR1cm4gKHJ1bGUucmVxdWlyZWQgJiYgKHZhbHVlID09PSBudWxsIHx8IHZhbHVlID09PSB1bmRlZmluZWQgfHwgdmFsdWUgPT09ICIiKSkgPyBmYWxzZSA6IHRydWU7fSwgbWVzc2FnZTogJ+iBjOWKoeWxgue6pyDlgLzkuI3og73kuLrnqbonLCB0cmlnZ2VyOiAnY2hhbmdlJyB9LAogICAgICAgICAgICB7IHJlcXVpcmVkOiBmYWxzZSwgdmFsaWRhdG9yOiAocnVsZTphbnksIHZhbHVlOmFueSwgY2FsbGJhY2s6YW55KSA9PiB7IHJldHVybiAocnVsZS5yZXF1aXJlZCAmJiAodmFsdWUgPT09IG51bGwgfHwgdmFsdWUgPT09IHVuZGVmaW5lZCB8fCB2YWx1ZSA9PT0gIiIpKSA/IGZhbHNlIDogdHJ1ZTt9LCBtZXNzYWdlOiAn6IGM5Yqh5bGC57qnIOWAvOS4jeiDveS4uuepuicsIHRyaWdnZXI6ICdibHVyJyB9LAogICAgICAgIF0sCiAgICB9CgogICAgLyoqCiAgICAgKiDooajmoLzooYznvJbovpHpobnmoKHpqowKICAgICAqCiAgICAgKiBAcGFyYW0ge3N0cmluZ30gcHJvcGVydHkg5bGe5oCn5ZCNCiAgICAgKiBAcGFyYW0geyp9IGRhdGEg6KGM5pWw5o2uCiAgICAgKiBAcGFyYW0ge251bWJlcn0gcm93SW5kZXgg6KGM57Si5byVCiAgICAgKiBAcmV0dXJucyBQcm9taXNlPGFueT4KICAgICAqIAogICAgICogQG1lbWJlcm9mIE1haW5CYXNlCiAgICAgKi8KICAgIHB1YmxpYyB2YWxpZGF0ZShwcm9wZXJ0eTpzdHJpbmcsIGRhdGE6YW55LCByb3dJbmRleDpudW1iZXIpOlByb21pc2U8YW55PnsKICAgICAgICByZXR1cm4gbmV3IFByb21pc2UoKHJlc29sdmUsIHJlamVjdCkgPT4gewogICAgICAgICAgICB0aGlzLiR1dGlsLnZhbGlkYXRlSXRlbShwcm9wZXJ0eSxkYXRhLHRoaXMucnVsZXMpLnRoZW4oKCk9PnsKICAgICAgICAgICAgICAgIHRoaXMuZ3JpZEl0ZW1zTW9kZWxbcm93SW5kZXhdW3Byb3BlcnR5XS5zZXRFcnJvcihudWxsKTsKICAgICAgICAgICAgICAgIHJlc29sdmUodHJ1ZSk7CiAgICAgICAgICAgIH0pLmNhdGNoKCh7IGVycm9ycywgZmllbGRzIH0pID0+IHsKICAgICAgICAgICAgICAgIHRoaXMuZ3JpZEl0ZW1zTW9kZWxbcm93SW5kZXhdW3Byb3BlcnR5XS5zZXRFcnJvcihlcnJvcnNbMF0ubWVzc2FnZSk7CiAgICAgICAgICAgICAgICByZXNvbHZlKGZhbHNlKTsKICAgICAgICAgICAgfSk7CiAgICAgICAgfSk7CiAgICB9CgogICAgLyoqCiAgICAgKiDmoKHpqozmiYDmnInkv67mlLnov4fnmoTnvJbovpHpobkKICAgICAqCiAgICAgKiBAcmV0dXJucyBQcm9taXNlPGFueT4KICAgICAqIEBtZW1iZXJvZiBNYWluQmFzZQogICAgICovCiAgICBwdWJsaWMgYXN5bmMgdmFsaWRhdGVBbGwoKXsKICAgICAgICBsZXQgdmFsaWRhdGVTdGF0ZSA9IHRydWU7CiAgICAgICAgbGV0IGluZGV4ID0gLTE7CiAgICAgICAgZm9yKGxldCBpdGVtIG9mIHRoaXMuaXRlbXMpewogICAgICAgICAgaW5kZXgrKzsKICAgICAgICAgIGlmKGl0ZW0ucm93RGF0YVN0YXRlID09PSAiY3JlYXRlIiB8fCBpdGVtLnJvd0RhdGFTdGF0ZSA9PT0gInVwZGF0ZSIpewogICAgICAgICAgICBmb3IobGV0IHByb3BlcnR5IG9mIE9iamVjdC5rZXlzKHRoaXMucnVsZXMpKXsKICAgICAgICAgICAgICBpZighYXdhaXQgdGhpcy52YWxpZGF0ZShwcm9wZXJ0eSxpdGVtLGluZGV4KSl7CiAgICAgICAgICAgICAgICB2YWxpZGF0ZVN0YXRlID0gZmFsc2U7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIHJldHVybiB2YWxpZGF0ZVN0YXRlOwogICAgfQoKICAgIC8qKgogICAgICog6KGo5qC85pWw5o2u5Yqg6L29CiAgICAgKgogICAgICogQHBhcmFtIHsqfSBbYXJnPXt9XQogICAgICogQG1lbWJlcm9mIE1haW5CYXNlCiAgICAgKi8KICAgIHB1YmxpYyBsb2FkKG9wdDogYW55ID0ge30sIHBhZ2VSZXNldDogYm9vbGVhbiA9IGZhbHNlKTogdm9pZCB7CiAgICAgICAgaWYoIXRoaXMuZmV0Y2hBY3Rpb24pewogICAgICAgICAgICB0aGlzLiROb3RpY2UuZXJyb3IoeyB0aXRsZTogJ+mUmeivrycsIGRlc2M6ICdPUk1EVVRZT3JtT3JnU2VjdG9yUGlja3VwR3JpZFZpZXfop4blm77ooajmoLxmZXRjaEFjdGlvbuWPguaVsOacqumFjee9ricgfSk7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICB9CiAgICAgICAgaWYocGFnZVJlc2V0KXsKICAgICAgICAgICAgdGhpcy5jdXJQYWdlID0gMTsKICAgICAgICB9CiAgICAgICAgY29uc3QgYXJnOiBhbnkgPSB7Li4ub3B0fTsKICAgICAgICBjb25zdCBwYWdlOiBhbnkgPSB7fTsKICAgICAgICBpZiAodGhpcy5pc0VuYWJsZVBhZ2luZ0JhcikgewogICAgICAgICAgICBPYmplY3QuYXNzaWduKHBhZ2UsIHsgcGFnZTogdGhpcy5jdXJQYWdlLTEsIHNpemU6IHRoaXMubGltaXQgfSk7CiAgICAgICAgfQogICAgICAgIC8vIOiuvue9ruaOkuW6jwogICAgICAgIGlmICghdGhpcy5pc05vU29ydCAmJiAhT2JqZWN0LmlzKHRoaXMubWlub3JTb3J0RGlyLCAnJykgJiYgIU9iamVjdC5pcyh0aGlzLm1pbm9yU29ydFBTREVGLCAnJykpIHsKICAgICAgICAgICAgY29uc3Qgc29ydDogc3RyaW5nID0gdGhpcy5taW5vclNvcnRQU0RFRisiLCIrdGhpcy5taW5vclNvcnREaXI7CiAgICAgICAgICAgIE9iamVjdC5hc3NpZ24ocGFnZSwgeyBzb3J0OiBzb3J0IH0pOwogICAgICAgIH0KICAgICAgICBPYmplY3QuYXNzaWduKGFyZywgcGFnZSk7CiAgICAgICAgY29uc3QgcGFyZW50ZGF0YTogYW55ID0ge307CiAgICAgICAgdGhpcy4kZW1pdCgnYmVmb3JlbG9hZCcsIHBhcmVudGRhdGEpOwogICAgICAgIE9iamVjdC5hc3NpZ24oYXJnLCBwYXJlbnRkYXRhKTsKICAgICAgICBsZXQgdGVtcFZpZXdQYXJhbXM6YW55ID0gcGFyZW50ZGF0YS52aWV3cGFyYW1zP3BhcmVudGRhdGEudmlld3BhcmFtczp7fTsKICAgICAgICBPYmplY3QuYXNzaWduKHRlbXBWaWV3UGFyYW1zLEpTT04ucGFyc2UoSlNPTi5zdHJpbmdpZnkodGhpcy52aWV3cGFyYW1zKSkpOwogICAgICAgIE9iamVjdC5hc3NpZ24oYXJnLHt2aWV3cGFyYW1zOnRlbXBWaWV3UGFyYW1zfSk7CiAgICAgICAgY29uc3QgcG9zdDogUHJvbWlzZTxhbnk+ID0gdGhpcy5zZXJ2aWNlLnNlYXJjaCh0aGlzLmZldGNoQWN0aW9uLEpTT04ucGFyc2UoSlNPTi5zdHJpbmdpZnkodGhpcy5jb250ZXh0KSksIGFyZywgdGhpcy5zaG93QnVzeUluZGljYXRvcik7CiAgICAgICAgcG9zdC50aGVuKChyZXNwb25zZTogYW55KSA9PiB7CiAgICAgICAgICAgIGlmICghcmVzcG9uc2Uuc3RhdHVzIHx8IHJlc3BvbnNlLnN0YXR1cyAhPT0gMjAwKSB7CiAgICAgICAgICAgICAgICBpZiAocmVzcG9uc2UuZXJyb3JNZXNzYWdlKSB7CiAgICAgICAgICAgICAgICAgICAgdGhpcy4kTm90aWNlLmVycm9yKHsgdGl0bGU6ICfplJnor68nLCBkZXNjOiByZXNwb25zZS5lcnJvck1lc3NhZ2UgfSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgIH0KICAgICAgICAgICAgY29uc3QgZGF0YTogYW55ID0gcmVzcG9uc2UuZGF0YTsKICAgICAgICAgICAgdGhpcy50b3RhbHJvdyA9IHJlc3BvbnNlLnRvdGFsOwogICAgICAgICAgICB0aGlzLml0ZW1zID0gSlNPTi5wYXJzZShKU09OLnN0cmluZ2lmeShkYXRhKSk7CiAgICAgICAgICAgIC8vIOa4heepunNlbGVjdGlvbnMsZ3JpZEl0ZW1zTW9kZWwKICAgICAgICAgICAgdGhpcy5zZWxlY3Rpb25zID0gW107CiAgICAgICAgICAgIHRoaXMuZ3JpZEl0ZW1zTW9kZWwgPSBbXTsKICAgICAgICAgICAgdGhpcy5pdGVtcy5mb3JFYWNoKCgpPT57dGhpcy5ncmlkSXRlbXNNb2RlbC5wdXNoKHRoaXMuZ2V0R3JpZFJvd01vZGVsKCkpfSk7CiAgICAgICAgICAgIHRoaXMuJGVtaXQoJ2xvYWQnLCB0aGlzLml0ZW1zKTsKICAgICAgICAgICAgLy8g6K6+572u6buY6K6k6YCJ5LitCiAgICAgICAgICAgIGxldCBfdGhpcyA9IHRoaXM7CiAgICAgICAgICAgIHNldFRpbWVvdXQoKCkgPT4gewogICAgICAgICAgICAgICAgaWYoX3RoaXMuaXNTZWxlY3RGaXJzdERlZmF1bHQpewogICAgICAgICAgICAgICAgICBfdGhpcy5yb3dDbGljayhfdGhpcy5pdGVtc1swXSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBpZihfdGhpcy5zZWxlY3RlZERhdGEpewogICAgICAgICAgICAgICAgICAgIGNvbnN0IHJlZnM6IGFueSA9IF90aGlzLiRyZWZzOwogICAgICAgICAgICAgICAgICAgIGlmIChyZWZzLm11bHRpcGxlVGFibGUpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmVmcy5tdWx0aXBsZVRhYmxlLmNsZWFyU2VsZWN0aW9uKCk7CiAgICAgICAgICAgICAgICAgICAgICAgIEpTT04ucGFyc2UoX3RoaXMuc2VsZWN0ZWREYXRhKS5mb3JFYWNoKChzZWxlY3Rpb246YW55KT0+ewogICAgICAgICAgICAgICAgICAgICAgICAgICAgbGV0IHNlbGVjdGVkSXRlbSA9IF90aGlzLml0ZW1zLmZpbmQoKGl0ZW06YW55KT0+ewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBPYmplY3QuaXMoaXRlbS5zcmZrZXksIHNlbGVjdGlvbi5zcmZrZXkpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZihzZWxlY3RlZEl0ZW0pewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIF90aGlzLnJvd0NsaWNrKHNlbGVjdGVkSXRlbSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSwgMzAwKTsKICAgICAgICB9KS5jYXRjaCgocmVzcG9uc2U6IGFueSkgPT4gewogICAgICAgICAgICBpZiAocmVzcG9uc2UgJiYgcmVzcG9uc2Uuc3RhdHVzID09PSA0MDEpIHsKICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgfQogICAgICAgICAgICB0aGlzLiROb3RpY2UuZXJyb3IoeyB0aXRsZTogJ+mUmeivrycsIGRlc2M6IHJlc3BvbnNlLmVycm9yTWVzc2FnZSB9KTsKICAgICAgICB9KTsKICAgIH0KCiAgICAvKioKICAgICAqIOWIoOmZpAogICAgICoKICAgICAqIEBwYXJhbSB7YW55W119IGRhdGFzCiAgICAgKiBAcmV0dXJucyB7UHJvbWlzZTxhbnk+fQogICAgICogQG1lbWJlcm9mIE1haW5CYXNlCiAgICAgKi8KICAgIHB1YmxpYyBhc3luYyByZW1vdmUoZGF0YXM6IGFueVtdKTogUHJvbWlzZTxhbnk+IHsKICAgICAgICBpZighdGhpcy5yZW1vdmVBY3Rpb24pewogICAgICAgICAgICB0aGlzLiROb3RpY2UuZXJyb3IoeyB0aXRsZTogJ+mUmeivrycsIGRlc2M6ICdPUk1EVVRZT3JtT3JnU2VjdG9yUGlja3VwR3JpZFZpZXfop4blm77ooajmoLxyZW1vdmVBY3Rpb27lj4LmlbDmnKrphY3nva4nIH0pOwogICAgICAgICAgICByZXR1cm47CiAgICAgICAgfQogICAgICAgIGxldCBfZGF0YXM6YW55W10gPSBbXTsKICAgICAgICBkYXRhcy5mb3JFYWNoKChyZWNvcmQ6IGFueSwgaW5kZXg6IG51bWJlcikgPT4gewogICAgICAgICAgICBpZiAoT2JqZWN0LmlzKHJlY29yZC5zcmZ1ZiwiMCIpKSB7CiAgICAgICAgICAgICAgICB0aGlzLml0ZW1zLnNvbWUoKHZhbDogYW55LCBudW06IG51bWJlcikgPT57CiAgICAgICAgICAgICAgICAgICAgaWYoSlNPTi5zdHJpbmdpZnkodmFsKSA9PSBKU09OLnN0cmluZ2lmeShyZWNvcmQpKXsKICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5pdGVtcy5zcGxpY2UobnVtLDEpOwogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmdyaWRJdGVtc01vZGVsLnNwbGljZShudW0sMSk7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0pOyAKICAgICAgICAgICAgfWVsc2V7CiAgICAgICAgICAgICAgIF9kYXRhcy5wdXNoKGRhdGFzW2luZGV4XSk7CiAgICAgICAgICAgIH0KICAgICAgICB9KTsKICAgICAgICBpZiAoX2RhdGFzLmxlbmd0aCA9PT0gMCkgewogICAgICAgICAgICByZXR1cm47CiAgICAgICAgfQogICAgICAgIGxldCBkYXRhSW5mbyA9ICcnOwogICAgICAgIF9kYXRhcy5mb3JFYWNoKChyZWNvcmQ6IGFueSwgaW5kZXg6IG51bWJlcikgPT4gewogICAgICAgICAgICBsZXQgc3JmbWFqb3J0ZXh0ID0gcmVjb3JkLm9ybWR1dHluYW1lOwogICAgICAgICAgICBpZiAoaW5kZXggPCA1KSB7CiAgICAgICAgICAgICAgICBpZiAoIU9iamVjdC5pcyhkYXRhSW5mbywgJycpKSB7CiAgICAgICAgICAgICAgICAgICAgZGF0YUluZm8gKz0gJ+OAgSc7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBkYXRhSW5mbyArPSBzcmZtYWpvcnRleHQ7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgICAgIH0KICAgICAgICB9KTsKCiAgICAgICAgaWYgKF9kYXRhcy5sZW5ndGggPCA1KSB7CiAgICAgICAgICAgIGRhdGFJbmZvID0gZGF0YUluZm8gKyAnIOWFsScgKyBfZGF0YXMubGVuZ3RoICsgJ+adoeaVsOaNric7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgZGF0YUluZm8gPSBkYXRhSW5mbyArICcuLi4nICsgJyDlhbEnICsgX2RhdGFzLmxlbmd0aCArICfmnaHmlbDmja4nOwogICAgICAgIH0KCiAgICAgICAgY29uc3QgcmVtb3ZlRGF0YSA9ICgpID0+IHsKICAgICAgICAgICAgbGV0IGtleXM6IGFueVtdID0gW107CiAgICAgICAgICAgIF9kYXRhcy5mb3JFYWNoKChkYXRhOiBhbnkpID0+IHsKICAgICAgICAgICAgICAgIGtleXMucHVzaChkYXRhLnNyZmtleSk7CiAgICAgICAgICAgIH0pOwogICAgICAgICAgICBsZXQgX3JlbW92ZUFjdGlvbiA9IGtleXMubGVuZ3RoID4gMSA/ICdyZW1vdmVCYXRjaCcgOiB0aGlzLnJlbW92ZUFjdGlvbiA7CiAgICAgICAgICAgIGxldCBfa2V5cyA9IGtleXMubGVuZ3RoID4gMSA/IGtleXMgOiBrZXlzWzBdIDsKICAgICAgICAgICAgY29uc3QgY29udGV4dDphbnkgPSBKU09OLnBhcnNlKEpTT04uc3RyaW5naWZ5KHRoaXMuY29udGV4dCkpOwogICAgICAgICAgICBjb25zdCBwb3N0OiBQcm9taXNlPGFueT4gPSB0aGlzLnNlcnZpY2UuZGVsZXRlKF9yZW1vdmVBY3Rpb24sT2JqZWN0LmFzc2lnbihjb250ZXh0LHsgb3JtZHV0eTogX2tleXMgfSksT2JqZWN0LmFzc2lnbih7IG9ybWR1dHk6IF9rZXlzIH0se3ZpZXdwYXJhbXM6dGhpcy52aWV3cGFyYW1zfSksIHRoaXMuc2hvd0J1c3lJbmRpY2F0b3IpOwogICAgICAgICAgICByZXR1cm4gbmV3IFByb21pc2UoKHJlc29sdmU6IGFueSwgcmVqZWN0OiBhbnkpID0+IHsKICAgICAgICAgICAgICAgIHBvc3QudGhlbigocmVzcG9uc2U6IGFueSkgPT4gewogICAgICAgICAgICAgICAgICAgIGlmICghcmVzcG9uc2UgfHwgcmVzcG9uc2Uuc3RhdHVzICE9PSAyMDApIHsKICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy4kTm90aWNlLmVycm9yKHsgdGl0bGU6ICcnLCBkZXNjOiAn5Yig6Zmk5pWw5o2u5aSx6LSlLCcgKyByZXNwb25zZS5pbmZvIH0pOwogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy4kTm90aWNlLnN1Y2Nlc3MoeyB0aXRsZTogJycsIGRlc2M6ICfliKDpmaTmiJDlip8hJyB9KTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgLy/liKDpmaRpdGVtc+S4reW3suWIoOmZpOeahOmhuQogICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKHRoaXMuaXRlbXMpOwogICAgICAgICAgICAgICAgICAgIF9kYXRhcy5mb3JFYWNoKChkYXRhOiBhbnkpID0+IHsKICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5pdGVtcy5zb21lKChpdGVtOmFueSxpbmRleDpudW1iZXIpPT57CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZihPYmplY3QuaXMoaXRlbS5zcmZrZXksZGF0YS5zcmZrZXkpKXsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLml0ZW1zLnNwbGljZShpbmRleCwxKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmdyaWRJdGVtc01vZGVsLnNwbGljZShpbmRleCwxKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgdGhpcy50b3RhbHJvdyAtPSBfZGF0YXMubGVuZ3RoOwogICAgICAgICAgICAgICAgICAgIHRoaXMuJGVtaXQoJ3JlbW92ZScsIG51bGwpOwogICAgICAgICAgICAgICAgICAgIHRoaXMuc2VsZWN0aW9ucyA9IFtdOwogICAgICAgICAgICAgICAgICAgIHJlc29sdmUocmVzcG9uc2UpOwogICAgICAgICAgICAgICAgfSkuY2F0Y2goKHJlc3BvbnNlOiBhbnkpID0+IHsKICAgICAgICAgICAgICAgICAgICBpZiAocmVzcG9uc2UgJiYgcmVzcG9uc2Uuc3RhdHVzID09PSA0MDEpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBpZiAoIXJlc3BvbnNlIHx8ICFyZXNwb25zZS5zdGF0dXMgfHwgIXJlc3BvbnNlLmRhdGEpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy4kTm90aWNlLmVycm9yKHsgdGl0bGU6ICfplJnor68nLCBkZXNjOiAn57O757uf5byC5bi4JyB9KTsKICAgICAgICAgICAgICAgICAgICAgICAgcmVqZWN0KHJlc3BvbnNlKTsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICByZWplY3QocmVzcG9uc2UpOwogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH0pOwogICAgICAgIH0KCiAgICAgICAgZGF0YUluZm8gPSBkYXRhSW5mby5yZXBsYWNlKC9bbnVsbF0vZywgJycpLnJlcGxhY2UoL1t1bmRlZmluZWRdL2csICcnKTsKICAgICAgICB0aGlzLiRNb2RhbC5jb25maXJtKHsKICAgICAgICAgICAgdGl0bGU6ICforablkYonLAogICAgICAgICAgICBjb250ZW50OiAn56Gu6K6k6KaB5Yig6ZmkICcgKyBkYXRhSW5mbyArICfvvIzliKDpmaTmk43kvZzlsIbkuI3lj6/mgaLlpI3vvJ8nLAogICAgICAgICAgICBvbk9rOiAoKSA9PiB7CiAgICAgICAgICAgICAgICByZW1vdmVEYXRhKCk7CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIG9uQ2FuY2VsOiAoKSA9PiB7IH0KICAgICAgICB9KTsKICAgICAgICByZXR1cm4gcmVtb3ZlRGF0YTsKICAgIH0KCgogICAgLyoqCiAgICAgKiDmibnph4/mt7vliqAKICAgICAqCiAgICAgKiBAcGFyYW0geyp9IFthcmc9e31dCiAgICAgKiBAbWVtYmVyb2YgTWFpbkJhc2UKICAgICAqLwogICAgcHVibGljIGFkZEJhdGNoKGFyZzogYW55ID0ge30pOiB2b2lkIHsKICAgICAgICBpZighdGhpcy5mZXRjaEFjdGlvbil7CiAgICAgICAgICAgIHRoaXMuJE5vdGljZS5lcnJvcih7IHRpdGxlOiAn6ZSZ6K+vJywgZGVzYzogJ09STURVVFlPcm1PcmdTZWN0b3JQaWNrdXBHcmlkVmlld+inhuWbvuihqOagvGZldGNoQWN0aW9u5Y+C5pWw5pyq6YWN572uJyB9KTsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KICAgICAgICBpZighYXJnKXsKICAgICAgICAgICAgYXJnID0ge307CiAgICAgICAgfQogICAgICAgIGNvbnNvbGUuZXJyb3IoIuaJuemHj+a3u+WKoOacquWunueOsCIpOwogICAgfQoKICAgIC8qKgogICAgICog5pWw5o2u5a+85YWlCiAgICAgKgogICAgICogQHBhcmFtIHsqfSBkYXRhCiAgICAgKiBAbWVtYmVyb2YgTWFpbkJhc2UKICAgICAqLwogICAgIHB1YmxpYyBpbXBvcnRFeGNlbChkYXRhOmFueSA9e30pOnZvaWR7CiAgICAgICAgLy/lr7zlhaVleGNlbAogICAgICAgIGNvbnN0IGltcG9ydERhdGFNb2RlbDphbnkgPXsKICAgICAgICB9CiAgICAgICAgaWYoT2JqZWN0LmtleXMoaW1wb3J0RGF0YU1vZGVsKS5sZW5ndGggPT0gMCl7CiAgICAgICAgICAgIHRoaXMuJE5vdGljZS53YXJuaW5nKHsgJ3RpdGxlJzogKHRoaXMuJHQoImFwcC51dGlsdmlldy53YXJuaW5nIikgYXMgc3RyaW5nKSwgJ2Rlc2MnOiAodGhpcy4kdCgiYXBwLnV0aWx2aWV3LmluZm8iKSBhcyBzdHJpbmcpIH0pOwogICAgICAgICAgICByZXR1cm47CiAgICAgICAgfQogICAgICAgIGNvbnN0IHZpZXc6YW55ID17CiAgICAgICAgICAgIHZpZXduYW1lOiAnYXBwLWRhdGEtdXBsb2FkJywKICAgICAgICAgICAgdGl0bGU6IHRoaXMuJHQoImFwcC51dGlsdmlldy5pbXBvcnR2aWV3IiksCiAgICAgICAgICAgIHdpZHRoOiA5MDAsCiAgICAgICAgICAgIGhlaWdodDogNzAwCiAgICAgICAgfQogICAgICAgIGxldCBjb250YWluZXI6IFN1YmplY3Q8YW55PiA9IHRoaXMuJGFwcG1vZGFsLm9wZW5Nb2RhbCh2aWV3LCBKU09OLnBhcnNlKEpTT04uc3RyaW5naWZ5KHRoaXMuY29udGV4dCkpLCBpbXBvcnREYXRhTW9kZWwpOwogICAgICAgIGNvbnRhaW5lci5zdWJzY3JpYmUoKHJlc3VsdDogYW55KSA9PiB7CiAgICAgICAgICBpZihPYmplY3QuaXMocmVzdWx0LnJldCwnT0snKSl7CiAgICAgICAgICAgIHRoaXMucmVmcmVzaChyZXN1bHQuZGF0YXMpOwogICAgICAgICAgfQogICAgICB9KTsKICAgIH0KCgogICAgLyoqCiAgICAgKiDmlbDmja7lr7zlh7oKICAgICAqCiAgICAgKiBAcGFyYW0geyp9IGRhdGEKICAgICAqIEBtZW1iZXJvZiBNYWluQmFzZQogICAgICovCiAgICBwdWJsaWMgZXhwb3J0RXhjZWwoZGF0YTogYW55ID0ge30pOiB2b2lkIHsKICAgICAgICAvLyDlr7zlh7pFeGNlbAogICAgICAgIGNvbnN0IGRvRXhwb3J0ID0gYXN5bmMgKF9kYXRhOmFueSkgPT4gewogICAgICAgICAgICBjb25zdCB0SGVhZGVyOiBBcnJheTxhbnk+ID0gW107CiAgICAgICAgICAgIGNvbnN0IGZpbHRlclZhbDogQXJyYXk8YW55PiA9IFtdOwogICAgICAgICAgICB0aGlzLmFsbENvbHVtbnMuZm9yRWFjaCgoaXRlbTogYW55KSA9PiB7CiAgICAgICAgICAgICAgaXRlbS5zaG93ICYmIGl0ZW0ubGFiZWwgPyB0SGVhZGVyLnB1c2godGhpcy4kdChpdGVtLmxhbmd0YWcpKSA6ICIiOwogICAgICAgICAgICAgIGl0ZW0uc2hvdyAmJiBpdGVtLm5hbWUgPyBmaWx0ZXJWYWwucHVzaChpdGVtLm5hbWUpIDogIiI7CiAgICAgICAgICAgIH0pOwogICAgICAgICAgICBjb25zdCBkYXRhID0gYXdhaXQgdGhpcy5mb3JtYXRFeGNlbERhdGEoZmlsdGVyVmFsLCBfZGF0YSk7CiAgICAgICAgICAgIHRoaXMuJGV4cG9ydC5leHBvcnRFeGNlbCgpLnRoZW4oKGV4Y2VsOmFueSk9PnsKICAgICAgICAgICAgICAgIGV4Y2VsLmV4cG9ydF9qc29uX3RvX2V4Y2VsKHsKICAgICAgICAgICAgICAgICAgaGVhZGVyOiB0SGVhZGVyLCAvL+ihqOWktCDlv4XloasKICAgICAgICAgICAgICAgICAgZGF0YSwgLy/lhbfkvZPmlbDmja4g5b+F5aGrCiAgICAgICAgICAgICAgICAgIGZpbGVuYW1lOiAi6IGM5Yqh566h55CG6KGoIiwgLy/pnZ7lv4XloasKICAgICAgICAgICAgICAgICAgYXV0b1dpZHRoOiB0cnVlLCAvL+mdnuW/heWhqwogICAgICAgICAgICAgICAgICBib29rVHlwZTogInhsc3giIC8v6Z2e5b+F5aGrCiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfSk7IAogICAgICAgIH07CiAgICAgICAgY29uc3QgcGFnZTogYW55ID0ge307CiAgICAgICAgLy8g6K6+572ucGFnZe+8jHNpemUKICAgICAgICBpZiAoT2JqZWN0LmlzKGRhdGEudHlwZSwgJ21heFJvd0NvdW50JykpIHsKICAgICAgICAgICAgT2JqZWN0LmFzc2lnbihwYWdlLCB7IHBhZ2U6IDAsIHNpemU6IGRhdGEubWF4Um93Q291bnQgfSk7CiAgICAgICAgfSBlbHNlIGlmIChPYmplY3QuaXMoZGF0YS50eXBlLCAnYWN0aXZhdGVkUGFnZScpKSB7CiAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICBkb0V4cG9ydChKU09OLnBhcnNlKEpTT04uc3RyaW5naWZ5KHRoaXMuaXRlbXMpKSk7CiAgICAgICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7CiAgICAgICAgICAgICAgICBjb25zb2xlLmVycm9yKGVycm9yKTsKICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm47CiAgICAgICAgfQogICAgICAgIC8vIOiuvue9ruaOkuW6jwogICAgICAgIGlmICghdGhpcy5pc05vU29ydCAmJiAhT2JqZWN0LmlzKHRoaXMubWlub3JTb3J0RGlyLCAnJykgJiYgIU9iamVjdC5pcyh0aGlzLm1pbm9yU29ydFBTREVGLCAnJykpIHsKICAgICAgICAgIGNvbnN0IHNvcnQ6IHN0cmluZyA9IHRoaXMubWlub3JTb3J0UFNERUYrIiwiK3RoaXMubWlub3JTb3J0RGlyOwogICAgICAgICAgICBPYmplY3QuYXNzaWduKHBhZ2UsIHsgc29ydDogc29ydCB9KTsKICAgICAgICB9CiAgICAgICAgY29uc3QgYXJnOiBhbnkgPSB7fTsKICAgICAgICBPYmplY3QuYXNzaWduKGFyZywgcGFnZSk7CiAgICAgICAgLy8g6I635Y+WcXVlcnks5pCc57Si6KGo5Y2V77yMdmlld3BhcmFtc+etieeItuaVsOaNrgogICAgICAgIGNvbnN0IHBhcmVudGRhdGE6IGFueSA9IHt9OwogICAgICAgIHRoaXMuJGVtaXQoJ2JlZm9yZWxvYWQnLCBwYXJlbnRkYXRhKTsKICAgICAgICBPYmplY3QuYXNzaWduKGFyZywgcGFyZW50ZGF0YSk7CiAgICAgICAgY29uc3QgcG9zdDogUHJvbWlzZTxhbnk+ID0gdGhpcy5zZXJ2aWNlLnNlYXJjaCh0aGlzLmZldGNoQWN0aW9uLEpTT04ucGFyc2UoSlNPTi5zdHJpbmdpZnkodGhpcy5jb250ZXh0KSksIGFyZywgdGhpcy5zaG93QnVzeUluZGljYXRvcik7CiAgICAgICAgcG9zdC50aGVuKChyZXNwb25zZTogYW55KSA9PiB7CiAgICAgICAgICAgIGlmICghcmVzcG9uc2UgfHwgcmVzcG9uc2Uuc3RhdHVzICE9PSAyMDApIHsKICAgICAgICAgICAgICAgIHRoaXMuJE5vdGljZS5lcnJvcih7IHRpdGxlOiAnJywgZGVzYzogJ+aVsOaNruWvvOWHuuWksei0pSwnICsgcmVzcG9uc2UuaW5mbyB9KTsKICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgfQogICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgZG9FeHBvcnQoSlNPTi5wYXJzZShKU09OLnN0cmluZ2lmeShyZXNwb25zZS5kYXRhKSkpOwogICAgICAgICAgICB9IGNhdGNoIChlcnJvcikgewogICAgICAgICAgICAgICAgY29uc29sZS5lcnJvcihlcnJvcik7CiAgICAgICAgICAgIH0KICAgICAgICB9KS5jYXRjaCgocmVzcG9uc2U6IGFueSkgPT4gewogICAgICAgICAgICBpZiAocmVzcG9uc2UgJiYgcmVzcG9uc2Uuc3RhdHVzID09PSA0MDEpIHsKICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgfQogICAgICAgICAgICB0aGlzLiROb3RpY2UuZXJyb3IoeyB0aXRsZTogJycsIGRlc2M6ICfmlbDmja7lr7zlh7rlpLHotKUnIH0pOwogICAgICAgIH0pOwogICAgfQoKCiAgICAvKioKICAgICAqIOWvvOWHuuaVsOaNruagvOW8j+WMlgogICAgICogCiAgICAgKiBAcGFyYW0geyp9IGZpbHRlclZhbAogICAgICogQHBhcmFtIHsqfSBqc29uRGF0YQogICAgICogQHJldHVybnMge1tdfQogICAgICogQG1lbWJlcm9mIE1haW5CYXNlCiAgICAgKi8KICAgIHB1YmxpYyBhc3luYyBmb3JtYXRFeGNlbERhdGEoZmlsdGVyVmFsOmFueSwganNvbkRhdGE6YW55KSB7CiAgICAgICAgbGV0IGNvZGVsaXN0Q29sdW1uczpBcnJheTxhbnk+ID0gWwogICAgICAgICAgewogICAgICAgICAgICBuYW1lOiAndXBkYXRlbWFuJywKICAgICAgICAgICAgc3Jma2V5OiAnRWhyQ29kZUxpc3QwMjQ5JywKICAgICAgICAgICAgY29kZWxpc3RUeXBlIDogJ0RZTkFNSUMnLAogICAgICAgICAgICByZW5kZXJNb2RlOiAnb3RoZXInLAogICAgICAgICAgICB0ZXh0U2VwYXJhdG9yOiAn44CBJywKICAgICAgICAgICAgdmFsdWVTZXBhcmF0b3I6ICcsJywKICAgICAgICAgIH0sCiAgICAgICAgXTsKICAgICAgICBsZXQgX3RoaXMgPSB0aGlzOwogICAgICAgIGZvciAoY29uc3QgY29kZWxpc3Qgb2YgY29kZWxpc3RDb2x1bW5zKSB7CiAgICAgICAgICAvLyDliqjmgIHku6PnoIHooajlpITnkIYKICAgICAgICAgIGlmIChPYmplY3QuaXMoY29kZWxpc3QuY29kZWxpc3RUeXBlLCAiRFlOQU1JQyIpKSB7CiAgICAgICAgICAgICAgbGV0IGl0ZW1zID0gYXdhaXQgX3RoaXMuY29kZUxpc3RTZXJ2aWNlLmdldEl0ZW1zKGNvZGVsaXN0LnNyZmtleSk7CiAgICAgICAgICAgICAganNvbkRhdGEuZm9yRWFjaCgocm93OmFueSk9PnsKICAgICAgICAgICAgICAgICAgcm93W2NvZGVsaXN0Lm5hbWVdID0gX3RoaXMuZ2V0Q29kZWxpc3RWYWx1ZShpdGVtcywgcm93W2NvZGVsaXN0Lm5hbWVdLCBjb2RlbGlzdCk7CiAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAvLyDpnZnmgIHlpITnkIYKICAgICAgICAgIH0gZWxzZSBpZihPYmplY3QuaXMoY29kZWxpc3QuY29kZWxpc3RUeXBlLCAiU1RBVElDIikpewogICAgICAgICAgICAgIGxldCBpdGVtcyA9IGF3YWl0IF90aGlzLiRzdG9yZS5nZXR0ZXJzLmdldENvZGVMaXN0SXRlbXMoY29kZWxpc3Quc3Jma2V5KTsKICAgICAgICAgICAgICBqc29uRGF0YS5mb3JFYWNoKChyb3c6YW55KT0+ewogICAgICAgICAgICAgICAgICByb3dbY29kZWxpc3QubmFtZV0gPSBfdGhpcy5nZXRDb2RlbGlzdFZhbHVlKGl0ZW1zLCByb3dbY29kZWxpc3QubmFtZV0sIGNvZGVsaXN0KTsKICAgICAgICAgICAgICB9KTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgcmV0dXJuIGpzb25EYXRhLm1hcCgodjphbnkpID0+IGZpbHRlclZhbC5tYXAoKGo6YW55KSA9PiB2W2pdKSkKICAgIH0gICAKCgogICAgLyoqCiAgICAgKiDop6PmnpDku6PnoIHooajlkox2bGF1Ze+8jOiuvue9rml0ZW1zCiAgICAgKgogICAgICogQHB1YmxpYwogICAgICogQHBhcmFtIHthbnlbXX0gaXRlbXMg5Luj56CB6KGo5pWw5o2uCiAgICAgKiBAcGFyYW0geyp9IHZhbHVlCiAgICAgKiBAcmV0dXJucyB7Kn0KICAgICAqIEBtZW1iZXJvZiBNYWluQmFzZQogICAgICovCiAgICBwdWJsaWMgZ2V0Q29kZWxpc3RWYWx1ZShpdGVtczogYW55W10sIHZhbHVlOiBhbnksIGNvZGVsaXN0OiBhbnksKXsKICAgICAgICBpZighdmFsdWUpewogICAgICAgICAgICByZXR1cm4gdGhpcy4kdCgnY29kZWxpc3QuJytjb2RlbGlzdC5zcmZrZXkrJy5lbXB0eScpOwogICAgICAgIH0KICAgICAgICBpZiAoaXRlbXMpIHsKICAgICAgICAgICAgbGV0IHJlc3VsdDphbnkgPSBbXTsKICAgICAgICAgICAgaWYoT2JqZWN0LmlzKGNvZGVsaXN0LnJlbmRlck1vZGUsIm51bWJlciIpKXsKICAgICAgICAgICAgICAgIGl0ZW1zLm1hcCgoX2l0ZW06IGFueSwgaW5kZXg6IG51bWJlcik9PnsKICAgICAgICAgICAgICAgICAgICBjb25zdCBuVmFsdWUgPSBwYXJzZUludCgodmFsdWUgYXMgYW55KSwgMTApOwogICAgICAgICAgICAgICAgICAgIGNvbnN0IGNvZGV2YWx1ZSA9IF9pdGVtLnZhbHVlOwogICAgICAgICAgICAgICAgICAgIGlmKChwYXJzZUludChjb2RldmFsdWUsIDEwKSAmIG5WYWx1ZSkgPiAwKXsKICAgICAgICAgICAgICAgICAgICAgICAgcmVzdWx0LnB1c2goX2l0ZW0pOwogICAgICAgICAgICAgICAgICAgIH0gCiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfSBlbHNlIGlmKE9iamVjdC5pcyhjb2RlbGlzdC5yZW5kZXJNb2RlLCJzdHJpbmciKSl7CiAgICAgICAgICAgICAgICBjb25zdCBhcnJheVZhbHVlOiBBcnJheTxhbnk+ID0gKHZhbHVlIGFzIGFueSkuc3BsaXQoY29kZWxpc3QudmFsdWVTZXBhcmF0b3IpOwogICAgICAgICAgICAgICAgYXJyYXlWYWx1ZS5tYXAoKHZhbHVlOiBhbnksIGluZGV4OiBudW1iZXIpID0+IHsKICAgICAgICAgICAgICAgICAgICByZXN1bHQucHVzaChbXSk7CiAgICAgICAgICAgICAgICAgICAgbGV0IHZhbHVlczogYW55W10gPSBPYmplY3QuaXModGhpcy4kdXRpbC50eXBlT2YodmFsdWUpLCAnbnVtYmVyJykgPyBbdmFsdWVdIDogWy4uLih2YWx1ZSBhcyBhbnkpLnNwbGl0KGNvZGVsaXN0LnZhbHVlU2VwYXJhdG9yKV07CiAgICAgICAgICAgICAgICAgICAgdmFsdWVzLm1hcCgodmFsOmFueSAsbnVtOiBudW1iZXIpPT57CiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGl0ZW0gPSB0aGlzLmdldEl0ZW0oaXRlbXMsIHZhbCwgY29kZWxpc3QpOyAKICAgICAgICAgICAgICAgICAgICAgICAgaWYoaXRlbSl7CiAgICAgICAgICAgICAgICAgICAgICAgICAgcmVzdWx0W2luZGV4XS5wdXNoKGl0ZW0pOwogICAgICAgICAgICAgICAgICAgICAgICB9IAogICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBsZXQgdmFsdWVzOiBhbnlbXSA9IE9iamVjdC5pcyh0aGlzLiR1dGlsLnR5cGVPZih2YWx1ZSksICdudW1iZXInKSA/IFt2YWx1ZV0gOiBbLi4uKHZhbHVlIGFzIGFueSkuc3BsaXQoY29kZWxpc3QudmFsdWVTZXBhcmF0b3IpXTsKICAgICAgICAgICAgICAgIHZhbHVlcy5tYXAoKHZhbHVlOmFueSAsaW5kZXg6IG51bWJlcik9PnsKICAgICAgICAgICAgICAgICAgICBjb25zdCBpdGVtID0gdGhpcy5nZXRJdGVtKGl0ZW1zLCB2YWx1ZSwgY29kZWxpc3QpOyAKICAgICAgICAgICAgICAgICAgICBpZihpdGVtKXsKICAgICAgICAgICAgICAgICAgICAgIHJlc3VsdC5wdXNoKGl0ZW0pOwogICAgICAgICAgICAgICAgICAgIH0gCiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfQogICAgICAgICAgICAvLyDorr7nva5pdGVtcwogICAgICAgICAgICBpZihyZXN1bHQubGVuZ3RoICE9IDApewogICAgICAgICAgICAgIHJldHVybiByZXN1bHQuam9pbihjb2RlbGlzdC52YWx1ZVNlcGFyYXRvcik7CiAgICAgICAgICAgIH1lbHNlewogICAgICAgICAgICAgIHJldHVybiB2YWx1ZTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIOiOt+WPluS7o+eggemhuQogICAgICoKICAgICAqIEBwdWJsaWMKICAgICAqIEBwYXJhbSB7YW55W119IGl0ZW1zCiAgICAgKiBAcGFyYW0geyp9IHZhbHVlCiAgICAgKiBAcmV0dXJucyB7Kn0KICAgICAqIEBtZW1iZXJvZiBNYWluQmFzZQogICAgICovCiAgICBwdWJsaWMgZ2V0SXRlbShpdGVtczogYW55W10sIHZhbHVlOiBhbnksIGNvZGVsaXN0OiBhbnkpOiBhbnkgewogICAgICAgIGNvbnN0IGFycjogQXJyYXk8YW55PiA9IGl0ZW1zLmZpbHRlcihpdGVtID0+IHtyZXR1cm4gaXRlbS52YWx1ZSA9PSB2YWx1ZX0pOwogICAgICAgIGlmIChhcnIubGVuZ3RoICE9PSAxKSB7CiAgICAgICAgICAgIHJldHVybiB1bmRlZmluZWQ7CiAgICAgICAgfQogICAgICAgIGlmKE9iamVjdC5pcyhjb2RlbGlzdC5jb2RlbGlzdFR5cGUsJ1NUQVRJQycpKXsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuJHQoJ2NvZGVsaXN0LicrY29kZWxpc3Quc3Jma2V5KycuJythcnJbMF0udmFsdWUpOwogICAgICAgIH1lbHNlewogICAgICAgICAgICByZXR1cm4gYXJyWzBdLnRleHQ7CiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICog55Sf5ZG95ZGo5pyfCiAgICAgKgogICAgICogQG1lbWJlcm9mIE1haW5CYXNlCiAgICAgKi8KICAgIHB1YmxpYyBjcmVhdGVkKCk6IHZvaWQgewogICAgICAgIHRoaXMuYWZ0ZXJDcmVhdGVkKCk7CiAgICB9CgogICAgLyoqCiAgICAgKiDmiafooYxjcmVhdGVk5ZCO55qE6YC76L6RCiAgICAgKgogICAgICogIEBtZW1iZXJvZiBNYWluQmFzZQogICAgICovICAgIAogICAgcHVibGljIGFmdGVyQ3JlYXRlZCgpewogICAgICAgIHRoaXMuc2V0Q29sU3RhdGUoKTsKICAgICAgICBpZiAodGhpcy52aWV3U3RhdGUpIHsKICAgICAgICAgICAgdGhpcy52aWV3U3RhdGVFdmVudCA9IHRoaXMudmlld1N0YXRlLnN1YnNjcmliZSgoeyB0YWcsIGFjdGlvbiwgZGF0YSB9KSA9PiB7CiAgICAgICAgICAgICAgICBpZiAoIU9iamVjdC5pcyh0YWcsIHRoaXMubmFtZSkpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBpZiAoT2JqZWN0LmlzKCdsb2FkJywgYWN0aW9uKSkgewogICAgICAgICAgICAgICAgICAgIHRoaXMubG9hZChkYXRhKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGlmIChPYmplY3QuaXMoJ3JlbW92ZScsIGFjdGlvbikpIHsKICAgICAgICAgICAgICAgICAgICB0aGlzLnJlbW92ZShkYXRhKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGlmIChPYmplY3QuaXMoJ3NhdmUnLCBhY3Rpb24pKSB7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5zYXZlKGRhdGEpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9KTsKICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiB2dWUg55Sf5ZG95ZGo5pyfCiAgICAgKgogICAgICogQG1lbWJlcm9mIE1haW5CYXNlCiAgICAgKi8KICAgIHB1YmxpYyBkZXN0cm95ZWQoKSB7CiAgICAgICAgdGhpcy5hZnRlckRlc3Ryb3koKTsKICAgIH0KCiAgICAvKioKICAgICAqIOaJp+ihjGRlc3Ryb3llZOWQjueahOmAu+i+kQogICAgICoKICAgICAqIEBtZW1iZXJvZiBNYWluQmFzZQogICAgICovCiAgICBwdWJsaWMgYWZ0ZXJEZXN0cm95KCkgewogICAgICAgIGlmICh0aGlzLnZpZXdTdGF0ZUV2ZW50KSB7CiAgICAgICAgICAgIHRoaXMudmlld1N0YXRlRXZlbnQudW5zdWJzY3JpYmUoKTsKICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiDojrflj5bpgInkuK3ooYzog6HmlbDmja4KICAgICAqCiAgICAgKiBAcmV0dXJucyB7YW55W119CiAgICAgKiBAbWVtYmVyb2YgTWFpbkJhc2UKICAgICAqLwogICAgcHVibGljIGdldFNlbGVjdGlvbigpOiBhbnlbXSB7CiAgICAgICAgcmV0dXJuIHRoaXMuc2VsZWN0aW9uczsKICAgIH0KCiAgICAvKioKICAgICAqIOihjOWPjOWHu+S6i+S7tgogICAgICoKICAgICAqIEBwYXJhbSB7Kn0gJGV2ZW50CiAgICAgKiBAcmV0dXJucyB7dm9pZH0KICAgICAqIEBtZW1iZXJvZiBNYWluQmFzZQogICAgICovCiAgICBwdWJsaWMgcm93REJMQ2xpY2soJGV2ZW50OiBhbnkpOiB2b2lkIHsKICAgICAgICBpZiAoISRldmVudCB8fCB0aGlzLmFjdHVhbElzT3BlbkVkaXQgfHwgT2JqZWN0LmlzKHRoaXMuZ3JpZFJvd0FjdGl2ZU1vZGUsMCkpIHsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KICAgICAgICB0aGlzLnNlbGVjdGlvbnMgPSBbXTsKICAgICAgICB0aGlzLnNlbGVjdGlvbnMucHVzaChKU09OLnBhcnNlKEpTT04uc3RyaW5naWZ5KCRldmVudCkpKTsKCiAgICAgICAgY29uc3QgcmVmczogYW55ID0gdGhpcy4kcmVmczsKICAgICAgICBpZiAocmVmcy5tdWx0aXBsZVRhYmxlKSB7CiAgICAgICAgICAgIHJlZnMubXVsdGlwbGVUYWJsZS5jbGVhclNlbGVjdGlvbigpOwogICAgICAgICAgICByZWZzLm11bHRpcGxlVGFibGUudG9nZ2xlUm93U2VsZWN0aW9uKCRldmVudCk7CiAgICAgICAgfQoKICAgICAgICB0aGlzLiRlbWl0KCdyb3dkYmxjbGljaycsIHRoaXMuc2VsZWN0aW9ucyk7CiAgICAgICAgdGhpcy4kZW1pdCgnc2VsZWN0aW9uY2hhbmdlJywgdGhpcy5zZWxlY3Rpb25zKTsKICAgIH0KCiAgICAvKioKICAgICAqIOWkjemAieahhuaVsOaNrumAieS4rQogICAgICoKICAgICAqIEBwYXJhbSB7Kn0gJGV2ZW50CiAgICAgKiBAcmV0dXJucyB7dm9pZH0KICAgICAqIEBtZW1iZXJvZiBNYWluQmFzZQogICAgICovCiAgICBwdWJsaWMgc2VsZWN0KCRldmVudDogYW55KTogdm9pZCB7CiAgICAgICAgaWYgKCEkZXZlbnQpIHsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KICAgICAgICB0aGlzLnNlbGVjdGlvbnMgPSBbXTsKICAgICAgICB0aGlzLnNlbGVjdGlvbnMgPSBbLi4uSlNPTi5wYXJzZShKU09OLnN0cmluZ2lmeSgkZXZlbnQpKV07CiAgICAgICAgdGhpcy4kZW1pdCgnc2VsZWN0aW9uY2hhbmdlJywgdGhpcy5zZWxlY3Rpb25zKTsKICAgIH0KCiAgICAvKioKICAgICAqIOWkjemAieahhuaVsOaNruWFqOmDqOmAieS4rQogICAgICoKICAgICAqIEBwYXJhbSB7Kn0gJGV2ZW50CiAgICAgKiBAbWVtYmVyb2YgTWFpbkJhc2UKICAgICAqLwogICAgcHVibGljIHNlbGVjdEFsbCgkZXZlbnQ6IGFueSk6IHZvaWQgewogICAgICAgIGlmICghJGV2ZW50KSB7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICB9CiAgICAgICAgdGhpcy5zZWxlY3Rpb25zID0gW107CiAgICAgICAgdGhpcy5zZWxlY3Rpb25zID0gWy4uLkpTT04ucGFyc2UoSlNPTi5zdHJpbmdpZnkoJGV2ZW50KSldOwogICAgICAgIHRoaXMuJGVtaXQoJ3NlbGVjdGlvbmNoYW5nZScsIHRoaXMuc2VsZWN0aW9ucyk7CiAgICB9CgogICAgCiAgICAvKioKICAgICAqIOihjOWNleWHu+mAieS4rQogICAgICoKICAgICAqIEBwYXJhbSB7Kn0gJGV2ZW50CiAgICAgKiBAcmV0dXJucyB7dm9pZH0KICAgICAqIEBtZW1iZXJvZiBNYWluQmFzZQogICAgICovCiAgICBwdWJsaWMgcm93Q2xpY2soJGV2ZW50OiBhbnksIGlmQWx3YXlzOiBib29sZWFuID0gZmFsc2UpOiB2b2lkIHsKICAgICAgICBpZiAoIWlmQWx3YXlzICYmICghJGV2ZW50IHx8IHRoaXMuYWN0dWFsSXNPcGVuRWRpdCkpIHsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KICAgICAgICBpZih0aGlzLnN0b3BSb3dDbGljaykgewogICAgICAgICAgICB0aGlzLnN0b3BSb3dDbGljayA9IGZhbHNlOwogICAgICAgICAgICByZXR1cm47CiAgICAgICAgfQogICAgICAgIGlmKHRoaXMuaXNTaW5nbGVTZWxlY3QpewogICAgICAgICAgICB0aGlzLnNlbGVjdGlvbnMgPSBbXTsKICAgICAgICB9CiAgICAgICAgLy8g5bey6YCJ5Lit5YiZ5Yig6Zmk77yM5rKh6YCJ5Lit5YiZ5re75YqgCiAgICAgICAgbGV0IHNlbGVjdEluZGV4ID0gdGhpcy5zZWxlY3Rpb25zLmZpbmRJbmRleCgoaXRlbTphbnkpPT57CiAgICAgICAgICAgIHJldHVybiBPYmplY3QuaXMoaXRlbS5vcm1kdXR5LCRldmVudC5vcm1kdXR5KTsKICAgICAgICB9KTsKICAgICAgICBpZiAoT2JqZWN0LmlzKHNlbGVjdEluZGV4LC0xKSl7CiAgICAgICAgICB0aGlzLnNlbGVjdGlvbnMucHVzaChKU09OLnBhcnNlKEpTT04uc3RyaW5naWZ5KCRldmVudCkpKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgdGhpcy5zZWxlY3Rpb25zLnNwbGljZShzZWxlY3RJbmRleCwxKTsKICAgICAgICB9CgogICAgICAgIGNvbnN0IHJlZnM6IGFueSA9IHRoaXMuJHJlZnM7CiAgICAgICAgaWYgKHJlZnMubXVsdGlwbGVUYWJsZSkgewogICAgICAgICAgICBpZih0aGlzLmlzU2luZ2xlU2VsZWN0KXsKICAgICAgICAgICAgICAgIHJlZnMubXVsdGlwbGVUYWJsZS5jbGVhclNlbGVjdGlvbigpOwogICAgICAgICAgICAgICAgcmVmcy5tdWx0aXBsZVRhYmxlLnNldEN1cnJlbnRSb3coJGV2ZW50KTsKICAgICAgICAgICAgfWVsc2V7CiAgICAgICAgICAgICAgICByZWZzLm11bHRpcGxlVGFibGUudG9nZ2xlUm93U2VsZWN0aW9uKCRldmVudCk7IAogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICB0aGlzLiRlbWl0KCdzZWxlY3Rpb25jaGFuZ2UnLCB0aGlzLnNlbGVjdGlvbnMpOwogICAgfQoKCiAgICAvKioKICAgICAqIOmhtemdouWPmOWMlgogICAgICoKICAgICAqIEBwYXJhbSB7Kn0gJGV2ZW50CiAgICAgKiBAcmV0dXJucyB7dm9pZH0KICAgICAqIEBtZW1iZXJvZiBNYWluQmFzZQogICAgICovCiAgICBwdWJsaWMgcGFnZU9uQ2hhbmdlKCRldmVudDogYW55KTogdm9pZCB7CiAgICAgICAgaWYgKCEkZXZlbnQpIHsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KICAgICAgICBpZiAoJGV2ZW50ID09PSB0aGlzLmN1clBhZ2UpIHsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KICAgICAgICB0aGlzLmN1clBhZ2UgPSAkZXZlbnQ7CiAgICAgICAgdGhpcy5sb2FkKHt9KTsKICAgIH0KCiAgICAvKioKICAgICAqIOWIhumhteadoeaVsOWPmOWMlgogICAgICoKICAgICAqIEBwYXJhbSB7Kn0gJGV2ZW50CiAgICAgKiBAcmV0dXJucyB7dm9pZH0KICAgICAqIEBtZW1iZXJvZiBNYWluQmFzZQogICAgICovCiAgICBwdWJsaWMgb25QYWdlU2l6ZUNoYW5nZSgkZXZlbnQ6IGFueSk6IHZvaWQgewogICAgICAgIGlmICghJGV2ZW50KSB7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICB9CiAgICAgICAgaWYgKCRldmVudCA9PT0gdGhpcy5saW1pdCkgewogICAgICAgICAgICByZXR1cm47CiAgICAgICAgfQogICAgICAgIHRoaXMubGltaXQgPSAkZXZlbnQ7CiAgICAgICAgaWYgKHRoaXMuY3VyUGFnZSA9PT0gMSkgewogICAgICAgICAgICB0aGlzLmxvYWQoe30pOwogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIOWIhumhteWIt+aWsAogICAgICoKICAgICAqIEBtZW1iZXJvZiBNYWluQmFzZQogICAgICovCiAgICBwdWJsaWMgcGFnZVJlZnJlc2goKTogdm9pZCB7CiAgICAgICAgdGhpcy5sb2FkKHt9KTsKICAgIH0KCiAgICAvKioKICAgICAqIOaOkuW6j+WPmOWMlgogICAgICoKICAgICAqIEBwYXJhbSB7eyBjb2x1bW46IGFueSwgcHJvcDogYW55LCBvcmRlcjogYW55IH19IHsgY29sdW1uLCBwcm9wLCBvcmRlciB9CiAgICAgKiBAbWVtYmVyb2YgTWFpbkJhc2UKICAgICAqLwogICAgcHVibGljIG9uU29ydENoYW5nZSh7IGNvbHVtbiwgcHJvcCwgb3JkZXIgfTogeyBjb2x1bW46IGFueSwgcHJvcDogYW55LCBvcmRlcjogYW55IH0pOiB2b2lkIHsKICAgICAgICBjb25zdCBkaXIgPSBPYmplY3QuaXMob3JkZXIsICdhc2NlbmRpbmcnKSA/ICdhc2MnIDogT2JqZWN0LmlzKG9yZGVyLCAnZGVzY2VuZGluZycpID8gJ2Rlc2MnIDogJyc7CiAgICAgICAgaWYgKE9iamVjdC5pcyhkaXIsIHRoaXMubWlub3JTb3J0RGlyKSAmJiBPYmplY3QuaXModGhpcy5taW5vclNvcnRQU0RFRiwgcHJvcCkpIHsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KICAgICAgICB0aGlzLm1pbm9yU29ydERpciA9IGRpcjsKICAgICAgICB0aGlzLm1pbm9yU29ydFBTREVGID0gcHJvcCA/IHByb3AgOiAnJzsKICAgICAgICB0aGlzLmxvYWQoe30pOwogICAgfQoKICAgIC8qKgogICAgICog6KGo5qC86KGM6YCJ5Lit5qC35byPCiAgICAgKgogICAgICogQHBhcmFtIHt7IHJvdzogYW55LCByb3dJbmRleDogYW55IH19IHsgcm93LCByb3dJbmRleCB9CiAgICAgKiBAcmV0dXJucyB7c3RyaW5nfQogICAgICogQG1lbWJlcm9mIE1haW5CYXNlCiAgICAgKi8KICAgIHB1YmxpYyBvblJvd0NsYXNzTmFtZSh7IHJvdywgcm93SW5kZXggfTogeyByb3c6IGFueSwgcm93SW5kZXg6IGFueSB9KTogc3RyaW5nIHsKICAgICAgICBjb25zdCBpbmRleCA9IHRoaXMuc2VsZWN0aW9ucy5maW5kSW5kZXgoKHNlbGVjdDogYW55KSA9PiBPYmplY3QuaXMoc2VsZWN0LnNyZmtleSwgcm93LnNyZmtleSkpOwogICAgICAgIHJldHVybiBpbmRleCAhPT0gLTEgPyAnZ3JpZC1yb3ctc2VsZWN0JyA6ICcnOwogICAgfQoKCgogICAgLyoqCiAgICAgKiDnlYzpnaLooYzkuLoKICAgICAqCiAgICAgKiBAcGFyYW0geyp9IHJvdwogICAgICogQHBhcmFtIHsqfSB0YWcKICAgICAqIEBwYXJhbSB7Kn0gJGV2ZW50CiAgICAgKiBAbWVtYmVyb2YgTWFpbkJhc2UKICAgICAqLwoJcHVibGljIHVpQWN0aW9uKHJvdzogYW55LCB0YWc6IGFueSwgJGV2ZW50OiBhbnkpIHsKICAgICAgICAvLyB0aGlzLnJvd0NsaWNrKHJvdywgdHJ1ZSk7CiAgICAgICAgJGV2ZW50LnN0b3BQcm9wYWdhdGlvbigpOwogICAgfQoKICAgIC8qKgogICAgICog6K6+572u5YiX54q25oCBCiAgICAgKgogICAgICogQG1lbWJlcm9mIE1haW5CYXNlCiAgICAgKi8KICAgIHB1YmxpYyBzZXRDb2xTdGF0ZSgpIHsKCQljb25zdCBfZGF0YTogYW55ID0gbG9jYWxTdG9yYWdlLmdldEl0ZW0oJ29ybWR1dHlfbWFpbl9ncmlkJyk7CgkJaWYgKF9kYXRhKSB7CgkJCWxldCBjb2x1bW5zID0gSlNPTi5wYXJzZShfZGF0YSk7CgkJCWNvbHVtbnMuZm9yRWFjaCgoY29sOiBhbnkpID0+IHsKCQkJCWxldCBjb2x1bW4gPSB0aGlzLmFsbENvbHVtbnMuZmluZCgoaXRlbSkgPT4gT2JqZWN0LmlzKGNvbC5uYW1lLCBpdGVtLm5hbWUpKTsKCQkJCWlmIChjb2x1bW4pIHsKCQkJCQlPYmplY3QuYXNzaWduKGNvbHVtbiwgY29sKTsKCQkJCX0KCQkJfSk7CgkJfQogICAgfQoKICAgIC8qKgogICAgICog5YiX5Y+Y5YyWCiAgICAgKgogICAgICogQG1lbWJlcm9mIE1haW5CYXNlCiAgICAgKi8KICAgIHB1YmxpYyBvbkNvbENoYW5nZSgpIHsKICAgICAgICBsb2NhbFN0b3JhZ2Uuc2V0SXRlbSgnb3JtZHV0eV9tYWluX2dyaWQnLCBKU09OLnN0cmluZ2lmeSh0aGlzLmFsbENvbHVtbnMpKTsKICAgIH0KCiAgICAvKioKICAgICAqIOiOt+WPluWIl+eKtuaAgQogICAgICoKICAgICAqIEBwYXJhbSB7c3RyaW5nfSBuYW1lCiAgICAgKiBAcmV0dXJucyB7Ym9vbGVhbn0KICAgICAqIEBtZW1iZXJvZiBNYWluQmFzZQogICAgICovCiAgICBwdWJsaWMgZ2V0Q29sdW1uU3RhdGUobmFtZTogc3RyaW5nKTogYm9vbGVhbiB7CiAgICAgICAgbGV0IGNvbHVtbiA9IHRoaXMuYWxsQ29sdW1ucy5maW5kKChjb2w6IGFueSkgPT4KICAgICAgICAgICAgT2JqZWN0LmlzKG5hbWUsIGNvbC5uYW1lKQogICAgICAgICk7CiAgICAgICAgcmV0dXJuIGNvbHVtbi5zaG93ID8gdHJ1ZSA6IGZhbHNlOwogICAgfQoKICAgIC8qKgogICAgICog6KGo5qC85YiX5piv5ZCm6Ieq6YCC5bqU5biD5bGACiAgICAgKgogICAgICogQHJlYWRvbmx5CiAgICAgKiBAdHlwZSB7Ym9vbGVhbn0KICAgICAqIEBtZW1iZXJvZiBNYWluQmFzZQogICAgICovCiAgICBnZXQgYWRhcHRpdmVTdGF0ZSgpOiBib29sZWFuIHsKICAgICAgICByZXR1cm4gIXRoaXMuYWxsQ29sdW1ucy5maW5kKChjb2x1bW46IGFueSkgPT4gY29sdW1uLnNob3cgJiYgT2JqZWN0LmlzKGNvbHVtbi51dGlsLCAnU1RBUicpKTsKICAgIH0KCiAgICAvKioKICAgICAqIOS/neWtmAogICAgICoKICAgICAqIEBwYXJhbSB7Kn0gJGV2ZW50CiAgICAgKiBAcmV0dXJucyB7UHJvbWlzZTxhbnk+fQogICAgICogQG1lbWJlcm9mIE1haW5CYXNlCiAgICAgKi8KICAgIHB1YmxpYyBhc3luYyBzYXZlKGFyZ3M6IGFueVtdLCBwYXJhbXM/OiBhbnksICRldmVudD86IGFueSwgeERhdGE/OiBhbnkpewogICAgICAgIGxldCBfdGhpcyA9IHRoaXM7CiAgICAgICAgaWYoIWF3YWl0IHRoaXMudmFsaWRhdGVBbGwoKSl7CiAgICAgICAgICAgIHRoaXMuJE5vdGljZS5lcnJvcih7IHRpdGxlOiAn6ZSZ6K+vJywgZGVzYzogJ+WAvOinhOWImeagoemqjOW8guW4uCcgfSk7CiAgICAgICAgICAgIHJldHVybiBbXTsKICAgICAgICB9CiAgICAgICAgbGV0IHN1Y2Nlc3NJdGVtczphbnkgPSBbXTsKICAgICAgICBsZXQgZXJyb3JJdGVtczphbnkgPSBbXTsKICAgICAgICBsZXQgZXJyb3JNZXNzYWdlOmFueSA9IFtdOwogICAgICAgIGZvciAoY29uc3QgaXRlbSBvZiBfdGhpcy5pdGVtcykgewogICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgaWYoT2JqZWN0LmlzKGl0ZW0ucm93RGF0YVN0YXRlLCAnY3JlYXRlJykpewogICAgICAgICAgICAgICAgICAgIGlmKCF0aGlzLmNyZWF0ZUFjdGlvbil7CiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuJE5vdGljZS5lcnJvcih7IHRpdGxlOiAn6ZSZ6K+vJywgZGVzYzogJ09STURVVFlPcm1PcmdTZWN0b3JQaWNrdXBHcmlkVmlld+inhuWbvuihqOagvGNyZWF0ZUFjdGlvbuWPguaVsOacqumFjee9ricgfSk7CiAgICAgICAgICAgICAgICAgICAgfWVsc2V7CiAgICAgICAgICAgICAgICAgICAgICBPYmplY3QuYXNzaWduKGl0ZW0se3ZpZXdwYXJhbXM6dGhpcy52aWV3cGFyYW1zfSk7CiAgICAgICAgICAgICAgICAgICAgICBsZXQgcmVzcG9uc2UgPSBhd2FpdCB0aGlzLnNlcnZpY2UuYWRkKHRoaXMuY3JlYXRlQWN0aW9uLCBKU09OLnBhcnNlKEpTT04uc3RyaW5naWZ5KHRoaXMuY29udGV4dCkpLGl0ZW0sIHRoaXMuc2hvd0J1c3lJbmRpY2F0b3IpOwogICAgICAgICAgICAgICAgICAgICAgc3VjY2Vzc0l0ZW1zLnB1c2goSlNPTi5wYXJzZShKU09OLnN0cmluZ2lmeShyZXNwb25zZS5kYXRhKSkpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH1lbHNlIGlmKE9iamVjdC5pcyhpdGVtLnJvd0RhdGFTdGF0ZSwgJ3VwZGF0ZScpKXsKICAgICAgICAgICAgICAgICAgICBpZighdGhpcy51cGRhdGVBY3Rpb24pewogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLiROb3RpY2UuZXJyb3IoeyB0aXRsZTogJ+mUmeivrycsIGRlc2M6ICdPUk1EVVRZT3JtT3JnU2VjdG9yUGlja3VwR3JpZFZpZXfop4blm77ooajmoLx1cGRhdGVBY3Rpb27lj4LmlbDmnKrphY3nva4nIH0pOwogICAgICAgICAgICAgICAgICAgIH1lbHNlewogICAgICAgICAgICAgICAgICAgICAgICBPYmplY3QuYXNzaWduKGl0ZW0se3ZpZXdwYXJhbXM6dGhpcy52aWV3cGFyYW1zfSk7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmKGl0ZW0ub3JtZHV0eSl7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBPYmplY3QuYXNzaWduKHRoaXMuY29udGV4dCx7b3JtZHV0eTppdGVtLm9ybWR1dHl9KTsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICBsZXQgcmVzcG9uc2UgPSBhd2FpdCB0aGlzLnNlcnZpY2UuYWRkKHRoaXMudXBkYXRlQWN0aW9uLEpTT04ucGFyc2UoSlNPTi5zdHJpbmdpZnkodGhpcy5jb250ZXh0KSksaXRlbSwgdGhpcy5zaG93QnVzeUluZGljYXRvcik7CiAgICAgICAgICAgICAgICAgICAgICAgIHN1Y2Nlc3NJdGVtcy5wdXNoKEpTT04ucGFyc2UoSlNPTi5zdHJpbmdpZnkocmVzcG9uc2UuZGF0YSkpKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7CiAgICAgICAgICAgICAgICBlcnJvckl0ZW1zLnB1c2goSlNPTi5wYXJzZShKU09OLnN0cmluZ2lmeShpdGVtKSkpOwogICAgICAgICAgICAgICAgZXJyb3JNZXNzYWdlLnB1c2goZXJyb3IpOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIHRoaXMuJGVtaXQoJ3NhdmUnLCBzdWNjZXNzSXRlbXMpOwogICAgICAgIHRoaXMucmVmcmVzaChbXSk7CiAgICAgICAgaWYoZXJyb3JJdGVtcy5sZW5ndGggPT09IDApewogICAgICAgICAgICB0aGlzLiROb3RpY2Uuc3VjY2Vzcyh7IHRpdGxlOiAnJywgZGVzYzogJ+S/neWtmOaIkOWKnyEnIH0pOwogICAgICAgIH1lbHNlewogICAgICAgICAgZXJyb3JJdGVtcy5mb3JFYWNoKChpdGVtOmFueSxpbmRleDpudW1iZXIpPT57CiAgICAgICAgICAgIHRoaXMuJE5vdGljZS5lcnJvcih7IHRpdGxlOiAn5L+d5a2Y5aSx6LSlJywgZGVzYzogaXRlbS5tYWpvcmVudGl0eW5hbWUrJ+S/neWtmOWksei0pe+8gScgfSk7CiAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoZXJyb3JNZXNzYWdlW2luZGV4XSk7CiAgICAgICAgICB9KTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIHN1Y2Nlc3NJdGVtczsKICAgIH0KCiAgICAvKioKICAgICAqIOaWsOW7uuihjAogICAgICoKICAgICAqIEBwYXJhbSB7Kn0gJGV2ZW50CiAgICAgKiBAcmV0dXJucyB7dm9pZH0KICAgICAqIEBtZW1iZXJvZiBNYWluQmFzZQogICAgICovCiAgICBwdWJsaWMgbmV3Um93KGFyZ3M6IGFueVtdLCBwYXJhbXM/OiBhbnksICRldmVudD86IGFueSwgeERhdGE/OiBhbnkpOiB2b2lkIHsKICAgICAgICBpZighdGhpcy5sb2FkZHJhZnRBY3Rpb24pewogICAgICAgICAgICB0aGlzLiROb3RpY2UuZXJyb3IoeyB0aXRsZTogJ+mUmeivrycsIGRlc2M6ICdPUk1EVVRZT3JtT3JnU2VjdG9yUGlja3VwR3JpZFZpZXfop4blm77ooajmoLxsb2FkZHJhZnRBY3Rpb27lj4LmlbDmnKrphY3nva4nIH0pOwogICAgICAgICAgICByZXR1cm47CiAgICAgICAgfQogICAgICAgIGxldCBfdGhpcyA9IHRoaXM7CiAgICAgICAgT2JqZWN0LmFzc2lnbihhcmdzWzBdLHt2aWV3cGFyYW1zOnRoaXMudmlld3BhcmFtc30pOwogICAgICAgIGxldCBwb3N0OiBQcm9taXNlPGFueT4gPSB0aGlzLnNlcnZpY2UubG9hZERyYWZ0KHRoaXMubG9hZGRyYWZ0QWN0aW9uLCBKU09OLnBhcnNlKEpTT04uc3RyaW5naWZ5KHRoaXMuY29udGV4dCkpLCBhcmdzWzBdLCB0aGlzLnNob3dCdXN5SW5kaWNhdG9yKTsKICAgICAgICBwb3N0LnRoZW4oKHJlc3BvbnNlOiBhbnkpID0+IHsKICAgICAgICAgICAgaWYgKCFyZXNwb25zZS5zdGF0dXMgfHwgcmVzcG9uc2Uuc3RhdHVzICE9PSAyMDApIHsKICAgICAgICAgICAgICAgIGlmIChyZXNwb25zZS5lcnJvck1lc3NhZ2UpIHsKICAgICAgICAgICAgICAgICAgICB0aGlzLiROb3RpY2UuZXJyb3IoeyB0aXRsZTogJ+mUmeivrycsIGRlc2M6IHJlc3BvbnNlLmVycm9yTWVzc2FnZSB9KTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgfQogICAgICAgICAgICBjb25zdCBkYXRhID0gcmVzcG9uc2UuZGF0YTsKICAgICAgICAgICAgdGhpcy5jcmVhdGVEZWZhdWx0KGRhdGEpOwogICAgICAgICAgICBkYXRhLnJvd0RhdGFTdGF0ZSA9ICJjcmVhdGUiOwogICAgICAgICAgICBfdGhpcy5pdGVtcy5wdXNoKGRhdGEpOwogICAgICAgICAgICBfdGhpcy5ncmlkSXRlbXNNb2RlbC5wdXNoKF90aGlzLmdldEdyaWRSb3dNb2RlbCgpKTsKICAgICAgICB9KS5jYXRjaCgocmVzcG9uc2U6IGFueSkgPT4gewogICAgICAgICAgICBpZiAocmVzcG9uc2UgJiYgcmVzcG9uc2Uuc3RhdHVzID09PSA0MDEpIHsKICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAoIXJlc3BvbnNlIHx8ICFyZXNwb25zZS5zdGF0dXMgfHwgIXJlc3BvbnNlLmRhdGEpIHsKICAgICAgICAgICAgICAgIHRoaXMuJE5vdGljZS5lcnJvcih7IHRpdGxlOiAn6ZSZ6K+vJywgZGVzYzogJ+ezu+e7n+W8guW4uCcgfSk7CiAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgIH0KICAgICAgICB9KTsKICAgIH0KCiAgICAvKioKICAgICAqIOihqOagvOe8lui+kemhueWAvOWPmOabtAogICAgICogIAogICAgICogQHBhcmFtIHJvdyDooYzmlbDmja4KICAgICAqIEBwYXJhbSB7eyBuYW1lOiBzdHJpbmcsIHZhbHVlOiBhbnkgfX0gJGV2ZW50CiAgICAgKiBAcmV0dXJucyB7dm9pZH0KICAgICAqIEBtZW1iZXJvZiBNYWluQmFzZQogICAgICovCiAgICBwdWJsaWMgb25HcmlkSXRlbVZhbHVlQ2hhbmdlKHJvdzogYW55LCRldmVudDogeyBuYW1lOiBzdHJpbmcsIHZhbHVlOiBhbnkgfSxyb3dJbmRleDogbnVtYmVyKTogdm9pZCB7CiAgICAgICAgaWYgKCEkZXZlbnQpIHsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KICAgICAgICBpZiAoISRldmVudC5uYW1lIHx8IE9iamVjdC5pcygkZXZlbnQubmFtZSwgJycpIHx8ICFyb3cuaGFzT3duUHJvcGVydHkoJGV2ZW50Lm5hbWUpKSB7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICB9CiAgICAgICAgcm93WyRldmVudC5uYW1lXSA9ICRldmVudC52YWx1ZTsKICAgICAgICB0aGlzLmdyaWRFZGl0SXRlbUNoYW5nZShyb3csICRldmVudC5uYW1lLCAkZXZlbnQudmFsdWUsIHJvd0luZGV4KTsKICAgIH0KCiAgICAvKioKICAgICAqIOihqOagvOe8lui+kemhueWAvOWPmOWMlgogICAgICoKICAgICAqIEBwdWJsaWMKICAgICAqIEBwYXJhbSByb3cg6KGM5pWw5o2uCiAgICAgKiBAcGFyYW0gcHJvcGVydHkg5YiX57yW6L6R6aG55ZCNCiAgICAgKiBAcGFyYW0gcm93IOWIl+e8lui+kemhueWAvAogICAgICogQHJldHVybnMge3ZvaWR9CiAgICAgKiBAbWVtYmVyb2YgTWFpbkJhc2UKICAgICAqLwogICAgcHVibGljIGdyaWRFZGl0SXRlbUNoYW5nZShyb3c6IGFueSwgcHJvcGVydHk6IHN0cmluZywgdmFsdWU6IGFueSwgcm93SW5kZXg6IG51bWJlcil7CiAgICAgICAgcm93LnJvd0RhdGFTdGF0ZSA9IHJvdy5yb3dEYXRhU3RhdGUgPyByb3cucm93RGF0YVN0YXRlIDogInVwZGF0ZSIgOwogICAgICAgIHRoaXMudmFsaWRhdGUocHJvcGVydHkscm93LHJvd0luZGV4KTsKICAgIH0KCiAgICAvKioKICAgICAqIOihqOagvOe8lui+kemhueabtOaWsAogICAgICoKICAgICAqIEBwYXJhbSB7c3RyaW5nfSBtb2RlIOeVjOmdouihjOS4uuWQjeensAogICAgICogQHBhcmFtIHsqfSBbZGF0YT17fV0g6K+35rGC5pWw5o2uCiAgICAgKiBAcGFyYW0ge3N0cmluZ1tdfSB1cGRhdGVEZXRhaWxzIOabtOaWsOmhuQogICAgICogQHBhcmFtIHtib29sZWFufSBbc2hvd2xvYWRpbmddIOaYr+WQpuaYvuekuuWKoOi9veeKtuaAgQogICAgICogQHJldHVybnMge3ZvaWR9CiAgICAgKiBAbWVtYmVyb2YgTWFpbkJhc2UKICAgICAqLwogICAgcHVibGljIHVwZGF0ZUdyaWRFZGl0SXRlbShtb2RlOiBzdHJpbmcsIGRhdGE6IGFueSA9IHt9LCB1cGRhdGVEZXRhaWxzOiBzdHJpbmdbXSwgc2hvd2xvYWRpbmc/OiBib29sZWFuKTogdm9pZCB7CiAgICAgICAgaWYgKCFtb2RlIHx8IChtb2RlICYmIE9iamVjdC5pcyhtb2RlLCAnJykpKSB7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICB9CiAgICAgICAgY29uc3QgYXJnOiBhbnkgPSBKU09OLnBhcnNlKEpTT04uc3RyaW5naWZ5KGRhdGEpKTsKICAgICAgICBPYmplY3QuYXNzaWduKGFyZyx7dmlld3BhcmFtczp0aGlzLnZpZXdwYXJhbXN9KTsKICAgICAgICBjb25zdCBwb3N0OiBQcm9taXNlPGFueT4gPSB0aGlzLnNlcnZpY2UuZnJvbnRMb2dpYyhtb2RlLEpTT04ucGFyc2UoSlNPTi5zdHJpbmdpZnkodGhpcy5jb250ZXh0KSksYXJnLCBzaG93bG9hZGluZyk7CiAgICAgICAgcG9zdC50aGVuKChyZXNwb25zZTogYW55KSA9PiB7CiAgICAgICAgICAgIGlmICghcmVzcG9uc2UgfHwgcmVzcG9uc2Uuc3RhdHVzICE9PSAyMDApIHsKICAgICAgICAgICAgICAgIHRoaXMuJE5vdGljZS5lcnJvcih7IHRpdGxlOiAn6ZSZ6K+vJywgZGVzYzogJ+ihqOWNlemhueabtOaWsOWksei0pScgfSk7CiAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgIH0KICAgICAgICAgICAgY29uc3QgX2RhdGE6IGFueSA9IHJlc3BvbnNlLmRhdGE7CiAgICAgICAgICAgIGlmKCFfZGF0YSl7CiAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgIH0KICAgICAgICAgICAgdXBkYXRlRGV0YWlscy5mb3JFYWNoKChuYW1lOiBzdHJpbmcpID0+IHsKICAgICAgICAgICAgICAgIGlmICghX2RhdGEuaGFzT3duUHJvcGVydHkobmFtZSkpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBkYXRhW25hbWVdID0gX2RhdGFbbmFtZV07CiAgICAgICAgICAgIH0pOwogICAgICAgIH0pLmNhdGNoKChyZXNwb25zZTogYW55KSA9PiB7CiAgICAgICAgICAgIGlmIChyZXNwb25zZSAmJiByZXNwb25zZS5zdGF0dXMgPT09IDQwMSkgewogICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmICghcmVzcG9uc2UgfHwgIXJlc3BvbnNlLnN0YXR1cyB8fCAhcmVzcG9uc2UuZGF0YSkgewogICAgICAgICAgICAgICAgdGhpcy4kTm90aWNlLmVycm9yKHsgdGl0bGU6ICfplJnor68nLCBkZXNjOiAn57O757uf5byC5bi4JyB9KTsKICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgfQogICAgICAgIH0pOwogICAgfQoKICAgIC8qKgogICAgICog6I635Y+W5a+55bqU6KGMY2xhc3MKICAgICAqCiAgICAgKiBAcGFyYW0geyp9ICRhcmdzIHJvdyDooYzmlbDmja7vvIxyb3dJbmRleCDooYzntKLlvJUKICAgICAqIEByZXR1cm5zIHt2b2lkfQogICAgICogQG1lbWJlcm9mIE1haW5CYXNlCiAgICAgKi8KICAgIHB1YmxpYyBnZXRSb3dDbGFzc05hbWUoYXJnczp7cm93OiBhbnkscm93SW5kZXg6IG51bWJlcn0pewogICAgICAgIGxldCBpc1NlbGVjdGVkID0gdGhpcy5zZWxlY3Rpb25zLnNvbWUoKGl0ZW06YW55KT0+ewogICAgICAgICAgICByZXR1cm4gT2JqZWN0LmlzKGl0ZW0ub3JtZHV0eSxhcmdzLnJvdy5vcm1kdXR5KTsKICAgICAgICB9KTsKICAgICAgICByZXR1cm4gaXNTZWxlY3RlZCA/ICJncmlkLXNlbGVjdGVkLXJvdyIgOiAiIjsKICAgIH0KCiAgICAvKioKICAgICAqIOiOt+WPluWvueW6lOWIl2NsYXNzCiAgICAgKgogICAgICogQHBhcmFtIHsqfSAkYXJncyByb3cg6KGM5pWw5o2u77yMY29sdW1uIOWIl+aVsOaNru+8jHJvd0luZGV4IOihjOe0ouW8le+8jOWIl+e0ouW8lQogICAgICogQHJldHVybnMge3ZvaWR9CiAgICAgKiBAbWVtYmVyb2YgTWFpbkJhc2UKICAgICAqLwogICAgcHVibGljIGdldENlbGxDbGFzc05hbWUoYXJnczp7cm93OiBhbnksIGNvbHVtbjogYW55LCByb3dJbmRleDogbnVtYmVyLCBjb2x1bW5JbmRleDpudW1iZXJ9KXsKICAgICAgICBsZXQgaGFzUm93RWRpdDphbnkgPSB7CiAgICAgICAgICAneGgnOmZhbHNlLAogICAgICAgICAgJ2ZnbHgnOmZhbHNlLAogICAgICAgICAgJ29ybWR1dHluYW1lJzpmYWxzZSwKICAgICAgICAgICd1cGRhdGVtYW4nOmZhbHNlLAogICAgICAgICAgJ3VwZGF0ZWRhdGUnOmZhbHNlLAogICAgICAgIH0KICAgICAgICByZXR1cm4gKCBoYXNSb3dFZGl0W2FyZ3MuY29sdW1uLnByb3BlcnR5XSAmJiB0aGlzLmFjdHVhbElzT3BlbkVkaXQgKSA/ICJlZGl0LWNlbGwiIDogImluZm8tY2VsbCI7CiAgICB9CgogICAgLyoqCiAgICAgKiDmlrDlu7rpu5jorqTlgLwKICAgICAqIEBwYXJhbSB7Kn0gIHJvdyDooYzmlbDmja4KICAgICAqIEBtZW1iZXJvZiBNYWluQmFzZQogICAgICovCiAgICBwdWJsaWMgY3JlYXRlRGVmYXVsdChyb3c6IGFueSl7ICAgICAgICAgICAgICAgICAgICAKICAgIH0KfQo="},null]}
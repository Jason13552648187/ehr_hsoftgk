{"remainingRequest":"F:\\crod项目\\人事管理系统2\\iBizEHR\\app_EHRPim\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!F:\\crod项目\\人事管理系统2\\iBizEHR\\app_EHRPim\\src\\widgets\\pim-person\\hmdinfo-grid-grid\\hmdinfo-grid-grid-base.vue?vue&type=script&lang=tsx&","dependencies":[{"path":"F:\\crod项目\\人事管理系统2\\iBizEHR\\app_EHRPim\\src\\widgets\\pim-person\\hmdinfo-grid-grid\\hmdinfo-grid-grid-base.vue","mtime":1630509411871},{"path":"F:\\crod项目\\人事管理系统2\\iBizEHR\\app_EHRPim\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1630511852775},{"path":"F:\\crod项目\\人事管理系统2\\iBizEHR\\app_EHRPim\\node_modules\\thread-loader\\dist\\cjs.js","mtime":1630511853252},{"path":"F:\\crod项目\\人事管理系统2\\iBizEHR\\app_EHRPim\\node_modules\\babel-loader\\lib\\index.js","mtime":1630511852747},{"path":"F:\\crod项目\\人事管理系统2\\iBizEHR\\app_EHRPim\\node_modules\\ts-loader\\index.js","mtime":1630511985412},{"path":"F:\\crod项目\\人事管理系统2\\iBizEHR\\app_EHRPim\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1630511852775},{"path":"F:\\crod项目\\人事管理系统2\\iBizEHR\\app_EHRPim\\node_modules\\vue-loader\\lib\\index.js","mtime":1630512070338}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:CgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCmltcG9ydCB7IFZ1ZSwgQ29tcG9uZW50LCBQcm9wLCBQcm92aWRlLCBFbWl0LCBXYXRjaCwgTW9kZWwsSW5qZWN0IH0gZnJvbSAndnVlLXByb3BlcnR5LWRlY29yYXRvcic7CmltcG9ydCB7IENyZWF0ZUVsZW1lbnQgfSBmcm9tICd2dWUnOwppbXBvcnQgeyBTdWJqZWN0LCBTdWJzY3JpcHRpb24gfSBmcm9tICdyeGpzJzsKaW1wb3J0IHsgQ29udHJvbEludGVyZmFjZSB9IGZyb20gJ0AvaW50ZXJmYWNlL2NvbnRyb2wnOwppbXBvcnQgeyBVSUFjdGlvblRvb2wsVXRpbCB9IGZyb20gJ0AvdXRpbHMnOwppbXBvcnQgTmF2RGF0YVNlcnZpY2UgZnJvbSAnQC9zZXJ2aWNlL2FwcC9uYXZkYXRhLXNlcnZpY2UnOwppbXBvcnQgUGltUGVyc29uU2VydmljZSBmcm9tICdAL3NlcnZpY2UvcGltLXBlcnNvbi9waW0tcGVyc29uLXNlcnZpY2UnOwppbXBvcnQgSE1ESW5mb0dyaWRTZXJ2aWNlIGZyb20gJy4vaG1kaW5mby1ncmlkLWdyaWQtc2VydmljZSc7CgppbXBvcnQgQ29kZUxpc3RTZXJ2aWNlIGZyb20gIkBzZXJ2aWNlL2FwcC9jb2RlbGlzdC1zZXJ2aWNlIjsKaW1wb3J0IHsgRm9ybUl0ZW1Nb2RlbCB9IGZyb20gJ0AvbW9kZWwvZm9ybS1kZXRhaWwnOwoKCkBDb21wb25lbnQoewogICAgY29tcG9uZW50czogewogICAgICAKICAgIH0KfSkKZXhwb3J0IGRlZmF1bHQgY2xhc3MgSE1ESW5mb0dyaWRCYXNlIGV4dGVuZHMgVnVlIGltcGxlbWVudHMgQ29udHJvbEludGVyZmFjZSB7CgogICAgLyoqCiAgICAgKiDlkI3np7AKICAgICAqCiAgICAgKiBAdHlwZSB7c3RyaW5nfQogICAgICogQG1lbWJlcm9mIEhNREluZm9HcmlkQmFzZQogICAgICovCiAgICBAUHJvcCgpIHB1YmxpYyBuYW1lPzogc3RyaW5nOwoKICAgIC8qKgogICAgICog6KeG5Zu+6YCa6K6v5a+56LGhCiAgICAgKgogICAgICogQHR5cGUge1N1YmplY3Q8Vmlld1N0YXRlPn0KICAgICAqIEBtZW1iZXJvZiBITURJbmZvR3JpZEJhc2UKICAgICAqLwogICAgQFByb3AoKSBwdWJsaWMgdmlld1N0YXRlITogU3ViamVjdDxWaWV3U3RhdGU+OwoKICAgIC8qKgogICAgICog5bqU55So5LiK5LiL5paHCiAgICAgKgogICAgICogQHR5cGUgeyp9CiAgICAgKiBAbWVtYmVyb2YgSE1ESW5mb0dyaWRCYXNlCiAgICAgKi8KICAgIEBQcm9wKCkgcHVibGljIGNvbnRleHQ6IGFueTsKCiAgICAvKioKICAgICAqIOinhuWbvuWPguaVsAogICAgICoKICAgICAqIEB0eXBlIHsqfQogICAgICogQG1lbWJlcm9mIEhNREluZm9HcmlkQmFzZQogICAgICovCiAgICBAUHJvcCgpIHB1YmxpYyB2aWV3cGFyYW1zOiBhbnk7CgogICAgLyoqCiAgICAgKiDop4blm77nirbmgIHkuovku7YKICAgICAqCiAgICAgKiBAcHVibGljCiAgICAgKiBAdHlwZSB7KFN1YnNjcmlwdGlvbiB8IHVuZGVmaW5lZCl9CiAgICAgKiBAbWVtYmVyb2YgSE1ESW5mb0dyaWRCYXNlCiAgICAgKi8KICAgIHB1YmxpYyB2aWV3U3RhdGVFdmVudDogU3Vic2NyaXB0aW9uIHwgdW5kZWZpbmVkOwoKICAgIC8qKgogICAgICog6I635Y+W6YOo5Lu257G75Z6LCiAgICAgKgogICAgICogQHJldHVybnMge3N0cmluZ30KICAgICAqIEBtZW1iZXJvZiBITURJbmZvR3JpZEJhc2UKICAgICAqLwogICAgcHVibGljIGdldENvbnRyb2xUeXBlKCk6IHN0cmluZyB7CiAgICAgICAgcmV0dXJuICdHUklEJwogICAgfQoKCgogICAgLyoqCiAgICAgKiDorqHmlbDlmajmnI3liqHlr7nosaHpm4blkIgKICAgICAqCiAgICAgKiBAdHlwZSB7QXJyYXk8Kj59CiAgICAgKiBAbWVtYmVyb2YgSE1ESW5mb0dyaWRCYXNlCiAgICAgKi8gICAgCiAgICBwdWJsaWMgY291bnRlclNlcnZpY2VBcnJheTpBcnJheTxhbnk+ID0gW107CgogICAgLyoqCiAgICAgKiDlu7rmnoTpg6jku7bmnI3liqHlr7nosaEKICAgICAqCiAgICAgKiBAdHlwZSB7SE1ESW5mb0dyaWRTZXJ2aWNlfQogICAgICogQG1lbWJlcm9mIEhNREluZm9HcmlkQmFzZQogICAgICovCiAgICBwdWJsaWMgc2VydmljZTogSE1ESW5mb0dyaWRTZXJ2aWNlID0gbmV3IEhNREluZm9HcmlkU2VydmljZSh7ICRzdG9yZTogdGhpcy4kc3RvcmUgfSk7CgogICAgLyoqCiAgICAgKiDlrp7kvZPmnI3liqHlr7nosaEKICAgICAqCiAgICAgKiBAdHlwZSB7UGltUGVyc29uU2VydmljZX0KICAgICAqIEBtZW1iZXJvZiBITURJbmZvR3JpZEJhc2UKICAgICAqLwogICAgcHVibGljIGFwcEVudGl0eVNlcnZpY2U6IFBpbVBlcnNvblNlcnZpY2UgPSBuZXcgUGltUGVyc29uU2VydmljZSh7ICRzdG9yZTogdGhpcy4kc3RvcmUgfSk7CiAgICAKCgogICAgLyoqCiAgICAgKiDlhbPpl63op4blm74KICAgICAqCiAgICAgKiBAcGFyYW0ge2FueX0gYXJncwogICAgICogQG1lbWJlcm9mIEhNREluZm9HcmlkQmFzZQogICAgICovCiAgICBwdWJsaWMgY2xvc2VWaWV3KGFyZ3M6IGFueSk6IHZvaWQgewogICAgICAgIGxldCBfdGhpczogYW55ID0gdGhpczsKICAgICAgICBfdGhpcy4kZW1pdCgnY2xvc2V2aWV3JywgW2FyZ3NdKTsKICAgIH0KCiAgICAvKioKICAgICAqICDorqHmlbDlmajliLfmlrAKICAgICAqCiAgICAgKiBAbWVtYmVyb2YgSE1ESW5mb0dyaWRCYXNlCiAgICAgKi8KICAgIHB1YmxpYyBjb3VudGVyUmVmcmVzaCgpewogICAgICAgIGNvbnN0IF90aGlzOmFueSA9dGhpczsKICAgICAgICBpZihfdGhpcy5jb3VudGVyU2VydmljZUFycmF5ICYmIF90aGlzLmNvdW50ZXJTZXJ2aWNlQXJyYXkubGVuZ3RoID4wKXsKICAgICAgICAgICAgX3RoaXMuY291bnRlclNlcnZpY2VBcnJheS5mb3JFYWNoKChpdGVtOmFueSkgPT57CiAgICAgICAgICAgICAgICBpZihpdGVtLnJlZnJlc2hEYXRhICYmIGl0ZW0ucmVmcmVzaERhdGEgaW5zdGFuY2VvZiBGdW5jdGlvbil7CiAgICAgICAgICAgICAgICAgICAgaXRlbS5yZWZyZXNoRGF0YSgpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9KQogICAgICAgIH0KICAgIH0KCgogICAgLyoqCiAgICAgKiDku6PnoIHooajmnI3liqHlr7nosaEKICAgICAqCiAgICAgKiBAdHlwZSB7Q29kZUxpc3RTZXJ2aWNlfQogICAgICogQG1lbWJlcm9mIEhNREluZm9HcmlkQmFzZQogICAgICovICAKICAgIHB1YmxpYyBjb2RlTGlzdFNlcnZpY2U6Q29kZUxpc3RTZXJ2aWNlID0gbmV3IENvZGVMaXN0U2VydmljZSh7ICRzdG9yZTogdGhpcy4kc3RvcmUgfSk7CgogICAgLyoqCiAgICAgKiDojrflj5blpJrpobnmlbDmja4KICAgICAqCiAgICAgKiBAcmV0dXJucyB7YW55W119CiAgICAgKiBAbWVtYmVyb2YgSE1ESW5mb0dyaWRCYXNlCiAgICAgKi8KICAgIHB1YmxpYyBnZXREYXRhcygpOiBhbnlbXSB7CiAgICAgICAgcmV0dXJuIHRoaXMuc2VsZWN0aW9uczsKICAgIH0KCiAgICAvKioKICAgICAqIOiOt+WPluWNlemhueagkQogICAgICoKICAgICAqIEByZXR1cm5zIHsqfQogICAgICogQG1lbWJlcm9mIEhNREluZm9HcmlkQmFzZQogICAgICovCiAgICBwdWJsaWMgZ2V0RGF0YSgpOiBhbnkgewogICAgICAgIHJldHVybiB0aGlzLnNlbGVjdGlvbnNbMF07CiAgICB9CgogICAgLyoqCiAgICAgKiDmiZPlvIDmlrDlu7rmlbDmja7op4blm74KICAgICAqCiAgICAgKiBAdHlwZSB7YW55fQogICAgICogQG1lbWJlcm9mIEhNREluZm9HcmlkQmFzZQogICAgICovCiAgICBAUHJvcCgpIHB1YmxpYyBuZXdkYXRhOiBhbnk7CiAgICAvKioKICAgICAqIOaJk+W8gOe8lui+keaVsOaNruinhuWbvgogICAgICoKICAgICAqIEB0eXBlIHthbnl9CiAgICAgKiBAbWVtYmVyb2YgSE1ESW5mb0dyaWRCYXNlCiAgICAgKi8KICAgIEBQcm9wKCkgcHVibGljIG9wZW5kYXRhOiBhbnk7CgogICAgLyoqCiAgICAgKiDmmL7npLrlpITnkIbmj5DnpLoKICAgICAqCiAgICAgKiBAdHlwZSB7Ym9vbGVhbn0KICAgICAqIEBtZW1iZXJvZiBITURJbmZvR3JpZEJhc2UKICAgICAqLwogICAgQFByb3AoeyBkZWZhdWx0OiB0cnVlIH0pIHB1YmxpYyBzaG93QnVzeUluZGljYXRvcj86IGJvb2xlYW47CgogICAgLyoqCiAgICAgKiDpg6jku7booYzkuLotLXVwZGF0ZQogICAgICoKICAgICAqIEB0eXBlIHtzdHJpbmd9CiAgICAgKiBAbWVtYmVyb2YgSE1ESW5mb0dyaWRCYXNlCiAgICAgKi8KICAgIEBQcm9wKCkgcHVibGljIHVwZGF0ZUFjdGlvbiE6IHN0cmluZzsKICAgIAogICAgLyoqCiAgICAgKiDpg6jku7booYzkuLotLWZldGNoCiAgICAgKgogICAgICogQHR5cGUge3N0cmluZ30KICAgICAqIEBtZW1iZXJvZiBITURJbmZvR3JpZEJhc2UKICAgICAqLwogICAgQFByb3AoKSBwdWJsaWMgZmV0Y2hBY3Rpb24hOiBzdHJpbmc7CiAgICAKICAgIC8qKgogICAgICog6YOo5Lu26KGM5Li6LS1yZW1vdmUKICAgICAqCiAgICAgKiBAdHlwZSB7c3RyaW5nfQogICAgICogQG1lbWJlcm9mIEhNREluZm9HcmlkQmFzZQogICAgICovCiAgICBAUHJvcCgpIHB1YmxpYyByZW1vdmVBY3Rpb24hOiBzdHJpbmc7CiAgICAKICAgIC8qKgogICAgICog6YOo5Lu26KGM5Li6LS1sb2FkCiAgICAgKgogICAgICogQHR5cGUge3N0cmluZ30KICAgICAqIEBtZW1iZXJvZiBITURJbmZvR3JpZEJhc2UKICAgICAqLwogICAgQFByb3AoKSBwdWJsaWMgbG9hZEFjdGlvbiE6IHN0cmluZzsKICAgIAogICAgLyoqCiAgICAgKiDpg6jku7booYzkuLotLWxvYWRkcmFmdAogICAgICoKICAgICAqIEB0eXBlIHtzdHJpbmd9CiAgICAgKiBAbWVtYmVyb2YgSE1ESW5mb0dyaWRCYXNlCiAgICAgKi8KICAgIEBQcm9wKCkgcHVibGljIGxvYWRkcmFmdEFjdGlvbiE6IHN0cmluZzsKICAgIAogICAgLyoqCiAgICAgKiDpg6jku7booYzkuLotLWNyZWF0ZQogICAgICoKICAgICAqIEB0eXBlIHtzdHJpbmd9CiAgICAgKiBAbWVtYmVyb2YgSE1ESW5mb0dyaWRCYXNlCiAgICAgKi8KICAgIEBQcm9wKCkgcHVibGljIGNyZWF0ZUFjdGlvbiE6IHN0cmluZzsKCiAgICAvKioKICAgICAqIOW9k+WJjemhtQogICAgICoKICAgICAqIEB0eXBlIHtudW1iZXJ9CiAgICAgKiBAbWVtYmVyb2YgSE1ESW5mb0dyaWRCYXNlCiAgICAgKi8KICAgIHB1YmxpYyBjdXJQYWdlOiBudW1iZXIgPSAxOwoKICAgIC8qKgogICAgICog5pWw5o2uCiAgICAgKgogICAgICogQHR5cGUge2FueVtdfQogICAgICogQG1lbWJlcm9mIEhNREluZm9HcmlkQmFzZQogICAgICovCiAgICBwdWJsaWMgaXRlbXM6IGFueVtdID0gW107CgogICAgLyoqCiAgICAgKiDmmK/lkKbmlK/mjIHliIbpobUKICAgICAqCiAgICAgKiBAdHlwZSB7Ym9vbGVhbn0KICAgICAqIEBtZW1iZXJvZiBITURJbmZvR3JpZEJhc2UKICAgICAqLwogICAgcHVibGljIGlzRW5hYmxlUGFnaW5nQmFyOiBib29sZWFuID0gdHJ1ZTsKCiAgICAvKioKICAgICAqIOaYr+WQpuemgeeUqOaOkuW6jwogICAgICoKICAgICAqIEB0eXBlIHtib29sZWFufQogICAgICogQG1lbWJlcm9mIEhNREluZm9HcmlkQmFzZQogICAgICovCiAgICBwdWJsaWMgaXNOb1NvcnQ6IGJvb2xlYW4gPSBmYWxzZTsKCiAgICAvKioKICAgICAqIOaOkuW6j+aWueWQkQogICAgICoKICAgICAqIEB0eXBlIHtzdHJpbmd9CiAgICAgKiBAbWVtYmVyb2YgSE1ESW5mb0dyaWRCYXNlCiAgICAgKi8KICAgIHB1YmxpYyBtaW5vclNvcnREaXI6IHN0cmluZyA9ICdERVNDJzsKCiAgICAvKioKICAgICAqIOaOkuW6j+Wtl+autQogICAgICoKICAgICAqIEB0eXBlIHtzdHJpbmd9CiAgICAgKiBAbWVtYmVyb2YgSE1ESW5mb0dyaWRCYXNlCiAgICAgKi8KICAgIHB1YmxpYyBtaW5vclNvcnRQU0RFRjogc3RyaW5nID0gJ3VwZGF0ZWRhdGUnOwoKICAgIC8qKgogICAgICog5YiG6aG15p2h5pWwCiAgICAgKgogICAgICogQHR5cGUge251bWJlcn0KICAgICAqIEBtZW1iZXJvZiBITURJbmZvR3JpZEJhc2UKICAgICAqLwogICAgcHVibGljIGxpbWl0OiBudW1iZXIgPSAxMDA7CgogICAgLyoqCiAgICAgKiDmmK/lkKbmmL7npLrmoIfpopgKICAgICAqCiAgICAgKiBAdHlwZSB7Ym9vbGVhbn0KICAgICAqIEBtZW1iZXJvZiBITURJbmZvR3JpZEJhc2UKICAgICAqLwogICAgcHVibGljIGlzSGlkZUhlYWRlcjogYm9vbGVhbiA9IGZhbHNlOwoKICAgIC8qKgogICAgICog5piv5ZCm6buY6K6k6YCJ5Lit56ys5LiA5p2h5pWw5o2uCiAgICAgKgogICAgICogQHR5cGUge2Jvb2xlYW59CiAgICAgKiBAbWVtYmVyb2YgSE1ESW5mb0dyaWRCYXNlCiAgICAgKi8KICAgIEBQcm9wKHsgZGVmYXVsdDogZmFsc2UgfSkgcHVibGljIGlzU2VsZWN0Rmlyc3REZWZhdWx0ITogYm9vbGVhbjsKCiAgICAvKioKICAgICAqIOaYr+WQpuWNlemAiQogICAgICoKICAgICAqIEB0eXBlIHtib29sZWFufQogICAgICogQG1lbWJlcm9mIEhNREluZm9HcmlkQmFzZQogICAgICovCiAgICBAUHJvcCgpIHB1YmxpYyBpc1NpbmdsZVNlbGVjdD86IGJvb2xlYW47CgogICAgLyoqCiAgICAgKiDpgInkuK3mlbDmja7lrZfnrKbkuLIKICAgICAqCiAgICAgKiBAdHlwZSB7c3RyaW5nfQogICAgICogQG1lbWJlcm9mIEhNREluZm9HcmlkQmFzZQogICAgICovCiAgICBAUHJvcCgpIHB1YmxpYyBzZWxlY3RlZERhdGE/OiBzdHJpbmc7CgogICAgLyoqCiAgICAgKiDpgInkuK3lgLzlj5jljJYKICAgICAqCiAgICAgKiBAcGFyYW0geyp9IG5ld1ZhbAogICAgICogQHBhcmFtIHsqfSBvbGRWYWwKICAgICAqIEBtZW1iZXJvZiBITURJbmZvR3JpZEJhc2UKICAgICAqLwogICAgQFdhdGNoKCdzZWxlY3RlZERhdGEnKQogICAgcHVibGljIG9uVmFsdWVDaGFuZ2UobmV3VmFsOiBhbnksIG9sZFZhbDogYW55KSB7CiAgICAgICAgdGhpcy5zZWxlY3Rpb25zID0gW107CiAgICAgICAgaWYodGhpcy5zZWxlY3RlZERhdGEpewogICAgICAgICAgICBjb25zdCByZWZzOiBhbnkgPSB0aGlzLiRyZWZzOwogICAgICAgICAgICBpZiAocmVmcy5tdWx0aXBsZVRhYmxlKSB7CiAgICAgICAgICAgICAgICByZWZzLm11bHRpcGxlVGFibGUuY2xlYXJTZWxlY3Rpb24oKTsKICAgICAgICAgICAgICAgIEpTT04ucGFyc2UodGhpcy5zZWxlY3RlZERhdGEpLmZvckVhY2goKHNlbGVjdGlvbjphbnkpPT57CiAgICAgICAgICAgICAgICAgICAgbGV0IHNlbGVjdGVkSXRlbSA9IHRoaXMuaXRlbXMuZmluZCgoaXRlbTphbnkpPT57CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBPYmplY3QuaXMoaXRlbS5zcmZrZXksIHNlbGVjdGlvbi5zcmZrZXkpOwogICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgIGlmKHNlbGVjdGVkSXRlbSl7CiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMucm93Q2xpY2soc2VsZWN0ZWRJdGVtKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIOihqOagvOihjOaVsOaNrum7mOiupOa/gOa0u+aooeW8jwogICAgICogMCDkuI3mv4DmtLsKICAgICAqIDEg5Y2V5Ye75r+A5rS7CiAgICAgKiAyIOWPjOWHu+a/gOa0uwogICAgICoKICAgICAqIEB0eXBlIHsobnVtYmVyIHwgMCB8IDEgfCAyKX0KICAgICAqIEBtZW1iZXJvZiBITURJbmZvR3JpZEJhc2UKICAgICAqLwogICAgQFByb3Aoe2RlZmF1bHQ6IDJ9KSBwdWJsaWMgZ3JpZFJvd0FjdGl2ZU1vZGUhOiBudW1iZXI7CgogICAgLyoqCiAgICAgKiDmmK/lkKblvIDlkK/ooYznvJbovpEKICAgICAqCiAgICAgKiBAdHlwZSB7Ym9vbGVhbn0KICAgICAqIEBtZW1iZXJvZiBITURJbmZvR3JpZEJhc2UKICAgICAqLwogICAgQFByb3Aoe2RlZmF1bHQ6IGZhbHNlfSkgcHVibGljIGlzT3BlbkVkaXQhOiBib29sZWFuOwoKICAgIC8qKgogICAgICog5a6e6ZmF5piv5ZCm5byA5ZCv6KGM57yW6L6RCiAgICAgKgogICAgICogQHR5cGUge2Jvb2xlYW59CiAgICAgKiBAbWVtYmVyb2YgSE1ESW5mb0dyaWRCYXNlCiAgICAgKi8KICAgIHB1YmxpYyBhY3R1YWxJc09wZW5FZGl0OiBib29sZWFuID0gdGhpcy5pc09wZW5FZGl0OwoKICAgIC8qKgogICAgICog5oC75p2h5pWwCiAgICAgKgogICAgICogQHR5cGUge251bWJlcn0KICAgICAqIEBtZW1iZXJvZiBITURJbmZvR3JpZEJhc2UKICAgICAqLwogICAgcHVibGljIHRvdGFscm93OiBudW1iZXIgPSAwOwoKICAgIC8qKgogICAgICog6YCJ5Lit6KGM5pWw5o2uCiAgICAgKgogICAgICogQHR5cGUge2FueVtdfQogICAgICogQG1lbWJlcm9mIE1haW4KICAgICAqLwogICAgcHVibGljIHNlbGVjdGlvbnM6IGFueVtdID0gW107CgogICAgLyoqCiAgICAgKiDmi6bmiKrooYzpgInkuK0KICAgICAqCiAgICAgKiBAdHlwZSB7Ym9vbGVhbn0KICAgICAqIEBtZW1iZXJvZiBNYWluCiAgICAgKi8KICAgIHB1YmxpYyBzdG9wUm93Q2xpY2s6IGJvb2xlYW4gPSBmYWxzZTsKCgoKCiAgICAvKioKICAgICAqIOihqOagvOaYr+WQpuaYvuekugogICAgICoKICAgICAqIEB0eXBlIHtib29sZWFufQogICAgICogQG1lbWJlcm9mIEhNREluZm9HcmlkQmFzZQogICAgICovCiAgICBwdWJsaWMgaXNEaXNwbGF5OmJvb2xlYW4gPSB0cnVlOwoKICAgIC8qKgogICAgICog6YOo5Lu25Yi35pawCiAgICAgKgogICAgICogQHBhcmFtIHthbnlbXX0gYXJncwogICAgICogQG1lbWJlcm9mIEhNREluZm9HcmlkQmFzZQogICAgICovCiAgICBwdWJsaWMgcmVmcmVzaChhcmdzOiBhbnlbXSk6IHZvaWQgewogICAgICAgIHRoaXMubG9hZCgpOwogICAgfQoKICAgIC8qKgogICAgKiDpgInpobnmoYbliJflrr0KICAgICoKICAgICogQHR5cGUge251bWJlcn0KICAgICogQG1lbWJlcm9mIEFwcEluZGV4CiAgICAqLwogICAgcHVibGljIGNoZWNrYm94Q29sV2lkdGg6IG51bWJlciA9IDM0OwoKICAgIC8qKgogICAgICog5piv5ZCm5YWB6K645ouW5Yqo5YiX5a69CiAgICAgKgogICAgICogQHR5cGUge2Jvb2xlYW59CiAgICAgKiBAbWVtYmVyb2YgQXBwRW1iZWRQaWNrZXIKICAgICAqLwogICAgcHVibGljIGlzRHJhZ2VuZENvbDogYm9vbGVhbiA9IGZhbHNlOwoKICAgIC8qKgogICAgICog5omA5pyJ5YiX5oiQ5ZGYCiAgICAgKgogICAgICogQHR5cGUge2FueVtdfQogICAgICogQG1lbWJlcm9mIEhNREluZm9HcmlkQmFzZQogICAgICovCiAgICBwdWJsaWMgYWxsQ29sdW1uczogYW55W10gPSBbCiAgICAgICAgewogICAgICAgICAgICBuYW1lOiAneWdiaCcsCiAgICAgICAgICAgIGxhYmVsOiAn5ZGY5bel57yW5Y+3JywKICAgICAgICAgICAgbGFuZ3RhZzogJ2VudGl0aWVzLnBpbXBlcnNvbi5obWRpbmZvZ3JpZF9ncmlkLmNvbHVtbnMueWdiaCcsCiAgICAgICAgICAgIHNob3c6IHRydWUsCiAgICAgICAgICAgIHV0aWw6ICdQWCcKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgbmFtZTogJ3BpbXBlcnNvbm5hbWUnLAogICAgICAgICAgICBsYWJlbDogJ+WRmOW3peWnk+WQjScsCiAgICAgICAgICAgIGxhbmd0YWc6ICdlbnRpdGllcy5waW1wZXJzb24uaG1kaW5mb2dyaWRfZ3JpZC5jb2x1bW5zLnBpbXBlcnNvbm5hbWUnLAogICAgICAgICAgICBzaG93OiB0cnVlLAogICAgICAgICAgICB1dGlsOiAnUFgnCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgIG5hbWU6ICd6amhtJywKICAgICAgICAgICAgbGFiZWw6ICfor4Hku7blj7fnoIEnLAogICAgICAgICAgICBsYW5ndGFnOiAnZW50aXRpZXMucGltcGVyc29uLmhtZGluZm9ncmlkX2dyaWQuY29sdW1ucy56amhtJywKICAgICAgICAgICAgc2hvdzogdHJ1ZSwKICAgICAgICAgICAgdXRpbDogJ1BYJwogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICBuYW1lOiAnenpkenMnLAogICAgICAgICAgICBsYWJlbDogJ+e7hOe7hycsCiAgICAgICAgICAgIGxhbmd0YWc6ICdlbnRpdGllcy5waW1wZXJzb24uaG1kaW5mb2dyaWRfZ3JpZC5jb2x1bW5zLnp6ZHpzJywKICAgICAgICAgICAgc2hvdzogdHJ1ZSwKICAgICAgICAgICAgdXRpbDogJ3B4JwogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICBuYW1lOiAneWd6dCcsCiAgICAgICAgICAgIGxhYmVsOiAn5ZGY5bel54q25oCBJywKICAgICAgICAgICAgbGFuZ3RhZzogJ2VudGl0aWVzLnBpbXBlcnNvbi5obWRpbmZvZ3JpZF9ncmlkLmNvbHVtbnMueWd6dCcsCiAgICAgICAgICAgIHNob3c6IHRydWUsCiAgICAgICAgICAgIHV0aWw6ICdQWCcKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgbmFtZTogJ2htZCcsCiAgICAgICAgICAgIGxhYmVsOiAn5YiX5YWl6buR5ZCN5Y2VJywKICAgICAgICAgICAgbGFuZ3RhZzogJ2VudGl0aWVzLnBpbXBlcnNvbi5obWRpbmZvZ3JpZF9ncmlkLmNvbHVtbnMuaG1kJywKICAgICAgICAgICAgc2hvdzogdHJ1ZSwKICAgICAgICAgICAgdXRpbDogJ1BYJwogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICBuYW1lOiAnYmxhY2tsaXN0cmVhc29ucycsCiAgICAgICAgICAgIGxhYmVsOiAn6buR5ZCN5Y2V5Y6f5ZugJywKICAgICAgICAgICAgbGFuZ3RhZzogJ2VudGl0aWVzLnBpbXBlcnNvbi5obWRpbmZvZ3JpZF9ncmlkLmNvbHVtbnMuYmxhY2tsaXN0cmVhc29ucycsCiAgICAgICAgICAgIHNob3c6IHRydWUsCiAgICAgICAgICAgIHV0aWw6ICdQWCcKICAgICAgICB9LAogICAgXQoKICAgIC8qKgogICAgICog6KGo5qC85qih5Z6L6ZuG5ZCICiAgICAgKgogICAgICogQHR5cGUgeyp9CiAgICAgKiBAbWVtYmVyb2YgSE1ESW5mb0dyaWRCYXNlCiAgICAgKi8KICAgIHB1YmxpYyBncmlkSXRlbXNNb2RlbDogYW55W10gPSBbXTsKCiAgICAvKioKICAgICAqIOiOt+WPluihqOagvOihjOaooeWeiwogICAgICoKICAgICAqIEB0eXBlIHsqfQogICAgICogQG1lbWJlcm9mIEhNREluZm9HcmlkQmFzZQogICAgICovCiAgICBwdWJsaWMgZ2V0R3JpZFJvd01vZGVsKCl7CiAgICAgICAgcmV0dXJuIHsKICAgICAgICAgIHNyZmtleTogbmV3IEZvcm1JdGVtTW9kZWwoKSwKICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiDlsZ7mgKflgLzop4TliJkKICAgICAqCiAgICAgKiBAdHlwZSB7Kn0KICAgICAqIEBtZW1iZXJvZiBITURJbmZvR3JpZEJhc2UKICAgICAqLwogICAgcHVibGljIHJ1bGVzOiBhbnkgPSB7CiAgICAgICAgc3Jma2V5OiBbCiAgICAgICAgICAgICB7IHJlcXVpcmVkOiBmYWxzZSwgdmFsaWRhdG9yOiAocnVsZTphbnksIHZhbHVlOmFueSwgY2FsbGJhY2s6YW55KSA9PiB7IHJldHVybiAocnVsZS5yZXF1aXJlZCAmJiAodmFsdWUgPT09IG51bGwgfHwgdmFsdWUgPT09IHVuZGVmaW5lZCB8fCB2YWx1ZSA9PT0gIiIpKSA/IGZhbHNlIDogdHJ1ZTt9LCBtZXNzYWdlOiAn5Lq65ZGY5L+h5oGv5qCH6K+GIOWAvOS4jeiDveS4uuepuicsIHRyaWdnZXI6ICdjaGFuZ2UnIH0sCiAgICAgICAgICAgIHsgcmVxdWlyZWQ6IGZhbHNlLCB2YWxpZGF0b3I6IChydWxlOmFueSwgdmFsdWU6YW55LCBjYWxsYmFjazphbnkpID0+IHsgcmV0dXJuIChydWxlLnJlcXVpcmVkICYmICh2YWx1ZSA9PT0gbnVsbCB8fCB2YWx1ZSA9PT0gdW5kZWZpbmVkIHx8IHZhbHVlID09PSAiIikpID8gZmFsc2UgOiB0cnVlO30sIG1lc3NhZ2U6ICfkurrlkZjkv6Hmga/moIfor4Yg5YC85LiN6IO95Li656m6JywgdHJpZ2dlcjogJ2JsdXInIH0sCiAgICAgICAgXSwKICAgIH0KCiAgICAvKioKICAgICAqIOihqOagvOihjOe8lui+kemhueagoemqjAogICAgICoKICAgICAqIEBwYXJhbSB7c3RyaW5nfSBwcm9wZXJ0eSDlsZ7mgKflkI0KICAgICAqIEBwYXJhbSB7Kn0gZGF0YSDooYzmlbDmja4KICAgICAqIEBwYXJhbSB7bnVtYmVyfSByb3dJbmRleCDooYzntKLlvJUKICAgICAqIEByZXR1cm5zIFByb21pc2U8YW55PgogICAgICogCiAgICAgKiBAbWVtYmVyb2YgSE1ESW5mb0dyaWRCYXNlCiAgICAgKi8KICAgIHB1YmxpYyB2YWxpZGF0ZShwcm9wZXJ0eTpzdHJpbmcsIGRhdGE6YW55LCByb3dJbmRleDpudW1iZXIpOlByb21pc2U8YW55PnsKICAgICAgICByZXR1cm4gbmV3IFByb21pc2UoKHJlc29sdmUsIHJlamVjdCkgPT4gewogICAgICAgICAgICB0aGlzLiR1dGlsLnZhbGlkYXRlSXRlbShwcm9wZXJ0eSxkYXRhLHRoaXMucnVsZXMpLnRoZW4oKCk9PnsKICAgICAgICAgICAgICAgIHRoaXMuZ3JpZEl0ZW1zTW9kZWxbcm93SW5kZXhdW3Byb3BlcnR5XS5zZXRFcnJvcihudWxsKTsKICAgICAgICAgICAgICAgIHJlc29sdmUodHJ1ZSk7CiAgICAgICAgICAgIH0pLmNhdGNoKCh7IGVycm9ycywgZmllbGRzIH0pID0+IHsKICAgICAgICAgICAgICAgIHRoaXMuZ3JpZEl0ZW1zTW9kZWxbcm93SW5kZXhdW3Byb3BlcnR5XS5zZXRFcnJvcihlcnJvcnNbMF0ubWVzc2FnZSk7CiAgICAgICAgICAgICAgICByZXNvbHZlKGZhbHNlKTsKICAgICAgICAgICAgfSk7CiAgICAgICAgfSk7CiAgICB9CgogICAgLyoqCiAgICAgKiDmoKHpqozmiYDmnInkv67mlLnov4fnmoTnvJbovpHpobkKICAgICAqCiAgICAgKiBAcmV0dXJucyBQcm9taXNlPGFueT4KICAgICAqIEBtZW1iZXJvZiBITURJbmZvR3JpZEJhc2UKICAgICAqLwogICAgcHVibGljIGFzeW5jIHZhbGlkYXRlQWxsKCl7CiAgICAgICAgbGV0IHZhbGlkYXRlU3RhdGUgPSB0cnVlOwogICAgICAgIGxldCBpbmRleCA9IC0xOwogICAgICAgIGZvcihsZXQgaXRlbSBvZiB0aGlzLml0ZW1zKXsKICAgICAgICAgIGluZGV4Kys7CiAgICAgICAgICBpZihpdGVtLnJvd0RhdGFTdGF0ZSA9PT0gImNyZWF0ZSIgfHwgaXRlbS5yb3dEYXRhU3RhdGUgPT09ICJ1cGRhdGUiKXsKICAgICAgICAgICAgZm9yKGxldCBwcm9wZXJ0eSBvZiBPYmplY3Qua2V5cyh0aGlzLnJ1bGVzKSl7CiAgICAgICAgICAgICAgaWYoIWF3YWl0IHRoaXMudmFsaWRhdGUocHJvcGVydHksaXRlbSxpbmRleCkpewogICAgICAgICAgICAgICAgdmFsaWRhdGVTdGF0ZSA9IGZhbHNlOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0KICAgICAgICByZXR1cm4gdmFsaWRhdGVTdGF0ZTsKICAgIH0KCiAgICAvKioKICAgICAqIOihqOagvOaVsOaNruWKoOi9vQogICAgICoKICAgICAqIEBwYXJhbSB7Kn0gW2FyZz17fV0KICAgICAqIEBtZW1iZXJvZiBITURJbmZvR3JpZEJhc2UKICAgICAqLwogICAgcHVibGljIGxvYWQob3B0OiBhbnkgPSB7fSwgcGFnZVJlc2V0OiBib29sZWFuID0gZmFsc2UpOiB2b2lkIHsKICAgICAgICBpZighdGhpcy5mZXRjaEFjdGlvbil7CiAgICAgICAgICAgIHRoaXMuJE5vdGljZS5lcnJvcih7IHRpdGxlOiAn6ZSZ6K+vJywgZGVzYzogJ1BJTVBFUlNPTkhNREdyaWRWaWV36KeG5Zu+6KGo5qC8ZmV0Y2hBY3Rpb27lj4LmlbDmnKrphY3nva4nIH0pOwogICAgICAgICAgICByZXR1cm47CiAgICAgICAgfQogICAgICAgIGlmKHBhZ2VSZXNldCl7CiAgICAgICAgICAgIHRoaXMuY3VyUGFnZSA9IDE7CiAgICAgICAgfQogICAgICAgIGNvbnN0IGFyZzogYW55ID0gey4uLm9wdH07CiAgICAgICAgY29uc3QgcGFnZTogYW55ID0ge307CiAgICAgICAgaWYgKHRoaXMuaXNFbmFibGVQYWdpbmdCYXIpIHsKICAgICAgICAgICAgT2JqZWN0LmFzc2lnbihwYWdlLCB7IHBhZ2U6IHRoaXMuY3VyUGFnZS0xLCBzaXplOiB0aGlzLmxpbWl0IH0pOwogICAgICAgIH0KICAgICAgICAvLyDorr7nva7mjpLluo8KICAgICAgICBpZiAoIXRoaXMuaXNOb1NvcnQgJiYgIU9iamVjdC5pcyh0aGlzLm1pbm9yU29ydERpciwgJycpICYmICFPYmplY3QuaXModGhpcy5taW5vclNvcnRQU0RFRiwgJycpKSB7CiAgICAgICAgICAgIGNvbnN0IHNvcnQ6IHN0cmluZyA9IHRoaXMubWlub3JTb3J0UFNERUYrIiwiK3RoaXMubWlub3JTb3J0RGlyOwogICAgICAgICAgICBPYmplY3QuYXNzaWduKHBhZ2UsIHsgc29ydDogc29ydCB9KTsKICAgICAgICB9CiAgICAgICAgT2JqZWN0LmFzc2lnbihhcmcsIHBhZ2UpOwogICAgICAgIGNvbnN0IHBhcmVudGRhdGE6IGFueSA9IHt9OwogICAgICAgIHRoaXMuJGVtaXQoJ2JlZm9yZWxvYWQnLCBwYXJlbnRkYXRhKTsKICAgICAgICBPYmplY3QuYXNzaWduKGFyZywgcGFyZW50ZGF0YSk7CiAgICAgICAgbGV0IHRlbXBWaWV3UGFyYW1zOmFueSA9IHBhcmVudGRhdGEudmlld3BhcmFtcz9wYXJlbnRkYXRhLnZpZXdwYXJhbXM6e307CiAgICAgICAgT2JqZWN0LmFzc2lnbih0ZW1wVmlld1BhcmFtcyxKU09OLnBhcnNlKEpTT04uc3RyaW5naWZ5KHRoaXMudmlld3BhcmFtcykpKTsKICAgICAgICBPYmplY3QuYXNzaWduKGFyZyx7dmlld3BhcmFtczp0ZW1wVmlld1BhcmFtc30pOwogICAgICAgIGNvbnN0IHBvc3Q6IFByb21pc2U8YW55PiA9IHRoaXMuc2VydmljZS5zZWFyY2godGhpcy5mZXRjaEFjdGlvbixKU09OLnBhcnNlKEpTT04uc3RyaW5naWZ5KHRoaXMuY29udGV4dCkpLCBhcmcsIHRoaXMuc2hvd0J1c3lJbmRpY2F0b3IpOwogICAgICAgIHBvc3QudGhlbigocmVzcG9uc2U6IGFueSkgPT4gewogICAgICAgICAgICBpZiAoIXJlc3BvbnNlLnN0YXR1cyB8fCByZXNwb25zZS5zdGF0dXMgIT09IDIwMCkgewogICAgICAgICAgICAgICAgaWYgKHJlc3BvbnNlLmVycm9yTWVzc2FnZSkgewogICAgICAgICAgICAgICAgICAgIHRoaXMuJE5vdGljZS5lcnJvcih7IHRpdGxlOiAn6ZSZ6K+vJywgZGVzYzogcmVzcG9uc2UuZXJyb3JNZXNzYWdlIH0pOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGNvbnN0IGRhdGE6IGFueSA9IHJlc3BvbnNlLmRhdGE7CiAgICAgICAgICAgIHRoaXMudG90YWxyb3cgPSByZXNwb25zZS50b3RhbDsKICAgICAgICAgICAgdGhpcy5pdGVtcyA9IEpTT04ucGFyc2UoSlNPTi5zdHJpbmdpZnkoZGF0YSkpOwogICAgICAgICAgICAvLyDmuIXnqbpzZWxlY3Rpb25zLGdyaWRJdGVtc01vZGVsCiAgICAgICAgICAgIHRoaXMuc2VsZWN0aW9ucyA9IFtdOwogICAgICAgICAgICB0aGlzLmdyaWRJdGVtc01vZGVsID0gW107CiAgICAgICAgICAgIHRoaXMuaXRlbXMuZm9yRWFjaCgoKT0+e3RoaXMuZ3JpZEl0ZW1zTW9kZWwucHVzaCh0aGlzLmdldEdyaWRSb3dNb2RlbCgpKX0pOwogICAgICAgICAgICB0aGlzLiRlbWl0KCdsb2FkJywgdGhpcy5pdGVtcyk7CiAgICAgICAgICAgIC8vIOiuvue9rum7mOiupOmAieS4rQogICAgICAgICAgICBsZXQgX3RoaXMgPSB0aGlzOwogICAgICAgICAgICBzZXRUaW1lb3V0KCgpID0+IHsKICAgICAgICAgICAgICAgIGlmKF90aGlzLmlzU2VsZWN0Rmlyc3REZWZhdWx0KXsKICAgICAgICAgICAgICAgICAgX3RoaXMucm93Q2xpY2soX3RoaXMuaXRlbXNbMF0pOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgaWYoX3RoaXMuc2VsZWN0ZWREYXRhKXsKICAgICAgICAgICAgICAgICAgICBjb25zdCByZWZzOiBhbnkgPSBfdGhpcy4kcmVmczsKICAgICAgICAgICAgICAgICAgICBpZiAocmVmcy5tdWx0aXBsZVRhYmxlKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJlZnMubXVsdGlwbGVUYWJsZS5jbGVhclNlbGVjdGlvbigpOwogICAgICAgICAgICAgICAgICAgICAgICBKU09OLnBhcnNlKF90aGlzLnNlbGVjdGVkRGF0YSkuZm9yRWFjaCgoc2VsZWN0aW9uOmFueSk9PnsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxldCBzZWxlY3RlZEl0ZW0gPSBfdGhpcy5pdGVtcy5maW5kKChpdGVtOmFueSk9PnsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gT2JqZWN0LmlzKGl0ZW0uc3Jma2V5LCBzZWxlY3Rpb24uc3Jma2V5KTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYoc2VsZWN0ZWRJdGVtKXsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBfdGhpcy5yb3dDbGljayhzZWxlY3RlZEl0ZW0pOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0sIDMwMCk7CiAgICAgICAgfSkuY2F0Y2goKHJlc3BvbnNlOiBhbnkpID0+IHsKICAgICAgICAgICAgaWYgKHJlc3BvbnNlICYmIHJlc3BvbnNlLnN0YXR1cyA9PT0gNDAxKSB7CiAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgIH0KICAgICAgICAgICAgdGhpcy4kTm90aWNlLmVycm9yKHsgdGl0bGU6ICfplJnor68nLCBkZXNjOiByZXNwb25zZS5lcnJvck1lc3NhZ2UgfSk7CiAgICAgICAgfSk7CiAgICB9CgogICAgLyoqCiAgICAgKiDliKDpmaQKICAgICAqCiAgICAgKiBAcGFyYW0ge2FueVtdfSBkYXRhcwogICAgICogQHJldHVybnMge1Byb21pc2U8YW55Pn0KICAgICAqIEBtZW1iZXJvZiBITURJbmZvR3JpZEJhc2UKICAgICAqLwogICAgcHVibGljIGFzeW5jIHJlbW92ZShkYXRhczogYW55W10pOiBQcm9taXNlPGFueT4gewogICAgICAgIGlmKCF0aGlzLnJlbW92ZUFjdGlvbil7CiAgICAgICAgICAgIHRoaXMuJE5vdGljZS5lcnJvcih7IHRpdGxlOiAn6ZSZ6K+vJywgZGVzYzogJ1BJTVBFUlNPTkhNREdyaWRWaWV36KeG5Zu+6KGo5qC8cmVtb3ZlQWN0aW9u5Y+C5pWw5pyq6YWN572uJyB9KTsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KICAgICAgICBsZXQgX2RhdGFzOmFueVtdID0gW107CiAgICAgICAgZGF0YXMuZm9yRWFjaCgocmVjb3JkOiBhbnksIGluZGV4OiBudW1iZXIpID0+IHsKICAgICAgICAgICAgaWYgKE9iamVjdC5pcyhyZWNvcmQuc3JmdWYsIjAiKSkgewogICAgICAgICAgICAgICAgdGhpcy5pdGVtcy5zb21lKCh2YWw6IGFueSwgbnVtOiBudW1iZXIpID0+ewogICAgICAgICAgICAgICAgICAgIGlmKEpTT04uc3RyaW5naWZ5KHZhbCkgPT0gSlNPTi5zdHJpbmdpZnkocmVjb3JkKSl7CiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuaXRlbXMuc3BsaWNlKG51bSwxKTsKICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5ncmlkSXRlbXNNb2RlbC5zcGxpY2UobnVtLDEpOwogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9KTsgCiAgICAgICAgICAgIH1lbHNlewogICAgICAgICAgICAgICBfZGF0YXMucHVzaChkYXRhc1tpbmRleF0pOwogICAgICAgICAgICB9CiAgICAgICAgfSk7CiAgICAgICAgaWYgKF9kYXRhcy5sZW5ndGggPT09IDApIHsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KICAgICAgICBsZXQgZGF0YUluZm8gPSAnJzsKICAgICAgICBfZGF0YXMuZm9yRWFjaCgocmVjb3JkOiBhbnksIGluZGV4OiBudW1iZXIpID0+IHsKICAgICAgICAgICAgbGV0IHNyZm1ham9ydGV4dCA9IHJlY29yZC5waW1wZXJzb25uYW1lOwogICAgICAgICAgICBpZiAoaW5kZXggPCA1KSB7CiAgICAgICAgICAgICAgICBpZiAoIU9iamVjdC5pcyhkYXRhSW5mbywgJycpKSB7CiAgICAgICAgICAgICAgICAgICAgZGF0YUluZm8gKz0gJ+OAgSc7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBkYXRhSW5mbyArPSBzcmZtYWpvcnRleHQ7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgICAgIH0KICAgICAgICB9KTsKCiAgICAgICAgaWYgKF9kYXRhcy5sZW5ndGggPCA1KSB7CiAgICAgICAgICAgIGRhdGFJbmZvID0gZGF0YUluZm8gKyAnIOWFsScgKyBfZGF0YXMubGVuZ3RoICsgJ+adoeaVsOaNric7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgZGF0YUluZm8gPSBkYXRhSW5mbyArICcuLi4nICsgJyDlhbEnICsgX2RhdGFzLmxlbmd0aCArICfmnaHmlbDmja4nOwogICAgICAgIH0KCiAgICAgICAgY29uc3QgcmVtb3ZlRGF0YSA9ICgpID0+IHsKICAgICAgICAgICAgbGV0IGtleXM6IGFueVtdID0gW107CiAgICAgICAgICAgIF9kYXRhcy5mb3JFYWNoKChkYXRhOiBhbnkpID0+IHsKICAgICAgICAgICAgICAgIGtleXMucHVzaChkYXRhLnNyZmtleSk7CiAgICAgICAgICAgIH0pOwogICAgICAgICAgICBsZXQgX3JlbW92ZUFjdGlvbiA9IGtleXMubGVuZ3RoID4gMSA/ICdyZW1vdmVCYXRjaCcgOiB0aGlzLnJlbW92ZUFjdGlvbiA7CiAgICAgICAgICAgIGxldCBfa2V5cyA9IGtleXMubGVuZ3RoID4gMSA/IGtleXMgOiBrZXlzWzBdIDsKICAgICAgICAgICAgY29uc3QgY29udGV4dDphbnkgPSBKU09OLnBhcnNlKEpTT04uc3RyaW5naWZ5KHRoaXMuY29udGV4dCkpOwogICAgICAgICAgICBjb25zdCBwb3N0OiBQcm9taXNlPGFueT4gPSB0aGlzLnNlcnZpY2UuZGVsZXRlKF9yZW1vdmVBY3Rpb24sT2JqZWN0LmFzc2lnbihjb250ZXh0LHsgcGltcGVyc29uOiBfa2V5cyB9KSxPYmplY3QuYXNzaWduKHsgcGltcGVyc29uOiBfa2V5cyB9LHt2aWV3cGFyYW1zOnRoaXMudmlld3BhcmFtc30pLCB0aGlzLnNob3dCdXN5SW5kaWNhdG9yKTsKICAgICAgICAgICAgcmV0dXJuIG5ldyBQcm9taXNlKChyZXNvbHZlOiBhbnksIHJlamVjdDogYW55KSA9PiB7CiAgICAgICAgICAgICAgICBwb3N0LnRoZW4oKHJlc3BvbnNlOiBhbnkpID0+IHsKICAgICAgICAgICAgICAgICAgICBpZiAoIXJlc3BvbnNlIHx8IHJlc3BvbnNlLnN0YXR1cyAhPT0gMjAwKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuJE5vdGljZS5lcnJvcih7IHRpdGxlOiAnJywgZGVzYzogJ+WIoOmZpOaVsOaNruWksei0pSwnICsgcmVzcG9uc2UuaW5mbyB9KTsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuJE5vdGljZS5zdWNjZXNzKHsgdGl0bGU6ICcnLCBkZXNjOiAn5Yig6Zmk5oiQ5YqfIScgfSk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIC8v5Yig6ZmkaXRlbXPkuK3lt7LliKDpmaTnmoTpobkKICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyh0aGlzLml0ZW1zKTsKICAgICAgICAgICAgICAgICAgICBfZGF0YXMuZm9yRWFjaCgoZGF0YTogYW55KSA9PiB7CiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuaXRlbXMuc29tZSgoaXRlbTphbnksaW5kZXg6bnVtYmVyKT0+ewogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYoT2JqZWN0LmlzKGl0ZW0uc3Jma2V5LGRhdGEuc3Jma2V5KSl7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5pdGVtcy5zcGxpY2UoaW5kZXgsMSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5ncmlkSXRlbXNNb2RlbC5zcGxpY2UoaW5kZXgsMSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgIHRoaXMudG90YWxyb3cgLT0gX2RhdGFzLmxlbmd0aDsKICAgICAgICAgICAgICAgICAgICB0aGlzLiRlbWl0KCdyZW1vdmUnLCBudWxsKTsKICAgICAgICAgICAgICAgICAgICB0aGlzLnNlbGVjdGlvbnMgPSBbXTsKICAgICAgICAgICAgICAgICAgICByZXNvbHZlKHJlc3BvbnNlKTsKICAgICAgICAgICAgICAgIH0pLmNhdGNoKChyZXNwb25zZTogYW55KSA9PiB7CiAgICAgICAgICAgICAgICAgICAgaWYgKHJlc3BvbnNlICYmIHJlc3BvbnNlLnN0YXR1cyA9PT0gNDAxKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgaWYgKCFyZXNwb25zZSB8fCAhcmVzcG9uc2Uuc3RhdHVzIHx8ICFyZXNwb25zZS5kYXRhKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuJE5vdGljZS5lcnJvcih7IHRpdGxlOiAn6ZSZ6K+vJywgZGVzYzogJ+ezu+e7n+W8guW4uCcgfSk7CiAgICAgICAgICAgICAgICAgICAgICAgIHJlamVjdChyZXNwb25zZSk7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgcmVqZWN0KHJlc3BvbnNlKTsKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9KTsKICAgICAgICB9CgogICAgICAgIGRhdGFJbmZvID0gZGF0YUluZm8ucmVwbGFjZSgvW251bGxdL2csICcnKS5yZXBsYWNlKC9bdW5kZWZpbmVkXS9nLCAnJyk7CiAgICAgICAgdGhpcy4kTW9kYWwuY29uZmlybSh7CiAgICAgICAgICAgIHRpdGxlOiAn6K2m5ZGKJywKICAgICAgICAgICAgY29udGVudDogJ+ehruiupOimgeWIoOmZpCAnICsgZGF0YUluZm8gKyAn77yM5Yig6Zmk5pON5L2c5bCG5LiN5Y+v5oGi5aSN77yfJywKICAgICAgICAgICAgb25PazogKCkgPT4gewogICAgICAgICAgICAgICAgcmVtb3ZlRGF0YSgpOwogICAgICAgICAgICB9LAogICAgICAgICAgICBvbkNhbmNlbDogKCkgPT4geyB9CiAgICAgICAgfSk7CiAgICAgICAgcmV0dXJuIHJlbW92ZURhdGE7CiAgICB9CgoKICAgIC8qKgogICAgICog5om56YeP5re75YqgCiAgICAgKgogICAgICogQHBhcmFtIHsqfSBbYXJnPXt9XQogICAgICogQG1lbWJlcm9mIEhNREluZm9HcmlkQmFzZQogICAgICovCiAgICBwdWJsaWMgYWRkQmF0Y2goYXJnOiBhbnkgPSB7fSk6IHZvaWQgewogICAgICAgIGlmKCF0aGlzLmZldGNoQWN0aW9uKXsKICAgICAgICAgICAgdGhpcy4kTm90aWNlLmVycm9yKHsgdGl0bGU6ICfplJnor68nLCBkZXNjOiAnUElNUEVSU09OSE1ER3JpZFZpZXfop4blm77ooajmoLxmZXRjaEFjdGlvbuWPguaVsOacqumFjee9ricgfSk7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICB9CiAgICAgICAgaWYoIWFyZyl7CiAgICAgICAgICAgIGFyZyA9IHt9OwogICAgICAgIH0KICAgICAgICBjb25zb2xlLmVycm9yKCLmibnph4/mt7vliqDmnKrlrp7njrAiKTsKICAgIH0KCiAgICAvKioKICAgICAqIOaVsOaNruWvvOWFpQogICAgICoKICAgICAqIEBwYXJhbSB7Kn0gZGF0YQogICAgICogQG1lbWJlcm9mIEhNREluZm9HcmlkQmFzZQogICAgICovCiAgICAgcHVibGljIGltcG9ydEV4Y2VsKGRhdGE6YW55ID17fSk6dm9pZHsKICAgICAgICAvL+WvvOWFpWV4Y2VsCiAgICAgICAgY29uc3QgaW1wb3J0RGF0YU1vZGVsOmFueSA9ewogICAgICAgIH0KICAgICAgICBpZihPYmplY3Qua2V5cyhpbXBvcnREYXRhTW9kZWwpLmxlbmd0aCA9PSAwKXsKICAgICAgICAgICAgdGhpcy4kTm90aWNlLndhcm5pbmcoeyAndGl0bGUnOiAodGhpcy4kdCgiYXBwLnV0aWx2aWV3Lndhcm5pbmciKSBhcyBzdHJpbmcpLCAnZGVzYyc6ICh0aGlzLiR0KCJhcHAudXRpbHZpZXcuaW5mbyIpIGFzIHN0cmluZykgfSk7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICB9CiAgICAgICAgY29uc3QgdmlldzphbnkgPXsKICAgICAgICAgICAgdmlld25hbWU6ICdhcHAtZGF0YS11cGxvYWQnLAogICAgICAgICAgICB0aXRsZTogdGhpcy4kdCgiYXBwLnV0aWx2aWV3LmltcG9ydHZpZXciKSwKICAgICAgICAgICAgd2lkdGg6IDkwMCwKICAgICAgICAgICAgaGVpZ2h0OiA3MDAKICAgICAgICB9CiAgICAgICAgbGV0IGNvbnRhaW5lcjogU3ViamVjdDxhbnk+ID0gdGhpcy4kYXBwbW9kYWwub3Blbk1vZGFsKHZpZXcsIEpTT04ucGFyc2UoSlNPTi5zdHJpbmdpZnkodGhpcy5jb250ZXh0KSksIGltcG9ydERhdGFNb2RlbCk7CiAgICAgICAgY29udGFpbmVyLnN1YnNjcmliZSgocmVzdWx0OiBhbnkpID0+IHsKICAgICAgICAgIGlmKE9iamVjdC5pcyhyZXN1bHQucmV0LCdPSycpKXsKICAgICAgICAgICAgdGhpcy5yZWZyZXNoKHJlc3VsdC5kYXRhcyk7CiAgICAgICAgICB9CiAgICAgIH0pOwogICAgfQoKCiAgICAvKioKICAgICAqIOaVsOaNruWvvOWHugogICAgICoKICAgICAqIEBwYXJhbSB7Kn0gZGF0YQogICAgICogQG1lbWJlcm9mIEhNREluZm9HcmlkQmFzZQogICAgICovCiAgICBwdWJsaWMgZXhwb3J0RXhjZWwoZGF0YTogYW55ID0ge30pOiB2b2lkIHsKICAgICAgICAvLyDlr7zlh7pFeGNlbAogICAgICAgIGNvbnN0IGRvRXhwb3J0ID0gYXN5bmMgKF9kYXRhOmFueSkgPT4gewogICAgICAgICAgICBjb25zdCB0SGVhZGVyOiBBcnJheTxhbnk+ID0gW107CiAgICAgICAgICAgIGNvbnN0IGZpbHRlclZhbDogQXJyYXk8YW55PiA9IFtdOwogICAgICAgICAgICB0aGlzLmFsbENvbHVtbnMuZm9yRWFjaCgoaXRlbTogYW55KSA9PiB7CiAgICAgICAgICAgICAgaXRlbS5zaG93ICYmIGl0ZW0ubGFiZWwgPyB0SGVhZGVyLnB1c2godGhpcy4kdChpdGVtLmxhbmd0YWcpKSA6ICIiOwogICAgICAgICAgICAgIGl0ZW0uc2hvdyAmJiBpdGVtLm5hbWUgPyBmaWx0ZXJWYWwucHVzaChpdGVtLm5hbWUpIDogIiI7CiAgICAgICAgICAgIH0pOwogICAgICAgICAgICBjb25zdCBkYXRhID0gYXdhaXQgdGhpcy5mb3JtYXRFeGNlbERhdGEoZmlsdGVyVmFsLCBfZGF0YSk7CiAgICAgICAgICAgIHRoaXMuJGV4cG9ydC5leHBvcnRFeGNlbCgpLnRoZW4oKGV4Y2VsOmFueSk9PnsKICAgICAgICAgICAgICAgIGV4Y2VsLmV4cG9ydF9qc29uX3RvX2V4Y2VsKHsKICAgICAgICAgICAgICAgICAgaGVhZGVyOiB0SGVhZGVyLCAvL+ihqOWktCDlv4XloasKICAgICAgICAgICAgICAgICAgZGF0YSwgLy/lhbfkvZPmlbDmja4g5b+F5aGrCiAgICAgICAgICAgICAgICAgIGZpbGVuYW1lOiAi5Lq65ZGY5L+h5oGv6KGoIiwgLy/pnZ7lv4XloasKICAgICAgICAgICAgICAgICAgYXV0b1dpZHRoOiB0cnVlLCAvL+mdnuW/heWhqwogICAgICAgICAgICAgICAgICBib29rVHlwZTogInhsc3giIC8v6Z2e5b+F5aGrCiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfSk7IAogICAgICAgIH07CiAgICAgICAgY29uc3QgcGFnZTogYW55ID0ge307CiAgICAgICAgLy8g6K6+572ucGFnZe+8jHNpemUKICAgICAgICBpZiAoT2JqZWN0LmlzKGRhdGEudHlwZSwgJ21heFJvd0NvdW50JykpIHsKICAgICAgICAgICAgT2JqZWN0LmFzc2lnbihwYWdlLCB7IHBhZ2U6IDAsIHNpemU6IGRhdGEubWF4Um93Q291bnQgfSk7CiAgICAgICAgfSBlbHNlIGlmIChPYmplY3QuaXMoZGF0YS50eXBlLCAnYWN0aXZhdGVkUGFnZScpKSB7CiAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICBkb0V4cG9ydChKU09OLnBhcnNlKEpTT04uc3RyaW5naWZ5KHRoaXMuaXRlbXMpKSk7CiAgICAgICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7CiAgICAgICAgICAgICAgICBjb25zb2xlLmVycm9yKGVycm9yKTsKICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm47CiAgICAgICAgfQogICAgICAgIC8vIOiuvue9ruaOkuW6jwogICAgICAgIGlmICghdGhpcy5pc05vU29ydCAmJiAhT2JqZWN0LmlzKHRoaXMubWlub3JTb3J0RGlyLCAnJykgJiYgIU9iamVjdC5pcyh0aGlzLm1pbm9yU29ydFBTREVGLCAnJykpIHsKICAgICAgICAgIGNvbnN0IHNvcnQ6IHN0cmluZyA9IHRoaXMubWlub3JTb3J0UFNERUYrIiwiK3RoaXMubWlub3JTb3J0RGlyOwogICAgICAgICAgICBPYmplY3QuYXNzaWduKHBhZ2UsIHsgc29ydDogc29ydCB9KTsKICAgICAgICB9CiAgICAgICAgY29uc3QgYXJnOiBhbnkgPSB7fTsKICAgICAgICBPYmplY3QuYXNzaWduKGFyZywgcGFnZSk7CiAgICAgICAgLy8g6I635Y+WcXVlcnks5pCc57Si6KGo5Y2V77yMdmlld3BhcmFtc+etieeItuaVsOaNrgogICAgICAgIGNvbnN0IHBhcmVudGRhdGE6IGFueSA9IHt9OwogICAgICAgIHRoaXMuJGVtaXQoJ2JlZm9yZWxvYWQnLCBwYXJlbnRkYXRhKTsKICAgICAgICBPYmplY3QuYXNzaWduKGFyZywgcGFyZW50ZGF0YSk7CiAgICAgICAgY29uc3QgcG9zdDogUHJvbWlzZTxhbnk+ID0gdGhpcy5zZXJ2aWNlLnNlYXJjaCh0aGlzLmZldGNoQWN0aW9uLEpTT04ucGFyc2UoSlNPTi5zdHJpbmdpZnkodGhpcy5jb250ZXh0KSksIGFyZywgdGhpcy5zaG93QnVzeUluZGljYXRvcik7CiAgICAgICAgcG9zdC50aGVuKChyZXNwb25zZTogYW55KSA9PiB7CiAgICAgICAgICAgIGlmICghcmVzcG9uc2UgfHwgcmVzcG9uc2Uuc3RhdHVzICE9PSAyMDApIHsKICAgICAgICAgICAgICAgIHRoaXMuJE5vdGljZS5lcnJvcih7IHRpdGxlOiAnJywgZGVzYzogJ+aVsOaNruWvvOWHuuWksei0pSwnICsgcmVzcG9uc2UuaW5mbyB9KTsKICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgfQogICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgZG9FeHBvcnQoSlNPTi5wYXJzZShKU09OLnN0cmluZ2lmeShyZXNwb25zZS5kYXRhKSkpOwogICAgICAgICAgICB9IGNhdGNoIChlcnJvcikgewogICAgICAgICAgICAgICAgY29uc29sZS5lcnJvcihlcnJvcik7CiAgICAgICAgICAgIH0KICAgICAgICB9KS5jYXRjaCgocmVzcG9uc2U6IGFueSkgPT4gewogICAgICAgICAgICBpZiAocmVzcG9uc2UgJiYgcmVzcG9uc2Uuc3RhdHVzID09PSA0MDEpIHsKICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgfQogICAgICAgICAgICB0aGlzLiROb3RpY2UuZXJyb3IoeyB0aXRsZTogJycsIGRlc2M6ICfmlbDmja7lr7zlh7rlpLHotKUnIH0pOwogICAgICAgIH0pOwogICAgfQoKCiAgICAvKioKICAgICAqIOWvvOWHuuaVsOaNruagvOW8j+WMlgogICAgICogCiAgICAgKiBAcGFyYW0geyp9IGZpbHRlclZhbAogICAgICogQHBhcmFtIHsqfSBqc29uRGF0YQogICAgICogQHJldHVybnMge1tdfQogICAgICogQG1lbWJlcm9mIEhNREluZm9HcmlkQmFzZQogICAgICovCiAgICBwdWJsaWMgYXN5bmMgZm9ybWF0RXhjZWxEYXRhKGZpbHRlclZhbDphbnksIGpzb25EYXRhOmFueSkgewogICAgICAgIGxldCBjb2RlbGlzdENvbHVtbnM6QXJyYXk8YW55PiA9IFsKICAgICAgICAgIHsKICAgICAgICAgICAgbmFtZTogJ3lnenQnLAogICAgICAgICAgICBzcmZrZXk6ICdFaHJDb2RlTGlzdDAwMTQnLAogICAgICAgICAgICBjb2RlbGlzdFR5cGUgOiAnRFlOQU1JQycsCiAgICAgICAgICAgIHJlbmRlck1vZGU6ICdvdGhlcicsCiAgICAgICAgICAgIHRleHRTZXBhcmF0b3I6ICfjgIEnLAogICAgICAgICAgICB2YWx1ZVNlcGFyYXRvcjogJywnLAogICAgICAgICAgfSwKICAgICAgICAgIHsKICAgICAgICAgICAgbmFtZTogJ2htZCcsCiAgICAgICAgICAgIHNyZmtleTogJ0VockNvZGVMaXN0MDQwMScsCiAgICAgICAgICAgIGNvZGVsaXN0VHlwZSA6ICdTVEFUSUMnLAogICAgICAgICAgICB0ZXh0U2VwYXJhdG9yOiAn44CBJywKICAgICAgICAgICAgcmVuZGVyTW9kZTogJ3N0cmluZycsCiAgICAgICAgICAgIHZhbHVlU2VwYXJhdG9yOiAiOyIsCiAgICAgICAgICB9LAogICAgICAgIF07CiAgICAgICAgbGV0IF90aGlzID0gdGhpczsKICAgICAgICBmb3IgKGNvbnN0IGNvZGVsaXN0IG9mIGNvZGVsaXN0Q29sdW1ucykgewogICAgICAgICAgLy8g5Yqo5oCB5Luj56CB6KGo5aSE55CGCiAgICAgICAgICBpZiAoT2JqZWN0LmlzKGNvZGVsaXN0LmNvZGVsaXN0VHlwZSwgIkRZTkFNSUMiKSkgewogICAgICAgICAgICAgIGxldCBpdGVtcyA9IGF3YWl0IF90aGlzLmNvZGVMaXN0U2VydmljZS5nZXRJdGVtcyhjb2RlbGlzdC5zcmZrZXkpOwogICAgICAgICAgICAgIGpzb25EYXRhLmZvckVhY2goKHJvdzphbnkpPT57CiAgICAgICAgICAgICAgICAgIHJvd1tjb2RlbGlzdC5uYW1lXSA9IF90aGlzLmdldENvZGVsaXN0VmFsdWUoaXRlbXMsIHJvd1tjb2RlbGlzdC5uYW1lXSwgY29kZWxpc3QpOwogICAgICAgICAgICAgIH0pOwogICAgICAgICAgLy8g6Z2Z5oCB5aSE55CGCiAgICAgICAgICB9IGVsc2UgaWYoT2JqZWN0LmlzKGNvZGVsaXN0LmNvZGVsaXN0VHlwZSwgIlNUQVRJQyIpKXsKICAgICAgICAgICAgICBsZXQgaXRlbXMgPSBhd2FpdCBfdGhpcy4kc3RvcmUuZ2V0dGVycy5nZXRDb2RlTGlzdEl0ZW1zKGNvZGVsaXN0LnNyZmtleSk7CiAgICAgICAgICAgICAganNvbkRhdGEuZm9yRWFjaCgocm93OmFueSk9PnsKICAgICAgICAgICAgICAgICAgcm93W2NvZGVsaXN0Lm5hbWVdID0gX3RoaXMuZ2V0Q29kZWxpc3RWYWx1ZShpdGVtcywgcm93W2NvZGVsaXN0Lm5hbWVdLCBjb2RlbGlzdCk7CiAgICAgICAgICAgICAgfSk7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIHJldHVybiBqc29uRGF0YS5tYXAoKHY6YW55KSA9PiBmaWx0ZXJWYWwubWFwKChqOmFueSkgPT4gdltqXSkpCiAgICB9ICAgCgoKICAgIC8qKgogICAgICog6Kej5p6Q5Luj56CB6KGo5ZKMdmxhdWXvvIzorr7nva5pdGVtcwogICAgICoKICAgICAqIEBwdWJsaWMKICAgICAqIEBwYXJhbSB7YW55W119IGl0ZW1zIOS7o+eggeihqOaVsOaNrgogICAgICogQHBhcmFtIHsqfSB2YWx1ZQogICAgICogQHJldHVybnMgeyp9CiAgICAgKiBAbWVtYmVyb2YgSE1ESW5mb0dyaWRCYXNlCiAgICAgKi8KICAgIHB1YmxpYyBnZXRDb2RlbGlzdFZhbHVlKGl0ZW1zOiBhbnlbXSwgdmFsdWU6IGFueSwgY29kZWxpc3Q6IGFueSwpewogICAgICAgIGlmKCF2YWx1ZSl7CiAgICAgICAgICAgIHJldHVybiB0aGlzLiR0KCdjb2RlbGlzdC4nK2NvZGVsaXN0LnNyZmtleSsnLmVtcHR5Jyk7CiAgICAgICAgfQogICAgICAgIGlmIChpdGVtcykgewogICAgICAgICAgICBsZXQgcmVzdWx0OmFueSA9IFtdOwogICAgICAgICAgICBpZihPYmplY3QuaXMoY29kZWxpc3QucmVuZGVyTW9kZSwibnVtYmVyIikpewogICAgICAgICAgICAgICAgaXRlbXMubWFwKChfaXRlbTogYW55LCBpbmRleDogbnVtYmVyKT0+ewogICAgICAgICAgICAgICAgICAgIGNvbnN0IG5WYWx1ZSA9IHBhcnNlSW50KCh2YWx1ZSBhcyBhbnkpLCAxMCk7CiAgICAgICAgICAgICAgICAgICAgY29uc3QgY29kZXZhbHVlID0gX2l0ZW0udmFsdWU7CiAgICAgICAgICAgICAgICAgICAgaWYoKHBhcnNlSW50KGNvZGV2YWx1ZSwgMTApICYgblZhbHVlKSA+IDApewogICAgICAgICAgICAgICAgICAgICAgICByZXN1bHQucHVzaChfaXRlbSk7CiAgICAgICAgICAgICAgICAgICAgfSAKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9IGVsc2UgaWYoT2JqZWN0LmlzKGNvZGVsaXN0LnJlbmRlck1vZGUsInN0cmluZyIpKXsKICAgICAgICAgICAgICAgIGNvbnN0IGFycmF5VmFsdWU6IEFycmF5PGFueT4gPSAodmFsdWUgYXMgYW55KS5zcGxpdChjb2RlbGlzdC52YWx1ZVNlcGFyYXRvcik7CiAgICAgICAgICAgICAgICBhcnJheVZhbHVlLm1hcCgodmFsdWU6IGFueSwgaW5kZXg6IG51bWJlcikgPT4gewogICAgICAgICAgICAgICAgICAgIHJlc3VsdC5wdXNoKFtdKTsKICAgICAgICAgICAgICAgICAgICBsZXQgdmFsdWVzOiBhbnlbXSA9IE9iamVjdC5pcyh0aGlzLiR1dGlsLnR5cGVPZih2YWx1ZSksICdudW1iZXInKSA/IFt2YWx1ZV0gOiBbLi4uKHZhbHVlIGFzIGFueSkuc3BsaXQoY29kZWxpc3QudmFsdWVTZXBhcmF0b3IpXTsKICAgICAgICAgICAgICAgICAgICB2YWx1ZXMubWFwKCh2YWw6YW55ICxudW06IG51bWJlcik9PnsKICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgaXRlbSA9IHRoaXMuZ2V0SXRlbShpdGVtcywgdmFsLCBjb2RlbGlzdCk7IAogICAgICAgICAgICAgICAgICAgICAgICBpZihpdGVtKXsKICAgICAgICAgICAgICAgICAgICAgICAgICByZXN1bHRbaW5kZXhdLnB1c2goaXRlbSk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0gCiAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIGxldCB2YWx1ZXM6IGFueVtdID0gT2JqZWN0LmlzKHRoaXMuJHV0aWwudHlwZU9mKHZhbHVlKSwgJ251bWJlcicpID8gW3ZhbHVlXSA6IFsuLi4odmFsdWUgYXMgYW55KS5zcGxpdChjb2RlbGlzdC52YWx1ZVNlcGFyYXRvcildOwogICAgICAgICAgICAgICAgdmFsdWVzLm1hcCgodmFsdWU6YW55ICxpbmRleDogbnVtYmVyKT0+ewogICAgICAgICAgICAgICAgICAgIGNvbnN0IGl0ZW0gPSB0aGlzLmdldEl0ZW0oaXRlbXMsIHZhbHVlLCBjb2RlbGlzdCk7IAogICAgICAgICAgICAgICAgICAgIGlmKGl0ZW0pewogICAgICAgICAgICAgICAgICAgICAgcmVzdWx0LnB1c2goaXRlbSk7CiAgICAgICAgICAgICAgICAgICAgfSAKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9CiAgICAgICAgICAgIC8vIOiuvue9rml0ZW1zCiAgICAgICAgICAgIGlmKHJlc3VsdC5sZW5ndGggIT0gMCl7CiAgICAgICAgICAgICAgcmV0dXJuIHJlc3VsdC5qb2luKGNvZGVsaXN0LnZhbHVlU2VwYXJhdG9yKTsKICAgICAgICAgICAgfWVsc2V7CiAgICAgICAgICAgICAgcmV0dXJuIHZhbHVlOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICog6I635Y+W5Luj56CB6aG5CiAgICAgKgogICAgICogQHB1YmxpYwogICAgICogQHBhcmFtIHthbnlbXX0gaXRlbXMKICAgICAqIEBwYXJhbSB7Kn0gdmFsdWUKICAgICAqIEByZXR1cm5zIHsqfQogICAgICogQG1lbWJlcm9mIEhNREluZm9HcmlkQmFzZQogICAgICovCiAgICBwdWJsaWMgZ2V0SXRlbShpdGVtczogYW55W10sIHZhbHVlOiBhbnksIGNvZGVsaXN0OiBhbnkpOiBhbnkgewogICAgICAgIGNvbnN0IGFycjogQXJyYXk8YW55PiA9IGl0ZW1zLmZpbHRlcihpdGVtID0+IHtyZXR1cm4gaXRlbS52YWx1ZSA9PSB2YWx1ZX0pOwogICAgICAgIGlmIChhcnIubGVuZ3RoICE9PSAxKSB7CiAgICAgICAgICAgIHJldHVybiB1bmRlZmluZWQ7CiAgICAgICAgfQogICAgICAgIGlmKE9iamVjdC5pcyhjb2RlbGlzdC5jb2RlbGlzdFR5cGUsJ1NUQVRJQycpKXsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuJHQoJ2NvZGVsaXN0LicrY29kZWxpc3Quc3Jma2V5KycuJythcnJbMF0udmFsdWUpOwogICAgICAgIH1lbHNlewogICAgICAgICAgICByZXR1cm4gYXJyWzBdLnRleHQ7CiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICog55Sf5ZG95ZGo5pyfCiAgICAgKgogICAgICogQG1lbWJlcm9mIEhNREluZm9HcmlkQmFzZQogICAgICovCiAgICBwdWJsaWMgY3JlYXRlZCgpOiB2b2lkIHsKICAgICAgICB0aGlzLmFmdGVyQ3JlYXRlZCgpOwogICAgfQoKICAgIC8qKgogICAgICog5omn6KGMY3JlYXRlZOWQjueahOmAu+i+kQogICAgICoKICAgICAqICBAbWVtYmVyb2YgSE1ESW5mb0dyaWRCYXNlCiAgICAgKi8gICAgCiAgICBwdWJsaWMgYWZ0ZXJDcmVhdGVkKCl7CiAgICAgICAgdGhpcy5zZXRDb2xTdGF0ZSgpOwogICAgICAgIGlmICh0aGlzLnZpZXdTdGF0ZSkgewogICAgICAgICAgICB0aGlzLnZpZXdTdGF0ZUV2ZW50ID0gdGhpcy52aWV3U3RhdGUuc3Vic2NyaWJlKCh7IHRhZywgYWN0aW9uLCBkYXRhIH0pID0+IHsKICAgICAgICAgICAgICAgIGlmICghT2JqZWN0LmlzKHRhZywgdGhpcy5uYW1lKSkgewogICAgICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGlmIChPYmplY3QuaXMoJ2xvYWQnLCBhY3Rpb24pKSB7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5sb2FkKGRhdGEpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgaWYgKE9iamVjdC5pcygncmVtb3ZlJywgYWN0aW9uKSkgewogICAgICAgICAgICAgICAgICAgIHRoaXMucmVtb3ZlKGRhdGEpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgaWYgKE9iamVjdC5pcygnc2F2ZScsIGFjdGlvbikpIHsKICAgICAgICAgICAgICAgICAgICB0aGlzLnNhdmUoZGF0YSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0pOwogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIHZ1ZSDnlJ/lkb3lkajmnJ8KICAgICAqCiAgICAgKiBAbWVtYmVyb2YgSE1ESW5mb0dyaWRCYXNlCiAgICAgKi8KICAgIHB1YmxpYyBkZXN0cm95ZWQoKSB7CiAgICAgICAgdGhpcy5hZnRlckRlc3Ryb3koKTsKICAgIH0KCiAgICAvKioKICAgICAqIOaJp+ihjGRlc3Ryb3llZOWQjueahOmAu+i+kQogICAgICoKICAgICAqIEBtZW1iZXJvZiBITURJbmZvR3JpZEJhc2UKICAgICAqLwogICAgcHVibGljIGFmdGVyRGVzdHJveSgpIHsKICAgICAgICBpZiAodGhpcy52aWV3U3RhdGVFdmVudCkgewogICAgICAgICAgICB0aGlzLnZpZXdTdGF0ZUV2ZW50LnVuc3Vic2NyaWJlKCk7CiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICog6I635Y+W6YCJ5Lit6KGM6IOh5pWw5o2uCiAgICAgKgogICAgICogQHJldHVybnMge2FueVtdfQogICAgICogQG1lbWJlcm9mIEhNREluZm9HcmlkQmFzZQogICAgICovCiAgICBwdWJsaWMgZ2V0U2VsZWN0aW9uKCk6IGFueVtdIHsKICAgICAgICByZXR1cm4gdGhpcy5zZWxlY3Rpb25zOwogICAgfQoKICAgIC8qKgogICAgICog6KGM5Y+M5Ye75LqL5Lu2CiAgICAgKgogICAgICogQHBhcmFtIHsqfSAkZXZlbnQKICAgICAqIEByZXR1cm5zIHt2b2lkfQogICAgICogQG1lbWJlcm9mIEhNREluZm9HcmlkQmFzZQogICAgICovCiAgICBwdWJsaWMgcm93REJMQ2xpY2soJGV2ZW50OiBhbnkpOiB2b2lkIHsKICAgICAgICBpZiAoISRldmVudCB8fCB0aGlzLmFjdHVhbElzT3BlbkVkaXQgfHwgT2JqZWN0LmlzKHRoaXMuZ3JpZFJvd0FjdGl2ZU1vZGUsMCkpIHsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KICAgICAgICB0aGlzLnNlbGVjdGlvbnMgPSBbXTsKICAgICAgICB0aGlzLnNlbGVjdGlvbnMucHVzaChKU09OLnBhcnNlKEpTT04uc3RyaW5naWZ5KCRldmVudCkpKTsKCiAgICAgICAgY29uc3QgcmVmczogYW55ID0gdGhpcy4kcmVmczsKICAgICAgICBpZiAocmVmcy5tdWx0aXBsZVRhYmxlKSB7CiAgICAgICAgICAgIHJlZnMubXVsdGlwbGVUYWJsZS5jbGVhclNlbGVjdGlvbigpOwogICAgICAgICAgICByZWZzLm11bHRpcGxlVGFibGUudG9nZ2xlUm93U2VsZWN0aW9uKCRldmVudCk7CiAgICAgICAgfQoKICAgICAgICB0aGlzLiRlbWl0KCdyb3dkYmxjbGljaycsIHRoaXMuc2VsZWN0aW9ucyk7CiAgICAgICAgdGhpcy4kZW1pdCgnc2VsZWN0aW9uY2hhbmdlJywgdGhpcy5zZWxlY3Rpb25zKTsKICAgIH0KCiAgICAvKioKICAgICAqIOWkjemAieahhuaVsOaNrumAieS4rQogICAgICoKICAgICAqIEBwYXJhbSB7Kn0gJGV2ZW50CiAgICAgKiBAcmV0dXJucyB7dm9pZH0KICAgICAqIEBtZW1iZXJvZiBITURJbmZvR3JpZEJhc2UKICAgICAqLwogICAgcHVibGljIHNlbGVjdCgkZXZlbnQ6IGFueSk6IHZvaWQgewogICAgICAgIGlmICghJGV2ZW50KSB7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICB9CiAgICAgICAgdGhpcy5zZWxlY3Rpb25zID0gW107CiAgICAgICAgdGhpcy5zZWxlY3Rpb25zID0gWy4uLkpTT04ucGFyc2UoSlNPTi5zdHJpbmdpZnkoJGV2ZW50KSldOwogICAgICAgIHRoaXMuJGVtaXQoJ3NlbGVjdGlvbmNoYW5nZScsIHRoaXMuc2VsZWN0aW9ucyk7CiAgICB9CgogICAgLyoqCiAgICAgKiDlpI3pgInmoYbmlbDmja7lhajpg6jpgInkuK0KICAgICAqCiAgICAgKiBAcGFyYW0geyp9ICRldmVudAogICAgICogQG1lbWJlcm9mIEhNREluZm9HcmlkQmFzZQogICAgICovCiAgICBwdWJsaWMgc2VsZWN0QWxsKCRldmVudDogYW55KTogdm9pZCB7CiAgICAgICAgaWYgKCEkZXZlbnQpIHsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KICAgICAgICB0aGlzLnNlbGVjdGlvbnMgPSBbXTsKICAgICAgICB0aGlzLnNlbGVjdGlvbnMgPSBbLi4uSlNPTi5wYXJzZShKU09OLnN0cmluZ2lmeSgkZXZlbnQpKV07CiAgICAgICAgdGhpcy4kZW1pdCgnc2VsZWN0aW9uY2hhbmdlJywgdGhpcy5zZWxlY3Rpb25zKTsKICAgIH0KCiAgICAKICAgIC8qKgogICAgICog6KGM5Y2V5Ye76YCJ5LitCiAgICAgKgogICAgICogQHBhcmFtIHsqfSAkZXZlbnQKICAgICAqIEByZXR1cm5zIHt2b2lkfQogICAgICogQG1lbWJlcm9mIEhNREluZm9HcmlkQmFzZQogICAgICovCiAgICBwdWJsaWMgcm93Q2xpY2soJGV2ZW50OiBhbnksIGlmQWx3YXlzOiBib29sZWFuID0gZmFsc2UpOiB2b2lkIHsKICAgICAgICBpZiAoIWlmQWx3YXlzICYmICghJGV2ZW50IHx8IHRoaXMuYWN0dWFsSXNPcGVuRWRpdCkpIHsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KICAgICAgICBpZih0aGlzLnN0b3BSb3dDbGljaykgewogICAgICAgICAgICB0aGlzLnN0b3BSb3dDbGljayA9IGZhbHNlOwogICAgICAgICAgICByZXR1cm47CiAgICAgICAgfQogICAgICAgIGlmKHRoaXMuaXNTaW5nbGVTZWxlY3QpewogICAgICAgICAgICB0aGlzLnNlbGVjdGlvbnMgPSBbXTsKICAgICAgICB9CiAgICAgICAgLy8g5bey6YCJ5Lit5YiZ5Yig6Zmk77yM5rKh6YCJ5Lit5YiZ5re75YqgCiAgICAgICAgbGV0IHNlbGVjdEluZGV4ID0gdGhpcy5zZWxlY3Rpb25zLmZpbmRJbmRleCgoaXRlbTphbnkpPT57CiAgICAgICAgICAgIHJldHVybiBPYmplY3QuaXMoaXRlbS5waW1wZXJzb24sJGV2ZW50LnBpbXBlcnNvbik7CiAgICAgICAgfSk7CiAgICAgICAgaWYgKE9iamVjdC5pcyhzZWxlY3RJbmRleCwtMSkpewogICAgICAgICAgdGhpcy5zZWxlY3Rpb25zLnB1c2goSlNPTi5wYXJzZShKU09OLnN0cmluZ2lmeSgkZXZlbnQpKSk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIHRoaXMuc2VsZWN0aW9ucy5zcGxpY2Uoc2VsZWN0SW5kZXgsMSk7CiAgICAgICAgfQoKICAgICAgICBjb25zdCByZWZzOiBhbnkgPSB0aGlzLiRyZWZzOwogICAgICAgIGlmIChyZWZzLm11bHRpcGxlVGFibGUpIHsKICAgICAgICAgICAgaWYodGhpcy5pc1NpbmdsZVNlbGVjdCl7CiAgICAgICAgICAgICAgICByZWZzLm11bHRpcGxlVGFibGUuY2xlYXJTZWxlY3Rpb24oKTsKICAgICAgICAgICAgICAgIHJlZnMubXVsdGlwbGVUYWJsZS5zZXRDdXJyZW50Um93KCRldmVudCk7CiAgICAgICAgICAgIH1lbHNlewogICAgICAgICAgICAgICAgcmVmcy5tdWx0aXBsZVRhYmxlLnRvZ2dsZVJvd1NlbGVjdGlvbigkZXZlbnQpOyAKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgdGhpcy4kZW1pdCgnc2VsZWN0aW9uY2hhbmdlJywgdGhpcy5zZWxlY3Rpb25zKTsKICAgIH0KCgogICAgLyoqCiAgICAgKiDpobXpnaLlj5jljJYKICAgICAqCiAgICAgKiBAcGFyYW0geyp9ICRldmVudAogICAgICogQHJldHVybnMge3ZvaWR9CiAgICAgKiBAbWVtYmVyb2YgSE1ESW5mb0dyaWRCYXNlCiAgICAgKi8KICAgIHB1YmxpYyBwYWdlT25DaGFuZ2UoJGV2ZW50OiBhbnkpOiB2b2lkIHsKICAgICAgICBpZiAoISRldmVudCkgewogICAgICAgICAgICByZXR1cm47CiAgICAgICAgfQogICAgICAgIGlmICgkZXZlbnQgPT09IHRoaXMuY3VyUGFnZSkgewogICAgICAgICAgICByZXR1cm47CiAgICAgICAgfQogICAgICAgIHRoaXMuY3VyUGFnZSA9ICRldmVudDsKICAgICAgICB0aGlzLmxvYWQoe30pOwogICAgfQoKICAgIC8qKgogICAgICog5YiG6aG15p2h5pWw5Y+Y5YyWCiAgICAgKgogICAgICogQHBhcmFtIHsqfSAkZXZlbnQKICAgICAqIEByZXR1cm5zIHt2b2lkfQogICAgICogQG1lbWJlcm9mIEhNREluZm9HcmlkQmFzZQogICAgICovCiAgICBwdWJsaWMgb25QYWdlU2l6ZUNoYW5nZSgkZXZlbnQ6IGFueSk6IHZvaWQgewogICAgICAgIGlmICghJGV2ZW50KSB7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICB9CiAgICAgICAgaWYgKCRldmVudCA9PT0gdGhpcy5saW1pdCkgewogICAgICAgICAgICByZXR1cm47CiAgICAgICAgfQogICAgICAgIHRoaXMubGltaXQgPSAkZXZlbnQ7CiAgICAgICAgaWYgKHRoaXMuY3VyUGFnZSA9PT0gMSkgewogICAgICAgICAgICB0aGlzLmxvYWQoe30pOwogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIOWIhumhteWIt+aWsAogICAgICoKICAgICAqIEBtZW1iZXJvZiBITURJbmZvR3JpZEJhc2UKICAgICAqLwogICAgcHVibGljIHBhZ2VSZWZyZXNoKCk6IHZvaWQgewogICAgICAgIHRoaXMubG9hZCh7fSk7CiAgICB9CgogICAgLyoqCiAgICAgKiDmjpLluo/lj5jljJYKICAgICAqCiAgICAgKiBAcGFyYW0ge3sgY29sdW1uOiBhbnksIHByb3A6IGFueSwgb3JkZXI6IGFueSB9fSB7IGNvbHVtbiwgcHJvcCwgb3JkZXIgfQogICAgICogQG1lbWJlcm9mIEhNREluZm9HcmlkQmFzZQogICAgICovCiAgICBwdWJsaWMgb25Tb3J0Q2hhbmdlKHsgY29sdW1uLCBwcm9wLCBvcmRlciB9OiB7IGNvbHVtbjogYW55LCBwcm9wOiBhbnksIG9yZGVyOiBhbnkgfSk6IHZvaWQgewogICAgICAgIGNvbnN0IGRpciA9IE9iamVjdC5pcyhvcmRlciwgJ2FzY2VuZGluZycpID8gJ2FzYycgOiBPYmplY3QuaXMob3JkZXIsICdkZXNjZW5kaW5nJykgPyAnZGVzYycgOiAnJzsKICAgICAgICBpZiAoT2JqZWN0LmlzKGRpciwgdGhpcy5taW5vclNvcnREaXIpICYmIE9iamVjdC5pcyh0aGlzLm1pbm9yU29ydFBTREVGLCBwcm9wKSkgewogICAgICAgICAgICByZXR1cm47CiAgICAgICAgfQogICAgICAgIHRoaXMubWlub3JTb3J0RGlyID0gZGlyOwogICAgICAgIHRoaXMubWlub3JTb3J0UFNERUYgPSBwcm9wID8gcHJvcCA6ICcnOwogICAgICAgIHRoaXMubG9hZCh7fSk7CiAgICB9CgogICAgLyoqCiAgICAgKiDooajmoLzooYzpgInkuK3moLflvI8KICAgICAqCiAgICAgKiBAcGFyYW0ge3sgcm93OiBhbnksIHJvd0luZGV4OiBhbnkgfX0geyByb3csIHJvd0luZGV4IH0KICAgICAqIEByZXR1cm5zIHtzdHJpbmd9CiAgICAgKiBAbWVtYmVyb2YgSE1ESW5mb0dyaWRCYXNlCiAgICAgKi8KICAgIHB1YmxpYyBvblJvd0NsYXNzTmFtZSh7IHJvdywgcm93SW5kZXggfTogeyByb3c6IGFueSwgcm93SW5kZXg6IGFueSB9KTogc3RyaW5nIHsKICAgICAgICBjb25zdCBpbmRleCA9IHRoaXMuc2VsZWN0aW9ucy5maW5kSW5kZXgoKHNlbGVjdDogYW55KSA9PiBPYmplY3QuaXMoc2VsZWN0LnNyZmtleSwgcm93LnNyZmtleSkpOwogICAgICAgIHJldHVybiBpbmRleCAhPT0gLTEgPyAnZ3JpZC1yb3ctc2VsZWN0JyA6ICcnOwogICAgfQoKCgogICAgLyoqCiAgICAgKiDnlYzpnaLooYzkuLoKICAgICAqCiAgICAgKiBAcGFyYW0geyp9IHJvdwogICAgICogQHBhcmFtIHsqfSB0YWcKICAgICAqIEBwYXJhbSB7Kn0gJGV2ZW50CiAgICAgKiBAbWVtYmVyb2YgSE1ESW5mb0dyaWRCYXNlCiAgICAgKi8KCXB1YmxpYyB1aUFjdGlvbihyb3c6IGFueSwgdGFnOiBhbnksICRldmVudDogYW55KSB7CiAgICAgICAgLy8gdGhpcy5yb3dDbGljayhyb3csIHRydWUpOwogICAgICAgICRldmVudC5zdG9wUHJvcGFnYXRpb24oKTsKICAgIH0KCiAgICAvKioKICAgICAqIOiuvue9ruWIl+eKtuaAgQogICAgICoKICAgICAqIEBtZW1iZXJvZiBITURJbmZvR3JpZEJhc2UKICAgICAqLwogICAgcHVibGljIHNldENvbFN0YXRlKCkgewoJCWNvbnN0IF9kYXRhOiBhbnkgPSBsb2NhbFN0b3JhZ2UuZ2V0SXRlbSgncGltcGVyc29uX2htZGluZm9ncmlkX2dyaWQnKTsKCQlpZiAoX2RhdGEpIHsKCQkJbGV0IGNvbHVtbnMgPSBKU09OLnBhcnNlKF9kYXRhKTsKCQkJY29sdW1ucy5mb3JFYWNoKChjb2w6IGFueSkgPT4gewoJCQkJbGV0IGNvbHVtbiA9IHRoaXMuYWxsQ29sdW1ucy5maW5kKChpdGVtKSA9PiBPYmplY3QuaXMoY29sLm5hbWUsIGl0ZW0ubmFtZSkpOwoJCQkJaWYgKGNvbHVtbikgewoJCQkJCU9iamVjdC5hc3NpZ24oY29sdW1uLCBjb2wpOwoJCQkJfQoJCQl9KTsKCQl9CiAgICB9CgogICAgLyoqCiAgICAgKiDliJflj5jljJYKICAgICAqCiAgICAgKiBAbWVtYmVyb2YgSE1ESW5mb0dyaWRCYXNlCiAgICAgKi8KICAgIHB1YmxpYyBvbkNvbENoYW5nZSgpIHsKICAgICAgICBsb2NhbFN0b3JhZ2Uuc2V0SXRlbSgncGltcGVyc29uX2htZGluZm9ncmlkX2dyaWQnLCBKU09OLnN0cmluZ2lmeSh0aGlzLmFsbENvbHVtbnMpKTsKICAgIH0KCiAgICAvKioKICAgICAqIOiOt+WPluWIl+eKtuaAgQogICAgICoKICAgICAqIEBwYXJhbSB7c3RyaW5nfSBuYW1lCiAgICAgKiBAcmV0dXJucyB7Ym9vbGVhbn0KICAgICAqIEBtZW1iZXJvZiBITURJbmZvR3JpZEJhc2UKICAgICAqLwogICAgcHVibGljIGdldENvbHVtblN0YXRlKG5hbWU6IHN0cmluZyk6IGJvb2xlYW4gewogICAgICAgIGxldCBjb2x1bW4gPSB0aGlzLmFsbENvbHVtbnMuZmluZCgoY29sOiBhbnkpID0+CiAgICAgICAgICAgIE9iamVjdC5pcyhuYW1lLCBjb2wubmFtZSkKICAgICAgICApOwogICAgICAgIHJldHVybiBjb2x1bW4uc2hvdyA/IHRydWUgOiBmYWxzZTsKICAgIH0KCiAgICAvKioKICAgICAqIOihqOagvOWIl+aYr+WQpuiHqumAguW6lOW4g+WxgAogICAgICoKICAgICAqIEByZWFkb25seQogICAgICogQHR5cGUge2Jvb2xlYW59CiAgICAgKiBAbWVtYmVyb2YgSE1ESW5mb0dyaWRCYXNlCiAgICAgKi8KICAgIGdldCBhZGFwdGl2ZVN0YXRlKCk6IGJvb2xlYW4gewogICAgICAgIHJldHVybiAhdGhpcy5hbGxDb2x1bW5zLmZpbmQoKGNvbHVtbjogYW55KSA9PiBjb2x1bW4uc2hvdyAmJiBPYmplY3QuaXMoY29sdW1uLnV0aWwsICdTVEFSJykpOwogICAgfQoKICAgIC8qKgogICAgICog5L+d5a2YCiAgICAgKgogICAgICogQHBhcmFtIHsqfSAkZXZlbnQKICAgICAqIEByZXR1cm5zIHtQcm9taXNlPGFueT59CiAgICAgKiBAbWVtYmVyb2YgSE1ESW5mb0dyaWRCYXNlCiAgICAgKi8KICAgIHB1YmxpYyBhc3luYyBzYXZlKGFyZ3M6IGFueVtdLCBwYXJhbXM/OiBhbnksICRldmVudD86IGFueSwgeERhdGE/OiBhbnkpewogICAgICAgIGxldCBfdGhpcyA9IHRoaXM7CiAgICAgICAgaWYoIWF3YWl0IHRoaXMudmFsaWRhdGVBbGwoKSl7CiAgICAgICAgICAgIHRoaXMuJE5vdGljZS5lcnJvcih7IHRpdGxlOiAn6ZSZ6K+vJywgZGVzYzogJ+WAvOinhOWImeagoemqjOW8guW4uCcgfSk7CiAgICAgICAgICAgIHJldHVybiBbXTsKICAgICAgICB9CiAgICAgICAgbGV0IHN1Y2Nlc3NJdGVtczphbnkgPSBbXTsKICAgICAgICBsZXQgZXJyb3JJdGVtczphbnkgPSBbXTsKICAgICAgICBsZXQgZXJyb3JNZXNzYWdlOmFueSA9IFtdOwogICAgICAgIGZvciAoY29uc3QgaXRlbSBvZiBfdGhpcy5pdGVtcykgewogICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgaWYoT2JqZWN0LmlzKGl0ZW0ucm93RGF0YVN0YXRlLCAnY3JlYXRlJykpewogICAgICAgICAgICAgICAgICAgIGlmKCF0aGlzLmNyZWF0ZUFjdGlvbil7CiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuJE5vdGljZS5lcnJvcih7IHRpdGxlOiAn6ZSZ6K+vJywgZGVzYzogJ1BJTVBFUlNPTkhNREdyaWRWaWV36KeG5Zu+6KGo5qC8Y3JlYXRlQWN0aW9u5Y+C5pWw5pyq6YWN572uJyB9KTsKICAgICAgICAgICAgICAgICAgICB9ZWxzZXsKICAgICAgICAgICAgICAgICAgICAgIE9iamVjdC5hc3NpZ24oaXRlbSx7dmlld3BhcmFtczp0aGlzLnZpZXdwYXJhbXN9KTsKICAgICAgICAgICAgICAgICAgICAgIGxldCByZXNwb25zZSA9IGF3YWl0IHRoaXMuc2VydmljZS5hZGQodGhpcy5jcmVhdGVBY3Rpb24sIEpTT04ucGFyc2UoSlNPTi5zdHJpbmdpZnkodGhpcy5jb250ZXh0KSksaXRlbSwgdGhpcy5zaG93QnVzeUluZGljYXRvcik7CiAgICAgICAgICAgICAgICAgICAgICBzdWNjZXNzSXRlbXMucHVzaChKU09OLnBhcnNlKEpTT04uc3RyaW5naWZ5KHJlc3BvbnNlLmRhdGEpKSk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfWVsc2UgaWYoT2JqZWN0LmlzKGl0ZW0ucm93RGF0YVN0YXRlLCAndXBkYXRlJykpewogICAgICAgICAgICAgICAgICAgIGlmKCF0aGlzLnVwZGF0ZUFjdGlvbil7CiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuJE5vdGljZS5lcnJvcih7IHRpdGxlOiAn6ZSZ6K+vJywgZGVzYzogJ1BJTVBFUlNPTkhNREdyaWRWaWV36KeG5Zu+6KGo5qC8dXBkYXRlQWN0aW9u5Y+C5pWw5pyq6YWN572uJyB9KTsKICAgICAgICAgICAgICAgICAgICB9ZWxzZXsKICAgICAgICAgICAgICAgICAgICAgICAgT2JqZWN0LmFzc2lnbihpdGVtLHt2aWV3cGFyYW1zOnRoaXMudmlld3BhcmFtc30pOwogICAgICAgICAgICAgICAgICAgICAgICBpZihpdGVtLnBpbXBlcnNvbil7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBPYmplY3QuYXNzaWduKHRoaXMuY29udGV4dCx7cGltcGVyc29uOml0ZW0ucGltcGVyc29ufSk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgbGV0IHJlc3BvbnNlID0gYXdhaXQgdGhpcy5zZXJ2aWNlLmFkZCh0aGlzLnVwZGF0ZUFjdGlvbixKU09OLnBhcnNlKEpTT04uc3RyaW5naWZ5KHRoaXMuY29udGV4dCkpLGl0ZW0sIHRoaXMuc2hvd0J1c3lJbmRpY2F0b3IpOwogICAgICAgICAgICAgICAgICAgICAgICBzdWNjZXNzSXRlbXMucHVzaChKU09OLnBhcnNlKEpTT04uc3RyaW5naWZ5KHJlc3BvbnNlLmRhdGEpKSk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9IGNhdGNoIChlcnJvcikgewogICAgICAgICAgICAgICAgZXJyb3JJdGVtcy5wdXNoKEpTT04ucGFyc2UoSlNPTi5zdHJpbmdpZnkoaXRlbSkpKTsKICAgICAgICAgICAgICAgIGVycm9yTWVzc2FnZS5wdXNoKGVycm9yKTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICB0aGlzLiRlbWl0KCdzYXZlJywgc3VjY2Vzc0l0ZW1zKTsKICAgICAgICB0aGlzLnJlZnJlc2goW10pOwogICAgICAgIGlmKGVycm9ySXRlbXMubGVuZ3RoID09PSAwKXsKICAgICAgICAgICAgdGhpcy4kTm90aWNlLnN1Y2Nlc3MoeyB0aXRsZTogJycsIGRlc2M6ICfkv53lrZjmiJDlip8hJyB9KTsKICAgICAgICB9ZWxzZXsKICAgICAgICAgIGVycm9ySXRlbXMuZm9yRWFjaCgoaXRlbTphbnksaW5kZXg6bnVtYmVyKT0+ewogICAgICAgICAgICB0aGlzLiROb3RpY2UuZXJyb3IoeyB0aXRsZTogJ+S/neWtmOWksei0pScsIGRlc2M6IGl0ZW0ubWFqb3JlbnRpdHluYW1lKyfkv53lrZjlpLHotKXvvIEnIH0pOwogICAgICAgICAgICBjb25zb2xlLmVycm9yKGVycm9yTWVzc2FnZVtpbmRleF0pOwogICAgICAgICAgfSk7CiAgICAgICAgfQogICAgICAgIHJldHVybiBzdWNjZXNzSXRlbXM7CiAgICB9CgogICAgLyoqCiAgICAgKiDmlrDlu7rooYwKICAgICAqCiAgICAgKiBAcGFyYW0geyp9ICRldmVudAogICAgICogQHJldHVybnMge3ZvaWR9CiAgICAgKiBAbWVtYmVyb2YgSE1ESW5mb0dyaWRCYXNlCiAgICAgKi8KICAgIHB1YmxpYyBuZXdSb3coYXJnczogYW55W10sIHBhcmFtcz86IGFueSwgJGV2ZW50PzogYW55LCB4RGF0YT86IGFueSk6IHZvaWQgewogICAgICAgIGlmKCF0aGlzLmxvYWRkcmFmdEFjdGlvbil7CiAgICAgICAgICAgIHRoaXMuJE5vdGljZS5lcnJvcih7IHRpdGxlOiAn6ZSZ6K+vJywgZGVzYzogJ1BJTVBFUlNPTkhNREdyaWRWaWV36KeG5Zu+6KGo5qC8bG9hZGRyYWZ0QWN0aW9u5Y+C5pWw5pyq6YWN572uJyB9KTsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KICAgICAgICBsZXQgX3RoaXMgPSB0aGlzOwogICAgICAgIE9iamVjdC5hc3NpZ24oYXJnc1swXSx7dmlld3BhcmFtczp0aGlzLnZpZXdwYXJhbXN9KTsKICAgICAgICBsZXQgcG9zdDogUHJvbWlzZTxhbnk+ID0gdGhpcy5zZXJ2aWNlLmxvYWREcmFmdCh0aGlzLmxvYWRkcmFmdEFjdGlvbiwgSlNPTi5wYXJzZShKU09OLnN0cmluZ2lmeSh0aGlzLmNvbnRleHQpKSwgYXJnc1swXSwgdGhpcy5zaG93QnVzeUluZGljYXRvcik7CiAgICAgICAgcG9zdC50aGVuKChyZXNwb25zZTogYW55KSA9PiB7CiAgICAgICAgICAgIGlmICghcmVzcG9uc2Uuc3RhdHVzIHx8IHJlc3BvbnNlLnN0YXR1cyAhPT0gMjAwKSB7CiAgICAgICAgICAgICAgICBpZiAocmVzcG9uc2UuZXJyb3JNZXNzYWdlKSB7CiAgICAgICAgICAgICAgICAgICAgdGhpcy4kTm90aWNlLmVycm9yKHsgdGl0bGU6ICfplJnor68nLCBkZXNjOiByZXNwb25zZS5lcnJvck1lc3NhZ2UgfSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgIH0KICAgICAgICAgICAgY29uc3QgZGF0YSA9IHJlc3BvbnNlLmRhdGE7CiAgICAgICAgICAgIHRoaXMuY3JlYXRlRGVmYXVsdChkYXRhKTsKICAgICAgICAgICAgZGF0YS5yb3dEYXRhU3RhdGUgPSAiY3JlYXRlIjsKICAgICAgICAgICAgX3RoaXMuaXRlbXMucHVzaChkYXRhKTsKICAgICAgICAgICAgX3RoaXMuZ3JpZEl0ZW1zTW9kZWwucHVzaChfdGhpcy5nZXRHcmlkUm93TW9kZWwoKSk7CiAgICAgICAgfSkuY2F0Y2goKHJlc3BvbnNlOiBhbnkpID0+IHsKICAgICAgICAgICAgaWYgKHJlc3BvbnNlICYmIHJlc3BvbnNlLnN0YXR1cyA9PT0gNDAxKSB7CiAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKCFyZXNwb25zZSB8fCAhcmVzcG9uc2Uuc3RhdHVzIHx8ICFyZXNwb25zZS5kYXRhKSB7CiAgICAgICAgICAgICAgICB0aGlzLiROb3RpY2UuZXJyb3IoeyB0aXRsZTogJ+mUmeivrycsIGRlc2M6ICfns7vnu5/lvILluLgnIH0pOwogICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICB9CiAgICAgICAgfSk7CiAgICB9CgogICAgLyoqCiAgICAgKiDooajmoLznvJbovpHpobnlgLzlj5jmm7QKICAgICAqICAKICAgICAqIEBwYXJhbSByb3cg6KGM5pWw5o2uCiAgICAgKiBAcGFyYW0ge3sgbmFtZTogc3RyaW5nLCB2YWx1ZTogYW55IH19ICRldmVudAogICAgICogQHJldHVybnMge3ZvaWR9CiAgICAgKiBAbWVtYmVyb2YgSE1ESW5mb0dyaWRCYXNlCiAgICAgKi8KICAgIHB1YmxpYyBvbkdyaWRJdGVtVmFsdWVDaGFuZ2Uocm93OiBhbnksJGV2ZW50OiB7IG5hbWU6IHN0cmluZywgdmFsdWU6IGFueSB9LHJvd0luZGV4OiBudW1iZXIpOiB2b2lkIHsKICAgICAgICBpZiAoISRldmVudCkgewogICAgICAgICAgICByZXR1cm47CiAgICAgICAgfQogICAgICAgIGlmICghJGV2ZW50Lm5hbWUgfHwgT2JqZWN0LmlzKCRldmVudC5uYW1lLCAnJykgfHwgIXJvdy5oYXNPd25Qcm9wZXJ0eSgkZXZlbnQubmFtZSkpIHsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KICAgICAgICByb3dbJGV2ZW50Lm5hbWVdID0gJGV2ZW50LnZhbHVlOwogICAgICAgIHRoaXMuZ3JpZEVkaXRJdGVtQ2hhbmdlKHJvdywgJGV2ZW50Lm5hbWUsICRldmVudC52YWx1ZSwgcm93SW5kZXgpOwogICAgfQoKICAgIC8qKgogICAgICog6KGo5qC857yW6L6R6aG55YC85Y+Y5YyWCiAgICAgKgogICAgICogQHB1YmxpYwogICAgICogQHBhcmFtIHJvdyDooYzmlbDmja4KICAgICAqIEBwYXJhbSBwcm9wZXJ0eSDliJfnvJbovpHpobnlkI0KICAgICAqIEBwYXJhbSByb3cg5YiX57yW6L6R6aG55YC8CiAgICAgKiBAcmV0dXJucyB7dm9pZH0KICAgICAqIEBtZW1iZXJvZiBITURJbmZvR3JpZEJhc2UKICAgICAqLwogICAgcHVibGljIGdyaWRFZGl0SXRlbUNoYW5nZShyb3c6IGFueSwgcHJvcGVydHk6IHN0cmluZywgdmFsdWU6IGFueSwgcm93SW5kZXg6IG51bWJlcil7CiAgICAgICAgcm93LnJvd0RhdGFTdGF0ZSA9IHJvdy5yb3dEYXRhU3RhdGUgPyByb3cucm93RGF0YVN0YXRlIDogInVwZGF0ZSIgOwogICAgICAgIHRoaXMudmFsaWRhdGUocHJvcGVydHkscm93LHJvd0luZGV4KTsKICAgIH0KCiAgICAvKioKICAgICAqIOihqOagvOe8lui+kemhueabtOaWsAogICAgICoKICAgICAqIEBwYXJhbSB7c3RyaW5nfSBtb2RlIOeVjOmdouihjOS4uuWQjeensAogICAgICogQHBhcmFtIHsqfSBbZGF0YT17fV0g6K+35rGC5pWw5o2uCiAgICAgKiBAcGFyYW0ge3N0cmluZ1tdfSB1cGRhdGVEZXRhaWxzIOabtOaWsOmhuQogICAgICogQHBhcmFtIHtib29sZWFufSBbc2hvd2xvYWRpbmddIOaYr+WQpuaYvuekuuWKoOi9veeKtuaAgQogICAgICogQHJldHVybnMge3ZvaWR9CiAgICAgKiBAbWVtYmVyb2YgSE1ESW5mb0dyaWRCYXNlCiAgICAgKi8KICAgIHB1YmxpYyB1cGRhdGVHcmlkRWRpdEl0ZW0obW9kZTogc3RyaW5nLCBkYXRhOiBhbnkgPSB7fSwgdXBkYXRlRGV0YWlsczogc3RyaW5nW10sIHNob3dsb2FkaW5nPzogYm9vbGVhbik6IHZvaWQgewogICAgICAgIGlmICghbW9kZSB8fCAobW9kZSAmJiBPYmplY3QuaXMobW9kZSwgJycpKSkgewogICAgICAgICAgICByZXR1cm47CiAgICAgICAgfQogICAgICAgIGNvbnN0IGFyZzogYW55ID0gSlNPTi5wYXJzZShKU09OLnN0cmluZ2lmeShkYXRhKSk7CiAgICAgICAgT2JqZWN0LmFzc2lnbihhcmcse3ZpZXdwYXJhbXM6dGhpcy52aWV3cGFyYW1zfSk7CiAgICAgICAgY29uc3QgcG9zdDogUHJvbWlzZTxhbnk+ID0gdGhpcy5zZXJ2aWNlLmZyb250TG9naWMobW9kZSxKU09OLnBhcnNlKEpTT04uc3RyaW5naWZ5KHRoaXMuY29udGV4dCkpLGFyZywgc2hvd2xvYWRpbmcpOwogICAgICAgIHBvc3QudGhlbigocmVzcG9uc2U6IGFueSkgPT4gewogICAgICAgICAgICBpZiAoIXJlc3BvbnNlIHx8IHJlc3BvbnNlLnN0YXR1cyAhPT0gMjAwKSB7CiAgICAgICAgICAgICAgICB0aGlzLiROb3RpY2UuZXJyb3IoeyB0aXRsZTogJ+mUmeivrycsIGRlc2M6ICfooajljZXpobnmm7TmlrDlpLHotKUnIH0pOwogICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGNvbnN0IF9kYXRhOiBhbnkgPSByZXNwb25zZS5kYXRhOwogICAgICAgICAgICBpZighX2RhdGEpewogICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHVwZGF0ZURldGFpbHMuZm9yRWFjaCgobmFtZTogc3RyaW5nKSA9PiB7CiAgICAgICAgICAgICAgICBpZiAoIV9kYXRhLmhhc093blByb3BlcnR5KG5hbWUpKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgZGF0YVtuYW1lXSA9IF9kYXRhW25hbWVdOwogICAgICAgICAgICB9KTsKICAgICAgICB9KS5jYXRjaCgocmVzcG9uc2U6IGFueSkgPT4gewogICAgICAgICAgICBpZiAocmVzcG9uc2UgJiYgcmVzcG9uc2Uuc3RhdHVzID09PSA0MDEpIHsKICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAoIXJlc3BvbnNlIHx8ICFyZXNwb25zZS5zdGF0dXMgfHwgIXJlc3BvbnNlLmRhdGEpIHsKICAgICAgICAgICAgICAgIHRoaXMuJE5vdGljZS5lcnJvcih7IHRpdGxlOiAn6ZSZ6K+vJywgZGVzYzogJ+ezu+e7n+W8guW4uCcgfSk7CiAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgIH0KICAgICAgICB9KTsKICAgIH0KCiAgICAvKioKICAgICAqIOiOt+WPluWvueW6lOihjGNsYXNzCiAgICAgKgogICAgICogQHBhcmFtIHsqfSAkYXJncyByb3cg6KGM5pWw5o2u77yMcm93SW5kZXgg6KGM57Si5byVCiAgICAgKiBAcmV0dXJucyB7dm9pZH0KICAgICAqIEBtZW1iZXJvZiBITURJbmZvR3JpZEJhc2UKICAgICAqLwogICAgcHVibGljIGdldFJvd0NsYXNzTmFtZShhcmdzOntyb3c6IGFueSxyb3dJbmRleDogbnVtYmVyfSl7CiAgICAgICAgbGV0IGlzU2VsZWN0ZWQgPSB0aGlzLnNlbGVjdGlvbnMuc29tZSgoaXRlbTphbnkpPT57CiAgICAgICAgICAgIHJldHVybiBPYmplY3QuaXMoaXRlbS5waW1wZXJzb24sYXJncy5yb3cucGltcGVyc29uKTsKICAgICAgICB9KTsKICAgICAgICByZXR1cm4gaXNTZWxlY3RlZCA/ICJncmlkLXNlbGVjdGVkLXJvdyIgOiAiIjsKICAgIH0KCiAgICAvKioKICAgICAqIOiOt+WPluWvueW6lOWIl2NsYXNzCiAgICAgKgogICAgICogQHBhcmFtIHsqfSAkYXJncyByb3cg6KGM5pWw5o2u77yMY29sdW1uIOWIl+aVsOaNru+8jHJvd0luZGV4IOihjOe0ouW8le+8jOWIl+e0ouW8lQogICAgICogQHJldHVybnMge3ZvaWR9CiAgICAgKiBAbWVtYmVyb2YgSE1ESW5mb0dyaWRCYXNlCiAgICAgKi8KICAgIHB1YmxpYyBnZXRDZWxsQ2xhc3NOYW1lKGFyZ3M6e3JvdzogYW55LCBjb2x1bW46IGFueSwgcm93SW5kZXg6IG51bWJlciwgY29sdW1uSW5kZXg6bnVtYmVyfSl7CiAgICAgICAgbGV0IGhhc1Jvd0VkaXQ6YW55ID0gewogICAgICAgICAgJ3lnYmgnOmZhbHNlLAogICAgICAgICAgJ3BpbXBlcnNvbm5hbWUnOmZhbHNlLAogICAgICAgICAgJ3pqaG0nOmZhbHNlLAogICAgICAgICAgJ3p6ZHpzJzpmYWxzZSwKICAgICAgICAgICd5Z3p0JzpmYWxzZSwKICAgICAgICAgICdobWQnOmZhbHNlLAogICAgICAgICAgJ2JsYWNrbGlzdHJlYXNvbnMnOmZhbHNlLAogICAgICAgIH0KICAgICAgICByZXR1cm4gKCBoYXNSb3dFZGl0W2FyZ3MuY29sdW1uLnByb3BlcnR5XSAmJiB0aGlzLmFjdHVhbElzT3BlbkVkaXQgKSA/ICJlZGl0LWNlbGwiIDogImluZm8tY2VsbCI7CiAgICB9CgogICAgLyoqCiAgICAgKiDmlrDlu7rpu5jorqTlgLwKICAgICAqIEBwYXJhbSB7Kn0gIHJvdyDooYzmlbDmja4KICAgICAqIEBtZW1iZXJvZiBITURJbmZvR3JpZEJhc2UKICAgICAqLwogICAgcHVibGljIGNyZWF0ZURlZmF1bHQocm93OiBhbnkpeyAgICAgICAgICAgICAgICAgICAgCiAgICB9Cn0K"},null]}